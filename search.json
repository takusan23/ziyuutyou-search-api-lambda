[{"title":"ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ãƒ³å¼±è€…é›†åˆã€‚PWAã§ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã«å¯¾å¿œã•ã›ã‚‹","link":"/posts/akashic_engine_pwa_cache/","markdown":"\r\nä»Šæœˆã¯ã‚ã‚“ã¾ã‚Šãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ä½¿ã£ã¦ãªã„ã§ã™ã­ã€‚\r\n\r\n# æœ¬é¡Œ\r\nPWAã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½ã§ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚è¦‹ã‚Œã‚‹ã‚µã‚¤ãƒˆãŒã§ããŸã®ã§æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nä»Šå›ã¯**Akashic Engine**ã§ä½œã£ãŸã‚²ãƒ¼ãƒ ã‚’PWAã«å¯¾å¿œã•ã›ã¦ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§ã‚‚éŠã¹ã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚  \r\nåˆ¥ã«Akashic Engineã˜ã‚ƒãªãã¦ã‚‚è‰¯ã„ã§ã™ãŒ\r\n\r\nã¡ãªã¿ã«ã“ã®ã‚µã‚¤ãƒˆã¯nuxt.jsã«PWAé–¢ä¿‚ã‚’ä»»ã›ã¦ã„ã‚‹ã®ã§ç‰¹ã«ä½•ã‚‚ã›ãšã«å‹•ã„ã¦ã¾ã™ã€‚\r\n\r\n\r\n*PWA+Cacheã§ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã‚’ç¯€ç´„ã™ã‚‹ã*\r\n\r\nPWAãŒä½•ã‚’ã™ã‚‹ã®ã‹ã¯å„è‡ªã§èª¿ã¹ã¦ãã ã•ã„ï¼ˆãˆ\r\n\r\n# ä»Šå›ä½¿ã†ã‚µã‚¤ãƒˆã¯\r\n- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\n    - https://github.com/takusan23/AkashicEngine-FlappyBird\r\n- Netlifyã«å…¬é–‹ã—ãŸå®Œæˆå“ã¯ã“ã¡ã‚‰\r\n    - https://game-akashic-bird.negitoro.dev/\r\n    - PWAã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ãŒå‡ºã¦ãã‚‹ã¯ãšã€‚\r\n\r\nã“ã‚Œã€‚å‰ã®ãƒ–ãƒ­ã‚°ã®ãŠã¾ã‘ã§ä½¿ã£ã¦ãŸã‚„ã¤[^1]\r\n\r\n# ç”¨æ„ã™ã‚‹ã‚‚ã®\r\n- PWAåŒ–ã—ãŸã„ã‚µã‚¤ãƒˆã®ã‚½ãƒ¼ã‚¹\r\n    - htmlã¨ã‹ç”»åƒã¨ã‹jsã¨ã‹ãª\r\n- PWAåŒ–ã—ãŸã¨ãã®ã‚¢ã‚¤ã‚³ãƒ³\r\n    - 192x192ã®å¤§ãã•ã¨512x512ã®å¤§ãã•ãŒå¿…è¦ã‚‰ã—ã„ã§ã™ã€‚\r\n- Webã‚µãƒ¼ãƒãƒ¼å»ºã¦ã‚‹æ‹¡å¼µæ©Ÿèƒ½ã€‚åˆ¥ã«ã“ã‚Œä»¥å¤–ã§ã‚‚è‰¯ã„\r\n    - https://chrome.google.com/webstore/detail/web-server-for-chrome/ofhbbkphhbklhfoeikjpcbhemlocgigb?hl=ja\r\n- ã‚„ã‚‹æ°—ã€‚è«¦ã‚ãªã„ãã¨ã„ã†ãŠæ°—æŒã¡\r\n    - PWAå³ã—ã„\r\n- ä»Šå›ã¯Netlifyã§å…¬é–‹ã™ã‚‹\r\n    - GitHub Pagesã ã¨è©±ãŒå¤‰ã‚ã£ã¦ãã‚‹ã¨æ€ã†ã€‚\r\n\r\n# HTMLã‚’ç”¨æ„ã™ã‚‹\r\nã‚‚ã†ã™ã§ã«htmlã‚’æŒã£ã¦ã‚‹æ–¹ã¯è‰¯ã„ã§ã™ã€‚  \r\nä»Šå›ç§ã¯Akashic Engineã‚’HTMLå½¢å¼ã«æ›¸ãå‡ºã•ãªã„ã¨ã„ã‘ãªã„ã®ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ\r\n\r\n```console\r\nakashic export html --bundle --magnify --minify --output export\r\n```\r\n\r\n`--minify`ã‚’æŒ‡å®šã—ã¦å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¥µé™ã¾ã§æ¸›ã‚‰ã—ã¾ã™ã€‚\r\n\r\nã“ã‚Œã§HTMLã‚’ç”¨æ„ã§ãã¾ã—ãŸã€‚  \r\n![Imgur](https://imgur.com/f4QhGBO.png)\r\n\r\n**ã‚ã¨ã¯ç”Ÿæˆã•ã‚ŒãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã®`<title>`ã‚’æ›¸ãæ›ãˆã¦åå‰ã‚’å¤‰ãˆã¾ã—ã‚‡ã†**\r\n\r\n# ServiceWorker\r\n~~Hello, Worker~~  \r\n\r\n## sw.jsã‚’ç½®ã\r\nindex.htmlã®ã‚ã‚‹ã¨ã“ã‚ã«`sw.js`ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nä¸­èº«ã¯ã¨ã‚Šã‚ãˆãšç©ºã®ã¾ã¾ã§ã„ã„ã§ã™ã€‚\r\n\r\n## iconsãƒ•ã‚©ãƒ«ãƒ€ã‚’ç½®ã\r\n`sw.js`ã¨åŒã˜æ„Ÿã˜ã§åŒã˜å ´æ‰€ã«`icons`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nä¸­ã«ã¯ã€`192x192`ã®å¤§ãã•ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã¨`512x512`ã®å¤§ãã•ã®ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nåå‰ã¯ãã‚Œãã‚Œä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n- `icon_192.png`\r\n- `icon_512.png`\r\n\r\n## manifest.jsonã‚’ç½®ã\r\n`sw.js`ã¨åŒã˜æ„Ÿã˜ã§åŒã˜å ´æ‰€ã«`manifest.json`ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nãã—ã¦ä»¥ä¸‹ã®å†…å®¹ã‚’å…¥ã‚Œã¾ã™\r\n\r\n```json\r\n{\r\n    \"name\": \"Akashic Engine Flappy Bird\",\r\n    \"short_name\": \"Akashic Bird\",\r\n    \"icons\": [\r\n        {\r\n            \"src\": \"/icons/icon_192.png\",\r\n            \"sizes\": \"192x192\",\r\n            \"type\": \"image/png\"\r\n        },\r\n        {\r\n            \"src\": \"/icons/icon_512.png\",\r\n            \"sizes\": \"512x512\",\r\n            \"type\": \"image/png\"\r\n        }\r\n    ],\r\n    \"start_url\": \"/index.html\",\r\n    \"display\": \"standalone\",\r\n    \"background_color\": \"#FFFFFF\",\r\n    \"theme_color\": \"#FFFFFF\"\r\n}\r\n```\r\n\r\næœ€ä½é™ã€\r\n- `name`\r\n    - ãªã¾ãˆ\r\n- `short_name`\r\n    - ã‚¢ãƒ—ãƒªä¸€è¦§ã§è¡¨ç¤ºã•ã‚Œã‚‹åå‰\r\n\r\nã‚’æ›¸ãæ›ãˆã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n## ServiceWorkerç™»éŒ²\r\n`index.html`ã‚’é–‹ãã¾ã™ã€‚  \r\né–‹ã„ãŸã‚‰ã€headå†…ã«ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãã¾ã™ã€‚  \r\nã‚ˆãã‚ã‹ã‚‰ãªã„å ´åˆã¯`<title>`ã®ä¸‹è¾ºã‚Šã«æ›¸ã„ã¦ãŠã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```html\r\n<!-- ã‚¦ã‚§ãƒ–ã‚¢ãƒ—ãƒªãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®èª­ã¿è¾¼ã¿ -->\r\n<link rel=\"manifest\" href=\"manifest.json\">\r\n<!-- ã•ãƒ¼ã³ã™ã‚ãƒ¼ã‹ãƒ¼ -->\r\n<script>\r\n    if (\"serviceWorker\" in navigator) {\r\n        navigator.serviceWorker\r\n            .register(\"sw.js\")\r\n            .then(() => console.log(\"registered service worker!\"));\r\n    }\r\n</script>\r\n```\r\n\r\n# ã“ã“ã¾ã§ã§ã§ããŸãƒ•ã‚¡ã‚¤ãƒ«\r\n`image`ãƒ•ã‚©ãƒ«ãƒ€ä»¥å¤–ã¯ã¿ã‚“ãªã‚ã‚‹ã‚ˆã­ï¼Ÿ  \r\n![Imgur](https://imgur.com/ffmuHM6.png)\r\n\r\n# sw.jsã‚’æ›¸ã\r\nsw.jsç™½ç´™ã ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®ãŸã‚ã®ãƒãƒŠãƒ¼ï¼ˆãƒ›ãƒ¼ãƒ ç”»é¢ã« {ã‚¢ãƒ—ãƒªå} ã‚’è¿½åŠ ï¼‰ã™ã‚‰å‡ºãªã„æ¨¡æ§˜ã€‚  \r\n\r\n## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãªã‘ã‚Œã°ã„ã‘ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸¦ã¹ã‚‹\r\nã“ã“ã§ãƒ•ã‚¡ã‚¤ãƒ«åã‚’é–“é•ãˆã‚‹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—è«¦ã‚ã‚‹ã®ã§ã¡ã‚ƒã‚“ã¨æ›¸ãã¾ã—ã‚‡ã†ã€‚å…ˆç”ŸãŒç”Ÿå¾’ã®åå‰é–“é•ãˆãªã„ã‚ˆã†ã«ã™ã‚‹ã¿ãŸã„ãªæ„Ÿã˜ã§\r\n\r\n```js\r\n// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãªã„ã¨ã„ã‘ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™ã™ã‚‹ã€‚é–“é•ãˆãªã„ã‚ˆã†ã«\r\nconst CACHE_LIST = [\r\n    \"/icons/icon_192.png\",\r\n    \"/icons/icon_512.png\",\r\n    \"/image/play.png\",\r\n    \"/image/result.png\",\r\n    \"/image/title.png\",\r\n    \"/image/tori.png\",\r\n    \"index.html\",\r\n    \"manifest.json\",\r\n    \"/\"\r\n]\r\n```\r\n\r\n## ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä»˜ã‘ã‚‹åå‰\r\nå¤šåˆ†è­˜åˆ¥ã«ä½¿ã†ã¨æ€ã„ã¾ã™ã€‚åŒã˜åå‰ã ã£ãŸã‚‰å–å¾—ã—ãªã„ã€åå‰ãŒå¤‰ã‚ã£ã¦ã„ãŸã‚‰å†åº¦å–ã‚Šç›´ã™ã¿ãŸã„ãªæ„Ÿã˜ã ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nã‚­ãƒ£ãƒƒã‚·ãƒ¥å–å¾—ã—ç›´ã—ãŸã„å ´åˆã¯ã“ã“ã®å€¤ã‚’å¤‰ãˆã‚‹ã“ã¨ã§å†åº¦å–ã‚Šç›´ã—ã¦ãã‚Œã¾ã™ã€‚\r\n\r\n```js\r\n// ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®åå‰ã€‚è­˜åˆ¥ã«ä½¿ã†\r\nconst VERSION_NAME = 'bird_20200627' // ã“ã“ã®å€¤ãŒå¤‰ã‚ã‚‹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†ç™»éŒ²ã™ã‚‹ã£ã½ã„ï¼Ÿ\r\n```\r\n\r\n## `install` ã‚¤ãƒ™ãƒ³ãƒˆ\r\nã‚³ãƒ”ãƒšã§è¡Œã‘ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n```js\r\n// ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«\r\nself.addEventListener('install', event => {\r\n    console.log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã')\r\n    event.waitUntil(\r\n        caches.open(VERSION_NAME).then(cache => {\r\n            return cache.addAll(CACHE_LIST) // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç™»éŒ²\r\n        }).catch(err => { console.log(err) }) // ãˆã‚‰ãƒ¼\r\n    )\r\n})\r\n```\r\n\r\n## ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ¨ªå–ã‚Š\r\nã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ç”»åƒãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã‚ˆãƒ¼  \r\nâ†“  \r\nServiceWorkerãŒæ¤œçŸ¥  \r\nâ†“  \r\nã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒã‚ã‚Œã°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’è¿”ã™\r\n\r\nã“ã‚Œã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n```js\r\n// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¨ªå–ã‚Šã™ã‚‹\r\nself.addEventListener('fetch', event => {\r\n    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å†…å®¹ã«ç½®ãæ›ãˆã‚‹\r\n    event.respondWith(\r\n        caches.match(event.request).then(function (response) {\r\n            return response || fetch(event.request);\r\n        })\r\n    );\r\n})\r\n```\r\n\r\n## å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã™\r\n**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«ä»˜ã‘ã‚‹åå‰**ã®é …ç›®ã§ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†åº¦å–ã‚Šç›´ã—ã¦ãã‚Œã¾ã™ãªã©è¨€ã„ã¾ã—ãŸãŒã€ã“ã‚Œå‹æ‰‹ã«ã¯æ¶ˆã—ã¦ãã‚Œãªã„ã®ã§æ¶ˆã—ã¦ãã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\r\n\r\n```js\r\n// å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã™ã€‚\r\nself.addEventListener('activate', function (event) {\r\n    event.waitUntil(\r\n        caches.keys().then(function (cacheNames) {\r\n            return Promise.all(\r\n                cacheNames.filter(function (cacheName) {\r\n                    return cacheName !== VERSION_NAME;\r\n                }).map(function (cacheName) {\r\n                    return caches.delete(cacheName);\r\n                })\r\n            );\r\n        })\r\n    );\r\n});\r\n```\r\n\r\n# ã“ã“ã¾ã§ã®sw.js\r\n\r\n```js\r\n// ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã—ãªã„ã¨ã„ã‘ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ—æŒ™ã™ã‚‹ã€‚é–“é•ãˆãªã„ã‚ˆã†ã«\r\nconst CACHE_LIST = [\r\n    \"/icons/icon_192.png\",\r\n    \"/icons/icon_512.png\",\r\n    \"/image/play.png\",\r\n    \"/image/result.png\",\r\n    \"/image/title.png\",\r\n    \"/image/tori.png\",\r\n    \"index.html\",\r\n    \"manifest.json\",\r\n    \"/\"\r\n]\r\n\r\n// ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®åå‰ã€‚è­˜åˆ¥ã«ä½¿ã†\r\nconst VERSION_NAME = 'bird_20200627' // ã“ã“ã®å€¤ãŒå¤‰ã‚ã‚‹ã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’å†ç™»éŒ²ã™ã‚‹ã£ã½ã„ï¼Ÿ\r\n\r\n// ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ã«\r\nself.addEventListener('install', event => {\r\n    console.log('ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã')\r\n    event.waitUntil(\r\n        caches.open(VERSION_NAME).then(cache => {\r\n            return cache.addAll(CACHE_LIST) // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç™»éŒ²\r\n        }).catch(err => { console.log(err) }) // ãˆã‚‰ãƒ¼\r\n    )\r\n})\r\n\r\n// ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’æ¨ªå–ã‚Šã™ã‚‹\r\nself.addEventListener('fetch', event => {\r\n    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®å†…å®¹ã«ç½®ãæ›ãˆã‚‹\r\n    event.respondWith(\r\n        caches.match(event.request).then(function (response) {\r\n            return response || fetch(event.request);\r\n        })\r\n    );\r\n})\r\n\r\n// å¤ã„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã™ã€‚\r\nself.addEventListener('activate', function (event) {\r\n    event.waitUntil(\r\n        caches.keys().then(function (cacheNames) {\r\n            return Promise.all(\r\n                cacheNames.filter(function (cacheName) {\r\n                    return cacheName !== VERSION_NAME;\r\n                }).map(function (cacheName) {\r\n                    return caches.delete(cacheName);\r\n                })\r\n            );\r\n        })\r\n    );\r\n});\r\n```\r\n\r\n# Web Server for Chrome ã‚’é–‹ã„ã¦\r\n`CHOOSE FOLDER`ã‚’æŠ¼ã—ã¦ã€`index.html`ã®ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã—ã¾ã™ã€‚  \r\nãã—ãŸã‚‰`Web Server`ã®ã‚¹ã‚¤ãƒƒãƒã‚’æŠ¼ã—ã¦èµ·å‹•ã•ã›ã¾ã™ã€‚ \r\n\r\nèµ·å‹•ã§ããŸã‚‰ã€`http://127.0.0.1`ã‹ã‚‰å§‹ã¾ã‚‹URLãŒ`Web Server URL(s)`ã®ä¸‹ã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§æŠ¼ã—ã¾ã™ã€‚ã™ã‚‹ã¨Webãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã‚“ã§ã™ã­ï½\r\n\r\nãã—ãŸã‚‰Webãƒšãƒ¼ã‚¸ã‚’é–‹ã„ãŸçŠ¶æ…‹ã§`F12`ãŠã—ã¦`Application`ã‚¿ãƒ–ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\nãã®ä¸­ã‹ã‚‰`Cache Storage`ã‚’æ¢ã—ã¦ã€ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãŒå–å¾—ã§ãã¦ã‚‹ã‹ç¢ºèªã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://i.imgur.com/PWEuyxl.png)\r\n\r\nã“ã®ã‚ˆã†ã«ç™»éŒ²ã•ã‚Œã¦ã„ã‚Œã°å®Œæˆã§ã™ã€‚ãŠã‚ï¼\r\n\r\nã¡ãªã¿ã«ï¼šæœ¬å½“ãªã‚‰`index.html`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã ã‘ã§è¦‹ã‚Œã‚‹ã‚ã‘ã§ã™ãŒã€Service Workerã‚’å‹•ã‹ã™ãŸã‚ã«ã¯URLãŒ `https`ã§å§‹ã¾ã‚‹ã‹`localhostï¼ˆ127.0.0.1ï¼‰`ã§å§‹ã¾ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ˆã†ã§ã™ã€‚  \r\nã ã‹ã‚‰**Web Server for Chrome**ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã£ãŸã®ã§ã™ã­ã€‚\r\n\r\n# æœ¬å½“ã«ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã§å‹•ãã®ï¼Ÿ\r\n\r\n`Service Worker`ã‚’æŠ¼ã—ã¦ã€`Offline`ã«ãƒãƒ£ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nå…¥ã‚ŒãŸå¾Œã«å†èª­ã¿è¾¼ã¿ã—ã¦ã‚‚è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹å ´åˆã¯å‹•ã„ã¦ã¾ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/Bjjxnvm.png)\r\n\r\n# Netlifyã§å…¬é–‹\r\nã‚‚ã†ä¸€å›ã‚¿ã‚¤ãƒˆãƒ«è¦‹ã¦ãã ã•ã„ã€‚ãƒ‡ãƒ¼ã‚¿ãƒ—ãƒ©ãƒ³å¼±è€…ãŒãªã‚“ã¨ã‹ã¨ã‹æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚ãã†ã‚¹ãƒãƒ›ã§è¦‹ã‚Œãªã„ã¨æ„å‘³ãŒãªã„ã‚“ã§ã™ã‚ˆã€‚\r\n\r\nã¨ã„ã†ã‚ã‘ã§Netlifyã§å…¬é–‹ã—ã¾ã™ã€‚  \r\nã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¯å„è‡ªä½œæˆã—ã¦ãã ã•ã„ã€‚ã“ã®è¨˜äº‹ã«è¾¿ã‚Šç€ãã£ã¦ã“ã¨ã¯ãã‚Œãªã‚Šã®çŸ¥è­˜ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚  \r\n\r\n## Netlify Drop\r\nãªã‚“ã‹`index.html`ãªã‚“ã‹ãŒå…¥ã£ãŸãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã«æŠ•ã’ã‚‹ã ã‘ã§å…¬é–‹ã§ãã‚‹ã‚‰ã—ã„ã€‚\r\n\r\nã¨ã„ã†ã‚ã‘ã§`index.html sw.js manifest.json`ã‚‚ã‚ã‚‚ã‚å…¥ã£ã¦ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’Netlifyã®ã‚µã‚¤ãƒˆã«æŠ•ã’ã¾ã—ã‚‡ã†ã€‚ã“ã®æ–¹æ³•ãªã‚‰GitHubã‚’çµŒç”±ã™ã‚‹ã“ã¨ç„¡ãå…¬é–‹ã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/wCFDJiW.png)\r\n\r\n## Site Settings > Change site name ã‹ã‚‰URLã‚’å¤‰æ›´\r\n`https:// {è‡ªç”±ã«æ±ºã‚ã‚‰ã‚Œã‚‹} .netlify.app`ã®è‡ªç”±ã«æ±ºã‚ã‚‰ã‚Œã‚‹ã®éƒ¨åˆ†ãªã‚‰ã€è‡ªç”±ã«å¤‰æ›´å¯èƒ½ã§ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/911F4E7.png)\r\n\r\nè‡ªåˆ†ã®æŒã£ã¦ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹å ´åˆã¯å‰ã«æ›¸ãã¾ã—ãŸâ†’ [Google Domainsã§ãƒ‰ãƒ¡ã‚¤ãƒ³è²·ã£ãŸ](/posts/domain_katta)\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\nä»Šå›ã§ããŸã‚µã‚¤ãƒˆã¯ã“ã¡ã‚‰ã€‚â†’ https://game-akashic-bird.negitoro.dev/\r\n# ãŠã‚ã‚Šã«\r\nã¨ã“ã‚ã§ä»Šã®æ‰€é€šä¿¡åˆ¶é™ã‹ã‹ã£ãŸã“ã¨ã¯ç„¡ã„ã¨æ€ã‚ã‚Œ\r\n\r\n![Imgur](https://i.imgur.com/q8X1FOT.png)\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://qiita.com/masanarih0ri/items/0845f312cff5c8d0ec60  \r\nhttps://www.simicart.com/blog/pwa-offline/  \r\n\r\n[^1]:Nuxt.jsã§HTMLè²¼ã‚‹ã®ã£ã¦ã©ã†ã™ã‚Šã‚ƒã„ã„ã‚“ã ï¼Ÿ"},{"title":"Android 11 ã®ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«APIã‚’è©¦ã™","link":"/posts/android11_devicecontrol/","markdown":"\r\nAndroid 11 Beta ããŸããŠãŠãŠãŠãŠãŠãŠãŠãŠ   \r\nğŸ¥³â†ã“ã‚Œã™ã\r\n\r\n# è¿½è¨˜ï¼š2020/06/13\r\nGoogle PayãŒä½¿ãˆãªã„ã¨è¨€ã„ã¾ã—ãŸã€‚ãŒã€Suicaã§é›»è»Šã«ä¹—ã‚ŒãŸã®ã§å¤šåˆ†**ãŠï½»ï½²ï¾Œï½¹ï½°ï¾€ï½²**ã‚¢ãƒ—ãƒªã§ã¯å¯¾å¿œã—ã¦ã„ãªã„**NFC Pay**ã‚ãŸã‚ŠãŒä½¿ãˆãªã„ã‚“ã ã¨æ€ã„ã¾ã™ã€‚  \r\nFelicaä½¿ã†ç³»ã¯å¤šåˆ†è¡Œã‘ã‚‹ã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ã­ï¼Ÿ\r\n\r\nã‚ã¨ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼(RangeTemplate)å‹•ã„ãŸã®ã§ãã‚Œã‚‚\r\n\r\n# æœ¬é¡Œ\r\nAndroid 11 Beta 1 æ¥ã¾ã—ãŸã€‚  \r\nã‚ãŸã—çš„ã«æ¥½ã—ã¿ã«ã—ã¦ã‚‹æ©Ÿèƒ½ã¯\r\n- Device Control API (æ­£å¼åç§°ã—ã‚‰ã‚“)\r\n    - è¨¼æ˜ã®ON/OFFã¨ã‹æ˜ã‚‹ã•ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ãªã©\r\n    - Quick Settings ã®ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ç‰ˆ\r\n    - **ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ãªã‚“ã¦é‡‘ã‹ã‹ã‚‹ã‹ã‚‰ã‚„ã‚‰ãªã„ã¨æ€ã†ï¼ˆã‚ˆã£ã¦ä½¿ã‚ãªã„ï¼‰**\r\n- Dynamic Intent Filter\r\n- Wi-FiçµŒç”±ã®ADB\r\n    - ã‚«ã‚¹ROMã«ã¯å‰ã‹ã‚‰ã‚ã‚‹ã£ã¦ï¼Ÿ\r\n    - å…¬å¼ã§å¯¾å¿œãªã‚“ã§ã™ã‚ˆï¼ï¼ï¼\r\n- Bubble\r\n    - **ä»–ã®ã‚¢ãƒ—ãƒªã«é‡ã­ã¦è¡¨ç¤º**ãŒå¹´ã€…å³ã—ããªã£ã¦ã‚‹ã®ã§ï¼ˆæœ€è¿‘ã€è¨­å®šã‚¢ãƒ—ãƒªã®ä¸Šã«è¡¨ç¤ºã§ããªããªã£ãŸï¼‰ä»£æ›¿ã€‚\r\n    - ãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—å†ç”Ÿã®ä»£æ›¿ã«ã¯ãªã‚‰ãªãã†ã€‚ã‚ãã¾ã§ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªå‘ã‘ãªã®ã‹ãªã€‚\r\n\r\n## Android 11 Betaå…¥ã‚Œã‚ˆã†ã¨ã—ã¦ã„ã‚‹å„ä½\r\nGoogle Pay ä½¿ãˆãªããªã‚‹ã‚‰ã—ã„ã‚ˆã€‚DP4ã®æ®µéšã§ã¯ä½¿ãˆãŸã‚“ã ã‘ã©ã¾ãŸä½¿ãˆãªããªã£ãŸã€‚  \r\n![Imgur](https://imgur.com/r914HON.png)  \r\nSuicaä½¿ãˆã‚‹ã‚“ã‹ãªï¼Ÿ  \r\n\r\n# Device Control API ã‚’è©¦ã™\r\n**ã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ãªã‚“ã¦ã™ã‚‹äºˆå®šãªã‘ã©**ã›ã£ã‹ãBetaç‰ˆã®ç™»å ´ã¨ä¸€ç·’ã«APIãŒæ–‡æ›¸åŒ–ã•ã‚Œã¦ã‚‹ã®ã§è©¦ã—ã«è¿½åŠ ã—ã¦ã¿ã‚‹ã€‚\r\n\r\n[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://developer.android.com/preview/features/device-control)\r\n\r\n# ç’°å¢ƒ\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|è¨€èª|Kotlin|\r\n|Android|11 Beta 1|\r\n|ç«¯æœ«|Pixel 3 XL|\r\n\r\n## Android R Betaã®ç’°å¢ƒã‚’æƒãˆã¾ã™ã€‚\r\nSDK Manageré–‹ã„ã¦ã€SDK Platformsã‚¿ãƒ–ã‚’æŠ¼ã—ã¦ã€**Android 10.0+(R)**ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦**Apply**æŠ¼ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n# build.gradle\r\n## ãƒãƒ¼ã‚¸ãƒ§ãƒ³\r\n```gradle\r\nandroid {\r\n    compileSdkVersion 30\r\n    buildToolsVersion \"29.0.3\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.devicecontrolstest\"\r\n        minSdkVersion 30\r\n        targetSdkVersion 30\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`compileSdkVersion 30`ã¨`targetSdkVersion 30`ã«ãªã£ã¦ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚å¤šåˆ†\r\n\r\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã„ã‚Œã‚‹\r\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒRxJavaå…¥ã‚Œã¦ã‚‹ã“ã¨ã‚’å‰æã«ã—ã¦ã„ã‚‹ã®ã§ç§ã‚‚å…¥ã‚Œã¾ã™ã€‚  \r\nRxJavaãªã‚“ã¦ä½¿ã£ãŸã“ã¨ãªã„ã‚“ã ã‘ã©ã­ã€‚\r\n```gradle\r\ndependencies {\r\n    implementation 'org.reactivestreams:reactive-streams:1.0.3'\r\n    implementation 'io.reactivex.rxjava2:rxjava:2.2.0'\r\n}\r\n```\r\n\r\n# AndroidManifestæ›¸ã\r\nãŠã¾ã˜ãªã„ã§ã™ã€‚\r\n```xml\r\n<service\r\n    android:name=\".DeviceControlsService\"\r\n    android:label=\"@string/app_name\"\r\n    android:permission=\"android.permission.BIND_CONTROLS\">\r\n    <intent-filter>\r\n        <action android:name=\"android.service.controls.ControlsProviderService\" />\r\n    </intent-filter>\r\n</service>\r\n```\r\n\r\n# DeviceControlsService ã£ã¦ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ä½œæˆ\r\n`DeviceControlsService.kt`ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nä½œæˆã—ãŸã‚‰ã€`ControlsProviderService()`ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚\r\n```kotlin\r\nclass DeviceControlsService : ControlsProviderService() {\r\n    override fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n\r\n    }\r\n\r\n    override fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n\r\n    }\r\n\r\n    override fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n\r\n    }\r\n}\r\n```\r\n\r\nã§ã‚‚ã“ã®ã¾ã¾ã ã¨è¿”ã‚Šå€¤ãªã«ã‚‚ãªã„ã®ã§IDEãŒèµ¤ã„ãªã¿ãªã¿å‡ºã™ã®ã§ä»Šã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\r\n\r\n## åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’ç”¨æ„ã™ã‚‹\r\nã“ã‚Œã‹ã‚‰è¿½åŠ å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚  \r\nã“ã“ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã¶ã‚ã‘ã§ã™ã­ã€‚  \r\n`createPublisherForAllAvailable()`ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚\r\n```kotlin\r\n// è¿½åŠ ã™ã‚‹ãƒ‡ãƒã‚¤ã‚¹ã®ID\r\nval TOGGLE_BUTTON_ID = \"toggle_button_id\"\r\n/**\r\n * è¿½åŠ å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ã€‚\r\n * */\r\noverride fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸæ™‚ã«è¡¨ç¤ºã™ã‚‹Activity\r\n    val intent = Intent(baseContext, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getActivity(baseContext, 10, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    // ã¾ã¨ã‚ã¦ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’è¿½åŠ ã™ã‚‹ã®ã§é…åˆ—ã«\r\n    val controlList = mutableListOf<Control>()\r\n    // ON/OFFã‚µãƒ³ãƒ—ãƒ«ã€‚\r\n    val toggleControl = Control.StatelessBuilder(TOGGLE_BUTTON_ID, pendingIntent)\r\n        .setTitle(\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n        .setSubtitle(\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n        .setDeviceType(DeviceTypes.TYPE_LIGHT) // ã‚ã„ã“ã‚“ã¨ã„ã‚ã®è¨­å®šã€‚\r\n        .build()\r\n    // é…åˆ—ã«è¿½åŠ \r\n    controlList.add(toggleControl)\r\n    // Reactive Streamsã®çŸ¥è­˜ãŒå¿…è¦ãªæ¨¡æ§˜ã€‚ç§ã«ã¯ãªã„ã®ã§ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ”ãƒšã™ã‚‹ã€‚\r\n    return FlowAdapters.toFlowPublisher(Flowable.fromIterable(controlList))\r\n}\r\n```\r\n\r\nã‚³ãƒ¡ãƒ³ãƒˆæ–‡ã¯å„è‡ªæ¶ˆã—ã¦ã­ã€‚  \r\n### æ³¨æ„\r\nã“ã“ã§ä½¿ã†`Control`ã¯`Control.StatelessBuilder`ã®æ–¹ã§ã™ã€‚  \r\nã“ã‚Œã¯ã¾ã çŠ¶æ…‹ãŒï¼ˆã‚¹ã‚¤ãƒƒãƒãŒONã¨ã‹OFFã¨ã‹ã£ã¦è©±ï¼‰ãŒåˆ†ã‹ã‚‰ãªã„æ™‚ã«ä½¿ã†ã¨ã‹æ›¸ã„ã¦ã‚ã‚‹ã‘ã©å¤šåˆ†ã“ã®æ™‚ã«ä½¿ã„ã¾ã™ã€‚\r\n\r\n## ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹\r\n`åˆ©ç”¨å¯èƒ½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã®ä¸€è¦§ã‚’ç”¨æ„ã™ã‚‹`ã§é¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ“ä½œã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nlateinit var updatePublisher: ReplayProcessor<Control>\r\n/**\r\n * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸ã‚“ã ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’ç”¨æ„ã™ã‚‹\r\n * é›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã§ã‚ˆã°ã‚Œã‚‹\r\n * */\r\noverride fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹Activity\r\n    val intent = Intent(baseContext, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getActivity(baseContext, 12, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    // çŸ¥è­˜ä¸è¶³ã§ã‚ã‹ã‚‰ã‚“\r\n    updatePublisher = ReplayProcessor.create()\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼\r\n    if(p0.contains(TOGGLE_BUTTON_ID)) {\r\n        // ON/OFF\r\n        val toggle = ToggleTemplate(\"toggle_template\", ControlButton(false, \"OFFã§ã™ã­ãˆï¼\"))\r\n        // ã“ã“ã§ä½œã‚‹Controlã¯ StatefulBuilder ã‚’ä½¿ã†ã€‚\r\n        val control = Control.StatefulBuilder(TOGGLE_BUTTON_ID, pendingIntent)\r\n            .setTitle(\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n            .setSubtitle(\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n            .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n            .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\n            .setControlTemplate(toggle) // ä»Šå›ã¯ON/OFFãƒœã‚¿ãƒ³\r\n            .build()\r\n        updatePublisher.onNext(control)\r\n    }\r\n    return FlowAdapters.toFlowPublisher(updatePublisher)\r\n}\r\n```\r\n\r\nã“ã‚Œã§ã‚¨ãƒ©ãƒ¼ã¯ä¸€å¿œæ¶ˆãˆã‚‹ã®ã§ã€æ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\r\n\r\n# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼è¿½åŠ \r\né›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã™ã‚‹ã¨ã€**ãƒ‡ãƒã‚¤ã‚¹ ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«**ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€æŠ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  \r\næŠ¼ã™ã¨ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒæä¾›ã•ã‚Œã¦ã„ã‚‹ã‚¢ãƒ—ãƒªä¸€è¦§ç”»é¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ä»Šä½œã£ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚’é¸ã³ã¾ã—ã‚‡ã†ã€‚  \r\nã™ã‚‹ã¨ã€ã•ã£ãä½œã£ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒç¾ã‚Œã‚‹ã®ã§ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã€å³ä¸‹ã®ä¿å­˜ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚  \r\n\r\n![Imgur](https://imgur.com/r2Wyog1.png)\r\n\r\nã™ã‚‹ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€‚  \r\nã§ã™ãŒã“ã®æ®µéšã§ã¯æŠ¼ã—ã¦ã‚‚ãªã«ã‚‚å¤‰ã‚ã‚‰ãªã„ã®ã§ã“ã‚Œã‹ã‚‰æŠ¼ã—ãŸæ™‚ã«`ON/OFF`ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹å‡¦ç†ã‚’æ›¸ã„ã¦ã„ããŸã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã¡ãªã¿ã«ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§Android 11å‹•ã‹ã™ã®ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒé•·ã‹ã£ãŸã€‚\r\n\r\n# ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†\r\næŠ¼ã—ãŸæ™‚ã«ON/OFFã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n```kotlin\r\n/**\r\n * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’æŠ¼ã—ãŸã¨ã\r\n * */\r\noverride fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã«è¡¨ç¤ºã™ã‚‹Activity\r\n    val intent = Intent(baseContext, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getActivity(baseContext, 11, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    // ã‚·ã‚¹ãƒ†ãƒ ã«å‡¦ç†ä¸­ã¨ãŠã—ãˆã‚‹\r\n    p2.accept(ControlAction.RESPONSE_OK)\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼åˆ†å²\r\n    when (p0) {\r\n        TOGGLE_BUTTON_ID -> {\r\n            // ON/OFFåˆ‡ã‚Šæ›¿ãˆ\r\n            // ToggleTemplate ã¯ BooleanAction\r\n            if (p1 is BooleanAction) {\r\n                // ONã‹ã©ã†ã‹\r\n                val isOn = p1.newState\r\n                val message = if (isOn) \"ONã§ã™\" else \"OFFã§ã™\"\r\n                val toggle = ToggleTemplate(\"toggle_template\", ControlButton(isOn, message))\r\n                // Controlæ›´æ–°\r\n                val control = Control.StatefulBuilder(TOGGLE_BUTTON_ID, pendingIntent)\r\n                    .setTitle(\"ON/OFFã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n                    .setSubtitle(\"ãŠã™ã¨ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n                    .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n                    .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\n                    .setControlTemplate(toggle) // ä»Šå›ã¯ON/OFFãƒœã‚¿ãƒ³\r\n                    .setStatusText(message)\r\n                    .build()\r\n                updatePublisher.onNext(control)\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§æŠ¼ã—ãŸæ™‚ã«ON/OFFãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  \r\n`DeviceType#TYPE_LIGHT`è¦‹ãŸç›®ã„ã„æ„Ÿã˜ã€‚  \r\nã‚¹ãƒãƒ¼ãƒˆãƒ›ãƒ¼ãƒ ã‚„ã£ã¦ã¿ãŸã„ï¼ˆé‡‘ãªã„ã‘ã©ï¼‰\r\n\r\n![Imgur](https://imgur.com/2TNFYZz.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚https://github.com/takusan23/DeviceControlsTest\r\n\r\n~~ãã‚Œã¨**æœ¬å½“**ã¯ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ï¼ˆå€¤ã‚’èª¿æ•´ã§ãã‚‹`RangeTemplate`ã¦ã‚„ã¤ï¼‰ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ãŒã‚ã£ãŸã‚“ã§ã™ã‘ã©ã€ç§ã®ç’°å¢ƒã§ã¯ã†ã¾ãå‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚Betaç‰ˆã ã‹ã‚‰ãªã®ã‹ãã‚‚ãã‚‚ç§ãŒé–“é•ã£ã¦ã‚‹ã®ã‹ï¼Ÿ~~\r\n\r\n**RangeTemplate**å‹•ãã¾ã—ãŸã€‚[å‚è€ƒã«ã—ã¾ã—ãŸ](https://gist.github.com/KieronQuinn/c9950f3ee09e11f305ce16e7f48f03b8)\r\n\r\n```kotlin\r\nval sliderControl = Control.StatefulBuilder(SLIDER_BUTTON_ID, pendingIntent)\r\n    .setTitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n    .setSubtitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n    .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n    .setControlId(SLIDER_BUTTON_ID)\r\n    .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\nsliderControl.setControlTemplate(\r\n    ToggleRangeTemplate(\r\n        \"slider_template\",\r\n        ControlButton(true, \"slider_button\"),\r\n        RangeTemplate(\"range\", 0f, 10f, 1f, 1f, null)\r\n    )\r\n)\r\nupdatePublisher.onNext(sliderControl.build())\r\n```\r\n\r\nperformControlAction()ã¯ã“ã†ã§ã™ã€‚\r\n\r\n```kotlin\r\n// ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼\r\n// RangeTemplate ã¯ FloatAction\r\nif (p1 is FloatAction) {\r\n    // ç¾åœ¨ã®å€¤\r\n    val currentValue = p1.newValue\r\n    val sliderControl = Control.StatefulBuilder(SLIDER_BUTTON_ID, pendingIntent)\r\n        .setTitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚µãƒ³ãƒ—ãƒ«\") // ãŸã„ã¨ã‚‹\r\n        .setSubtitle(\"ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã§ã™ã€‚\") // ã‚µãƒ–ã‚¿ã‚¤ãƒˆãƒ«\r\n        .setDeviceType(DeviceTypes.TYPE_LIGHT) // å¤šåˆ†ã‚¢ã‚¤ã‚³ãƒ³ã«ä½¿ã‚ã‚Œã¦ã‚‹ï¼Ÿ\r\n        .setControlId(SLIDER_BUTTON_ID)\r\n        .setStatus(Control.STATUS_OK) // ç¾åœ¨ã®çŠ¶æ…‹\r\n    val controlButton = ControlButton(true, \"slider_button\")\r\n    sliderControl.setControlTemplate(\r\n        ToggleRangeTemplate(\r\n            \"slider_template\",\r\n            controlButton,\r\n            RangeTemplate(\"range\", 0f, 10f, currentValue, 1f, null)\r\n        )\r\n    )\r\n    updatePublisher.onNext(sliderControl.build())\r\n}\r\n```\r\n\r\n\r\nã‚ã¨`DeviceType`ãŒã„ã£ã±ã„ã‚ã‚‹ã®ã§å…¨ç¨®é¡ã‚¢ã‚¤ã‚³ãƒ³ã¨è‰²ã‚’è¦‹ã¦ã¿ãŸã„ã€‚ã‚„ã£ã¦ã¿ã‚‹ã‹ã€‚\r\n\r\nã‚„ã‚Šã¾ã—ãŸâ†’ https://github.com/takusan23/DeviceControlAllDeviceTypeSample\r\n\r\n\r\nDynamic Intent Filterã‚‚ã‚„ã‚ŠãŸã„"},{"title":"Hello Android11ã€‚Device Controlç·¨","link":"/posts/android11_release_devicecontrol/","markdown":"\r\nAndroid 11ã®æ­£å¼ç‰ˆãŒå‡ºã¾ã—ãŸã­ã€‚ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™  \r\nè‡ªå·±PR ã¨ é•·æ‰€çŸ­æ‰€ ã£ã¦é•ã†ã®ã‹\r\n\r\n# Device Control #ã¨ã¯\r\nå®¶é›»æ“ä½œç”¨ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šãƒ‘ãƒãƒ«ã€‚é›»æºé•·æŠ¼ã—ã§é–‹ã‘ã‚‹ã€‚  \r\n\r\n![Imgur](https://imgur.com/w0IUBYW.png)\r\n\r\nâ†‘ã“ã‚“ãªã‚„ã¤ã€‚\r\n\r\nãªãŠã€**Reactive Stream**ãŒä½•ãªã®ã‹ã‚ã‹ã‚‰ã‚“ã®ã§ãã“ã¯ã‚³ãƒ”ãƒšã§é ¼ã‚€\r\n\r\n# ç’°å¢ƒ\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|Android|11|\r\n|è¨€èª|Kotlin|\r\n\r\n\r\n# ã¤ãã‚‹\r\nå…¬å¼ã®è§£èª¬ã§ã™ï¼šhttps://developer.android.com/guide/topics/ui/device-control\r\n\r\n## Android Manifest\r\nã‚µãƒ¼ãƒ“ã‚¹ã‚’å®£è¨€ã—ã¾ã™ã€‚  \r\n`android:label`ãŒãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªä¸€è¦§ã«è¡¨ç¤ºã•ã‚Œã‚‹åå‰ã ã£ã¦~~ï¼ˆèª°ã‚‚æ•™ãˆã¦ãã‚Œãªã„Androidï¼‰~~\r\n\r\n```xml\r\n<!-- Device Control ã®ã‚µãƒ¼ãƒ“ã‚¹ -->\r\n<service android:name=\"DeviceControlService\" android:label=\"ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚µãƒ³ãƒ—ãƒ«\"\r\n    android:permission=\"android.permission.BIND_CONTROLS\">\r\n    <intent-filter>\r\n        <action android:name=\"android.service.controls.ControlsProviderService\" />\r\n    </intent-filter>\r\n</service>\r\n```\r\n\r\n## DeviceControlService.kt\r\nã‚’ä½œæˆã—ã¾ã™ã€‚\r\n\r\nã§ããŸã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«`ControlsProviderService`ã‚’ç¶™æ‰¿ã•ã›ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/** ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚µãƒ¼ãƒ“ã‚¹ */\r\nclass DeviceControlService :ControlsProviderService(){\r\n\r\n    /** åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯ã“ã“ã§ */\r\n    override fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n\r\n    }\r\n\r\n    /** å®Ÿéš›ã«ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆã¯ã“ã“ */\r\n    override fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n\r\n    }\r\n\r\n    /** ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æ“ä½œã—ãŸã¨ãã¯ã“ã“ */\r\n    override fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹é–¢æ•°ã‚’ä½œã‚‹\r\nä»Šå›ã¯å€¤ã®å¤‰æ›´ãŒã§ãã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ï¼ˆ`RangeTemplate`ï¼‰ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nãªãŠä»Šå›ã¯å€¤ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã—ã¾ã™ãŒæœ¬æ¥ã¯\r\n- createPublisherForAllAvailable()\r\n    - ã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¡¨ç¤º\r\n    - ã®ã§å€¤ã¯é©å½“ã§ã‚‚ã„ã„\r\n- createPublisherFor()\r\n    - ã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå®Ÿéš›ã«æ“ä½œã™ã‚‹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¡¨ç¤º\r\n    - ã‚ˆã£ã¦å€¤ã¯ã¡ã‚ƒã‚“ã¨å…¥ã‚Œã¦ãŠã‹ãªã„ã¨ã„ã‘ãªã„\r\n\r\n```kotlin\r\n/**\r\n * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¿”ã™é–¢æ•°\r\n * @param floatValue ã‚·ãƒ¼ã‚¯ã‚’é€²ã‚ã‚‹å ´åˆã¯å…¥ã‚Œã¦ãã ã•ã„\r\n * */\r\nprivate fun createControl(floatValue: Float = 0f): Control {\r\n    // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã®ã‚¤ãƒ³ãƒ†ãƒ³ãƒˆ\r\n    val intent = Intent(this, MainActivity::class.java)\r\n    val pendingIntent =\r\n        PendingIntent.getBroadcast(this, 4545, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n    return Control.StatefulBuilder(\"sample_control\", pendingIntent).apply {\r\n        setTitle(\"ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆ\")\r\n        setSubtitle(\"ãƒªãƒ“ãƒ³ã‚°\")\r\n        setDeviceType(DeviceTypes.TYPE_LIGHT)\r\n        setStatus(Control.STATUS_OK)\r\n        // å€¤ã‚’èª¿æ•´ã§ãã‚‹ã‚ˆã†ã«\r\n        setControlTemplate(RangeTemplate(\"sample_range\", 0f, 10f, floatValue, 1f, \"%.0f\"))\r\n    }.build()\r\n}\r\n```\r\n\r\n## createPublisherForAllAvailable()\r\nã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ©ç”¨å¯èƒ½ãªã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¡¨ç¤ºã•ã›ã‚‹ã¨ãã«å‘¼ã°ã‚Œã‚‹ã€‚  \r\nè©³ã—ããªã„ã®ã§ã‚³ãƒ”ãƒš\r\n\r\n```kotlin\r\n/** åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯ã“ã“ã§ */\r\noverride fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n    val control = createControl(0f)\r\n    return Flow.Publisher { subscriber ->\r\n        subscriber.onNext(control)\r\n        subscriber.onComplete()\r\n    }\r\n}\r\n```\r\n\r\n## createPublisherFor()\r\nã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé¸æŠã—ãŸã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã‚‹æ™‚ã«å‘¼ã°ã‚Œã¾ã™ï¼Ÿ  \r\né›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—ã§è¡¨ç¤ºã•ã›ãŸã¨ãã§ã™ã­ã€‚\r\n\r\n```kotlin\r\n/** Controlã®æ“ä½œã«ä½¿ã† */\r\nprivate lateinit var subscriber: Flow.Subscriber<in Control>\r\n/** å®Ÿéš›ã«ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆã¯ã“ã“ */\r\noverride fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n    // ã“ã“ã§å€¤ã‚’å–å¾—ã™ã‚‹ãªã‚Šã™ã‚‹ã€‚ä»Šå›ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆ\r\n    val control = createControl(0f)\r\n    return Flow.Publisher<Control> {\r\n        subscriber = it\r\n        it.onSubscribe(object : Flow.Subscription {\r\n            override fun request(p0: Long) {\r\n            }\r\n            override fun cancel() {\r\n            }\r\n        })\r\n        it.onNext(control)\r\n    }\r\n}\r\n```\r\n\r\n## performControlAction()\r\nã“ã“ã§ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æ“ä½œã—ãŸæ™‚ã«å‘¼ã°ã‚Œã¾ã™ã€‚  \r\n`RangeTemplate`ã®å€¤ã¯ç¬¬äºŒå¼•æ•°ã‚’`FloatAction`ã§ã‚­ãƒ£ã‚¹ãƒˆã™ã‚Œã°å–å¾—ã§ãã¾ã™ã€‚  \r\n\r\n```kotlin\r\n/** ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æ“ä½œã—ãŸã¨ãã¯ã“ã“ */\r\noverride fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n    // ã‚·ã‚¹ãƒ†ãƒ ã«å‡¦ç†ä¸­ã¨ãŠã—ãˆã‚‹\r\n    p2.accept(ControlAction.RESPONSE_OK)\r\n    if (p1 is FloatAction) {\r\n        val control = createControl(p1.newValue)\r\n        subscriber.onNext(control)\r\n    }\r\n}\r\n```\r\n\r\nã§ããŸã‚‰å®Ÿè¡Œã—ã¦ã€é›»æºãƒœã‚¿ãƒ³é•·æŠ¼ã—â†’ï¸™â†’ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¿½åŠ ã¸é€²ã¿ã€  \r\nè¿½åŠ ã—ã¦ã¿ã¦ãã ã•ã„ã€‚\r\n\r\nè¿½åŠ ã™ã‚‹ã¨ã“ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/1aE1SX4.png)\r\n\r\nãŠç–²ã‚Œæ§˜ã§ã™ã€‚8888888888\r\n\r\n# å…¨éƒ¨ãã£ã¤ã‘ãŸã‚³ãƒ¼ãƒ‰\r\n\r\n```kotlin\r\n/** ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã®ã‚µãƒ¼ãƒ“ã‚¹ */\r\nclass DeviceControlService : ControlsProviderService() {\r\n\r\n    /** åˆ©ç”¨å¯èƒ½ãªãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã¯ã“ã“ã§ */\r\n    override fun createPublisherForAllAvailable(): Flow.Publisher<Control> {\r\n        val control = createControl(0f)\r\n        return Flow.Publisher { subscriber ->\r\n            subscriber.onNext(control)\r\n            subscriber.onComplete()\r\n        }\r\n    }\r\n\r\n    /** Controlã®æ“ä½œã«ä½¿ã† */\r\n    private lateinit var subscriber: Flow.Subscriber<in Control>\r\n\r\n    /** å®Ÿéš›ã«ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æœ‰åŠ¹ã«ã—ãŸå ´åˆã¯ã“ã“ */\r\n    override fun createPublisherFor(p0: MutableList<String>): Flow.Publisher<Control> {\r\n        // ã“ã“ã§å€¤ã‚’å–å¾—ã™ã‚‹ãªã‚Šã™ã‚‹ã€‚ä»Šå›ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆ\r\n        val control = createControl(0f)\r\n        return Flow.Publisher<Control> {\r\n            subscriber = it\r\n            it.onSubscribe(object : Flow.Subscription {\r\n                override fun request(p0: Long) {\r\n\r\n                }\r\n\r\n                override fun cancel() {\r\n\r\n                }\r\n            })\r\n            it.onNext(control)\r\n        }\r\n    }\r\n\r\n    /** ãƒ‡ãƒã‚¤ã‚¹ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’æ“ä½œã—ãŸã¨ãã¯ã“ã“ */\r\n    override fun performControlAction(p0: String, p1: ControlAction, p2: Consumer<Int>) {\r\n        // ã‚·ã‚¹ãƒ†ãƒ ã«å‡¦ç†ä¸­ã¨ãŠã—ãˆã‚‹\r\n        p2.accept(ControlAction.RESPONSE_OK)\r\n        if (p1 is FloatAction) {\r\n            val control = createControl(p1.newValue)\r\n            subscriber.onNext(control)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’è¿”ã™é–¢æ•°\r\n     * @param floatValue ã‚·ãƒ¼ã‚¯ã‚’é€²ã‚ã‚‹å ´åˆã¯å…¥ã‚Œã¦ãã ã•ã„\r\n     * */\r\n    private fun createControl(floatValue: Float = 0f): Control {\r\n        // ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã‚’é•·æŠ¼ã—ã—ãŸã¨ãã®ã‚¤ãƒ³ãƒ†ãƒ³ãƒˆ\r\n        val intent = Intent(this, MainActivity::class.java)\r\n        val pendingIntent =\r\n            PendingIntent.getBroadcast(this, 4545, intent, PendingIntent.FLAG_UPDATE_CURRENT)\r\n        return Control.StatefulBuilder(\"sample_control\", pendingIntent).apply {\r\n            setTitle(\"ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆ\")\r\n            setSubtitle(\"ãƒªãƒ“ãƒ³ã‚°\")\r\n            setDeviceType(DeviceTypes.TYPE_LIGHT)\r\n            setStatus(Control.STATUS_OK)\r\n            // å€¤ã‚’èª¿æ•´ã§ãã‚‹ã‚ˆã†ã«\r\n            setControlTemplate(RangeTemplate(\"sample_range\", 0f, 10f, floatValue, 1f, \"%.0f\"))\r\n        }.build()\r\n    }\r\n\r\n}\r\n```\r\n\r\nGitHubã§ã™ï¼šhttps://github.com/takusan23/DeviceControlSample\r\n\r\n# ãŠã‚ã‚Šã«\r\nä»Šå›ã®ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚¨ãƒƒã‚°ã®ã‚½ãƒ¼ã‚¹ã¯ã“ã“ï¼Ÿï¼šhttps://github.com/aosp-mirror/platform_frameworks_base/blob/android11-release/packages/EasterEgg/src/com/android/egg/neko/NekoControlsService.kt\r\n\r\nèƒŒé¢ã‚¿ãƒƒãƒ—ã€çµå±€å®Ÿè£…ã•ã‚Œãªã‹ã£ãŸ  "},{"title":"Hello Android 11ã€‚systemUiVisibilityç·¨","link":"/posts/android11_statusbar_hide/","markdown":"\r\nã‚ˆãƒ¼ã“ã`targetSdkVersion 30`ã®ä¸–ç•Œã¸\r\n\r\n# æœ¬é¡Œ\r\nActivityã‚’å…¨ç”»é¢ã«ã—ãŸã‚Šã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä¸€æ™‚çš„ã«æ¶ˆã™ã¨ãã«`window?.decorView?.systemUiVisibility`ãŒAndroid 11ã‹ã‚‰éæ¨å¥¨ã«ãªã£ãŸ  \r\nä»£ã‚ã‚Šã«`WindowInsetsController`ã‚’ä½¿ã£ã¦æ¶ˆã™ã‚‰ã—ã„ã€‚\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„     |\r\n|---------|------------|\r\n| ç«¯æœ«    | Pixel 3 XL |\r\n| Android | 11 Beta 1  |\r\n\r\n# éè¡¨ç¤ºã®ç¨®é¡\r\n- **ã‚¹ãƒ¯ã‚¤ãƒ—ã™ã‚‹ã“ã¨ã§ä¸€æ™‚çš„ã«ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã€ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã€æ•°ç§’æ“ä½œã—ãªã„ã¨ã¾ãŸè‡ªå‹•ã§å…¨ç”»é¢ã«æˆ»ã‚‹**\r\n    - å‹•ç”»ã‚¢ãƒ—ãƒªã¨ã‹\r\n    - `WindowInsetsController.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE`ã‚’ä½¿ã†ï¼ˆå¾Œè¿°ï¼‰\r\n- **ã‚¹ãƒ¯ã‚¤ãƒ—ã—ã¦ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã‚’è¡¨ç¤ºã•ã›ã‚‹ã‘ã©ãã®ã¾ã¾è¡¨ç¤ºã—ãŸã¾ã¾ã«ãªã‚‹**\r\n    - ã©ã“ã§ä½¿ã£ã¦ã‚‹ã‹ã¯ã‚ã‹ã‚‰ã‚“ãª\r\n    - `WindowInsetsController.BEHAVIOR_SHOW_BARS_BY_SWIPE`ã‚’ä½¿ã†ï¼ˆå¾Œè¿°ï¼‰\r\n\r\n# è¿½è¨˜\r\nAndroid 6 ä»¥é™ãªã‚‰AndroidX(`androix.`ã‹ã‚‰å§‹ã¾ã‚‹ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã€ã‚¯ãƒ©ã‚¹ã®æœ€å¾Œã«`Compat`ãŒã¤ã)ã«ã‚ˆã‚‹ãƒãƒƒã‚¯ãƒãƒ¼ãƒˆãŒã‚ã‚‹ã®ã§ãã‚Œã‚’ä½¿ãˆã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n`WindowInsetsController`ã‚‚Android 11ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸAPIã§ã™ãŒã€`AndroidX`(æ—§ç§°ï¼šã‚µãƒãƒ¼ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª)ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§Android 6ã‹ã‚‰å¯¾å¿œã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚’éè¡¨ç¤ºã«ã™ã‚‹ã€‚\r\n *\r\n * IMEã§æ€ã„å‡ºã—ãŸã€‚Xperiaã®POBox Plusè¿”ã—ã¦ã€‚ã‚ã‚Œä½¿ã„ã‚„ã™ã‹ã£ãŸã®ã«\r\n *\r\n * @param activity Activity\r\n * */\r\nfun hideKeyboard(activity: Activity) {\r\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n        val insetsControllerCompat = WindowInsetsControllerCompat(activity.window, activity.window.decorView)\r\n        insetsControllerCompat.hide(WindowInsetsCompat.Type.ime())\r\n    }\r\n}\r\n```\r\n\r\n# ã¤ãã‚‹\r\n\r\nã‚¹ãƒ¯ã‚¤ãƒ—ã™ã‚‹ã¨ä¸€æ™‚çš„ã«è¡¨ç¤ºã•ã‚Œã‚‹æ–¹  \r\nä¸€æ™‚çš„ã«è¡¨ç¤ºã—ã¦ã„ã‚‹ãƒãƒ¼ã¯åŠé€æ˜ã«ãªã£ã¦ã„ã‚‹ã€‚\r\n\r\n```kotlin\r\nsupportActionBar?.hide()\r\nif (Build.VERSION.SDK_INT >= Build.VERSION_CODES.R) {\r\n    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®å¾Œã‚ã«Viewã‚’æ½œã‚‰ã›ã‚‹ãªã‚‰ã“ã‚Œã‚‚\r\n    window?.setDecorFitsSystemWindows(false)\r\n    // Android 11 ä»¥ä¸Šã¨åˆ†å²\r\n    window?.insetsController?.apply {\r\n        // StatusBar + NavigationBar éè¡¨ç¤º\r\n        hide(WindowInsets.Type.systemBars())\r\n        // ã‚¹ãƒ¯ã‚¤ãƒ—ã§ä¸€æ™‚çš„ã«è¡¨ç¤ºå¯èƒ½\r\n        systemBarsBehavior = WindowInsetsController.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE\r\n        // ãƒãƒƒãƒã«ã‚‚ä¾µç•¥\r\n        window?.attributes?.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\r\n    }\r\n} else {\r\n    // Android 10 ä»¥å‰ã€‚\r\n    window?.decorView?.systemUiVisibility = View.SYSTEM_UI_FLAG_IMMERSIVE_STICKY or View.SYSTEM_UI_FLAG_FULLSCREEN or View.SYSTEM_UI_FLAG_HIDE_NAVIGATION\r\n}\r\n```\r\n\r\nãƒãƒƒãƒã¾ã§ã¯åºƒã’ãªãã¦ã„ã„å ´åˆã¯ã€ãƒãƒƒãƒã«ã‚‚ä¾µç•¥ã®ä¸€è¡Œã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¦ã­ã€‚  \r\n\r\nã‚‚ã—ä¸€æ™‚çš„ã«è¡¨ç¤ºã§ã¯ãªãã€ä¸€å›è¡¨ç¤ºã—ãŸã‚‰ãšã£ã¨å‡ºã£ã±ãªã—ã«ã™ã‚‹éš›ã¯`systemBarsBehavior`ã‚’  \r\n\r\n```kotlin\r\nsystemBarsBehavior = WindowInsetsController.BEHAVIOR_SHOW_BARS_BY_SWIPE\r\n```\r\n\r\nã«ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n`Type#systemBars()`ã‚’ä½¿ã†ã¨ã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã‚’æ¶ˆã—ã¾ã™ãŒã€åˆ¥ã«ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã‚‚å‹•ãã¾ã™ã€‚  \r\n\r\n```kotlin\r\n// ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼\r\nhide(WindowInsets.Type.statusBars())\r\n// ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼\r\nhide(WindowInsets.Type.navigationBars())\r\n```\r\n\r\n# ãŠã¾ã‘\r\nIMEï¼ˆã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®ã“ã¨ï¼‰ã‚‚ã“ã®`WindowInsetsController`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ä¸€è¡Œã§æ¶ˆã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\r\n\r\n```kotlin\r\nwindow?.insetsController?.hide(WindowInsets.Type.ime())\r\n```\r\n\r\nã‚­ãƒ¼ãƒœãƒ¼ãƒ‰éš ã™ã®ãªã‚“ã‹é¢å€’ã ã—æˆåŠŸã—ãŸã“ã¨ãªã„ã‹ã‚‰ã“ã®æ–¹æ³•ãŒä½¿ãˆã‚‹ã®ã¯å¬‰ã—ã„ã€‚ğŸ¥³\r\n"},{"title":"Android 11ã®ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ‡ãƒãƒƒã‚°(Wi-FiçµŒç”±ã®ADB)ãŒå‹•ã‹ãªã„ã®ã‚’ç›´ã™","link":"/posts/android_11_wifi_over_adb_not_working/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚éŠ€è¡Œç³»ã‚¢ãƒ—ãƒªãŒUSBãƒ‡ãƒãƒƒã‚°æœ‰åŠ¹æ™‚ã«èµ·å‹•ã—ãªã„ã®ã‚ã‚“ã©ãã›ãˆ\r\n\r\n# æœ¬é¡Œ\r\nWi-FiçµŒç”±ã®ADBãŒãªã‚“ã‹ã†ã¾ãå‹•ã‹ãªã„ã€‚  \r\nã†ã¾ãã„ãã¨ãã¯ä¸Šæ‰‹ãã„ãã‚“ã ã‘ã©ã­ã€‚ã†ã¾ãå‹•ã‹ãªã„ã¨ãã¯ãšã£ã¨Androidå´ãŒèª­ã¿è¾¼ã‚“ã§ã‚‹ã€‚\r\n\r\n# ç’°å¢ƒ\r\n\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|Android Stuido|Android Studio Arctic Fox | 2020.3.1 Canary 14|\r\n|Windows|10 Pro|\r\n|ã‚¹ãƒãƒ›|Pixel 3 XL(Android 11) / Android 11ã®ã‚«ã‚¹ã‚¿ãƒ ROMæ­è¼‰æ©Ÿ|\r\n\r\n# å¯¾å‡¦ã™ã‚‹\r\nã¾ãš`SDK Manager`ã‚’é–‹ãã€`SDK Tools`ã¸ç§»å‹•ã—ã¦`Android SDK Platform-Tools`ã‚’æ›´æ–°ã—ã¾ã™ã€‚  \r\n\r\næœ¬æ¥ã¯ã“ã‚Œã§åˆ©ç”¨ã§ãã‚‹ã¯ãšãªã‚“ã§ã™ãŒã€ç§ã®å ´åˆã¯ãªãœã‹åˆ©ç”¨ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\r\n\r\n# ADBã®ãƒ‘ã‚¹ã‚’ä¿®æ­£\r\nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã‚‹ã¨ã€`adb pair`ã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã£ã½ã„ã‚“ã§ã™ãŒã€ç§ã®ç’°å¢ƒã§ã‚„ã‚‹ã¨ãªãœã‹å­˜åœ¨ã—ãªã„ã‚“ã§ã™ã­ã€‚  \r\næ›´æ–°ã—ãŸã®ã«\r\n\r\n```\r\nadb pair\r\nadb: usage: unknown command pair\r\n```\r\n\r\nãã®æ¬¡ã«ã€`ADB`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç¢ºèªã—ã‚ˆã†ã¨`adb --version`ã‚’å©ãã¨è¡æ’ƒã®äº‹å®ŸãŒã€‚\r\n\r\n```\r\nadb --version\r\nAndroid Debug Bridge version 1.0.40\r\nVersion 4797878\r\nInstalled as C:\\Program Files (x86)\\Android\\platform-tools\\adb.exe\r\n```\r\n\r\n`adb.exe`ã¯`C:\\Program Files (x86)\\Android\\platform-tools`ã«ã‚ã‚‹ï¼Ÿã‚ã‚Œï¼Ÿ  \r\n`SDK Location`ã¯`AppData\\Local\\Android\\Sdk`ã«è¨­å®šã—ã¦ã‚ã‚‹ã®ã«ï¼Ÿ\r\n\r\n# ç’°å¢ƒå¤‰æ•°ã‚’ç›´ã™\r\nWindowsã®æ¤œç´¢ã‹ã‚‰ç’°å¢ƒå¤‰æ•°ã§èª¿ã¹ã¦ã‚‚ã‚‰ã£ã¦ã‚‚ã„ã„ã§ã™ã—ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ï¼ˆ\"ã‚¹ã‚¿ãƒ¼ãƒˆ\"ã®æ–‡å­—ãŒVistaã‹ã‚‰æ¶ˆãˆã¦ä½•å¹´ãŸã£ãŸï¼Ÿï¼‰ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦`ã‚·ã‚¹ãƒ†ãƒ `ã‚’æŠ¼ã—ã¦ã€`ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°è¨­å®š`ã‚’é¸ã³ã€`ç’°å¢ƒå¤‰æ•°`ã‚’æŠ¼ã—ã¦ã‚‚ã„ã„ã§ã™ã€‚\r\n\r\né–‹ã‘ãŸã‚‰ã€`ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°`ã®æ–¹ã®`Path`ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€\r\n\r\n`C:\\Program Files (x86)\\Android\\platform-tools`ã‚’æ¶ˆã—ã¦\r\n\r\n`C:\\Users\\ãƒ¦ãƒ¼ã‚¶ãƒ¼å\\AppData\\Local\\Android\\Sdk\\platform-tools`ã‚’è¿½åŠ ã—ã¦é–‰ã˜ã¾ã™ã€‚\r\n\r\nãã—ã¦å†èµ·å‹•\r\n\r\nå†èµ·å‹•å¾Œã€ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§`adb --version`ã¨å…¥åŠ›ã—ã¦ã€ãƒ‘ã‚¹ãŒä¿®æ­£ã•ã‚Œã¦ã„ã‚Œã°å®Œäº†ã§ã™ã€‚\r\n\r\n# ã“ã‚Œã§åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãš\r\nå¤šåˆ†ãŠã¾ç’°ã§ã—ã‚‡ã†ãŒä¸€å¿œç½®ã„ã¦ãŠãã¾ã™ã€‚  \r\nã‚ã¨ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ‡ãƒãƒƒã‚°ã‚’ä¸€æ—¦OFFã«ã—ã¦ã¾ãŸONã«ã™ã‚‹ã¨ç›´ã£ãŸã‚Šã™ã‚‹ã‹ã‚‚ã€‚\r\n\r\nä»¥ä¸Šã§ã™ã€‚"},{"title":"Android 12 ã®é›»æ± ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆä½œã£ãŸ","link":"/posts/android_12_battery_widget_make/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n**ï¼ˆã¡ã‚‡ã£ã¨å‰ã ã‘ã©ï¼‰ã¤ã„ã«fengã®ã‚¢ãƒ«ãƒãƒ ã‚’æ‰‹ã«å…¥ã‚Œã¾ã—ãŸã€‚**  \r\nç¥ã€‚  \r\nå†¬è¯ã•ã¾ï½\r\n\r\n![Imgur](https://imgur.com/fiuZ0TW.png)\r\n\r\n# æœ¬é¡Œ\r\n\r\nAndroid 12 ã®ã‚³ãƒ³ã‚»ãƒ—ãƒˆç”»åƒï¼Ÿã«ã‚ã‚‹ã“ã®é›»æ± æ®‹é‡ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆã£ã¦ã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ  \r\nã“ã‚Œã»ã—ã„ã‚“ã ãŒ\r\n\r\n![Imgur](https://imgur.com/BiVH4Zz.png)\r\n\r\n# ä½œã£ãŸ\r\nã‚¹ãƒãƒ›ã®é›»æ± æ®‹é‡ã¨Bluetoothãƒ‡ãƒã‚¤ã‚¹ï¼ˆä¸€å°ã ã‘ï¼‰ã®é›»æ± æ®‹é‡ãŒè¦‹ã‚Œã¾ã™ã€‚  \r\nBluetoothãƒ‡ãƒã‚¤ã‚¹ã®æ–¹ã¯10%åˆ»ã¿ã§ã™ãŒä»•æ§˜ã§ã™ï¼ˆå¾Œè¿°ï¼‰\r\n\r\n![Imgur](https://imgur.com/SAtNPAa.png)\r\n\r\n![Imgur](https://imgur.com/rlr7nd6.png)\r\n\r\nâ†‘ å‹æ„›é€²åŒ–è«–ã®ãƒ•ãƒ«ã‚ã‚ŠãŒã¨ã†feng\r\n\r\n# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\n- PlayStore\r\n    - https://play.google.com/store/apps/details?id=io.github.takusan23.materialbatterywidget\r\n- GitHub\r\n    - https://github.com/takusan23/MaterialBatteryWidget\r\n\r\n## Androidã§Bluetoothãƒ‡ãƒã‚¤ã‚¹ã®é›»æ± æ®‹é‡å–å¾—\r\n(å…¨éƒ¨ã®ãƒ‡ãƒã‚¤ã‚¹ã§ä½¿ãˆã‚‹ã‚ã‘ã˜ã‚ƒãªã„ã¨æ€ã†)\r\n\r\n`BluetoothDevice#getBatteryLevel()`ã£ã¦ã„ã†ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚  \r\nãŒã€`@hide`ã¨`@UnsupportedAppUsage`ãŒä»˜ã„ã¦ã„ã‚‹ãŸã‚æ™®é€šã«ã¯è¦‹ã‚Œã¾ã›ã‚“ã€‚ãŒã€é€†ã«è¨€ãˆã°æˆç´„ã¯ã“ã‚Œã ã‘ãªã®ã§ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§å‘¼ã³å‡ºã›ã¾ã™ã€‚  \r\nå¤‰ã«ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ—ãƒªé™å®šæ¨©é™ã¨ã‹ãªãã¦ã‚ˆã‹ã£ãŸã€‚\r\n\r\n```kotlin\r\nval getBatteryLevelMethod = BluetoothDevice::class.java\r\n            .methods\r\n            .find { it.name == \"getBatteryLevel\" }!!\r\ngetBatteryLevelMethod.invoke(/* BluetoothDevice */)\r\n```\r\n\r\nå®Ÿéš›ã«ãƒšã‚¢ãƒªãƒ³ã‚°ãƒ‡ãƒã‚¤ã‚¹ã‚’å–å¾—ã—ã¦é›»æ± æ®‹é‡ã‚’å–å¾—ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™\r\n\r\n```kotlin\r\nval bluetoothManager = context.getSystemService(Context.BLUETOOTH_SERVICE) as BluetoothManager\r\nif (!bluetoothManager.adapter.isEnabled) return null\r\n\r\n// é›»æ± æ®‹é‡ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãŒ @hide ã§éš ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§å‘¼ã³å‡ºã™\r\nval getBatteryLevelMethod = BluetoothDevice::class.java\r\n    .methods\r\n    .find { it.name == \"getBatteryLevel\" }!!\r\nval deviceList = bluetoothManager.adapter.bondedDevices\r\n    .map { Pair(it.name, getBatteryLevelMethod.invoke(it) as Int) }\r\n    .filter { it.second != -1 }\r\n\r\nreturn deviceList.firstOrNull()\r\n```\r\n\r\nã¡ãªã¿ã«Android 11ä»¥å‰ã¯Bluetoothæ¨©é™ã€Android 12ä»¥é™ã¯`BLUETOOTH_CONNECT`ã¨ã‹ã„ã†ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã§æ¨©é™æ±‚ã‚ã‚‹ç³»ã®æ¨©é™ãŒå¿…è¦ã§ã™ã€‚\r\n\r\n## 10%åˆ»ã¿ã§è¿”ã£ã¦ãã‚‹\r\nå¤šåˆ†ã©ã†ã—ã‚ˆã†ã‚‚ãªã„ã€‚ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒªã®é™ç•Œï¼Ÿ  \r\nã‚¤ãƒ¤ãƒ›ãƒ³ã«ã‚ˆã£ã¦ã¯ç«¯æœ«ã®Bluetoothè¨­å®šç”»é¢ã‹ã‚‰ã¯1%åˆ»ã¿ã®æ®‹é‡ã¨ã‹å……é›»ã‚±ãƒ¼ã‚¹ã®æ®‹é‡ã‚‚å–å¾—ã§ãã¾ã™ãŒã€ã“ã‚Œã¯ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ—ãƒªé™å®šæ¨©é™ã‚’ä½¿ã£ã¦ã„ã‚‹ä¸Šã«  \r\nãã‚‚ãã‚‚æ¨©é™ãŒãªãã¦ã‚‚ã‚·ã‚¹ãƒ†ãƒ ã‚¢ãƒ—ãƒªä»¥å¤–ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã³å‡ºã›ãªã„ã¨ã„ã†äºŒæ®µæ§‹ãˆã§è©°ã‚“ã§ã¾ã™ã€‚~~ã¤ã¾ã‚“ã­ï½~~\r\n\r\nhttps://cs.android.com/android/platform/superproject/+/master:frameworks/base/core/java/android/bluetooth/BluetoothDevice.java;drc=master;l=2808\r\n\r\n```java\r\n@SystemApi\r\n@Nullable\r\n@RequiresPermission(allOf = {\r\n        android.Manifest.permission.BLUETOOTH_CONNECT,\r\n        android.Manifest.permission.BLUETOOTH_PRIVILEGED,\r\n})\r\npublic byte[] getMetadata(@MetadataKey int key) {\r\n```\r\n\r\n## Android 12 ä»¥é™ã¯ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ã«å¯¾å¿œã—ã¦ã„ã¾ã™\r\nãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ã®å€¤ã‚’å–å¾—ã™ã‚‹å ´åˆã¯`@android:color/system_accent*`ç³»ã‚’ä½¿ã†ã¨å–å¾—ã§ãã¾ã™ã€‚  \r\nè©³ã—ãã¯Android 12ã®ã‚¤ãƒ¼ã‚¹ã‚¿ãƒ¼ã‚¨ãƒƒã‚°è¦‹ã¦ä¸‹ã•ã„ã€‚  \r\n\r\nã‚ã¨ã¯ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆå†…ã§ä½¿ã†è‰²ã‚’`color.xml`ã§åˆ‡ã‚Šå‡ºã—ã¦ä½¿ãˆã°ã„ã„ã¨æ€ã„ã¾ã™\r\n\r\n```xml\r\n<!-- values-v31/colors.xml -->\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<resources>\r\n    <!-- ãƒãƒƒãƒ†ãƒªãƒ¼ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¡¨é¢ã®è‰² -->\r\n    <color name=\"battery_color\">@android:color/system_accent1_300</color>\r\n    <!-- ãƒãƒƒãƒ†ãƒªãƒ¼ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®èƒŒé¢ã®è‰² -->\r\n    <color name=\"battery_background_color\">@android:color/system_accent1_200</color>\r\n    <!-- ãƒ†ã‚­ã‚¹ãƒˆã®è‰² -->\r\n    <color name=\"battery_text_color\">@android:color/system_accent1_900</color>\r\n    <!-- ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆã®èƒŒæ™¯è‰² -->\r\n    <color name=\"widget_background_color\">@android:color/system_accent2_100</color>\r\n</resources>\r\n```\r\n\r\n```xml\r\n<!-- values/colors.xml -->\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<resources>\r\n\r\n    <!-- Android 12 ç”¨ã®è‰²ãƒªã‚½ãƒ¼ã‚¹ã¯v31ã®æ–¹å‚ç…§ -->\r\n\r\n    <!-- ãƒãƒƒãƒ†ãƒªãƒ¼ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®è¡¨é¢ã®è‰² -->\r\n    <color name=\"battery_color\">#FFAFCBFB</color>\r\n    <!-- ãƒãƒƒãƒ†ãƒªãƒ¼ã®ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã®èƒŒé¢ã®è‰² -->\r\n    <color name=\"battery_background_color\">#FFE8F0FE</color>\r\n    <!-- ãƒ†ã‚­ã‚¹ãƒˆã®è‰² -->\r\n    <color name=\"battery_text_color\">#FF1B72E8</color>\r\n    <!-- ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆã®èƒŒæ™¯è‰² -->\r\n    <color name=\"widget_background_color\">@color/white</color>\r\n\r\n    <!-- çœç•¥ -->\r\n```\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã“ã®ã‚¢ãƒ«ãƒãƒ ãŒæœ¬å½“ã«fengã®æœ€å¾Œã ã¨æ€ã†ã¨ã¨ã¦ã‚‚æ‚²ã—ã„ã€‚  \r\nãã—ã¦ã‚¨ãƒ­ã‚²æ¿ã®fengã‚¹ãƒ¬ã‚‚è§£æ•£ã‚¹ãƒ¬ã«..."},{"title":"Hello Android 12ã€‚ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç„¡åŠ¹åŒ–ï¼Ÿç·¨","link":"/posts/android_12_disable_splashscreen/","markdown":"ã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚  \r\n\r\n- ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚¬ãƒã‚¢ãƒ³ãƒ\r\n- æ—¢å­˜ã®ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‹ã‚‰ç§»è¡Œã§ããªã„ï¼ˆã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ãªã©ã§ï¼‰\r\n- **é›»è©±ã‚¢ãƒ—ãƒªï¼ˆç‰¹ã«ç€ä¿¡ï¼‰ã€QRã‚³ãƒ¼ãƒ‰ã«é™ã‚‰ãšæ±ºæ¸ˆã‚¢ãƒ—ãƒªã€ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒª ãªã©ã®å¿œç­”æ€§ãŒå¿…è¦ãªã‚¢ãƒ—ãƒª** ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãªã‚“ã¦è¦‹ã›ãªãã¦ã„ã„ã‹ã‚‰æ—©ãèµ·å‹•ã—ã‚ã‚ˆï¼ã€ã¨æ€ã‚ã‚Œã¦ã—ã¾ã†å¯èƒ½æ€§ãŒã‚ã‚‹æ–¹\r\n\r\nãã‚“ãªæ–¹ã¸æ§ã’ã‚‹ã€‚\r\n\r\n# ç­”ãˆ\r\n\r\n**ï¼å…¬å¼ã§æ–‡æ›¸åŒ–ã•ã‚Œã¦ã„ã‚‹ã‚ã‘ã˜ã‚ƒãªã„ã®ã§æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ï¼**\r\n\r\n`AndroidManifest.xml`ã®`<application>`ã‚¿ã‚°ã®`theme`ã«æŒ‡å®šã—ã¦ã„ã‚‹ãƒ†ãƒ¼ãƒã«ã€  \r\n`<item name=\"android:windowIsTranslucent\">true</item>`ã‚’è¿½åŠ ã—ã¦ã€åŠé€æ˜ãªActivityã¨ã—ã¦èªè­˜ã•ã›ã¾ã™ã€‚  \r\nï¼ˆå®Ÿéš›ã«åŠé€æ˜ã«ã™ã‚‹ãŸã‚ã«ã¯ã¾ã æ‰‹ã‚’åŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ã“ã‚Œã‚’è¿½è¨˜ã—ãŸã¨ã“ã‚ã§åŠé€æ˜ã«ã¯ãªã‚‰ãªã„ï¼‰  \r\n\r\nä»¥ä¸‹ä¾‹ã§ã™ã€‚\r\n\r\n`src/main/res/values/themes.xml`\r\n\r\n```xml\r\n<resources xmlns:tools=\"http://schemas.android.com/tools\">\r\n    <!-- Base application theme. -->\r\n    <style name=\"Theme.Android12DisableSplashScreen\" parent=\"Theme.MaterialComponents.DayNight.DarkActionBar\">\r\n        <!-- Primary brand color. -->\r\n        <item name=\"colorPrimary\">@color/purple_500</item>\r\n        <item name=\"colorPrimaryVariant\">@color/purple_700</item>\r\n        <item name=\"colorOnPrimary\">@color/white</item>\r\n        <!-- Secondary brand color. -->\r\n        <item name=\"colorSecondary\">@color/teal_200</item>\r\n        <item name=\"colorSecondaryVariant\">@color/teal_700</item>\r\n        <item name=\"colorOnSecondary\">@color/black</item>\r\n        <!-- Status bar color. -->\r\n        <item name=\"android:statusBarColor\" tools:targetApi=\"l\">?attr/colorPrimaryVariant</item>\r\n        <!-- ã“ã‚Œ -->\r\n        <item name=\"android:windowIsTranslucent\">true</item>\r\n        <!-- Customize your theme here. -->\r\n    </style>\r\n</resources>\r\n```\r\n\r\n## æ—¢å­˜ã®ãƒ†ãƒ¼ãƒ/ Activity ã«å¤‰æ›´å…¥ã‚ŒãŸããªã„ or æ—¢å­˜ã®ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç”¨ActivityãŒã‚ã‚‹å ´åˆã¯\r\n\r\næ–°ã—ãã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’ç„¡åŠ¹ã«ã—ãŸãƒ†ãƒ¼ãƒã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n```xml\r\n<resources xmlns:tools=\"http://schemas.android.com/tools\">\r\n    <!-- Base application theme. -->\r\n    <style name=\"Theme.Android12DisableSplashScreen\" parent=\"Theme.MaterialComponents.DayNight.DarkActionBar\">\r\n        <!-- Primary brand color. -->\r\n        <item name=\"colorPrimary\">@color/purple_500</item>\r\n        <item name=\"colorPrimaryVariant\">@color/purple_700</item>\r\n        <item name=\"colorOnPrimary\">@color/white</item>\r\n        <!-- Secondary brand color. -->\r\n        <item name=\"colorSecondary\">@color/teal_200</item>\r\n        <item name=\"colorSecondaryVariant\">@color/teal_700</item>\r\n        <item name=\"colorOnSecondary\">@color/black</item>\r\n        <!-- Status bar color. -->\r\n        <item name=\"android:statusBarColor\" tools:targetApi=\"l\">?attr/colorPrimaryVariant</item>\r\n        <!-- Customize your theme here. -->\r\n    </style>\r\n\r\n    <!-- ã“ã‚Œ -->\r\n    <style name=\"Theme.DisableSplashScreen\" parent=\"Theme.Android12DisableSplashScreen\">\r\n        <item name=\"android:windowIsTranslucent\">true</item>\r\n    </style>\r\n\r\n</resources>\r\n```\r\n\r\næ¬¡ã«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã—ãŸã¨ãã«`MainActivity`ã®ä»£ã‚ã‚Šã«è¡¨ç¤ºã™ã‚‹`Activity`ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nã‚‚ã†æ—¢ã«ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç”¨ActivityãŒã‚ã‚‹å ´åˆã¯ãã‚Œã‚’ä½¿ã£ã¦ã‚‚ã„ã„ã§ã™ã€‚    \r\nã“ã®Activityã‚’çµŒç”±ã—ã¦`MainActivity`ã‚’è¡¨ç¤ºã•ã›ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass TransparentActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        startActivity(Intent(this, MainActivity::class.java))\r\n        // Intent.FLAG_ACTIVITY_CLEAR_TASK or Intent.FLAG_ACTIVITY_NEW_TASK ã¯ä½¿ãˆãªã„\r\n        finish()\r\n\r\n    }\r\n}\r\n```\r\n\r\nãã—ãŸã‚‰ã€`AndroidManifest`ã‚’ã“ã†ã§ã™\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    package=\"io.github.takusan23.android12disablesplashscreen\">\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.Android12DisableSplashScreen\">\r\n        \r\n        <activity\r\n            android:name=\".TransparentActivity\"\r\n            android:exported=\"true\"\r\n            android:theme=\"@style/Theme.DisableSplashScreen\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n        \r\n        <activity\r\n            android:name=\".MainActivity\"\r\n            android:exported=\"true\" />\r\n        \r\n    </application>\r\n\r\n</manifest>\r\n```\r\n\r\n## ãã®ä»–ã€ãªã«ã‚‚ãªã„ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã§ã”ã¾ã‹ã™ç·¨\r\n\r\nå‰æ›¸ã„ãŸã®ã§ãã£ã¡è¦‹ã¦ãã ã•ã„ï¼š [Hello Android 12ã€‚ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç·¨](/posts/android_12_splashscreen/)\r\n\r\n# ãªã‚“ã§æ¶ˆã›ã‚‹ã®ï¼Ÿ\r\n`AOSP`è¿½ã„ã‹ã‘ã¾ã™ã€‚Code Searchã§ã‚‚ãƒ–ãƒ©ãƒ³ãƒ`android-12.0.0-r1`ãŒé¸ã¹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã®ã§èª­ã‚ã¾ã™ã€‚\r\n\r\nå¤šåˆ†é–“é•ãˆã¦ã‚‹ã¨æ€ã†ã‚“ã§ã“ã£ã‹ã‚‰å…ˆèª­ã¾ãªãã¦ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n`Window_windowSplashScreenAnimatedIcon`ã§æ¤œç´¢ã‚’ã‹ã‘ã¾ã™ã€‚`SplashscreenContentDrawer.java`ãŒå¼•ã£ã‹ã‹ã‚Šã¾ã™ã€‚  \r\nã“ã®ã‚¯ãƒ©ã‚¹ã®`createContentView()`ãŒã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’è¿”ã—ã¦ãã†ã§ã™ã­ã€‚ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’èª­ã‚“ã§ã‚‹éƒ¨åˆ†ã‚’æ¢ã—ã¾ã™ã€‚  \r\nâ†“  \r\n`StartingSurfaceDrawer.java`ã®`addSplashScreenStartingWindow()`ãƒ¡ã‚½ãƒƒãƒ‰ã®ä¸­ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚ã§ã‚‚æ¡ä»¶åˆ†å²ã¨ã‹è¦‹ã¦ã‚‚ãã‚Œã£ã½ã„äº‹æ›¸ã„ã¦ãªã„ã§ã™ã­ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’èª­ã‚“ã§ã‚‹éƒ¨åˆ†ã‚’æ¢ã—ã¾ã™ã€‚  \r\nâ†“  \r\n`StartingWindowController.java`ã®`addStartingWindow()`ã®ä¸­ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\nã“ã“ã®`isSplashScreenType()`ã£ã¦ã®ãŒã‚‚ã—ã‹ã—ãŸã‚‰...!ã£ã¦æ€ã„ã¾ã—ãŸãŒã€é•ã†ã¿ãŸã„ã§ã™ã€‚ãã‚Œã˜ã‚ƒã©ã£ã‹ã‚‰å‘¼ã°ã‚Œã¦ã‚‹ã‹æ¢ã—ã¾ã™ã€‚  \r\nâ†“  \r\nå¤šåˆ†`ShellTaskOrganizer.java`ã®`addStartingWindow()`ã§ã™ã‹ã­ã€‚  \r\nãã—ã¦ã“ã‚Œã¯  \r\nâ†“  \r\n`TaskOrganizer.java`ã®`ITaskOrganizer`ã®`addStartingWindow()`ã§å‘¼ã‚“ã§ã¾ã™ã€‚é–“é•ã£ã¦ã‚‹ã‹ã‚‚ã—ã‚Œã‚“ã€‚  \r\nãã—ã¦\r\nâ†“  \r\n`TaskOrganizerController.java`ã®`TaskOrganizerCallbacks`ã®`addStartingWindow()`ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚ã“ã“ã«`theme`ãŒãªã‚“ã¨ã‹ã£ã¦æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒå¤šåˆ†é•ã„ã¾ã™ã€‚  \r\nãã¦ã—ã¦ã“ã‚Œã¯  \r\nâ†“  \r\n`TaskOrganizerController.java`ã®`TaskOrganizerState`ã®`addStartingWindow()`ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\nãã—ã¦  \r\nâ†“  \r\n`TaskOrganizerController.java`ã®`TaskOrganizerController`ã®`addStartingWindow()`ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\nãã‚Œã£ã½ã„ã“ã¨ã¯æ›¸ã„ã¦ãªã„ãªã‚ã¨ã„ã†ã‚ã‘ã§èª­ã‚“ã§ã‚‹éƒ¨åˆ†ã‚’æ¢ã—  \r\nâ†“  \r\n`StartingSurfaceController.java`ã®`createSplashScreenStatingSurface()`ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\nããƒ¼ã—ãƒ¼ã¦ãƒ¼  \r\nâ†“  \r\n`SplashScreenStartingData.java`ã®`createStartingSurface()`ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\nãã‚ãã‚çµ‚ã‚ã‚Šã‹ãªï¼Ÿ  \r\nâ†“  \r\n`ActivityRecord.java`ã®`AddStartingWindow`ã®`run()`ã®ä¸­ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\nãã‚Œã£ã½ã„å‡¦ç†ã¯ãªã„ã®ã§èª­ã‚“ã§ã‚‹éƒ¨åˆ†ã‚’æ¢ã—ã¾ã™  \r\nâ†“  \r\n`ActivityRecord.java`ã§`AddStartingWindow`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆã—ã¦ã‚‹ã¿ãŸã„ã§ã™ã€‚  \r\nâ†“  \r\n`ActivityRecord.java`ã®`scheduleAddStartingWindow()`ã§`AddStartingWindow`ã«ã‚ã‚‹`run()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã‚“ã§ã‚‹ã¿ãŸã„ã§ã™ã€‚  \r\nâ†“  \r\n`ActivityRecord.java`ã®`addStartingWindow()`ã«ã€ãã‚Œã£ã½ã„è¨˜è¿°ãŒã‚ã‚Šã¾ã™ã‚ˆï¼Ÿ  \r\n\r\n```java\r\n// Original theme can be 0 if developer doesn't request any theme. So if resolved theme is 0\r\n// but original theme is not 0, means this package doesn't want a starting window.\r\nif (resolvedTheme == 0 && theme != 0) {\r\n    return false;\r\n}\r\n```\r\n\r\n`resolvedTheme`ã¨`theme`ãŒæ°—ã«ãªã‚Šã¾ã™ã®ã§ã‚‚ã†å°‘ã—èª­ã¿é€²ã‚ã¦ã¿ã‚‹ã€‚  \r\nâ†“  \r\n`ActivityRecord.java`ã®`showStartingWindow()`ã§å‘¼ã‚“ã§ã¾ã™ã­ã€‚  \r\n\r\n```java\r\nfinal int resolvedTheme = evaluateStartingWindowTheme(prev, packageName, theme, splashScreenTheme);\r\n```\r\n\r\n`evaluateStartingWindowTheme()`ã‚’è¦‹ã‚‹ã€‚\r\n\r\n```java\r\n    /**\r\n     * Evaluate the theme for a starting window.\r\n     * @param prev Previous activity which may have a starting window.\r\n     * @param originalTheme The original theme which read from activity or application.\r\n     * @param replaceTheme The replace theme which requested from starter.\r\n     * @return Resolved theme.\r\n     */\r\n    private int evaluateStartingWindowTheme(ActivityRecord prev, String pkg, int originalTheme, int replaceTheme) {\r\n    // Skip if the package doesn't want a starting window.\r\n    if (!validateStartingWindowTheme(prev, pkg, originalTheme)) {\r\n        return 0;\r\n    }\r\n\r\n    // çœç•¥\r\n```\r\n\r\n`validateStartingWindowTheme()`ãŒæ°—ã«ãªã‚‹  \r\n\r\nâ†“  \r\n\r\n```java\r\nprivate boolean validateStartingWindowTheme(ActivityRecord prev, String pkg, int theme) {\r\n    // If this is a translucent window, then don't show a starting window -- the current\r\n    // effect (a full-screen opaque starting window that fades away to the real contents\r\n    // when it is ready) does not work for this.\r\n    if (com.android.server.wm.ProtoLogCache.WM_DEBUG_STARTING_WINDOW_enabled) { long protoLogParam0 = theme; com.android.internal.protolog.ProtoLogImpl.v(WM_DEBUG_STARTING_WINDOW, -1782453012, 1, null, protoLogParam0); }\r\n    if (theme == 0) {\r\n        return false;\r\n    }\r\n    final AttributeCache.Entry ent = AttributeCache.instance().get(pkg, theme,\r\n            com.android.internal.R.styleable.Window, mWmService.mCurrentUserId);\r\n    if (ent == null) {\r\n        // Whoops!  App doesn't exist. Um. Okay. We'll just pretend like we didn't\r\n        // see that.\r\n        return false;\r\n    }\r\n    final boolean windowIsTranslucent = ent.array.getBoolean(\r\n            com.android.internal.R.styleable.Window_windowIsTranslucent, false);\r\n    final boolean windowIsFloating = ent.array.getBoolean(\r\n            com.android.internal.R.styleable.Window_windowIsFloating, false);\r\n    final boolean windowShowWallpaper = ent.array.getBoolean(\r\n            com.android.internal.R.styleable.Window_windowShowWallpaper, false);\r\n    final boolean windowDisableStarting = ent.array.getBoolean(\r\n            com.android.internal.R.styleable.Window_windowDisablePreview, false);\r\n    if (com.android.server.wm.ProtoLogCache.WM_DEBUG_STARTING_WINDOW_enabled) { String protoLogParam0 = String.valueOf(windowIsTranslucent); String protoLogParam1 = String.valueOf(windowIsFloating); String protoLogParam2 = String.valueOf(windowShowWallpaper); String protoLogParam3 = String.valueOf(windowDisableStarting); com.android.internal.protolog.ProtoLogImpl.v(WM_DEBUG_STARTING_WINDOW, -124316973, 0, null, protoLogParam0, protoLogParam1, protoLogParam2, protoLogParam3); }\r\n\r\n    // If this activity is launched from system surface, ignore windowDisableStarting\r\n    if (windowIsTranslucent || windowIsFloating) {\r\n        return false;\r\n    }\r\n```\r\n\r\nè¦‹ã¤ã‘ãŸãï¼ï¼ï¼\r\n\r\n`if (windowIsTranslucent || windowIsFloating)` â† å¤šåˆ†ã“ã“ãŒ true ãŒã«ãªã£ã¦ã“ã®é–¢æ•°ã®è¿”ã‚Šå€¤ãŒfalseã«ãªã‚‹ã€‚\r\n"},{"title":"å›½å†…ç‰ˆPixel 3 XLã«Android 12 DPã‚’å…¥ã‚Œã‚‹","link":"/posts/android_12_dp_hitobashira/","markdown":"\nPixel 3ã‚·ãƒªãƒ¼ã‚ºã§é©ç”¨ã§ãã‚‹æœ€å¾Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‹ãª[^1]\n\n# æœ¬é¡Œ\nAndroid 12 DP1 ãŒå…¬é–‹ã•ã‚ŒãŸã®ã§ã€å›½å†…ç‰ˆPixel 3 XLã«å…¥ã‚Œã¦è¦‹ã‚‹ãŠè©±ã§ã™ã€‚  \n\n# æ³¨æ„\nä»Šã§ã¦ã‚‹ãƒ™ãƒ¼ã‚¿ç‰ˆã¯`Developer Preview (DP)`ã§é–‹ç™ºè€…å‘ã‘ã§ã™ã€‚ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®`Beta`ã§ã¯ãªã„ã§ã™ã€‚  \n`Developer Preview`ã§ã¯ã€`Beta`ç‰ˆã¨é•ã„ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚¢ãƒ—ãƒªçµŒç”±ã®æä¾›ãŒã‚ã‚Šã¾ã›ã‚“ã®ã§ãƒ‘ã‚½ã‚³ãƒ³ãŒå¿…è¦ã§ã™ã€‚\n\n\nãªãŠ`Beta`ç‰ˆãŒå§‹ã¾ã‚‹ã¨ã“ã“ã‹ã‚‰ç«¯æœ«ã®ç™»éŒ²ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \nhttps://www.google.com/android/beta?hl=ja\n\n# ç’°å¢ƒ\n|ãªã¾ãˆ|ã‚ãŸã„|\n|---|---|\n|ç«¯æœ«|Pixel 3 XL (docomoã§è³¼å…¥)|\n|Android|Android 11|\n|PC|Windows 10 Pro / ADBã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ¸ˆã¿ï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€PowerShellç­‰ã§`adb`ã£ã¦å…¥åŠ›ã—ã¦è‹±èªã®èª¬æ˜ãŒè¿”ã£ã¦ãã‚Œã°ãŠï½‹ï¼‰|\n\nadbã¯å„è‡ªã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¨ã„ã¦ãã ã•ã„ï¼ˆç§ã¯Android Studioå…¥ã‚Œã¦ã‚ã‚‹ã®ã§ã“ã“ã§ã¯çœç•¥ï¼‰\n\n# ã‚„ã‚‹å‰ã«\nãƒ‡ãƒ¼ã‚¿ãŒãªããªã‚‹ã®ã§ãªããªã£ãŸã‚‰å›°ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯é€ƒã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚  \n(LINEã¨ã‹ã­ã“ã‚ã¤ã‚ã¨ã‹)  \nãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½ãŒç„¡ã„ã‚¢ãƒ—ãƒªã¯ã€`adb`ãŒã‚ã‚Œã°ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãŒã§ãã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚  \nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å(ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã¨ã‚‚è¨€ã†ï¼Ÿ)ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã¿ãŸã„ãªã‚„ã¤ã§ã€ä¸€éƒ¨ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã¯è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã¨æ€ã„ã¾ã™\n```\nadb backup ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å\n```\n\n# ã‚„ã‚Šã‹ãŸ\nå¤šåˆ†äºŒé€šã‚Šã‚ã‚Šã¾ã™ã€‚`adb sideload`ã§`OTA`ã‚’é©ç”¨ã™ã‚‹æ–¹æ³•ã¨ã€ãƒ‡ãƒ¼ã‚¿ã‚’å…¨éƒ¨æ¶ˆã—ã¦ï¼ˆå·¥å ´å‡ºè·çŠ¶æ…‹ï¼‰`Android Flash Tool`ã‚’ä½¿ã†æ–¹æ³•ï¼ˆ`fastboot`ï¼‰ã§ã™ã­ã€‚\n\n||OTA|Android Flash Tool|\n|---|---|---|\n|ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ã‚¢ãƒ³ãƒ­ãƒƒã‚¯ãŒå¿…è¦|â˜“|â—‹|\n|ãƒ‡ãƒ¼ã‚¿ã‚’æ®‹ã—ã¦ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¯èƒ½|â—‹|â˜“|\n\nä»Šå›ã¯`OTA`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ©ç”¨ã—ã¦ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ã¿ã¾ã™ã€‚\n\n# OTAãƒ•ã‚¡ã‚¤ãƒ«ã‚’é©ç”¨\n\n## OTAãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\nhttps://developer.android.com/about/versions/12/download-ota  \nã“ã£ã‹ã‚‰è‡ªåˆ†ã®æŒã£ã¦ã‚‹æ©Ÿç¨®ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚  \nSHA-256ã‚’ç¢ºèªã—ãŸã„å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’PowerShellã«å…¥ã‚Œã‚‹ã¨ç¢ºèªã§ãã¾ã™ã€‚(Windowsä»¥å¤–ã¯ã—ã‚‰ã‚“)\n\n```\nCertUtil -hashfile <ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸzipãƒ•ã‚¡ã‚¤ãƒ«> SHA256\n```\n\n## USBãƒ‡ãƒãƒƒã‚°ã‚’æœ‰åŠ¹ã«\næ™®æ®µã‚¢ãƒ—ãƒªé–‹ç™ºã‚’ã—ã¦ã„ã‚Œã°æœ‰åŠ¹ã«ãªã£ã¦ã‚‹ã¨æ€ã„ã¾ã™ãŒã€`USBãƒ‡ãƒãƒƒã‚°`ã‚’æœ‰åŠ¹ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \nã‚‚ã—éŠ€è¡Œç³»ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ãŸã‚ã«OFFã«ã—ã¦ã„ã‚‹å ´åˆã¯ã‚‚ã†ä¸€åº¦ONã«ã—ã¦ãã ã•ã„ã€‚  \n\n## PCã¨ã¤ãªã\nUSBãƒ‡ãƒãƒƒã‚°ã‚’è¨±å¯ã™ã‚‹ã‹èã‹ã‚ŒãŸã‚‰è¨±å¯ã—ã¦ãã ã•ã„ã€‚  \nã§ããŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’PowerShellç­‰ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\n\n```\nadb reboot recovery\n```\n\nã™ã‚‹ã¨ã‚¹ãƒãƒ›ãŒæš—ããªã£ã¦ãƒ‰ãƒ­ã‚¤ãƒ‰å›ãŒå€’ã‚Œã¦ã‚‹ç”»é¢ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚OLEDãã‚Œã„\n\nã“ã®ç”»é¢ã«ãªã£ãŸã‚‰é›»æºãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãªãŒã‚‰éŸ³é‡ã‚¢ãƒƒãƒ—ã‚­ãƒ¼ã‚’æŠ¼ã—ã¾ã™ã€‚ã™ã‚‹ã¨ä¸Šã«`Android Recovery`ã¨æ›¸ã‹ã‚ŒãŸç”»é¢ã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚  \n\nã“ã‚“ãªã®\n\n```\nAndroid Recovery\ngoogle/crosshatch/crosshatch\n11\nuser/release-keys\nUse volume up/down and power.\n-----------------------------------------\nReboot system now\nReboot to bootloader\nEnter fastboot\nApply update from ADB\nApply update from SD card\nWipe data/factory reset\nMound /system\nView recocvery logs\nRun graphics test\nRun locale test\nPower off\n```\n\n## Apply update from ADB\nã‚’éŸ³é‡ã‚­ãƒ¼ã‚’ä½¿ã„é¸ã³ã€é›»æºãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚ã§ããŸã‚‰PowerShellã§ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™\n\n```\nadb sideload <ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸzipãƒ•ã‚¡ã‚¤ãƒ«>\n```\nã‚ã¨ã¯å¾…ã¡ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/kevfdt6.png)\n\nçµ‚ã‚ã£ãŸã‚‰ã€ã•ã£ãã®ç”»é¢ã«æˆ»ã‚‹ã®ã§ã€ä¸€ç•ªä¸Šã®`Reboot system now`ã‚’é¸ã¹ã°ãŠï½‹ã§ã™ã€‚\n\n![Imgur](https://imgur.com/ZtGTSLG.png)\n\nãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã•ãšã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ããŸã€‚\n\n# ã‚¢ãƒ—ãƒªã®ç”Ÿå­˜ç¢ºèª\n- Google Pay\n    - èµ·å‹•ã§ããŸ\n- ãŠã‚µã‚¤ãƒ•ã‚±ãƒ¼ã‚¿ã‚¤\n    - èµ·å‹•ã§ããŸ\n- ãƒ¢ãƒã‚¤ãƒ«Suica\n    - èµ·å‹•ã§ããŸ\n- COCOA\n    - èµ·å‹•ã§ããŸ\n- Kyash\n    - èµ·å‹•ã§ããŸ\n- SMBC\n    - èµ·å‹•ã§ããŸ\n\nä½•ãŒèµ·å‹•ã§ããªã„ã‚“ã ã‚\n\n# ãŠã‚ã‚Šã«\né€šçŸ¥ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹é€Ÿåº¦ãŒä¸ŠãŒã£ã¦ã‚€ã—ã‚Android 11ã®ã¨ãã‚ˆã‚Šå‹•ããŒã„ã„æ°—ãŒã™ã‚‹\n\n[^1]: Pixel 2ã‚·ãƒªãƒ¼ã‚ºãŒ11ã§çµ‚ã‚ã£ã¦ã‚‹ã®ã§å¤šåˆ†ãã†"},{"title":"Hello Android12ã€‚RenderEffectç·¨","link":"/posts/android_12_dp_render_effect_api/","markdown":"ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã£ã¦åŠé€æ˜ã¨ã‹ã¼ã‹ã—ã¨ã‹ã‚„ã‚‰ãªã„ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚ã‚‹\r\n\r\n# æœ¬é¡Œ\r\n\r\n`Android 12 DP2`ã«ã€Viewã‚’ã¼ã‹ã—ãŸã‚Šã§ãã‚‹`RenderEffect API`ãŒè¿½åŠ ã•ã‚ŒãŸã®ã§è©¦ã—ã¦ã¿ã‚‹\r\n\r\n![Imgur](https://imgur.com/aW11fUG.png)\r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„     |\r\n|---------|------------|\r\n| Android | 12 DP2     |\r\n| ç«¯æœ«    | Pixel 3 XL |\r\n\r\n## ãƒãƒ¼ã‚¸ãƒ§ãƒ³\r\nAndroid 12ãªç’°å¢ƒãŒå¿…è¦ã§ã™ã€‚  \r\n`SDK Manager`ã‹ã‚‰`Android S Preview`ã‚’å…¥ã‚Œã¦ãŠã„ã¦ãã ã•ã„ã€‚  \r\n\r\nã¾ãŸã€build.gradleã¯ä»¥ä¸‹ã®ã‚ˆã†ã«\r\n\r\n```gradle\r\nandroid {\r\n    compileSdkVersion \"android-S\"\r\n    buildToolsVersion \"30.0.3\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.android12blur\"\r\n        minSdkVersion \"S\"\r\n        targetSdkVersion \"S\"\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n    \r\n    // çœç•¥\r\n}\r\n```\r\n\r\n## activity_main.xml\r\nå¥½ããªViewã‚’ç½®ã‘ã°ã„ã„ã§ã™\r\n\r\n## MainActivity.kt\r\n`View#setRenderEffect()`ã‚’å‘¼ã¹ã°ãŠk\r\n\r\n```kotlin\r\nimageView.post {\r\n    imageView.setRenderEffect(RenderEffect.createBlurEffect(10f, 10f, Shader.TileMode.CLAMP))\r\n}\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\nGitHubã«ã‚³ãƒ¼ãƒ‰ä¸Šã’ã¨ãã¾ã—ãŸ\r\n\r\nhttps://github.com/takusan23/Android12Blur"},{"title":"Hello Android12ã€‚ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ç·¨","link":"/posts/android_12_foreground_service/","markdown":"\nãŠä¸€äººæ§˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œã£ã¦ã¿ãŸã„ï¼ˆã‚¿ã‚¤ãƒˆãƒ«å…¨ç„¶é–¢ä¿‚ãªãã¦ã‚ã‚Œï¼‰\n\n# æœ¬é¡Œ\n`Context#startForegroundService()`ã«åˆ¶é™ãŒè¿½åŠ ã•ã‚ŒãŸæ¨¡æ§˜ã€‚  \nã®ã§æ¤œè¨¼ã—ã¦ã¿ã‚‹\n\n# ç’°å¢ƒ\n|ãªã¾ãˆ|ã‚ãŸã„|\n|---|---|\n|Android|12 DP 1|\n|ã‚¹ãƒãƒ›|Pixel 3 XL|\n\n# ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®é–‹å§‹åˆ¶é™ #ã¨ã¯\nã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ãªçŠ¶æ…‹ã®æ™‚ã«`Context#startForegroundService()`ãŒå‘¼ã¹ãªããªã£ãŸæ¨¡æ§˜ã€‚  \n\n## ã‚¢ãƒ—ãƒªãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ ã®å®šç¾©\nã©ã®çŠ¶æ…‹ã®ã“ã¨ã‚’è¨€ã£ã¦ã„ã‚‹ã®ã‹ã¨ã„ã†ã¨ã“ã“ã«æ›¸ã„ã¦ã‚ã‚‹â†’ https://developer.android.com/guide/background#definition\n\n\n# ç¢ºã‹ã‚ã‚‹\n\nAndroid 12 ã‚’å¯¾è±¡ã«ã—ã¾ã™\n\n`app/build.gradle`\n\n```gradle\nandroid {\n    compileSdkVersion \"android-S\"\n    buildToolsVersion \"30.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.backgroundstartforegroundservice\"\n        minSdkVersion \"S\"\n        targetSdkVersion \"S\"\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n```\n\n## AndroidManifest.xml\n\nãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹åˆ©ç”¨æ¨©é™ãŒå¿…è¦ã§ã™ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¨©é™ä¸¦ã«æ›¸ãå¿˜ã‚Œã‚‹ã‚„ã¤ï¼‰\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    package=\"io.github.takusan23.backgroundstartforegroundservice\">\n\n    <uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n\n    <application\n        android:allowBackup=\"true\"\n        android:icon=\"@mipmap/ic_launcher\"\n        android:label=\"@string/app_name\"\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\n        android:supportsRtl=\"true\"\n        android:theme=\"@style/Theme.BackgroundStartForegroundService\">\n\n        <service android:name=\".ExampleService\" />\n\n        <activity\n            android:name=\".MainActivity\"\n            android:exported=\"true\">\n            <intent-filter>\n                <action android:name=\"android.intent.action.MAIN\" />\n\n                <category android:name=\"android.intent.category.LAUNCHER\" />\n            </intent-filter>\n        </activity>\n    </application>\n\n</manifest>\n```\n\n## MainActivity.kt\n\nã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã ã‘ã€‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã«è¡Œã£ãŸã“ã¨ã‚’æ¤œçŸ¥ã™ã‚‹ãŸã‚`onStop()`ã«æ›¸ã\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n    }\n\n    /** ãƒãƒƒã‚°ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰åˆ¤å®š */\n    override fun onStop() {\n        super.onStop()\n        Toast.makeText(this, \"onStop\", Toast.LENGTH_SHORT).show()\n        Timer().schedule(5000) {\n            runOnUiThread {\n                Toast.makeText(this@MainActivity, \"Start service\", Toast.LENGTH_SHORT).show()\n                startForegroundService(Intent(this@MainActivity, ExampleService::class.java))\n            }\n        }\n    }\n}\n```\n\n## ExampleService.kt\n\nç‰¹ã«ä½•ã‚‚ã—ã¾ã›ã‚“ãŒ\n\n```kotlin\nclass ExampleService : Service() {\n\n    /** é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«è¿½åŠ ã§ä½¿ã† */\n    private val notificationManager by lazy { getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager }\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n        postNotification()\n        return START_NOT_STICKY\n    }\n\n    override fun onBind(p0: Intent?): IBinder? {\n        return null\n    }\n\n    /** ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰é–‹å§‹ */\n    private fun postNotification() {\n        val notificationChannelId = \"test_notification\"\n        if (notificationManager.getNotificationChannel(notificationChannelId) == null) {\n            // é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ç™»éŒ²\n            val channel = NotificationChannel(notificationChannelId, \"é€šçŸ¥ãƒ†ã‚¹ãƒˆ\", NotificationManager.IMPORTANCE_LOW)\n            notificationManager.createNotificationChannel(channel)\n        }\n        val notification = Notification.Builder(this, notificationChannelId).apply {\n            setContentTitle(\"ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­\")\n            setContentText(\"ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ãƒ†ã‚¹ãƒˆ\")\n            setSmallIcon(R.drawable.ic_outline_textsms_24)\n        }.build()\n        startForeground(1, notification)\n    }\n\n}\n```\n\n# å®Ÿè¡Œã—ã¦ã¿ã‚‹\n\nèµ·å‹•ã™ã‚‹â†’ã‚¢ãƒ—ãƒªã‹ã‚‰é›¢ã‚Œã‚‹â†’5ç§’å¾…ã¤ã¨ï¼Ÿ\n\n```\njava.lang.IllegalStateException: startForegroundService() not allowed due to mAllowStartForeground false: service io.github.takusan23.backgroundstartforegroundservice/.ExampleService\n```\n\nèµ·å‹•ã—ãªã„ã€‚ã‚ã¨é€šçŸ¥ã‚‚é£›ã‚“ã§ãã‚‹\n\n![Imgur](https://imgur.com/lM5rVxJ.png)\n\n# ãã®ä»–ã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®ä»•æ§˜å¤‰æ›´\n`Context#startForeground()`ã‚’å‘¼ã‚“ã§ã‚‚10ç§’é–“ã¯é€šçŸ¥ã‚’å‡ºã•ãšã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã—ã¦ãŠã‘ã‚‹ã‚‰ã—ã„ã€‚  \nãŸã ã—ã€ä»¥ä¸‹ã®æ¡ä»¶ã«ä¸€å€‹ã§ã‚‚å½“ã¦ã¯ã¾ã‚‹ã¨ã™ãã«é€šçŸ¥ãŒå‡ºã‚‹ã‚ˆã†ã«ãªã‚‹ã€‚\n\n- é€šçŸ¥ã«ãƒœã‚¿ãƒ³ãŒã‚ã‚‹\n\n```kotlin\nval notification = Notification.Builder(this, notificationChannelId).apply {\n    setContentTitle(\"ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­\")\n    setContentText(\"ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ãƒ†ã‚¹ãƒˆ\")\n    setSmallIcon(R.drawable.ic_outline_textsms_24)\n    addAction(Notification.Action.Builder(Icon.createWithResource(this@ExampleService, R.drawable.ic_outline_textsms_24), \"ãƒœã‚¿ãƒ³\", null).build())\n}.build()\n```\n\n- `foregroundServiceType`ãŒ`connectedDevice`ã€`mediaPlayback`ã€`mediaProjection`ã€`phoneCall` ã®ã¨ã\n\n```xml\n<service android:name=\".ExampleService\" android:foregroundServiceType=\"mediaProjection\" />\n```\n\n- é€šçŸ¥ä½œæˆæ™‚ã« ~~setShowForegroundImmediately(true)~~ `setForegroundServiceBehavior(Notification.FOREGROUND_SERVICE_IMMEDIATE)`ã‚’æŒ‡å®šã—ãŸ\n\n```kotlin\nval notification = Notification.Builder(this, notificationChannelId).apply {\n    setContentTitle(\"ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­\")\n    setContentText(\"ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ãƒ†ã‚¹ãƒˆ\")\n    setSmallIcon(R.drawable.ic_outline_textsms_24)\n    setForegroundServiceBehavior(Notification.FOREGROUND_SERVICE_IMMEDIATE) // ã“ã‚Œ\n}.build()\n```\n\nã“ã‚Œã«å½“ã¦ã¯ã¾ã‚‰ãªã‘ã‚Œã°`Service#startForeground()`ã‚’å‘¼ã‚“ã å¾Œ10ç§’é–“ã¯é€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œãšã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®Ÿè¡Œã§ãã¾ã™\n\n# ãŠã‚ã‚Šã«\né–“é•ã£ã¦ãŸã‚‰ã™ã„ã¾ã›ã‚“\n\n`startActivity()`ã®åˆ¶é™ã®æ¬¡ã¯`startForegroundService()`ãŒã‚„ã‚‰ã‚Œã‚‹ã®ã‹"},{"title":"Hello Android12ã€‚Material You ç·¨","link":"/posts/android_12_material_you/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã“ã®é’ç©ºã«ç´„æŸã‚’â€• æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\n\r\n![Imgur](https://imgur.com/pbgKYnB.png)\r\n\r\nã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°æ›²èã„ã¦æ°—ã«ãªã£ã¦ãŸã®ã§ã‚„ã‚Šã¾ã—ãŸã€‚  \r\næµ·å·±ã¡ã‚ƒã‚“ãƒ«ãƒ¼ãƒˆã‚’æœ€å¾Œã«ã¨ã£ã¦ãŠã„ã¦ã‚ˆã‹ã£ãŸã€‚çµã°ã‚Œã‚‹ã¾ã§ã®ãŠè©±ãŒå¥½ãã€‚  \r\né™ã¡ã‚ƒã‚“åˆè¦‹æ™‚ã¯ã“ã®å­ã‚‚æ”»ç•¥ã™ã‚‹ã®ï¼Ÿã¨ã‹æ€ã£ã¦ã¾ã—ãŸãŒã‚¨ãƒ”ãƒ­ãƒ¼ã‚°ã®æˆé•·ã—ãŸå§¿ã¿ã¦åçœã—ã¾ã—ãŸã™ã„ã¾ã›ã‚“ã€‚\r\n\r\nã“ã‚Œã‹ã‚‰ã‚„ã‚‹æ–¹ã¯Win8å¯¾å¿œã®æ–°è£…ç‰ˆã‚’è²·ãˆã°ã„ã„ã§ã™ã€‚Win10ã§å‹•ä½œç¢ºèªæ¸ˆã§ã™ã€‚DLç‰ˆ(Fanza)ãªã‚‰å°‘ã—å®‰ãè²·ãˆã‚‹ï¼Ÿ\r\n\r\nã‚ã¨æˆ¯ç”»ã¯ã‚¤ãƒ™ãƒ³ãƒˆãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚‹ã®ãŒã„ã„ã­ã€‚ã‚»ãƒ¼ãƒ–æ ã‚’ã‚»ãƒ¼ãƒ–ã—ã¦ãŠã‘ã‚‹â†ï¼Ÿï¼Ÿï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\n`material-components-android`ãŒ`1.5.0-alpha03`ã‹ã‚‰`M3 (Material 3)`ã«å¯¾å¿œã—ãŸæ¨¡æ§˜ã€‚  \r\nã¤ã„ã«Material Youï¼ˆå‹•çš„ãƒ†ãƒ¼ãƒï¼‰å¯¾å¿œï¼ï¼ï¼\r\n\r\n# Material You #ã¨ã¯\r\niãƒ¢ãƒ¼ãƒ‰ã‚±ãƒ¼ã‚¿ã‚¤ã®ç€ã›æ›¿ãˆãƒ„ãƒ¼ãƒ«ã¿ãŸã„ãªã‚„ã¤ã€‚ä»Šã®æ‰€ã€è‰²ã ã‘ï¼ŸãŒè‡ªç”±ã«æ±ºã‚ã‚‰ã‚Œã‚‹ã€‚  \r\n\r\n# Monet #ã¨ã¯\r\nå£ç´™ã‹ã‚‰Material Youã§ä½¿ã†å–ã‚Šå‡ºã™ã‚·ã‚¹ãƒ†ãƒ ï¼Ÿã®ã¯ãšã€‚`Android 12 Beta 4`ã‹ã‚‰ãƒ©ã‚¤ãƒ–å£ç´™ã§ã‚‚å‹•ããã†ãªã€‚  \r\n\r\n## æ‚²å ±ï¼Ÿ\r\næ®‹å¿µãªãŒã‚‰Android 11ï¼Ÿ10ï¼Ÿã«ã‚ã£ãŸã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´æ©Ÿèƒ½ã€ã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³ã®èƒŒæ™¯ã®å¤‰å½¢æ©Ÿèƒ½ã¯ä»Šã®æ‰€å‰Šé™¤ã•ã‚ŒãŸã¾ã¾ã§ã™ã€‚  \r\nå¾©æ´»ã—ã¦ã»ã—ã„ã€‚\r\n\r\n# ã¤ãã‚‹\r\n\r\n# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\r\n\r\nhttps://github.com/material-components/material-components-android/blob/master/docs/theming/Color.md#using-dynamic-colors\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„    |\r\n|---------|-----------|\r\n| Android | 12 Beta 4 |\r\n| Pixel   | 3 XL      |\r\n\r\n## compileSdkVersion ã‚’ 31 ã«ã™ã‚‹\r\n\r\n`app/build.gradle`ã‚’é–‹ã„ã¦ã€`compileSdk`ã‚’31ã«å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\nandroid {\r\n    compileSdk 31 // ã“ã“\r\n\r\n    defaultConfig {\r\n        // çœç•¥\r\n```\r\n\r\næ¬¡ã«ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    implementation 'com.google.android.material:material:1.5.0-alpha03'\r\n    implementation 'androidx.core:core-ktx:1.6.0' // è¿½åŠ æ¸ˆã¿ã®å ´åˆã¯ã„ã‚‰ãªã„\r\n\r\n    // ä»¥ä¸‹çœç•¥\r\n}\r\n```\r\n\r\nã“ã“ã‹ã‚‰å…ˆã¯ä»¥ä¸‹ã®é¸æŠãŒã§ãã¾ã™ã€‚\r\n\r\n- ã™ã¹ã¦ã®ç”»é¢ã§å‹•çš„ãƒ†ãƒ¼ãƒã‚’åˆ©ç”¨ã™ã‚‹\r\n- æŒ‡å®šã—ãŸActivityã®ã¿ã«å‹•çš„ãƒ†ãƒ¼ãƒã‚’å½“ã¦ã‚‹\r\n- æŒ‡å®šã—ãŸFragmentã®ã¿ã«å‹•çš„ãƒ†ãƒ¼ãƒã‚’å½“ã¦ã‚‹\r\n- å‹•çš„ã«ä½œã£ãŸViewã«å‹•çš„ãƒ†ãƒ¼ãƒã‚’å½“ã¦ã‚‹\r\n\r\n## ã™ã¹ã¦ã®ç”»é¢ã§å‹•çš„ãƒ†ãƒ¼ãƒã‚’åˆ©ç”¨ã™ã‚‹å ´åˆ\r\nã¾ãšã€`Application`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n/** ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹ */\r\nclass MainApplication : Application() {\r\n    \r\n    override fun onCreate() {\r\n        super.onCreate()\r\n        // å‹•çš„ãƒ†ãƒ¼ãƒæœ‰åŠ¹åŒ–\r\n        DynamicColors.applyToActivitiesIfAvailable(this)\r\n    }\r\n    \r\n}\r\n```\r\n\r\n`AndroidManifest.xml`ã‚’é–‹ãã€`android:theme`ã‚’`@style/Theme.Material3.DayNight`(ã‚‚ã—ãã¯`@style/Theme.Material3.DayNight`ã‚’ç¶™æ‰¿ã—ãŸãƒ†ãƒ¼ãƒ)ã«å¤‰æ›´ã—ã¦ã€  \r\n`android:name=\".MainApplication\"`ã‚’è¿½åŠ ã—ã¾ã™\r\n\r\n```xml\r\n<application\r\n    android:allowBackup=\"true\"\r\n    android:icon=\"@mipmap/ic_launcher\"\r\n    android:label=\"@string/app_name\"\r\n    android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n    android:supportsRtl=\"true\"\r\n    android:name=\".MainApplication\"\r\n    android:theme=\"@style/Theme.Material3.DayNight\"> \r\n```\r\n\r\nãã—ãŸã‚‰ã€`activity_main.xml`ã«ã„ãã¤ã‹Viewã‚’ç½®ã„ã¦æ¬¡ä¸–ä»£ã®ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã‚’ä½“é¨“ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <Button\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"10dp\"\r\n        android:text=\"Button\" />\r\n\r\n    <Button\r\n        style=\"@style/Widget.Material3.Button.OutlinedButton\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"10dp\"\r\n        android:text=\"Outlined Button\" />\r\n\r\n</LinearLayout>\r\n```\r\n\r\n## æŒ‡å®šã—ãŸActivityã®ã¿ã§å‹•çš„ãƒ†ãƒ¼ãƒã‚’åˆ©ç”¨ã™ã‚‹\r\nMaterial Youã‚’Activityã§ä½¿ã†ã€‚\r\n\r\nã“ã®å ´åˆã¯ã€`Application`ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã™ã‚‹æ‰‹é †ã¯ä¸è¦ã§ã€  \r\n`AndroidManifest.xml`ã§ã€å‹•çš„ãƒ†ãƒ¼ãƒã‚’åˆ©ç”¨ã—ãŸã„Activityã®`android:theme`ã‚’`@style/Theme.Material3.DayNight`(ã‚‚ã—ãã¯`@style/Theme.Material3.DayNight`ã‚’ç¶™æ‰¿ã—ãŸãƒ†ãƒ¼ãƒ)ã«å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n```xml\r\n<activity\r\n    android:name=\".MainActivity\"\r\n    android:exported=\"true\"\r\n    android:theme=\"@style/Theme.Material3.DayNight\">\r\n    <intent-filter>\r\n        <action android:name=\"android.intent.action.MAIN\" />\r\n        <category android:name=\"android.intent.category.LAUNCHER\" />\r\n    </intent-filter>\r\n</activity>\r\n```\r\n\r\nã¤ãã«ã€å‹•çš„ãƒ†ãƒ¼ãƒã‚’åˆ©ç”¨ã—ãŸã„Activityã®`setContentView()`ã®å‰ã«ã€ä¸€è¡Œæ›¸ãè¶³ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        \r\n        // setContentView() ã®å‰ã«å‘¼ã¶\r\n        DynamicColors.applyIfAvailable(this)\r\n        \r\n        setContentView(R.layout.activity_main)\r\n        \r\n    }\r\n}\r\n```\r\n\r\nã‚ã¨ã¯ã€`activity_main.xml`ã«Viewã‚’ç½®ãã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <Button\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"10dp\"\r\n        android:text=\"Button\" />\r\n\r\n    <Button\r\n        style=\"@style/Widget.Material3.Button.OutlinedButton\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"10dp\"\r\n        android:text=\"Outlined Button\" />\r\n\r\n</LinearLayout>\r\n```\r\n\r\n## Fragmentã«å‹•çš„ãƒ†ãƒ¼ãƒã‚’é©ç”¨ã™ã‚‹\r\nMaterial Youã‚’Fragmentã§ä½¿ã†ã€‚\r\n\r\nFragmentã¨ã‹ã§éƒ¨åˆ†çš„ã«ä½¿ã†éš›ã«ä¾¿åˆ©ãªã‚“ã ã‚ã†ã‘ã©ã€Googleæ›°ãç°¡å˜ã§ã¯ãªã„ã‚‰ã—ã„ã€‚  \r\nå¤šåˆ†ã“ã‚“ãªæ„Ÿã˜ã ã¨æ€ã†ã€‚\r\n\r\n```kotlin\r\nclass MainFragment : Fragment() {\r\n\r\n    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {\r\n        // å‹•çš„ãƒ†ãƒ¼ãƒã‚’é©ç”¨ã—ãŸContext\r\n        val context = DynamicColors.wrapContextIfAvailable(requireContext())\r\n        // å‹•çš„ãƒ†ãƒ¼ãƒã‚’é©ç”¨ã—ãŸContextã‚’ä½¿ã£ãŸLayoutInflaterã‚’ç”Ÿæˆ\r\n        val dynamicColorApplyLayoutInflater = LayoutInflater.from(context)\r\n        return dynamicColorApplyLayoutInflater.inflate(R.layout.fragment_main, container, false)\r\n    }\r\n\r\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\r\n        super.onViewCreated(view, savedInstanceState)\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n`framgnet_main.xml`ã¯ã“ã‚“ãªæ„Ÿã˜ã­ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:layout_width=\"match_parent\"\r\n    android:orientation=\"vertical\"\r\n    android:layout_height=\"match_parent\">\r\n\r\n    <Button\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"10dp\"\r\n        android:text=\"Fragment Button\" />\r\n\r\n    <Button\r\n        style=\"@style/Widget.Material3.Button.OutlinedButton\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_margin=\"10dp\"\r\n        android:text=\"Fragment Outlined Button\" />\r\n\r\n</LinearLayout>\r\n```\r\nã‚ã¨ã¯ã€Fragmentã‚’ç½®ãActivityã®`android:theme`ã‚’`@style/Theme.Material3.DayNight`ã«ã—ã¾ã™ã€‚ãªã‚“ãªã‚‰`setContentView()`ã®å‰ã«`setTheme()`ã—ã¦ã‚‚ã„ã„ã§ã™ã€‚\r\n\r\n`AndroidManifest.xml`\r\n\r\n```xml\r\n<activity\r\n    android:name=\".MainActivity\"\r\n    android:exported=\"true\"\r\n    android:theme=\"@style/Theme.Material3.DayNight\">\r\n    <intent-filter>\r\n        <action android:name=\"android.intent.action.MAIN\" />\r\n        <category android:name=\"android.intent.category.LAUNCHER\" />\r\n    </intent-filter>\r\n</activity>\r\n```\r\n\r\n`MainActivity.kt`\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        setContentView(R.layout.activity_main)\r\n\r\n    }\r\n}\r\n```\r\n\r\n`activity_main.xml`\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:orientation=\"vertical\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <androidx.fragment.app.FragmentContainerView\r\n        android:id=\"@+id/fragmentContainerView\"\r\n        android:name=\"io.github.takusan23.materialyousample.MainFragment\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\" />\r\n\r\n</LinearLayout>\r\n```\r\n\r\n## å‹•çš„ã«ç”Ÿæˆã—ãŸViewã«å‹•çš„ãƒ†ãƒ¼ãƒã‚’é©ç”¨ã™ã‚‹\r\nMaterial Youã‚’Viewã§ä½¿ã†ã€‚\r\n\r\nã“ã®å ´åˆã§ã‚‚ã€`Activity`ã«`android:theme`ã§`@style/Theme.Material3.DayNight`ã‚’æŒ‡å®šã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n`AndroidManifest.xml`\r\n\r\n```xml\r\n<activity\r\n    android:name=\".MainActivity\"\r\n    android:exported=\"true\"\r\n    android:theme=\"@style/Theme.Material3.DayNight\">\r\n    <intent-filter>\r\n        <action android:name=\"android.intent.action.MAIN\" />\r\n        <category android:name=\"android.intent.category.LAUNCHER\" />\r\n    </intent-filter>\r\n</activity>\r\n```\r\n\r\n`View`ã®ç¬¬ä¸€å¼•æ•°ã«æ¸¡ã™`Context`ã«`DynamicColors.wrapContextIfAvailable(context)`ã®æˆ»ã‚Šå€¤ã‚’æŒ‡å®šã—ã¾ã™ã€‚  \r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        val context = DynamicColors.wrapContextIfAvailable(this)\r\n        val dynamicColorButton = MaterialButton(context).apply {\r\n            layoutParams = ViewGroup.LayoutParams(ViewGroup.LayoutParams.WRAP_CONTENT, ViewGroup.LayoutParams.WRAP_CONTENT)\r\n            text = \"å‹•çš„ãƒ†ãƒ¼ãƒ + å‹•çš„ç”ŸæˆView\"\r\n        }\r\n        setContentView(dynamicColorButton)\r\n\r\n    }\r\n}\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\n![Imgur](https://imgur.com/rF6V5LB.png)\r\n\r\nã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™ã­ã€‚\r\n\r\nhttps://github.com/takusan23/MaterialYouSample"},{"title":"Hello Android 12ã€‚ã‚¢ãƒ—ãƒªå±¥æ­´ã‹ã‚‰URLå…±æœ‰æ©Ÿèƒ½","link":"/posts/android_12_recent_screen_share_url/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nç§ã®Pixel 3 XLãã‚“ã€æœ€è¿‘å……é›»ãŒä¸€æ™‚çš„ã«ç„¡åŠ¹ã«ãªã£ã¦ã¾ã™ã§é€²ã¾ãªã„æ™‚ãŒã‚ã‚‹ã‚“ã ã‘ã©å¤§ä¸ˆå¤«ãªã®ã‹ãªã€‚\r\n\r\n# æœ¬é¡Œ\r\nAndroid 12ã‹ã‚‰æœ€è¿‘ã®ã‚¢ãƒ—ãƒªå±¥æ­´ç”»é¢ã‹ã‚‰Webãƒšãƒ¼ã‚¸ã®URLã‚’å…±æœ‰ã§ãã‚‹æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã¦ã€ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«å®Ÿè£…æ–¹æ³•ãŒè¿½åŠ ã•ã‚ŒãŸã®ã§è¦‹ã¦ã¿ã‚‹\r\n\r\n![Imgur](https://imgur.com/WxaAUa0.png)\r\n\r\n# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\r\nhttps://developer.android.com/about/versions/12/features#recents-url-sharing\r\n\r\n# ç’°å¢ƒ\r\n| ãªã¾ãˆ  | ã‚ãŸã„    |\r\n|---------|-----------|\r\n| Android | 12 Beta 3 |\r\n| Pixel   | 3 XL      |\r\n| è¨€èª    | Kotlin    |\r\n\r\n# å®Ÿè£…æ–¹æ³•\r\nè¦‹ã¦è¦‹ã‚‹æ„Ÿã˜ã€Android 12ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸAPIã‚’ä½¿ã£ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„æ¨¡æ§˜ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n    }\r\n\r\n    override fun onProvideAssistContent(outContent: AssistContent?) {\r\n        super.onProvideAssistContent(outContent)\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n            // ã“ã“ã§URLã‚’æŒ‡å®šã™ã‚‹\r\n            outContent?.webUri = \"https://takusan.negitoro.dev/\".toUri()\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n## URLå…±æœ‰ãƒœã‚¿ãƒ³ã‚’éè¡¨ç¤ºã«ã—ãŸã„ã¨ãã¯\r\nå¤šåˆ†`AssistContent#setWebUri()`ã«`null`ã‚’å…¥ã‚Œã‚Œã°ã„ã„ã¨æ€ã†ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val button by lazy { findViewById<Button>(R.id.button) }\r\n\r\n    private var isURLShare = true\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        button.setOnClickListener {\r\n            // ãƒ•ãƒ©ã‚°åˆ‡ã‚Šæ›¿ãˆ\r\n            isURLShare = !isURLShare\r\n        }\r\n\r\n    }\r\n\r\n    override fun onProvideAssistContent(outContent: AssistContent?) {\r\n        super.onProvideAssistContent(outContent)\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n            // ã“ã“ã§URLã‚’æŒ‡å®šã™ã‚‹\r\n            outContent?.webUri = if (isURLShare) {\r\n                \"https://takusan.negitoro.dev/\".toUri()\r\n            } else {\r\n                null\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/Android12RecentScreenURLShare\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nAndroid 12 Beta3ã£ã¦ã“ã¨ã¯ã“ã‚Œä»¥é™APIã®è¿½åŠ ã£ã¦ç„¡ã„ã£ã¦ã“ã¨ï¼Ÿ"},{"title":"Hello Android12ã€‚ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ç·¨","link":"/posts/android_12_splashscreen/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚Androidã«ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã£ã¦ã„ã‚‰ã­ãˆã‚ˆãªã  \niOSç‰ˆã‚‚ãƒªãƒªãƒ¼ã‚¹ã—ã¦ã„ã¦iOSã¨åŒã˜ã«ã—ã¦ãã ã•ã„ï¼ã¿ãŸã„ãªã“ã¨ãŒãªã„é™ã‚Šã„ã‚‰ãªã„ã¨æ€ã†ã€‚\n\n# æœ¬é¡Œ\nAndroid 12ã‹ã‚‰ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚ã«ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãŒç„¡æ¡ä»¶ã§è¿½åŠ ã•ã‚Œã‚‹æ¨¡æ§˜ã€‚  \nã‚«ãƒ¡ãƒ©ã‚’èµ·å‹•ã™ã‚‹ã¨ãã¯ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³å‡ºãªã„ã‘ã©ã€å¤šåˆ†ã‚ã‚ŒçœŸã£æš—ã®èƒŒæ™¯è‰²ã‚’æŒ‡å®šã—ã¦ã‚‹ã‚“ã ã¨æ€ã†ã€‚  \n**ãªãŠã€ç‹¬è‡ªã§ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’å®Ÿè£…ã—ã¦ã„ã‚‹å ´åˆã¯äºŒé€£ç¶šã§ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãŒå‡ºã¾ã™ã€‚**  \n\n# ç’°å¢ƒ\n| ãªã¾ãˆ  | ã‚ãŸã„    |\n|---------|-----------|\n| Android | 12 Beta 3 |\n| Pixel   | 3 XL      |\n\n# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã™\nhttps://developer.android.com/about/versions/12/features/splash-screen\n\n# ã¨ã‚Šã‚ãˆãš\nAndroid 12ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã—ã¾ã™ã€‚SDK Managerã‚’èµ·å‹•ã—ã¦Android 12ã®SDKã‚’å…¥ã‚Œã¦ã€`app/build.gradle`ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã‚’å¤‰ãˆã¾ã™ã€‚\n\n```gradle\nandroid {\n    compileSdk 31 // ã“ã“ã‚’31\n    buildToolsVersion \"30.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.splashscreen\"\n        minSdk 21\n        targetSdk 31 // ã“ã“ã‚’31\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n```\n\n# ç„¡åŠ¹åŒ–ã™ã‚‹æ–¹æ³•ã¯ãªã„ï¼Ÿ\nã¡ã‚‰ã£ã¨è¦‹ãŸæ„Ÿã˜ãªã•ãã†ã€‚\n\nä»£ã‚ã‚Šã«ã€\n- ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã®èƒŒæ™¯è‰²\n    - é€æ˜ã‚’æŒ‡å®š\n- Adaptive Iconã®èƒŒæ™¯è‰²\n    - é€æ˜ã‚’æŒ‡å®š\n- Adaptive Iconã®å‰é¢ç”»åƒ\n    - ãªã«ã‚‚ãªã„Drawableã‚’ä½œæˆã—ã¦æŒ‡å®š\n\nã‚ˆãèª¿ã¹ã¦ãªã„ã®ã§ã‚ã¨ã¯é ¼ã‚“ã ã€‚\n\n## ãªã«ã‚‚ãªã„Drawableã‚’ä½œã‚‹\né©å½“ã«ä¸­èº«ã®ãªã„Drawableã‚’ä½œã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \nã“ã£ã‹ã‚‰ä½œæˆã§ãã¾ã™\n\n![Imgur](https://imgur.com/8oSywlA.png)\n\nä¸­èº«ã¯ç©ºã£ã½ã§\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<selector xmlns:android=\"http://schemas.android.com/apk/res/android\">\n\n</selector>\n```\n\n## themes.xml\n\næ¬¡ã«`src/main/res/values/themes.xml`ã‚’é–‹ã„ã¦æ›¸ãè¶³ã—ã¾ã™\n\n```xml\n<resources xmlns:tools=\"http://schemas.android.com/tools\">\n    <!-- Base application theme. -->\n\n    <style name=\"Theme.SplashScreen\" parent=\"Theme.MaterialComponents.DayNight.DarkActionBar\">\n        <!-- Primary brand color. -->\n        <item name=\"colorPrimary\">@color/purple_500</item>\n        <item name=\"colorPrimaryVariant\">@color/purple_700</item>\n        <item name=\"colorOnPrimary\">@color/white</item>\n        <!-- Secondary brand color. -->\n        <item name=\"colorSecondary\">@color/teal_200</item>\n        <item name=\"colorSecondaryVariant\">@color/teal_700</item>\n        <item name=\"colorOnSecondary\">@color/black</item>\n        <!-- Status bar color. -->\n        <item name=\"android:statusBarColor\" tools:targetApi=\"l\">?attr/colorPrimaryVariant</item>\n\n        <!-- ã“ã£ã‹ã‚‰ä¸‰è¡Œ -->\n        <item name=\"android:windowSplashScreenBackground\">@android:color/transparent</item>\n        <item name=\"android:windowSplashScreenIconBackgroundColor\">@android:color/transparent</item>\n        <item name=\"android:windowSplashScreenAnimatedIcon\">@drawable/empty_drawable</item>\n\n        <!-- Customize your theme here. -->\n    </style>\n</resources>\n```\n\n`src/main/res/values-night/themes.xml`ã‚‚æ›¸ãæ›ãˆã¾ã—ã‚‡ã†ã€‚ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã®æŒ™å‹•ã§ã™\n\n```xml\n<resources xmlns:tools=\"http://schemas.android.com/tools\">\n    <!-- Base application theme. -->\n    <style name=\"Theme.SplashScreen\" parent=\"Theme.MaterialComponents.DayNight.DarkActionBar\">\n        <!-- Primary brand color. -->\n        <item name=\"colorPrimary\">@color/purple_200</item>\n        <item name=\"colorPrimaryVariant\">@color/purple_700</item>\n        <item name=\"colorOnPrimary\">@color/black</item>\n        <!-- Secondary brand color. -->\n        <item name=\"colorSecondary\">@color/teal_200</item>\n        <item name=\"colorSecondaryVariant\">@color/teal_200</item>\n        <item name=\"colorOnSecondary\">@color/black</item>\n        <!-- Status bar color. -->\n        <item name=\"android:statusBarColor\" tools:targetApi=\"l\">?attr/colorPrimaryVariant</item>\n        <!-- Customize your theme here. -->\n\n        <!-- ã“ã£ã‹ã‚‰ä¸‰è¡Œ -->\n        <item name=\"android:windowSplashScreenBackground\">@android:color/transparent</item>\n        <item name=\"android:windowSplashScreenIconBackgroundColor\">@android:color/transparent</item>\n        <item name=\"android:windowSplashScreenAnimatedIcon\">@drawable/empty_drawable</item>\n\n    </style>\n</resources>\n```\n\nã“ã‚Œã§è¦‹ãŸæ„Ÿã˜ä»Šã¾ã§é€šã‚Šã®æŒ™å‹•ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚\n\n# Android 6ã¾ã§ãªã‚‰ãƒãƒƒã‚¯ãƒãƒ¼ãƒˆã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å¯¾å¿œã§ãã¾ã™\nã“ã‚Œã‚’ä½¿ã†ã“ã¨ã§Android 6(API 23 / ãƒã‚·ãƒ¥ãƒãƒ­)ã¾ã§ã•ã‹ã®ã¼ã£ã¦ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚’è¿½åŠ ã§ãã¾ã™ã€‚\n\nã¾ãš`app/build.gradle`ã‚’é–‹ãã€`compileSdk`ã‚’`31`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚KDocè¦‹ã‚Œã°ä½œã‚Œã‚‹ã£ã¦Googleè¨€ã£ã¦ãŸã®ã«ã“ã‚“ãªäº‹æ›¸ã„ã¦ãªã„ãï¼å˜˜ã¤ãï¼  \nå‚è€ƒï¼šhttps://dev.to/tkuenneth/a-peek-inside-jetpack-core-splashscreen-odo\n\nãã—ãŸã‚‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›¸ãè¶³ã—ã¾ã™ã€‚\n\n```gradle\nplugins {\n    id 'com.android.application'\n    id 'kotlin-android'\n}\n\nandroid {\n    compileSdk 31\n    buildToolsVersion \"30.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.splashscreenbackport\"\n        minSdk 23\n        targetSdk 30\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n    compileOptions {\n        sourceCompatibility JavaVersion.VERSION_1_8\n        targetCompatibility JavaVersion.VERSION_1_8\n    }\n    kotlinOptions {\n        jvmTarget = '1.8'\n    }\n}\n\ndependencies {\n    // ã“ã‚Œ\n    implementation \"androidx.core:core-splashscreen:1.0.0-alpha01\"\n\n    implementation 'androidx.core:core-ktx:1.6.0'\n    implementation 'androidx.appcompat:appcompat:1.3.0'\n    implementation 'com.google.android.material:material:1.4.0'\n    implementation 'androidx.constraintlayout:constraintlayout:2.0.4'\n    testImplementation 'junit:junit:4.+'\n    androidTestImplementation 'androidx.test.ext:junit:1.1.3'\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'\n}\n```\n\nãã—ãŸã‚‰æ¬¡ã¯`themes.xml`ã‚’é–‹ãã€ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³æ™‚ã®ãƒ†ãƒ¼ãƒã‚’å®šç¾©ã—ã¾ã™ã€‚\n\n```xml\n<!-- Base application theme. -->\n<style name=\"Theme.SplashScreenBackport\" parent=\"Theme.MaterialComponents.DayNight.DarkActionBar\">\n    <!-- Primary brand color. -->\n    <item name=\"colorPrimary\">@color/purple_500</item>\n    <item name=\"colorPrimaryVariant\">@color/purple_700</item>\n    <item name=\"colorOnPrimary\">@color/white</item>\n    <!-- Secondary brand color. -->\n    <item name=\"colorSecondary\">@color/teal_200</item>\n    <item name=\"colorSecondaryVariant\">@color/teal_700</item>\n    <item name=\"colorOnSecondary\">@color/black</item>\n    <!-- Status bar color. -->\n    <item name=\"android:statusBarColor\" tools:targetApi=\"l\">?attr/colorPrimaryVariant</item>\n    <!-- Customize your theme here. -->\n</style>\n\n<style name=\"Theme.OriginalSplashScreen\" parent=\"Theme.SplashScreen\">\n    <!-- ã‚¢ã‚¤ã‚³ãƒ³ -->\n    <item name=\"windowSplashScreenAnimatedIcon\">@mipmap/ic_launcher</item>\n    <!-- ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³å¾Œã®ãƒ†ãƒ¼ãƒã€‚ä»Šã¾ã§AndroidManifestã§æŒ‡å®šã—ã¦ãŸãƒ†ãƒ¼ãƒã­ -->\n    <item name=\"postSplashScreenTheme\">@style/Theme.SplashScreenBackport</item>\n</style>\n```\n\næ¬¡ã«ã€`AndroidManifest.xml`ã‚’é–‹ã`application`è¦ç´ ã®`theme`å±æ€§ã‚’`Theme.OriginalSplashScreen`ã«å¤‰æ›´ã—ã¾ã™ã€‚\n\n```xml\n<application\n    android:allowBackup=\"true\"\n    android:icon=\"@mipmap/ic_launcher\"\n    android:label=\"@string/app_name\"\n    android:roundIcon=\"@mipmap/ic_launcher_round\"\n    android:supportsRtl=\"true\"\n    android:theme=\"@style/Theme.OriginalSplashScreen\">\n    <activity\n        android:name=\".MainActivity\"\n        android:exported=\"true\">\n        <intent-filter>\n            <action android:name=\"android.intent.action.MAIN\" />\n            <category android:name=\"android.intent.category.LAUNCHER\" />\n        </intent-filter>\n    </activity>\n</application>\n```\n\næœ€å¾Œã«ã€`MainActivity.kt`ã‚’é–‹ã`installSplashScreen()`ã‚’å‘¼ã‚“ã ã‚ã¨ã«`setContentView()`ã™ã‚‹ã‚ˆã†ã«æ›¸ãæ›ãˆã¾ã™ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        installSplashScreen()\n\n        setContentView(R.layout.activity_main)\n\n    }\n\n}\n```\n\nã“ã‚Œã§ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãŒãƒãƒƒã‚¯ãƒãƒ¼ãƒˆã•ã‚Œã¾ã—ãŸã€‚\n\n# çµ‚ã‚ã‚Šã«\nGmailã¨ã‹Google Driveã«ã¯ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ä»˜ãã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãŒå®Ÿè£…ã•ã‚ŒãŸãã†ã§ã™ãŒã€ã‚ã‚Œã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³è¦‹ã›ã‚‹ã®ãŒç›®çš„ã«ãªã£ã¦ãªã„ï¼Ÿ  \nã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªã‚“ã¦ã„ã‚‰ã‚“ã‹ã‚‰ã¯ã‚ˆæœ¬é¡Œè¡Œã£ã¦ãã‚Œã£ã¦ãŠæ°—æŒã¡ã€‚\n\nä»•æ§˜ãªã®ã‹Betaã ã‹ã‚‰ãªã®ã‹ã¯çŸ¥ã‚Šã¾ã›ã‚“ãŒã€ãƒ©ãƒ³ãƒãƒ£ãƒ¼ä»¥å¤–ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã¨ã‚¹ãƒ—ãƒ©ãƒƒã‚·ãƒ¥ã‚¹ã‚¯ãƒªãƒ¼ãƒ³å‡ºãªã„ã‚“ã ã‘ã©ï¼Ÿ"},{"title":"Hello Android 12ã€‚ãƒ­ãƒ¼ã‚«ãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ç·¨","link":"/posts/android_12_wifi_local_ip_address/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \nChromeãã‚“ãŒãŸã¾ã«ã‚ˆãå›ºã¾ã‚‹ã‚“ã ã‘ã©ã©ã†ã—ãŸï¼Ÿ\n\n# æœ¬é¡Œ\nAndroid 12ã‹ã‚‰ãƒ­ãƒ¼ã‚«ãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹éš›ã«`WifiManager`ã‚’åˆ©ç”¨ã™ã‚‹ã»ã†ãŒéæ¨å¥¨ã«ãªã‚Šã€  \n`ConnectivityManager`ã‚’ä½¿ã†ã®ãŒæ­£è¦ãƒ«ãƒ¼ãƒˆã«ãªã£ãŸã¿ãŸã„ãªã®ã§ãƒ¡ãƒ¢  \n\n![Imgur](https://imgur.com/Rpjusp8.png)\n\n# å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹\n\nhttps://developer.android.com/reference/android/net/ConnectivityManager#getLinkProperties(android.net.Network)\n\nhttps://developer.android.com/reference/kotlin/android/net/wifi/WifiManager#getConnectionInfo()\n\n# æ¨©é™\n\n`AndroidManifest.xml`ã«`android.permission.ACCESS_NETWORK_STATE`ã‚’è¿½åŠ ã—ã¾ã™ã€‚  \nDANGERãƒ¬ãƒ™ãƒ«ã˜ã‚ƒãªã„ã®ã§è‡ªå‹•ã§ä»˜ä¸ã•ã‚Œã¾ã™ã€‚\n\n```xml\n<uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\n```\n\n# ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ\né©å½“ã«TextViewã‚’ç½®ã„ã¦ãŠã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ï¼ˆidã¯`activity_main_text_view`ï¼‰\n\n# åŒæœŸçš„ã«å–å¾—\nä¸€å›ã ã‘å–å¾—ã™ã‚‹éš›ã¯ã©ã‚“ãªé›£ã—ããªã„ã§ã™ã€‚ãŸã ã—ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å¤‰æ›´ãŒã‚ã£ãŸéš›ã«å¯¾å¿œã§ãã¾ã›ã‚“ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val textView = findViewById<TextView>(R.id.activity_main_text_view)\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\n            textView.text = getIpAddress(this)\n        }\n    }\n\n     /**\n     * IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹é–¢æ•°\n     *\n     * @param context Context\n     * @return IPv4ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\n     * */\n   @RequiresApi(Build.VERSION_CODES.M)\n    fun getIpAddress(context: Context): String? {\n        val connectivityManager = context.getSystemService(CONNECTIVITY_SERVICE) as ConnectivityManager\n        val activeNetwork = connectivityManager.activeNetwork\n        val linkProperties = connectivityManager.getLinkProperties(activeNetwork)\n        println(linkProperties?.linkAddresses)\n        val localIpAddress = linkProperties?.linkAddresses\n            ?.find { it.address?.toString()?.contains(\"192\") == true }\n            ?.address\n            ?.hostAddress\n        return localIpAddress\n    }\n}\n```\n\n## LinkProperties#getLinkAddresses() ãƒ¡ã‚½ãƒƒãƒ‰\nã©ã†ã‚„ã‚‰ã“ã‚Œã€IPv6ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ16é€²æ•°ã®`:`åŒºåˆ‡ã‚Šã®ã‚„ã¤ï¼‰ã¨IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼ˆ10é€²æ•°ã§`.`åŒºåˆ‡ã‚Šã®ã‚„ã¤ï¼‰ãŒä¸€ç·’ã®é…åˆ—ã«å…¥ã£ã¦ã‚‹ã¿ãŸã„ãªã®ã§ã€  \né…åˆ—ã®ä¸­ã‹ã‚‰IPã‚¢ãƒ‰ãƒ¬ã‚¹ã«`192`ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‚‚ã®ã‚’æ¢ã—ã¦ã¾ã™ã€‚\n\nè©²å½“ã®ã‚³ãƒ¼ãƒ‰\n\n```kotlin\nval localIpAddress = linkProperties?.linkAddresses\n    ?.find { it.address?.toString()?.contains(\"192\") == true }\n    ?.address\n    ?.hostAddress\n```\n\n# éåŒæœŸçš„ã«å–å¾—ã™ã‚‹\nã‚³ãƒ¼ãƒ‰ãŒè¤‡é›‘ã«ãªã‚‹ä»£å„Ÿã«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯å¤‰æ›´ã®æ¤œçŸ¥ã«å¯¾å¿œã§ãã¾ã™ã€‚\n\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\n\n`app/build.gradle`ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã¾ã™ã€‚\n\n```gradle\ndependencies {\n\n    implementation \"androidx.lifecycle:lifecycle-runtime-ktx:2.4.0\"\n    implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.5.2\"\n\n    // çœç•¥\n```\n\n## ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’ã„ã„æ„Ÿã˜ã«æ‰±ã„ãŸã„ï¼\n`Kotlin`ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã«ã‚ã‚‹ã€`Flow`ã®ä¸€ç¨®ã€`callbackFlow`ãŒã„ã„æ„Ÿã˜ã«æ‰±ã£ã¦ãã‚Œã¾ã™ã€‚  \nã“ã‚Œã‚’ä½¿ã†ã¨ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã®ã‚³ãƒ¼ãƒ‰ã‚’Flowã«å¤‰æ›ã—ã¦ãã‚Œã¾ã™ã€‚ã•ã‚‰ã«ã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒçµ‚äº†ã—ãŸéš›ã®å¾Œå§‹æœ«ã¾ã§ä¸€ã¤ã®é–¢æ•°ã§å®Œçµã™ã‚‹ã®ã§ãƒã‚¸ä¾¿åˆ©ã€‚\n\n```kotlin\ncallbackFlow {\n    // BroadcastReceiver ãªã©\n    awaitClose {\n        // Context#unregisterReceiver() ã§ç™»éŒ²è§£é™¤\n    }\n}\n```\n\n## Flowã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’é€ã‚‹é–¢æ•°\n\n`lifecycleScope`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€Activityã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«åˆã‚ã›ã¦ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’çµ‚äº†ã—ã¦ãã‚Œã¾ã™ã€‚  \nã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒçµ‚äº†ã™ã‚‹ã¨ã€`callbackFlow`å†…ã®`awaitClose`ã¸é€²ã¿å¾Œå§‹æœ«ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        val textView = findViewById<TextView>(R.id.activity_main_text_view)\n        lifecycleScope.launch {\n            collectIpAddress(this@MainActivity).collect {\n                textView.text = it\n            }\n        }\n    }\n\n    /**\n     * IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’Flowã§å—ã‘å–ã‚‹\n     *\n     * @param context Context\n     * @return IPv4ã®IPã‚¢ãƒ‰ãƒ¬ã‚¹\n     * */\n    @OptIn(ExperimentalCoroutinesApi::class)\n    fun collectIpAddress(context: Context) = callbackFlow {\n        val connectivityManager = context.getSystemService(CONNECTIVITY_SERVICE) as ConnectivityManager\n        val request = NetworkRequest.Builder()\n            .addTransportType(NetworkCapabilities.TRANSPORT_WIFI)\n            .build()\n        // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n        val networkCallback = object : ConnectivityManager.NetworkCallback() {\n            override fun onCapabilitiesChanged(network: Network, networkCapabilities: NetworkCapabilities) {\n                super.onCapabilitiesChanged(network, networkCapabilities)\n                val linkProperties = connectivityManager.getLinkProperties(network)\n                // IPv4ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æ¢ã™\n                val address = linkProperties?.linkAddresses\n                    ?.find { it.address?.toString()?.contains(\"192\") == true }\n                    ?.address?.hostAddress\n                if (address != null) {\n                    trySend(address)\n                }\n            }\n        }\n        connectivityManager.registerNetworkCallback(request, networkCallback)\n        awaitClose {\n            connectivityManager.unregisterNetworkCallback(networkCallback)\n        }\n    }\n\n}\n```\n\nä»¥ä¸Šã§ã™ã€‚\n\nãŠç–²ã‚Œã•ã¾ã§ã—ãŸ\n\n# ãŠã‚ã‚Šã«\n\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™\n\nhttps://github.com/takusan23/Android12GetIPAddress"},{"title":"Hello Android 13ã€‚æ‡ä¸­é›»ç¯ç·¨","link":"/posts/android_13_camera_flash_torch_level/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nå§«å®®ã•ã‚“ã¯ã‹ã¾ã„ãŸã„ æ”»ç•¥ã—ã¾ã—ãŸã€‚ã“ã†ã„ã†ã®ã§ã„ã„ã‚“ã ã‚ˆã€‚\r\n\r\n![Imgur](https://imgur.com/cI9ldMy.jpg)\r\n\r\nãã‚Œãª\r\n\r\n![Imgur](https://imgur.com/bglBKYa.jpg)\r\n\r\n![Imgur](https://imgur.com/wNwRC4D.jpg)\r\n\r\nã‹ã‚ã„ã„ï¼\r\n\r\næˆ¯ç”»ã€ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒä½¿ã„ã‚„ã™ã„ã€‚\r\n\r\n# æœ¬é¡Œ\r\n`Android 13` ã« `Galaxy`ã¨ã‹`iPhone`ãªã‚“ã‹ã«æ­è¼‰ã•ã‚Œã¦ã„ã‚‹ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒˆï¼ˆæ‡ä¸­é›»ç¯ï¼‰ã®æ˜ã‚‹ã•èª¿æ•´æ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚ŒãŸã‚‰ã—ã„ã€‚  \r\nã®ã§è©¦ã—ã¦ã¿ã‚‹ã€‚\r\n\r\nhttps://developer.android.com/sdk/api_diff/t-dp2/changes/android.hardware.camera2.CameraManager\r\n\r\nhttps://www.xda-developers.com/android-13-flashlight-brightness-adjustment/\r\n\r\nGalaxy S7 Edge ã«ã¯ãƒ•ãƒ©ãƒƒã‚·ãƒ¥ãƒ©ã‚¤ãƒˆã®æ˜ã‚‹ã•èª¿æ•´ãŒå­˜åœ¨ã™ã‚‹ã€‚Samsung Experience æ‡ã‹ã—ã„ã€‚  \r\nã‚ã®æ™‚ã¯SDã‚«ãƒ¼ãƒ‰ãŒåˆºã•ã‚‹ã£ã¦å®£ä¼ã—ã¦ãŸã®ã«ä»Šã¯...  \r\n\r\n![Imgur](https://imgur.com/dw93hKy.png)\r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„                    |\r\n|---------|---------------------------|\r\n| ç«¯æœ«    | Google Pixel 6 Pro        |\r\n| è¨€èª    | Kotlin                    |\r\n| Android | Tiramisu (Android 13 DP2) |\r\n\r\n## ä½œã‚‹\r\nAndroid 13 (ãƒ†ã‚£ãƒ©ãƒŸã‚¹) ä»¥ä¸ŠãŒå¿…è¦ã§ã™ã€‚  \r\nSDK Manager ã‹ã‚‰å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚\r\n![Imgur](https://imgur.com/FDV0zju.png)\r\n\r\n## å…¬å¼\r\n\r\nhttps://developer.android.com/reference/android/hardware/camera2/CameraManager#turnOnTorchWithStrengthLevel(java.lang.String,%20int)\r\n\r\n### appãƒ•ã‚©ãƒ«ãƒ€å†… build.gradle\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã‹ã¯ã„ã‚‰ãªã„ã§ã™ã€‚  \r\nSDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã ã‘13ï¼ˆTiramisuï¼‰ã«ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n```java\r\nplugins {\r\n    id 'com.android.application'\r\n    id 'org.jetbrains.kotlin.android'\r\n}\r\n\r\nandroid {\r\n    compileSdkPreview \"Tiramisu\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.androidtiramisutorch\"\r\n        minSdkPreview \"Tiramisu\"\r\n        targetSdkPreview \"Tiramisu\"\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    // çœç•¥...\r\n```\r\n\r\n### MainActivity.kt\r\n\r\næ‡ä¸­é›»ç¯å…‰ã‚‰ã›ã‚‹ã ã‘ãªã‚‰ã‚«ãƒ¡ãƒ©ã®æ¨©é™ã™ã‚‰ã„ã‚Šã¾ã›ã‚“ã€‚  \r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val cameraManager by lazy { getSystemService(Context.CAMERA_SERVICE) as CameraManager }\r\n\r\n    // è­¦å‘ŠãŒå‡ºã‚‹ã®ã§é»™ã‚‰ã›ã‚‹\r\n    @RequiresApi(33)\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        val list = cameraManager.cameraIdList\r\n        // å¤šåˆ†ã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©\r\n        val outCameraId = list[0]\r\n        // ã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©æƒ…å ±\r\n        val cameraCharacteristics = cameraManager.getCameraCharacteristics(outCameraId)\r\n        // æ‡ä¸­é›»ç¯æœ€å¤§ã®æ˜ã‚‹ã•ãƒ¬ãƒ™ãƒ«\r\n        val torchMaxLevel = cameraCharacteristics[CameraCharacteristics.FLASH_INFO_STRENGTH_MAXIMUM_LEVEL] ?: -1\r\n        // æœªå¯¾å¿œ\r\n        if (torchMaxLevel < 0) {\r\n            Toast.makeText(this, \"æ˜ã‚‹ã•èª¿æ•´ã«æœªå¯¾å¿œã§ã™\", Toast.LENGTH_SHORT).show()\r\n        } else {\r\n            // ç‚¹ç¯ã•ã›ã‚‹\r\n            cameraManager.turnOnTorchWithStrengthLevel(outCameraId, 1)\r\n        }\r\n    }\r\n\r\n    /** ã‚¢ãƒ—ãƒªçµ‚äº†æ™‚ã«æ¶ˆã™ */\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        val list = cameraManager.cameraIdList\r\n        val outCameraId = list[0]\r\n        cameraManager.setTorchMode(outCameraId, false)\r\n    }\r\n}\r\n```\r\n\r\n`CameraCharacteristics.FLASH_INFO_STRENGTH_MAXIMUM_LEVEL`ãŒ1ä»¥ä¸Šã‚’è¿”ã—ã¦ã„ãªã„å ´åˆã¯æ‡ä¸­é›»ç¯ã®æ˜ã‚‹ã•èª¿æ•´æ©Ÿèƒ½ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚  \r\n`Pixel 6 Pro`ã§å‹•ã„ã¦ã‚‹ã“ã¨ã¯ç¢ºèªæ¸ˆã¿ãªã®ã§**ã¿ã‚“ãªã‚‚è²·ãŠã†ã€‚**\r\n\r\n`turnOnTorchWithStrengthLevel`ã®ç¬¬2å¼•æ•°ãŒæ˜ã‚‹ã•ãƒ¬ãƒ™ãƒ«ã«ãªã£ã¦ã„ã¦ã€ã“ã®å€¤ã‚’ `1`ã‹ã‚‰`torchMaxLevel` ã¾ã§å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚   \r\n`Pixel 6 Pro`ã§`CameraCharacteristics.FLASH_INFO_STRENGTH_MAXIMUM_LEVEL`ã®è¿”ã‚Šå€¤ã¯`128`ã§ã—ãŸã€‚\r\n\r\n## æ˜ã‚‹ã•ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã‚’ä»˜ã‘ã‚‹\r\n\r\næ˜ã‚‹ã•ã®å¤‰åŒ–ãŒã‚ã‹ã‚Šã«ãã„ã®ã§ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã§å¯å¤‰å‡ºæ¥ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚\r\n\r\n![Imgur](https://imgur.com/MdeB5Bp.png)\r\n\r\n### activity_main.xml\r\né©å½“ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n\r\n    <SeekBar\r\n        android:id=\"@+id/activity_main_seekbar\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"16dp\"\r\n        android:layout_marginEnd=\"16dp\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <TextView\r\n        android:id=\"@+id/activity_main_textview\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginTop=\"16dp\"\r\n        app:layout_constraintEnd_toEndOf=\"@+id/activity_main_seekbar\"\r\n        app:layout_constraintStart_toStartOf=\"@+id/activity_main_seekbar\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/activity_main_seekbar\" />\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n### MainActivity.kt\r\n\r\nå°è¦æ¨¡ãªã®ã§`findViewById`ä½¿ã„ã¾ã™ãŒã€å‡ºæ¥ã‚Œã°`ViewBinding`ã‚’ä½¿ã†ã“ã¨ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val cameraManager by lazy { getSystemService(Context.CAMERA_SERVICE) as CameraManager }\r\n\r\n    /** ã‚·ãƒ¼ã‚¯ãƒãƒ¼ */\r\n    private val lightLevelSeekBar by lazy { findViewById<SeekBar>(R.id.activity_main_seekbar) }\r\n\r\n    /** æ˜ã‚‹ã•ãƒ¬ãƒ™ãƒ«è¡¨ç¤ºç”¨TextView */\r\n    private val lightLevelTextView by lazy { findViewById<TextView>(R.id.activity_main_textview) }\r\n\r\n    // è­¦å‘ŠãŒå‡ºã‚‹ã®ã§é»™ã‚‰ã›ã‚‹\r\n    @RequiresApi(33)\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        val list = cameraManager.cameraIdList\r\n        // å¤šåˆ†ã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©\r\n        val outCameraId = list[0]\r\n        // ã‚¢ã‚¦ãƒˆã‚«ãƒ¡ãƒ©æƒ…å ±\r\n        val cameraCharacteristics = cameraManager.getCameraCharacteristics(outCameraId)\r\n        // æ‡ä¸­é›»ç¯æœ€å¤§ã®æ˜ã‚‹ã•ãƒ¬ãƒ™ãƒ«\r\n        val torchMaxLevel = cameraCharacteristics[CameraCharacteristics.FLASH_INFO_STRENGTH_MAXIMUM_LEVEL] ?: -1\r\n        // æœªå¯¾å¿œ\r\n        if (torchMaxLevel < 0) {\r\n            Toast.makeText(this, \"æ˜ã‚‹ã•èª¿æ•´ã«æœªå¯¾å¿œã§ã™\", Toast.LENGTH_SHORT).show()\r\n        } else {\r\n            // æœ€å¤§å€¤\r\n            lightLevelSeekBar.max = torchMaxLevel\r\n            lightLevelSeekBar.setOnSeekBarChangeListener(object : SeekBar.OnSeekBarChangeListener {\r\n                override fun onProgressChanged(p0: SeekBar?, p1: Int, p2: Boolean) {\r\n                    // ã‚·ãƒ¼ã‚¯ãƒãƒ¼æ“ä½œæ™‚ã«å‘¼ã°ã‚Œã‚‹\r\n                    cameraManager.turnOnTorchWithStrengthLevel(outCameraId, p1)\r\n                    lightLevelTextView.text = \"æ˜ã‚‹ã•ãƒ¬ãƒ™ãƒ« ${p1}\"\r\n                }\r\n\r\n                override fun onStartTrackingTouch(p0: SeekBar?) {\r\n\r\n                }\r\n\r\n                override fun onStopTrackingTouch(p0: SeekBar?) {\r\n\r\n                }\r\n            })\r\n        }\r\n    }\r\n\r\n    /** ã‚¢ãƒ—ãƒªçµ‚äº†æ™‚ã«æ¶ˆã™ */\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        val list = cameraManager.cameraIdList\r\n        val outCameraId = list[0]\r\n        cameraManager.setTorchMode(outCameraId, false)\r\n    }\r\n}\r\n```\r\n\r\n## ã”è¤’ç¾\r\nAPKç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\nhttps://github.com/takusan23/AndroidTiramisuTorch/releases\r\n\r\n## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nAndroid Studio æœ€æ–°ç‰ˆã§ã‚‚å¤šåˆ†é–‹ã‘ã‚‹ã¨æ€ã„ã¾ã™ã€‚(æ›´æ–°ã—ã‚ˆã†ã¨ã—ãŸã‚‰å®¹é‡ä¸è¶³ã§ã‚³ã‚±ãŸ...)\r\n\r\nhttps://github.com/takusan23/AndroidTiramisuTorch\r\n\r\n# ãŠã‚ã‚Šã«\r\nGoogle Pixel ã ã¨ PayPay ã®SMSèªè¨¼æ¥ãªã„ã‚“ã§ã™ã‘ã©ãŠã¾ç’°ã§ã™ã‹..."},{"title":"Hello Android 13ã€‚ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³ç·¨ (Android 12ã‚‚ã‚ã‚‹ã‚ˆ)","link":"/posts/android_13_dynamic_color_icon/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nå‹ã ã¡ã‹ã‚‰æ‹ã³ã¨ã¸ æ”»ç•¥ã—ã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/fIZi2Wu.png)\r\n\r\nã“ã®æ‰‹ã®ã‚²ãƒ¼ãƒ ã¯`ãƒ’ãƒ­ã‚¤ãƒ³+ã‚µãƒ–ãƒ’ãƒ­ã‚¤ãƒ³`ã¨ã‹ã§å¤§ä½“ã‚µãƒ–ãƒ’ãƒ­ã‚¤ãƒ³ã¯æ”»ç•¥ã§ããªã„ç³»ãŒå¤šã„ã‚“ã ã‘ã©ä»Šå›ã¯ãµãŸã‚Šã¨ã‚‚æ”»ç•¥ã§ãã‚‹ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/JsGTljv.png)\r\n\r\n# æœ¬é¡Œ\r\nAndroid 13 Developer Preview ãŒå‡ºã¦ãŸï¼  \r\nã“ã®ä¸­ã‹ã‚‰ç°¡å˜ã«ä½¿ãˆãã†ãªæ–°æ©Ÿèƒ½ã‚’ä¸€ã¤ï¼ˆã¨ã„ã†ã‹ã¾ã å…¨ç„¶ãªã„ï¼‰\r\n\r\n## Material You ãªã‚¢ã‚¤ã‚³ãƒ³ãŒä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ\r\nä¸€éƒ¨ã®ã‚·ã‚¹ãƒ†ãƒ ã‚¢ã‚¤ã‚³ãƒ³ã¯ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã«å£ç´™ã®è‰²ã‚’ã¤ã‘ã¦ãã‚Œã‚‹ã®ã§ã™ãŒã€ã“ã‚ŒãŒã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã‚¢ãƒ—ãƒªã«ã‚‚é–‹æ”¾ã•ã‚Œã¾ã—ãŸã€‚  \r\n(ãªã‚“ã§ã“ã‚ŒAndroid 12ã«å…¥ã‚Œãªã‹ã£ãŸã‚“ã ï¼ŸmonetãŒAOSPå…¥ã‚Šã—ãªã‹ã£ãŸã‹ã‚‰ï¼Ÿ)\r\n\r\n![Imgur](https://imgur.com/4Q3em8N.png)\r\n\r\nEZWebãŒçµ‚ã‚ã‚‹ä»Šã€ãã›ã‹ãˆãƒ„ãƒ¼ãƒ«ã®ã‚ˆã†ãªæ©Ÿèƒ½ãŒè¿½åŠ ã•ã‚Œã‚‹ã¨ã¯\r\n\r\n## ã“ã†ã—ã\r\n\r\nhttps://developer.android.com/about/versions/13/features#themed-app-icons\r\n\r\n## ä½œã‚Šæ–¹\r\n\r\n### app/build.gradle\r\n\r\n`Tiramisu`ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãŠè“å­ã®ã‚³ãƒ¼ãƒ‰ãƒãƒ¼ãƒ ã ï¼ï¼  \r\nSDKå…¥ã£ã¦ã„ãªã„å ´åˆã¯å³ä¸Šã«ã‚ã‚‹`SDK Manager`ã‹ã‚‰å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/JWDLgmJ.png)\r\n\r\nãã—ã¦ã“ã†ã§ã™\r\n\r\n```java\r\nandroid {\r\n    compileSdkPreview \"Tiramisu\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.dynamiccoloricon\"\r\n        minSdkPreview \"Tiramisu\"\r\n        targetSdkPreview \"Tiramisu\"\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility JavaVersion.VERSION_1_8\r\n        targetCompatibility JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = '1.8'\r\n    }\r\n}\r\n```\r\n\r\n## Adaptive Iconã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã\r\n\r\n- `mipmap-anydpi-v26/ic_launcher_round.xml`\r\n- `mipmap-anydpi-v26/ic_launcher.xml`\r\n\r\nã‚’é–‹ã„ã¦ã€ãã‚Œãã‚Œ`<monochrome android:drawable=\"ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒ™ã‚¯ã‚¿ãƒ¼ç”»åƒ\" />`ã®ä¸€è¡Œã‚’æ›¸ãè¶³ã—ã¾ã™\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<adaptive-icon xmlns:android=\"http://schemas.android.com/apk/res/android\">\r\n    <background android:drawable=\"@drawable/ic_launcher_background\" />\r\n    <foreground android:drawable=\"@drawable/ic_launcher_foreground\" />\r\n    <!-- â†“ ã“ã‚Œ -->\r\n    <monochrome android:drawable=\"@drawable/ic_launcher_foreground\" /> \r\n</adaptive-icon>\r\n```\r\n\r\nåŸºæœ¬çš„ã«ã¯é€šçŸ¥ã«ä½¿ã£ã¦ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ãŒä½¿ãˆã‚‹ã¨æ€ã„ã¾ã™ï¼ˆã£ã¦GoogleãŒè¨€ã£ã¦ãŸï¼‰\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# å…¨å“¡ãŒå…¨å“¡ Android 13 ä½¿ã£ã¦ã‚‹ã¨æ€ã†ãªã‚ˆ\r\nå…ƒãƒã‚¿ï¼šå…¨å“¡ãŒå…¨å“¡iPhoneä½¿ã£ã¦ã‚‹ã¨æ€ã†ãªã‚ˆ\r\n\r\nAndroidã«ã¯`activity-alias`ã¨`PackageManager#setComponentEnabledSetting`ã§äºˆã‚ç”¨æ„ã—ã¦ãŠã„ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹ã¿ãŸã„ã€‚  \r\n(å‹•çš„ã«ã‚¢ã‚¤ã‚³ãƒ³ã®ç”»åƒã‚’å·®ã—æ›¿ãˆã‚‹ã¨ã‹ã¯å‡ºæ¥ãªã„ã¨æ€ã†ã€‚ã‚‚ã—ã‚„ã‚ŠãŸã‘ã‚Œã°`ShortcutManager#requestPinShortcut`ã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œã‚‹ã¨ã„ã„)\r\n\r\n## å‹•çš„ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã¿ãŸã„\r\n\r\nå‚ç…§ï¼š  \r\n\r\nhttps://qiita.com/temoki/items/3fa4acc0a897bbbbbc8f\r\n\r\n## ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ç”¨ã®Adaptive Iconã‚’ç”¨æ„ã™ã‚‹\r\n\r\n`src/main/res/`ã®ä¸­ã«`mipmap-anydpi-v31`ã‚’ä½œæˆã—ã¦\r\n\r\n- `ic_launcher_dynamic_color.xml`\r\n- `ic_launcher_round_dynamic_color.xml`\r\n\r\nã®2ã¤ã‚’ä½œæˆã—ã¦ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã¯ã“ã‚Œã§ã™ã€‚ï¼ˆä¸­èº«ä¸€ç·’ã ã‹ã‚‰ä¸€ã¤ã§ã‚‚è‰¯ã‹ã£ãŸã§ã™ã­ï¼‰\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<adaptive-icon xmlns:android=\"http://schemas.android.com/apk/res/android\">\r\n    <background android:drawable=\"@android:color/system_accent2_100\" />\r\n    <foreground android:drawable=\"@drawable/ic_launcher_foreground_dynamic_color\" />\r\n</adaptive-icon>\r\n```\r\n\r\n![Imgur](https://imgur.com/BYkzZUP.png)\r\n\r\nã¾ãŸã€`@drawable/ic_launcher_foreground_dynamic_color`ãŒç„¡ã„ã®ã§ä½œã‚Šã¾ã™ã€‚  \r\n`drawable`ã®ä¸­ã«`ic_launcher_foreground_dynamic_color.xml`ã§ä½œã‚Šã¾ã—ã‚‡ã†ã€‚  \r\n\r\nãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã¯çš†ã•ã‚“ã®Adaptive Iconã®`foreground`ã§æŒ‡å®šã—ã¦ã‚‹`xml`ã‚’ãã®ã¾ã¾ä½¿ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§`launcher_foreground.xml`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€`android:tint=\"@android:color/system_accent2_700\"`ã‚’è¶³ã—ã¾ã™ã€‚\r\n\r\n```xml\r\n<vector xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:aapt=\"http://schemas.android.com/aapt\"\r\n    android:width=\"108dp\"\r\n    android:height=\"108dp\"\r\n    android:tint=\"@android:color/system_accent2_700\"\r\n    android:viewportWidth=\"108\"\r\n    android:viewportHeight=\"108\">\r\n    <!-- çœç•¥... -->\r\n</vector>\r\n```\r\n\r\n## AndroidManifest.xml ã«ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ç”¨ã® <activity-alias>ã€€ã‚’æ›¸ãè¶³ã™\r\n\r\nä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãè¶³ã—ã¾ã™\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    package=\"io.github.takusan23.android12dynamicicon\">\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.Android12DynamicIcon\">\r\n        <activity\r\n            android:name=\".MainActivity\"\r\n            android:exported=\"true\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n\r\n        <!-- ã“ã‚Œã‚’æ›¸ãè¶³ã™ -->\r\n        <activity-alias\r\n            android:name=\".MainActivity_dynamic_icon\"\r\n            android:enabled=\"true\"\r\n            android:exported=\"true\"\r\n            android:icon=\"@mipmap/ic_launcher_dynamic_color\"\r\n            android:label=\"@string/app_name\"\r\n            android:roundIcon=\"@mipmap/ic_launcher_round_dynamic_color\"\r\n            android:targetActivity=\".MainActivity\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity-alias>\r\n\r\n    </application>\r\n\r\n</manifest>\r\n```\r\n\r\n## ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã\r\n\r\n### activity_main.xml\r\nåˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒã‚’ãŠãã¾ã™\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <com.google.android.material.switchmaterial.SwitchMaterial\r\n        android:id=\"@+id/enable_theme_icon\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ã«åˆ‡ã‚Šæ›¿ãˆã‚‹\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n### MainActivity.kt\r\n\r\nã‚¹ã‚¤ãƒƒãƒã®åˆæœŸå€¤è¨­å®šã¨ã‚¹ã‚¤ãƒƒãƒã‚’åˆ‡ã‚Šæ›¿ãˆãŸã¨ãã«`<activity-alias>`ã¸åˆ‡ã‚Šæ›¿ãˆã‚‹é–¢æ•°ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒ */\r\n    private val themeIconSwitch by lazy { findViewById<SwitchMaterial>(R.id.enable_theme_icon) }\r\n\r\n    /** ãƒ‡ãƒ•ã‚© ComponentName */\r\n    private val defaultComponentName by lazy { ComponentName(packageName, \"${packageName}.MainActivity\") }\r\n\r\n    /** ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ã«ã—ãŸ ComponentName */\r\n    private val themeIconComponentName by lazy { ComponentName(packageName, \"${packageName}.MainActivity_dynamic_icon\") }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        // ä»Šã®çŠ¶æ…‹ã‚’ã‚¹ã‚¤ãƒƒãƒã«å…¥ã‚Œã‚‹\r\n        themeIconSwitch.isChecked = !isDefaultIcon()\r\n        // åˆ‡ã‚Šæ›¿ãˆãŸã‚‰ã‚¢ã‚¤ã‚³ãƒ³ã‚‚åˆ‡ã‚Šæ›¿ãˆã‚‹\r\n        themeIconSwitch.setOnCheckedChangeListener { buttonView, isChecked ->\r\n            setThemeIcon(isChecked)\r\n        }\r\n\r\n    }\r\n\r\n    /** ãƒ‡ãƒ•ã‚©ã‚¢ã‚¤ã‚³ãƒ³ã®å ´åˆã¯true */\r\n    private fun isDefaultIcon(): Boolean {\r\n        return packageManager.getComponentEnabledSetting(defaultComponentName).let {\r\n            it == PackageManager.COMPONENT_ENABLED_STATE_DEFAULT || it == PackageManager.COMPONENT_ENABLED_STATE_ENABLED\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ã‚’é©ç”¨ã™ã‚‹ã‹\r\n     *\r\n     * @param isEnable ãƒ†ãƒ¼ãƒã‚¢ã‚¤ã‚³ãƒ³ãªã‚‰trueã€ãƒ‡ãƒ•ã‚©ã‚¢ã‚¤ã‚³ãƒ³ãªã‚‰fase\r\n     * */\r\n    private fun setThemeIcon(isEnable: Boolean) {\r\n        // Android 12 ä»¥é™ã®ã¿\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n            packageManager.setComponentEnabledSetting(\r\n                if (isEnable) themeIconComponentName else defaultComponentName,\r\n                PackageManager.COMPONENT_ENABLED_STATE_ENABLED,\r\n                PackageManager.DONT_KILL_APP)\r\n            packageManager.setComponentEnabledSetting(\r\n                if (!isEnable) themeIconComponentName else defaultComponentName,\r\n                PackageManager.COMPONENT_ENABLED_STATE_DISABLED,\r\n                PackageManager.DONT_KILL_APP)\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§å‹•ãã¯ãš\r\n\r\n![Imgur](https://imgur.com/BGCaO9e.png)\r\n\r\n![Imgur](https://imgur.com/UtfBON1.png)\r\n\r\n### ãƒ¡ãƒ¢\r\næœ‰åŠ¹çŠ¶æ…‹ã ã¨`MainActivity`ã‚’æŒ‡ã—ãŸIntentã‚’è§£æ±ºå‡ºæ¥ãªããªã‚Šã€Android Studioã‹ã‚‰å®Ÿè¡Œã—ã¦ã‚‚ActivityãŒå­˜åœ¨ã—ãªã„ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã™ã€‚  \r\næ°—ã‚’ã¤ã‘ã¦ã­ã€‚\r\n\r\n## ããƒ¼ã™ã“ãƒ¼ã©\r\n\r\nhttps://github.com/takusan23/Android12DynamicIcon\r\n\r\n# ãŠã‚ã‚Šã«\r\nEngagedæ—¥æœ¬ç‰ˆçµ‚ã‚ã‚‹ã®æ‚²ã—ã„...ï¼Ÿ  \r\néå»ã®è¨˜äº‹ã‚‚èª­ã‚ãªããªã‚‹ã®ã‹è¾›ã„ã­..."},{"title":"Android Architecture Componentsã®LifeCycleã§onDestory()ã«æ›¸ãå¿˜ã‚Œã‚’å›é¿","link":"/posts/android_aac_lifecycle/","markdown":"ã­ã‚€ã„\r\n\r\n# æœ¬é¡Œ\r\nãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’Activity/Fragmentä»¥å¤–ã®ã‚¯ãƒ©ã‚¹ã§å—ã‘å–ã‚ŠãŸã„ã£ã¦è©±ã€‚\r\n\r\n## ã‚ã‚‹ã¨ä½•ãŒã„ã„ã‹\r\nã“ã‚“ãªãµã†ãªã‚»ãƒ³ã‚µãƒ¼ã®å€¤ã‚’ã¨ã‚‹ã‚¯ãƒ©ã‚¹ãŒã‚ã£ãŸã¨ã—ã¦ã€\r\n\r\n```kotlin\r\n/**\r\n * åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®å€¤å–å¾—ã‚¯ãƒ©ã‚¹\r\n * @param activity Contextã¨ã‚‹ãŸã‚\r\n * @param sensorChanged ã‚»ãƒ³ã‚µãƒ¼ã®å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«å‘¼ã°ã‚Œã‚‹é«˜éšé–¢æ•°\r\n * */\r\nclass GetSensor(activity: Activity, sensorChanged: (SensorEvent?) -> Unit) {\r\n\r\n    private val sensorManager = activity.getSystemService(Context.SENSOR_SERVICE) as SensorManager\r\n    private var sensorEventListener: SensorEventListener\r\n\r\n    init {\r\n        sensorEventListener = object : SensorEventListener {\r\n            override fun onAccuracyChanged(p0: Sensor?, p1: Int) {\r\n\r\n            }\r\n\r\n            override fun onSensorChanged(p0: SensorEvent?) {\r\n                // å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸ\r\n                sensorChanged(p0)\r\n            }\r\n        }\r\n    }\r\n\r\n    /** çµ‚äº†æ™‚ã«å‘¼ã‚“ã§ã­ */\r\n    fun destroy() {\r\n        sensorManager.unregisterListener(sensorEventListener)\r\n    }\r\n\r\n    /** é–‹å§‹æ™‚ã«å‘¼ã‚“ã§ã­ */\r\n    fun start(){\r\n        // åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼\r\n        val sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)\r\n        // ã‚»ãƒ³ã‚µãƒ¼ç™»éŒ²\r\n        sensorManager.registerListener(\r\n            sensorEventListener,\r\n            sensor,\r\n            SensorManager.SENSOR_DELAY_NORMAL\r\n        )\r\n    }\r\n\r\n}\r\n```\r\n\r\n`MainActivity.kt`ã‚ãŸã‚Šã§ä½¿ã†ã¨ã—ã¦ã€ã“ã†ã§ã™ã­\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private lateinit var sensor: GetSensor\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        sensor = GetSensor(this) {\r\n            // Xè»¸ã‚’å‡ºåŠ›\r\n            println(it?.values?.get(0))\r\n        }\r\n\r\n    }\r\n\r\n    // ã‚»ãƒ³ã‚µãƒ¼ã®ç™»éŒ²è§£é™¤\r\n    override fun onPause() {\r\n        super.onPause()\r\n        sensor.destroy()\r\n    }\r\n\r\n    // ã‚»ãƒ³ã‚µãƒ¼ã®ç™»éŒ²\r\n    override fun onResume() {\r\n        super.onResume()\r\n        sensor.start()\r\n    }\r\n\r\n\r\n}\r\n```\r\n\r\n## ã“ã‚Œã®ä½•ãŒå•é¡Œãªã®ã‹\r\n~~(activityã˜ã‚ƒãªãã¦contextã§è‰¯ã„ã ã‚)~~\r\n- `onPause()`ã«æ›¸ãå¿˜ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹\r\n- `GetSensor`ã‚¯ãƒ©ã‚¹ã§ç™»éŒ²ã¨ã‹è§£é™¤ã¨ã‹ã‚’è‡ªå‹•ã§ã‚„ã£ã¦ã»ã—ã„\r\n    - ãªã‚“ã§Activityã®`onPause`ã¨ã‹ã«æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ã®ï¼Ÿ\r\n\r\n# ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«å¯¾å¿œã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ã‚’åˆ©ç”¨ã—ã¦è§£æ±º\r\nã“ã‚Œã‚’ä½¿ã†ã¨ã€\r\n- `DESTROY`çŠ¶æ…‹ã«ãªã£ãŸã‚‰å‘¼ã°ã‚Œã‚‹é–¢æ•°(ã¹ã¤ã«STARTã§ã‚‚è‰¯ã„ã‚ˆ)\r\n    - **Activityã‚„Fragmentã®onPause()é–¢æ•°ç­‰ãŒActivity/Fragmentä»¥å¤–(è‡ªä½œã‚¯ãƒ©ã‚¹)ã§ã‚‚åˆ©ç”¨ã§ãã‚‹ï¼ï¼ï¼**\r\n\r\n~~ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã¯ã‚¯ã‚½ãªã®ã§åŠ©ã‹ã‚‹~~\r\n\r\nãªã®ã§æ›¸ãç›´ã™ã¨\r\n\r\n## LifecycleObserverã‚’ç¶™æ‰¿\r\n`LifecycleObserver`ã¯å®Ÿã¯ä¸­èº«ç©ºã£ã½ãªã®ã§æ›¸ãè¶³ã™ã ã‘ã§ã„ã„ã§ã™\r\n```kotlin\r\nclass GetSensor(activity: Activity, sensorChanged: (SensorEvent?) -> Unit) : LifecycleObserver {\r\n```\r\n\r\n## addObserver()\r\n`GetSensor`ã‚¯ãƒ©ã‚¹ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã®å¼•æ•°ã«`lifecycle: Lifecycle`ã‚’ä»˜ã‘è¶³ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass GetSensor(activity: Activity, lifecycle: Lifecycle, sensorChanged: (SensorEvent?) -> Unit) : LifecycleObserver {\r\n```\r\n\r\nãã—ã¦`init{ }`ã®ä¸­ã«ä»¥ä¸‹ã®1è¡Œã‚’è¶³ã—ã¾ã™\r\n```kotlin\r\nlifecycle.addObserver(this)\r\n```\r\n\r\n## ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã«é–¢ä¿‚ã—ã¦ã„ã‚‹é–¢æ•°ã«`@OnLifecycleEvent`ã‚’ã¤ã‘ã‚‹\r\n\r\nã¾ãšå¿˜ã‚Œãã†ãª`destroy()`é–¢æ•°ã«ã¤ã‘ã¾ã—ã‚‡ã†ã€‚  \r\nã¡ã‚ƒã‚“ã¨ã‚³ãƒ¡ãƒ³ãƒˆã‚‚æ›¸ãæ›ãˆã¦ã€privateã«ã—ã¦ã—ã¾ã„ã¾ã—ã‚‡ã†ï¼ˆå‹æ‰‹ã«å‘¼ã°ã‚Œã‚‹ã®ã§ã‚‚ã†æ›¸ãå¿…è¦ãŒãªã„ãŸã‚ï¼‰ã€‚\r\n\r\n```kotlin\r\n/** çµ‚äº†æ™‚ã«å‹æ‰‹ã«å‘¼ã°ã‚Œã‚‹ */\r\n@OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)\r\nprivate fun destroy() {\r\n    sensorManager.unregisterListener(sensorEventListener)\r\n}\r\n```\r\n\r\nãã‚Œã¨ã‚»ãƒ³ã‚µãƒ¼ã‚’ç™»éŒ²ã™ã‚‹é–¢æ•°ã‚‚ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãŒ`Resume`ã®çŠ¶æ…‹ã«ãªã£ãŸã‚‰è‡ªå‹•ã§å‘¼ã¶ã‚ˆã†ã«ã—ã¾ã™\r\n```kotlin\r\n/** é–‹å§‹çŠ¶æ…‹ã«ãªã£ãŸã‚‰å‹æ‰‹ã«å‘¼ã°ã‚Œã‚‹ */\r\n@OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\r\nprivate fun start() {\r\n    // åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼\r\n    val sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)\r\n    // ã‚»ãƒ³ã‚µãƒ¼ç™»éŒ²\r\n    sensorManager.registerListener(\r\n        sensorEventListener,\r\n        sensor,\r\n        SensorManager.SENSOR_DELAY_NORMAL\r\n    )\r\n}\r\n```\r\n\r\næœ€å¾Œã«`MainActivity`ã‚’ä¿®æ­£ã—ã¦çµ‚ã‚ã‚Šã§ã™ï¼\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        GetSensor(this, lifecycle) {\r\n            // Xè»¸ã‚’å‡ºåŠ›\r\n            println(it?.values?.get(0))\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nã‚ã‚ï¼ã™ã”ã„ã‚¹ãƒƒã‚­ãƒª\r\n\r\nå®Ÿè¡Œã—ã¦Logcatã‚’å‡ºã—ã¦ã‚¢ãƒ—ãƒªã‚’é›¢ã‚Œã‚‹ã¨å‹æ‰‹ã«å‡ºåŠ›ãŒçµ‚äº†ã—ã€ã¾ãŸæˆ»ã£ã¦ãã‚‹ã¨å‡ºåŠ›ãŒå§‹ã¾ã£ã¦ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\n# å…¨éƒ¨ãã£ã¤ã‘ãŸã‚³ãƒ¼ãƒ‰\r\n\r\n`GetSensor.kt`\r\n\r\n```kotlin\r\n/**\r\n * åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼ã®å€¤å–å¾—ã‚¯ãƒ©ã‚¹\r\n * @param activity Contextã¨ã‚‹ãŸã‚\r\n * @param sensorChanged ã‚»ãƒ³ã‚µãƒ¼ã®å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸæ™‚ã«å‘¼ã°ã‚Œã‚‹é«˜éšé–¢æ•°\r\n * */\r\nclass GetSensor(activity: Activity, lifecycle: Lifecycle, sensorChanged: (SensorEvent?) -> Unit) :\r\n    LifecycleObserver {\r\n\r\n    private val sensorManager = activity.getSystemService(Context.SENSOR_SERVICE) as SensorManager\r\n    private var sensorEventListener: SensorEventListener\r\n\r\n    init {\r\n        lifecycle.addObserver(this)\r\n        sensorEventListener = object : SensorEventListener {\r\n            override fun onAccuracyChanged(p0: Sensor?, p1: Int) {\r\n\r\n            }\r\n\r\n            override fun onSensorChanged(p0: SensorEvent?) {\r\n                // å€¤ãŒå¤‰æ›´ã•ã‚ŒãŸ\r\n                sensorChanged(p0)\r\n            }\r\n        }\r\n    }\r\n\r\n    /** çµ‚äº†æ™‚ã«å‹æ‰‹ã«å‘¼ã°ã‚Œã‚‹ */\r\n    @OnLifecycleEvent(Lifecycle.Event.ON_PAUSE)\r\n    private fun destroy() {\r\n        sensorManager.unregisterListener(sensorEventListener)\r\n    }\r\n\r\n    /** é–‹å§‹çŠ¶æ…‹ã«ãªã£ãŸã‚‰å‹æ‰‹ã«å‘¼ã°ã‚Œã‚‹ */\r\n    @OnLifecycleEvent(Lifecycle.Event.ON_RESUME)\r\n    private fun start() {\r\n        // åŠ é€Ÿåº¦ã‚»ãƒ³ã‚µãƒ¼\r\n        val sensor = sensorManager.getDefaultSensor(Sensor.TYPE_ACCELEROMETER)\r\n        // ã‚»ãƒ³ã‚µãƒ¼ç™»éŒ²\r\n        sensorManager.registerListener(\r\n            sensorEventListener,\r\n            sensor,\r\n            SensorManager.SENSOR_DELAY_NORMAL\r\n        )\r\n    }\r\n\r\n}\r\n```\r\n\r\n`MainActivity.kt`\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        GetSensor(this, lifecycle) {\r\n            // Xè»¸ã‚’å‡ºåŠ›\r\n            println(it?.values?.get(0))\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://developer.android.com/topic/libraries/architecture/lifecycle?hl=ja"},{"title":"startActivityForResultã«æ‰“æ¶ˆã—ç·šãŒå‡ºãŸ","link":"/posts/android_activity_result_api/","markdown":"\r\nã‚„ã£ã¨é€±æœ«ãŒ\r\n\r\n# æœ¬é¡Œ\r\nã¤ã¾ã‚Šéæ¨å¥¨ã«ãªã£ãŸã£ã¦ã“ã¨ã§ã™ã€‚\r\n\r\n# startActivityForResult ã£ã¦ä½•\r\nç”»åƒã‚’é¸æŠã™ã‚‹æ™‚ã€é¸æŠã—ãŸç”»åƒã‚’å—ã‘å–ã‚‹æ™‚ã«ä½¿ã†ã€‚  \r\n\r\n# Activity Result API ã¨ã¯\r\nstartActivityForResult ã‚ˆã‚Šã‚‚ç°¡ç´ åŒ–ã•ã‚ŒãŸï¼Ÿã€‚  \r\nç¬¬äºŒå¼•æ•°ã®`REQUEST_CODE`ãŒçœç•¥ã§ãã‚‹ã‚ˆã†ã«ã€‚  \r\nï¼ˆä»£ã‚ã‚Šã«ãã®éƒ½åº¦`startActivityForResult`ã‚’ç”¨æ„ã™ã‚‹æ¨¡æ§˜ï¼Ÿï¼‰\r\n\r\n# Storage Access Framework ã§ã®ä¾‹\r\n\r\nFragmentã¨Activityã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ã¾ã™ã€‚\r\nå¤šåˆ†Fragment/Activityä¸¡æ–¹æ›¸ã‹ãªã„ã¨ã‚¨ãƒ©ãƒ¼å‡ºã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    implementation 'androidx.activity:activity-ktx:1.2.0-alpha08'\r\n    implementation 'androidx.fragment:fragment:1.3.0-alpha08'\r\n}\r\n```\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** é¸æŠã—ãŸç”»åƒã‚’ã“ã“ã§å—ã‘å–ã‚‹ã€‚Activity Result APIã£ã¦ã‚„ã¤ã‚‰ã—ã„ã€‚ */\r\n    val getContent =\r\n        registerForActivityResult(ActivityResultContracts.GetContent()) { uri: Uri? ->\r\n            println(uri?.path)\r\n        }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        content_select.setOnClickListener {\r\n            // ç”»åƒé¸æŠã€‚SAFã€‚\r\n            getContent.launch(\"image/*\")\r\n        }\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\nãƒœã‚¿ãƒ³ã‚’ä½œæˆã—ã¦(IDã¯`content_select`)ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«ç½®ã„ã¦ãŠã„ã¦ãã ã•ã„ã€‚"},{"title":"Androidã§MediaCodecã‚’åˆ©ç”¨ã—ã¦å‹•ç”»ã®ä¸Šã«æ–‡å­—ã‚’ã‹ã•ã­ã‚‹","link":"/posts/android_add_canvas_text_to_video/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚  \r\nD.S. -Dal Segno- æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\nD.C.4 ã£ã¦ã‚‚ã—ã‹ã—ã¦ D.S.2 ã€ã€ã€ï¼Ÿ\r\n\r\nOPæ›²ãŒè‰¯ã™ãã€‚ãœã²èã„ã¦ã¿ã¦ã­  \r\n\r\n<script type=\"application/javascript\" src=\"https://embed.nicovideo.jp/watch/so28350805/script?w=320&h=180\"></script><noscript><a href=\"https://www.nicovideo.jp/watch/so28350805\">D.S. -Dal Segno- ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°ãƒ ãƒ¼ãƒ“ãƒ¼</a></noscript>\r\n\r\nãƒ’ãƒ­ã‚¤ãƒ³ã¿ã‚“ãªã‹ã‚ã„ã„ã®ã§ç½®ã„ã¦ãŠãã¾ã™ã­ã€‚  \r\nã‚¤ãƒ™ãƒ³ãƒˆCGãŒã‚ã£ã¡ã‚ƒã„ã„ã®ã§ã‚„ã£ã¦ã¿ã¦ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/qUF7Dcr.png)  \r\nå£°ãŒãµã‚ãµã‚ã—ã¦ã¦ã‹ã‚ã„ã„\r\n\r\n![Imgur](https://imgur.com/IY6kJjj.png)  \r\nã“ã“ä½•å›ã§ã‚‚èã‘ã‚‹\r\n\r\n![Imgur](https://imgur.com/TPRc8vg.png)  \r\nã‚ªãƒ³ã‚ªãƒ•åˆã£ãŸã»ã†ãŒã„ã„ã‚ˆã­\r\n\r\n![Imgur](https://imgur.com/jpRWjaJ.png)  \r\nå§‰ã•ã‚“å¥³æˆ¿ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/nOW8MqM.png)  \r\nãƒ•ã‚¡ãƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã«æœŸå¾…ã€ã€ï¼\r\n\r\nã©ã†ã‚„ã‚‰ãƒ•ã‚¡ãƒ³ãƒ‡ã‚£ã‚¹ã‚¯ã®æ–¹ã§ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆãƒãƒ¼ãƒ ã‚’å‘¼ã‚“ã§ãã‚Œã‚‹ã‚‰ã—ã„ï¼Ÿã®ã§æ°—ã«ãªã£ã¦ãŠã‚Šã¾ã™  \r\nãã‚Œã¯ãã‚Œã¨ã—ã¦ã˜ã‚ƒã‚ D.C.5 ã‚„ã‚‹ã‹ã‚‰ã¾ãŸã­\r\n\r\n# å‹•ç”»ã«æ–‡å­—ã‚’ã‹ã•ã­ã¦ã¿ãŸ\r\nâ†“ ã“ã‚“ãªæ„Ÿã˜ã« ãƒ†ã‚­ã‚¹ãƒˆã¨ãƒ‰ãƒ­ã‚¤ãƒ‰å›ï¼ˆç”»åƒï¼‰ é‡ã­ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦ã¿ã‚‹è©±ã§ã™ã€‚  \r\nå…ƒå‹•ç”»ã¯ã“ã‚Œï¼šhttps://nico.ms/sm36044089\r\n\r\n<video src=\"https://user-images.githubusercontent.com/32033405/219969962-999f71a9-2b55-484e-adfd-ad6f597431b9.mp4\" width=\"80%\" controls></video>\r\n\r\n![Imgur](https://imgur.com/vw7176n.png)\r\n\r\nhttps://github.com/takusan23/AkariDroid\r\n\r\nãŠæ­£æœˆã«è©¦ã—ã¦ãŸã“ã¨ã®è©±ã‚’ã—ã¾ã™ã€ã€ã€\r\n\r\n# äºŒç•ªç…ã˜\r\nhttps://www.sisik.eu/blog/android/media/add-text-to-video\r\n\r\nã¯ã„ã€‚\r\n\r\n# ã‚ã‚“ã©ã„ã‚“ã ã‘ã©ï¼Ÿ\r\næœ¬å½“ã«ï¼ˆã»ã‚“ã¨ã†ã«ï¼‰æœ€ä½é™ã®çŠ¶æ…‹ã§`MavenCentral`ã«å…¬é–‹ã—ãŸã®ã§ãŠè©¦ã—ã«ã¯ä½¿ãˆã‚‹ã‹ã‚‚ã€ã€ã€\r\n![Maven Central](https://img.shields.io/maven-central/v/io.github.takusan23/akaricore)\r\n\r\n```kotlin\r\nimplementation(\"io.github.takusan23:akaricore:1.0.0-alpha03\")\r\n```\r\n\r\næœ€ä½é™éãã¦ã“ã®è¨˜äº‹ã§ç´¹ä»‹ã™ã‚‹`éŸ³å£°ã®è¿½åŠ `éƒ¨åˆ†ã€`MediaStore`ã®éƒ¨åˆ†ã¯ã¾ã å­˜åœ¨ã—ãªã„ã®ã§è‡ªåˆ†ã§ä½œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    private val folder by lazy { File(getExternalFilesDir(null), \"video_edit\").apply { mkdir() } }\r\n    private val originVideoFile by lazy { File(folder, ORIGIN_VIDEO_FILE).apply { createNewFile() } }\r\n\r\n    private val videoPicker = registerForActivityResult(ActivityResultContracts.GetContent()) { uri ->\r\n        uri ?: return@registerForActivityResult\r\n        // å‹•ç”»ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n        originVideoFile.delete()\r\n        contentResolver.openInputStream(uri)?.use { inputStream ->\r\n            originVideoFile.outputStream().use { outputStream ->\r\n                inputStream.copyTo(outputStream)\r\n            }\r\n        }\r\n        videoProcessorStart()\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n        // å‹•ç”»ã‚’é¸æŠã™ã‚‹\r\n        videoPicker.launch(\"video/mp4\")\r\n    }\r\n\r\n    private fun videoProcessorStart() {\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®ãƒ•ã‚¡ã‚¤ãƒ«\r\n        val resultFile = File(folder, RESULT_VIDEO_FILE)\r\n        lifecycleScope.launch {\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n            val videoWidth = 1280\r\n            val videoHeight = 720\r\n\r\n            val textPaint = Paint().apply {\r\n                textSize = 100f\r\n            }\r\n            val logoBitmap = ContextCompat.getDrawable(this@MainActivity, R.drawable.ic_launcher_foreground)?.apply {\r\n                setTint(Color.WHITE)\r\n            }?.toBitmap(300, 300)!!\r\n\r\n            // Canvas ã«ã‹ã\r\n            // å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹\r\n            VideoCanvasProcessor.start(\r\n                videoFile = originVideoFile, // ã‚‚ã¨å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«\r\n                resultFile = resultFile, // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«\r\n                outputVideoWidth = videoWidth,\r\n                outputVideoHeight = videoHeight\r\n            ) { positionMs ->\r\n                // é©å½“ã«æ–‡å­—ã‚’æ›¸ã\r\n                val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(positionMs / 1000f)}\"\r\n\r\n                textPaint.color = Color.BLACK\r\n                textPaint.style = Paint.Style.STROKE\r\n                // æ å–ã‚Šæ–‡å­—\r\n                drawText(text, 200f, 300f, textPaint)\r\n\r\n                textPaint.style = Paint.Style.FILL\r\n                textPaint.color = Color.WHITE\r\n                // æ ç„¡ã—æ–‡å­—\r\n                drawText(text, 200f, 300f, textPaint)\r\n\r\n                // ç”»åƒã‚‚è¡¨ç¤ºã™ã‚‹\r\n                drawBitmap(logoBitmap, (videoWidth - logoBitmap.width).toFloat(), (videoHeight - logoBitmap.height).toFloat(), textPaint)\r\n            }\r\n\r\n            // éŸ³å£°ã®è¿½åŠ ãªã©\r\n            // MediaStore ã‚’ä½¿ã£ã¦ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«è¿½åŠ ã™ã‚‹ã¨ã‹\r\n            Toast.makeText(this@MainActivity, \"çµ‚äº†ã—ã¾ã—ãŸ\", Toast.LENGTH_SHORT).show()\r\n        }\r\n    }\r\n\r\n    companion object {\r\n        private const val ORIGIN_VIDEO_FILE = \"origin_video_file.mp4\"\r\n        private const val RESULT_VIDEO_FILE = \"result.mp4\"\r\n    }\r\n\r\n}\r\n```\r\n\r\n# MediaCodecã‚·ãƒªãƒ¼ã‚º\r\n\r\n- [å‹•ç”»ã‚’ã¤ãªã’ã‚‹](/posts/android_mediacodec_merge_video/)\r\n    - `MediaCodec` / `MediaExtractor` / `MediaMuxer` ã®é›‘ãªèª¬æ˜ãŒã‚ã‚Šã¾ã™\r\n        - èª¬æ˜ã¯ã“ã£ã¡ã«ä»»ã›ã¦æœ¬è¨˜äº‹ã§ã¯çœç•¥ã—ã¾ã™...\r\n    - https://github.com/takusan23/Coneco\r\n    - https://github.com/takusan23/AndroidMediaCodecVideoMerge\r\n- [ãªã‚“ã¡ã‚ƒã£ã¦ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’ã™ã‚‹](/posts/android_standalone_webm_livestreaming/)\r\n    - ã‚«ãƒ¡ãƒ©ã®å…¥åŠ›ã‚’`MediaCodec`ã«æ¸¡ã—ã¦ç´°åˆ‡ã‚Œãª`WebM`ã‚’ä½œã£ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§è¦‹ã‚‹\r\n    - https://github.com/takusan23/AndroidWebMDashLive\r\n\r\n# Android ã§æ–‡å­—ã‚’å‹•ç”»ã«ã‹ã•ã­ã‚‹ã«ã¯\r\n`FFmpeg`ã¨ã‹ã‚’åˆ©ç”¨ã—ãªã„å ´åˆã€`MediaCodec`ã‚’ãã®ã¾ã¾ä½¿ã†ã—ã‹ãªã„ã§ã™ã€‚ï¼ˆä½¿ã„ã«ãã„ã‚„ã¤ï¼‰  \r\n\r\nã“ã‚Œã®ãã®ã¾ã¾ã§ã™ãŒ  \r\nhttps://speakerdeck.com/masayukisuda/mediacodecdedong-hua-bian-ji-wositemiyou\r\n\r\n- MediaExtractorã§å‹•ç”»ã‚’å–ã‚Šå‡ºã—ã¦\r\n- MediaCodecã§å‹•ç”»ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦\r\n- Canvasã§æ–‡å­—ã‚’æ›¸ã\r\n    - Androidã®Canvasã«æ›¸ã‘ã‚Œã°å›³å½¢ã§ã‚‚ç”»åƒã§ã‚‚è¡Œã‘ã‚‹ã¯ãš\r\n- OpenGLã§å‹•ç”»ã¨Canvasã‚’æç”»ã™ã‚‹\r\n- OpenGLã®å‡ºåŠ›ã‚’ã‚‚ã¨ã«MediaCodecã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‹ã‚‰\r\n- ç¹°ã‚Šè¿”ã™\r\n\r\n`OpenGL`ã‚’ä½¿ã†ç†ç”±ã§ã™ãŒã€`MediaCodec`ã®å…¥åŠ›ç”¨`Surface`ã§ã¯`lockCanvas`ã‚’ä½¿ã£ã¦ã®æç”»ãŒã§ããªã„ã“ã¨ãŒæ›¸ã‹ã‚Œã¦ã„ã¾ã™ã€‚  \r\n\r\nhttps://developer.android.com/reference/android/media/MediaCodec#createInputSurface()\r\n\r\n# å‹•ç”»é–¢ä¿‚ã®ãƒ¡ãƒ¢\r\n\r\n## ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨ã‚³ãƒ³ãƒ†ãƒŠ\r\nä¸€å¿œç½®ã„ã¦ãŠãã¾ã™\r\n\r\n- ã‚³ãƒ³ãƒ†ãƒŠ\r\n    - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸæ˜ åƒã¨éŸ³å£°ã‚’ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹ãŸã‚ã®æŠ€è¡“\r\n    - AAC / H.264 (AVC) ã¯ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®ç¨®é¡ãªã®ã§é–“é•ã„\r\n        - mp4\r\n        - mpeg2-ts\r\n        - WebM\r\n- ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\n    - æ˜ åƒã€éŸ³å£°ã‚’åœ§ç¸®ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ \r\n        - åœ§ç¸®ã™ã‚‹ä½œæ¥­ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¨ã‹ã„ã„ã¾ã™\r\n        - é€†ã«å†ç”Ÿã™ã‚‹ãŸã‚ã«æˆ»ã™ä½œæ¥­ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã¨ã„ã„ã¾ã™\r\n    - ãƒ‘ãƒ©ãƒ‘ãƒ©æ¼«ç”»ã«ã™ã‚‹ã‚ˆã‚Šã‚‚å‹•ç”»ã«ã™ã‚‹ã»ã†ãŒå®¹é‡ãŒå°ã•ã„ã®ã¯ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãŒåœ§ç¸®ã—ã¦ã„ã‚‹ã‹ã‚‰\r\n        - AAC\r\n            - éŸ³å£°\r\n        - Opus\r\n            - éŸ³å£°\r\n            - JavaScript ã® MediaRecorder ã¯ã“ã‚ŒãŒæ¡ç”¨ã•ã‚Œã¦ã„ãŸã‹ãª\r\n        - H.264 / AVC\r\n            - æ˜ åƒ\r\n        - H.265 / HEVC\r\n            - æ˜ åƒ\r\n            - H.264 ã®åŠåˆ†ã§åŒã˜ç”»è³ªã¨è¨€ã‚ã‚Œã¦ã„ã‚‹(ã¤ã¾ã‚Šå®¹é‡åŠåˆ†)\r\n            - ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒªã«ã‚ˆã£ã¦ã¯ H.265 ã‚’åˆ©ç”¨ã—ã¦å®¹é‡ã‚’ç¯€ç´„ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã£ãŸã‚Š\r\n        - VP9\r\n            - æ˜ åƒ\r\n            - JavaScript ã® MediaRecorder ã§ä½¿ãˆãŸã‚ˆã†ãªï¼Ÿ\r\n            - H.265 ã® Google ãƒãƒ¼ã‚¸ãƒ§ãƒ³\r\n\r\n# ã¤ãã‚‹\r\nOpenGLã®éƒ¨åˆ†ã¨ã‹ã¯ã»ã¼ã‚³ãƒ”ãƒ¼ã§ã™\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                      |\r\n|----------------|-----------------------------|\r\n| è¨€èª           | Kotlin / OpenGL (ä¸€éƒ¨)      |\r\n| targetSdk      | 33                          |\r\n| Android Studio | Android Studio Electric Eel |\r\n| ãŸã‚“ã¾ã¤       | Xperia Pro-I Android 13     |\r\n\r\n# app/build.gradle\r\n`app/build.gradle`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚  \r\n`ViewBinding`ã¨æœ€ä½é™ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’\r\n\r\n```gradle\r\n\r\nandroid {\r\n    namespace 'io.github.takusan23.androidmediacodecaddcanvastexttovideo'\r\n    compileSdk 33\r\n\r\n    // çœç•¥...\r\n\r\n    buildFeatures {\r\n        viewBinding true\r\n    }\r\n\r\n    // çœç•¥...\r\n\r\n}\r\n\r\ndependencies {\r\n\r\n    // lifecycleScope\r\n    implementation 'androidx.lifecycle:lifecycle-runtime-ktx:2.5.1'\r\n\r\n    // çœç•¥...\r\n}\r\n```\r\n\r\n# activity_main.xml\r\nå‹•ç”»ã‚’é¸æŠã™ã‚‹ãƒœã‚¿ãƒ³ã¨ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ãƒœã‚¿ãƒ³ã¨ã€ç¾åœ¨ã®çŠ¶æ…‹ã‚’è¡¨ã™TextView ã‚’ç½®ãã¾ã—ãŸã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <Button\r\n        android:id=\"@+id/video_select_button\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠã™ã‚‹\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/encode_button\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/encode_status_text_view\" />\r\n\r\n    <TextView\r\n        android:id=\"@+id/encode_status_text_view\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å‰\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/video_select_button\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/encode_button\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintHorizontal_bias=\"0.5\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/video_select_button\" />\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n## å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\nã¾ãšã¯å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒ—ãƒªã®å›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹éƒ¨åˆ†ã‚’ä½œã‚Šã¾ã™ã€‚  \r\n`Uri`ã ã¨ä½¿ã„ã«ãã„ã®ã§ã€ä¸€æ—¦`Context#getExternalFilesDir`ã®é ˜åŸŸã«ä¿å­˜ã—ã¾ã™ã€‚ãã®é ˜åŸŸã§ã¯`Java File API`ãŒä½¿ãˆã‚‹ã®ã§ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val workFolder by lazy { File(getExternalFilesDir(null), \"video\").apply { mkdir() } }\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    /** å‹•ç”»ãƒ”ãƒƒã‚«ãƒ¼ */\r\n    private val videoPicker = registerForActivityResult(ActivityResultContracts.GetContent()) { uri ->\r\n        uri ?: return@registerForActivityResult\r\n        // ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n        lifecycleScope.launch(Dispatchers.IO) {\r\n            val videoFile = File(workFolder, VIDEO_FILE_NAME).apply {\r\n                createNewFile()\r\n            }\r\n            videoFile.outputStream().use { outputStream ->\r\n                contentResolver.openInputStream(uri)?.use { inputStream ->\r\n                    inputStream.copyTo(outputStream)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        // å‹•ç”»ã‚’é¸æŠã™ã‚‹\r\n        viewBinding.videoSelectButton.setOnClickListener {\r\n            videoPicker.launch(\"video/mp4\")\r\n        }\r\n\r\n    }\r\n\r\n    companion object {\r\n        /** ã‹ã•ã­ã‚‹å‹•ç”»ã®ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n        private const val VIDEO_FILE_NAME = \"origin_video_file.mp4\"\r\n    }\r\n\r\n}\r\n```\r\n\r\n## OpenGL ã®ç”¨æ„ã‚’ã™ã‚‹\r\nAOSPã®CTSãƒ†ã‚¹ãƒˆã¨ã‹ã§ã‚‚ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚„ã¤ã§ã™ã­ã€‚  \r\nhttps://cs.android.com/android/platform/superproject/+/master:cts/tests/tests/media/src/android/media/cts/InputSurface.java\r\n\r\n### CodecInputSurface.kt\r\n`GLSurfaceView`ã¨ã‹ã¯ã“ã®è¾ºæ„è­˜ã—ãªãã¦ã‚‚ã„ããªã‚Š`OpenGL`ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æ›¸ãã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã‚‰ã‚Œã‚‹ã®ã§è‰¯ã„ã§ã™ã­ã€ã€ã€  \r\nã‚ˆãçŸ¥ã‚‰ãªã„ã®ã§ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€ã€ã€\r\n\r\n```kotlin\r\n/*\r\n * https://android.googlesource.com/platform/cts/+/jb-mr2-release/tests/tests/media/src/android/media/cts/InputSurface.java\r\n *\r\n * Copyright (C) 2013 The Android Open Source Project\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *      http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\n\r\n/**\r\n * MediaCodecã§ä½¿ã†OpenGLã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\n *\r\n * Holds state associated with a Surface used for MediaCodec encoder input.\r\n * The constructor takes a Surface obtained from MediaCodec.createInputSurface(), and uses that\r\n * to create an EGL window surface.  Calls to eglSwapBuffers() cause a frame of data to be sent\r\n * to the video encoder.\r\n *\r\n * @param surface MediaCodecã§ã‚‚ã‚‰ãˆã‚‹createInputSurface\r\n */\r\nclass CodecInputSurface(\r\n    private val surface: Surface,\r\n    private val textureRenderer: TextureRenderer,\r\n) : SurfaceTexture.OnFrameAvailableListener {\r\n\r\n    private var mEGLDisplay = EGL14.EGL_NO_DISPLAY\r\n    private var mEGLContext = EGL14.EGL_NO_CONTEXT\r\n    private var mEGLSurface = EGL14.EGL_NO_SURFACE\r\n    private val mFrameSyncObject = Object()\r\n    private var mFrameAvailable = false\r\n    private var surfaceTexture: SurfaceTexture? = null\r\n\r\n    /** MediaCodecã®ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼Surfaceã¨ã—ã¦ã“ã‚Œã‚’ä½¿ã† */\r\n    var drawSurface: Surface? = null\r\n        private set\r\n\r\n    init {\r\n        eglSetup()\r\n    }\r\n\r\n    fun createRender() {\r\n        textureRenderer.surfaceCreated()\r\n        surfaceTexture = SurfaceTexture(textureRenderer.videoTextureID).also { surfaceTexture ->\r\n            surfaceTexture.setOnFrameAvailableListener(this)\r\n        }\r\n        drawSurface = Surface(surfaceTexture)\r\n    }\r\n\r\n    /**\r\n     * Prepares EGL.  We want a GLES 2.0 context and a surface that supports recording.\r\n     */\r\n    private fun eglSetup() {\r\n        mEGLDisplay = EGL14.eglGetDisplay(EGL14.EGL_DEFAULT_DISPLAY)\r\n        if (mEGLDisplay == EGL14.EGL_NO_DISPLAY) {\r\n            throw RuntimeException(\"unable to get EGL14 display\")\r\n        }\r\n        val version = IntArray(2)\r\n        if (!EGL14.eglInitialize(mEGLDisplay, version, 0, version, 1)) {\r\n            throw RuntimeException(\"unable to initialize EGL14\")\r\n        }\r\n        // Configure EGL for recording and OpenGL ES 2.0.\r\n        val attribList = intArrayOf(\r\n            EGL14.EGL_RED_SIZE, 8,\r\n            EGL14.EGL_GREEN_SIZE, 8,\r\n            EGL14.EGL_BLUE_SIZE, 8,\r\n            EGL14.EGL_ALPHA_SIZE, 8,\r\n            EGL14.EGL_RENDERABLE_TYPE, EGL14.EGL_OPENGL_ES2_BIT,\r\n            EGL_RECORDABLE_ANDROID, 1,\r\n            EGL14.EGL_NONE\r\n        )\r\n        val configs = arrayOfNulls<EGLConfig>(1)\r\n        val numConfigs = IntArray(1)\r\n        EGL14.eglChooseConfig(mEGLDisplay, attribList, 0, configs, 0, configs.size, numConfigs, 0)\r\n        checkEglError(\"eglCreateContext RGB888+recordable ES2\")\r\n\r\n        // Configure context for OpenGL ES 2.0.\r\n        val attrib_list = intArrayOf(\r\n            EGL14.EGL_CONTEXT_CLIENT_VERSION, 2,\r\n            EGL14.EGL_NONE\r\n        )\r\n        mEGLContext = EGL14.eglCreateContext(\r\n            mEGLDisplay, configs[0], EGL14.EGL_NO_CONTEXT,\r\n            attrib_list, 0\r\n        )\r\n        checkEglError(\"eglCreateContext\")\r\n\r\n        // Create a window surface, and attach it to the Surface we received.\r\n        val surfaceAttribs = intArrayOf(\r\n            EGL14.EGL_NONE\r\n        )\r\n        mEGLSurface = EGL14.eglCreateWindowSurface(mEGLDisplay, configs[0], surface, surfaceAttribs, 0)\r\n        checkEglError(\"eglCreateWindowSurface\")\r\n    }\r\n\r\n    fun changeFragmentShader(fragmentShader: String) {\r\n        textureRenderer.changeFragmentShader(fragmentShader)\r\n    }\r\n\r\n    fun awaitNewImage() {\r\n        val TIMEOUT_MS = 5000\r\n        synchronized(mFrameSyncObject) {\r\n            while (!mFrameAvailable) {\r\n                try {\r\n                    mFrameSyncObject.wait(TIMEOUT_MS.toLong())\r\n                    if (!mFrameAvailable) {\r\n                        throw RuntimeException(\"Surface frame wait timed out\")\r\n                    }\r\n                } catch (ie: InterruptedException) {\r\n                    throw RuntimeException(ie)\r\n                }\r\n            }\r\n            mFrameAvailable = false\r\n        }\r\n        textureRenderer.checkGlError(\"before updateTexImage\")\r\n        surfaceTexture?.updateTexImage()\r\n    }\r\n\r\n    /**\r\n     * ãƒ•ãƒ¬ãƒ¼ãƒ ãŒæ¥ãŸã‚‰æç”»ã™ã‚‹\r\n     *\r\n     * @param onCanvasDrawRequest Canvasã‚’æ¸¡ã™ã®ã§æç”»ã—ã¦è¿”ã—ã¦ãã ã•ã„\r\n     */\r\n    fun drawImage(onCanvasDrawRequest: (Canvas) -> Unit) {\r\n        val surfaceTexture = surfaceTexture ?: return\r\n        textureRenderer.prepareDraw()\r\n        textureRenderer.drawFrame(surfaceTexture)\r\n        textureRenderer.drawCanvas(onCanvasDrawRequest)\r\n        textureRenderer.invokeGlFinish()\r\n    }\r\n\r\n    override fun onFrameAvailable(st: SurfaceTexture) {\r\n        synchronized(mFrameSyncObject) {\r\n            if (mFrameAvailable) {\r\n                throw RuntimeException(\"mFrameAvailable already set, frame could be dropped\")\r\n            }\r\n            mFrameAvailable = true\r\n            mFrameSyncObject.notifyAll()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Discards all resources held by this class, notably the EGL context.  Also releases the\r\n     * Surface that was passed to our constructor.\r\n     */\r\n    fun release() {\r\n        if (mEGLDisplay != EGL14.EGL_NO_DISPLAY) {\r\n            EGL14.eglMakeCurrent(mEGLDisplay, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_CONTEXT)\r\n            EGL14.eglDestroySurface(mEGLDisplay, mEGLSurface)\r\n            EGL14.eglDestroyContext(mEGLDisplay, mEGLContext)\r\n            EGL14.eglReleaseThread()\r\n            EGL14.eglTerminate(mEGLDisplay)\r\n        }\r\n        surface.release()\r\n        mEGLDisplay = EGL14.EGL_NO_DISPLAY\r\n        mEGLContext = EGL14.EGL_NO_CONTEXT\r\n        mEGLSurface = EGL14.EGL_NO_SURFACE\r\n    }\r\n\r\n    /**\r\n     * Makes our EGL context and surface current.\r\n     */\r\n    fun makeCurrent() {\r\n        EGL14.eglMakeCurrent(mEGLDisplay, mEGLSurface, mEGLSurface, mEGLContext)\r\n        checkEglError(\"eglMakeCurrent\")\r\n    }\r\n\r\n    /**\r\n     * Calls eglSwapBuffers.  Use this to \"publish\" the current frame.\r\n     */\r\n    fun swapBuffers(): Boolean {\r\n        val result = EGL14.eglSwapBuffers(mEGLDisplay, mEGLSurface)\r\n        checkEglError(\"eglSwapBuffers\")\r\n        return result\r\n    }\r\n\r\n    /**\r\n     * Sends the presentation time stamp to EGL.  Time is expressed in nanoseconds.\r\n     */\r\n    fun setPresentationTime(nsecs: Long) {\r\n        EGLExt.eglPresentationTimeANDROID(mEGLDisplay, mEGLSurface, nsecs)\r\n        checkEglError(\"eglPresentationTimeANDROID\")\r\n    }\r\n\r\n    /**\r\n     * Checks for EGL errors.  Throws an exception if one is found.\r\n     */\r\n    private fun checkEglError(msg: String) {\r\n        val error = EGL14.eglGetError()\r\n        if (error != EGL14.EGL_SUCCESS) {\r\n            throw RuntimeException(\"$msg: EGL error: 0x${Integer.toHexString(error)}\")\r\n        }\r\n    }\r\n\r\n    companion object {\r\n        private const val EGL_RECORDABLE_ANDROID = 0x3142\r\n    }\r\n\r\n}\r\n```\r\n\r\n### TextureRenderer.kt\r\nã“ã¡ã‚‰ã¯æ˜ åƒã¨Canvasã‚’OpenGLã‚’åˆ©ç”¨ã—ã¦ã‹ã•ã­ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã§ã™ã€‚  \r\nã¾ãšã‚³ãƒ¼ãƒ‰å…¨æ–‡ã‚’\r\n\r\n```kotlin\r\n/**\r\n * OpenGLé–¢é€£\r\n * æ˜ åƒã«Canvasã‚’é‡ã­ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã™ã€‚\r\n * æ˜ åƒã‚’æç”»ã—ãŸã‚ã¨ã«Canvasã‚’æç”»ã™ã‚‹ã€‚äºŒå›å››è§’å½¢ã‚’æç”»ã—ã¦ã„ã‚‹ã€‚\r\n *\r\n * @param outputVideoWidth ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ™‚ã®å‹•ç”»ã®å¹…\r\n * @param outputVideoHeight ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ™‚ã®å‹•ç”»ã®é«˜ã•\r\n * @param originVideoWidth å…ƒå‹•ç”»ã®å¹…\r\n * @param originVideoHeight å…ƒå‹•ç”»ã®é«˜ã•\r\n * @param videoRotation æ˜ åƒã‚’å›è»¢ã•ã›ã‚‹å ´åˆã«åˆ©ç”¨\r\n */\r\nclass TextureRenderer(\r\n    private val outputVideoWidth: Int,\r\n    private val outputVideoHeight: Int,\r\n    private val originVideoHeight: Int,\r\n    private val originVideoWidth: Int,\r\n    private val videoRotation: Float\r\n) {\r\n\r\n    private var mTriangleVertices = ByteBuffer.allocateDirect(mTriangleVerticesData.size * FLOAT_SIZE_BYTES).run {\r\n        order(ByteOrder.nativeOrder())\r\n        asFloatBuffer().apply {\r\n            put(mTriangleVerticesData)\r\n            position(0)\r\n        }\r\n    }\r\n\r\n    private val mMVPMatrix = FloatArray(16)\r\n    private val mSTMatrix = FloatArray(16)\r\n\r\n    /** Canvasã§æ›¸ã„ãŸBitmapã€‚Canvasã®å†…å®¹ã‚’OpenGLã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦åˆ©ç”¨ */\r\n    private val canvasBitmap by lazy { Bitmap.createBitmap(outputVideoWidth, outputVideoHeight, Bitmap.Config.ARGB_8888) }\r\n\r\n    /** Canvasã€‚ã“ã‚ŒãŒã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«è¡Œã */\r\n    private val canvas by lazy { Canvas(canvasBitmap) }\r\n\r\n    // ãƒãƒ³ãƒ‰ãƒ«ãŸã¡\r\n    private var mProgram = 0\r\n    private var muMVPMatrixHandle = 0\r\n    private var muSTMatrixHandle = 0\r\n    private var maPositionHandle = 0\r\n    private var maTextureHandle = 0\r\n    private var uCanvasTextureHandle = 0\r\n    private var uVideoTextureHandle = 0\r\n    private var uDrawVideo = 0\r\n\r\n    /** ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ç”»åƒã‚’æ¸¡ã™OpenGLã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ID */\r\n    private var canvasTextureID = -1\r\n\r\n    /** ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœãŒæµã‚Œã¦ãã‚‹OpenGLã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ID */\r\n    var videoTextureID = -1\r\n        private set\r\n\r\n    init {\r\n        Matrix.setIdentityM(mSTMatrix, 0)\r\n    }\r\n\r\n    /** æç”»å‰ã«å‘¼ã³å‡ºã™ */\r\n    fun prepareDraw() {\r\n        // glError 1282 ã®åŸå› ã¨ã‹ã«ãªã‚‹\r\n        GLES20.glUseProgram(mProgram)\r\n        checkGlError(\"glUseProgram\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_POS_OFFSET)\r\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maPosition\")\r\n        GLES20.glEnableVertexAttribArray(maPositionHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maPositionHandle\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_UV_OFFSET)\r\n        GLES20.glVertexAttribPointer(maTextureHandle, 2, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maTextureHandle\")\r\n        GLES20.glEnableVertexAttribArray(maTextureHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maTextureHandle\")\r\n\r\n        // Snapdragon ã ã¨ glClear ãŒç„¡ã„ã¨æ˜ åƒãŒä¹±ã‚Œã‚‹\r\n        GLES20.glClear(GLES20.GL_DEPTH_BUFFER_BIT or GLES20.GL_COLOR_BUFFER_BIT)\r\n    }\r\n\r\n    /**\r\n     * ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æç”»ã™ã‚‹\r\n     *\r\n     * @param surfaceTexture [SurfaceTexture]\r\n     */\r\n    fun drawFrame(surfaceTexture: SurfaceTexture) {\r\n        checkGlError(\"onDrawFrame start\")\r\n        surfaceTexture.getTransformMatrix(mSTMatrix)\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)\r\n        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, videoTextureID)\r\n        // æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¦ãƒ‹ãƒƒãƒˆã¯ GLES20.GL_TEXTURE0 ãªã®ã§ 0\r\n        GLES20.glUniform1i(uVideoTextureHandle, 0)\r\n        // Canvasã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ãƒ¦ãƒ‹ãƒƒãƒˆã¯ GLES20.GL_TEXTURE1 ãªã®ã§ 1\r\n        GLES20.glUniform1i(uCanvasTextureHandle, 1)\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_POS_OFFSET)\r\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maPosition\")\r\n        GLES20.glEnableVertexAttribArray(maPositionHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maPositionHandle\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_UV_OFFSET)\r\n        GLES20.glVertexAttribPointer(maTextureHandle, 2, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maTextureHandle\")\r\n        GLES20.glEnableVertexAttribArray(maTextureHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maTextureHandle\")\r\n        // ----\r\n        // æ˜ åƒã‚’æç”»ã™ã‚‹ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n        // ----\r\n        GLES20.glUniform1i(uDrawVideo, 1)\r\n        // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’èª¿æ•´ã™ã‚‹\r\n        Matrix.setIdentityM(mMVPMatrix, 0)\r\n\r\n        // æ¨ªå¹…ã‚’è¨ˆç®—ã—ã¦åˆã‚ã›ã‚‹\r\n        // ç¸¦ã¯ outputHeight æœ€å¤§ã¾ã§\r\n        val scaleY = (outputVideoHeight / originVideoHeight.toFloat())\r\n        val textureWidth = originVideoWidth * scaleY\r\n        val percent = textureWidth / outputVideoWidth.toFloat()\r\n        Matrix.scaleM(mMVPMatrix, 0, percent, 1f, 1f)\r\n\r\n        // å‹•ç”»ãŒå›è»¢ã—ã¦ã„ã‚‹å ´åˆã«æˆ»ã™\r\n        Matrix.rotateM(mMVPMatrix, 0, videoRotation, 0f, 0f, 1f)\r\n\r\n        // æç”»ã™ã‚‹\r\n        GLES20.glUniformMatrix4fv(muSTMatrixHandle, 1, false, mSTMatrix, 0)\r\n        GLES20.glUniformMatrix4fv(muMVPMatrixHandle, 1, false, mMVPMatrix, 0)\r\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4)\r\n        checkGlError(\"glDrawArrays VideoFrame\")\r\n    }\r\n\r\n    /**\r\n     * Canvas ã«æ›¸ã„ã¦ OpenGL ã§æç”»ã™ã‚‹ã€‚\r\n     * [drawFrame]ã®ã‚ã¨ã«å‘¼ã³å‡ºã™å¿…è¦ã‚ã‚Šã€‚\r\n     *\r\n     * @param onCanvasDrawRequest Canvasã‚’æ¸¡ã™ã®ã§æç”»ã—ã¦è¿”ã—ã¦ãã ã•ã„\r\n     */\r\n    fun drawCanvas(onCanvasDrawRequest: (Canvas) -> Unit) {\r\n        checkGlError(\"drawCanvas start\")\r\n        // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’Canvasã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã«åˆ‡ã‚Šæ›¿ãˆã‚‹\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)\r\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, canvasTextureID)\r\n        // ç¸®å°æ‹¡å¤§æ™‚ã®è£œé–“è¨­å®š\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)\r\n        // å‰å›ã®ã‚’æ¶ˆã™\r\n        canvas.drawColor(0, PorterDuff.Mode.CLEAR)\r\n        // Canvasã§æ›¸ã\r\n        onCanvasDrawRequest(canvas)\r\n        // glActiveTexture ã—ãŸãƒ†ã‚¯ã‚¹ãƒãƒ£ã¸Canvasã§æ›¸ã„ãŸç”»åƒã‚’è»¢é€ã™ã‚‹\r\n        // æ›´æ–°ãªã®ã§ texSubImage2D\r\n        GLUtils.texSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, canvasBitmap)\r\n        checkGlError(\"GLUtils.texSubImage2D canvasTextureID\")\r\n        // Uniform å¤‰æ•°ã¸ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’è¨­å®š\r\n        // ç¬¬äºŒå¼•æ•°ã® 1 ã£ã¦ä½•ã€ã€ã€ï¼ˆGLES20.GL_TEXTURE1 ã ã‹ã‚‰ï¼Ÿï¼‰\r\n        GLES20.glUniform1i(uCanvasTextureHandle, 1)\r\n        checkGlError(\"glUniform1i uCanvasTextureHandle\")\r\n        // ----\r\n        // Canvasã‚’æç”»ã™ã‚‹ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n        // ----\r\n        GLES20.glUniform1i(uDrawVideo, 0)\r\n        // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã®èª¿æ•´ã¯ã„ã‚‰ãªã„ã®ã§ãƒªã‚»ãƒƒãƒˆï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®å‡ºåŠ›ã‚µã‚¤ã‚ºã«Canvasã‚’åˆã‚ã›ã¦ä½œã£ã¦ã„ã‚‹ãŸã‚ï¼‰\r\n        Matrix.setIdentityM(mMVPMatrix, 0)\r\n        // æç”»ã™ã‚‹\r\n        GLES20.glUniformMatrix4fv(muSTMatrixHandle, 1, false, mSTMatrix, 0)\r\n        GLES20.glUniformMatrix4fv(muMVPMatrixHandle, 1, false, mMVPMatrix, 0)\r\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4)\r\n        checkGlError(\"glDrawArrays Canvas\")\r\n    }\r\n\r\n    /** glFinish ã‚’ã‚ˆã³ã ã™ */\r\n    fun invokeGlFinish() {\r\n        GLES20.glFinish()\r\n    }\r\n\r\n    fun surfaceCreated() {\r\n        mProgram = createProgram(VERTEX_SHADER, FRAGMENT_SHADER)\r\n        if (mProgram == 0) {\r\n            throw RuntimeException(\"failed creating program\")\r\n        }\r\n        maPositionHandle = GLES20.glGetAttribLocation(mProgram, \"aPosition\")\r\n        checkGlError(\"glGetAttribLocation aPosition\")\r\n        if (maPositionHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for aPosition\")\r\n        }\r\n        maTextureHandle = GLES20.glGetAttribLocation(mProgram, \"aTextureCoord\")\r\n        checkGlError(\"glGetAttribLocation aTextureCoord\")\r\n        if (maTextureHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for aTextureCoord\")\r\n        }\r\n        muMVPMatrixHandle = GLES20.glGetUniformLocation(mProgram, \"uMVPMatrix\")\r\n        checkGlError(\"glGetUniformLocation uMVPMatrix\")\r\n        if (muMVPMatrixHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uMVPMatrix\")\r\n        }\r\n        muSTMatrixHandle = GLES20.glGetUniformLocation(mProgram, \"uSTMatrix\")\r\n        checkGlError(\"glGetUniformLocation uSTMatrix\")\r\n        if (muSTMatrixHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uSTMatrix\")\r\n        }\r\n        uCanvasTextureHandle = GLES20.glGetUniformLocation(mProgram, \"uCanvasTexture\")\r\n        uVideoTextureHandle = GLES20.glGetUniformLocation(mProgram, \"uVideoTexture\")\r\n        uDrawVideo = GLES20.glGetUniformLocation(mProgram, \"uDrawVideo\")\r\n\r\n        // æ˜ åƒãŒå…¥ã£ã¦ãã‚‹ãƒ†ã‚¯ã‚¹ãƒãƒ£ã€Canvasã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ç™»éŒ²ã™ã‚‹\r\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£2ã¤ä½œã‚‹\r\n        val textures = IntArray(2)\r\n        GLES20.glGenTextures(2, textures, 0)\r\n\r\n        // æ˜ åƒãƒ†ã‚¯ã‚¹ãƒãƒ£\r\n        videoTextureID = textures[0]\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)\r\n        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, videoTextureID)\r\n        checkGlError(\"glBindTexture videoTextureID\")\r\n\r\n        GLES20.glTexParameterf(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_NEAREST.toFloat())\r\n        GLES20.glTexParameterf(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR.toFloat())\r\n        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE)\r\n        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE)\r\n        checkGlError(\"glTexParameter videoTextureID\")\r\n\r\n        // Canvasãƒ†ã‚¯ã‚¹ãƒãƒ£\r\n        canvasTextureID = textures[1]\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)\r\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, canvasTextureID)\r\n        checkGlError(\"glBindTexture canvasTextureID\")\r\n\r\n        // ç¸®å°æ‹¡å¤§æ™‚ã®è£œé–“è¨­å®š\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)\r\n\r\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’åˆæœŸåŒ–\r\n        // æ›´æ–°ã®éš›ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆãŸä¸Šã§ texSubImage2D ã‚’ä½¿ã†\r\n        GLUtils.texImage2D(GLES20.GL_TEXTURE_2D, 0, canvasBitmap, 0)\r\n        checkGlError(\"glTexParameter canvasTextureID\")\r\n\r\n        // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚’æœ‰åŠ¹\r\n        // ã“ã‚Œã«ã‚ˆã‚Šã€é€æ˜ãªãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒã¡ã‚ƒã‚“ã¨é€æ˜ã«æç”»ã•ã‚Œã‚‹\r\n        GLES20.glEnable(GLES20.GL_BLEND)\r\n        GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)\r\n        checkGlError(\"glEnable BLEND\")\r\n    }\r\n\r\n    fun changeFragmentShader(fragmentShader: String) {\r\n        GLES20.glDeleteProgram(mProgram)\r\n        mProgram = createProgram(VERTEX_SHADER, fragmentShader)\r\n        if (mProgram == 0) {\r\n            throw RuntimeException(\"failed creating program\")\r\n        }\r\n    }\r\n\r\n    private fun loadShader(shaderType: Int, source: String): Int {\r\n        var shader = GLES20.glCreateShader(shaderType)\r\n        checkGlError(\"glCreateShader type=$shaderType\")\r\n        GLES20.glShaderSource(shader, source)\r\n        GLES20.glCompileShader(shader)\r\n        val compiled = IntArray(1)\r\n        GLES20.glGetShaderiv(shader, GLES20.GL_COMPILE_STATUS, compiled, 0)\r\n        if (compiled[0] == 0) {\r\n            GLES20.glDeleteShader(shader)\r\n            shader = 0\r\n        }\r\n        return shader\r\n    }\r\n\r\n    private fun createProgram(vertexSource: String, fragmentSource: String): Int {\r\n        val vertexShader = loadShader(GLES20.GL_VERTEX_SHADER, vertexSource)\r\n        if (vertexShader == 0) {\r\n            return 0\r\n        }\r\n        val pixelShader = loadShader(GLES20.GL_FRAGMENT_SHADER, fragmentSource)\r\n        if (pixelShader == 0) {\r\n            return 0\r\n        }\r\n        var program = GLES20.glCreateProgram()\r\n        checkGlError(\"glCreateProgram\")\r\n        if (program == 0) {\r\n            return 0\r\n        }\r\n        GLES20.glAttachShader(program, vertexShader)\r\n        checkGlError(\"glAttachShader\")\r\n        GLES20.glAttachShader(program, pixelShader)\r\n        checkGlError(\"glAttachShader\")\r\n        GLES20.glLinkProgram(program)\r\n        val linkStatus = IntArray(1)\r\n        GLES20.glGetProgramiv(program, GLES20.GL_LINK_STATUS, linkStatus, 0)\r\n        if (linkStatus[0] != GLES20.GL_TRUE) {\r\n            GLES20.glDeleteProgram(program)\r\n            program = 0\r\n        }\r\n        return program\r\n    }\r\n\r\n    fun checkGlError(op: String) {\r\n        val error = GLES20.glGetError()\r\n        if (error != GLES20.GL_NO_ERROR) {\r\n            throw RuntimeException(\"$op: glError $error\")\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        private val mTriangleVerticesData = floatArrayOf(\r\n            -1.0f, -1.0f, 0f, 0f, 0f,\r\n            1.0f, -1.0f, 0f, 1f, 0f,\r\n            -1.0f, 1.0f, 0f, 0f, 1f,\r\n            1.0f, 1.0f, 0f, 1f, 1f\r\n        )\r\n\r\n        private const val FLOAT_SIZE_BYTES = 4\r\n        private const val TRIANGLE_VERTICES_DATA_STRIDE_BYTES = 5 * FLOAT_SIZE_BYTES\r\n        private const val TRIANGLE_VERTICES_DATA_POS_OFFSET = 0\r\n        private const val TRIANGLE_VERTICES_DATA_UV_OFFSET = 3\r\n\r\n        /** ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã€‚åº§æ¨™ãªã©ã‚’æ±ºã‚ã‚‹ */\r\n        private const val VERTEX_SHADER = \"\"\"\r\n            uniform mat4 uMVPMatrix;\r\n            uniform mat4 uSTMatrix;\r\n            attribute vec4 aPosition;\r\n            attribute vec4 aTextureCoord;\r\n            varying vec2 vTextureCoord;\r\n            \r\n            void main() {\r\n              gl_Position = uMVPMatrix * aPosition;\r\n              vTextureCoord = (uSTMatrix * aTextureCoord).xy;\r\n            }\r\n        \"\"\"\r\n\r\n        /** ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã€‚å®Ÿéš›ã®è‰²ã‚’è¿”ã™ */\r\n        private const val FRAGMENT_SHADER = \"\"\"\r\n            #extension GL_OES_EGL_image_external : require\r\n\r\n            precision mediump float;\r\n            varying vec2 vTextureCoord;\r\n            uniform samplerExternalOES uVideoTexture;        \r\n            uniform sampler2D uCanvasTexture;\r\n            \r\n            // æ˜ åƒã‚’æç”»ã™ã‚‹ã®ã‹ã€Canvasã‚’æç”»ã™ã‚‹ã®ã‹ã®ãƒ•ãƒ©ã‚°\r\n            uniform int uDrawVideo;\r\n        \r\n            void main() {\r\n                vec4 videoTexture = texture2D(uVideoTexture, vTextureCoord);\r\n                vec4 canvasTexture = texture2D(uCanvasTexture, vTextureCoord);\r\n                \r\n                if (bool(uDrawVideo)) {\r\n                    gl_FragColor = videoTexture;                \r\n                } else {\r\n                    gl_FragColor = canvasTexture;\r\n                }\r\n            }\r\n        \"\"\"\r\n    }\r\n\r\n}\r\n```\r\n\r\n#### ã‚ˆãåˆ†ã‹ã‚‰ã‚“ãªã‚Šã®è§£èª¬\r\n`Surface`ã®æ˜ åƒã¯`Android`ã®`SurfaceTexture`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§`OpenGL`ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ï¼ˆç”»åƒï¼‰ã¨ã—ã¦å–å¾—ã§ãã¾ã™ã€‚ï¼ˆ`sampler2D`ã§ã¯ãªã`samplerExternalOES`ã§ã™ï¼‰  \r\n`Canvas`ã¯`Bitmap`ã«ã™ã‚‹ã“ã¨ã§ã€`OpenGL`ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦å–å¾—ã§ãã¾ã™ã€‚ï¼ˆ`sampler2D`ã§ã™ï¼‰  \r\n\r\n- æ˜ åƒã®ãƒ•ãƒ¬ãƒ¼ãƒ ãŒã‚„ã£ã¦ãã‚‹\r\n- Canvasã«æç”»ã™ã‚‹\r\n- `glDrawArrays`ã‚’å‘¼ã³å‡ºã—ã¦æ˜ åƒã‚’æç”»ã™ã‚‹\r\n- ä»Šåº¦ã¯ `Canvas` ã®å†…å®¹ã‚’ `glDrawArrays` ã‚’å‘¼ã³å‡ºã—ã¦é‡ã­ã¦æç”»ã™ã‚‹\r\n    - `uniform å¤‰æ•° uDrawVideo`ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ Canvas ã‚’æç”»ã™ã‚‹\r\n- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«è¡Œãï¼Ÿ\r\n\r\nä»Šå›ã¯`ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€`ã«ç”¨æ„ã—ãŸãƒ•ãƒ©ã‚°ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ã§æ˜ åƒã¨Canvasã®ç”»åƒã‚’åˆ‡ã‚Šæ›¿ãˆã¦æç”»ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚ï¼ˆ`uDrawVideo`ãƒ•ãƒ©ã‚°ï¼‰  \r\nï¼ˆã©ã†ã‚„ã£ã¦ æ˜ åƒã¨Canvasã®ç”»åƒ ã‚’é‡ã­ã‚‹ã‚“ã ã‚ã†ã£ã¦ä¸€é€±é–“ãã‚‰ã„æ‚©ã‚“ã§ã¾ã—ãŸãŒã€äºŒå›æç”»ã™ã‚Œã°ã„ã„ã‚“ã§ã™ã­ã€‚åŸºç¤ãŒãªã£ã¦ãªã„ã­ï¼‰\r\n\r\nã¾ãŸã€`gl_Position`ã®å€¤ã‚’åˆ¶å¾¡ã™ã‚‹ã“ã¨ã§å›è»¢ã‚„ã‚¹ã‚±ãƒ¼ãƒ«ã®èª¿æ•´ãŒã§ãã¾ã™ã€‚  \r\nä»Šå›ã¯`gl_Position`ã‚’ã„ã„æ„Ÿã˜ã«ã—ã¦ç¸¦å‹•ç”»ã§ã‚‚çœŸã‚“ä¸­ã«ãƒ•ã‚£ãƒƒãƒˆã•ã›ã¦æç”»ã•ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚`Matrix.scaleM`ã®éƒ¨åˆ†ã§ã™ã€‚ï¼ˆå¼•æ•°ã«å‹•ç”»ã®ã‚µã‚¤ã‚ºã‚’å–ã£ã¦ã‚‹ã®ã¯ãã®ã›ã„ï¼‰  \r\nã¾ãŸã€ï¼ˆå¾Œã§ã¾ãŸæ›¸ãã¾ã™ãŒï¼‰ç¸¦å‹•ç”»ã®å ´åˆã¯`gl_Position`ã‚’ã„ã„æ„Ÿã˜ã«ã—ã¦å›è»¢ã•ã›ã‚‹å‡¦ç†ã‚’è¿½åŠ ã—ã¦ã„ã¾ã™ã€‚è¡Œåˆ—ã®å›è»¢ã¨ã‹ã„ã†ã‚„ã¤ã‚‰ã—ã„ã§ã™ã€‚`Matrix.rotateM`ã®éƒ¨åˆ†ã§ã™ã€‚\r\nï¼ˆã‚‚ã—ã†ã¾ãå‹•ã„ã¦ãªã„ï¼ˆã²ã£ãã‚Šè¿”ã£ã¦ã‚‹ï¼‰å ´åˆã¯ `Matrix.rotateM` ã®éƒ¨åˆ†ã‚’è¦‹ç›´ã—ã¦ã¿ã¦ãã ã•ã„ã€ã€ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ï¼‰\r\n\r\nã‚ã¨ã€`Canvas`ã®ä½•ã‚‚æ›¸ã„ã¦ã„ãªã„éƒ¨åˆ†ã¯é€æ˜ã«ãªã‚‹ã®ã§ã™ãŒã€`ã‚¢ãƒ«ãƒ•ã‚¡ãƒ–ãƒ¬ãƒ³ãƒ‰`ã®è¨­å®šã‚’ã—ã¦ã„ãªã„ã¨`é‡ã­ãŸCanvas`ã®ã›ã„ã§é€æ˜ã®éƒ¨åˆ†ãŒçœŸã£é»’ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n#### Snapdragonç«¯æœ«ã§æ˜ åƒãŒä¹±ã‚ŒãŸ\r\n`glClear`é–¢æ•°ã‚’å‘¼ã¶ã“ã¨ã§ç›´ã‚Šã¾ã—ãŸã€‚\r\n\r\n### VideoProcessor.kt\r\næœ€å¾Œã« MediaCodec ã¨ã‹ã¨ä¸Šã§æ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚  \r\nã¾ãšå…¨æ–‡è²¼ã‚Šã¾ã™ã­  \r\nã“ã“ã«ã‚‚ã„ãã¤ã‹ç½ ãŒã‚ã£ã¦ã€ã€ã€\r\n\r\n```kotlin\r\n/**\r\n * å‹•ç”»ã«Canvasã‚’ã‹ã•ã­ã‚‹å‡¦ç†\r\n *\r\n * @param videoFile å…ƒå‹•ç”»\r\n * @param resultFile ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®å‹•ç”»\r\n * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ\r\n * @param frameRate ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ\r\n * @param outputVideoWidth ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®å‹•ç”»ã®å¹…\r\n * @param outputVideoHeight ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®å‹•ç”»ã®é«˜ã•\r\n */\r\nclass VideoProcessor(\r\n    private val videoFile: File,\r\n    private val resultFile: File,\r\n    private val bitRate: Int = 1_000_000,\r\n    private val frameRate: Int = 30,\r\n    private val outputVideoWidth: Int = 1280,\r\n    private val outputVideoHeight: Int = 720,\r\n) {\r\n\r\n    /** ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã‚„ã¤ */\r\n    private var mediaExtractor: MediaExtractor? = null\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ [MediaCodec] */\r\n    private var encodeMediaCodec: MediaCodec? = null\r\n\r\n    /** ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ [MediaCodec] */\r\n    private var decodeMediaCodec: MediaCodec? = null\r\n\r\n    /** ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸æ ¼ç´ã™ã‚‹ã‚„ã¤ */\r\n    private val mediaMuxer by lazy { MediaMuxer(resultFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4) }\r\n\r\n    /** OpenGL ã§åŠ å·¥ã™ã‚‹ */\r\n    private var codecInputSurface: CodecInputSurface? = null\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹\r\n     *\r\n     * @param onCanvasDrawRequest Canvasã§æç”»ã™ã‚‹ã€‚timeMsã¯å‹•ç”»ã®æ™‚é–“\r\n     */\r\n    suspend fun encode(\r\n        onCanvasDrawRequest: Canvas.(timeMs: Long) -> Unit,\r\n    ) = withContext(Dispatchers.Default) {\r\n        // å‹•ç”»ã‚’å–ã‚Šå‡ºã™\r\n        val (mediaExtractor, index, format) = extractMedia(videoFile.path, \"video/\")\r\n        this@VideoProcessor.mediaExtractor = mediaExtractor\r\n        // å‹•ç”»ãƒˆãƒ©ãƒƒã‚¯\r\n        mediaExtractor.selectTrack(index)\r\n        mediaExtractor.seekTo(0, MediaExtractor.SEEK_TO_PREVIOUS_SYNC)\r\n\r\n        // è§£æçµæœã‹ã‚‰å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™\r\n        val videoMimeType = format.getString(MediaFormat.KEY_MIME)!!\r\n        val videoWidth = format.getInteger(MediaFormat.KEY_WIDTH)\r\n        val videoHeight = format.getInteger(MediaFormat.KEY_HEIGHT)\r\n        // ç”»é¢å›è»¢æƒ…å ±\r\n        // Androidã®ç¸¦å‹•ç”»ã¯ã©ã†ã‚„ã‚‰å›è»¢ã•ã›ã¦ã„ã‚‹ã‚‰ã—ã„ã®ã§ã€å›è»¢ã‚’æˆ»ã™\r\n        // TODO KEY_ROTATION ãŒ Android 6 ä»¥é™\r\n        val hasRotation = format.getIntegerOrNull(MediaFormat.KEY_ROTATION) == 90\r\n        // ç”»é¢å›è»¢åº¦ãŒã‚ã‚‹å ´åˆã¯ width / height ãŒãã‚Œãã‚Œå…¥ã‚Œæ›¿ã‚ã‚‹ã®ã§æ³¨æ„ï¼ˆä¸€æ•—ï¼‰\r\n        val originVideoWidth = if (hasRotation) videoHeight else videoWidth\r\n        val originVideoHeight = if (hasRotation) videoWidth else videoHeight\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ -> H.264ï¼‰MediaCodec\r\n        encodeMediaCodec = MediaCodec.createEncoderByType(videoMimeType).apply {\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«ã‚»ãƒƒãƒˆã™ã‚‹MediaFormat\r\n            // ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ãã£ã¡ã‚’ä½¿ã†\r\n            val videoMediaFormat = MediaFormat.createVideoFormat(videoMimeType, outputVideoWidth, outputVideoHeight).apply {\r\n                setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n                setInteger(MediaFormat.KEY_FRAME_RATE, frameRate)\r\n                setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 1)\r\n                setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface)\r\n            }\r\n            configure(videoMediaFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®Surfaceã‚’å–å¾—ã—ã¦ã€OpenGLã‚’åˆ©ç”¨ã—ã¦Canvasã‚’é‡ã­ã¾ã™\r\n        codecInputSurface = CodecInputSurface(\r\n            encodeMediaCodec!!.createInputSurface(),\r\n            TextureRenderer(\r\n                outputVideoWidth = outputVideoWidth,\r\n                outputVideoHeight = outputVideoHeight,\r\n                originVideoWidth = originVideoWidth,\r\n                originVideoHeight = originVideoHeight,\r\n                videoRotation = if (hasRotation) 270f else 0f\r\n            )\r\n        )\r\n\r\n        codecInputSurface?.makeCurrent()\r\n        encodeMediaCodec!!.start()\r\n\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆH.264 -> ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰MediaCodec\r\n        codecInputSurface?.createRender()\r\n        decodeMediaCodec = MediaCodec.createDecoderByType(videoMimeType).apply {\r\n            // ç”»é¢å›è»¢ãƒ‡ãƒ¼ã‚¿ãŒæœ‰ã£ãŸå ´åˆã«ãƒªã‚»ãƒƒãƒˆã™ã‚‹\r\n            // ã“ã®ã¾ã¾ã ã¨å›è»¢ã•ã‚ŒãŸã¾ã¾ãªã®ã§ã€OpenGL å´ã§å›è»¢ã•ã›ã‚‹\r\n            // setInteger ã‚’ã“ã“ã§ã‚„ã‚‹ã®ã¯è‰¯ããªã„æ°—ãŒã™ã‚‹ã‘ã©é¢å€’ãªã®ã§\r\n            format.setInteger(MediaFormat.KEY_ROTATION, 0)\r\n            configure(format, codecInputSurface!!.drawSurface, null, 0)\r\n        }\r\n        decodeMediaCodec?.start()\r\n\r\n        // nonNull\r\n        val decodeMediaCodec = decodeMediaCodec!!\r\n        val encodeMediaCodec = encodeMediaCodec!!\r\n\r\n        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n\r\n        var videoTrackIndex = -1\r\n\r\n        var outputDone = false\r\n        var inputDone = false\r\n\r\n        while (!outputDone) {\r\n            if (!inputDone) {\r\n\r\n                val inputBufferId = decodeMediaCodec.dequeueInputBuffer(TIMEOUT_US)\r\n                if (inputBufferId >= 0) {\r\n                    val inputBuffer = decodeMediaCodec.getInputBuffer(inputBufferId)!!\r\n                    val size = mediaExtractor.readSampleData(inputBuffer, 0)\r\n                    if (size > 0) {\r\n                        // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æµã™\r\n                        // ä»Šã¾ã§ã®å‹•ç”»ã®åˆ†ã®å†ç”Ÿä½ç½®ã‚’è¶³ã—ã¦ãŠã\r\n                        decodeMediaCodec.queueInputBuffer(inputBufferId, 0, size, mediaExtractor.sampleTime, 0)\r\n                        mediaExtractor.advance()\r\n                    } else {\r\n                        // çµ‚äº†\r\n                        decodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM)\r\n                        // é–‹æ”¾\r\n                        mediaExtractor.release()\r\n                        // çµ‚äº†\r\n                        inputDone = true\r\n                    }\r\n                }\r\n            }\r\n            var decoderOutputAvailable = true\r\n            while (decoderOutputAvailable) {\r\n                // SurfaceçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ã‚’è²°ã£ã¦ä¿å­˜ã™ã‚‹\r\n                val encoderStatus = encodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (encoderStatus >= 0) {\r\n                    val encodedData = encodeMediaCodec.getOutputBuffer(encoderStatus)!!\r\n                    if (bufferInfo.size > 1) {\r\n                        if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_CODEC_CONFIG == 0) {\r\n                            // MediaMuxer ã¸ addTrack ã—ãŸå¾Œ\r\n                            mediaMuxer.writeSampleData(videoTrackIndex, encodedData, bufferInfo)\r\n                        }\r\n                    }\r\n                    outputDone = bufferInfo.flags and MediaCodec.BUFFER_FLAG_END_OF_STREAM != 0\r\n                    encodeMediaCodec.releaseOutputBuffer(encoderStatus, false)\r\n                } else if (encoderStatus == MediaCodec.INFO_OUTPUT_FORMAT_CHANGED) {\r\n                    // MediaMuxerã¸æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹ã®ã¯ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã†\r\n                    // ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚„ã‚‹ã¨å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚ŒãŸMediaFormatãŒæ‰‹ã«å…¥ã‚‹(csd-0 ã¨ã‹)\r\n                    // æ˜ åƒãŒã¶ã£å£Šã‚Œã¦ã„ã‚‹å ´åˆï¼ˆç·‘ã§å¡—ã‚Šã¤ã¶ã•ã‚Œã¦ã‚‹ã¨ã‹ï¼‰ã¯å¤šåˆ†ã“ã®ã‚ãŸã‚ŠãŒæ€ªã—ã„\r\n                    val newFormat = encodeMediaCodec.outputFormat\r\n                    videoTrackIndex = mediaMuxer.addTrack(newFormat)\r\n                    mediaMuxer.start()\r\n                }\r\n                if (encoderStatus != MediaCodec.INFO_TRY_AGAIN_LATER) {\r\n                    continue\r\n                }\r\n                // Surfaceã¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã€‚ãã—ã¦OpenGLã§ã‚´ãƒ‹ãƒ§ã‚´ãƒ‹ãƒ§ã™ã‚‹\r\n                val outputBufferId = decodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (outputBufferId == MediaCodec.INFO_TRY_AGAIN_LATER) {\r\n                    decoderOutputAvailable = false\r\n                } else if (outputBufferId >= 0) {\r\n                    // é€²æ—\r\n                    val doRender = bufferInfo.size != 0\r\n                    decodeMediaCodec.releaseOutputBuffer(outputBufferId, doRender)\r\n                    if (doRender) {\r\n                        var errorWait = false\r\n                        try {\r\n                            codecInputSurface?.awaitNewImage()\r\n                        } catch (e: Exception) {\r\n                            errorWait = true\r\n                        }\r\n                        if (!errorWait) {\r\n                            // æ˜ åƒã¨Canvasã‚’åˆæˆã™ã‚‹\r\n                            codecInputSurface?.drawImage { canvas ->\r\n                                onCanvasDrawRequest(canvas, bufferInfo.presentationTimeUs / 1000L)\r\n                            }\r\n                            codecInputSurface?.setPresentationTime(bufferInfo.presentationTimeUs * 1000)\r\n                            codecInputSurface?.swapBuffers()\r\n                        }\r\n                    }\r\n                    if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_END_OF_STREAM != 0) {\r\n                        decoderOutputAvailable = false\r\n                        encodeMediaCodec.signalEndOfInputStream()\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n        decodeMediaCodec.stop()\r\n        decodeMediaCodec.release()\r\n        // OpenGLé–‹æ”¾\r\n        codecInputSurface?.release()\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n        encodeMediaCodec.stop()\r\n        encodeMediaCodec.release()\r\n        // MediaMuxerã‚‚çµ‚äº†\r\n        mediaMuxer.stop()\r\n        mediaMuxer.release()\r\n    }\r\n\r\n    private fun MediaFormat.getIntegerOrNull(name: String): Int? {\r\n        return if (containsKey(name)) {\r\n            getInteger(name)\r\n        } else null\r\n    }\r\n\r\n    private fun extractMedia(videoPath: String, startMimeType: String): Triple<MediaExtractor, Int, MediaFormat> {\r\n        val mediaExtractor = MediaExtractor().apply { setDataSource(videoPath) }\r\n        // ãƒˆãƒ©ãƒƒã‚¯ã¨ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·ã®Pairã‚’ä½œã£ã¦è¿”ã™\r\n        val (index, track) = (0 until mediaExtractor.trackCount)\r\n            .map { index -> index to mediaExtractor.getTrackFormat(index) }\r\n            .first { (_, track) -> track.getString(MediaFormat.KEY_MIME)?.startsWith(startMimeType) == true }\r\n        return Triple(mediaExtractor, index, track)\r\n    }\r\n\r\n    companion object {\r\n        /** ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n        private const val TIMEOUT_US = 10_000L\r\n    }\r\n}\r\n```\r\n\r\n#### é›‘ãªè§£èª¬\r\nã¨ã„ã£ã¦ã‚‚ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®å‡ºåŠ›ã‚’OpenGLã«å‘ã‘ã¦ã„ã‚‹ä»¥å¤–ã«ãªã•ãã†ï¼Ÿ  \r\næ˜ åƒãŒå–å¾—ã§ããŸã‚‰ã€`Canvas`ã®æ›´æ–°ã‚’ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚\r\n\r\n#### ã‚ãª ç¸¦å‹•ç”»ã®å ´åˆã¯å‹•ç”»ã®å›è»¢æƒ…å ±ãŒå…¥ã£ã¦ã„ã‚‹ã€‚\r\n- ã—ã‚Œã£ã¨æ›¸ã„ã¦ã‚ã£ãŸ\r\n    - https://developer.android.com/reference/android/media/MediaCodec#transformations-when-rendering-onto-surface\r\n    - Surface ã®å ´åˆå›è»¢æƒ…å ±ãŒã‚ã‚Œã°å›è»¢ã—ã¾ã™ã‚ˆã£ã¦\r\n    - å›è»¢ã—ãŸ æ¨ªã®å‹•ç”» ã¿ãŸã„ãª\r\n    - ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ ã«å›è»¢ã•ã‚ŒãŸã¾ã¾è¡¨ç¤ºã•ã‚Œã‚‹\r\n- ãã‚Œã ã‘ã˜ã‚ƒãªãã€å‹•ç”»ã®ã®å¹…ã€å‹•ç”»ã®é«˜ã•ã‚‚å›è»¢ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ä¿å­˜ã•ã‚Œã‚‹\r\n    - height / width ãŒé€†ã«ãªã‚‹ï¼ï¼Ÿ\r\n- ä»Šå›ã¯ã“ã‚Œã‚’ä¿®æ­£ã™ã‚‹ãŸã‚ã€ç¸¦å‹•ç”»ã®å ´åˆã¯`OpenGL`å´ã§`Matrix.rotateM`ã‚’ã—ã¦å›è»¢æƒ…å ±ãŒãªãã¦ã‚‚ç¸¦å‹•ç”»ã«ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚\r\n\r\nâ†“ ã¡ã‚‡ã†ã©ã“ã“\r\n\r\n```kotlin\r\n// ç”»é¢å›è»¢æƒ…å ±\r\n// Androidã®ç¸¦å‹•ç”»ã¯ã©ã†ã‚„ã‚‰å›è»¢ã•ã›ã¦ã„ã‚‹ã‚‰ã—ã„ã®ã§ã€å›è»¢ã‚’æˆ»ã™\r\n// TODO KEY_ROTATION ãŒ Android 6 ä»¥é™\r\nval hasRotation = format.getIntegerOrNull(MediaFormat.KEY_ROTATION) == 90\r\n// ç”»é¢å›è»¢åº¦ãŒã‚ã‚‹å ´åˆã¯ width / height ãŒãã‚Œãã‚Œå…¥ã‚Œæ›¿ã‚ã‚‹ã®ã§æ³¨æ„ï¼ˆä¸€æ•—ï¼‰\r\nval originVideoWidth = if (hasRotation) videoHeight else videoWidth\r\nval originVideoHeight = if (hasRotation) videoWidth else videoHeight\r\n```\r\n\r\nã‚ã¨ã¯`MediaCodec`ç‰¹æœ‰ã®ä½¿ã„ã«ãã•ãŒç›¸å¤‰ã‚ã‚‰ãšã‚ã‚‹ã®ã§ã™ãŒãã‚Œã¯å‰ã«æ›¸ã„ãŸä»–ã®è¨˜äº‹ã§...\r\n\r\n## MainActivity.kt\r\næœ¬å½“ã¯é•·æ™‚é–“ã®ã‚¿ã‚¹ã‚¯ã«ãªã‚‹ã®ã§ã€`ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹`ã§ã‚„ã‚‹ã¹ãã§ã™ãŒæœ¬é¡Œã˜ã‚ƒãªã„ã®ã§ã€ã€  \r\n\r\n```kotlin\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n    setContentView(viewBinding.root)\r\n    // å‹•ç”»ã‚’é¸æŠã™ã‚‹\r\n    viewBinding.videoSelectButton.setOnClickListener {\r\n        videoPicker.launch(\"video/mp4\")\r\n    }\r\n    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹\r\n    viewBinding.encodeButton.setOnClickListener {\r\n        lifecycleScope.launch {\r\n            viewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰é–‹å§‹\"\r\n            val videoFile = File(workFolder, VIDEO_FILE_NAME)\r\n            val resultFile = File(workFolder, RESULT_VIDEO_FILE_NAME)\r\n            val videoProcessor = VideoProcessor(videoFile, resultFile)\r\n            videoProcessor.encode { currentTimeMs ->\r\n                // TODO ã“ã®å¾Œã™ã\r\n            }\r\n            // TODO éŸ³å£°ã®è¿½åŠ \r\n            // TODO MediaStoreã¸è¿½åŠ \r\n            viewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµ‚äº†\"\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n### Canvasã§ãŠçµµã‹ãã‚¿ã‚¤ãƒ \r\nãŠã¾ãŸã›ã—ã¾ã—ãŸã€‚ãŠçµµã‹ãã‚¿ã‚¤ãƒ ã§ã™  \r\n`this`ã«`Canvas`ã€`currentTimeMs`ã¯å‹•ç”»ã®å†ç”Ÿä½ç½®ï¼ˆãƒŸãƒªç§’ï¼‰ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n```\r\nvideoProcessor.encode { currentTimeMs ->\r\n    // this ã¯ Canvas\r\n    // currentTimeMs ã¯å‹•ç”»ã®å†ç”Ÿä½ç½®ï¼ˆãƒŸãƒªç§’ï¼‰\r\n}\r\n```\r\n\r\nä¾‹ãˆã°å‹•ç”»ã®å†ç”Ÿæ™‚é–“ã‚’é‡ã­ãŸï¼ˆã¤ã„ã§ã«ç”»åƒã‚‚ï¼‰å ´åˆã¯ã“ã‚“ãªæ„Ÿã˜\r\n\r\n```kotlin\r\nval videoFile = File(workFolder, VIDEO_FILE_NAME)\r\nval resultFile = File(workFolder, RESULT_VIDEO_FILE_NAME)\r\nval videoWidth = 1280\r\nval videoHeight = 720\r\nval videoProcessor = VideoProcessor(\r\n    videoFile = videoFile,\r\n    resultFile = resultFile,\r\n    outputVideoWidth = videoWidth,\r\n    outputVideoHeight = videoHeight\r\n)\r\nval textPaint = Paint().apply {\r\n    textSize = 80f\r\n}\r\nval logoBitmap = ContextCompat.getDrawable(this@MainActivity, R.drawable.ic_launcher_foreground)?.apply {\r\n    setTint(Color.WHITE)\r\n}?.toBitmap(300, 300)!!\r\nvideoProcessor.encode { currentTimeMs ->\r\n    // this ãŒ Canvas\r\n    // é©å½“ã«æ–‡å­—ã‚’æ›¸ã\r\n    val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(currentTimeMs / 1000f)}\"\r\n    textPaint.color = Color.BLACK\r\n    textPaint.style = Paint.Style.STROKE\r\n    // æ å–ã‚Šæ–‡å­—\r\n    drawText(text, 700f, 500f, textPaint)\r\n    textPaint.style = Paint.Style.FILL\r\n    textPaint.color = Color.WHITE\r\n    // æ ç„¡ã—æ–‡å­—\r\n    drawText(text, 700f, 500f, textPaint)\r\n    // ç”»åƒã‚‚è¡¨ç¤ºã™ã‚‹\r\n    drawBitmap(logoBitmap, (videoWidth - logoBitmap.width).toFloat(), (videoWidth - logoBitmap.height).toFloat(), textPaint)\r\n}\r\n```\r\n\r\nã¤ã„ã§ã«ã“ã“ã¾ã§ã®`MainActivity.kt`ã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val workFolder by lazy { File(getExternalFilesDir(null), \"video\").apply { mkdir() } }\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    /** å‹•ç”»ãƒ”ãƒƒã‚«ãƒ¼ */\r\n    private val videoPicker = registerForActivityResult(ActivityResultContracts.GetContent()) { uri ->\r\n        uri ?: return@registerForActivityResult\r\n        // ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n        lifecycleScope.launch(Dispatchers.IO) {\r\n            val videoFile = File(workFolder, VIDEO_FILE_NAME).apply {\r\n                createNewFile()\r\n            }\r\n            videoFile.outputStream().use { outputStream ->\r\n                contentResolver.openInputStream(uri)?.use { inputStream ->\r\n                    inputStream.copyTo(outputStream)\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        // å‹•ç”»ã‚’é¸æŠã™ã‚‹\r\n        viewBinding.videoSelectButton.setOnClickListener {\r\n            videoPicker.launch(\"video/mp4\")\r\n        }\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹\r\n        viewBinding.encodeButton.setOnClickListener {\r\n            lifecycleScope.launch {\r\n\r\n                viewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰é–‹å§‹\"\r\n\r\n                val videoFile = File(workFolder, VIDEO_FILE_NAME)\r\n                val resultFile = File(workFolder, RESULT_VIDEO_FILE_NAME)\r\n                val videoWidth = 1280\r\n                val videoHeight = 720\r\n                val videoProcessor = VideoProcessor(\r\n                    videoFile = videoFile,\r\n                    resultFile = resultFile,\r\n                    outputVideoWidth = videoWidth,\r\n                    outputVideoHeight = videoHeight\r\n                )\r\n\r\n                val textPaint = Paint().apply {\r\n                    textSize = 100f\r\n                }\r\n                val logoBitmap = ContextCompat.getDrawable(this@MainActivity, R.drawable.ic_launcher_foreground)?.apply {\r\n                    setTint(Color.WHITE)\r\n                }?.toBitmap(300, 300)!!\r\n\r\n                videoProcessor.encode { currentTimeMs ->\r\n                    // é©å½“ã«æ–‡å­—ã‚’æ›¸ã\r\n                    val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(currentTimeMs / 1000f)}\"\r\n\r\n                    textPaint.color = Color.BLACK\r\n                    textPaint.style = Paint.Style.STROKE\r\n                    // æ å–ã‚Šæ–‡å­—\r\n                    drawText(text, 200f, 300f, textPaint)\r\n\r\n                    textPaint.style = Paint.Style.FILL\r\n                    textPaint.color = Color.WHITE\r\n                    // æ ç„¡ã—æ–‡å­—\r\n                    drawText(text, 200f, 300f, textPaint)\r\n\r\n                    // ç”»åƒã‚‚è¡¨ç¤ºã™ã‚‹\r\n                    drawBitmap(logoBitmap, (videoWidth - logoBitmap.width).toFloat(), (videoHeight - logoBitmap.height).toFloat(), textPaint)\r\n                }\r\n\r\n                viewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµ‚äº†\"\r\n\r\n                // TODO éŸ³å£°ã®è¿½åŠ \r\n                // TODO MediaStoreã¸è¿½åŠ \r\n            }\r\n        }\r\n\r\n    }\r\n\r\n    companion object {\r\n        /** ã‹ã•ã­ã‚‹å‹•ç”»ã®ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n        private const val VIDEO_FILE_NAME = \"origin_video_file.mp4\"\r\n\r\n        /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n        private const val RESULT_VIDEO_FILE_NAME = \"result.mp4\"\r\n    }\r\n\r\n}\r\n```\r\n\r\n# å‹•ã‹ã—ã¦ã¿ã‚‹\r\n\r\nå‹•ç”»ã‚’é¸ã‚“ã ã‚ã¨ã«ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\nã—ã°ã‚‰ãå¾…ã¡ã¾ã™ã€çµ‚äº†ã—ã¾ã—ãŸã¨è¡¨ç¤ºã•ã‚ŒãŸã‚‰çµ‚ã‚ã‚Šã§ã™ã€‚  \r\n\r\nã§ã€ã€ã€å‹•ç”»ã®ãƒ‘ã‚¹ãªã‚“ã§ã™ãŒã€  \r\n`/storage/emulated/0/Android/data/ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID/files/video/result.mp4`  \r\nã§ã™ã€‚ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã™ã‚‹å‡¦ç†ã¯ã¾ã æ›¸ã„ã¦ãªã„ã®ã§ã“ã†ãªã‚Šã¾ã™  \r\n`ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID`ã¯`build.gradle`ã®`applicationId`ã®éƒ¨åˆ†ã®å€¤ã§ã™ã€‚  \r\n\r\n```gradle\r\n    defaultConfig {\r\n        applicationId \"ã“â†‘ã“â†“\"\r\n        minSdk 21\r\n        targetSdk 33\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n        // çœç•¥\r\n```\r\n\r\nã©ã†ã§ã—ã‚‡ã†ã€å‹•ç”»ã®ä¸Šã«Canvasã§è½æ›¸ãã—ãŸç”»åƒãŒé‡ãªã£ã¦ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã¾ã™ã§ã—ã‚‡ã†ã‹ï¼Ÿ  \r\n\r\n![Imgur](https://imgur.com/efE7zna.png)\r\n\r\nã—ã‹ã—éŸ³å£°ãŒãªããªã£ã¦ã—ã¾ã„ã¾ã—ãŸã€‚  \r\nã“ã®ä¿®æ­£ã‚’æ¬¡ã‚„ã‚Šã¾ã™ã€‚\r\n\r\n# éŸ³å£°ã‚’è¿½åŠ ã™ã‚‹\r\nã•ã£ãã‚ˆã‚Šã¯é›£ã—ããªã„ã€‚`Kotlin`ã§å®Œçµã™ã‚‹ä¸Šã€`mp4`->`mp4`ã®å ´åˆã¯ãã®ã¾ã¾å–ã‚Šå‡ºã—ã¦å…¥ã‚Œç›´ã™ã ã‘ãªã®ã§`MediaCodec`ã™ã‚‰å‡ºã¦ãã¾ã›ã‚“ã€‚  \r\nï¼ˆ`mp4`->`WebM`ã®å ´åˆã¯`AAC`ã‚’`Opus`ã«ã™ã‚‹ãŸã‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒã€ã€ã€ï¼ˆ`MediaCodec`åˆ©ç”¨ï¼‰ï¼‰\r\n\r\n## MixingTool.kt\r\nåå‰ã¯ãŠä»»ã›ã—ã¾ã™ã€‚  \r\n`Util`ã‚¯ãƒ©ã‚¹ã€ã‚¹ãƒšãƒ«ãŒ`Tool`ã®ã»ã†ãŒç°¡å˜ã ã‹ã‚‰`Tool`ã«ã—ã¦ã‚‹ã‚“ã ã‘ã©ã©ã†ãªã‚“ã ã‚ã†ï¼ˆè¶…ã©ã†ã§ã‚‚ã„ã„ï¼‰\r\n\r\n```kotlin\r\n/** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸå‹•ç”»ã«ã¯éŸ³å£°ãŒãªã„ã®ã§ã€éŸ³å£°ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ */\r\nobject MixingTool {\r\n\r\n    /**\r\n     * [videoFile]ã«[audioFile]ã®éŸ³å£°ã‚’è¿½åŠ ã—ã¦ã€[resultFile]ã¨ã—ã¦ç”Ÿæˆã™ã‚‹\r\n     */\r\n    @SuppressLint(\"WrongConstant\")\r\n    suspend fun addAudioTrack(\r\n        videoFile: File,\r\n        audioFile: File,\r\n        resultFile: File\r\n    ) = withContext(Dispatchers.Default) {\r\n        // audioFile ã‹ã‚‰éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã‚’å–å¾—\r\n        val (audioMediaExtractor, audioFormat) = MediaExtractor().let { mediaExtractor ->\r\n            mediaExtractor.setDataSource(audioFile.path)\r\n            val (index, format) = (0 until mediaExtractor.trackCount)\r\n                .map { index -> index to mediaExtractor.getTrackFormat(index) }\r\n                .first { (_, format) -> format.getString(MediaFormat.KEY_MIME)?.startsWith(\"audio/\") == true }\r\n            mediaExtractor.selectTrack(index)\r\n            mediaExtractor to format\r\n        }\r\n        // videoFile ã‹ã‚‰æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã‚’å–å¾—\r\n        val (videoMediaExtractor, videoFormat) = MediaExtractor().let { mediaExtractor ->\r\n            mediaExtractor.setDataSource(videoFile.path)\r\n            val (index, format) = (0 until mediaExtractor.trackCount)\r\n                .map { index -> index to mediaExtractor.getTrackFormat(index) }\r\n                .first { (_, format) -> format.getString(MediaFormat.KEY_MIME)?.startsWith(\"video/\") == true }\r\n            mediaExtractor.selectTrack(index)\r\n            mediaExtractor to format\r\n        }\r\n\r\n        // æ–°ã—ãã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ä¿å­˜ã™ã‚‹\r\n        // éŸ³å£°ã¨æ˜ åƒã‚’è¿½åŠ \r\n        val mediaMuxer = MediaMuxer(resultFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4)\r\n        val audioTrackIndex = mediaMuxer.addTrack(audioFormat)\r\n        val videoTrackIndex = mediaMuxer.addTrack(videoFormat)\r\n        // MediaMuxerã‚¹ã‚¿ãƒ¼ãƒˆã€‚ã‚¹ã‚¿ãƒ¼ãƒˆå¾Œã¯ addTrack ãŒå‘¼ã¹ãªã„\r\n        mediaMuxer.start()\r\n\r\n        // éŸ³å£°ã‚’ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ ã™ã‚‹\r\n        audioMediaExtractor.apply {\r\n            val byteBuffer = ByteBuffer.allocate(1024 * 4096)\r\n            val bufferInfo = MediaCodec.BufferInfo()\r\n            // ãƒ‡ãƒ¼ã‚¿ãŒç„¡ããªã‚‹ã¾ã§å›ã™\r\n            while (isActive) {\r\n                // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã™\r\n                val offset = byteBuffer.arrayOffset()\r\n                bufferInfo.size = readSampleData(byteBuffer, offset)\r\n                // ã‚‚ã†ç„¡ã„å ´åˆ\r\n                if (bufferInfo.size < 0) break\r\n                // æ›¸ãè¾¼ã‚€\r\n                bufferInfo.presentationTimeUs = sampleTime\r\n                bufferInfo.flags = sampleFlags // LintãŒã‚­ãƒ¬ã‚‹ã‘ã©é»™ã‚‰ã›ã‚‹\r\n                mediaMuxer.writeSampleData(audioTrackIndex, byteBuffer, bufferInfo)\r\n                // æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã«é€²ã‚ã‚‹\r\n                advance()\r\n            }\r\n            // ã‚ã¨ã—ã¾ã¤\r\n            release()\r\n        }\r\n\r\n        // æ˜ åƒã‚’ã‚³ãƒ³ãƒ†ãƒŠã«è¿½åŠ ã™ã‚‹\r\n        videoMediaExtractor.apply {\r\n            val byteBuffer = ByteBuffer.allocate(1024 * 4096)\r\n            val bufferInfo = MediaCodec.BufferInfo()\r\n            // ãƒ‡ãƒ¼ã‚¿ãŒç„¡ããªã‚‹ã¾ã§å›ã™\r\n            while (isActive) {\r\n                // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã™\r\n                val offset = byteBuffer.arrayOffset()\r\n                bufferInfo.size = readSampleData(byteBuffer, offset)\r\n                // ã‚‚ã†ç„¡ã„å ´åˆ\r\n                if (bufferInfo.size < 0) break\r\n                // æ›¸ãè¾¼ã‚€\r\n                bufferInfo.presentationTimeUs = sampleTime\r\n                bufferInfo.flags = sampleFlags // LintãŒã‚­ãƒ¬ã‚‹ã‘ã©é»™ã‚‰ã›ã‚‹\r\n                mediaMuxer.writeSampleData(videoTrackIndex, byteBuffer, bufferInfo)\r\n                // æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã«é€²ã‚ã‚‹\r\n                advance()\r\n            }\r\n            // ã‚ã¨ã—ã¾ã¤\r\n            release()\r\n        }\r\n\r\n        // çµ‚ã‚ã‚Š\r\n        mediaMuxer.stop()\r\n        mediaMuxer.release()\r\n    }\r\n\r\n}\r\n```\r\n\r\n## MainActivity.kt\r\néŸ³å£°ã‚’è¿½åŠ ã—ãŸå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã¨ã™ã‚‹ãŸã‚ã€ã¡ã‚‡ã£ã¨ç›´ã—ã¾ã™ã€‚  \r\nå®šæ•°ãŒå¢—ãˆã¦ã„ã‚‹ã®ãŒåˆ†ã‹ã‚‹é€šã‚Šã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸‰ç¨®é¡ã«ãªã‚Šã¾ã—ãŸï¼ˆ`å…ƒå‹•ç”»`ã€`Canvasã¨é‡ã­ãŸå‹•ç”»`ã€`Canvasã¨é‡ã­ãŸå‹•ç”»ã«éŸ³å£°ã‚’è¿½åŠ ã—ãŸå‹•ç”»`ï¼‰\r\n\r\n```kotlin\r\nlifecycleScope.launch {\r\n    viewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰é–‹å§‹\"\r\n\r\n    // ã¾ãšã¯ Canvas ã¨æ˜ åƒã‚’é‡ã­ã‚‹\r\n    val videoFile = File(workFolder, VIDEO_FILE_NAME)\r\n    val canvasOverlayVideoFile = File(workFolder, VIDEO_CANVAS_OVERLAY_FILE_NAME)\r\n    val videoWidth = 1280\r\n    val videoHeight = 720\r\n    val videoProcessor = VideoProcessor(\r\n        videoFile = videoFile,\r\n        resultFile = canvasOverlayVideoFile,\r\n        outputVideoWidth = videoWidth,\r\n        outputVideoHeight = videoHeight\r\n    )\r\n    val textPaint = Paint().apply {\r\n        textSize = 100f\r\n    }\r\n    val logoBitmap = ContextCompat.getDrawable(this@MainActivity, R.drawable.ic_launcher_foreground)?.apply {\r\n        setTint(Color.WHITE)\r\n    }?.toBitmap(300, 300)!!\r\n    videoProcessor.encode { currentTimeMs ->\r\n        // é©å½“ã«æ–‡å­—ã‚’æ›¸ã\r\n        val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(currentTimeMs / 1000f)}\"\r\n        textPaint.color = Color.BLACK\r\n        textPaint.style = Paint.Style.STROKE\r\n        // æ å–ã‚Šæ–‡å­—\r\n        drawText(text, 200f, 300f, textPaint)\r\n        textPaint.style = Paint.Style.FILL\r\n        textPaint.color = Color.WHITE\r\n        // æ ç„¡ã—æ–‡å­—\r\n        drawText(text, 200f, 300f, textPaint)\r\n        // ç”»åƒã‚‚è¡¨ç¤ºã™ã‚‹\r\n        drawBitmap(logoBitmap, (videoWidth - logoBitmap.width).toFloat(), (videoHeight - logoBitmap.height).toFloat(), textPaint)\r\n    }\r\n\r\n    // éŸ³å£°ãŒãªã„ã®ã§å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰éŸ³å£°ã ã‘ã‚‚ã‚‰ã£ã¦ãã‚‹\r\n    // éŸ³å£°ã‚’è¿½åŠ ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚‹\r\n    val resultFile = File(workFolder, RESULT_VIDEO_FILE_NAME)\r\n    MixingTool.addAudioTrack(\r\n        videoFile = canvasOverlayVideoFile,\r\n        audioFile = videoFile,\r\n        resultFile = resultFile\r\n    )\r\n\r\n    viewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµ‚äº†\"\r\n}\r\n\r\n// çœç•¥...\r\n\r\ncompanion object {\r\n    /** ã‹ã•ã­ã‚‹å‹•ç”»ã®ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private const val VIDEO_FILE_NAME = \"origin_video_file.mp4\"\r\n\r\n    /** Canvasã¨é‡ã­ãŸå‹•ç”»ã®ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private const val VIDEO_CANVAS_OVERLAY_FILE_NAME = \"temp_canvas_overlay.mp4\"\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private const val RESULT_VIDEO_FILE_NAME = \"result.mp4\"\r\n}\r\n```\r\n\r\nã“ã‚Œã§éŸ³å£°ãŒè¿½åŠ ã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ï¼ã„ã‹ãŒã§ã—ã‚‡ã†ï¼\r\n`VLC`ã§è¦‹ã‚‹ã¨ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã«ã¤ã„ã¦ã®é …ç›®ãŒå¢—ãˆã¦ã„ã¾ã™ï¼\r\n\r\n![Imgur](https://imgur.com/SqzaqGd.png)\r\n\r\n# MediaStoreã‚’åˆ©ç”¨ã—ã¦ã€ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã™ã‚‹\r\nã“ã‚Œã§`Google ãƒ•ã‚©ãƒˆ`ã‚¢ãƒ—ãƒªã‚„ä»–ã®ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«è¦‹ã¤ã‘ã¦ã‚‚ã‚‰ã†ã“ã¨ãŒã§ãã¾ã™ã€‚  \r\nãŒã€çµæ§‹é¢å€’ãã•ã„ã®ã§ã‚³ãƒ”ãƒšã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n## MediaStoreTool\r\n`Android`ã®`MediaStore`ã¨ã‹ã„ã†ä»•çµ„ã¿ã€ä½¿ã„ã«ãã„ã¨ã„ã†ã‹ã€ã€ãªã‚“ã‹ãªã‚ã€ã€ã€  \r\n`MediaMuxer`ã‚„`MediaExtractor`ã¨ã‹ãŒ`MediaStore ã‚„ Storage Access Framework`ã§å–å¾—ã§ãã‚‹`Uri (File#path ã®ã‚ˆã†ãªã‚‚ã®ã ã‘ã©é•ã†)`ã«å¯¾å¿œã—ã¦ãªã„ã‹ã‚‰ã€  \r\nçµå±€`File`ãŒä½¿ãˆã‚‹`getExternalFilesDir`ã¨ã‹ã«è»¢é€ã—ãªã„ã¨ã„ã‘ãªã„ã®ãŒãªã‚ã€ã€  \r\n`Android 10 ã® Scoped Storage`ã€ã‚„ã£ã±å½±éŸ¿ç¯„å›²ã‚ã£ã¡ã‚ƒã§ã‹ã„ã‚ˆãªã‚\r\n\r\n```kotlin\r\n/** ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã™ã‚‹ */\r\nobject MediaStoreTool {\r\n\r\n    /** [videoFile]ã‚’ MediaStore ã«ç™»éŒ²ã—ã¦ã€ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã‹ã‚‰å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ */\r\n    suspend fun addVideo(\r\n        context: Context,\r\n        videoFile: File\r\n    ) = withContext(Dispatchers.IO) {\r\n        val contentResolver = context.contentResolver\r\n        val contentValues = contentValuesOf(\r\n            MediaStore.MediaColumns.DISPLAY_NAME to videoFile.name,\r\n            // RELATIVE_PATHï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ã‚‹ï¼‰ ã¯ Android 10 ä»¥é™ã®ã¿ã§ã™\r\n            MediaStore.MediaColumns.RELATIVE_PATH to \"${Environment.DIRECTORY_MOVIES}/AndroidMediaCodecAddCanvasTextToVideo\"\r\n        )\r\n        val uri = contentResolver.insert(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, contentValues) ?: return@withContext\r\n        // ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n        contentResolver.openOutputStream(uri)?.use { outputStream ->\r\n            videoFile.inputStream().use { inputStream ->\r\n                inputStream.copyTo(outputStream)\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n## MainActivity.kt\r\nã‚ã¨ã¯`MixingTool`ã®ã‚ã¨ã«æ›¸ãè¶³ã™ã ã‘ã€‚çµ‚ã‚ã‚Š\r\n\r\n```kotlin\r\n// éŸ³å£°ãŒãªã„ã®ã§å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰éŸ³å£°ã ã‘ã‚‚ã‚‰ã£ã¦ãã‚‹\r\n// éŸ³å£°ã‚’è¿½åŠ ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ãªã‚‹\r\nval resultFile = File(workFolder, RESULT_VIDEO_FILE_NAME)\r\nMixingTool.addAudioTrack(\r\n    videoFile = canvasOverlayVideoFile,\r\n    audioFile = videoFile,\r\n    resultFile = resultFile\r\n)\r\n\r\n// ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ã¸è»¢é€ã™ã‚‹\r\nMediaStoreTool.addVideo(this@MainActivity, resultFile)\r\n// è»¢é€ã—ãŸã‚‰è¦ã‚‰ãªããªã‚‹ã®ã§å‰Šé™¤\r\nresultFile.delete()\r\ncanvasOverlayVideoFile.delete()\r\n// videoFile.delete() // æ¯å›æ¶ˆã™ãªã‚‰\r\n\r\nviewBinding.encodeStatusTextView.text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµ‚äº†\"\r\n```\r\n\r\nã“ã‚Œã§ `Google ãƒ•ã‚©ãƒˆ` ã‚¢ãƒ—ãƒªã®`ãƒ‡ãƒã‚¤ã‚¹å†…ã®å†™çœŸ`ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¯ãšã§ã™ã€ã©ã†ã§ã—ã‚‡ã†ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/nCzp0hz.png)\r\n\r\n# ä»¥ä¸Šã§ã™ã€‚\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚  \r\n\r\nhttps://github.com/takusan23/AndroidMediaCodecAddCanvasTextToVideo\r\n\r\næœ€çµ‚çš„ãª MainActivity.kt ã§ã™\r\n\r\nhttps://github.com/takusan23/AndroidMediaCodecAddCanvasTextToVideo/blob/master/app/src/main/java/io/github/takusan23/androidmediacodecaddcanvastexttovideo/MainActivity.kt\r\n\r\n\r\n# ãŠã‚ã‚Šã«\r\nã“ã®æ›´æ–°ã‹ã‚‰`Next.js`ã®`scrollRestoration`ã‚’`true`ã«ã—ã¦ã¾ã™ã€‚  \r\n`experimental`ãªã®ã§ä½¿ã†ã‹è¿·ã£ã¦ãŸã‚“ã§ã™ã‘ã©ç‰¹ã«å½±éŸ¿ãªã•ãã†ãªã®ã§æœ‰åŠ¹ã«ã—ã¾ã—ãŸã€‚\r\n\r\n# ãŠã‚ã‚Šã« 2\r\n`WebKit`ã ã¨`JavaScript`ã®`Date.parse()`ãŒ`YYYY-MM-DD`ã‚’ãƒ‘ãƒ¼ã‚¹ã§ããªãã¦ã€ä½•æ—¥å‰ã«æŠ•ç¨¿ã—ãŸã‹ã©ã†ã‹ã®éƒ¨åˆ†ãŒ `NaN` ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚  \r\n`Apple`ãƒ‡ãƒã‚¤ã‚¹æŒã£ã¦ã„ãªã„ã®ã§çŸ¥ã‚Šã¾ã›ã‚“ã§ã—ãŸã€ã€ã€ãã®ã†ã¡ç›´ã—ã¾ã™"},{"title":"Androidã‚¢ãƒ—ãƒªå†…ã®è¨€èªã‚’å¤‰æ›´ã™ã‚‹","link":"/posts/android_app_language_change/","markdown":"\r\næœŸæœ«ãŠã‚ã£ãŸï¼\r\n\r\n# æœ¬é¡Œ\r\n`Context#getString()`ã§æ—¥æœ¬èªã ã£ãŸã‚‰æ—¥æœ¬èªï¼ˆæ—¥æœ¬èªã®strings.xmlãŒã‚ã‚Œã°ï¼‰è¡¨ç¤ºã§ãã¾ã™ãŒã€ã“ã‚Œè‹±èªverãŒã»ã—ã„ã£ã¦ã®ãŒä»Šå›ã®ãŠè©±ã§ã™\r\n\r\n# ã“ã†ã§ã™ï¼\r\n\r\næ—¥æœ¬èªã ã‘ã©`Context#getString()`ã‚„ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®`R.string.app_name`ã¯è‹±èªã®æ–‡å­—åˆ—ãŒæ¬²ã—ã„ã£ã¦ã¨ãã¯ã€**Activity**ã‚„**Service**ã«ã“ã‚“ãªæ„Ÿã˜ã«\r\n\r\n`MainActivity.kt`\r\n\r\n```kotlin\r\n/**\r\n * è¨€èªå¤‰æ›´æ©Ÿèƒ½ã‚’ã¤ã‘ã‚‹\r\n * ç«¯æœ«ã®è¨­å®šã§æ—¥æœ¬èªã§ã‚‚ã“ã®ã‚¢ãƒ—ãƒªã ã‘è‹±èªã§ä½¿ã†ã¿ãŸã„ãªä½¿ã„æ–¹ãŒã§ãã¾ã™ã€‚\r\n * */\r\noverride fun attachBaseContext(newBase: Context?) {\r\n    val configuration = Configuration()\r\n    configuration.setLocale(Locale.ENGLISH)\r\n    super.attachBaseContext(baseContext?.createConfigurationContext(configuration))\r\n}\r\n```\r\n\r\n**Fragment**ã¯Activityã®ãŒä½¿ã‚ã‚Œã‚‹ãã†ï¼Ÿ\r\n\r\nä»¥ä¸Šã§ã™ã€‚ãŠã¤ã‹ã‚Œï¼˜ï¼˜ï¼˜"},{"title":"Androidã®ARCoreã§GitHubã®è‰(skyline)ã‚’è¡¨ç¤ºã•ã›ã‚‹ã¾ã§ã€‚without Sceneformæ™‚ä»£ã®ARCoreã‚’è©¦ã™ã€‚","link":"/posts/android_ar_core_github_skyline/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚  \r\nã‚¢ãƒã‚¨ãƒŸ -longing for you- æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\nçµµãŒã‚ã£ã¡ã‚ƒã‹ã‚ã„ã„ï¼ï¼ï¼ã‚·ãƒŠãƒªã‚ªã‚‚é‡ããªãã‚ã¾ã‚ã¾ãªãŠè©±ã§ã™ã€‚\r\n\r\n3äººä¸¦ã¶ã¨ã„ã„ãª...ã¾ã¶ã—ã„\r\n\r\n![Imgur](https://imgur.com/mzyBGfn.png)\r\n\r\nã‹ã‚ã„ã„ï¼\r\n\r\n![Imgur](https://imgur.com/7RoYMk7.png)\r\n\r\nã“ã®å­ãŒç‰¹ã«å¯æ„›ã‹ã£ãŸã§ã™\r\n\r\n![Imgur](https://imgur.com/acwibMI.png)\r\n\r\nâ†‘ã“ã®ç›®ã™ã\r\n\r\n![Imgur](https://imgur.com/cKU7FPr.png)\r\n\r\n\r\nã©ã†ã‚„ã‚‰ãƒ«ãƒ¼ãƒˆåˆ†å²ã§é¸ã‚“ã å›æ•°ã«ã‚ˆã£ã¦ å‘Šç™½ã•ã‚Œã‚‹ or ã™ã‚‹ ã®ã©ã¡ã‚‰ã‹ã«ãªã‚‹ã£ã½ã„ã§ã™ã€‚ã™ã”ã„\r\n\r\nã‚ã¨æ›²ãŒã„ã„ã€‚ã“ã‚Œã ã‘ã§äºˆç´„ç¢ºå®šã€‚\r\n\r\nãŠã™ã™ã‚ã§ã™ï¼ˆã‚¢ãƒ«ãƒ†ãƒŸã‚¹ã‚¨ãƒ³ã‚¸ãƒ³ãã‚“ãŠé¡˜ã„ã ã‹ã‚‰ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã‚ªãƒ¼ãƒˆè§£é™¤ã™ã‚‹ã®ã‚„ã‚ã¦ï¼‰\r\n\r\n# æœ¬é¡Œ\r\n`GitHub Skyline`ã£ã¦ã„ã†GitHubã®è‰ã‚’3Dãƒ¢ãƒ‡ãƒ«ã§è¡¨ç¤ºã§ãã‚‹ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚‹ã®ã§ã™ãŒã€ã“ã‚ŒARã§è¦‹ã‚ŒãŸã‚‰é¢ç™½ã„ã®ã§ã¯ã¨æ€ã£ãŸã®ã§ã‚„ã‚Šã¾ã™ã€‚  \r\n3Dãƒ—ãƒªãƒ³ã‚¿ãƒ¼ã§å°åˆ·ã™ã‚‹ãŸã‚ã®ã‚‚ã®ãªã‚“ã§ã—ã‚‡ã†ãŒæŒã£ã¦ãªã„ã®ã§...\r\n\r\n![Imgur](https://imgur.com/x2Kih8U.png)\r\n\r\n# ARCore ã® Sceneform ...\r\n`AR Core`ã¨ã„ãˆã°ã€ç°¡å˜ã«ä½¿ãˆã‚‹`Sceneform`ã£ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒã‚ã£ãŸã¨æ€ã„ã¾ã™ï¼  \r\nå¤§æ˜”ã«è©¦ã—ã¦ãã‚“ãªã«é›£ã—ããªã‹ã£ãŸè¨˜æ†¶  \r\n\r\nhttps://takusan23.github.io/Bibouroku/2020/04/06/ARCore/\r\n\r\nãã‚Œã‚’ä½¿ã„ãŸã„ã€ã€ã€ã®ã§ã™ãŒã€  \r\nãªã‚“ã¨ï¼ä½¿ãˆãªããªã£ã¦ã„ã¾ã—ãŸï¼æ•°å¹´å‰ã¯ä½¿ãˆã¦ãŸã®ã§ã™ãŒ...ï¼ãŠã„Googleï¼\r\n\r\n![Imgur](https://imgur.com/2nBm31S.png)\r\n\r\nã†ãƒ¼ã‚“ã—ã‚ƒã‚ãªã„æœ€æ–°ã®`AR Core`èª¿ã¹ã‚‹ã‹...  â†’ https://github.com/google-ar/arcore-android-sdk/tree/master/samples/hello_ar_kotlin\r\n\r\nKotlinã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã€ã¨ã‚Šã‚ãˆãšå®Ÿè¡Œã§ããŸã‘ã©ã©ã“ã§ä½•ã‚„ã£ã¦ã‚‹ã®ã‹ãƒã‚¸ã§åˆ†ã‹ã‚‰ã‚“ï¼ï¼ï¼ï¼  \r\nãªã‚“ã‹å†…å®¹ãŒé›£ã—ã„ï¼ï¼ï¼\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€ä»Šå›ã¯`3Dãƒ¢ãƒ‡ãƒ« (GitHub Skyline)`ã‚’è¡¨ç¤ºã•ã›ã‚‹ã¾ã§ä¸Šè¨˜ã®ã‚µãƒ³ãƒ—ãƒ«ã‚’ãƒ‘ã‚¯ã£ã¦ã‚„ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ    | ã‚ãŸã„                                                                  |\r\n|-----------|-------------------------------------------------------------------------|\r\n| ç«¯æœ«      | Pixel 6 Pro (Google Tensor / RAM 12GB) / Pixel 3 XL (SDM 845 / RAM 4GB) |\r\n| Android   | 13                                                                      |\r\n| minSdk    | 24 ?                                                                    |\r\n| OpenGL ES | 3.0 ãŸã¨æ€ã†                                                            |\r\n\r\nä»Šå›ã¯`Depth API`ï¼ˆç¾å®Ÿã¨åŒã˜ã‚ˆã†ã«æ‰‹å‰ã«ã‚‚ã®ãŒã‚ã‚Œã°éš ã‚Œã‚“ã¼ã™ã‚‹æ©Ÿèƒ½ï¼‰ã‚’ä½¿ã„ã¾ã™ã€‚  \r\nï¼ˆã¦ã‹ Pixel 3 XL ç‰©ç†çš„ã«è»½ãã­ï¼Ÿã„ã‚„ 6 Pro ãŒé‡ã„ã ã‘ã‹...ï¼‰\r\n\r\n# ARCore\r\n`ARCore`ã«ã¯æç”»ã™ã‚‹ãŸã‚ã®æ©Ÿèƒ½ã¯æŒã¡åˆã‚ã›ã¦ã¾ã›ã‚“ã€‚ï¼ˆ`Sceneform`ã«ã¯ã‚ã‚Šã¾ã—ãŸãŒã€`ARCore`ã®æ©Ÿèƒ½ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ï¼‰  \r\nãã®ãŸã‚æç”»ã™ã‚‹ãŸã‚ã®æŠ€è¡“ï¼ˆ`OpenGL`ï¼‰ã¨çµ„ã¿åˆã‚ã›ã¦åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n## ãªãŒã‚Œ\r\n\r\n- GitHub Skyline ã®3Dãƒ¢ãƒ‡ãƒ«`.stl`ã‚’`AR Core`ã§åˆ©ç”¨ã§ãã‚‹`.obj`ã«å¤‰æ›ã™ã‚‹\r\n    - ã¤ã„ã§ã«ã‚µã‚¤ã‚ºã‚’å°ã•ãã—ã¾ã™ã€‚\r\n    - Blender ä½¿ã„ã¾ã™\r\n- `AR Core`ã‚’åˆ©ç”¨ã™ã‚‹ãŸã‚ã®ç”¨æ„\r\n- ã‚«ãƒ¡ãƒ©æ˜ åƒã®æç”»\r\n- å¹³é¢ã®æç”»\r\n- 3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æç”»\r\n\r\n# Blender ã‚’ã„ã‚Œã‚‹\r\n`.stl`ã‚’`.obj`ã«ã™ã‚‹ãŸã‚ã«ä½¿ã„ã¾ã™ã€‚  \r\nã‚ã¨ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹ãŸã‚ã«ã‚‚ä½¿ã£ã¦ã¾ã™ã€‚\r\n\r\nä½¿ã†æ©Ÿä¼šãªã‘ã‚Œã°`Portable`ã®æ–¹ã§ã‚‚è‰¯ã„ã‚“ã˜ã‚ƒãªã„ã§ã—ã‚‡ã†ã‹ï¼ˆã‚ˆãåˆ†ã‹ã‚‰ã‚“ï¼‰\r\n\r\n![Imgur](https://imgur.com/xFNIsKw.png)\r\n\r\n## GitHub Skyline ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã‚€\r\n\r\n`GitHub Skyline`ã®ãƒ‡ãƒ¼ã‚¿ã¯ã“ã“ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Vu7t4lf.png)\r\n\r\n`Blender`ã‚’é–‹ãã€æœ€åˆã‹ã‚‰ã‚ã‚‹ç«‹æ–¹ä½“ã¯ã„ã‚‰ãªã„ã®ã§é¸ã‚“ã§`Deleteã‚­ãƒ¼`æŠ¼ã—ã¦æ¶ˆã—ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/JE0RUTz.png)\r\n\r\nãƒ•ã‚¡ã‚¤ãƒ« > ã‚¤ãƒ³ãƒãƒ¼ãƒˆ > STL ã‚’é¸ã³ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸ã‚“ã§å–ã‚Šè¾¼ã¿ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/XbuK8O7.png)\r\n\r\nã§ã€ã“ã‚Œãã®ã¾ã¾ä½¿ã†ã¨ã‚¯ã‚½ãƒ‡ã‚«ã„ã®ã§ç›´ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/sRLPLdN.png)\r\n\r\nã¡ãªã¿ã«ã©ã‚Œãã‚‰ã„ã‚¯ã‚½ãƒ‡ã‚«ã„ã‹ã¨ã„ã†ã¨ã€ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã“ã®ãã‚‰ã„å°ã•ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/xnBViJF.png)\r\n\r\n### ã‚µã‚¤ã‚ºã‚’å°ã•ãã™ã‚‹\r\n\r\nã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®`N`ã‚’æŠ¼ã™ã“ã¨ã§ã€`ãƒˆãƒ©ãƒ³ã‚¹ãƒ•ã‚©ãƒ¼ãƒ `ã‚’è¡¨ç¤ºã•ã›ã‚‹äº‹ãŒã§ãã¾ã™ã€‚  \r\nã§ã€`ã‚¹ã‚±ãƒ¼ãƒ«`ã®éƒ¨åˆ†ã‚’å…¨éƒ¨`0.005`ãã‚‰ã„ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/IhuLOgX.png)\r\n\r\nã“ã‚Œã§ã‚µãƒ³ãƒ—ãƒ«ã¨åŒã˜ãã‚‰ã„ã®å¤§ãã•ãã‚‰ã„ã«å‡ºæ¥ã¾ã—ãŸã€‚ä¿å­˜ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n### ä¿å­˜\r\nã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠã—ãŸçŠ¶æ…‹ã§ã€  \r\nãƒ•ã‚¡ã‚¤ãƒ« > ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ > Wavefront OBJ ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/nYfKgpU.png)\r\n\r\né¸æŠç‰©ã®ã¿ã«ã—ã¦ã€é©å½“ãªå ´æ‰€ã«ä¿å­˜ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/EVLA3l6.png)\r\n\r\nã“ã‚Œã§ãƒ•ã‚¡ã‚¤ãƒ«ã®ç”¨æ„ã¯çµ‚ã‚ã‚Šã§ã™ã€‚\r\n\r\n# å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™\r\nä»Šå›ã¯Googleã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’8å‰²ãã‚‰ã„ä½¿ã„ã¾ã™ï¼ˆ`Apache License Version 2.0`ï¼‰ã€‚ã®ã§ä»¥ä¸‹ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’`zip`ã§è½ã¨ã™ãªã‚Š`git clone`ã™ã‚‹ãªã‚Šã—ã¦ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ã—ã¦ä¸‹ã•ã„ã€‚  \r\nã“ã‚Œ`AR Core`ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã—ã¦æä¾›ã—ã¦ã»ã—ã„ãã‚‰ã„ã§ã™ã‚ˆã€‚\r\n\r\nhttps://github.com/google-ar/arcore-android-sdk\r\n\r\n# ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹\r\nAndroid Studio ã‚’é–‹ãã¾ã™ã€‚\r\n\r\n# é©å½“ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ\r\n`minSdk`ã¯`24`ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/MHytvCH.png)\r\n\r\n# AndroidManifest.xml\r\n`ã‚«ãƒ¡ãƒ©æ¨©é™`ãŒå¿…è¦ã§ã™ã€‚ã¾ãŸã€`uses-feature`ã‚’ã‚µãƒ³ãƒ—ãƒ«é€šã‚Šæ›¸ã„ã¦ãŠãã¾ã—ãŸãŒç„¡ãã¦ã‚‚å‹•ãã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\">\r\n\r\n    <!-- ã‚«ãƒ¡ãƒ©æ¨©é™ -->\r\n    <uses-permission android:name=\"android.permission.CAMERA\" />\r\n    <!-- AR Core ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã‚‹ç«¯æœ«ã®ã¿ Google Play ã§è¡¨ç¤ºã•ã›ã‚‹ -->\r\n    <uses-feature\r\n        android:name=\"android.hardware.camera.ar\"\r\n        android:required=\"true\" />\r\n    <uses-feature\r\n        android:glEsVersion=\"0x00020000\"\r\n        android:required=\"true\" />\r\n```\r\n\r\nã‚ã¨ã‚‚ã†ä¸€ç®‡æ‰€ã€`application`ã®ä¸­ã«`meta-data`ã‚’ä¸€ã¤æ›¸ãã¾ã™\r\n\r\n```xml\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:dataExtractionRules=\"@xml/data_extraction_rules\"\r\n        android:fullBackupContent=\"@xml/backup_rules\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.ARCoreGitHubSkyline\"\r\n        tools:targetApi=\"31\">\r\n\r\n        <!-- AR Google Play Service ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’å¿…é ˆã«ã™ã‚‹  -->\r\n        <meta-data\r\n            android:name=\"com.google.ar.core\"\r\n            android:value=\"required\" />\r\n```\r\n\r\n# build.gradle\r\n`AR Core`ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨`obj`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰±ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨å…¬å¼ã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€ã‚ã¨æ¨©é™å–ã‚‹ã®ã§`Activity Result API`ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n\r\n    // ARCore (Google Play Services for AR) library.\r\n    implementation(\"com.google.ar:core:1.34.0\")\r\n\r\n    // Obj - a simple Wavefront OBJ file loader\r\n    // https://github.com/javagl/Obj\r\n    implementation(\"de.javagl:obj:0.2.1\")\r\n\r\n    // ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«\r\n    implementation(\"androidx.lifecycle:lifecycle-common-java8:2.5.1\")\r\n\r\n    // Activity Result API\r\n    implementation(\"androidx.activity:activity-ktx:1.6.1\")\r\n    implementation(\"androidx.fragment:fragment-ktx:1.5.4\")\r\n```\r\n\r\nã‚ã€ã¤ã„ã§ã«`targetSdk`ã‚’`33`ã«ã—ã¦ãŠãã¾ã™ã€‚ãªã‚“ã‹`32`ã®ã¾ã¾ã ã£ãŸã®ã§  \r\nã‚ã¨`ViewBinding`ã‚‚æœ‰åŠ¹ã«ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\nandroid {\r\n    namespace 'io.github.takusan23.arcoregithubskyline'\r\n    compileSdk 33 // ã“ã“ã‚‚\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.arcoregithubskyline\"\r\n        minSdk 24\r\n        targetSdk 33 // ã“ã“\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildFeatures {\r\n        viewBinding true // ã“ã‚Œã‚‚\r\n    }\r\n\r\n// ä»¥ä¸‹ç•¥\r\n```\r\n\r\n# å…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒ”ãƒšã™ã‚‹\r\n`hello_ar_kotlin`ã®`app/src/main/java/com/google/ar/core/examples/java`ã®ä¸­ã«ã‚ã‚‹`common`ã‚’Android Studioã®`MainActivity.kt`ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚  \r\nã¯ã„ã€‚`import`ã®éƒ¨åˆ†ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã¨æ€ã„ã¾ã™ã®ã§ã€ã‚¨ãƒ©ãƒ¼ã®éƒ¨åˆ†ã‚’æ¶ˆã—ã¦`Alt+Enter`ã—ã¦ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ç›´ã›ã°æ²»ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/FtlBwSU.png)\r\n\r\n# å…¬å¼ã®ã‚¢ã‚»ãƒƒãƒˆã‚’ã‚³ãƒ”ãƒšã™ã‚‹\r\nä»Šå›ã¯`OpenGL`ã®`GLSLè¨€èª`ã§æ›¸ã‹ã‚ŒãŸ`ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼`ã‚‚ãƒ‘ã‚¯ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã¾ã‚å¾Œã§å°‘ã—æ‰‹ç›´ã—ã‚’ã—ã¾ã™ãŒã€‚  \r\n1ã‹ã‚‰æ›¸ãã¨ã‹ã¯ã¡ã‚‡ã£ã¨åˆ†ã‹ã‚‰ã‚“...\r\n\r\n`assets`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦\r\n\r\n![Imgur](https://imgur.com/njIeQPa.png)\r\n\r\n`hello_ar_kotlin`ã®`app/src/main/assets`ã®`models`ã€`shaders`ã‹ã‚‰ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãã¾ã™ã€‚\r\n\r\n- models\r\n    - dfg.raw\r\n    - trigrid.png\r\n- shaders\r\n    - background_show_camera.vert\r\n    - cubemap_filter.frag\r\n    - cubemap_filter.vert\r\n    - environmental_hdr.frag\r\n    - environmental_hdr.vert\r\n    - occlusion.frag\r\n    - occlusion.vert\r\n    - plane.frag\r\n    - plane.vert\r\n    - point_cloud.frag\r\n    - point_cloud.vert\r\n\r\nã“ã†ãªã£ã¦ã‚Œã°è‰¯ã„ã¯ãš\r\n\r\n![Imgur](https://imgur.com/afuGMoj.png)\r\n\r\n# ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¥ã‚Œã‚‹\r\nã•ã£ãä½œã£ãŸ`models`ã«`Blender`ã§ä¿å­˜ã—ãŸ`objãƒ•ã‚¡ã‚¤ãƒ«`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/SRaUnkt.png)\r\n\r\nã“ã‚Œã§ã‚¢ã‚»ãƒƒãƒˆç·¨ã¯çµ‚ã‚ã‚Šãªã¯ãš..\r\n\r\n# activity_main.xml\r\n`GlSurfaceView`ã‚’ç½®ãã¾ã™ã€‚ãšã£ã¨`Jetpack Compose`ã ã£ãŸã®ã§æ‡ã‹ã—ã„ã§ã™ã­ï¼ˆï¼Ÿï¼‰\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <android.opengl.GLSurfaceView\r\n        android:id=\"@+id/activity_main_gl_surfaceview\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n# ARCore ã‚’ä½¿ã†\r\nARCoreã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚  \r\nã»ã¼ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ã§ã™ãŒ\r\n\r\n```kotlin\r\n/**\r\n * ARCoreã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¨ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«\r\n */\r\nclass ARCoreSessionLifecycleHelper(\r\n    private val activity: Activity,\r\n    private val features: Set<Session.Feature> = emptySet(),\r\n) : DefaultLifecycleObserver {\r\n\r\n    var installRequested = false\r\n    var session: Session? = null\r\n        private set\r\n\r\n    /**\r\n     * å¤±æ•—æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°\r\n     *\r\n     * @see [Session constructor](https://developers.google.com/ar/reference/java/com/google/ar/core/Session#Session(android.content.Context))\r\n     */\r\n    var exceptionCallback: ((Exception) -> Unit)? = null\r\n\r\n    /**\r\n     * ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æ§‹æˆãŒå¿…è¦ã«ãªã£ãŸã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚ARCoreã®æ©Ÿèƒ½ãªã©\r\n     *\r\n     * [Session.configure](https://developers.google.com/ar/reference/java/com/google/ar/core/Session#configure-config)\r\n     * [setCameraConfig](https://developers.google.com/ar/reference/java/com/google/ar/core/Session#setCameraConfig-cameraConfig)\r\n     */\r\n    var beforeSessionResume: ((Session) -> Unit)? = null\r\n\r\n    /**\r\n     * ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®ä½œæˆã‚’è©¦ã¿ã‚‹ã€‚\r\n     * AR ã® Google Play Service ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã€‚\r\n     */\r\n    private fun tryCreateSession(): Session? {\r\n        // æ¨©é™ãŒãªã‘ã‚Œã°return\r\n        if (!CameraPermissionHelper.hasCameraPermission(activity)) {\r\n            return null\r\n        }\r\n\r\n        return try {\r\n            // Request installation if necessary.\r\n            when (ArCoreApk.getInstance().requestInstall(activity, !installRequested)) {\r\n                ArCoreApk.InstallStatus.INSTALL_REQUESTED -> {\r\n                    installRequested = true\r\n                    // tryCreateSession will be called again, so we return null for now.\r\n                    return null\r\n                }\r\n                ArCoreApk.InstallStatus.INSTALLED -> {\r\n                    // Left empty; nothing needs to be done.\r\n                }\r\n            }\r\n\r\n            // Create a session if Google Play Services for AR is installed and up to date.\r\n            Session(activity, features)\r\n        } catch (e: Exception) {\r\n            exceptionCallback?.invoke(e)\r\n            null\r\n        }\r\n    }\r\n\r\n    override fun onResume(owner: LifecycleOwner) {\r\n        val session = this.session ?: tryCreateSession() ?: return\r\n        try {\r\n            beforeSessionResume?.invoke(session)\r\n            session.resume()\r\n            this.session = session\r\n        } catch (e: CameraNotAvailableException) {\r\n            exceptionCallback?.invoke(e)\r\n        }\r\n    }\r\n\r\n    override fun onPause(owner: LifecycleOwner) {\r\n        session?.pause()\r\n    }\r\n\r\n    override fun onDestroy(owner: LifecycleOwner) {\r\n        // ARCoreã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’ç ´æ£„ã™ã‚‹\r\n        // https://developers.google.com/ar/reference/java/arcore/reference/com/google/ar/core/Session#close()\r\n        session?.close()\r\n        session = null\r\n    }\r\n}\r\n```\r\n\r\n`MainActivity.kt`ã§ã¯ã“ã‚“ãªæ„Ÿã˜ã«ä½¿ã„ã¾ã™ã€‚  \r\nã¤ã„ã§ã«ã‚«ãƒ¡ãƒ©æ¨©é™ãªã„å ´åˆã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** ARCoreã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† */\r\n    private val arCoreSessionLifecycleHelper by lazy { ARCoreSessionLifecycleHelper(this) }\r\n\r\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val permissionRequester = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGrant ->\r\n        if (isGrant) {\r\n            setup()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        lifecycle.addObserver(arCoreSessionLifecycleHelper)\r\n\r\n        // æ¨©é™ãŒãªã„å ´åˆã¯å–å¾—ã™ã‚‹\r\n        if (CameraPermissionHelper.hasCameraPermission(this)) {\r\n            setup()\r\n        } else {\r\n            permissionRequester.launch(android.Manifest.permission.CAMERA)\r\n        }\r\n    }\r\n\r\n    private fun setup() {\r\n        arCoreSessionLifecycleHelper.apply {\r\n            // å¤±æ•—ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\r\n            exceptionCallback = { exception ->\r\n                exception.printStackTrace()\r\n            }\r\n            // æ§‹æˆ\r\n            beforeSessionResume = { session ->\r\n                session.configure(\r\n                    session.config.apply {\r\n                        lightEstimationMode = Config.LightEstimationMode.ENVIRONMENTAL_HDR\r\n                        // Depth API ã¯ä½¿ã„ãŸã„\r\n                        depthMode = if (session.isDepthModeSupported(Config.DepthMode.AUTOMATIC)) {\r\n                            Config.DepthMode.AUTOMATIC\r\n                        } else {\r\n                            Config.DepthMode.DISABLED\r\n                        }\r\n                        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆé…ç½®ã¯ä½¿ã‚ãªã„\r\n                        instantPlacementMode = Config.InstantPlacementMode.DISABLED\r\n                    }\r\n                )\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n# ViewBindingã™ã‚‹ã‚¯ãƒ©ã‚¹\r\nã“ã®ãƒ¬ãƒ™ãƒ«ã ã¨ãã®ã¾ã¾ä½¿ã£ãŸã»ã†ãŒè‰¯ã•ãã†ã¾ã§ã‚ã‚‹ã‘ã©ä¸€å¿œ\r\n\r\n```kotlin\r\n/** GLSurfaceViewã®ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ã™ã‚‹ã‚„ã¤ */\r\nclass ARViewLifecycle(context: Context) : DefaultLifecycleObserver {\r\n\r\n    val viewBinding = ActivityMainBinding.inflate(LayoutInflater.from(context))\r\n\r\n    override fun onPause(owner: LifecycleOwner) {\r\n        super.onPause(owner)\r\n        viewBinding.activityMainGlSurfaceview.onPause()\r\n    }\r\n\r\n    override fun onResume(owner: LifecycleOwner) {\r\n        super.onResume(owner)\r\n        viewBinding.activityMainGlSurfaceview.onResume()\r\n    }\r\n}\r\n```\r\n\r\n`MainActivity.kt`ã§`setContentView`ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** ARCoreã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† */\r\n    private val arCoreSessionLifecycleHelper by lazy { ARCoreSessionLifecycleHelper(this) }\r\n\r\n    /** GLSurfaceView */\r\n    private val arViewLifecycle by lazy { ARViewLifecycle(this) }\r\n\r\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val permissionRequester = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGrant ->\r\n        if (isGrant) {\r\n            setup()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(arViewLifecycle.viewBinding.root)\r\n\r\n        lifecycle.addObserver(arCoreSessionLifecycleHelper)\r\n        lifecycle.addObserver(arViewLifecycle)\r\n\r\n        // æ¨©é™ãŒãªã„å ´åˆã¯å–å¾—ã™ã‚‹\r\n        if (CameraPermissionHelper.hasCameraPermission(this)) {\r\n            setup()\r\n        } else {\r\n            permissionRequester.launch(android.Manifest.permission.CAMERA)\r\n        }\r\n    }\r\n\r\n    // çœç•¥\r\n}\r\n```\r\n\r\n# æç”»ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\n\r\nã„ã‚ˆã„ã‚ˆæç”»ã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦ã„ãã¾ã™ã€‚  \r\n`ARCoreOpenGlRenderer.kt`ã§ã™ã€‚\r\n\r\n```kotlin\r\n/** OpenGLã‚’åˆ©ç”¨ã—ã¦æç”»ã™ã‚‹ã‚¯ãƒ©ã‚¹ */\r\nclass ARCoreOpenGlRenderer(\r\n    private val context: Context,\r\n    private val arCoreSessionLifecycleHelper: ARCoreSessionLifecycleHelper,\r\n    private val tapHelper: TapHelper,\r\n) : SampleRender.Renderer, DefaultLifecycleObserver {\r\n\r\n    override fun onResume(owner: LifecycleOwner) {\r\n        super.onResume(owner)\r\n    }\r\n\r\n    override fun onPause(owner: LifecycleOwner) {\r\n        super.onPause(owner)\r\n    }\r\n\r\n    override fun onSurfaceCreated(render: SampleRender?) {\r\n\r\n    }\r\n\r\n    override fun onSurfaceChanged(render: SampleRender?, width: Int, height: Int) {\r\n\r\n    }\r\n\r\n    override fun onDrawFrame(render: SampleRender?) {\r\n\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã‚’`MainActivity`ã§ã“ã†ã‚„ã£ã¦ä½¿ã„ã¾ã™\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** ARCoreã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç† */\r\n    private val arCoreSessionLifecycleHelper by lazy { ARCoreSessionLifecycleHelper(this) }\r\n\r\n    /** GLSurfaceView */\r\n    private val arViewLifecycle by lazy { ARViewLifecycle(this) }\r\n\r\n    /** ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆ */\r\n    private val tapHelper by lazy { TapHelper(this).also { arViewLifecycle.viewBinding.activityMainGlSurfaceview.setOnTouchListener(it) } }\r\n\r\n    /** OpenGLã§ARCoreæç”»ã™ã‚‹ã‚„ã¤ */\r\n    private val renderer by lazy { ARCoreOpenGlRenderer(this, arCoreSessionLifecycleHelper, tapHelper) }\r\n\r\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val permissionRequester = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGrant ->\r\n        if (isGrant) {\r\n            setup()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(arViewLifecycle.viewBinding.root)\r\n\r\n        lifecycle.addObserver(arCoreSessionLifecycleHelper)\r\n        lifecycle.addObserver(arViewLifecycle)\r\n        lifecycle.addObserver(renderer)\r\n\r\n        // æ¨©é™ãŒãªã„å ´åˆã¯å–å¾—ã™ã‚‹\r\n        if (CameraPermissionHelper.hasCameraPermission(this)) {\r\n            setup()\r\n        } else {\r\n            permissionRequester.launch(android.Manifest.permission.CAMERA)\r\n        }\r\n    }\r\n\r\n    private fun setup() {\r\n        arCoreSessionLifecycleHelper.apply {\r\n            // å¤±æ•—ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\r\n            exceptionCallback = { exception ->\r\n                exception.printStackTrace()\r\n            }\r\n            // æ§‹æˆ\r\n            beforeSessionResume = { session ->\r\n                session.configure(\r\n                    session.config.apply {\r\n                        lightEstimationMode = Config.LightEstimationMode.ENVIRONMENTAL_HDR\r\n                        // Depth API ã¯ä½¿ã„ãŸã„\r\n                        depthMode = if (session.isDepthModeSupported(Config.DepthMode.AUTOMATIC)) {\r\n                            Config.DepthMode.AUTOMATIC\r\n                        } else {\r\n                            Config.DepthMode.DISABLED\r\n                        }\r\n                        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ãƒˆé…ç½®ã¯ä½¿ã‚ãªã„\r\n                        instantPlacementMode = Config.InstantPlacementMode.DISABLED\r\n                    }\r\n                )\r\n            }\r\n        }\r\n\r\n        // æç”»ã™ã‚‹\r\n        SampleRender(arViewLifecycle.viewBinding.activityMainGlSurfaceview, renderer, assets)\r\n    }\r\n}\r\n```\r\n\r\n## ãã®ã¾ãˆã« Toast ã‚’å‡ºã™ã ã‘ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹\r\n\r\n```kotlin\r\n/** Toastã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ã®ã‚¯ãƒ©ã‚¹ */\r\nclass ToastManager(private val context: Context) {\r\n    private val handler = Handler(Looper.getMainLooper())\r\n\r\n    /** å‰å›ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ */\r\n    private var prevMessage: String? = null\r\n\r\n    /**\r\n     * Toastã‚’è¡¨ç¤ºã•ã›ã‚‹\r\n     * @param message æœ¬æ–‡\r\n     */\r\n    fun show(message: String) {\r\n        // åŒã˜å ´åˆã¯å‡ºã•ãªã„\r\n        if (prevMessage == message) {\r\n            return\r\n        }\r\n        handler.post {\r\n            Toast.makeText(context, message, Toast.LENGTH_SHORT).show()\r\n            prevMessage = message\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’æç”»ã™ã‚‹\r\nã¾ãšã¯ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’æç”»ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n```kotlin\r\n/** OpenGLã‚’åˆ©ç”¨ã—ã¦æç”»ã™ã‚‹ã‚¯ãƒ©ã‚¹ */\r\nclass ARCoreOpenGlRenderer(\r\n    private val context: Context,\r\n    private val arCoreSessionLifecycleHelper: ARCoreSessionLifecycleHelper,\r\n    private val tapHelper: TapHelper,\r\n) : SampleRender.Renderer, DefaultLifecycleObserver {\r\n\r\n    /** ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚„ã¤ */\r\n    private lateinit var backgroundRenderer: BackgroundRenderer\r\n    private lateinit var virtualSceneFramebuffer: Framebuffer\r\n    private val displayRotationHelper = DisplayRotationHelper(context)\r\n\r\n    /** ã‚«ãƒ¡ãƒ©æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’æ¸¡ã—ãŸã‹ã€‚ä¸€åº¦ã ã‘è¡Œã†ãŸã‚ */\r\n    private var isAlreadySetTexture = false\r\n    \r\n    override fun onResume(owner: LifecycleOwner) {\r\n        super.onResume(owner)\r\n        displayRotationHelper.onResume()\r\n    }\r\n\r\n    override fun onPause(owner: LifecycleOwner) {\r\n        super.onPause(owner)\r\n        displayRotationHelper.onPause()\r\n    }\r\n\r\n    /** SurfaceViewãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã‚‰å‘¼ã°ã‚Œã‚‹ */\r\n    override fun onSurfaceCreated(render: SampleRender) {\r\n        backgroundRenderer = BackgroundRenderer(render)\r\n        virtualSceneFramebuffer = Framebuffer(render, /*width=*/ 1, /*height=*/ 1)\r\n    }\r\n\r\n    /** SurfaceViewã®ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã« */\r\n    override fun onSurfaceChanged(render: SampleRender, width: Int, height: Int) {\r\n        displayRotationHelper.onSurfaceChanged(width, height)\r\n        virtualSceneFramebuffer.resize(width, height)\r\n    }\r\n\r\n    /** æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã‚‹ï¼Ÿ */\r\n    override fun onDrawFrame(render: SampleRender) {\r\n        val session = arCoreSessionLifecycleHelper.session ?: return\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒãƒ†ã‚¯ã‚¹ãƒãƒ£\r\n        if (!isAlreadySetTexture) {\r\n            session.setCameraTextureNames(intArrayOf(backgroundRenderer.cameraColorTexture.textureId))\r\n            isAlreadySetTexture = true\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒã®ã‚µã‚¤ã‚ºã‚’åˆã‚ã›ã‚‹\r\n        displayRotationHelper.updateSessionIfNeeded(session)\r\n\r\n        // ARSession ã‹ã‚‰ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å–å¾—\r\n        val frame = try {\r\n            session.update()\r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Camera not available during onDrawFrame\", e)\r\n            return\r\n        }\r\n\r\n        val camera = frame.camera\r\n        // æ·±åº¦è¨­å®š\r\n        try {\r\n            backgroundRenderer.setUseDepthVisualization(render, false)\r\n            backgroundRenderer.setUseOcclusion(render, true)\r\n        } catch (e: IOException) {\r\n            Log.e(TAG, \"Failed to read a required asset file\", e)\r\n            return\r\n        }\r\n\r\n        // åº§æ¨™ã‚’æ›´æ–°ã™ã‚‹\r\n        backgroundRenderer.updateDisplayGeometry(frame)\r\n        // æ·±åº¦è¨­å®š\r\n        val shouldGetDepthImage = true\r\n        if (camera.trackingState == TrackingState.TRACKING && shouldGetDepthImage) {\r\n            try {\r\n                val depthImage = frame.acquireDepthImage16Bits()\r\n                backgroundRenderer.updateCameraDepthTexture(depthImage)\r\n                depthImage.close()\r\n            } catch (e: NotYetAvailableException) {\r\n                // ã¾ã æ·±åº¦ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨ã§ããªã„\r\n                // åˆ¥ã«ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãæ­£å¸¸\r\n            }\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’æç”»ã™ã‚‹\r\n        if (frame.timestamp != 0L) {\r\n            // ã‚«ãƒ¡ãƒ©ãŒã¾ã æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç”Ÿæˆã—ã¦ã„ãªã„å ´åˆã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æŠ‘åˆ¶ã—ã¾ã™ã€‚ ã“ã‚Œã¯é¿ã‘ã‚‹ãŸã‚ã§ã™\r\n            // ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒå†åˆ©ç”¨ã•ã‚Œã‚‹å ´åˆã€ä»¥å‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰æ®‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æç”»ã—ã¾ã™ã€‚\r\n            backgroundRenderer.drawBackground(render)\r\n        }\r\n        // è¿½è·¡ã—ãªã„å ´åˆã¯ã€3D ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»ã—ãªã„\r\n        if (camera.trackingState == TrackingState.PAUSED) {\r\n            return\r\n        }\r\n\r\n        // èƒŒæ™¯ã‚’ä½¿ç”¨ã—ã¦ä»®æƒ³ã‚·ãƒ¼ãƒ³ã‚’æ§‹æˆã—ã¾ã™ã€‚\r\n        backgroundRenderer.drawVirtualScene(render, virtualSceneFramebuffer, Z_NEAR, Z_FAR)\r\n    }\r\n\r\n    companion object {\r\n        private val TAG = ARCoreOpenGlRenderer::class.java.simpleName\r\n\r\n        private const val Z_NEAR = 0.1f\r\n        private const val Z_FAR = 100f\r\n    }\r\n}\r\n```\r\n\r\nå¾Œã¯å®Ÿè¡Œã—ã¦ã‚«ãƒ¡ãƒ©æ˜ åƒãŒæç”»ã•ã‚Œã¦ã„ã‚Œã°æˆåŠŸã§ã™ï¼\r\n\r\n![Imgur](https://imgur.com/02T1zOV.png)\r\n\r\n## å¹³é¢ã¨ã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’æç”»ã™ã‚‹\r\n\r\nå¹³é¢ã¯ã“ã®ç™½è‰²ã®ä¸‰è§’å½¢ã®ã‚¿ã‚¤ãƒ«ã¿ãŸã„ãªã‚„ã¤ã§ã™ã€‚  \r\nã‚¯ãƒ©ã‚¦ãƒ‰ãƒã‚¤ãƒ³ãƒˆã£ã¦ã®ã¯ã“ã®é’ã„ã¦ã‚“ã¦ã‚“ã®ã“ã¨ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/sWGK2wA.png)\r\n\r\nã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æç”»ã®éš›ã«ä½¿ã†`FloatArray`ã‚‚ä»Šå›ã¾ã¨ã‚ã¦æ›¸ã„ã¡ã‚ƒã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/** OpenGLã‚’åˆ©ç”¨ã—ã¦æç”»ã™ã‚‹ã‚¯ãƒ©ã‚¹ */\r\nclass ARCoreOpenGlRenderer(\r\n    private val context: Context,\r\n    private val arCoreSessionLifecycleHelper: ARCoreSessionLifecycleHelper,\r\n    private val tapHelper: TapHelper,\r\n) : SampleRender.Renderer, DefaultLifecycleObserver {\r\n\r\n    /** ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚„ã¤ */\r\n    private lateinit var backgroundRenderer: BackgroundRenderer\r\n    private lateinit var virtualSceneFramebuffer: Framebuffer\r\n    private val displayRotationHelper = DisplayRotationHelper(context)\r\n\r\n    /** ã‚«ãƒ¡ãƒ©æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’æ¸¡ã—ãŸã‹ã€‚ä¸€åº¦ã ã‘è¡Œã†ãŸã‚ */\r\n    private var isAlreadySetTexture = false\r\n\r\n    /** å¹³é¢ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚„ã¤ */\r\n    private lateinit var planeRenderer: PlaneRenderer\r\n\r\n    /** Point Cloud (ã‚ã®é’ã„ç‚¹) */\r\n    private lateinit var pointCloudVertexBuffer: VertexBuffer\r\n    private lateinit var pointCloudMesh: Mesh\r\n    private lateinit var pointCloudShader: Shader\r\n\r\n    /** æœ€å¾Œã®ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ */\r\n    private var lastPointCloudTimestamp = 0L\r\n\r\n    /** ARä¸Šã«ãŠã„ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ— */\r\n    private val wrappedAnchors = mutableListOf<WrappedAnchor>()\r\n\r\n    /** Toastå‡ºã™ã ã‘ */\r\n    private val toastManager = ToastManager(context)\r\n\r\n    private val modelMatrix = FloatArray(16)\r\n    private val viewMatrix = FloatArray(16)\r\n    private val modelViewMatrix = FloatArray(16)\r\n    private val projectionMatrix = FloatArray(16)\r\n    private val modelViewProjectionMatrix = FloatArray(16)\r\n    private val viewInverseMatrix = FloatArray(16)\r\n    private val sphericalHarmonicsCoefficients = FloatArray(9 * 3)\r\n    private val worldLightDirection = floatArrayOf(0.0f, 0.0f, 0.0f, 0.0f)\r\n    private val viewLightDirection = FloatArray(4)\r\n\r\n    // çœç•¥\r\n\r\n    /** SurfaceViewãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã‚‰å‘¼ã°ã‚Œã‚‹ */\r\n    override fun onSurfaceCreated(render: SampleRender) {\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒ\r\n        backgroundRenderer = BackgroundRenderer(render)\r\n        virtualSceneFramebuffer = Framebuffer(render, /*width=*/ 1, /*height=*/ 1)\r\n\r\n        // å¹³é¢\r\n        planeRenderer = PlaneRenderer(render)\r\n\r\n        // ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ (å¹³é¢ã‚’è¦‹ã¤ã‘ã‚‹éš›ã«è¡¨ç¤ºã•ã‚Œã‚‹é’ã„ã‚„ã¤)\r\n        pointCloudShader = Shader.createFromAssets(\r\n            render,\r\n            \"shaders/point_cloud.vert\",\r\n            \"shaders/point_cloud.frag\",\r\n            /*defines=*/ null\r\n        ).apply {\r\n            setVec4(\"u_Color\", floatArrayOf(31.0f / 255.0f, 188.0f / 255.0f, 210.0f / 255.0f, 1.0f))\r\n            setFloat(\"u_PointSize\", 5.0f)\r\n        }\r\n        pointCloudVertexBuffer = VertexBuffer(render, /*numberOfEntriesPerVertex=*/ 4, /*entries=*/ null)\r\n        pointCloudMesh = Mesh(render, Mesh.PrimitiveMode.POINTS, /*indexBuffer=*/ null, arrayOf(pointCloudVertexBuffer))\r\n    }\r\n\r\n    // çœç•¥\r\n\r\n    /** æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã‚‹ï¼Ÿ */\r\n    override fun onDrawFrame(render: SampleRender) {\r\n        val session = arCoreSessionLifecycleHelper.session ?: return\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒãƒ†ã‚¯ã‚¹ãƒãƒ£\r\n        if (!isAlreadySetTexture) {\r\n            session.setCameraTextureNames(intArrayOf(backgroundRenderer.cameraColorTexture.textureId))\r\n            isAlreadySetTexture = true\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒã®ã‚µã‚¤ã‚ºã‚’åˆã‚ã›ã‚‹\r\n        displayRotationHelper.updateSessionIfNeeded(session)\r\n\r\n        // ARSession ã‹ã‚‰ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å–å¾—\r\n        val frame = try {\r\n            session.update()\r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Camera not available during onDrawFrame\", e)\r\n            return\r\n        }\r\n\r\n        val camera = frame.camera\r\n        // æ·±åº¦è¨­å®š\r\n        try {\r\n            backgroundRenderer.setUseDepthVisualization(render, false)\r\n            backgroundRenderer.setUseOcclusion(render, true)\r\n        } catch (e: IOException) {\r\n            Log.e(TAG, \"Failed to read a required asset file\", e)\r\n            return\r\n        }\r\n\r\n        // åº§æ¨™ã‚’æ›´æ–°ã™ã‚‹\r\n        backgroundRenderer.updateDisplayGeometry(frame)\r\n        val shouldGetDepthImage = true\r\n        if (camera.trackingState == TrackingState.TRACKING && shouldGetDepthImage) {\r\n            try {\r\n                val depthImage = frame.acquireDepthImage16Bits()\r\n                backgroundRenderer.updateCameraDepthTexture(depthImage)\r\n                depthImage.close()\r\n            } catch (e: NotYetAvailableException) {\r\n                // ã¾ã æ·±åº¦ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨ã§ããªã„\r\n                // åˆ¥ã«ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãæ­£å¸¸\r\n            }\r\n        }\r\n\r\n        // ã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã‹ã€æ¯ãƒ•ãƒ¬ãƒ¼ãƒ è¦‹ã‚‹\r\n        handleTap(frame, camera)\r\n\r\n        // ARã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\r\n        // å¹³é¢ãŒæ¤œå‡ºã•ã‚Œã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‹ã©ã†ã‹ãªã©\r\n        when {\r\n            camera.trackingState == TrackingState.PAUSED && camera.trackingFailureReason == TrackingFailureReason.NONE -> \"å¹³é¢ã‚’æ¢ã—ã¦ã„ã¾ã™\"\r\n            camera.trackingState == TrackingState.PAUSED -> null\r\n            hasTrackingPlane(session) && wrappedAnchors.isEmpty() -> \"å¹³é¢ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ã‚¿ãƒƒãƒ—ã—ã¦é…ç½®ã—ã¾ã™ã€‚\"\r\n            hasTrackingPlane(session) && wrappedAnchors.isNotEmpty() -> null\r\n            else -> \"å¹³é¢ã‚’æ¢ã—ã¦ã„ã¾ã™\"\r\n        }?.also {\r\n            toastManager.show(it)\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’æç”»ã™ã‚‹\r\n        if (frame.timestamp != 0L) {\r\n            // ã‚«ãƒ¡ãƒ©ãŒã¾ã æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç”Ÿæˆã—ã¦ã„ãªã„å ´åˆã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æŠ‘åˆ¶ã—ã¾ã™ã€‚ ã“ã‚Œã¯é¿ã‘ã‚‹ãŸã‚ã§ã™\r\n            // ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒå†åˆ©ç”¨ã•ã‚Œã‚‹å ´åˆã€ä»¥å‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰æ®‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æç”»ã—ã¾ã™ã€‚\r\n            backgroundRenderer.drawBackground(render)\r\n        }\r\n        // è¿½è·¡ã—ãªã„å ´åˆã¯ã€3D ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»ã—ãªã„\r\n        if (camera.trackingState == TrackingState.PAUSED) {\r\n            return\r\n        }\r\n\r\n        // å°„å½±è¡Œåˆ—ã‚’å–å¾—ã™ã‚‹\r\n        camera.getProjectionMatrix(projectionMatrix, 0, Z_NEAR, Z_FAR)\r\n\r\n        // ã‚«ãƒ¡ãƒ©è¡Œåˆ—ã‚’å–å¾—ã—ã¦æç”».\r\n        camera.getViewMatrix(viewMatrix, 0)\r\n\r\n        // ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ã®æç”»\r\n        frame.acquirePointCloud().use { pointCloud ->\r\n            if (pointCloud.timestamp > lastPointCloudTimestamp) {\r\n                pointCloudVertexBuffer.set(pointCloud.points)\r\n                lastPointCloudTimestamp = pointCloud.timestamp\r\n            }\r\n            Matrix.multiplyMM(modelViewProjectionMatrix, 0, projectionMatrix, 0, viewMatrix, 0)\r\n            pointCloudShader.setMat4(\"u_ModelViewProjection\", modelViewProjectionMatrix)\r\n            render.draw(pointCloudMesh, pointCloudShader)\r\n        }\r\n\r\n        // å¹³é¢ã‚’æç”»ã—ã¾ã™\r\n        planeRenderer.drawPlanes(render, session.getAllTrackables(Plane::class.java), camera.displayOrientedPose, projectionMatrix)\r\n\r\n        // èƒŒæ™¯ã‚’ä½¿ç”¨ã—ã¦ä»®æƒ³ã‚·ãƒ¼ãƒ³ã‚’æ§‹æˆã—ã¾ã™ã€‚\r\n        backgroundRenderer.drawVirtualScene(render, virtualSceneFramebuffer, Z_NEAR, Z_FAR)\r\n    }\r\n\r\n    /** 1ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«ã‚¿ãƒƒãƒ—ã‚’å‡¦ç†ã™ã‚‹ */\r\n    private fun handleTap(frame: Frame, camera: Camera) {\r\n        if (camera.trackingState != TrackingState.TRACKING) return\r\n        val tap = tapHelper.poll() ?: return\r\n\r\n        // ãƒ’ãƒƒãƒˆã¯æ·±ã•ã«ã‚ˆã£ã¦ã‚½ãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚å¹³é¢ä¸Šã®æœ€ã‚‚è¿‘ã„ãƒ’ãƒƒãƒˆã®ã¿\r\n        val hitResultList = frame.hitTest(tap)\r\n        val firstHitResult = hitResultList.firstOrNull { hit ->\r\n            when (val trackable = hit.trackable!!) {\r\n                is Plane -> trackable.isPoseInPolygon(hit.hitPose) && PlaneRenderer.calculateDistanceToPlane(hit.hitPose, camera.pose) > 0\r\n                is Point -> trackable.orientationMode == Point.OrientationMode.ESTIMATED_SURFACE_NORMAL\r\n                is InstantPlacementPoint -> true\r\n                // DepthPoints are only returned if Config.DepthMode is set to AUTOMATIC.\r\n                is DepthPoint -> true\r\n                else -> false\r\n            }\r\n        }\r\n\r\n        if (firstHitResult != null) {\r\n            // ã‚¢ãƒ³ã‚«ãƒ¼æ•°ã«åˆ¶é™ã‚’ã‹ã‘ã‚‹\r\n            if (wrappedAnchors.size >= 20) {\r\n                wrappedAnchors[0].anchor.detach()\r\n                wrappedAnchors.removeAt(0)\r\n            }\r\n            // è¿½è·¡ç™»éŒ²\r\n            wrappedAnchors.add(WrappedAnchor(firstHitResult.createAnchor(), firstHitResult.trackable))\r\n        }\r\n    }\r\n\r\n    /** å¹³é¢ãŒ1ã¤ä»¥ä¸Šè¦‹ã¤ã‹ã£ã¦ã„ã‚Œã° true */\r\n    private fun hasTrackingPlane(session: Session) = session.getAllTrackables(Plane::class.java).any { it.trackingState == TrackingState.TRACKING }\r\n\r\n    /** ã‚¢ãƒ³ã‚«ãƒ¼ã¨ãƒˆãƒ©ãƒƒã‚«ãƒ–ãƒ«ã‚’ç´ã¤ã‘ã‚‹ */\r\n    private data class WrappedAnchor(\r\n        val anchor: Anchor,\r\n        val trackable: Trackable,\r\n    )\r\n\r\n    // çœç•¥\r\n}\r\n```\r\n\r\n## ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»ã™ã‚‹ (å¤šåˆ†æœ€å¾Œ)\r\n\r\nã¤ã„ã«GitHubã®è‰ã‚’ARã«ç™»å ´ã•ã›ã¾ã™ï¼ï¼ï¼  \r\nä»Šå›ã¯ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ç”¨æ„ã—ãªã„ã®ã§ã€å˜è‰²ã§å¡—ã‚Šã¤ã¶ã™ã‚ˆã†`ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€`ã«ã‚‚æ‰‹ã‚’åŠ ãˆã¾ã™ã€‚\r\n\r\né¢å€’ãªã®ã§ã“ã“ã¾ã§å…¨éƒ¨å¼µã‚Šã¾ã™ã€‚\r\n\r\n### ARCoreOpenGlRenderer\r\n\r\n```kotlin\r\n/** OpenGLã‚’åˆ©ç”¨ã—ã¦æç”»ã™ã‚‹ã‚¯ãƒ©ã‚¹ */\r\nclass ARCoreOpenGlRenderer(\r\n    private val context: Context,\r\n    private val arCoreSessionLifecycleHelper: ARCoreSessionLifecycleHelper,\r\n    private val tapHelper: TapHelper,\r\n) : SampleRender.Renderer, DefaultLifecycleObserver {\r\n\r\n    /** ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚„ã¤ */\r\n    private lateinit var backgroundRenderer: BackgroundRenderer\r\n    private lateinit var virtualSceneFramebuffer: Framebuffer\r\n    private val displayRotationHelper = DisplayRotationHelper(context)\r\n\r\n    /** ã‚«ãƒ¡ãƒ©æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’æ¸¡ã—ãŸã‹ã€‚ä¸€åº¦ã ã‘è¡Œã†ãŸã‚ */\r\n    private var isAlreadySetTexture = false\r\n\r\n    /** å¹³é¢ã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚„ã¤ */\r\n    private lateinit var planeRenderer: PlaneRenderer\r\n\r\n    /** Point Cloud (ã‚ã®é’ã„ç‚¹) */\r\n    private lateinit var pointCloudVertexBuffer: VertexBuffer\r\n    private lateinit var pointCloudMesh: Mesh\r\n    private lateinit var pointCloudShader: Shader\r\n\r\n    /** æœ€å¾Œã®ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ */\r\n    private var lastPointCloudTimestamp = 0L\r\n\r\n    /** GitHubã®ARãƒ¢ãƒ‡ãƒ« */\r\n    private lateinit var virtualObjectMesh: Mesh\r\n    private lateinit var virtualObjectShader: Shader\r\n\r\n    /** ARãƒ¢ãƒ‡ãƒ«ã®ç’°å¢ƒHDR */\r\n    private lateinit var dfgTexture: Texture\r\n    private lateinit var cubemapFilter: SpecularCubemapFilter\r\n\r\n    /** ARä¸Šã«ãŠã„ãŸã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆé…åˆ— */\r\n    private val wrappedAnchors = mutableListOf<WrappedAnchor>()\r\n\r\n    /** Toastå‡ºã™ã ã‘ */\r\n    private val toastManager = ToastManager(context)\r\n\r\n    private val modelMatrix = FloatArray(16)\r\n    private val viewMatrix = FloatArray(16)\r\n    private val modelViewMatrix = FloatArray(16)\r\n    private val projectionMatrix = FloatArray(16)\r\n    private val modelViewProjectionMatrix = FloatArray(16)\r\n    private val viewInverseMatrix = FloatArray(16)\r\n    private val sphericalHarmonicsCoefficients = FloatArray(9 * 3)\r\n    private val worldLightDirection = floatArrayOf(0.0f, 0.0f, 0.0f, 0.0f)\r\n    private val viewLightDirection = FloatArray(4)\r\n\r\n    override fun onResume(owner: LifecycleOwner) {\r\n        super.onResume(owner)\r\n        displayRotationHelper.onResume()\r\n    }\r\n\r\n    override fun onPause(owner: LifecycleOwner) {\r\n        super.onPause(owner)\r\n        displayRotationHelper.onPause()\r\n    }\r\n\r\n    /** SurfaceViewãŒåˆ©ç”¨å¯èƒ½ã«ãªã£ãŸã‚‰å‘¼ã°ã‚Œã‚‹ */\r\n    override fun onSurfaceCreated(render: SampleRender) {\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒ\r\n        backgroundRenderer = BackgroundRenderer(render)\r\n        virtualSceneFramebuffer = Framebuffer(render, /*width=*/ 1, /*height=*/ 1)\r\n\r\n        // å¹³é¢\r\n        planeRenderer = PlaneRenderer(render)\r\n\r\n        // ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ (å¹³é¢ã‚’è¦‹ã¤ã‘ã‚‹éš›ã«è¡¨ç¤ºã•ã‚Œã‚‹é’ã„ã‚„ã¤)\r\n        pointCloudShader = Shader.createFromAssets(\r\n            render,\r\n            \"shaders/point_cloud.vert\",\r\n            \"shaders/point_cloud.frag\",\r\n            /*defines=*/ null\r\n        ).apply {\r\n            setVec4(\"u_Color\", floatArrayOf(31.0f / 255.0f, 188.0f / 255.0f, 210.0f / 255.0f, 1.0f))\r\n            setFloat(\"u_PointSize\", 5.0f)\r\n        }\r\n        pointCloudVertexBuffer = VertexBuffer(render, /*numberOfEntriesPerVertex=*/ 4, /*entries=*/ null)\r\n        pointCloudMesh = Mesh(render, Mesh.PrimitiveMode.POINTS, /*indexBuffer=*/ null, arrayOf(pointCloudVertexBuffer))\r\n\r\n        // HDRã®è¨­å®š\r\n        cubemapFilter = SpecularCubemapFilter(render, CUBEMAP_RESOLUTION, CUBEMAP_NUMBER_OF_IMPORTANCE_SAMPLES)\r\n        dfgTexture = Texture(render, Texture.Target.TEXTURE_2D, Texture.WrapMode.CLAMP_TO_EDGE,/*useMipmaps=*/ false)\r\n\r\n        // DFT ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®è¨­å®š\r\n        val dfgResolution = 64\r\n        val dfgChannels = 2\r\n        val halfFloatSize = 2\r\n        val buffer = ByteBuffer.allocateDirect(dfgResolution * dfgResolution * dfgChannels * halfFloatSize).apply {\r\n            context.assets.open(\"models/dfg.raw\").use { it.read(this.array()) }\r\n        }\r\n\r\n        GLES30.glBindTexture(GLES30.GL_TEXTURE_2D, dfgTexture.textureId)\r\n        GLError.maybeThrowGLException(\"Failed to bind DFG texture\", \"glBindTexture\")\r\n        GLES30.glTexImage2D(\r\n            GLES30.GL_TEXTURE_2D,\r\n            /*level=*/ 0,\r\n            GLES30.GL_RG16F,\r\n            /*width=*/ dfgResolution,\r\n            /*height=*/ dfgResolution,\r\n            /*border=*/ 0,\r\n            GLES30.GL_RG,\r\n            GLES30.GL_HALF_FLOAT,\r\n            buffer\r\n        )\r\n        GLError.maybeThrowGLException(\"Failed to populate DFG texture\", \"glTexImage2D\")\r\n\r\n        // 3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’èª­ã¿è¾¼ã‚€\r\n        virtualObjectMesh = Mesh.createFromAsset(render, \"models/arcore_github_skyline.obj\")\r\n        virtualObjectShader = Shader.createFromAssets(\r\n            render,\r\n            \"shaders/environmental_hdr.vert\",\r\n            \"shaders/environmental_hdr.frag\",\r\n            mapOf(\"NUMBER_OF_MIPMAP_LEVELS\" to cubemapFilter.numberOfMipmapLevels.toString())\r\n        ).apply {\r\n            setTexture(\"u_Cubemap\", cubemapFilter.filteredCubemapTexture)\r\n            setTexture(\"u_DfgTexture\", dfgTexture)\r\n            // ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è‰²ã‚’Uniformå¤‰æ•°ã«å…¥ã‚Œã‚‹\r\n            setVec4(\"v_ObjColor\", floatArrayOf(0.25f, 0.76f, 0.38f, 1.0f))\r\n        }\r\n    }\r\n\r\n    /** SurfaceViewã®ã‚µã‚¤ã‚ºå¤‰æ›´æ™‚ã« */\r\n    override fun onSurfaceChanged(render: SampleRender, width: Int, height: Int) {\r\n        displayRotationHelper.onSurfaceChanged(width, height)\r\n        virtualSceneFramebuffer.resize(width, height)\r\n    }\r\n\r\n    /** æ¯ãƒ•ãƒ¬ãƒ¼ãƒ å‘¼ã°ã‚Œã‚‹ï¼Ÿ */\r\n    override fun onDrawFrame(render: SampleRender) {\r\n        val session = arCoreSessionLifecycleHelper.session ?: return\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒãƒ†ã‚¯ã‚¹ãƒãƒ£\r\n        if (!isAlreadySetTexture) {\r\n            session.setCameraTextureNames(intArrayOf(backgroundRenderer.cameraColorTexture.textureId))\r\n            isAlreadySetTexture = true\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒã®ã‚µã‚¤ã‚ºã‚’åˆã‚ã›ã‚‹\r\n        displayRotationHelper.updateSessionIfNeeded(session)\r\n\r\n        // ARSession ã‹ã‚‰ç¾åœ¨ã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’å–å¾—\r\n        val frame = try {\r\n            session.update()\r\n        } catch (e: Exception) {\r\n            Log.e(TAG, \"Camera not available during onDrawFrame\", e)\r\n            return\r\n        }\r\n\r\n        val camera = frame.camera\r\n        // æ·±åº¦è¨­å®š\r\n        try {\r\n            backgroundRenderer.setUseDepthVisualization(render, false)\r\n            backgroundRenderer.setUseOcclusion(render, true)\r\n        } catch (e: IOException) {\r\n            Log.e(TAG, \"Failed to read a required asset file\", e)\r\n            return\r\n        }\r\n\r\n        // åº§æ¨™ã‚’æ›´æ–°ã™ã‚‹\r\n        backgroundRenderer.updateDisplayGeometry(frame)\r\n        val shouldGetDepthImage = true\r\n        if (camera.trackingState == TrackingState.TRACKING && shouldGetDepthImage) {\r\n            try {\r\n                val depthImage = frame.acquireDepthImage16Bits()\r\n                backgroundRenderer.updateCameraDepthTexture(depthImage)\r\n                depthImage.close()\r\n            } catch (e: NotYetAvailableException) {\r\n                // ã¾ã æ·±åº¦ãƒ‡ãƒ¼ã‚¿ãŒåˆ©ç”¨ã§ããªã„\r\n                // åˆ¥ã«ã‚¨ãƒ©ãƒ¼ã§ã¯ãªãæ­£å¸¸\r\n            }\r\n        }\r\n\r\n        // ã‚¿ãƒƒãƒ—ã•ã‚ŒãŸã‹ã€æ¯ãƒ•ãƒ¬ãƒ¼ãƒ è¦‹ã‚‹\r\n        handleTap(frame, camera)\r\n\r\n        // ARã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹\r\n        // å¹³é¢ãŒæ¤œå‡ºã•ã‚Œã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’é…ç½®ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‹ã©ã†ã‹ãªã©\r\n        when {\r\n            camera.trackingState == TrackingState.PAUSED && camera.trackingFailureReason == TrackingFailureReason.NONE -> \"å¹³é¢ã‚’æ¢ã—ã¦ã„ã¾ã™\"\r\n            camera.trackingState == TrackingState.PAUSED -> null\r\n            hasTrackingPlane(session) && wrappedAnchors.isEmpty() -> \"å¹³é¢ã‚’æ¤œå‡ºã—ã¾ã—ãŸã€‚ã‚¿ãƒƒãƒ—ã—ã¦é…ç½®ã—ã¾ã™ã€‚\"\r\n            hasTrackingPlane(session) && wrappedAnchors.isNotEmpty() -> null\r\n            else -> \"å¹³é¢ã‚’æ¢ã—ã¦ã„ã¾ã™\"\r\n        }?.also {\r\n            toastManager.show(it)\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’æç”»ã™ã‚‹\r\n        if (frame.timestamp != 0L) {\r\n            // ã‚«ãƒ¡ãƒ©ãŒã¾ã æœ€åˆã®ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’ç”Ÿæˆã—ã¦ã„ãªã„å ´åˆã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’æŠ‘åˆ¶ã—ã¾ã™ã€‚ ã“ã‚Œã¯é¿ã‘ã‚‹ãŸã‚ã§ã™\r\n            // ãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒå†åˆ©ç”¨ã•ã‚Œã‚‹å ´åˆã€ä»¥å‰ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰æ®‹ã£ã¦ã„ã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æç”»ã—ã¾ã™ã€‚\r\n            backgroundRenderer.drawBackground(render)\r\n        }\r\n        // è¿½è·¡ã—ãªã„å ´åˆã¯ã€3D ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»ã—ãªã„\r\n        if (camera.trackingState == TrackingState.PAUSED) {\r\n            return\r\n        }\r\n\r\n        // å°„å½±è¡Œåˆ—ã‚’å–å¾—ã™ã‚‹\r\n        camera.getProjectionMatrix(projectionMatrix, 0, Z_NEAR, Z_FAR)\r\n\r\n        // ã‚«ãƒ¡ãƒ©è¡Œåˆ—ã‚’å–å¾—ã—ã¦æç”».\r\n        camera.getViewMatrix(viewMatrix, 0)\r\n\r\n        // ãƒã‚¤ãƒ³ãƒˆã‚¯ãƒ©ã‚¦ãƒ‰ã®æç”»\r\n        frame.acquirePointCloud().use { pointCloud ->\r\n            if (pointCloud.timestamp > lastPointCloudTimestamp) {\r\n                pointCloudVertexBuffer.set(pointCloud.points)\r\n                lastPointCloudTimestamp = pointCloud.timestamp\r\n            }\r\n            Matrix.multiplyMM(modelViewProjectionMatrix, 0, projectionMatrix, 0, viewMatrix, 0)\r\n            pointCloudShader.setMat4(\"u_ModelViewProjection\", modelViewProjectionMatrix)\r\n            render.draw(pointCloudMesh, pointCloudShader)\r\n        }\r\n\r\n        // å¹³é¢ã‚’æç”»ã—ã¾ã™\r\n        planeRenderer.drawPlanes(render, session.getAllTrackables(Plane::class.java), camera.displayOrientedPose, projectionMatrix)\r\n\r\n        // ã‚·ã‚§ãƒ¼ãƒ€ã®ãƒ©ã‚¤ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’æ›´æ–°\r\n        updateLightEstimation(frame.lightEstimate, viewMatrix)\r\n\r\n        // ARã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»\r\n        render.clear(virtualSceneFramebuffer, 0f, 0f, 0f, 0f)\r\n        wrappedAnchors.filter { it.anchor.trackingState == TrackingState.TRACKING }.forEach { (anchor, trackable) ->\r\n            // ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ¼ã‚º\r\n            anchor.pose.toMatrix(modelMatrix, 0)\r\n            // ãƒ¢ãƒ‡ãƒ«ã€ãƒ“ãƒ¥ãƒ¼ã€æŠ•å½±è¡Œåˆ— ã‚’è¨ˆç®—\r\n            Matrix.multiplyMM(modelViewMatrix, 0, viewMatrix, 0, modelMatrix, 0)\r\n            Matrix.multiplyMM(modelViewProjectionMatrix, 0, projectionMatrix, 0, modelViewMatrix, 0)\r\n            // ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®Uniformå¤‰æ•°ã«ã‚»ãƒƒãƒˆã™ã‚‹\r\n            virtualObjectShader.setMat4(\"u_ModelView\", modelViewMatrix)\r\n            virtualObjectShader.setMat4(\"u_ModelViewProjection\", modelViewProjectionMatrix)\r\n            // æç”»\r\n            render.draw(virtualObjectMesh, virtualObjectShader, virtualSceneFramebuffer)\r\n        }\r\n\r\n        // èƒŒæ™¯ã‚’ä½¿ç”¨ã—ã¦ä»®æƒ³ã‚·ãƒ¼ãƒ³ã‚’æ§‹æˆã—ã¾ã™ã€‚\r\n        backgroundRenderer.drawVirtualScene(render, virtualSceneFramebuffer, Z_NEAR, Z_FAR)\r\n    }\r\n\r\n    /** 1ãƒ•ãƒ¬ãƒ¼ãƒ ã”ã¨ã«ã‚¿ãƒƒãƒ—ã‚’å‡¦ç†ã™ã‚‹ */\r\n    private fun handleTap(frame: Frame, camera: Camera) {\r\n        if (camera.trackingState != TrackingState.TRACKING) return\r\n        val tap = tapHelper.poll() ?: return\r\n\r\n        // ãƒ’ãƒƒãƒˆã¯æ·±ã•ã«ã‚ˆã£ã¦ã‚½ãƒ¼ãƒˆã•ã‚Œã¾ã™ã€‚å¹³é¢ä¸Šã®æœ€ã‚‚è¿‘ã„ãƒ’ãƒƒãƒˆã®ã¿\r\n        val hitResultList = frame.hitTest(tap)\r\n        val firstHitResult = hitResultList.firstOrNull { hit ->\r\n            when (val trackable = hit.trackable!!) {\r\n                is Plane -> trackable.isPoseInPolygon(hit.hitPose) && PlaneRenderer.calculateDistanceToPlane(hit.hitPose, camera.pose) > 0\r\n                is Point -> trackable.orientationMode == Point.OrientationMode.ESTIMATED_SURFACE_NORMAL\r\n                is InstantPlacementPoint -> true\r\n                // DepthPoints are only returned if Config.DepthMode is set to AUTOMATIC.\r\n                is DepthPoint -> true\r\n                else -> false\r\n            }\r\n        }\r\n\r\n        if (firstHitResult != null) {\r\n            // ã‚¢ãƒ³ã‚«ãƒ¼æ•°ã«åˆ¶é™ã‚’ã‹ã‘ã‚‹\r\n            if (wrappedAnchors.size >= 20) {\r\n                wrappedAnchors[0].anchor.detach()\r\n                wrappedAnchors.removeAt(0)\r\n            }\r\n            // è¿½è·¡ç™»éŒ²\r\n            wrappedAnchors.add(WrappedAnchor(firstHitResult.createAnchor(), firstHitResult.trackable))\r\n        }\r\n    }\r\n\r\n    /** å…‰ã‚’å‡¦ç†ã™ã‚‹ */\r\n    private fun updateLightEstimation(lightEstimate: LightEstimate, viewMatrix: FloatArray) {\r\n        if (lightEstimate.state != LightEstimate.State.VALID) {\r\n            virtualObjectShader.setBool(\"u_LightEstimateIsValid\", false)\r\n            return\r\n        }\r\n        virtualObjectShader.setBool(\"u_LightEstimateIsValid\", true)\r\n        Matrix.invertM(viewInverseMatrix, 0, viewMatrix, 0)\r\n        virtualObjectShader.setMat4(\"u_ViewInverse\", viewInverseMatrix)\r\n        updateMainLight(\r\n            lightEstimate.environmentalHdrMainLightDirection,\r\n            lightEstimate.environmentalHdrMainLightIntensity,\r\n            viewMatrix\r\n        )\r\n        cubemapFilter.update(lightEstimate.acquireEnvironmentalHdrCubeMap())\r\n    }\r\n\r\n    private fun updateMainLight(\r\n        direction: FloatArray,\r\n        intensity: FloatArray,\r\n        viewMatrix: FloatArray,\r\n    ) {\r\n        // ãƒ“ãƒ¥ãƒ¼ç©ºé–“ã«å¤‰æ›ã™ã‚‹ãŸã‚ã®æœ€çµ‚ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ 0.0 ã‚’æŒã¤ vec4 ã®æ–¹å‘ãŒå¿…è¦ã§ã™ã€‚\r\n        worldLightDirection[0] = direction[0]\r\n        worldLightDirection[1] = direction[1]\r\n        worldLightDirection[2] = direction[2]\r\n        Matrix.multiplyMV(viewLightDirection, 0, viewMatrix, 0, worldLightDirection, 0)\r\n        virtualObjectShader.setVec4(\"u_ViewLightDirection\", viewLightDirection)\r\n        virtualObjectShader.setVec3(\"u_LightIntensity\", intensity)\r\n    }\r\n\r\n    /** å¹³é¢ãŒ1ã¤ä»¥ä¸Šè¦‹ã¤ã‹ã£ã¦ã„ã‚Œã° true */\r\n    private fun hasTrackingPlane(session: Session) = session.getAllTrackables(Plane::class.java).any { it.trackingState == TrackingState.TRACKING }\r\n\r\n    /** ã‚¢ãƒ³ã‚«ãƒ¼ã¨ãƒˆãƒ©ãƒƒã‚«ãƒ–ãƒ«ã‚’ç´ã¤ã‘ã‚‹ */\r\n    private data class WrappedAnchor(\r\n        val anchor: Anchor,\r\n        val trackable: Trackable,\r\n    )\r\n\r\n    companion object {\r\n        private val TAG = ARCoreOpenGlRenderer::class.java.simpleName\r\n\r\n        private const val Z_NEAR = 0.1f\r\n        private const val Z_FAR = 100f\r\n\r\n        private const val CUBEMAP_RESOLUTION = 16\r\n        private const val CUBEMAP_NUMBER_OF_IMPORTANCE_SAMPLES = 32\r\n    }\r\n}\r\n```\r\n\r\n### environmental_hdr.frag\r\n\r\nã“ã®3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã«è‰²ã‚’ä»˜ã‘ã‚‹ã®ãŒã€`environmental_hdr.frag`ã£ã¦åå‰ã®ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã§ã™ã€‚  \r\nå°‘ã—æ‰‹ã‚’åŠ ãˆã¾ã™ã€‚\r\n\r\nä»¥ä¸‹ã®3è¡Œã‚’\r\n\r\n```glsl\r\n// The albedo and roughness/metallic textures.\r\nuniform sampler2D u_AlbedoTexture;\r\nuniform sampler2D u_RoughnessMetallicAmbientOcclusionTexture;\r\n```\r\n\r\nã“ã†ã—ã¾ã™\r\n\r\n```glsl\r\n// ã“ã“ã§3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è‰²ã‚’å®šç¾©ã—ã¦ãŠã\r\nuniform vec4 v_ObjColor;\r\n```\r\n\r\næ¬¡ã«ã“ã“ã‚’\r\n\r\n```glsl\r\n  // Skip all lighting calculations if the estimation is not valid.\r\n  if (!u_LightEstimateIsValid) {\r\n    o_FragColor = vec4(texture(u_AlbedoTexture, texCoord).rgb, 1.0);\r\n    return;\r\n  }\r\n```\r\n\r\nã“ã†ã—ã¾ã™\r\n\r\n```glsl\r\n  // Skip all lighting calculations if the estimation is not valid.\r\n  if (!u_LightEstimateIsValid) {\r\n    o_FragColor = v_ObjColor;\r\n    return;\r\n  }\r\n```\r\n\r\né–¢æ•°å‘¼ã³å‡ºã—ã‚‚ç›´ã—ã¾ã™ã€‚  \r\nä»¥ä¸‹ã®éƒ¨åˆ†ã‚’\r\n\r\n```glsl\r\n  MaterialParameters material;\r\n  Pbr_CreateMaterialParameters(texCoord, u_AlbedoTexture,\r\n                               u_RoughnessMetallicAmbientOcclusionTexture,\r\n                               u_DfgTexture, shading, material);\r\n```\r\n\r\nã“ã†ã—ã¾ã™\r\n\r\n```glsl\r\n  MaterialParameters material;\r\n  Pbr_CreateMaterialParameters(texCoord, u_DfgTexture, shading, material);\r\n```\r\n\r\n`Pbr_CreateMaterialParameters`é–¢æ•°ã‹ã‚‰å¼•æ•°ã‚’æ¶ˆã—ã¦ç›´ã—ã¾ã™ã€‚\r\n\r\n```glsl\r\nvoid Pbr_CreateMaterialParameters(const in vec2 texCoord,\r\n                                  const in sampler2D albedoTexture,\r\n                                  const in sampler2D pbrTexture,\r\n                                  const in sampler2D dfgTexture,\r\n                                  const in ShadingParameters shading,\r\n                                  out MaterialParameters material) {\r\n  // Read the material parameters from the textures\r\n  vec3 albedo = texture(albedoTexture, texCoord).rgb;\r\n  vec3 roughnessMetallicAmbientOcclusion = texture(pbrTexture, texCoord).rgb;\r\n```\r\n\r\n```glsl\r\nvoid Pbr_CreateMaterialParameters(const in vec2 texCoord,\r\n                                  const in sampler2D dfgTexture,\r\n                                  const in ShadingParameters shading,\r\n                                  out MaterialParameters material) {\r\n  // Read the material parameters from the textures\r\n  vec3 albedo = v_ObjColor.rgb;\r\n  vec3 roughnessMetallicAmbientOcclusion = v_ObjColor.rgb;\r\n```\r\n\r\n### ä½•ã—ã¦ãŸã®ï¼Ÿ\r\nå…¬å¼ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ç”»åƒã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ãªå®Ÿè£…ã§ã—ãŸã€‚  \r\nä»Šå›ã¯ãƒ†ã‚¯ã‚¹ãƒãƒ£ç”»åƒç„¡ã—ã§ã€å˜è‰²ã§å¡—ã‚Šã¤ã¶ã™ã‚ˆã†ã«ã™ã‚‹ãŸã‚ä¸Šè¨˜ã®ä¿®æ­£ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸã€‚\r\n\r\n### environmental_hdr.frag å…¨ä½“\r\n\r\nã»ã¨ã‚“ã©å¤‰ãˆã¦ã¾ã›ã‚“ãŒ\r\n\r\n```glsl\r\n#version 300 es\r\n/*\r\n * Copyright 2020 Google LLC\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\r\nprecision mediump float;\r\n\r\n// This shader will light scenes based on ARCore's Environmental HDR mode with a\r\n// physically based rendering model.\r\n//\r\n// When using the HDR Cubemap from ARCore for specular reflections, please note\r\n// that the following equation is true of ARCore's Environmental HDR lighting\r\n// estimation, where E(x) is irradiance of x.\r\n//\r\n// E(spherical harmonics) + E(main light) == E(cubemap)\r\n//\r\n// In order to not duplicate the specular lighting contribution of the main\r\n// light, we must use the following equation, where Lo is total reflected\r\n// radiance (i.e. linear color output), Ld(x) is the reflected diffuse radiance\r\n// of x, and Ls(x) is reflected specular radiance of x.\r\n//\r\n// Lo = Ld(spherical harmonics) + Ld(main light) + Ls(cubemap)\r\n//\r\n// The Filament documentation has excellent documentation on the subject of\r\n// image based lighting:\r\n// https://google.github.io/filament/Filament.md.html#lighting/imagebasedlights\r\n//\r\n// If you would rather not use the HDR cubemap in your application, you would\r\n// need to adjust the lighting calculations to reflect the following equation\r\n// instead.\r\n//\r\n// Lo = Ld(spherical harmonics) + Ld(main light) + Ls(main light)\r\n//\r\n// See the definitions of Pbr_CalculateMainLightRadiance and\r\n// Pbr_CalculateEnvironmentalRadiance.\r\n\r\n// Number of mipmap levels in the filtered cubemap.\r\nconst int kNumberOfRoughnessLevels = NUMBER_OF_MIPMAP_LEVELS;\r\n\r\n// ã“ã“ã§3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®è‰²ã‚’å®šç¾©ã—ã¦ãŠã\r\nuniform vec4 v_ObjColor;\r\n\r\n// The intensity of the main directional light.\r\nuniform vec3 u_LightIntensity;\r\n\r\n// The direction of the main directional light in view space.\r\nuniform vec4 u_ViewLightDirection;\r\n\r\n// The coefficients for the spherical harmonic function which models the diffuse\r\n// irradiance of a distant environmental light for a given surface normal in\r\n// world space. These coefficients must be premultiplied with their\r\n// corresponding spherical harmonics constants. See\r\n// HelloArActivity.updateSphericalHarmonicsCoefficients for more information.\r\nuniform vec3 u_SphericalHarmonicsCoefficients[9];\r\n\r\n// The filtered cubemap texture which models the LD term (i.e. radiance (L)\r\n// times distribution function (D)) of the environmental specular calculation as\r\n// a function of direction and roughness.\r\nuniform samplerCube u_Cubemap;\r\n\r\n// The DFG lookup texture which models the DFG1 and DFG2 terms of the\r\n// environmental specular calculation as a function of normal dot view and\r\n// perceptual roughness.\r\nuniform sampler2D u_DfgTexture;\r\n\r\n// Inverse view matrix. Used for converting normals back into world space for\r\n// environmental radiance calculations.\r\nuniform mat4 u_ViewInverse;\r\n\r\n// If the current light estimate is valid. Used to short circuit the entire\r\n// shader when the light estimate is not valid.\r\nuniform bool u_LightEstimateIsValid;\r\n\r\nstruct MaterialParameters {\r\n  vec3 diffuse;\r\n  float perceptualRoughness;  // perceptually linear roughness\r\n  float roughness;            // non-perceptually linear roughness\r\n  float metallic;\r\n  float ambientOcclusion;\r\n  vec3 f0;                  // reflectance\r\n  vec2 dfg;                 // DFG1 and DFG2 terms\r\n  vec3 energyCompensation;  // energy preservation for multiscattering\r\n};\r\n\r\nstruct ShadingParameters {\r\n  // Halfway here refers to halfway between the view and light directions.\r\n  float normalDotView;\r\n  float normalDotHalfway;\r\n  float normalDotLight;\r\n  float viewDotHalfway;\r\n  float oneMinusNormalDotHalfwaySquared;\r\n\r\n  // These unit vectors are in world space and are used for the environmental\r\n  // lighting math.\r\n  vec3 worldNormalDirection;\r\n  vec3 worldReflectDirection;\r\n};\r\n\r\nin vec3 v_ViewPosition;\r\nin vec3 v_ViewNormal;\r\nin vec2 v_TexCoord;\r\n\r\nlayout(location = 0) out vec4 o_FragColor;\r\n\r\nconst float kPi = 3.14159265359;\r\n\r\nvec3 Pbr_CalculateMainLightRadiance(const ShadingParameters shading,\r\n                                    const MaterialParameters material,\r\n                                    const vec3 mainLightIntensity) {\r\n  // Lambertian diffuse\r\n  vec3 diffuseTerm = material.diffuse / kPi;\r\n\r\n  // Note that if we were not using the HDR cubemap from ARCore for specular\r\n  // lighting, we would be adding a specular contribution from the main light\r\n  // here. See the top of the file for a more detailed explanation.\r\n\r\n  return diffuseTerm * mainLightIntensity * shading.normalDotLight;\r\n}\r\n\r\nvec3 Pbr_CalculateDiffuseEnvironmentalRadiance(const vec3 normal,\r\n                                               const vec3 coefficients[9]) {\r\n  // See HelloArActivity.updateSphericalHarmonicsCoefficients() for more\r\n  // information about this calculation.\r\n  vec3 radiance = coefficients[0] + coefficients[1] * (normal.y) +\r\n                  coefficients[2] * (normal.z) + coefficients[3] * (normal.x) +\r\n                  coefficients[4] * (normal.y * normal.x) +\r\n                  coefficients[5] * (normal.y * normal.z) +\r\n                  coefficients[6] * (3.0 * normal.z * normal.z - 1.0) +\r\n                  coefficients[7] * (normal.z * normal.x) +\r\n                  coefficients[8] * (normal.x * normal.x - normal.y * normal.y);\r\n  return max(radiance, 0.0);\r\n}\r\n\r\nvec3 Pbr_CalculateSpecularEnvironmentalRadiance(\r\n    const ShadingParameters shading, const MaterialParameters material,\r\n    const samplerCube cubemap) {\r\n  // Lagarde and de Rousiers 2014, \"Moving Frostbite to PBR\"\r\n  float specularAO =\r\n      clamp(pow(shading.normalDotView + material.ambientOcclusion,\r\n                exp2(-16.0 * material.roughness - 1.0)) -\r\n                1.0 + material.ambientOcclusion,\r\n            0.0, 1.0);\r\n  // Combine DFG and LD terms\r\n  float lod =\r\n      material.perceptualRoughness * float(kNumberOfRoughnessLevels - 1);\r\n  vec3 LD = textureLod(cubemap, shading.worldReflectDirection, lod).rgb;\r\n  vec3 E = mix(material.dfg.xxx, material.dfg.yyy, material.f0);\r\n  return E * LD * specularAO * material.energyCompensation;\r\n}\r\n\r\nvec3 Pbr_CalculateEnvironmentalRadiance(\r\n    const ShadingParameters shading, const MaterialParameters material,\r\n    const vec3 sphericalHarmonicsCoefficients[9], const samplerCube cubemap) {\r\n  // The lambertian diffuse BRDF term (1/pi) is baked into\r\n  // HelloArActivity.sphericalHarmonicsFactors.\r\n  vec3 diffuseTerm =\r\n      Pbr_CalculateDiffuseEnvironmentalRadiance(\r\n          shading.worldNormalDirection, sphericalHarmonicsCoefficients) *\r\n      material.diffuse * material.ambientOcclusion;\r\n\r\n  vec3 specularTerm =\r\n      Pbr_CalculateSpecularEnvironmentalRadiance(shading, material, cubemap);\r\n\r\n  return diffuseTerm + specularTerm;\r\n}\r\n\r\nvoid Pbr_CreateShadingParameters(const in vec3 viewNormal,\r\n                                 const in vec3 viewPosition,\r\n                                 const in vec4 viewLightDirection,\r\n                                 const in mat4 viewInverse,\r\n                                 out ShadingParameters shading) {\r\n  vec3 normalDirection = normalize(viewNormal);\r\n  vec3 viewDirection = -normalize(viewPosition);\r\n  vec3 lightDirection = normalize(viewLightDirection.xyz);\r\n  vec3 halfwayDirection = normalize(viewDirection + lightDirection);\r\n\r\n  // Clamping the minimum bound yields better results with values less than or\r\n  // equal to 0, which would otherwise cause discontinuity in the geometry\r\n  // factor. Neubelt and Pettineo 2013, \"Crafting a Next-gen Material Pipeline\r\n  // for The Order: 1886\"\r\n  shading.normalDotView = max(dot(normalDirection, viewDirection), 1e-4);\r\n  shading.normalDotHalfway =\r\n      clamp(dot(normalDirection, halfwayDirection), 0.0, 1.0);\r\n  shading.normalDotLight =\r\n      clamp(dot(normalDirection, lightDirection), 0.0, 1.0);\r\n  shading.viewDotHalfway =\r\n      clamp(dot(viewDirection, halfwayDirection), 0.0, 1.0);\r\n\r\n  // The following calculation can be proven as being equivalent to 1-(N.H)^2 by\r\n  // using Lagrange's identity.\r\n  //\r\n  // ||a x b||^2 = ||a||^2 ||b||^2 - (a . b)^2\r\n  //\r\n  // Since we're using unit vectors: ||N x H||^2 = 1 - (N . H)^2\r\n  //\r\n  // We are calculating it in this way to preserve floating point precision.\r\n  vec3 NxH = cross(normalDirection, halfwayDirection);\r\n  shading.oneMinusNormalDotHalfwaySquared = dot(NxH, NxH);\r\n\r\n  shading.worldNormalDirection = (viewInverse * vec4(normalDirection, 0.0)).xyz;\r\n  vec3 reflectDirection = reflect(-viewDirection, normalDirection);\r\n  shading.worldReflectDirection =\r\n      (viewInverse * vec4(reflectDirection, 0.0)).xyz;\r\n}\r\n\r\nvoid Pbr_CreateMaterialParameters(const in vec2 texCoord,\r\n                                  const in sampler2D dfgTexture,\r\n                                  const in ShadingParameters shading,\r\n                                  out MaterialParameters material) {\r\n  // Read the material parameters from the textures\r\n  vec3 albedo = v_ObjColor.rgb;\r\n  vec3 roughnessMetallicAmbientOcclusion = v_ObjColor.rgb;\r\n  // Roughness inputs are perceptually linear; convert them to regular roughness\r\n  // values. Roughness levels approaching 0 will make specular reflections\r\n  // completely invisible, so cap the lower bound. This value was chosen such\r\n  // that (kMinPerceptualRoughness^4) > 0 in fp16 (i.e. 2^(-14/4), rounded up).\r\n  // https://github.com/google/filament/blob/main/shaders/src/common_material.fs#L2\r\n  const float kMinPerceptualRoughness = 0.089;\r\n  material.perceptualRoughness =\r\n      max(roughnessMetallicAmbientOcclusion.r, kMinPerceptualRoughness);\r\n  material.roughness =\r\n      material.perceptualRoughness * material.perceptualRoughness;\r\n  material.metallic = roughnessMetallicAmbientOcclusion.g;\r\n  material.ambientOcclusion = roughnessMetallicAmbientOcclusion.b;\r\n\r\n  material.diffuse = albedo * (1.0 - material.metallic);\r\n  // F0 is defined as \"Fresnel reflectance at 0 degrees\", i.e. specular\r\n  // reflectance when light is grazing a surface perfectly perpendicularly. This\r\n  // value is derived from the index of refraction for a material. Most\r\n  // dielectric materials have an F0 value of 0.00-0.08, which leaves 0.04 as a\r\n  // reasonable constant for a simple roughness/metallic material workflow as\r\n  // implemented by this shader.\r\n  material.f0 = mix(vec3(0.04), albedo, material.metallic);\r\n\r\n  // The DFG texture is a simple lookup table indexed by [normal dot view,\r\n  // perceptualRoughness].\r\n  material.dfg =\r\n      textureLod(dfgTexture,\r\n                 vec2(shading.normalDotView, material.perceptualRoughness), 0.0)\r\n          .xy;\r\n\r\n  // Energy preservation for multiscattering (see\r\n  // https://google.github.io/filament/Filament.md.html#materialsystem/improvingthebrdfs)\r\n  material.energyCompensation =\r\n      1.0 + material.f0 * (1.0 / material.dfg.y - 1.0);\r\n}\r\n\r\nvec3 LinearToSrgb(const vec3 color) {\r\n  vec3 kGamma = vec3(1.0 / 2.2);\r\n  return clamp(pow(color, kGamma), 0.0, 1.0);\r\n}\r\n\r\nvoid main() {\r\n  // Mirror texture coordinates over the X axis\r\n  vec2 texCoord = vec2(v_TexCoord.x, 1.0 - v_TexCoord.y);\r\n\r\n  // Skip all lighting calculations if the estimation is not valid.\r\n  if (!u_LightEstimateIsValid) {\r\n    o_FragColor = v_ObjColor;\r\n    return;\r\n  }\r\n\r\n  ShadingParameters shading;\r\n  Pbr_CreateShadingParameters(v_ViewNormal, v_ViewPosition,\r\n                              u_ViewLightDirection, u_ViewInverse, shading);\r\n\r\n  MaterialParameters material;\r\n  Pbr_CreateMaterialParameters(texCoord, u_DfgTexture, shading, material);\r\n\r\n  // Combine the radiance contributions of both the main light and environment\r\n  vec3 mainLightRadiance =\r\n      Pbr_CalculateMainLightRadiance(shading, material, u_LightIntensity);\r\n\r\n  vec3 environmentalRadiance = Pbr_CalculateEnvironmentalRadiance(\r\n      shading, material, u_SphericalHarmonicsCoefficients, u_Cubemap);\r\n\r\n  vec3 radiance = mainLightRadiance + environmentalRadiance;\r\n\r\n  // Convert final color to sRGB color space\r\n  o_FragColor = vec4(LinearToSrgb(radiance), 1.0);\r\n}\r\n```\r\n\r\n# å®Œæˆå“\r\nã‚¹ã‚¯ã‚·ãƒ§ä¸‹æ‰‹ããé¸æ‰‹æ¨©\r\n\r\n![Imgur](https://imgur.com/R15xfnf.png)\r\n\r\n## ã–ã£ãã‚Š OpenGL\r\nãã‚Œãã‚Œã®é–¢æ•°ãŒãªã‚“ã‹`Win32 API`ã¿ãŸã„ã§ãªã‚“ã‹æ…£ã‚Œãªã„ (-1ã‚’è¿”ã—ãŸã‚‰å¤±æ•—ã¨ã‹)\r\n\r\n### ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ / ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€\r\nãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ã£ã¦ã®ã¯é ‚ç‚¹ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‚„ã¤ã‚‰ã—ã„ã€‚  \r\nãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã¯ãã‚Œã«è‰²ã‚’ä»˜ã‘ã¦ã„ãã€‚\r\n\r\n### Uniform\r\n`Uniform`ã‚’ä½¿ã†ã¨ã€`CPU`ã‹ã‚‰`GPU`ã¸å€¤ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆä»Šå›ã§ã¯`Kotlin`ã‹ã‚‰`OpenGL`ã¸å€¤ã‚’æ¸¡ã™ã“ã¨ãŒã§ãã‚‹ï¼‰\r\n\r\n```kotlin\r\nval glslProgram = GLES20.glCreateProgram()\r\n\r\n// çœç•¥\r\n\r\n// ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã® vColorå¤‰æ•° ã¸å€¤ã‚’ã‚»ãƒƒãƒˆã™ã‚‹\r\nGLES20.glGetUniformLocation(program, \"vColor\").also { color ->\r\n    // è‰²ã‚’OpenGL (GPU) ã¸æ¸¡ã™\r\n    GLES20.glUniform4fv(color, 1, floatArrayOf(1.0f, 0.0f, 0.0f, 1.0f), 0)\r\n}\r\n```\r\n\r\n```glsl\r\nprecision mediump float;\r\n\r\n// uniform ã‚’ã¤ã‘ã‚‹ã¨å–å¾—ã§ãã‚‹\r\nuniform vec4 vColor;\r\n\r\nvoid main() {\r\n    gl_FragColor = vColor;\r\n}\r\n```\r\n\r\n### o_FragColor\r\nã“ã“ã« `vec4 å‹` ã§è‰²ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã§åæ˜ ã•ã‚Œã¾ã™ã€‚  \r\nã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°\r\n\r\n### vec4\r\nè‰²ã®æŒ‡å®šã¨ã‹ã§ä½¿ã†ã€‚  \r\nè‰²ã®å ´åˆã¯ 0f ã‹ã‚‰ 1f ã¾ã§ã® RGBA ã ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n# æ›¸ãæ›ãˆã¦éŠã¶\r\n\r\nä¾‹ãˆã°ã€é ‚ç‚¹ã®ã¤ãªãæ–¹ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§å¡—ã‚Šã¤ã¶ã•ãªã„ã€‚ãªã‚“ã‹ã‚‚å‡ºæ¥ã¾ã™ã€‚\r\n\r\n`Mesh.java`\r\n\r\n```java\r\nVertexBuffer[] vertexBuffers = {\r\n  new VertexBuffer(render, 3, localCoordinates),\r\n  new VertexBuffer(render, 2, textureCoordinates),\r\n  new VertexBuffer(render, 3, normals),\r\n};\r\n\r\nIndexBuffer indexBuffer = new IndexBuffer(render, vertexIndices);\r\n\r\n// LINE_STRIP ã«ã™ã‚‹ã€‚ã“ã‚Œã¯å¡—ã‚Šã¤ã¶ã•ãªã„\r\nreturn new Mesh(render, PrimitiveMode.LINE_STRIP, indexBuffer, vertexBuffers);\r\n```\r\n\r\n```java\r\n// ã“ã‚Œã‚’è¶³ã™\r\nGLES30.glLineWidth(5f);\r\n\r\nGLES30.glDrawArrays(primitiveMode.glesEnum, 0, numberOfVertices);\r\nGLError.maybeThrowGLException(\"Failed to draw vertex array object\", \"glDrawArrays\");\r\n```\r\n\r\n![Imgur](https://imgur.com/jIQrGQL.png)\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nå¤šåˆ†å‹•ãã€‚ã‚³ãƒŸãƒƒãƒˆä¸€å¿œåˆ†ã‘ã¦ãŠãã¾ã—ãŸã€‚\r\n\r\nhttps://github.com/takusan23/ARCoreGitHubSkyline\r\n\r\nã¨ã‚Šã‚ãˆãš`APK`æ¬²ã—ã„å ´åˆã¯`GitHub Releases`ã«ãŠã„ã¦ãŠãã¾ã—ãŸã€‚\r\n\r\nhttps://github.com/takusan23/ARCoreGitHubSkyline/releases/tag/1.0.0\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\nè¿‘ãã§è¦‹ã‚‹ã¨ã¡ã‚ƒã‚“ã¨å‡¸å‡¹ã—ã¦ã‚‹\r\n\r\n![Imgur](https://imgur.com/JGt9BvS.png)\r\n\r\n## Depth API\r\nå†™çœŸä¸‹æ‰‹ããã§ã™ãŒã¡ã‚ƒã‚“ã¨ç‰©ã‚’æ¤œçŸ¥ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¾ã™ã€‚  \r\nï¼ˆæœºã®ä¸‹ã«ç½®ã„ãŸã‚‰ã¡ã‚ƒã¨æœºã®ä¸‹ã¾ã§æ½œã‚‰ãªã„ã¨æç”»ã•ã‚Œãªã„ï¼‰\r\n\r\n## OpenGLè¦ç´ ãˆã‡\r\nã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã™ã‚‰ãƒ‘ã‚¯ã£ã¦ããŸã®ã§ã»ã¼`Kotlin`ã—ã‹æ›¸ã„ã¦ãªã„ã§ã™ã€‚  \r\nã‚‚ã—ã‹ã—ãŸã‚‰ `Unity` ã¨ã‹ã®ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ã‚¸ãƒ³ãŒã‚ã‹ã‚‹äººã®ã»ã†ãŒä½¿ã„ã“ãªã›ãã†ï¼\r\n\r\n## ãƒ‡ãƒãƒƒã‚°ã—ã‚“ã©ããªã„ï¼Ÿ\r\n`ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼`ã€ã“ã‚Œã‚³ãƒ³ãƒ‘ã‚¤ãƒ«(`GLES30.glCompileShader`)ã®éš›ã«ä½¿ã‚ã‚Œãªã„å¤‰æ•°ã‚’æ¶ˆã™ã®ã§ã™ãŒã€ã“ã‚Œã®ã›ã„ã§å®Ÿè¡Œæ™‚ã«`Uniform`å¤‰æ•°ãŒç„¡ã„ã‚ˆï¼ã£ã¦è¨€ã‚ã‚Œã¦ã—ã¾ã†ã‚“ã§ã™ã‚ˆã­ã€‚  \r\nã‚ã¨`printf`ã¿ãŸã„ãªã®ã‚‚(å¤šåˆ†)ãªã„(GPUã§å‹•ã„ã¦ã‚‹ã®ã§...)ã®ã§ã¾ã˜ã§å¤§å¤‰ãã†ã€‚  \r\n\r\nä¸€å¿œ`GLSLã§æ›¸ã‹ã‚ŒãŸã‚·ã‚§ãƒ¼ãƒ€ãƒ¼`ã‚’`minify (æœ€é©åŒ–)`ã™ã‚‹ãƒ„ãƒ¼ãƒ«ãŒã‚ã‚‹ã¿ãŸã„ãªã®ã§ã€ã©ã®å¤‰æ•°ãŒè¦ã‚‰ãªããªã‚‹ã‹ã¨ã‹ã‚’ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«å‰ã«è¦‹ã‚‹ã“ã¨ã¯ã§ãã‚‹ã®ã‹ãª...ï¼Ÿ\r\n\r\n# ãŠã‚ã‚Šã«2\r\n\r\nãã†ã„ãˆã°ã€ä»Šç„¡ã ã¨ã‚‰ã®ã‚ãªç§‹è‘‰åŸåº—A ã§ã‚„ã£ã¦ãŸã“ã‚Œã€è¡Œã£ã¦ãã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/xQWMb7r.png)\r\n\r\n![Imgur](https://imgur.com/3ALfT8A.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸ ï¾‰ï½¼ 888\r\n\r\n# è¿½è¨˜ 2023/05/05\r\nå›è»¢ã—ãªã„ã§ã»ã—ã„å ´åˆã¯ã€`ARCoreOpenGlRenderer.kt`ã¸ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æãã¨è‰¯ã„ã§ã™ã€‚  \r\n`Pose#extractTranslation`ã§å›è»¢ã‚’è€ƒæ…®ã—ãªã„è¡Œåˆ—ã‚’ä½œã£ã¦ãã‚Œã¾ã™ã€‚\r\n\r\n```diff\r\n         // ARã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æç”»\r\n         render.clear(virtualSceneFramebuffer, 0f, 0f, 0f, 0f)\r\n         wrappedAnchors.filter { it.anchor.trackingState == TrackingState.TRACKING }.forEach { (anchor, trackable) ->\r\n-            // ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ¼ã‚º\r\n-            anchor.pose.toMatrix(modelMatrix, 0)\r\n+            // æç”»ã®ãŸã‚ã®è¡Œåˆ—ã‚’ç”¨æ„ã™ã‚‹\r\n+            // TODO extractTranslation ã‚’å‘¼ã¶ã¨ã€å›è»¢ï¼ˆaxisï¼‰ã‚’é™¤ã„ãŸè¡Œåˆ—ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã€‚å‘¼ã°ãšã« Post#toMatrix ã™ã‚‹ã¨ã€å›è»¢ã‚‚è€ƒæ…®ã•ã‚Œã‚‹\r\n+            // anchor.pose.toMatrix(modelMatrix, 0)\r\n+            anchor.pose.extractTranslation().toMatrix(modelMatrix, 0)\r\n             // ãƒ¢ãƒ‡ãƒ«ã€ãƒ“ãƒ¥ãƒ¼ã€æŠ•å½±è¡Œåˆ— ã‚’è¨ˆç®—\r\n             Matrix.multiplyMM(modelViewMatrix, 0, viewMatrix, 0, modelMatrix, 0)\r\n             Matrix.multiplyMM(modelViewProjectionMatrix, 0, projectionMatrix, 0, modelViewMatrix, 0)\t\r\n```"},{"title":"éŠ€è¡Œç³»ã‚¢ãƒ—ãƒªã«ã‚ã‚‹USBãƒ‡ãƒãƒƒã‚°æœ‰åŠ¹æ™‚ã«èµ·å‹•ã—ãªã„å•é¡Œã«çµ‚æ­¢ç¬¦ã‚’æ‰“ã¤","link":"/posts/android_auto_disable_adb/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \nAndroid 12ã€ãã‚ãã‚æ­£å¼ãƒªãƒªãƒ¼ã‚¹ã ã¨æ€ã†ã‚“ã§ã™ã‘ã© ã¾ãƒ¼ã æ™‚é–“ã‹ã‹ã‚Šãã†ã§ã™ã‹ã­ãƒ¼\n\n# æœ¬é¡Œ\n![Imgur](https://imgur.com/qRAmIBt.png)\n\n`rootã‚¢ã‚¯ã‚»ã‚¹`ãŒã‚ã‚‹ã¨ã‹ã€`ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ãŒã‚¢ãƒ³ãƒ­ãƒƒã‚¯`ã•ã‚Œã¦ã„ã‚‹ã¨ã‹ãªã‚‰ã‚ã‹ã‚‹ã‚“ã ã‘ã©ã€  \nãªã‚“ã§`USBãƒ‡ãƒãƒƒã‚°`ã¤ã„ã¦ã‚‹ã¨ã ã‚ãªã‚“ã‚„ï¼ˆ**å¤šåˆ†adbçµŒç”±ã§ç”»é¢éŒ²ç”»ã¨ã‹ãŒã§ãã‚‹ã®ã§ãã‚Œã®ã›ã„**ï¼‰\n\n## ä¸€æ™‚çš„ã«ã‚ªãƒ•ã«ã™ã‚Œã°ã„ã„ã˜ã‚ƒã‚“\nUSBãƒ‡ãƒãƒƒã‚°ã‚’OFFã«ã™ã‚‹ã®ã£ã¦çµæ§‹ã‚ã‚“ã©ã„ã‚“ã ã‚ˆã­ã€‚  \nã—ã‹ã‚‚ONã«ã™ã‚‹ã®å¿˜ã‚Œã¦ã‚‹ã¨ã‹ã€‚ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã£ã¦USBãƒ‡ãƒãƒƒã‚°ã‚’æœ‰åŠ¹ã€ç„¡åŠ¹ã«ã™ã‚‹ã‚¢ãƒ—ãƒªã¨ã‹ã‚¯ã‚¤ãƒƒã‚¯è¨­å®šã‹ã‚‰å¤‰æ›´ã§ãã‚‹ã‚ˆã†ã«ã—ã¦ã‚‚è‰¯ã‹ã£ãŸã‘ã©ãªã‚“ã‹ãªãã€‚\n\n# ã ã‹ã‚‰ä½œã£ãŸ\n(600KBã®GIFã§ã™ã®ã§ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æ–¹ã”ã‚ã‚“ã­)\n\n![Imgur](https://imgur.com/63c7UZt.gif)\n\nçœŸã£æš—ã®ç”»é¢ã«ãªã£ã¦ã‚‹ã®ã¯ã€éŠ€è¡Œç³»ã‚¢ãƒ—ãƒªãŒç”»é¢éŒ²ç”»ã¨ã‹ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’ç¦æ­¢ã—ã¦ã„ã‚‹ã›ã„ã§ã™ã€‚  \nUSBãƒ‡ãƒãƒƒã‚°ã‚’OFFã«ã—ã‚ã£ã¦ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒå‡ºã¦ãªã„ã®ã§ãã‚ŒãŒè¨¼æ‹ ã«ãªã‚‹ã‹ã¨ã€‚\n\n# ä»•çµ„ã¿\n\nUSBãƒ‡ãƒãƒƒã‚°ã‚’OFFã«ã™ã‚‹  \nâ†“  \nUSBãƒ‡ãƒãƒƒã‚°ã‚’ONã«ã—ã¦ã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚’IntentçµŒç”±ã§èµ·å‹•   \nâ†“  \nã‚¢ãƒ—ãƒªãŒçµ‚äº†(`Activity Result API (onActivityResult)` / `onDestroy`)ã—ãŸã‚‰USBãƒ‡ãƒãƒƒã‚°ã‚’ONã«æˆ»ã™ã€‚\n\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\n\n```kotlin\n/**\n * pm grant io.github.takusan23.usbdebugautohide android.permission.WRITE_SECURE_SETTINGS\n * */\nclass MainActivity : AppCompatActivity() {\n\n\n    private val PACKAGE_NAME = \"jp.co.smbc.direct\"\n    private val activityCloseCallback = registerForActivityResult(ActivityClose()) {\n        // ã‚¢ãƒ—ãƒªçµ‚äº†æ™‚ã«USBãƒ‡ãƒãƒƒã‚°ã‚’ONã«æˆ»ã™\n        Settings.Global.putLong(contentResolver, Settings.Global.ADB_ENABLED, 1)\n        // ãƒãƒƒã‚¯ã‚­ãƒ¼ã§æˆ»ã£ã¦ããŸã‚‰ã“ã“ã«æ¥ã‚‹ã€‚ã‚¢ãƒ—ãƒªé–‰ã˜ã‚‹\n        finishAndRemoveTask()\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        // SMBCèµ·å‹•å‰ã«USBãƒ‡ãƒãƒƒã‚°ã‚’OFF\n        Settings.Global.putLong(contentResolver, Settings.Global.ADB_ENABLED, 0)\n\n        // USBãƒ‡ãƒãƒƒã‚°ã‚’ç„¡åŠ¹ã«ã—ãªã„ã¨ã„ã‘ãªã„ã‚¢ãƒ—ãƒªã‚’èµ·å‹•\n        val launchIntent = packageManager.getLaunchIntentForPackage(PACKAGE_NAME)\n        launchIntent?.flags = 0 // å‹æ‰‹ã« Intent.FLAG_ACTIVITY_NEW_TASK ã‚’æŒ‡å®šã™ã‚‹ã®ã§æ¶ˆã™\n        activityCloseCallback.launch(launchIntent)\n\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            startForegroundService(Intent(this, USBDebugAutoOnService::class.java))\n        } else {\n            startService(Intent(this, USBDebugAutoOnService::class.java))\n        }\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        stopService(Intent(this, USBDebugAutoOnService::class.java))\n    }\n\n}\n\nclass USBDebugAutoOnService : Service() {\n\n    override fun onStartCommand(intent: Intent?, flags: Int, startId: Int): Int {\n\n        val notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n        val channelId = \"usbdebug_auto_on\"\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            notificationManager.createNotificationChannel(NotificationChannel(channelId, \"USBãƒ‡ãƒãƒƒã‚¯ã‚’æˆ»ã™ã‚µãƒ¼ãƒ“ã‚¹\", NotificationManager.IMPORTANCE_LOW))\n        }\n        val notification = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            Notification.Builder(this, channelId)\n        } else {\n            Notification.Builder(this)\n        }.apply {\n            setContentText(\"USBãƒ‡ãƒãƒƒã‚¯ã‚’æˆ»ã™ã‚µãƒ¼ãƒ“ã‚¹\")\n            setContentTitle(\"ã‚¢ãƒ—ãƒªãŒçµ‚äº†ã—ãŸã‚‰USBãƒ‡ãƒãƒƒã‚°ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™\")\n            setSmallIcon(R.drawable.ic_launcher_background).build()\n        }.build()\n\n        startForeground(1, notification)\n        return START_NOT_STICKY\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        println(\"ã‚¢ãƒ—ãƒªçµ‚äº†\")\n        Settings.Global.putLong(contentResolver, Settings.Global.ADB_ENABLED, 1)\n    }\n\n    override fun onBind(p0: Intent?): IBinder? {\n        return null;\n    }\n\n}\n\nclass ActivityClose : ActivityResultContract<Intent, Unit>() {\n    override fun createIntent(context: Context, input: Intent): Intent {\n        // launch()ã®IntentãŒinput\n        return input\n    }\n\n    override fun parseResult(resultCode: Int, intent: Intent?) {\n        // ã¨ãã«ãªã—\n    }\n}\n```\n\nä½¿ã†æ¨©é™ã¯ä»¥ä¸‹ã®ï¼’ã¤ã§ã™ã€‚\n\n```xml\n<uses-permission android:name=\"android.permission.WRITE_SECURE_SETTINGS\" />\n<uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n```\n\n# USBãƒ‡ãƒãƒƒã‚°ã‚’ã‚¢ãƒ—ãƒªã‹ã‚‰æœ‰åŠ¹ã€ç„¡åŠ¹ã«ã™ã‚‹\nã«ã¯ã€`WRITE_SECURE_SETTINGS`ãŒå¿…è¦ãªã®ã§ã™ãŒã€ã“ã‚Œã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒªã«ã¯é–‹æ”¾ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚  \nã—ã‹ã—ä½•æ•…ã‹`pm grant <ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å> android.permission.WRITE_SECURE_SETTINGS`ã‚’å®Ÿè¡Œã™ã‚‹ã¨æ¨©é™ã‚’ä»˜ä¸ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚YATTA YATTA\n\næ¨©é™ãŒã‚²ãƒƒãƒˆã§ãã‚Œã°ã“ã£ã¡ã®ã‚‚ã‚“ã§ã™ã€‚\n\n```kotlin\n// USBãƒ‡ãƒãƒƒã‚°ã‚’ON\nSettings.Global.putLong(contentResolver, Settings.Global.ADB_ENABLED, 1)\n\n// USBãƒ‡ãƒãƒƒã‚°ã‚’OFF\nSettings.Global.putLong(contentResolver, Settings.Global.ADB_ENABLED, 0)\n```\n\n# ã‚¢ãƒ—ãƒªã®çµ‚äº†æ¤œçŸ¥\nãƒãƒƒã‚¯ã‚­ãƒ¼ã§æˆ»ã£ã¦ããŸã¨ãã®ãŸã‚ã«ã€`Activity Result API (onActivityResult)`ã§ã‚’ä½¿ã„ã¾ã™ã€‚  \n\nãã‚Œã¨ã¯åˆ¥ã«ã€ã‚¢ãƒ—ãƒªå±¥æ­´ç”»é¢ã‹ã‚‰çµ‚äº†ã—ãŸéš›ã®ãŸã‚ã«`onDestroy`ã‚‚ä½¿ã„ã¾ã™ã€‚  \n\n## ã˜ã‚ƒã‚ãªã‚“ã§ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã—ã¦ã‚‹ã®ï¼Ÿ\n`startForegroundService`ã§ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã—ã¦ã‚‹ã‚ã‘ã§ã™ãŒã€ãã®ç†ç”±ã¯`onDestory`ã§`USBãƒ‡ãƒãƒƒã‚°ã‚’ON`ã«æˆ»ã›ãªã‹ã£ãŸã‹ã‚‰ã§ã™ã€‚  \nã§ã‚‚ãªã‚“ã‹ã‚µãƒ¼ãƒ“ã‚¹ã‚’çµ‚äº†ã•ã›ã‚‹`stopService`ã ã‘ã†ã¾ãå‹•ã„ãŸã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹å´ã§æˆ»ã™ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚`onDestroy`ã€ã¾ã˜ã§è¬  \n\nãªã‚“ã‹ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­ãªã‚‰ã‚¢ãƒ—ãƒªå±¥æ­´ç”»é¢ã‹ã‚‰çµ‚äº†ã•ã›ã¦ã‚‚`onDestroy`ã§USBãƒ‡ãƒãƒƒã‚°ã‚’æœ‰åŠ¹ã«ã§ãã‚‹ï¼Ÿ\n\n## registerForActivityResult ã®å¼•æ•°ã‚’è‡ªä½œã™ã‚‹\n\nä¸Šè¨˜ã®`ActivityClose`ã‚¯ãƒ©ã‚¹ã®ã“ã¨ã§ã™ã­ã€‚`ActivityResultContract`ã‚’ç¶™æ‰¿ã—ã¦ã€`ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹`ã®ï¼‘å€‹ç›®ã®å‹ã¯ã€ç”»é¢é·ç§»ã‚’ã™ã‚‹é–¢æ•°ã€`launch()`ã«æ¸¡ã™å€¤ã®å‹ã§ã™ã€‚ä»Šå›ã¯Intentã‚’æ¸¡ã™ã®ã§`Intent`ã§ã™ã€‚  \nï¼’å€‹ç›®ã®å‹ã¯ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯æ™‚ã«è¿”ã™å€¤ã§ã™ã€‚ã“ã“ã§ã¯ç‰¹ã«ä½•ã‚‚è¿”ã•ãªã„ã®ã§`Unit`ã§ã™ã€‚  \n\nãã‚Œã‹ã‚‰2ã¤é–¢æ•°ãŒã‚ã‚Šã¾ã™ãŒã€`createIntent`ã«é–¢ã—ã¦ã¯`å¼•æ•°ã®Intent`ã‚’ãã®ã¾ã¾returnã—ã¦ã€`parseResult`ã§ã¯ç‰¹ã«ä½•ã‚‚ã—ã¾ã›ã‚“ã€‚\n\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™\n\nãªãŠã€`WRITE_SECURE_SETTINGS`ã®æ¨©é™ãŒã‚ã‚‹ã‹ã®ãƒã‚§ãƒƒã‚¯ã¯ã—ã¦ãªã„ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦æ¨©é™ã‚’ä»˜ä¸ã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚ï¼ˆã‚ˆã£ã¦åˆå›èµ·å‹•æ™‚ã¯å¼·åˆ¶ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ã¾ã™ï¼‰\n\n```\npm grant io.github.takusan23.usbdebugautohide android.permission.WRITE_SECURE_SETTINGS\n```\n\nhttps://github.com/takusan23/USBDebugAutoHide\n\n# ãŠã‚ã‚Šã«\nhttps://github.com/takusan23/DeveloperHide\n\nã‚¢ãƒ—ãƒªæ›¸ãã¾ã—ãŸã€‚ãã®ã†ã¡Playã‚¹ãƒˆã‚¢ã«å‡ºã—ãŸã„\n\næå‡ºã¯ã—ãŸã€å¯©æŸ»ãŒé€šã‚‹ã‹ã¯çŸ¥ã‚‰ã‚“ã‘ã©ï¼šhttps://play.google.com/store/apps/details?id=io.github.takusan23.developerhide"},{"title":"Play ã‚¹ãƒˆã‚¢ã§ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ä½ç½®æƒ…å ±å–å¾—æ¨©é™ ACCESS_BACKGROUND_LOCATION ã‚’ä½¿ã†ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã—ã¦ã¿ãŸ","link":"/posts/android_background_location_play_console/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚  \r\n`NewRadioSupporter` ã®æ›´æ–°ã‚’é…ä¿¡ã—ã‚ˆã†ã¨ã—ãŸæ™‚ã®è©±ã€‚\r\n\r\n# ãƒªãƒªãƒ¼ã‚¹ã—ã‚ˆã†ã¨ã—ãŸã‚‰\r\n**ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä½ç½®æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ¨©é™**ã‚’ä½¿ã†å ´åˆã¯ã€è¿½åŠ ã§ç”³å‘Šã‚’ã—ãªã„ã¨ã„ã‘ãªã„ã‚‰ã—ã„ã€‚  \r\nã¾ããã“ãã“å±é™ºãªæ¨©é™ã ã‚ˆãªã€‚ã€‚ã€‚\r\n\r\n![Imgur](https://imgur.com/G8z5jtf.png)\r\n\r\nã©ã†ã‚„ã‚‰ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰çŠ¶æ…‹ã§ä½ç½®æƒ…å ±ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã«ã¯ã€ã‚¢ãƒ—ãƒªã®å¯©æŸ»ã§è¿½åŠ ã®ç”³å‘Šã‚’ã—ãªã„ã¨ã„ã‘ãªã„ã‚‰ã—ã„ã€‚ã®ã§ãƒ¡ãƒ¢\r\n\r\n![Imgur](https://imgur.com/y02GXIf.png)\r\n\r\n## æ–‡å­—ã§æ›¸ãéƒ¨åˆ†\r\nã‚¢ãƒ—ãƒªãŒä½•ãªã®ã‹ã€ã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§ä½ç½®æƒ…å ±ã‚’å–å¾—ã™ã‚‹æ©Ÿèƒ½ãŒä½•ãªã®ã‹ã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/zL781Yc.png)\r\n\r\n![Imgur](https://imgur.com/3pxyDeD.png)\r\n\r\n## å‹•ç”»\r\n\r\nä½¿ã„æ–¹ã‚’è¡¨ã™**å‹•ç”»**ã‚’æå‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹æ¨¡æ§˜ã€‚\r\n\r\nhttps://support.google.com/googleplay/android-developer/answer/9799150?hl=ja#Video%20demonstration\r\n\r\n`å‹•ç”»ã®ä¸­ã§æ©Ÿèƒ½ã‚„ãã®å½±éŸ¿ï½` â† ãªã‚“ã‹å‹•ç”»ã®ä¸­ã«èª¬æ˜ã‚‚å…¥ã‚Œã‚ã€ã¿ãŸã„ãªè¨€ã„æ–¹ã‚’ã—ã¦ã‚‹ã®ã§ã€  \r\nãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ä½ç½®æƒ…å ±å–å¾—ã‚’ã™ã‚‹æµã‚Œã‚’ç”»é¢éŒ²ç”»ã‚’ã—ãŸä¸Šã§ã€`AviUtl`ã§æ–‡å­—ã‚’å…¥ã‚Œã¦é©å½“ã«ä½œã‚Šã¾ã—ãŸã€‚~~æ•°å¹´å‰ã¯ã‚ˆããƒ‹ã‚³ãƒ‹ã‚³å‹•ç”»ã«æŠ•ç¨¿ã—ã¦ãŸã®ã§å‹•ç”»ä½œã‚‹ç’°å¢ƒã¯ã‚ã‚‹ã£ã¡ã‚ƒã‚ã‚‹~~\r\n\r\n![Imgur](https://imgur.com/FIQYmyT.png)\r\n\r\n`YouTube`ã«ä¸Šã’ã‚‹ã®ã‚’æ¨å¥¨ã—ã¦ã„ã‚‹ã‚‰ã—ã„ã®ã§ãã†ã—ãŸã€‚åˆ¥ã«`Google Drive`ã®å…±æœ‰ã§ã‚‚è‰¯ã„ã‚‰ã—ã„ã€‚  \r\né™å®šå…¬é–‹ãªã®ã§å‹•ç”»èª¬æ˜æ¬„ã¨ã‹ã¯é©å½“ã§ã„ã„ã¯ãšã€‚\r\n\r\n![Imgur](https://imgur.com/DzcMGZv.png)\r\n\r\né™å®šå…¬é–‹ã§å…¬é–‹ã—ã¦  \r\n\r\n![Imgur](https://imgur.com/UdAfwq0.png)\r\n\r\nPlayConsole ã¸æˆ»ã‚Šç”³å‘Šãƒ•ã‚©ãƒ¼ãƒ ã« URL ã‚’è²¼ã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ZARjWfy.png)\r\n\r\n## ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼\r\nå…ƒã€…ã‚ã‚Šã¾ã—ãŸãŒã€ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã‚‚ã“ã‚Œã«åˆã‚ã›ã¦æ›´æ–°ã—ã¾ã—ãŸã€‚  \r\nã‚¢ãƒ—ãƒªå†…ã‹ã‚‰ã‚‚é£›ã¹ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\r\n\r\nhttps://github.com/takusan23/NewRadioSupporter/blob/master/PRIVACY_POLICY.md\r\n\r\nã‚‚ã—ã‹ã™ã‚‹ã¨ã€`GitHub`ã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã«ã‚ã‚‹`Markdown`ã ã¨ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã‚‹ã‹ã‚‚ï¼ˆå¾Œè¿°ã—ã¾ã™ï¼‰\r\n\r\n# å¯©æŸ»å‡ºã—ã™ã‚‹ãƒ»ãƒ»ãƒ»ï¼\r\nãŠã­ãŒã„ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/2cdTKvC.png)\r\n\r\n## ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã‚‹ 1å›ç›®\r\n\r\n![Imgur](https://imgur.com/86QiK36.png)\r\n\r\nãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ãŒç”˜ã„ã¨åˆ¤æ–­ã•ã‚ŒãŸã‚‰ã—ã„ã€‚`åé›†ã™ã‚‹é …ç›® / åˆ©ç”¨ç›®çš„ / å…±æœ‰ã®æœ‰ç„¡`ã‚’ãã‚Œãã‚Œæ›¸ãã¾ã—ãŸã€‚  \r\nã‚ã¨ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«ã‚¢ãƒ—ãƒªã®åå‰ã‚’ã¡ã‚ƒã‚“ã¨æ›¸ãã‚ˆã†ã«ã—ãŸã€‚  \r\n\r\nå†æå‡ºï½\r\n\r\n## ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã‚‹ 2å›ç›®\r\n\r\n![Imgur](https://imgur.com/Mn3J415.png)\r\n\r\n<p style=\"color:red;font-size:40px\">ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ</p>\r\n\r\nãˆï¼Ÿ`URL` å¤‰ãˆã¦ãªã„ã‚“ã§ã™ã‘ã©ã€1å›ç›®ã¯è¦‹ã‚ŒãŸã®ã«2å›ç›®ã¯è¦‹ã‚Œãªããªã£ã¡ã‚ƒã£ãŸã‚“ã§ã™ã‹ï¼Ÿ  \r\n`GitHub`ã®ãƒªãƒã‚¸ãƒˆãƒªå†…ã«ã‚ã‚‹`Markdown`ã¸ã®ãƒªãƒ³ã‚¯ã‚’ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã®`URL`ã¨ã—ã¦ä½¿ã£ã¦ãŸã‚“ã§ã™ã‘ã©ã€ã‚‚ã—ã‹ã—ã¦`GitHub`ã®ãƒªãƒã‚¸ãƒˆãƒªã˜ã‚ƒã ã‚ãªã®ï¼Ÿ  \r\nä»•æ–¹ãªã„ã®ã§è‡ªåˆ†ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ã“ã®ã‚µã‚¤ãƒˆã«æ›¸ãã¾ã—ãŸã€‚ãã‚Œãªã‚‰1å›ç›®ã§ãƒªãƒ³ã‚¯ãŒç„¡åŠ¹ã£ã¦è¨€ã£ã¦ã»ã—ã‹ã£ãŸã€‚ã€‚ã€‚\r\n\r\nã„ã‚„ï½ã§ã‚‚ã„ã¾ã¾ã§`ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹ Markdown`ã¸ã®ãƒ‘ã‚¹ã‚’ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼ã«ä½¿ã£ãŸã‚“ã ã‘ã©ã€ãªã‚“ã§ä»Šå›ã ã‘ãƒ€ãƒ¡ã ã£ãŸã‚“ã ã‚ã†ã€‚  \r\nç•°è­°ç”³ã—ç«‹ã¦ã—ã¦ã‚‚è‰¯ã‹ã£ãŸã‹ã‚‚ã ã‘ã©ã€æ—©ãé…ä¿¡ã—ãŸã‹ã£ãŸã‹ã‚‰é£²ã‚€ã“ã¨ã«ã—ãŸã€‚\r\n\r\n## ã¨ãŠã‚Šã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/8mVv36Y.png)\r\n\r\n# ã“ã‚Œæ›¸ã„ã¦ã‚‹æ™‚ã«æ°—ä»˜ã„ãŸ\r\n`ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹`ã§åˆ©ç”¨ã™ã‚‹å ´åˆã€`AndroidManifest`ã§`<service>`ã®`foregroundServiceType`å±æ€§ã‚’`location`ã«ã™ã‚‹ã“ã¨ã§ã€ã‚¢ãƒ—ãƒªãŒãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼ˆå¤–ã‚¢ãƒ—ãƒªåˆ©ç”¨ä¸­ï¼‰ã§ãªãã¦ã‚‚ä½ç½®æƒ…å ±ãŒå–å¾—ã§ãã‚‹ã¯ãšã§ã™ã€‚  \r\n\r\nè©¦ã—ã¦ãªã„ã‘ã©ã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãªã‚‰é€šçŸ¥ãŒå‡ºã‚‹ã‹ã‚‰ãƒ¦ãƒ¼ã‚¶ãƒ¼æ°—ä»˜ãã§ã—ã‚‡ï¼ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ä½ç½®æƒ…å ±å–å¾—æ¨©é™ã¯è¦ã‚‰ãªã„ã‚ˆï¼çš„ãªäº‹ãŒæ›¸ã„ã¦ã‚ã‚‹â†’ https://developer.android.com/training/location/permissions#foreground\r\n\r\n```xml\r\n<service\r\n    android:name=\".BackgroundLocationService\"\r\n    android:enabled=\"true\"\r\n    android:exported=\"false\"\r\n    android:foregroundServiceType=\"location\">\r\n</service>\r\n```\r\n\r\n```kotlin\r\nclass BackgroundLocationService : Service() {\r\n\r\n    override fun onCreate() {\r\n        super.onCreate()\r\n\r\n        val notification = // é€šçŸ¥ã‚’ä½œã‚‹\r\n        ServiceCompat.startForeground(this, NOTIFICATION_ID, notification, ServiceInfo.FOREGROUND_SERVICE_TYPE_LOCATION) // location\r\n\r\n    }\r\n}\r\n```\r\n\r\nã‚ã‚Œï¼Ÿã˜ã‚ƒã‚ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ä½ç½®æƒ…å ±å–å¾—ã®æ¨©é™è¦ã‚‰ãªã„ï¼Ÿã¨æ€ã£ãŸã‚“ã§ã™ã‘ã©ã€**ã“ã®ã‚¢ãƒ—ãƒªã¯ 5G å›ç·šãƒã‚§ãƒƒã‚«ãƒ¼ãªã®ã§ã€`foregroundServiceType=\"location\"`ã§è‰¯ã„ã®ã‹ãŒå¾®å¦™ã§**ã€çµå±€ã“ã®æ–¹æ³•ã‚‚ä½¿ãˆãªã•ãã†ã€‚\r\n\r\n- https://developer.android.com/about/versions/14/changes/fgs-types-required#location\r\n- https://developer.android.com/reference/android/R.attr#foregroundServiceType\r\n\r\n`WorkManager`ã§å‹•ã‹ã—ãŸã„ã¨ã‹ãŒã‚ã‚Œã°ã€ã‚„ã£ã±ã‚Šã“ã®æ¨©é™ãŒå¿…è¦ã‹ã‚‚ï¼Ÿ\r\n\r\n# ãŠã‚ã‚Šã«1\r\né›»æ³¢çŠ¶æ…‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ã€ä½ç½®æƒ…å ±ã®æ¨©é™ãŒå¿…è¦ãªã‚“ã§ã™ã‘ã©ã€ã“ã‚Œã¯ä½•æ•…ã‹ã¨ã„ã†ã¨ã€  \r\n`CID`ã‚„`PCI`ã®å€¤ãŒã€åŸºåœ°å±€ï¼Ÿã«å¯¾ã—ã¦ä¸€æ„ã®å€¤ï¼ˆä»–ã¨è¢«ã‚‰ãªã„ã€ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªå€¤ï¼‰ã‚‰ã—ã„ï¼Ÿï¼Ÿï¼Ÿã‹ã‚‰ã€ãŠãŠã‚ˆãã®ä½ç½®ãŒåˆ†ã‹ã‚‹ã‹ã‚‰ã‚‰ã—ã„ã€‚ã¯ãˆï½  \r\n\r\n# ãŠã‚ã‚Šã«2\r\n\r\n`ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ 5G é€šçŸ¥æ©Ÿèƒ½`ã®ä¿®æ­£ã®ã¤ã„ã§ã«ã€‚  \r\n`WearOS`å´ã«é€šçŸ¥ãŒè¡Œãã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨é€šçŸ¥ã¯ã‚µã‚¤ãƒ¬ãƒ³ãƒˆãªã®ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«ã—ãªã„ã¨ã„ã‘ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\n![Imgur](https://imgur.com/knYSsYl.png)\r\n\r\nã¡ãªã¿ã«ã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­é€šçŸ¥ãŒã€åˆ¥ã§å‡ºã‚‹ã‚ˆã†ã«ãªã£ã¦ã—ã¾ã£ãŸã®ã§ã™ãŒã€ã“ã‚Œã¯é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã®è¨­å®šã‹ã‚‰å€‹åˆ¥ã«æ¶ˆã›ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚  \r\nå®Ÿè¡Œä¸­ã®æ–¹ã‚’ã‚ªãƒ•ã«ã—ã¦ã‚‚é›»æ³¢çŠ¶æ…‹ã®é€šçŸ¥ã¯æ¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/aliGiWC.png)\r\n\r\nã¡ãªã¿ã«ä»Šã¾ã§ãªã‚“ã§æ¥ãªã‹ã£ãŸã‹ã¨ã„ã†ã¨ã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•ã«ã¯é€šçŸ¥ã‚’å‡ºã•ãªã„ã¨ã„ã‘ãªã„ã®ã§ã™ãŒã€ã“ã®é€šçŸ¥ã«é›»æ³¢çŠ¶æ…‹ã‚’è¡¨ç¤ºã•ã›ã¦ãŸã‹ã‚‰ã§ã—ãŸã€‚  \r\nã“ã®é€šçŸ¥ã€ã‚µãƒ¼ãƒ“ã‚¹ãŒå‹•ã„ã¦ã„ã‚‹é–“ã¯æ¶ˆã›ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚  \r\nãã—ã¦ã€æ¶ˆã›ãªã„é€šçŸ¥ã¯`WearOS`å´ã«è»¢é€ã•ã‚Œãªã„ã‚“ã§ã™ã‚ˆã­ã€‚  \r\n\r\nhttps://developer.android.com/training/wearables/notifications/bridger#non-bridged\r\n\r\nãªã®ã§ã€ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ä¸­é€šçŸ¥ã¨ã¯åˆ¥ã«ã€é›»æ³¢çŠ¶æ…‹ã®é€šçŸ¥ã‚’å‡ºã™ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚é›»æ³¢çŠ¶æ…‹ã®æ–¹ã¯æ¶ˆã›ã‚‹ã®ã§ã€`WearOS`ã«ã‚‚å‡ºã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚"},{"title":"BottomSheetDialogFragmentã¨ã‹Dialogã§ComposeViewãŒä½¿ãˆãªã„","link":"/posts/android_bottom_fragment_use_compose_view/","markdown":"\r\n~~`alpha 12`ã‹ã‚‰ç›´ã£ã¦ãªã„~~  \r\n `beta02`ã§ä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚æ›´æ–°æ‰‹é †ã¯ã€  \r\n`app/build.gradle`ã®Kotlinãƒãƒ¼ã‚¸ãƒ§ãƒ³ã€Composeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã€\r\n\r\n```gradle\r\n// Composeé–¢ä¿‚\r\ncomposeOptions {\r\n    kotlinCompilerVersion '1.4.31'\r\n    kotlinCompilerExtensionVersion '1.0.0-beta02'\r\n}\r\n```\r\n\r\nComposeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã¦ã€  \r\n`Fragment`ã€`AppCompat`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`1.3`ä»¥ä¸Šã«ã™ã‚Œã°ã“ã®å•é¡Œã¯ä¿®æ­£ã§ãã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\r\n\r\n    implementation \"androidx.compose.ui:ui:1.0.0-beta02\"\r\n    // Tooling support (Previews, etc.)\r\n    implementation \"androidx.compose.ui:ui-tooling:1.0.0-beta02\"\r\n    // Foundation (Border, Background, Box, Image, Scroll, shapes, animations, etc.)\r\n    implementation \"androidx.compose.foundation:foundation:1.0.0-beta02\"\r\n    // Material Design\r\n    implementation \"androidx.compose.material:material:1.0.0-beta02\"\r\n    // Integration with observables\r\n    implementation \"androidx.compose.runtime:runtime-livedata:1.0.0-beta02\"\r\n    // LayoutInspector\r\n    implementation \"androidx.compose.ui:ui-tooling:1.0.0-beta02\"\r\n\r\n    // fragment\r\n    implementation 'androidx.fragment:fragment-ktx:1.3.1'\r\n\r\n    // appcompat\r\n    implementation 'androidx.appcompat:appcompat:1.3.0-beta01'\r\n\r\n}\r\n```\r\n\r\n# æœ¬é¡Œ\r\n`BottomSheetDialogFragment`ã®`onCreateView`ã®è¿”ã‚Šå€¤ã¨ã—ã¦`ComposeView()`ã‚’ä½¿ã†ã¨ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å•é¡Œ\r\n\r\n```java\r\njava.lang.IllegalStateException: ViewTreeLifecycleOwner not found from DecorView@b98b3fc[MainActivity]\r\n```\r\n\r\n# ç’°å¢ƒ\r\n\r\n| name    | value        |\r\n|---------|--------------|\r\n| Compose | 1.0.0 Beta 1 |\r\n\r\n## ãªã‚“ã§ï¼Ÿ\r\n`ViewTreeLifecycleOwner`ã£ã¦ã„ã†`View`ã‹ã‚‰`Activity/Fragment`ã®ãƒ©ã‚¤ãƒ•ãƒ©ã‚¤ã‚¯ãƒ«ã‚’å–å¾—ã§ãã‚‹ã‚„ã¤ãŒã‚ã‚‹ã‚“ã§ã™ã‘ã©ã€  \r\nè¦ªViewã‚’æŒ‡å®šã—ã¦`ViewTreeLifecycleOwner.get()`ã‚’å‘¼ã¶ã¨ãªãœã‹nullãŒè¿”ã£ã¦ãã‚‹\r\n\r\n# è§£æ±ºæ–¹æ³•\r\nãŠå¥½ããªæ–¹ã‚’ã©ã†ã\r\n- `ViewTreeLifecycleOwner`(ã¨`Recomposer`)ã‚’æŒ‡å®šã™ã‚‹\r\n- `androidx.fragment`ã‚’ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç‰ˆã«ã™ã‚‹\r\n\r\n## `ViewTreeLifecycleOwner`ã‚’æŒ‡å®šã™ã‚‹\r\n\r\n`Compose`ã§ä½¿ã£ã¦ã‚‹`Recomposer`ã‚’ä½œã‚‹ã®ã«`ViewTreeLifecycleOwner`ãŒå¿…è¦ã ã£ãŸæ¨¡æ§˜ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§`Recomposer`ã‚’ä½œã£ã¦æ¸¡ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\r\n\r\n`ViewTreeLifecycleOwner.set()`ã®ç¬¬äºŒå¼•æ•°ã¯`Activity`ã®å ´åˆã¯`Activity`ã‚’ï¼ˆthisï¼‰ã€  \r\n`Fragment`ã®å ´åˆã¯`viewLifecycleOwner`ã‚’æ¸¡ã—ã¦ã‚ã’ã¦ãã ã•ã„\r\n\r\n```kotlin\r\nclass BottomFragmentCompose : BottomSheetDialogFragment() {\r\n\r\n    @InternalComposeUiApi\r\n    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {\r\n        return ComposeView(requireContext()).apply {\r\n\r\n            ViewTreeLifecycleOwner.set(this, viewLifecycleOwner)\r\n            val newRecomposer = AtomicReference(WindowRecomposerFactory.LifecycleAware).get().createRecomposer(rootView)\r\n            compositionContext = newRecomposer\r\n\r\n            setContent {\r\n                Text(\r\n                    text = \"BottomSheetDialogFragment + ComposeView\",\r\n                    modifier = Modifier.padding(10.dp)\r\n                )\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n`Dialog`ã§`ComposeView`ã‚’ä½¿ã†å ´åˆã¯`ViewTreeSavedStateRegistryOwner`ã®æŒ‡å®šã‚‚å¿…è¦ã‹ã‚‚\r\n\r\n```kotlin\r\n@InternalComposeUiApi\r\nprivate fun showDialog() {\r\n    Dialog(this).apply {\r\n        setContentView(ComposeView(context).apply {\r\n            ViewTreeLifecycleOwner.set(this, this@MainActivity)\r\n            ViewTreeSavedStateRegistryOwner.set(this, this@MainActivity)\r\n            val newRecomposer = AtomicReference(WindowRecomposerFactory.LifecycleAware).get().createRecomposer(this)\r\n            compositionContext = newRecomposer\r\n            setContent {\r\n                Text(\r\n                    text = \"Dialog + ComposeView\",\r\n                    modifier = Modifier.padding(10.dp)\r\n                )\r\n            }\r\n        })\r\n    }.show()\r\n}\r\n```\r\n\r\n## Fragmentã‚’ã‚¹ãƒŠãƒƒãƒ—ã‚·ãƒ§ãƒƒãƒˆç‰ˆã«ã™ã‚‹\r\nã¤ã„ã•ã£ãçŸ¥ã£ãŸã‚“ã§ã™ã‘ã©ã€`build.gradle`ã‹ã‚‰`allprojects`ãŒæ¶ˆæ»…ã—ã¦ãŸã€‚(gradleãŒ6.8ã«ãªã£ãŸå½±éŸ¿ï¼Ÿ)  \r\nä»£æ›¿ã¨ã—ã¦ã€`settings.gradle`ã«`dependencyResolutionManagement`ãŒè¿½åŠ ã•ã‚ŒãŸæ¨¡æ§˜  \r\n\r\n\r\n### allprojectãŒã‚ã‚‹å ´åˆ\r\n\r\n```gradle\r\nallprojects {\r\n    repositories {\r\n        google()\r\n        jcenter()\r\n        maven { url 'https://androidx.dev/snapshots/builds/7172350/artifacts/repository' } // ã“ã‚Œã‚’æ›¸ãè¶³ã™\r\n    }\r\n}\r\n```\r\n\r\nã‚ã¨ã¯`app`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹`build.gradle`ã‚’é–‹ã„ã¦ã€`androidx.fragment`ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã™\r\n\r\n```gradle\r\ndependencies {\r\n    implementation \"androidx.fragment:fragment:1.4.0-SNAPSHOT\"\r\n}\r\n```\r\n\r\n### dependencyResolutionManagementã®å ´åˆ\r\n`settings.gradle`ã‚’é–‹ã„ã¦æ›¸ãè¶³ã™\r\n\r\n```gradle\r\ndependencyResolutionManagement {\r\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n        jcenter() // Warning: this repository is going to shut down soon\r\n        maven { url 'https://androidx.dev/snapshots/builds/7172350/artifacts/repository' }\r\n    }\r\n}\r\n```\r\n\r\nã‚ã¨ã¯`app`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹`build.gradle`ã‚’é–‹ã„ã¦ã€`androidx.fragment`ã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã™\r\n\r\n```gradle\r\ndependencies {\r\n    implementation \"androidx.fragment:fragment:1.4.0-SNAPSHOT\"\r\n}\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\ndependencyResolutionManagement ã£ã¦ãªã«  \r\n\r\nã‚ã¨ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™  \r\n\r\nhttps://github.com/takusan23/BottomFragmentComposeView\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://issuetracker.google.com/issues/180691023"},{"title":"Androidã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã—ãŸæ—¥ä»˜ã‚’ã‚¢ãƒ—ãƒªå´ã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹","link":"/posts/android_build_date_resource/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n2æœˆã¨ã„ãˆã°æ¬¡æœŸAndroidã®ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§ã™ã‚ˆã­ã£ã¦æ„Ÿã˜ã ã‘ã©ã€Android 12LãŒã‚ã‚‹ä¸­æœãŸã—ã¦ãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã‚‹ã®ã‹ï¼ˆï¼Ÿï¼‰\r\n\r\n# æœ¬é¡Œ\r\nAndroidã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã—ãŸã¨ãã®æ—¥ä»˜ã‚’ã‚¢ãƒ—ãƒªå´ã‹ã‚‰è¡¨ç¤ºã§ãã‚‹ã‚ˆã†ã«ã§ãã‚‹ã‚‰ã—ã„ã€‚  \r\n(build.gradle ã§ `Context#getString` ã‹ã‚‰å‚ç…§å¯èƒ½ãªãƒªã‚½ãƒ¼ã‚¹ã‚’ä½œæˆã§ãã‚‹ã¿ãŸã„)\r\n\r\n## å…¬å¼\r\n\r\nhttps://developer.android.com/studio/build/gradle-tips?hl=ja#share-custom-fields-and-resource-values-with-your-app-code\r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                   |\r\n|----------------|--------------------------|\r\n| Android        | 12                       |\r\n| Android Studio | Android Studio Bumblebee |\r\n\r\n# build.gradle\r\n`app`ãƒ•ã‚©ãƒ«ãƒ€ã®æ–¹ã®`build.gradle`ã‚’é–‹ã„ã¦ã€ã“ã†æ›¸ãã¾ã™ã€‚\r\n\r\n```java\r\nandroid {\r\n    compileSdk 31\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.androidbuilddateresource\"\r\n        minSdk 21\r\n        targetSdk 31\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        // ãƒ“ãƒ«ãƒ‰æ—¥æ™‚ã‚’ Context#getString ã§å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\r\n        resValue(\"string\", \"build_date\", System.currentTimeMillis().toString())\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    // çœç•¥...\r\n```\r\n\r\nã‚ã¨ã¯ `R.string.build_date` ã§å‚ç…§ã§ãã¾ã™ã€‚ \r\nUnixTimeã‚’æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¤‰æ›´ã—ã¦TextViewãªã‚“ã‹ã«å…¥ã‚Œã‚Œã°å®Œæˆã€‚  \r\nä¸€åº¦ãƒ“ãƒ«ãƒ‰ã™ã‚‹ã¾ã§<span style=\"color:red\">èµ¤ã„ã¾ã‚“ã¾</span>ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val textView by lazy { findViewById<TextView>(R.id.activity_main_textview) }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n        // ãƒ“ãƒ«ãƒ‰æ—¥æ™‚\r\n        val buildDate = getString(R.string.build_date).toLong()\r\n        // æ—¥ä»˜ã‚’ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã™ã‚‹\r\n        val simpleDateFormat = SimpleDateFormat(\"yyyy/MM/dd HH:mm:ss\", Locale.getDefault())\r\n        val formatDate = simpleDateFormat.format(buildDate)\r\n        // TextViewã¸\r\n        textView.text = formatDate\r\n    }\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/yJffXni.png)\r\n\r\n### ãŠã¾ã‘\r\n\r\n`build.gradle.kts`ã®å ´åˆã‚‚ã»ã¨ã‚“ã©åŒã˜ã§ã™ã€‚\r\n\r\n```kotlin\r\nandroid {\r\n    compileSdk = 31\r\n\r\n    defaultConfig {\r\n        applicationId = \"io.github.takusan23.androidbuilddateresource\"\r\n        minSdk = 21\r\n        targetSdk = 31\r\n        versionCode = 1\r\n        versionName = \"1.0\"\r\n\r\n        // ãƒ’ãƒ«ãƒ‰æ—¥æ™‚ã‚’ Context#getString ã§å‚ç…§å¯èƒ½ã«ã™ã‚‹\r\n        resValue(\"string\", \"build_date\", System.currentTimeMillis().toString())\r\n\r\n        testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    // çœç•¥...\r\n```"},{"title":"Androidã§Canvasã‹ã‚‰å‹•ç”»ã‚’ä½œã‚‹","link":"/posts/android_canvas_to_video/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\nD.C.5 æ”»ç•¥ã—ã¾ã—ãŸï¼ˆãœã‚“ã­ã‚“ã‚Œã„ä½œå“ï¼‰  \r\nå…¨å¹´é½¢ã ã‘ã©çµæ§‹æ”»ã‚ãŸã‚¤ãƒ™ãƒ³ãƒˆCGãŒå¤šã‹ã£ãŸæ°—ãŒã™ã‚‹ï¼ˆã“ã‚“ãªã‚‚ã‚“ãªã‚“ã§ã™ã‹ã­  \r\n\r\n(é¡”ã¤ããŒå¤§äººã£ã½ããªã‚Šã¾ã—ãŸã­..!)\r\n\r\n![Imgur](https://imgur.com/pxfMlhZ.png)\r\n\r\nä»Šå›ã®ä¸»äººå…¬ã€ç™½æ²³ç¯è‰ã¡ã‚ƒã‚“ä»¥å¤–ã®ãƒ’ãƒ­ã‚¤ãƒ³ãŒåŒã˜å®¶ã«ã„ã‚‹ã ã¨\r\n\r\nç¯è‰ã¡ã‚ƒã‚“âˆšãŒã‚ã£ã¡ã‚ƒå¯æ„›ã‹ã£ãŸã®ã§ãŠã™ã™ã‚ã§ã™ã€‚\r\n(è‡ªå‰ã®ã‚¹ã‚¯ã‚·ãƒ§ã‚’ã¨ã‚‹ã‚¢ãƒ—ãƒªã®èª¿å­ãŒã‚ã‚‹ãæ™®é€šã«å†™ã‚Šè¾¼ã‚“ã§ã¾ã™ãŒæ°—ã«ã›ãš...)\r\n\r\n![Imgur](https://imgur.com/GNSMgxB.png)\r\n\r\nã‹ã‚ã„ã„\r\n\r\n![Imgur](https://imgur.com/6Bldigw.png)\r\n\r\nã“ã“ã®ãŠè©±ãŒãŠæ°—ã«å…¥ã‚Šã§ã™\r\n\r\n![Imgur](https://imgur.com/9ZdJGh7.png)\r\n\r\n![Imgur](https://imgur.com/UCNiB3v.png)\r\n\r\nã‚ã¨å€‹åˆ¥ãƒ«ãƒ¼ãƒˆã§æ„›ä¹ƒäºœã¡ã‚ƒã‚“ã‹ã‚ã„ã„ããªã£ã¦ã„ãã®ã§ãœã²ã€‚ã„ã„ãªã‚...\r\n\r\n![Imgur](https://imgur.com/Phon90s.png)\r\n\r\n![Imgur](https://imgur.com/iNsB5sW.png)\r\n\r\nD.C.4 ã‚’ã‚„ã£ã¦ãªãã¦ã‚‚æ¥½ã—ã‚ã‚‹ã¨æ€ã†ã®ã§ãœã²ï¼\r\n\r\n![Imgur](https://imgur.com/QlX9XGN.png)\r\n\r\nã„ãã¤ã‹è¬ãŒæ®‹ã£ã¦ã„ã¾ã™ãŒFDã¨ã‹6ã¨ã‹ã§æ˜ã‹ã•ã‚Œã‚‹ã®ã§ã—ã‚‡ã†ã‹ã€æ¥½ã—ã¿ã§ã™ï¼  \r\n(ç‘èŠ±verã®ã‚ãã‚Šé€¢ãˆãŸã­ã€å˜å“ã§ã»ã—ã„)\r\n\r\n# æœ¬é¡Œ\r\nå°‘ã—å‰ã«å‹•ç”»ã®ä¸Šã«Canvasã§è½æ›¸ãã™ã‚‹ã‚ˆã†ãªè¨˜äº‹ã‚’æ›¸ãã¾ã—ãŸãŒã€ä»Šå›ã¯ãã‚‚ãã‚‚Canvasã‹ã‚‰å‹•ç”»ã‚’ä½œã£ã¦ã¿ã‚ˆã†ã®è©±ã§ã™ã€‚  \r\nã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã£ã½ã„å‹•ç”»ã‚’ä½œã‚‹ã‚¢ãƒ—ãƒªãŒä½œã‚Œã‚‹ã‹ã‚‚ï¼Ÿ\r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„       |\r\n|---------|--------------|\r\n| ç«¯æœ«    | Xperia Pro-I |\r\n| Android | 13           |\r\n| è¨€èª    | Kotlin       |\r\n\r\n`OpenGL` ã‚’ä½¿ã„ã¾ã™ãŒä½¿ã‚ãªã„æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚  \r\nã‚ã¨`Jetpack Compose`ã‚’ä½¿ã„ã¾ã™ãŒåˆ¥ã«ä½¿ã‚ãªãã¦ã‚‚è‰¯ã„ã§ã™ã€‚\r\n\r\n## ã‚ã‚“ã©ã†ãªã‚“ã ã‘ã©\r\næœ€æ–°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯â†“ã‹ã‚‰ã€ã™ã§ã«ä»Šå›ã‚„ã£ãŸã“ã¨ã¯ MavenCentral ã«ã‚ã‚‹ã®ã§ã€ã€ã€  \r\n![Maven Central](https://img.shields.io/maven-central/v/io.github.takusan23/akaricore)\r\n\r\n```kotlin\r\nimplementation(\"io.github.takusan23:akaricore:1.0.0-alpha03\")\r\n```\r\n\r\nã‚ã¨ã¯ã„ã„æ„Ÿã˜ã«ä¹—ã£ã‹ã‚Œã°ä½œã‚Œã‚‹ã¯ãš\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n        canvasToVideoProcessorStart()\r\n    }\r\n\r\n    private fun canvasToVideoProcessorStart() {\r\n        lifecycleScope.launch {\r\n            // ä¿å­˜å…ˆ\r\n            val resultFile = getExternalFilesDir(null)?.resolve(\"${System.currentTimeMillis()}.mp4\") ?: return@launch\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n            val videoWidth = 1280\r\n            val videoHeight = 720\r\n\r\n            val outlinePaint = Paint().apply {\r\n                color = Color.BLACK\r\n                style = Paint.Style.STROKE\r\n                textSize = 80f\r\n            }\r\n            val innerPaint = Paint().apply {\r\n                style = Paint.Style.FILL\r\n                color = Color.WHITE\r\n                textSize = 80f\r\n            }\r\n            val logoBitmap = ContextCompat.getDrawable(this@MainActivity, R.drawable.ic_launcher_foreground)?.apply {\r\n                setTint(Color.WHITE)\r\n            }?.toBitmap(300, 300)!!\r\n\r\n            // Canvas ã«ã‹ã\r\n            // å‡¦ç†ãŒçµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹\r\n            CanvasProcessor.start(\r\n                resultFile = resultFile, // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«\r\n                outputVideoWidth = videoWidth,\r\n                outputVideoHeight = videoHeight\r\n            ) { positionMs ->\r\n                // é©å½“ã«æ–‡å­—ã‚’æ›¸ã\r\n                val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(positionMs / 1000f)}\"\r\n                // æ å–ã‚Šæ–‡å­—\r\n                drawText(text, 0f, 80f, outlinePaint)\r\n                // æ ç„¡ã—æ–‡å­—\r\n                drawText(text, 0f, 80f, innerPaint)\r\n                // ç”»åƒã‚‚è¡¨ç¤ºã™ã‚‹\r\n                drawBitmap(logoBitmap, (videoWidth - logoBitmap.width).toFloat(), (videoHeight - logoBitmap.height).toFloat(), innerPaint)\r\n                positionMs < 10_000\r\n            }\r\n\r\n            // éŸ³å£°ã®è¿½åŠ ãªã©\r\n            // MediaStore ã‚’ä½¿ã£ã¦ ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«è¿½åŠ ã™ã‚‹ã¨ã‹\r\n            Toast.makeText(this@MainActivity, \"çµ‚äº†ã—ã¾ã—ãŸ\", Toast.LENGTH_SHORT).show()\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n# MediaCodecã‚·ãƒªãƒ¼ã‚º\r\n\r\n- [å‹•ç”»ã‚’ã¤ãªã’ã‚‹](/posts/android_mediacodec_merge_video/)\r\n- [ãªã‚“ã¡ã‚ƒã£ã¦ãƒ©ã‚¤ãƒ–é…ä¿¡ã‚’ã™ã‚‹](/posts/android_standalone_webm_livestreaming/)\r\n- [å‹•ç”»ã®ä¸Šã«æ–‡å­—ã‚’é‡ã­ã‚‹](/posts/android_add_canvas_text_to_video/)\r\n    - ä»Šå›ã®è¨˜äº‹ã¯ã“ã‚Œã®ç¶šãã¿ãŸã„ãªã¨ã“ã‚ãŒã‚ã‚Šã¾ã™\r\n\r\n# Android ã§ Canvas ã‹ã‚‰å‹•ç”»ã‚’ä½œã‚‹ã«ã¯\r\n`MediaCodec`ã¨`OpenGL`ã‚’ä½¿ã†ã‹ã€é›£ã—ã„ã®ã‚’ç„¡ã—ã«ã—ã¦`MediaRecorder`ã¨`Surface#lockHardwareCanvas`ã‚’ä½¿ã†æ–¹æ³•ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n## MediaCodec + OpenGL\r\n- MediaCodec / MediaMuxer ã®ç”¨æ„ã‚’ã™ã‚‹\r\n- MediaCodec ã® Surface ã« OpenGL ã§æç”»ã™ã‚‹\r\n    - Surface ã¨ OpenGL ã®æ©‹æ¸¡ã—ã‚’ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ã¯æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ï¼ˆAOSPãã®ã¾ã¾ï¼‰\r\n- Canvas ã§æ›¸ã„ã¦ã€Bitmapã«ã—ã¦ã€ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦æç”»ã—ã¾ã™ã€‚\r\n    - OpenGL ã®ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚‚AOSPã‹ã‚‰å€Ÿã‚Šã¦ãã‚‹ã“ã¨ã«ã—ã¾ã™ï¼ˆãªã‚‰ãŠå‰ã¯ä½•ã‚’ã™ã‚‹ã‚“ã ï¼‰\r\n- MediaCodec ã‹ã‚‰å‡ºã¦ããŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’ MediaMuxer ã‚’ä½¿ã„ `mp4` ï¼ˆã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼‰ã«æ ¼ç´ã™ã‚‹\r\n\r\n`OpenGL`ã®ç”¨æ„ã¨ã€ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‚’æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ï¼ˆãŸã ã‚³ãƒ”ãƒšã§ãã‚‹ï¼‰ã®ã§ã€æ™®é€šã«é›£ã—ã„ã€‚  \r\nã‚ã¨ã‚„ã£ã±ã‚Šä½ãƒ¬ãƒ™ãƒ«APIãªã®ã§ã€`MediaRecorder`ã§ã¯å‡ºã¦ã“ãªã„`ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ ã‚„ã‚‰ ã‚³ãƒ³ãƒ†ãƒŠ ã‚„ã‚‰`ã¨å‘ãåˆã‚ãªã„ã¨ã„ã‘ãªã„ã€‚  \r\nãŒã€**ãŠãã‚‰ãæ­£è¦ãƒ«ãƒ¼ãƒˆæ„Ÿã¯ã‚ã‚‹**ã€‚ï¼ˆå¾Œè€…ã¯å‹•ã‹ãªã„ç«¯æœ«ãŒã‚ã‚‹ã‚‰ã—ã„ï¼‰\r\n\r\n## é›£ã—ã„ã®ã‚’ç„¡ã—ã«ã—ã¦ MediaRecorder + Surface#lockHardwareCanvas ã‚’ä½¿ã†\r\nã¨ã„ã†ã‹ `OpenGL` ã®ä»£ã‚ã‚Šã« `lockHardwareCanvas` ã‚’ä½¿ã†æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚Android 6 ä»¥ä¸Šãªã®ã§ã€ã¾ãé¸ã‚“ã§ã‚‚è‰¯ã„ã§ã—ã‚‡ã†\r\n\r\n- MediaRecorder ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n- MediaRecorder ã® Surface ã‚’å–å¾—ã™ã‚‹\r\n- Surface ã«ã‚ã‚‹ `lockHardwareCanvas` é–¢æ•°ã‚’å‘¼ã¶ã¨ `Canvas` ãŒè²°ãˆã‚‹ã®ã§ã€ã‚ˆã—ãªã«æ›¸ã\r\n- `unlockCanvasAndPost` ã®å¼•æ•°ã« `Canvas` ã‚’å…¥ã‚Œã‚‹\r\n\r\né«˜ãƒ¬ãƒ™ãƒ«APIã§ä¿å®ˆã—ã‚„ã™ãã†ï¼ï¼ï¼  \r\n`lockHardwareCanvas`ã‚’ä½¿ã‚ãªã„ã¨ã„ã‘ãªã„ã§ã™ï¼ˆãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã‚¢ã‚¯ã‚»ãƒ©ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¦ã„ãªã„ã¨ã ã‚ï¼‰  \r\nã¾ãŸã€ä¸€éƒ¨ã®ç«¯æœ«ã§ã¯ã“ã®æ–¹æ³•ãŒä½¿ãˆãªã„ã‚‰ã—ã„ï¼ˆä»¥ä¸‹ã® `Issue` å‚ç…§ã€å¤šåˆ† `OpenGL` ã‚’ä½¿ã†ã—ã‹ãªã•ãã†ï¼Ÿï¼‰  \r\nhttps://issuetracker.google.com/issues/111433520\r\n\r\n# ä½œã£ã¦ã¿ã‚‹\r\n`Android Studio` æ›´æ–°ã—ãŸã‚‰ `Empty Activity` ãŒ `JetpackCompose` ã«ãªã£ã¦ã‚‹ã€ã€  \r\né©å½“ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ãã ã•ã„ã€‚\r\n\r\n# MediaCodec + OpenGL ã‚’ä½¿ã†æ–¹æ³•\r\n- `MediaCodec`\r\n    - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ / ãƒ‡ã‚³ãƒ¼ãƒ‰ ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹\r\n    - H.264 / H.265 ã¨ã‹ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã§ãã‚‹\r\n        - ãƒ‘ãƒ©ãƒ‘ãƒ©æ¼«ç”»ã«ã™ã‚‹ã‚ˆã‚Šã‚‚å‹•ç”»ã«ã™ã‚‹ã»ã†ãŒå®¹é‡ãŒå°ã•ã„ã®ã¯ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãŒåœ§ç¸®ã—ã¦ãã‚Œã¦ã„ã‚‹ã‹ã‚‰\r\n    - ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå½¹ã«ç«‹ãŸãªã„\r\n- `MediaMuxer`\r\n    - ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹\r\n        - ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯éŸ³å£°ã¨æ˜ åƒã‚’ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã™ã‚‹ãŸã‚ã®æŠ€è¡“ï¼ˆ`mp4`ãªã©ï¼‰\r\n    - `MediaCodec`ã‹ã‚‰å‡ºã¦ããŸã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿ã‚’`mp4 (webM ã¨ã‹ã§ã‚‚å¯)`ã«æ ¼ç´ã™ã‚‹\r\n        - éŸ³å£°ã‚‚è¿½åŠ ã—ãŸã„å ´åˆã¯ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã‚Œã‚‹\r\n    - `addTrack`ã¯ ã‚¹ã‚¿ãƒ¼ãƒˆå‰ã«å‘¼ã¶å¿…è¦ãŒã‚ã‚‹\r\n\r\n## CanvasInputSurface\r\nAOSP ã®ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ãã®ã¾ã¾ã§ã™ï¼ˆå¤šåˆ† GLSurfaceView ã®å†…éƒ¨ã§ã‚„ã£ã¦ã„ã‚‹ã“ã¨ï¼‰  \r\nhttps://cs.android.com/android/platform/superproject/+/master:cts/tests/tests/media/common/src/android/media/cts/InputSurface.java\r\n\r\nâ†‘ ã® KotlinåŒ– ã¨è‹¥å¹²ã®ä¿®æ­£ãŒå…¥ã£ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚  \r\n\r\nã“ã‚Œã¯`ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ MediaCodec`ã®å…¥åŠ›ã«`OpenGL`ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã§ã™ã€‚ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚\r\n\r\n```kotlin\r\n/** MediaCodec ã® Surface ã¨ OpenGL ã®æ©‹æ¸¡ã—ã‚’ã™ã‚‹ */\r\nclass CanvasInputSurface(\r\n    private val surface: Surface,\r\n    private val textureRenderer: TextureRenderer,\r\n) {\r\n    private var mEGLDisplay = EGL14.EGL_NO_DISPLAY\r\n    private var mEGLContext = EGL14.EGL_NO_CONTEXT\r\n    private var mEGLSurface = EGL14.EGL_NO_SURFACE\r\n\r\n    init {\r\n        eglSetup()\r\n    }\r\n\r\n    fun createRender() {\r\n        textureRenderer.surfaceCreated()\r\n    }\r\n\r\n    /**\r\n     * Prepares EGL.  We want a GLES 2.0 context and a surface that supports recording.\r\n     */\r\n    private fun eglSetup() {\r\n        mEGLDisplay = EGL14.eglGetDisplay(EGL14.EGL_DEFAULT_DISPLAY)\r\n        if (mEGLDisplay == EGL14.EGL_NO_DISPLAY) {\r\n            throw RuntimeException(\"unable to get EGL14 display\")\r\n        }\r\n        val version = IntArray(2)\r\n        if (!EGL14.eglInitialize(mEGLDisplay, version, 0, version, 1)) {\r\n            throw RuntimeException(\"unable to initialize EGL14\")\r\n        }\r\n        // Configure EGL for recording and OpenGL ES 2.0.\r\n        val attribList = intArrayOf(\r\n            EGL14.EGL_RED_SIZE, 8,\r\n            EGL14.EGL_GREEN_SIZE, 8,\r\n            EGL14.EGL_BLUE_SIZE, 8,\r\n            EGL14.EGL_ALPHA_SIZE, 8,\r\n            EGL14.EGL_RENDERABLE_TYPE, EGL14.EGL_OPENGL_ES2_BIT,\r\n            EGL_RECORDABLE_ANDROID, 1,\r\n            EGL14.EGL_NONE\r\n        )\r\n        val configs = arrayOfNulls<EGLConfig>(1)\r\n        val numConfigs = IntArray(1)\r\n        EGL14.eglChooseConfig(mEGLDisplay, attribList, 0, configs, 0, configs.size, numConfigs, 0)\r\n        checkEglError(\"eglCreateContext RGB888+recordable ES2\")\r\n\r\n        // Configure context for OpenGL ES 2.0.\r\n        val attrib_list = intArrayOf(\r\n            EGL14.EGL_CONTEXT_CLIENT_VERSION, 2,\r\n            EGL14.EGL_NONE\r\n        )\r\n        mEGLContext = EGL14.eglCreateContext(\r\n            mEGLDisplay, configs[0], EGL14.EGL_NO_CONTEXT,\r\n            attrib_list, 0\r\n        )\r\n        checkEglError(\"eglCreateContext\")\r\n\r\n        // Create a window surface, and attach it to the Surface we received.\r\n        val surfaceAttribs = intArrayOf(\r\n            EGL14.EGL_NONE\r\n        )\r\n        mEGLSurface = EGL14.eglCreateWindowSurface(mEGLDisplay, configs[0], surface, surfaceAttribs, 0)\r\n        checkEglError(\"eglCreateWindowSurface\")\r\n    }\r\n\r\n    /**\r\n     * Canvasã«æç”»ã—ã¦OpenGLã«æç”»ã™ã‚‹\r\n     *\r\n     * @param onCanvasDrawRequest Canvasã‚’æ¸¡ã™ã®ã§æç”»ã—ã¦è¿”ã—ã¦ãã ã•ã„\r\n     */\r\n    fun drawCanvas(onCanvasDrawRequest: (Canvas) -> Unit) {\r\n        textureRenderer.prepareDraw()\r\n        textureRenderer.drawCanvas(onCanvasDrawRequest)\r\n        textureRenderer.invokeGlFinish()\r\n    }\r\n\r\n    /**\r\n     * Discards all resources held by this class, notably the EGL context.  Also releases the\r\n     * Surface that was passed to our constructor.\r\n     */\r\n    fun release() {\r\n        if (mEGLDisplay != EGL14.EGL_NO_DISPLAY) {\r\n            EGL14.eglMakeCurrent(mEGLDisplay, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_CONTEXT)\r\n            EGL14.eglDestroySurface(mEGLDisplay, mEGLSurface)\r\n            EGL14.eglDestroyContext(mEGLDisplay, mEGLContext)\r\n            EGL14.eglReleaseThread()\r\n            EGL14.eglTerminate(mEGLDisplay)\r\n        }\r\n        surface.release()\r\n        mEGLDisplay = EGL14.EGL_NO_DISPLAY\r\n        mEGLContext = EGL14.EGL_NO_CONTEXT\r\n        mEGLSurface = EGL14.EGL_NO_SURFACE\r\n    }\r\n\r\n    /**\r\n     * Makes our EGL context and surface current.\r\n     */\r\n    fun makeCurrent() {\r\n        EGL14.eglMakeCurrent(mEGLDisplay, mEGLSurface, mEGLSurface, mEGLContext)\r\n        checkEglError(\"eglMakeCurrent\")\r\n    }\r\n\r\n    /**\r\n     * Calls eglSwapBuffers.  Use this to \"publish\" the current frame.\r\n     */\r\n    fun swapBuffers(): Boolean {\r\n        val result = EGL14.eglSwapBuffers(mEGLDisplay, mEGLSurface)\r\n        checkEglError(\"eglSwapBuffers\")\r\n        return result\r\n    }\r\n\r\n    /**\r\n     * Sends the presentation time stamp to EGL.  Time is expressed in nanoseconds.\r\n     */\r\n    fun setPresentationTime(nsecs: Long) {\r\n        EGLExt.eglPresentationTimeANDROID(mEGLDisplay, mEGLSurface, nsecs)\r\n        checkEglError(\"eglPresentationTimeANDROID\")\r\n    }\r\n\r\n    /**\r\n     * Checks for EGL errors.  Throws an exception if one is found.\r\n     */\r\n    private fun checkEglError(msg: String) {\r\n        val error = EGL14.eglGetError()\r\n        if (error != EGL14.EGL_SUCCESS) {\r\n            throw RuntimeException(\"$msg: EGL error: 0x${Integer.toHexString(error)}\")\r\n        }\r\n    }\r\n\r\n    companion object {\r\n        private const val EGL_RECORDABLE_ANDROID = 0x3142\r\n    }\r\n}\r\n```\r\n\r\n## TextureRenderer\r\n`OpenGL`ã§`Canvas`ã‚’`Bitmap`ã«ã—ã¦ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦æç”»ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã€‚  \r\n`OpenGL`ã€ã€ä½•ã‚‚ã‚ã‹ã‚‰ã‚“ï¼ˆã‚¢ãƒ«ãƒ•ã‚¡ãƒ–ãƒ¬ãƒ³ãƒ‰è¨­å®šãŒæœ‰åŠ¹ã ã¨çœŸã£æš—ãªæ˜ åƒãŒå‡ºæ¥ãŸ...ï¼‰\r\n\r\n```kotlin\r\n/**\r\n * Canvas ã®å†…å®¹ã‚’ OpenGL ã§æç”»ã™ã‚‹ãŸã‚\r\n *\r\n * @param outputVideoWidth å‹•ç”»ã®å¹…\r\n * @param outputVideoHeight å‹•ç”»ã®é«˜ã•\r\n */\r\nclass TextureRenderer(\r\n    private val outputVideoWidth: Int,\r\n    private val outputVideoHeight: Int,\r\n) {\r\n\r\n    private var mTriangleVertices = ByteBuffer.allocateDirect(mTriangleVerticesData.size * FLOAT_SIZE_BYTES).run {\r\n        order(ByteOrder.nativeOrder())\r\n        asFloatBuffer().apply {\r\n            put(mTriangleVerticesData)\r\n            position(0)\r\n        }\r\n    }\r\n\r\n    private val mMVPMatrix = FloatArray(16)\r\n    private val mSTMatrix = FloatArray(16)\r\n\r\n    /** Canvasã§æ›¸ã„ãŸBitmapã€‚Canvasã®å†…å®¹ã‚’OpenGLã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã¨ã—ã¦åˆ©ç”¨ */\r\n    private val canvasBitmap by lazy { Bitmap.createBitmap(outputVideoWidth, outputVideoHeight, Bitmap.Config.ARGB_8888) }\r\n\r\n    /** Canvasã€‚ã“ã‚ŒãŒã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«è¡Œã */\r\n    private val canvas by lazy { Canvas(canvasBitmap) }\r\n\r\n    // ãƒãƒ³ãƒ‰ãƒ«ãŸã¡\r\n    private var mProgram = 0\r\n    private var muMVPMatrixHandle = 0\r\n    private var muSTMatrixHandle = 0\r\n    private var maPositionHandle = 0\r\n    private var maTextureHandle = 0\r\n    private var uCanvasTextureHandle = 0\r\n\r\n    /** ã‚­ãƒ£ãƒ³ãƒã‚¹ã®ç”»åƒã‚’æ¸¡ã™OpenGLã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ID */\r\n    private var canvasTextureID = -1\r\n\r\n    init {\r\n        Matrix.setIdentityM(mSTMatrix, 0)\r\n    }\r\n\r\n    /** æç”»å‰ã«å‘¼ã³å‡ºã™ */\r\n    fun prepareDraw() {\r\n        // glError 1282 ã®åŸå› ã¨ã‹ã«ãªã‚‹\r\n        GLES20.glUseProgram(mProgram)\r\n        checkGlError(\"glUseProgram\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_POS_OFFSET)\r\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maPosition\")\r\n        GLES20.glEnableVertexAttribArray(maPositionHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maPositionHandle\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_UV_OFFSET)\r\n        GLES20.glVertexAttribPointer(maTextureHandle, 2, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maTextureHandle\")\r\n        GLES20.glEnableVertexAttribArray(maTextureHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maTextureHandle\")\r\n\r\n        // Snapdragon ã ã¨ glClear ãŒç„¡ã„ã¨æ˜ åƒãŒä¹±ã‚Œã‚‹\r\n        GLES20.glClear(GLES20.GL_DEPTH_BUFFER_BIT or GLES20.GL_COLOR_BUFFER_BIT)\r\n    }\r\n\r\n    /**\r\n     * Canvas ã«æ›¸ã„ã¦ OpenGL ã§æç”»ã™ã‚‹ã€‚\r\n     * [drawFrame]ã®ã‚ã¨ã«å‘¼ã³å‡ºã™å¿…è¦ã‚ã‚Šã€‚\r\n     *\r\n     * @param onCanvasDrawRequest Canvasã‚’æ¸¡ã™ã®ã§æç”»ã—ã¦è¿”ã—ã¦ãã ã•ã„\r\n     */\r\n    fun drawCanvas(onCanvasDrawRequest: (Canvas) -> Unit) {\r\n        checkGlError(\"drawCanvas start\")\r\n        // ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’Canvasã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã«åˆ‡ã‚Šæ›¿ãˆã‚‹\r\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£è¨­å®š\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)\r\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, canvasTextureID)\r\n        // ç¸®å°æ‹¡å¤§æ™‚ã®è£œé–“è¨­å®š\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)\r\n        // å‰å›ã®ã‚’æ¶ˆã™\r\n        canvas.drawColor(0, PorterDuff.Mode.CLEAR)\r\n        // Canvasã§æ›¸ã\r\n        onCanvasDrawRequest(canvas)\r\n        // glActiveTexture ã—ãŸãƒ†ã‚¯ã‚¹ãƒãƒ£ã¸Canvasã§æ›¸ã„ãŸç”»åƒã‚’è»¢é€ã™ã‚‹\r\n        // æ›´æ–°ãªã®ã§ texSubImage2D\r\n        GLUtils.texSubImage2D(GLES20.GL_TEXTURE_2D, 0, 0, 0, canvasBitmap)\r\n        checkGlError(\"GLUtils.texSubImage2D canvasTextureID\")\r\n        // Uniform å¤‰æ•°ã¸ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’è¨­å®š\r\n        // ç¬¬äºŒå¼•æ•°ã¯ GLES20.GL_TEXTURE0 ãªã®ã§ 0\r\n        GLES20.glUniform1i(uCanvasTextureHandle, 0)\r\n        checkGlError(\"glUniform1i uCanvasTextureHandle\")\r\n        // ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã®èª¿æ•´ã¯ã„ã‚‰ãªã„ã®ã§ãƒªã‚»ãƒƒãƒˆï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®å‡ºåŠ›ã‚µã‚¤ã‚ºã«Canvasã‚’åˆã‚ã›ã¦ä½œã£ã¦ã„ã‚‹ãŸã‚ï¼‰\r\n        Matrix.setIdentityM(mMVPMatrix, 0)\r\n        // ãã‚Œã¨ã¯åˆ¥ã«ã€OpenGLã®ç”»åƒã¯åŸç‚¹ãŒå·¦ä¸‹ãªã®ã§ï¼ˆæ™®é€šã¯å·¦ä¸Šï¼‰ã€è¡Œåˆ—ã‚’åè»¢ã•ã›ã‚‹\r\n        // ã™ã„ã¾ã›ã‚“ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ã€‚\r\n        Matrix.setIdentityM(mSTMatrix, 0)\r\n        Matrix.scaleM(mSTMatrix, 0, 1f, -1f, 1f)\r\n        // æç”»ã™ã‚‹\r\n        GLES20.glUniformMatrix4fv(muSTMatrixHandle, 1, false, mSTMatrix, 0)\r\n        GLES20.glUniformMatrix4fv(muMVPMatrixHandle, 1, false, mMVPMatrix, 0)\r\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4)\r\n        checkGlError(\"glDrawArrays Canvas\")\r\n    }\r\n\r\n    /** glFinish ã‚’ã‚ˆã³ã ã™ */\r\n    fun invokeGlFinish() {\r\n        GLES20.glFinish()\r\n    }\r\n\r\n    fun surfaceCreated() {\r\n        mProgram = createProgram(VERTEX_SHADER, FRAGMENT_SHADER)\r\n        if (mProgram == 0) {\r\n            throw RuntimeException(\"failed creating program\")\r\n        }\r\n        maPositionHandle = GLES20.glGetAttribLocation(mProgram, \"aPosition\")\r\n        checkGlError(\"glGetAttribLocation aPosition\")\r\n        if (maPositionHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for aPosition\")\r\n        }\r\n        maTextureHandle = GLES20.glGetAttribLocation(mProgram, \"aTextureCoord\")\r\n        checkGlError(\"glGetAttribLocation aTextureCoord\")\r\n        if (maTextureHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for aTextureCoord\")\r\n        }\r\n        muMVPMatrixHandle = GLES20.glGetUniformLocation(mProgram, \"uMVPMatrix\")\r\n        checkGlError(\"glGetUniformLocation uMVPMatrix\")\r\n        if (muMVPMatrixHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uMVPMatrix\")\r\n        }\r\n        muSTMatrixHandle = GLES20.glGetUniformLocation(mProgram, \"uSTMatrix\")\r\n        checkGlError(\"glGetUniformLocation uSTMatrix\")\r\n        if (muSTMatrixHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uSTMatrix\")\r\n        }\r\n        uCanvasTextureHandle = GLES20.glGetUniformLocation(mProgram, \"uCanvasTexture\")\r\n\r\n        // Canvas ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ID ã‚’æ‰•ã„å‡ºã—ã¦ã‚‚ã‚‰ã†\r\n        val textures = IntArray(1)\r\n        GLES20.glGenTextures(1, textures, 0)\r\n\r\n        // Canvasãƒ†ã‚¯ã‚¹ãƒãƒ£\r\n        canvasTextureID = textures[0]\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)\r\n        GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, canvasTextureID)\r\n        checkGlError(\"glBindTexture canvasTextureID\")\r\n\r\n        // ç¸®å°æ‹¡å¤§æ™‚ã®è£œé–“è¨­å®š\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_LINEAR)\r\n        GLES20.glTexParameteri(GLES20.GL_TEXTURE_2D, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR)\r\n\r\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’åˆæœŸåŒ–\r\n        // æ›´æ–°ã®éš›ã¯ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆãŸä¸Šã§ texSubImage2D ã‚’ä½¿ã†\r\n        GLUtils.texImage2D(GLES20.GL_TEXTURE_2D, 0, canvasBitmap, 0)\r\n        checkGlError(\"glTexParameter canvasTextureID\")\r\n    }\r\n\r\n    private fun loadShader(shaderType: Int, source: String): Int {\r\n        var shader = GLES20.glCreateShader(shaderType)\r\n        checkGlError(\"glCreateShader type=$shaderType\")\r\n        GLES20.glShaderSource(shader, source)\r\n        GLES20.glCompileShader(shader)\r\n        val compiled = IntArray(1)\r\n        GLES20.glGetShaderiv(shader, GLES20.GL_COMPILE_STATUS, compiled, 0)\r\n        if (compiled[0] == 0) {\r\n            GLES20.glDeleteShader(shader)\r\n            shader = 0\r\n        }\r\n        return shader\r\n    }\r\n\r\n    private fun createProgram(vertexSource: String, fragmentSource: String): Int {\r\n        val vertexShader = loadShader(GLES20.GL_VERTEX_SHADER, vertexSource)\r\n        if (vertexShader == 0) {\r\n            return 0\r\n        }\r\n        val pixelShader = loadShader(GLES20.GL_FRAGMENT_SHADER, fragmentSource)\r\n        if (pixelShader == 0) {\r\n            return 0\r\n        }\r\n        var program = GLES20.glCreateProgram()\r\n        checkGlError(\"glCreateProgram\")\r\n        if (program == 0) {\r\n            return 0\r\n        }\r\n        GLES20.glAttachShader(program, vertexShader)\r\n        checkGlError(\"glAttachShader\")\r\n        GLES20.glAttachShader(program, pixelShader)\r\n        checkGlError(\"glAttachShader\")\r\n        GLES20.glLinkProgram(program)\r\n        val linkStatus = IntArray(1)\r\n        GLES20.glGetProgramiv(program, GLES20.GL_LINK_STATUS, linkStatus, 0)\r\n        if (linkStatus[0] != GLES20.GL_TRUE) {\r\n            GLES20.glDeleteProgram(program)\r\n            program = 0\r\n        }\r\n        return program\r\n    }\r\n\r\n    private fun checkGlError(op: String) {\r\n        val error = GLES20.glGetError()\r\n        if (error != GLES20.GL_NO_ERROR) {\r\n            throw RuntimeException(\"$op: glError $error\")\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        private val mTriangleVerticesData = floatArrayOf(\r\n            -1.0f, -1.0f, 0f, 0f, 0f,\r\n            1.0f, -1.0f, 0f, 1f, 0f,\r\n            -1.0f, 1.0f, 0f, 0f, 1f,\r\n            1.0f, 1.0f, 0f, 1f, 1f\r\n        )\r\n\r\n        private const val FLOAT_SIZE_BYTES = 4\r\n        private const val TRIANGLE_VERTICES_DATA_STRIDE_BYTES = 5 * FLOAT_SIZE_BYTES\r\n        private const val TRIANGLE_VERTICES_DATA_POS_OFFSET = 0\r\n        private const val TRIANGLE_VERTICES_DATA_UV_OFFSET = 3\r\n\r\n        /** ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã€‚åº§æ¨™ãªã©ã‚’æ±ºã‚ã‚‹ */\r\n        private const val VERTEX_SHADER = \"\"\"\r\n            uniform mat4 uMVPMatrix;\r\n            uniform mat4 uSTMatrix;\r\n            attribute vec4 aPosition;\r\n            attribute vec4 aTextureCoord;\r\n            varying vec2 vTextureCoord;\r\n            \r\n            void main() {\r\n              gl_Position = uMVPMatrix * aPosition;\r\n              vTextureCoord = (uSTMatrix * aTextureCoord).xy;\r\n            }\r\n        \"\"\"\r\n\r\n        /** ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã€‚å®Ÿéš›ã®è‰²ã‚’è¿”ã™ */\r\n        private const val FRAGMENT_SHADER = \"\"\"\r\n            #extension GL_OES_EGL_image_external : require\r\n\r\n            precision mediump float;\r\n            varying vec2 vTextureCoord;\r\n            uniform sampler2D uCanvasTexture;\r\n        \r\n            void main() {\r\n                gl_FragColor = texture2D(uCanvasTexture, vTextureCoord);\r\n            }\r\n        \"\"\"\r\n    }\r\n}\r\n```\r\n\r\n## CanvasProcessor\r\nã“ã‚ŒãŒ`Canvas`ã‹ã‚‰å‹•ç”»ã«ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã§ã™ã­ã€‚  \r\nè¨˜äº‹å†’é ­ã«æ›¸ã„ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨åŒã˜ã‚„ã¤ã§ã™ã€‚  \r\n\r\n- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ï¼ˆ`MediaCodec`ï¼‰ã‚’ç”¨æ„\r\n- `OpenGL`ã®ç”¨æ„\r\n- ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’é–‹å§‹ã—\r\n- çµ‚ã‚ã‚‹ã¾ã§ä»¥ä¸‹ã®ä½œæ¥­ã‚’ãƒ«ãƒ¼ãƒ—\r\n    - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‹ã‚‰ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚Œã°å–ã‚Šå‡ºã™\r\n        - `MediaMuxer`ã«å…¥ã‚Œã¦ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ ¼ç´\r\n            - `MediaMuxer`ã«å§‹ã‚ã¦ã„ã‚Œã‚‹å ´åˆã¯`addTrack`ã™ã‚‹ï¼ˆãŠãã‚‰ãã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Šã‚‚å…ˆã«å‘¼ã°ã‚Œã‚‹ï¼‰\r\n    - `Canvas` ã«å¥½ããªã‚ˆã†ã«æã\r\n        - é–¢æ•°ã‚’å¼•æ•°ã«ã—ã¦ã„ã‚‹ã®ã§ã€å‘¼ã³å‡ºã—å´ã§å¥½ããªã‚ˆã†ã«æã‘ã¾ã™\r\n    - `OpenGL`ã§æç”»ã—ã€`swapBuffers`ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã™ï¼Ÿ\r\n    - ã‚‚ã†æç”»ã—ãªã„å ´åˆã¯ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹\r\n- å¾Œç‰‡ä»˜ã‘\r\n\r\nå¤šåˆ†ä»–ã®`MediaCodecã‚·ãƒªãƒ¼ã‚º`ã¨åŒã˜ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã ã¨æ€ã†ã€‚\r\n\r\n```kotlin\r\n/** Canvas ã‹ã‚‰å‹•ç”»ã‚’ä½œã‚‹ */\r\nobject CanvasProcessor {\r\n\r\n    /** ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n    private const val TIMEOUT_US = 10000L\r\n\r\n    /** ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ãŒç©ºã®å ´åˆ */\r\n    private const val UNDEFINED_TRACK_INDEX = -1\r\n\r\n    /**\r\n     * å‡¦ç†ã‚’é–‹å§‹ã™ã‚‹\r\n     *\r\n     * @param resultFile ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å…ˆã®ãƒ•ã‚¡ã‚¤ãƒ«\r\n     * @param videoCodec å‹•ç”»ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\n     * @param containerFormat ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\r\n     * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ\r\n     * @param frameRate ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ\r\n     * @param outputVideoWidth å‹•ç”»ã®é«˜ã•\r\n     * @param outputVideoHeight å‹•ç”»ã®å¹…\r\n     * @param onCanvasDrawRequest Canvasã®æç”»ãŒå¿…è¦ã«ãªã£ãŸã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚trueã‚’è¿”ã—ã¦ã„ã‚‹é–“ã€å‹•ç”»ã‚’ä½œæˆã™ã‚‹\r\n     */\r\n    suspend fun start(\r\n        resultFile: File,\r\n        videoCodec: String = MediaFormat.MIMETYPE_VIDEO_AVC,\r\n        containerFormat: Int = MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4,\r\n        bitRate: Int = 1_000_000,\r\n        frameRate: Int = 30,\r\n        outputVideoWidth: Int = 1280,\r\n        outputVideoHeight: Int = 720,\r\n        onCanvasDrawRequest: Canvas.(positionMs: Long) -> Boolean,\r\n    ) = withContext(Dispatchers.Default) {\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ -> H.264ï¼‰MediaCodec\r\n        val encodeMediaCodec = MediaCodec.createEncoderByType(videoCodec).apply {\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«ã‚»ãƒƒãƒˆã™ã‚‹MediaFormat\r\n            // ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚Œã°ãã£ã¡ã‚’ä½¿ã†\r\n            val videoMediaFormat = MediaFormat.createVideoFormat(videoCodec, outputVideoWidth, outputVideoHeight).apply {\r\n                setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n                setInteger(MediaFormat.KEY_FRAME_RATE, frameRate)\r\n                setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 1)\r\n                setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface)\r\n            }\r\n            configure(videoMediaFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®Surfaceã‚’å–å¾—ã—ã¦ã€OpenGLã‚’åˆ©ç”¨ã—ã¦Canvasã‚’é‡ã­ã¾ã™\r\n        val canvasInputSurface = CanvasInputSurface(\r\n            encodeMediaCodec.createInputSurface(),\r\n            TextureRenderer(\r\n                outputVideoWidth = outputVideoWidth,\r\n                outputVideoHeight = outputVideoHeight\r\n            )\r\n        )\r\n        // OpenGL\r\n        canvasInputSurface.makeCurrent()\r\n        encodeMediaCodec.start()\r\n        canvasInputSurface.createRender()\r\n\r\n        // ä¿å­˜å…ˆ\r\n        var videoTrackIndex = UNDEFINED_TRACK_INDEX\r\n        val mediaMuxer = MediaMuxer(resultFile.path, containerFormat)\r\n\r\n        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n        var outputDone = false\r\n        val startMs = System.currentTimeMillis()\r\n\r\n        while (!outputDone) {\r\n\r\n            // ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ™‚ã¯å¼·åˆ¶çµ‚äº†\r\n            if (!isActive) break\r\n\r\n            // SurfaceçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ã‚’è²°ã£ã¦ä¿å­˜ã™ã‚‹\r\n            val encoderStatus = encodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n            if (encoderStatus >= 0) {\r\n                val encodedData = encodeMediaCodec.getOutputBuffer(encoderStatus)!!\r\n                if (bufferInfo.size > 1) {\r\n                    if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_CODEC_CONFIG == 0) {\r\n                        // MediaMuxer ã¸ addTrack ã—ãŸå¾Œ\r\n                        mediaMuxer.writeSampleData(videoTrackIndex, encodedData, bufferInfo)\r\n                    }\r\n                }\r\n                encodeMediaCodec.releaseOutputBuffer(encoderStatus, false)\r\n            } else if (encoderStatus == MediaCodec.INFO_OUTPUT_FORMAT_CHANGED) {\r\n                // MediaMuxerã¸æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹ã®ã¯ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã†\r\n                // ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚„ã‚‹ã¨å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚ŒãŸMediaFormatãŒæ‰‹ã«å…¥ã‚‹(csd-0 ã¨ã‹)\r\n                // æ˜ åƒãŒã¶ã£å£Šã‚Œã¦ã„ã‚‹å ´åˆï¼ˆç·‘ã§å¡—ã‚Šã¤ã¶ã•ã‚Œã¦ã‚‹ã¨ã‹ï¼‰ã¯å¤šåˆ†ã“ã®ã‚ãŸã‚ŠãŒæ€ªã—ã„\r\n                val newFormat = encodeMediaCodec.outputFormat\r\n                videoTrackIndex = mediaMuxer.addTrack(newFormat)\r\n                mediaMuxer.start()\r\n            }\r\n            if (encoderStatus != MediaCodec.INFO_TRY_AGAIN_LATER) {\r\n                continue\r\n            }\r\n            // OpenGLã§æç”»ã™ã‚‹\r\n            // Canvas ã®å…¥åŠ›ã‚’ã™ã‚‹\r\n            val presentationTimeUs = (System.currentTimeMillis() - startMs) * 1000\r\n            var isRunning = false\r\n            canvasInputSurface.drawCanvas { canvas ->\r\n                isRunning = onCanvasDrawRequest(canvas, presentationTimeUs / 1000L)\r\n            }\r\n            canvasInputSurface.setPresentationTime(presentationTimeUs * 1000)\r\n            canvasInputSurface.swapBuffers()\r\n            if (!isRunning) {\r\n                outputDone = true\r\n                encodeMediaCodec.signalEndOfInputStream()\r\n            }\r\n        }\r\n\r\n        // OpenGLé–‹æ”¾\r\n        canvasInputSurface.release()\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n        encodeMediaCodec.stop()\r\n        encodeMediaCodec.release()\r\n        // MediaMuxerã‚‚çµ‚äº†\r\n        mediaMuxer.stop()\r\n        mediaMuxer.release()\r\n    }\r\n}\r\n```\r\n\r\n## MainActivity\r\nå‘¼ã³å‡ºã—å´ã§`Canvas`ã«ãŠçµµã‹ãã‚’ã—ã¾ã™  \r\n`Jetpack Compose`ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ãŸãŸã‚ã«ä½¿ã£ã¦ã¾ã™ãŒã€åˆ¥ã«ä½¿ã†å¿…è¦ã¯ãªã„ã§ã™  \r\nï¼ˆã‚€ã—ã‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã¯æ™‚é–“ãŒã‹ã‹ã‚‹ã®ã§`Acitivty`ã§ã¯ãªãã€`Foreground Service`ãªã©ã«ã‚„ã‚‰ã›ã‚‹ã¹ãã§ã™ã€‚ï¼‰  \r\n\r\nã¾ãƒ¼ã§ã‚‚è¨˜äº‹ã‚’æ›¸ãå´ã¨ã—ã¦ã¯ã€`xml`å´ã®ã‚³ãƒ¼ãƒ‰ã‚’ã‚ã–ã‚ã–è¼‰ã›ãªãã¦ã‚‚ã€ä¸€ã¤ã®`kt`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨˜äº‹ã«ä¹—ã›ã¦ãŠã‘ã°è‰¯ã„ã¨ã„ã†ã®ã¯çµæ§‹è‰¯ã„ã§ã™ã­ã€‚\r\n\r\nä¿å­˜å…ˆã§ã™ãŒã€`getExternalFilesDir`ãªã®ã§ã€`/sdcard/Android/data/{ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ID}/files`ã®ä¸­ã«ã‚ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            CanvasToVideoTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(modifier = Modifier.fillMaxSize(), color = MaterialTheme.colorScheme.background) {\r\n                    MainScreen()\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// TODO åˆ¥ã« Compose ã‚’ä½¿ã†å¿…è¦ã¯ãªã„ã€‚\r\n@Composable\r\nfun MainScreen() {\r\n    val isRunning = remember { mutableStateOf(false) }\r\n    val context = LocalContext.current\r\n\r\n    LaunchedEffect(key1 = Unit) {\r\n        // é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ\r\n        val resultFile = context.getExternalFilesDir(null)?.resolve(\"${System.currentTimeMillis()}.mp4\") ?: return@LaunchedEffect\r\n        val outlinePaint = Paint().apply {\r\n            color = Color.BLACK\r\n            style = Paint.Style.STROKE\r\n            textSize = 80f\r\n        }\r\n        val innerPaint = Paint().apply {\r\n            style = Paint.Style.FILL\r\n            color = Color.WHITE\r\n            textSize = 80f\r\n        }\r\n        isRunning.value = true\r\n        CanvasProcessor.start(resultFile) { positionMs ->\r\n            // this ã¯ Canvas\r\n            drawColor(Color.LTGRAY)\r\n            // positionMs ã¯ç¾åœ¨ã®å‹•ç”»ã®æ™‚é–“\r\n            val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(positionMs / 1000f)}\"\r\n            // æ å–ã‚Šæ–‡å­—\r\n            drawText(text, 0f, 80f, outlinePaint)\r\n            // æ ç„¡ã—æ–‡å­—\r\n            drawText(text, 0f, 80f, innerPaint)\r\n            // true ã‚’è¿”ã—ã¦ã„ã‚‹é–“ã¯å‹•ç”»ã‚’ä½œæˆã™ã‚‹ã€‚ã¨ã‚Šã‚ãˆãš 10 ç§’\r\n            positionMs < 10_000\r\n        }\r\n        isRunning.value = false\r\n    }\r\n\r\n    Text(text = if (isRunning.value) \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ã§ã™\" else \"çµ‚ã‚ã‚Šã¾ã—ãŸ\")\r\n\r\n}\r\n```\r\n\r\nä¿å­˜å…ˆâ†“  \r\n`Android`æ¨™æº–ã®ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ï¼ˆFiles by Google ã®äº‹ã§ã¯ãªã„ï¼‰ `com.android.documentsui` ã®æ–¹ã®ã‚¢ãƒ—ãƒªã‚’ä½¿ã†ã“ã¨ã§å¤šåˆ† `/sdcard/Android/data` ã‚’é–‹ãã“ã¨ãŒå‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\nï¼ˆãŸã ãƒ›ãƒ¼ãƒ ç”»é¢ã«ã‚¢ã‚¤ã‚³ãƒ³ãŒãªã„ã®ã§ã€`Intent`ã‚’æŠ•ã’ã‚‹ã‚¢ãƒ—ãƒªãŒåˆ¥é€”å¿…è¦ï¼ˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œã‚Œã‚‹ã‚¢ãƒ—ãƒªãªã©ï¼‰ï¼‰  \r\nã¾ãŸ`X-plore`ã§ã‚‚æ¨©é™ã‚’æ¸¡ã™ã“ã¨ã§è¦‹ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/lZsG3in.png)\r\n\r\nã©ã†ã§ã—ã‚‡ã†ã€å‹•ç”»ã¡ã‚ƒã‚“ã¨å‡ºæ¥ã¦ã„ã¾ã™ã‹ï¼ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/ZMv4zcq.png)\r\n\r\n\r\n# ã‚‚ã†ä¸€ã¤ã® MediaRecorder + lockHardwareCanvas ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•\r\nã“ã£ã¡ã¯é«˜ãƒ¬ãƒ™ãƒ«APIãªã®ã§ã€é›£ã—ã„ã“ã¨ã¯ç„¡ã„ã¨æ€ã†ã€‚\r\n\r\n## CanvasProcessorHighLevelApi\r\nå‘½åã‚»ãƒ³ã‚¹ãŒçµ‚ã‚ã£ã¦ã„ã‚‹ã€‚`OpenGL`ç‰ˆã‚’ã‚‚ã¨ã«ä½œã‚Šã¾ã—ãŸã€‚åˆã£ã¦ã‚‹ã‹ã¯ã‚ã‹ã‚‰ãªã„ã§ã™ã€‚  \r\nã‚³ãƒ¼ãƒ‰ã‚’è¦‹ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ãªã‚“ã§ã™ãŒã€`MediaRecorder`ã¨`Canvas`ã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚`OpenGL`ã¨`MediaCodec / MediaMuxer`ã®é›£ã—ã„ã‚³ãƒ¼ãƒ‰ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚  \r\n\r\n```kotlin\r\n/** OpenGL ã¨ MediaCodec ã‚’ä½¿ã‚ãšã« [CanvasProcessor] ã‚’ã™ã‚‹ */\r\n@RequiresApi(Build.VERSION_CODES.M)\r\nobject CanvasProcessorHighLevelApi {\r\n\r\n    /**\r\n     * å‡¦ç†ã‚’é–‹å§‹ã™ã‚‹\r\n     *\r\n     * @param context [Context]\r\n     * @param resultFile ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å…ˆã®ãƒ•ã‚¡ã‚¤ãƒ«\r\n     * @param videoCodec å‹•ç”»ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\n     * @param containerFormat ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\r\n     * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ\r\n     * @param frameRate ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ\r\n     * @param outputVideoWidth å‹•ç”»ã®é«˜ã•\r\n     * @param outputVideoHeight å‹•ç”»ã®å¹…\r\n     * @param onCanvasDrawRequest Canvasã®æç”»ãŒå¿…è¦ã«ãªã£ãŸã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ã€‚trueã‚’è¿”ã—ã¦ã„ã‚‹é–“ã€å‹•ç”»ã‚’ä½œæˆã™ã‚‹\r\n     */\r\n    suspend fun start(\r\n        context: Context,\r\n        resultFile: File,\r\n        videoCodec: Int = MediaRecorder.VideoEncoder.H264,\r\n        containerFormat: Int = MediaRecorder.OutputFormat.MPEG_4,\r\n        bitRate: Int = 1_000_000,\r\n        frameRate: Int = 30,\r\n        outputVideoWidth: Int = 1280,\r\n        outputVideoHeight: Int = 720,\r\n        onCanvasDrawRequest: Canvas.(positionMs: Long) -> Boolean,\r\n    ) = withContext(Dispatchers.Default) {\r\n        val mediaRecorder = (if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) MediaRecorder(context) else MediaRecorder()).apply {\r\n            // ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã«ã¯é †ç•ªãŒã‚ã‚Šã¾ã™\r\n            setVideoSource(MediaRecorder.VideoSource.SURFACE)\r\n            setOutputFormat(containerFormat)\r\n            setVideoEncoder(videoCodec)\r\n            setVideoEncodingBitRate(bitRate)\r\n            setVideoFrameRate(frameRate)\r\n            setVideoSize(outputVideoWidth, outputVideoHeight)\r\n            setAudioEncodingBitRate(128_000)\r\n            setAudioSamplingRate(44_100)\r\n            setOutputFile(resultFile.path)\r\n            prepare()\r\n        }\r\n        val inputSurface = mediaRecorder.surface\r\n        val startTime = System.currentTimeMillis()\r\n        mediaRecorder.start()\r\n        while (isActive) {\r\n            val positionMs = System.currentTimeMillis() - startTime\r\n            val canvas = inputSurface.lockHardwareCanvas()\r\n            val isRunning = onCanvasDrawRequest(canvas, positionMs)\r\n            inputSurface.unlockCanvasAndPost(canvas)\r\n            if (!isRunning) {\r\n                break\r\n            }\r\n        }\r\n        mediaRecorder.stop()\r\n        mediaRecorder.release()\r\n    }\r\n}\r\n```\r\n\r\n## MainActivity\r\nå‘¼ã³å‡ºã—å´ã‚‚ã‚ã‚“ã¾ã‚Šå¤‰ã‚ã£ã¦ãªã„ã§ã™ã€‚  \r\nï¼ˆ`Context`ãŒå¿…è¦ã«ãªã£ãŸãã‚‰ã„ã§ã€APIã¯ã ã„ãŸã„åŒã˜ï¼‰\r\n\r\nãŸã ã€ç§ã®ä½œã‚ŠãŒæ‚ªã„ã®ã‹ã€å°‘ã—ãšã¤æ™‚é–“ãŒãšã‚Œã¦ã„ã£ã¦ã„ã‚‹æ°—ãŒã—ã¾ã™ã€ã€ã€æ”¹å–„ã—ãŸã»ã†ãŒè‰¯ã•ãã†ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            CanvasToVideoTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(modifier = Modifier.fillMaxSize(), color = MaterialTheme.colorScheme.background) {\r\n                    MainScreen()\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// TODO åˆ¥ã« Compose ã‚’ä½¿ã†å¿…è¦ã¯ãªã„ã€‚\r\n@Composable\r\nfun MainScreen() {\r\n    val isRunning = remember { mutableStateOf(false) }\r\n    val context = LocalContext.current\r\n\r\n    LaunchedEffect(key1 = Unit) {\r\n        // é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ\r\n        val resultFile = context.getExternalFilesDir(null)?.resolve(\"${System.currentTimeMillis()}.mp4\") ?: return@LaunchedEffect\r\n        val outlinePaint = Paint().apply {\r\n            color = Color.BLACK\r\n            style = Paint.Style.STROKE\r\n            textSize = 80f\r\n        }\r\n        val innerPaint = Paint().apply {\r\n            style = Paint.Style.FILL\r\n            color = Color.WHITE\r\n            textSize = 80f\r\n        }\r\n        isRunning.value = true\r\n        CanvasProcessorHighLevelApi.start(context, resultFile) { positionMs ->\r\n            // this ã¯ Canvas\r\n            drawColor(Color.LTGRAY)\r\n            // positionMs ã¯ç¾åœ¨ã®å‹•ç”»ã®æ™‚é–“\r\n            val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(positionMs / 1000f)}\"\r\n            // æ å–ã‚Šæ–‡å­—\r\n            drawText(text, 0f, 80f, outlinePaint)\r\n            // æ ç„¡ã—æ–‡å­—\r\n            drawText(text, 0f, 80f, innerPaint)\r\n            // true ã‚’è¿”ã—ã¦ã„ã‚‹é–“ã¯å‹•ç”»ã‚’ä½œæˆã™ã‚‹ã€‚ã¨ã‚Šã‚ãˆãš 10 ç§’\r\n            positionMs < 10_000\r\n        }\r\n        isRunning.value = false\r\n    }\r\n\r\n    Text(text = if (isRunning.value) \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ã§ã™\" else \"çµ‚ã‚ã‚Šã¾ã—ãŸ\")\r\n\r\n}\r\n```\r\n\r\nAPI ã¯ã ã„ãŸã„åŒã˜ãªã®ã§ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å®Ÿè¡Œæ™‚ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã¿ãŸã„ãªã“ã¨ã‚‚å‡ºæ¥ã‚‹ã¨æ€ã„ã¾ã™ï¼ˆèª°å¾—ï¼Ÿï¼‰\r\n\r\n```kotlin\r\n// CanvasProcessor / CanvasProcessorHighLevelApi ã©ã£ã¡ã‚’ä½¿ã†ã‹\r\nval isUseLowLevelApi = true\r\n// æç”»æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°\r\nval onCanvasDrawRequest: Canvas.(Long) -> Boolean = { positionMs ->\r\n    // this ã¯ Canvas\r\n    drawColor(Color.LTGRAY)\r\n    // positionMs ã¯ç¾åœ¨ã®å‹•ç”»ã®æ™‚é–“\r\n    val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(positionMs / 1000f)}\"\r\n    // æ å–ã‚Šæ–‡å­—\r\n    drawText(text, 0f, 80f, outlinePaint)\r\n    // æ ç„¡ã—æ–‡å­—\r\n    drawText(text, 0f, 80f, innerPaint)\r\n    // true ã‚’è¿”ã—ã¦ã„ã‚‹é–“ã¯å‹•ç”»ã‚’ä½œæˆã™ã‚‹ã€‚ã¨ã‚Šã‚ãˆãš 10 ç§’\r\n    positionMs < 10_000\r\n}\r\nif (isUseLowLevelApi) {\r\n    CanvasProcessor.start(resultFile, onCanvasDrawRequest = onCanvasDrawRequest)\r\n} else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n    CanvasProcessorHighLevelApi.start(context, resultFile, onCanvasDrawRequest = onCanvasDrawRequest)\r\n}\r\n```\r\n\r\n# ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã—ã¦æ¬²ã—ã„\r\nã“ã®ã¾ã¾ã ã¨æ¯å›ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã‚’é–‹ã‹ãªã„ã¨ã„ã‘ãªã„ã®ã§ã€ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ï¼ˆ`/sdcard/Movies`ï¼‰ã«ç§»å‹•ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚  \r\nã“ã“ã«ç§»å‹•ã™ã‚‹ã“ã¨ã§ã€Googleãƒ•ã‚©ãƒˆç­‰ã®å†™çœŸãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼ã§è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n```kotlin\r\nobject MediaStoreTool {\r\n\r\n    /**\r\n     * ç«¯æœ«ã®å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¸ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n     *\r\n     * @param context [Context]\r\n     * @param file ã‚³ãƒ”ãƒ¼ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\r\n     */\r\n    suspend fun copyToMovieFolder(\r\n        context: Context,\r\n        file: File\r\n    ) = withContext(Dispatchers.IO) {\r\n        val contentValues = contentValuesOf(\r\n            MediaStore.MediaColumns.DISPLAY_NAME to file.name,\r\n            // RELATIVE_PATHï¼ˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ã‚‹ï¼‰ ã¯ Android 10 ä»¥é™ã®ã¿ã§ã™\r\n            MediaStore.MediaColumns.RELATIVE_PATH to \"${Environment.DIRECTORY_MOVIES}/CanvasToVideo\"\r\n        )\r\n        val uri = context.contentResolver.insert(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, contentValues) ?: return@withContext\r\n        context.contentResolver.openOutputStream(uri)?.use { outputStream ->\r\n            file.inputStream().use { inputStream ->\r\n                inputStream.copyTo(outputStream)\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nã“ã‚Œã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®ä¸‹ã«æã‘ã°è‰¯ã„ã¯ãš\r\n\r\n```kotlin\r\n// TODO åˆ¥ã« Compose ã‚’ä½¿ã†å¿…è¦ã¯ãªã„ã€‚\r\n@Composable\r\nfun MainScreen() {\r\n    val isRunning = remember { mutableStateOf(false) }\r\n    val context = LocalContext.current\r\n\r\n    LaunchedEffect(key1 = Unit) {\r\n        // é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ\r\n        val resultFile = context.getExternalFilesDir(null)?.resolve(\"${System.currentTimeMillis()}.mp4\") ?: return@LaunchedEffect\r\n        val outlinePaint = Paint().apply {\r\n            color = Color.BLACK\r\n            style = Paint.Style.STROKE\r\n            textSize = 80f\r\n        }\r\n        val innerPaint = Paint().apply {\r\n            style = Paint.Style.FILL\r\n            color = Color.WHITE\r\n            textSize = 80f\r\n        }\r\n        isRunning.value = true\r\n        // CanvasProcessor / CanvasProcessorHighLevelApi ã©ã£ã¡ã‚’ä½¿ã†ã‹\r\n        val isUseLowLevelApi = false\r\n        // æç”»æ™‚ã«å‘¼ã³å‡ºã•ã‚Œã‚‹é–¢æ•°\r\n        val onCanvasDrawRequest: Canvas.(Long) -> Boolean = { positionMs ->\r\n            // this ã¯ Canvas\r\n            drawColor(Color.LTGRAY)\r\n            // positionMs ã¯ç¾åœ¨ã®å‹•ç”»ã®æ™‚é–“\r\n            val text = \"å‹•ç”»ã®æ™‚é–“ = ${\"%.2f\".format(positionMs / 1000f)}\"\r\n            // æ å–ã‚Šæ–‡å­—\r\n            drawText(text, 0f, 80f, outlinePaint)\r\n            // æ ç„¡ã—æ–‡å­—\r\n            drawText(text, 0f, 80f, innerPaint)\r\n            // true ã‚’è¿”ã—ã¦ã„ã‚‹é–“ã¯å‹•ç”»ã‚’ä½œæˆã™ã‚‹ã€‚ã¨ã‚Šã‚ãˆãš 10 ç§’\r\n            positionMs < 10_000\r\n        }\r\n        if (isUseLowLevelApi) {\r\n            CanvasProcessor.start(resultFile, onCanvasDrawRequest = onCanvasDrawRequest)\r\n        } else if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n            CanvasProcessorHighLevelApi.start(context, resultFile, onCanvasDrawRequest = onCanvasDrawRequest)\r\n        }\r\n        // ã‚³ãƒ”ãƒ¼ã—ã¦å…ƒãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™\r\n        MediaStoreTool.copyToMovieFolder(context, resultFile)\r\n        resultFile.delete()\r\n        isRunning.value = false\r\n    }\r\n\r\n    Text(text = if (isRunning.value) \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ã§ã™\" else \"çµ‚ã‚ã‚Šã¾ã—ãŸ\")\r\n\r\n}\r\n```\r\n\r\nã“ã‚Œã§å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ä¿å­˜ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãšã€‚\r\nã¨ã„ã†ã‹ã“ã‚Œå‰ã‚‚æ›¸ã„ãŸæ°—ãŒã™ã‚‹\r\n\r\n![Imgur](https://imgur.com/03vHmPf.png)\r\n\r\n# ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ï¼ˆå‹•ä½œç¢ºèªï¼‰\r\næ™‚é–“æ¸¬ã£ã¦ã¿ã¾ã™ã€‚ä¸‰å›ãã‚‰ã„è©¦ã—ã¾ã—ãŸã€‚ãƒªãƒªãƒ¼ã‚¹ãƒ“ãƒ«ãƒ‰ã§ã¯ãªã„ã®ã§æ­£ã—ãã¯ç„¡ã„ã‹ã‚‚ï¼Ÿ  \r\næ¸¬ã£ã¦ã¿ã¾ã—ãŸãŒå·®ãŒãªã„ã®ã§ã©ã£ã¡ã‚’ä½¿ã£ã¦ã‚‚ã„ã„ã¨æ€ã„ã¾ã—ãŸã€‚\r\n\r\n| ãŸã‚“ã¾ã¤                              | OpenGL ç‰ˆ                      | lockHardwareCanvas ç‰ˆ          |\r\n|---------------------------------------|--------------------------------|--------------------------------|\r\n| Xperia Pro-I (SDM 888)                | 10111 ms / 10109 ms / 10121 ms | 10161 ms / 10133 ms / 10121 ms |\r\n| Google Pixel 6 Pro (Google Tensor G1) | 10185 ms / 10131 ms / 10117 ms | 10717 ms / 10649 ms / 10654 ms |\r\n| Google Pixel 3 XL (SDM 845)           | 10381 ms / 10133 ms / 10099 ms | 10552 ms / 10404 ms / 10391 ms |\r\n| Xperia XZ1 Compact (SDM 835)          | 10932 ms / 10204 ms / 10186 ms | 10420 ms / 10412 ms / 10435 ms |\r\n| Xperia Z3 Compact (SDM 801)           | 10634 ms / 10559 ms / 10419 ms | Android 5 ãªã®ã§ä½¿ãˆãªã„       |\r\nãŸã¾ãŸã¾ Z3 Compact ã®é›»æºãŒå…¥ã£ã¦ã„ãŸã®ã§ã¤ã„ã§ã«ã‚„ã£ã¦ã¿ã¾ã—ãŸã€ã‚‚ã†9å¹´ãã‚‰ã„å‰ã«ãªã‚‹ã®...ï¼ï¼Ÿ\r\n\r\n## ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º\r\né€Ÿåº¦ã¯ã‚ã‚“ã¾ã‚Šå¤‰ã‚ã‚‰ãªã„ã®ã§ã™ãŒã€ã§ããŸå‹•ç”»ã‚µã‚¤ã‚ºãŒå…¨éƒ¨ãƒãƒ©ãƒãƒ©ãªã‚“ã§ã™ã‚ˆã­ï¼ˆãªãœï¼Ÿï¼‰\r\nOpenGL -> lockHardwareCanvas ã‚’ä¸‰å›ç¹°ã‚Šè¿”ã—ãŸã®ã§ã€å¶æ•°ãŒOpenGLã€å¥‡æ•°ãŒlockHardwareCanvasã«ãªã‚Šã¾ã™  \r\nã†ãƒ¼ã‚“ã€`OpenGL ç‰ˆ`ã®ã»ã†ãŒè‹¥å¹²ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå°ã•ã„ï¼Ÿ\r\n\r\n- Xperia Pro-I\r\n    - ![Imgur](https://imgur.com/e9iA6gJ.png)\r\n- Google Pixel 6 Pro\r\n    - ![Imgur](https://imgur.com/pstJVP9.png)\r\n- Google Pixel 3 XL\r\n    - ![Imgur](https://imgur.com/WkQ0P0x.png)\r\n- Xperia XZ1 Compact\r\n    - ![Imgur](https://imgur.com/oczGiJk.png)\r\n- Xperia Z3 Compact\r\n    - ![Imgur](https://imgur.com/TOHnqZQ.png)\r\n\r\nä»–ã«ã‚‚ Xiaomi ã¨ã‹ã§ã‚‚è¦‹ã¦ã¿ã¾ã—ãŸãŒç‰¹ã«å•é¡Œãªãã©ã£ã¡ã§ã‚‚å‹•ã„ã¦ã„ãã†ã§ã™ã€‚ï¼ˆIssueã®ä»¶å†ç¾ã›ãšï¼‰\r\n\r\n# ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã®å‹•ç”»ã‚’ä½œã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹\r\n`Jetpack Compose`ã§UIã‚’ä½œã‚Šã¾ã™ã€‚  \r\nç”»åƒã‚’é¸æŠã™ã‚‹ãƒœã‚¿ãƒ³ã¨ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã¾ã—ãŸã€‚  \r\næŠ¼ã—ãŸã‚‰ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚å¤šåˆ† UI ã«æ›¸ãã“ã¨ã˜ã‚ƒãªã„ã¨æ€ã„ã¾ã™ï¼ˆæ™‚é–“ãŒã‹ã‹ã‚‹ã®ã§`Service`ã§ã‚„ã‚‹ã¹ãã§ã™ã­ã¯ã„ã€‚ï¼‰  \r\nç‰¹ã«é›£ã—ã„ã“ã¨ã¯ã—ã¦ãªã„ï¼ˆ`Canvas`ã«æ›¸ã„ã¦ã‚‹ã ã‘ï¼‰ã®ã§ã€è©³ã—ãã¯ã‚³ãƒ¼ãƒ‰ã®ã‚³ãƒ¡ãƒ³ãƒˆè¦‹ã¦ãã ã•ã„ã€‚  \r\n\r\n`Bitmap`ã‚’`Canvas`ã®çœŸã‚“ä¸­ã«æãã®ãŒåœ°å‘³ã«é¢å€’ã ã£ãŸã€‚  \r\n`Uri ã‹ã‚‰ Bitmap`ã¯ãªã‚“ã‹é¢å€’ã ã£ãŸã®ã§`Glide`ã¨ã‹`Coil`ã¨ã‹å…¥ã‚Œã¦æ¥½ã—ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã€‚  \r\n\r\n```kotlin\r\nprivate const val TIME_MS = 3_000\r\nprivate const val VIDEO_WIDTH = 1280\r\nprivate const val VIDEO_HEIGHT = 720\r\n\r\n/** ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã‚’ä½œã‚‹ */\r\n@Composable\r\nfun SlideShowScreen() {\r\n    val context = LocalContext.current\r\n    // å®Ÿè¡Œä¸­ãƒ•ãƒ©ã‚°\r\n    val isRunning = remember { mutableStateOf(false) }\r\n    val scope = rememberCoroutineScope()\r\n    // å–å¾—ã—ãŸç”»åƒã‚’å…¥ã‚Œã‚‹é…åˆ—\r\n    val imageList = remember { mutableStateListOf<Uri>() }\r\n    val imagePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.GetMultipleContents()) {\r\n        imageList.addAll(it)\r\n    }\r\n\r\n    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n    fun encode() {\r\n        scope.launch {\r\n            isRunning.value = true\r\n            val resultFile = context.getExternalFilesDir(null)?.resolve(\"${System.currentTimeMillis()}.mp4\")!!\r\n            val paint = Paint()\r\n\r\n            var prevBitmapPathPair: Pair<Uri, Bitmap>? = null\r\n            CanvasProcessor.start(\r\n                resultFile = resultFile,\r\n                outputVideoWidth = VIDEO_WIDTH,\r\n                outputVideoHeight = VIDEO_HEIGHT\r\n            ) { positionMs ->\r\n                // å†ç”Ÿä½ç½®ã‹ã‚‰è¡¨ç¤ºã™ã¹ãç”»åƒã®é…åˆ—ã®æ·»ãˆå­—ã‚’è¨ˆç®—\r\n                val index = (positionMs / TIME_MS).toInt()\r\n                val uri = imageList.getOrNull(index) ?: return@start false\r\n                // å‰å›ã¨é•ã†ç”»åƒã®å ´åˆ\r\n                if (prevBitmapPathPair?.first != uri) {\r\n                    val bitmap = createBitmapFromUri(context, uri).aspectResize(VIDEO_WIDTH, VIDEO_HEIGHT)\r\n                    // å‰ã® Bitmap ã‚’ç ´æ£„ã—ã¦ã‹ã‚‰\r\n                    prevBitmapPathPair?.second?.recycle()\r\n                    prevBitmapPathPair = uri to bitmap\r\n                }\r\n\r\n                // çœŸã‚“ä¸­ã« Bitmap\r\n                val bitmap = prevBitmapPathPair!!.second\r\n                drawBitmap(bitmap, ((VIDEO_WIDTH / 2f) - (bitmap.width / 2f)), 0f, paint)\r\n\r\n                // true ã‚’è¿”ã—ã¦ã„ã‚‹é–“\r\n                positionMs < TIME_MS * imageList.size\r\n            }\r\n\r\n            // ã‚³ãƒ”ãƒ¼ã—ã¦å…ƒãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™\r\n            MediaStoreTool.copyToMovieFolder(context, resultFile)\r\n            resultFile.delete()\r\n\r\n            isRunning.value = false\r\n        }\r\n    }\r\n\r\n    Column {\r\n        // ç”»åƒã®ãƒ‘ã‚¹ã‚’è¡¨ç¤º\r\n        imageList.forEach { Text(text = it.toString()) }\r\n\r\n        // é¸æŠãƒœã‚¿ãƒ³\r\n        Button(\r\n            modifier = Modifier.padding(10.dp),\r\n            onClick = {\r\n                imageList.clear()\r\n                imagePicker.launch(\"image/*\")\r\n            }\r\n        ) { Text(text = \"ç”»åƒã‚’é¸ã¶\") }\r\n\r\n        // å®Ÿè¡Œä¸­ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’å¡ã\r\n        if (isRunning.value) {\r\n            Text(text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ã§ã™\")\r\n        } else {\r\n            Button(\r\n                modifier = Modifier.padding(10.dp),\r\n                onClick = { encode() }\r\n            ) { Text(text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\") }\r\n        }\r\n    }\r\n\r\n}\r\n\r\n/** ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ä¿æŒã—ã¦ãƒªã‚µã‚¤ã‚ºã™ã‚‹ */\r\nprivate fun Bitmap.aspectResize(targetWidth: Int, targetHeight: Int): Bitmap {\r\n    val width = width\r\n    val height = height\r\n    val aspectBitmap = width.toFloat() / height.toFloat()\r\n    val aspectTarget = targetWidth.toFloat() / targetHeight.toFloat()\r\n    var calcWidth = targetWidth\r\n    var calcHeight = targetHeight\r\n    if (aspectTarget > aspectBitmap) {\r\n        calcWidth = (targetHeight.toFloat() * aspectBitmap).toInt()\r\n    } else {\r\n        calcHeight = (targetWidth.toFloat() / aspectBitmap).toInt()\r\n    }\r\n    return scale(calcWidth, calcHeight, true)\r\n}\r\n\r\n/** Uri ã‹ã‚‰ Bitmap ã‚’ä½œã‚‹ã€‚ */\r\nprivate fun createBitmapFromUri(context: Context, uri: Uri): Bitmap {\r\n    // ã“ã‚Œã ã¨ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ Bitmap ãŒå‡ºæ¥ã¦ã—ã¾ã†ã®ã§ã€ SOFTWARE ã‚’ã¤ã‘ã¦ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ Bitmap ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆç·¨é›†å¯èƒ½ï¼‰\r\n    // API ãŒ Android 9 ä»¥é™ãªã®ã§ã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã„å ´åˆã¯å¤ã„æ–¹æ³•ã‚’ä½¿ã†ã‹ã€ã„ã£ãã®äº‹ç”»åƒã‚’èª­ã¿è¾¼ã‚€ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Glide ã¨ã‹ã‚’å…¥ã‚Œã‚‹ã®ã‚‚ã‚ã‚Šã ã¨æ€ã„ã¾ã™\r\n    return ImageDecoder.createSource(context.contentResolver, uri)\r\n        .let { src -> ImageDecoder.decodeDrawable(src) { decoder, info, s -> decoder.allocator = ImageDecoder.ALLOCATOR_SOFTWARE } }\r\n        .toBitmap()\r\n}\r\n```\r\n![Imgur](https://imgur.com/SFXmTmb.png)\r\n\r\nã¾ãåˆ‡ã‚Šæ›¿ãˆã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒãªã„ã‚“ã§ã€è¦‹ãŸç›®ãŒã‚ã‚Œã§ã™ãŒé¢å€’ãã†ãªã®ã§ã€ã€ã€  \r\nï¼ˆä»Šæ€ã£ãŸã‘ã©ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãªãã¦ã‚‚ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã£ã¦å‘¼ã‚“ã§è‰¯ã„ã®ã‹ãƒ»ãƒ»ãƒ»ï¼Ÿï¼‰  \r\n\r\n<video src=\"https://user-images.githubusercontent.com/32033405/235321119-e8391d46-9fbd-4ed2-9cc7-5a2dd72b7d10.mp4\" width=\"80%\" controls></video>\r\n\r\n# ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ï¼Ÿã‚¹ã‚¿ãƒƒãƒ•ãƒ­ãƒ¼ãƒ«ï¼Ÿã®å‹•ç”»ã‚‚ä½œã‚Œã¾ã™\r\nã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã®ã‚ã‚Œã‚‚ä½œã‚Œãã†ã€ä½œã‚Šã¾ã™ã€‚  \r\né©å½“ã«ç”»åƒã‚’é¸ã¶ãƒœã‚¿ãƒ³ã¨ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã¨ã€ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ï¼Ÿã§æµã™æ–‡å­—ã‚’å…¥åŠ›ã™ã‚‹ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã‚’ç½®ãã¾ã—ãŸã€‚  \r\nã“ã‚Œã‚‚`Canvas`ã«ã„ã„æ„Ÿã˜ã«æ›¸ã„ã¦ã‚‹ã ã‘ãªã®ã§ã€ç‰¹ã«é›£ã—ã„ã“ã¨ã¯ã—ã¦ãªã„ã¯ãšã€‚`positionMs`ã‚’è¦‹ã¦ãã‚Œã£ã½ãä¸Šã«æ–‡å­—ã‚’ç§»å‹•ã•ã›ã¦ã„ã‚‹ã ã‘ã§ã™ã€ã€  \r\n\r\n\r\n```kotlin\r\nprivate const val VIDEO_DURATION_MS = 20_000\r\nprivate const val VIDEO_WIDTH = 1280\r\nprivate const val VIDEO_HEIGHT = 720\r\n\r\n/** ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ã‚’ã¤ãã‚‹ */\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun EndRollScreen() {\r\n    val context = LocalContext.current\r\n    val scope = rememberCoroutineScope()\r\n    // å®Ÿè¡Œä¸­ãƒ•ãƒ©ã‚°\r\n    val isRunning = remember { mutableStateOf(false) }\r\n\r\n    // ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ã®æ–‡å­—\r\n    val endRollText = remember { mutableStateOf(\"\") }\r\n\r\n    // ç”»åƒ\r\n    val bitmap = remember { mutableStateOf<Bitmap?>(null) }\r\n    DisposableEffect(key1 = Unit) {\r\n        onDispose { bitmap.value?.recycle() } // Bitmap ã‚’ç ´æ£„ã™ã‚‹\r\n    }\r\n    val imagePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.GetContent()) {\r\n        val uri = it ?: return@rememberLauncherForActivityResult\r\n        bitmap.value = createBitmapFromUri(context, uri).aspectResize(200, 200)\r\n    }\r\n\r\n    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n    fun encode() {\r\n        scope.launch {\r\n            isRunning.value = true\r\n            val resultFile = context.getExternalFilesDir(null)?.resolve(\"${System.currentTimeMillis()}.mp4\")!!\r\n            val bitmapPaint = Paint()\r\n            val textPaint = Paint().apply {\r\n                style = Paint.Style.FILL\r\n                color = Color.WHITE\r\n                textSize = 50f\r\n            }\r\n\r\n            CanvasProcessor.start(\r\n                resultFile = resultFile,\r\n                outputVideoWidth = VIDEO_WIDTH,\r\n                outputVideoHeight = VIDEO_HEIGHT\r\n            ) { positionMs ->\r\n\r\n                // èƒŒæ™¯ã¯çœŸã£é»’\r\n                drawColor(Color.BLACK)\r\n\r\n                // ã‚¢ã‚¤ã‚³ãƒ³ã‚’æã\r\n                var textLeftPos = 100f\r\n                bitmap.value?.also { bitmap ->\r\n                    drawBitmap(bitmap, textLeftPos, ((VIDEO_HEIGHT / 2f) - (bitmap.height / 2f)), bitmapPaint)\r\n                    textLeftPos += bitmap.width\r\n                }\r\n\r\n                // é©å½“ã«ç§»å‹•ã•ã›ã‚‹\r\n                // è¤‡æ•°è¡Œæã‘ãªã„ã®ã§è¡Œå˜ä½ã§ drawText ã™ã‚‹\r\n                endRollText.value.lines().forEachIndexed { index, text ->\r\n                    drawText(text, textLeftPos + 100f, ((VIDEO_HEIGHT + (textPaint.textSize * (index + 1))) - (positionMs / 10f)), textPaint)\r\n                }\r\n\r\n                positionMs < VIDEO_DURATION_MS\r\n            }\r\n\r\n            // ã‚³ãƒ”ãƒ¼ã—ã¦å…ƒãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™\r\n            MediaStoreTool.copyToMovieFolder(context, resultFile)\r\n            resultFile.delete()\r\n\r\n            isRunning.value = false\r\n        }\r\n    }\r\n\r\n    Column {\r\n        // é¸æŠãƒœã‚¿ãƒ³\r\n        bitmap.value?.also {\r\n            Text(text = \"Bitmap width = ${it.width}\")\r\n        }\r\n        Button(\r\n            modifier = Modifier.padding(10.dp),\r\n            onClick = { imagePicker.launch(\"image/*\") }\r\n        ) { Text(text = \"ç”»åƒã‚’é¸ã¶\") }\r\n\r\n        // æ–‡å­—\r\n        OutlinedTextField(\r\n            modifier = Modifier\r\n                .fillMaxWidth()\r\n                .padding(10.dp),\r\n            value = endRollText.value,\r\n            onValueChange = { endRollText.value = it },\r\n            label = { Text(text = \"ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ã®ãƒ†ã‚­ã‚¹ãƒˆ\") }\r\n        )\r\n\r\n        Spacer(modifier = Modifier.height(50.dp))\r\n\r\n        // å®Ÿè¡Œä¸­ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’å¡ã\r\n        if (isRunning.value) {\r\n            Text(text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ã§ã™\")\r\n        } else {\r\n            Button(\r\n                modifier = Modifier.padding(10.dp),\r\n                onClick = { encode() }\r\n            ) { Text(text = \"ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\") }\r\n        }\r\n    }\r\n}\r\n\r\n/** ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã‚’ä¿æŒã—ã¦ãƒªã‚µã‚¤ã‚ºã™ã‚‹ */\r\nprivate fun Bitmap.aspectResize(targetWidth: Int, targetHeight: Int): Bitmap {\r\n    val width = width\r\n    val height = height\r\n    val aspectBitmap = width.toFloat() / height.toFloat()\r\n    val aspectTarget = targetWidth.toFloat() / targetHeight.toFloat()\r\n    var calcWidth = targetWidth\r\n    var calcHeight = targetHeight\r\n    if (aspectTarget > aspectBitmap) {\r\n        calcWidth = (targetHeight.toFloat() * aspectBitmap).toInt()\r\n    } else {\r\n        calcHeight = (targetWidth.toFloat() / aspectBitmap).toInt()\r\n    }\r\n    return scale(calcWidth, calcHeight, true)\r\n}\r\n\r\n/** Uri ã‹ã‚‰ Bitmap ã‚’ä½œã‚‹ã€‚ */\r\nprivate fun createBitmapFromUri(context: Context, uri: Uri): Bitmap {\r\n    // ã“ã‚Œã ã¨ ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ Bitmap ãŒå‡ºæ¥ã¦ã—ã¾ã†ã®ã§ã€ SOFTWARE ã‚’ã¤ã‘ã¦ã€ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢ Bitmap ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ï¼ˆç·¨é›†å¯èƒ½ï¼‰\r\n    // API ãŒ Android 9 ä»¥é™ãªã®ã§ã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã„å ´åˆã¯å¤ã„æ–¹æ³•ã‚’ä½¿ã†ã‹ã€ã„ã£ãã®äº‹ç”»åƒã‚’èª­ã¿è¾¼ã‚€ãƒ©ã‚¤ãƒ–ãƒ©ãƒª Glide ã¨ã‹ã‚’å…¥ã‚Œã‚‹ã®ã‚‚ã‚ã‚Šã ã¨æ€ã„ã¾ã™\r\n    return ImageDecoder.createSource(context.contentResolver, uri)\r\n        .let { src -> ImageDecoder.decodeDrawable(src) { decoder, info, s -> decoder.allocator = ImageDecoder.ALLOCATOR_SOFTWARE } }\r\n        .toBitmap()\r\n}\r\n```\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã®UIã«ãªã‚‹ã¯ãš\r\n\r\n![Imgur](https://imgur.com/wzlAcX0.png)\r\n\r\nå®Ÿéš›ã«ä½œã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚\r\n\r\n<video src=\"https://user-images.githubusercontent.com/32033405/235225944-748106f4-89a0-48c0-b14d-7edfd2698b96.mp4\" width=\"80%\" controls ></video>\r\n\r\n![Imgur](https://imgur.com/h7fPexc.png)\r\n\r\n![Imgur](https://imgur.com/oaGiDld.png)\r\n\r\n# ããƒ¼ã™ã“ãƒ¼ã©\r\næœ€ä½é™ã®UIã‚’ä½œã‚Šã¾ã—ãŸã€ã‚¹ãƒ©ã‚¤ãƒ‰ã‚·ãƒ§ãƒ¼ã¨ã‚¨ãƒ³ãƒ‰ãƒ­ãƒ¼ãƒ«ã‚’ä½œæˆã™ã‚‹ç”»é¢ã‚’é–‹ãã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚\r\n\r\nhttps://github.com/takusan23/CanvasToVideo\r\n\r\n# ãŠã‚ã‚Šã«\r\n`Windows ç”¨ Nearby Share`ã€ã‚ã£ã¡ã‚ƒä¾¿åˆ©ã§ã™ã­ã€‚  \r\n`USB`ã«ã—ã¦ã‚‚`USBæ¥ç¶šã‚’ãƒ•ã‚¡ã‚¤ãƒ«è»¢é€`ã«ã—ãªã„ã¨ã„ã‘ãªã„ã—ã€`adb`ã ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã„ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’çŸ¥ã‚‰ãªã„ã¨è¡Œã‘ãªã„ã‹ã‚‰ã€çµæ§‹ã©ã‚Œã‚’å–ã£ã¦ã‚‚é¢å€’ã ã£ãŸã‚“ã§ã™ã‚ˆã­ã€‚  \r\nå°‘ã—å‰ãªã‚‰ Googleãƒ•ã‚©ãƒˆ ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãƒ‘ã‚½ã‚³ãƒ³ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã—ãŸãŒã€ç„¡åˆ¶é™ã˜ã‚ƒãªããªã£ãŸã‹ã‚‰ãªã‚ã€‚  \r\nã™ã”ãä¾¿åˆ©ã§ã™ã€‚"},{"title":"COCOAã®é›»æ³¢ã‚’æ¤œçŸ¥ã—ã¦ã¿ã‚‹","link":"/posts/android_cocoa_ble_checker/","markdown":"ã“ã‚Œé«˜æ ¡å’æ¥­å‰ã«ã‚„ã£ã¨ã‘ã°é¢ç™½ã‹ã£ãŸã®ã§ã¯\n\n<img src=\"https://imgur.com/6EC4Hng.png\" width=\"200\">\n\nãƒ†ãƒ¬ãƒ“ã¡ã‚ƒã‚“ã«å’æ¥­å¼ã§ã¤ã‘ã‚‹èŠ±ï¼ˆãªã‚“ã¦ã„ã†ã®ï¼Ÿï¼‰ã‚’ã¤ã‘ãŸ\n\n# æœ¬é¡Œ\nã©ã†ã‚„ã‚‰`COCOA`ã®é›»æ³¢ã‚’æ‹¾ãˆã‚‹ã‚‰ã—ã„ï¼Ÿè©¦ã—ã¦ã¿ã‚‹  \nã¡ãªä¸€å›ã‚‚é€šçŸ¥æ¥ãŸã“ã¨ãªã„ï¼ˆã„ã„ã“ã¨ã˜ã‚ƒã‚“ï¼‰\n\n# ç’°å¢ƒ\n\n| ãªã¾ãˆ  | ã‚ãŸã„  |\n|---------|---------|\n| Android | 12 DP 2 |\n\n# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\næ—¥æœ¬èªç‰ˆã¯`BluetoothAdapter#startLeScan()`ã‚’ä½¿ã£ã¦ã¾ã™ãŒã€ã“ã‚Œã¯éæ¨å¥¨ãªã®ã§è‹±èªç‰ˆã‚’è¦‹ã¾ã—ã‚‡ã†ã€‚  \nhttps://developer.android.com/guide/topics/connectivity/use-ble\n\n# ã¤ãã‚‹\n\n## AndroidManifest.xml\nãƒ–ãƒ«ãƒ¼ãƒˆã‚¥ãƒ¼ã‚¹ã®æ¨©é™ãŒå¿…è¦ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã—ã¾ã™ã€‚  \nç‰¹ã«ä¸€ç•ªä¸‹ã®`android.permission.ACCESS_FINE_LOCATION`ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¨±å¯ã‚’æ±‚ã‚ã‚‹ã‚¿ã‚¤ãƒ—ã®æ¨©é™ã§ã™ã€‚\n\n```xml\n<uses-permission android:name=\"android.permission.BLUETOOTH\"/>\n<uses-permission android:name=\"android.permission.BLUETOOTH_ADMIN\"/>\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n```\n\n## appãƒ•ã‚©ãƒ«ãƒ€å†…ã®build.gradle\næ¨©é™ã‚’æ±‚ã‚ã‚‹ãŸã‚ã€ä»Šã¾ã§ã®`onActivityResult()`ã‚’ä½¿ã£ã¦ã‚‚ã„ã„ã‚“ã§ã™ã‘ã©ã€ä»Šå›ã¯`Activity Result API`ã‚’ä½¿ã„ãŸã„ã€‚  \nã®ã§`Activity`ã¨`Fragment`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ã¾ã™\n\n```kotlin\ndependencies {\n\n    // Activity Result API\n    implementation \"androidx.activity:activity-ktx:1.2.1\"\n    implementation \"androidx.fragment:fragment-ktx:1.3.1\"\n\n    // çœç•¥\n}\n```\n\n\n## MainActivity.kt\n\n### BLEã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹\nBLEã«å¯¾å¿œã—ã¦ã„ã‚‹ã‹ã‚’è¿”ã™é–¢æ•°ã‚’æ›¸ã„ã¦\n\n```kotlin\n/** BLEå¯¾å¿œæ™‚ã¯trueã‚’è¿”ã™ */\nprivate fun isSupportedBLE(): Boolean {\n    return packageManager.hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)\n}\n```\n\n### BluetoothAdapter\nãŒå¿…è¦ã‚‰ã—ã„ã®ã§\n\n```kotlin\nprivate val bluetoothAdapter by lazy {\n    val bluetoothManager = getSystemService(Context.BLUETOOTH_SERVICE) as BluetoothManager\n    bluetoothManager.adapter\n}\n```\n\n### BluetoothãŒæœ‰åŠ¹ï¼Ÿ\nãƒ–ãƒ«ãƒ¼ãƒˆã‚¥ãƒ¼ã‚¹ãŒONã«ãªã£ã¦ã„ã‚‹ã‹ã‚’ç¢ºèªã—ã¾ã™\n\n```kotlin\n/** BluetoothãŒæœ‰åŠ¹ãªã‚‰true */\nprivate fun isEnableBluetooth(): Boolean {\n    return bluetoothAdapter.isEnabled\n}\n```\n\n### BLEç«¯æœ«ãŒæ¤œå‡ºã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\nã‚’æ›¸ãã¾ã™ã€‚\n\n```kotlin\n/** BLEç«¯æœ«ã‚’æ¤œå‡ºã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\nprivate val bleCallBack = object : ScanCallback() {\n    override fun onScanResult(callbackType: Int, result: ScanResult?) {\n        super.onScanResult(callbackType, result)\n        println(\"æ¤œå‡º\")\n        println(result)\n    }\n}\n```\n### æ¤œå‡ºã‚’å§‹ã‚ã‚‹\n10ç§’å¾Œã«æ¤œå‡ºã‚’çµ‚äº†ã™ã‚‹ã‚ˆã†ã«ã—ã¨ãã¾ã—ãŸã€‚  \nã¨ã‚Šã‚ãˆãšã¯UUIDã®åˆ¶é™ã‚’æ›ã‘ãšã«ã‚¹ã‚­ãƒ£ãƒ³ã—ã¦ã¿ã¾ã™\n\n```kotlin\n/** BLEç«¯æœ«ã®æ¤œå‡ºã‚’å§‹ã‚ã‚‹ã€‚10ç§’å¾Œã«çµ‚äº†ã™ã‚‹ */\nprivate fun start() {\n    bluetoothAdapter.bluetoothLeScanner.startScan(bleCallBack)\n    // 10ç§’å¾Œã«çµ‚äº†\n    Handler(Looper.getMainLooper()).postDelayed(10 * 1000) {\n        bluetoothAdapter.bluetoothLeScanner.stopScan(bleCallBack)\n    }\n}\n```\n\n### æ¨©é™ã‚’æ±‚ã‚ã‚‹\n`Activity Result API`ã®ãŠã‹ã’ã§ç°¡å˜ã«ãªã£ãŸã€‚  \n\n```kotlin\n/** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\nprivate val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n    if (isGranted) {\n        // ãŠè¨±ã—ã‚’ã‚‚ã‚‰ã£ãŸ\n        start()\n    }\n}\n\n/** android.permission.ACCESS_FINE_LOCATION æ¨©é™ãŒã‚ã‚‹ã‹ã©ã†ã‹ */\nprivate fun isGrantedAccessFineLocationPermission(): Boolean {\n    return ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED\n}\n\n/** android.permission.ACCESS_FINE_LOCATION æ¨©é™ã‚’è²°ã„ã«è¡Œã */\nprivate fun requestAccessFineLocationPermission(){\n    permissionCallBack.launch(android.Manifest.permission.ACCESS_FINE_LOCATION)\n}\n```\n\n\n### onCreate()\n`onCreate()`ã§ãã‚Œãã‚Œå‘¼ã¹ã°ã„ã„ã‹ãª\n\n```kotlin\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    setContentView(R.layout.activity_main)\n    when {\n        !isSupportedBLE() -> {\n            // BLEéå¯¾å¿œ\n            finish()\n            Toast.makeText(this, \"BLEæœªå¯¾å¿œç«¯æœ«ã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“\", Toast.LENGTH_SHORT).show()\n        }\n        !isEnableBluetooth() -> {\n            // BluetoothãŒOFF\n            finish()\n            Toast.makeText(this, \"Bluetoothã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„\", Toast.LENGTH_SHORT).show()\n        }\n        !isGrantedAccessFineLocationPermission() -> {\n            // ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒãªã„ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹\n            requestAccessFineLocationPermission()\n        }\n        else -> {\n            // æ¤œå‡ºé–‹å§‹\n            start()\n        }\n    }\n}\n```\n\n## ã“ã“ã¾ã§\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    private val bluetoothAdapter by lazy {\n        val bluetoothManager = getSystemService(Context.BLUETOOTH_SERVICE) as BluetoothManager\n        bluetoothManager.adapter\n    }\n\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n        if (isGranted) {\n            // ãŠè¨±ã—ã‚’ã‚‚ã‚‰ã£ãŸ\n            start()\n        }\n    }\n\n    /** BLEç«¯æœ«ã‚’æ¤œå‡ºã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\n    private val bleCallBack = object : ScanCallback() {\n        override fun onScanResult(callbackType: Int, result: ScanResult?) {\n            super.onScanResult(callbackType, result)\n            println(\"æ¤œå‡º\")\n            println(result)\n        }\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(R.layout.activity_main)\n\n        when {\n            !isSupportedBLE() -> {\n                // BLEéå¯¾å¿œ\n                finish()\n                Toast.makeText(this, \"BLEæœªå¯¾å¿œç«¯æœ«ã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“\", Toast.LENGTH_SHORT).show()\n            }\n            !isEnableBluetooth() -> {\n                // BluetoothãŒOFF\n                finish()\n                Toast.makeText(this, \"Bluetoothã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„\", Toast.LENGTH_SHORT).show()\n            }\n            !isGrantedAccessFineLocationPermission() -> {\n                // ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒãªã„ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹\n                requestAccessFineLocationPermission()\n            }\n            else -> {\n                // æ¤œå‡ºé–‹å§‹\n                start()\n            }\n        }\n    }\n\n    /** BLEç«¯æœ«ã®æ¤œå‡ºã‚’å§‹ã‚ã‚‹ã€‚10ç§’å¾Œã«çµ‚äº†ã™ã‚‹ */\n    private fun start() {\n        bluetoothAdapter.bluetoothLeScanner.startScan(bleCallBack)\n        // 10ç§’å¾Œã«çµ‚äº†\n        Handler(Looper.getMainLooper()).postDelayed(10 * 1000) {\n            bluetoothAdapter.bluetoothLeScanner.stopScan(bleCallBack)\n            Toast.makeText(this, \"æ¤œå‡ºçµ‚äº†\", Toast.LENGTH_SHORT).show()\n        }\n    }\n\n    /** android.permission.ACCESS_FINE_LOCATION æ¨©é™ãŒã‚ã‚‹ã‹ã©ã†ã‹ */\n    private fun isGrantedAccessFineLocationPermission(): Boolean {\n        return ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED\n    }\n\n    /** android.permission.ACCESS_FINE_LOCATION æ¨©é™ã‚’è²°ã„ã«è¡Œã */\n    private fun requestAccessFineLocationPermission(){\n        permissionCallBack.launch(android.Manifest.permission.ACCESS_FINE_LOCATION)\n    }\n\n    /** BluetoothãŒæœ‰åŠ¹ãªã‚‰true */\n    private fun isEnableBluetooth(): Boolean {\n        return bluetoothAdapter.isEnabled\n    }\n\n    /** BLEå¯¾å¿œæ™‚ã¯trueã‚’è¿”ã™ */\n    private fun isSupportedBLE(): Boolean {\n        return packageManager.hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)\n    }\n\n}\n```\n\n## ã©ã‚ŒãŒCOCOAã®é›»æ³¢ã§ã™ã‹ï¼Ÿ\nã“ã®ã¾ã¾ã§ã¯ã™ã¹ã¦ã®é›»æ³¢ã‚’å–å¾—ã—ã¦ã—ã¾ã†ã®ã§ã€`COCOA`ã®é›»æ³¢ã«é™å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€ã“ã“ã‚‰ã¸ã‚“ã¯ã‚ˆãçŸ¥ã‚Šã¾ã›ã‚“ã€‚  \nï¼’ã¤ã®æ–¹æ³•ã§ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n\n## é›»æ³¢å¼·åº¦\n`ScanResult#rssi`ã§å–ã‚Œã¾ã™ã€‚å˜ä½ã¯è¬\n\n### start()é–¢æ•°ã‚’æ›¸ãæ›ãˆã‚‹æ–¹æ³•\nçœºã‚ã¦ã‚‹ã¨`0000fd6f-0000-1000-8000-00805f9b34fb`ãŒCOCOAã®UUIDï¼Ÿã‚‰ã—ã„ã®ã§ã“ã‚Œã«é™å®šã—ã¦ã‚ã’ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\n\n```kotlin\n/** BLEç«¯æœ«ã®æ¤œå‡ºã‚’å§‹ã‚ã‚‹ã€‚10ç§’å¾Œã«çµ‚äº†ã™ã‚‹ */\nprivate fun start() {\n    // COCOAã®é›»æ³¢ã®ã¿\n    val uuidFilter = listOf(\n            ScanFilter.Builder().apply { setServiceUuid(ParcelUuid.fromString(\"0000fd6f-0000-1000-8000-00805f9b34fb\")) }.build()\n    )\n    val scanSettings = ScanSettings.Builder().build()\n    bluetoothAdapter.bluetoothLeScanner.startScan(uuidFilter, scanSettings, bleCallBack)\n    // 10ç§’å¾Œã«çµ‚äº†\n    Handler(Looper.getMainLooper()).postDelayed(10 * 1000) {\n        bluetoothAdapter.bluetoothLeScanner.stopScan(bleCallBack)\n        Toast.makeText(this, \"æ¤œå‡ºçµ‚äº†\", Toast.LENGTH_SHORT).show()\n    }\n}\n```\n\n## ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§é™å®šã™ã‚‹\n\nã‚‚ã—ãã¯ã€ã™ã¹ã¦ã®é›»æ³¢ã‚’å–å¾—ã—ãŸã‚ã¨ã«UUIDã§ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ã—ã¦ã‚‚ã„ã„ã¨æ€ã„ã¾ã™\n\n```kotlin\n/** BLEç«¯æœ«ã‚’æ¤œå‡ºã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\nprivate val bleCallBack = object : ScanCallback() {\n    override fun onScanResult(callbackType: Int, result: ScanResult?) {\n        super.onScanResult(callbackType, result)\n        if (result?.scanRecord?.serviceUuids?.get(0)?.uuid?.toString() == \"0000fd6f-0000-1000-8000-00805f9b34fb\"){\n            println(\"ã¿ã¤ã‘ãŸ\")\n        }\n    }\n}\n```\n\n## UIã‚‚ä½œã‚‹\n`ViewBinding`ã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚  \næ—¥æœ¬èªç‰ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã¯`viewBinding { enable = true }`ã—ã‚ã£ã¦æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€ã“ã‚Œã¯å¤ãã¦ä»¥ä¸‹ã®æ–¹æ³•ãŒæ­£è§£ã§ã™\n\n`app/build.gradle`ã‚’é–‹ã„ã¦\n\n```gradle\nandroid {\n    compileSdkVersion 30\n    buildToolsVersion \"30.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.cocoablechecker\"\n        minSdkVersion 21\n        targetSdkVersion 30\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    // ã“ã‚Œ\n    buildFeatures {\n        viewBinding true\n    }\n    // ã“ã“ã¾ã§\n}\n```\n\n```\nbuildFeatures {\n        viewBinding true\n}\n```\n\nãŒæ­£è§£ã§ã™ã€‚\n\n### activity_main.xml\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <ProgressBar\n        android:id=\"@+id/activity_main_progress_bar\"\n        style=\"?android:attr/progressBarStyle\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginBottom=\"16dp\"\n        android:visibility=\"gone\"\n        app:layout_constraintBottom_toTopOf=\"@+id/activity_main_count_text_view\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\" />\n\n    <TextView\n        android:id=\"@+id/activity_main_count_text_view\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:gravity=\"center\"\n        android:textSize=\"24sp\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/activity_main_start_button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"16dp\"\n        android:text=\"è¨ˆæ¸¬é–‹å§‹\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/activity_main_count_text_view\" />\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\n### MainActivity.kt\né›»æ³¢å¼·åº¦ã‚‚è¡¨ç¤ºã—ã¦ã¿ãŸã‘ã©è¦‹æ–¹ãŒã‚ã‹ã‚‰ã‚“\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    private val bluetoothAdapter by lazy {\n        val bluetoothManager = getSystemService(Context.BLUETOOTH_SERVICE) as BluetoothManager\n        bluetoothManager.adapter\n    }\n\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n        if (isGranted) {\n            // ãŠè¨±ã—ã‚’ã‚‚ã‚‰ã£ãŸ\n            start()\n        }\n    }\n\n    /** ViewBinding */\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(viewBinding.root)\n\n        when {\n            !isSupportedBLE() -> {\n                // BLEéå¯¾å¿œ\n                finish()\n                Toast.makeText(this, \"BLEæœªå¯¾å¿œç«¯æœ«ã§ã¯åˆ©ç”¨ã§ãã¾ã›ã‚“\", Toast.LENGTH_SHORT).show()\n            }\n            !isEnableBluetooth() -> {\n                // BluetoothãŒOFF\n                finish()\n                Toast.makeText(this, \"Bluetoothã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„\", Toast.LENGTH_SHORT).show()\n            }\n            !isGrantedAccessFineLocationPermission() -> {\n                // ãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ãŒãªã„ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹\n                requestAccessFineLocationPermission()\n            }\n            else -> {\n                // æ¤œå‡ºé–‹å§‹\n                viewBinding.activityMainStartButton.setOnClickListener {\n                    start()\n                }\n            }\n        }\n    }\n\n    /** BLEç«¯æœ«ã®æ¤œå‡ºã‚’å§‹ã‚ã‚‹ã€‚10ç§’å¾Œã«çµ‚äº†ã™ã‚‹ */\n    private fun start() {\n        // çµæœã‚’å…¥ã‚Œã‚‹é…åˆ—\n        val resultList = arrayListOf<ScanResult>()\n        // BLEç«¯æœ«ã‚’æ¤œå‡ºã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n        val bleCallBack = object : ScanCallback() {\n            override fun onScanResult(callbackType: Int, result: ScanResult?) {\n                super.onScanResult(callbackType, result)\n                // é…åˆ—ã«è¿½åŠ \n                if (result?.scanRecord?.serviceUuids?.get(0)?.uuid?.toString() == \"0000fd6f-0000-1000-8000-00805f9b34fb\") {\n                    resultList.add(result)\n                }\n            }\n        }\n        // ã‚¹ã‚­ãƒ£ãƒ³é–‹å§‹\n        bluetoothAdapter.bluetoothLeScanner.startScan(bleCallBack)\n        // ãã‚‹ãã‚‹\n        viewBinding.activityMainProgressBar.isVisible = true\n        // 10ç§’å¾Œã«çµ‚äº†\n        Handler(Looper.getMainLooper()).postDelayed(10 * 1000) {\n            // æ­¢ã‚ã‚‹\n            bluetoothAdapter.bluetoothLeScanner.stopScan(bleCallBack)\n            // é‡è¤‡ã‚’æ¶ˆã™\n            val finalList = resultList.distinctBy { scanResult -> scanResult.device?.address }\n            // çµæœ\n            viewBinding.activityMainProgressBar.isVisible = false\n            // é›»æ³¢å¼·åº¦\n            val singalText = finalList.joinToString(separator = \"\\n\") { scanResult -> \"${scanResult.rssi} dBm\" }\n            // TextViewã«è¡¨ç¤º\n            viewBinding.activityMainCountTextView.text = \"\"\"\nCOCOAã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å°æ•°\nãŠã‚ˆã ${finalList.size} å°\n--- é›»æ³¢å¼·åº¦ ---\n$singalText\n            \"\"\".trimIndent()\n        }\n    }\n\n    /** android.permission.ACCESS_FINE_LOCATION æ¨©é™ãŒã‚ã‚‹ã‹ã©ã†ã‹ */\n    private fun isGrantedAccessFineLocationPermission(): Boolean {\n        return ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED\n    }\n\n    /** android.permission.ACCESS_FINE_LOCATION æ¨©é™ã‚’è²°ã„ã«è¡Œã */\n    private fun requestAccessFineLocationPermission() {\n        permissionCallBack.launch(android.Manifest.permission.ACCESS_FINE_LOCATION)\n    }\n\n    /** BluetoothãŒæœ‰åŠ¹ãªã‚‰true */\n    private fun isEnableBluetooth(): Boolean {\n        return bluetoothAdapter.isEnabled\n    }\n\n    /** BLEå¯¾å¿œæ™‚ã¯trueã‚’è¿”ã™ */\n    private fun isSupportedBLE(): Boolean {\n        return packageManager.hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)\n    }\n\n}\n```\n\n<img src=\"https://imgur.com/YlcCf5d.png\" width=300>\n\n# ããƒ¼ã™ã“ãƒ¼ã©\né–“é•ã£ã¦ãŸã‚‰ã”ã‚ã‚“ã­\n\nhttps://github.com/takusan23/CocoaBLECheckerSample\n\n\n# å‚è€ƒã«ã—ã¾ã—ãŸ\nhttps://qiita.com/Rabbit_Program/items/3c1aec6e30eb646d78a1  \nhttps://engineer.dena.com/posts/2021.02/web-bluetooth-cocoa-checker/  \nhttps://qiita.com/jp-96/items/3e5e5a12d42ba246b8c3  \nhttps://qiita.com/coppercele/items/fef9eacee05b752ed982"},{"title":"Androidã‚¢ãƒ—ãƒªå´ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å­¦ç¿’æ©Ÿèƒ½ã‚’ç„¡åŠ¹ã«ã—ãŸã„","link":"/posts/android_disable_keybord_learning/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã“ã‚Œã¯ D.C.4 ã® ç™½æ²³ã²ã‚ˆã‚Š ã¡ã‚ƒã‚“ â†˜\r\n\r\n![Imgur](https://imgur.com/8dvXL9p.png)\r\n\r\n# æœ¬é¡Œ\r\nã‚¢ãƒ—ãƒªå´ã§IMEã®å­¦ç¿’æ©Ÿèƒ½ã‚’OFFã«å‡ºæ¥ã¾ã™ã€‚  \r\nChromeã¨ã‹Firefoxã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰ã§~~ã‚„ã¾ã—ã„äº‹ã‚’~~æ¤œç´¢ã—ã‚ˆã†ã¨ã™ã‚‹éš›ã«æœ‰åŠ¹ã«ãªã£ãŸã‚Šã™ã‚‹ã€‚\r\n\r\nå…¨ã¦ã®ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚¢ãƒ—ãƒªãŒå¯¾å¿œã—ã¦ã‚‹ã‹ã¯åˆ†ã‹ã‚‰ã‚“...\r\n\r\n# ä½œã‚Šæ–¹\r\n\r\n`EditText`ã«`android:imeOptions=\"flagNoPersonalizedLearning\"`ã‚’æŒ‡å®šã™ã‚‹ã ã‘ã§ã™ã€ã¯ã„\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <EditText\r\n        android:id=\"@+id/edit_text_disable_leaning\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:hint=\"IMEã®å­¦ç¿’æ©Ÿèƒ½ãŒOFFã§ã™\"\r\n        android:imeOptions=\"flagNoPersonalizedLearning\"\r\n        android:minHeight=\"48dp\"\r\n        android:text=\"\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <EditText\r\n        android:id=\"@+id/edit_text\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:hint=\"IMEã®å­¦ç¿’æ©Ÿèƒ½ãŒONã§ã™\"\r\n        android:minHeight=\"48dp\"\r\n        android:text=\"\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/edit_text_disable_leaning\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\nã“ã‚Œã§å®Ÿè¡Œã™ã‚‹ã¨ã€EditTextãŒ2ã¤å‡ºã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\nä¸Šã®EditTextã§ã¯ä½•å›åŒã˜ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã¦ã‚‚å­¦ç¿’ã—ãªã„ï¼ˆå…¥åŠ›å€™è£œã«å‡ºã‚‹ãŒå„ªå…ˆé †ä½ãŒå¤‰ã‚ã‚‰ãªã„ï¼‰ãŒã€ä¸‹ã®EditTextã§ã¯ç‰¹ã«æŒ‡å®šã—ã¦ã„ãªã„ãŸã‚ã€  \r\n2å›ç›®ä»¥é™ã¯å…¥åŠ›å€™è£œã«å„ªå…ˆçš„ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/7jRK3ff.png)\r\nè‹¥å¹²ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®UIãŒå¤‰ã‚ã‚‹ã€‚\r\n\r\n![Imgur](https://imgur.com/TmbubM2.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# ãŠã‚ã‚Šã«\r\næœ€è¿‘ã­ã‚€ã„"},{"title":"BottomNavigationViewã‚’ç½®ã„ãŸã‚‰ã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸ","link":"/posts/android_drawable_v24/","markdown":"\r\nè‡ªåˆ†ç”¨ãƒ¡ãƒ¢\r\n\r\n## æœ¬é¡Œ\r\n```\r\nError inflating class com.google.android.material.bottomnavigation.BottomNavigationView\r\n```\r\n\r\nAndroid 11 / 10 ã§ã¯å‹•ããŒã€Android 5ã§å‹•ã‹ãã†ã¨ã—ãŸã‚‰è½ã¡ãŸ\r\n\r\n`app:menu`å±æ€§ã‚’æ¶ˆã™ã¨å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã€ã©ã†ã‚„ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒæ€ªã—ã„\r\n\r\nã¦ãªã‚ã‘ã§ãƒ¡ãƒ‹ãƒ¥ãƒ¼æ¶ˆã—ãŸã‚“ã ã‘ã©ã€ä»Šåº¦ã¯`Button`ã§ã‚¨ãƒ©ãƒ¼ãŒ\r\n\r\n## åŸå› \r\n`app:icon`ã«æŒ‡å®šã—ãŸ`drawable`ãŒ`drawable-v24`ãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã£ã¦ãŸã€‚  \r\n\r\nä½¿ã†`drawable-v24`ã«ã‚ã‚‹`xml`ã‚’ã™ã¹ã¦`drawable`ã«å…¥ã‚ŒãŸã‚‰èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚è‰¯ã‹ã£ãŸã€‚"},{"title":"FragmentãŒä½œã‚Œãªã„","link":"/posts/android_fragment_tukurenai/","markdown":"\r\nFragmentã‚’ä½œã‚ã†ã¨ã™ã‚‹ã¨è¬ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç”Ÿæˆã—ãªã„ã¨ã„ã‘ãªããªã£ã¦ãŸã€‚ã—ã‹ã‚‚ä½•è¿”ã›ã°ã„ã„ã‚“ã ã“ã‚Œ\r\n\r\n```kotlin\r\nclass BlogListFragment : Fragment() {\r\n\r\n    override fun <I : Any?, O : Any?> prepareCall(\r\n        contract: ActivityResultContract<I, O>,\r\n        callback: ActivityResultCallback<O>\r\n    ): ActivityResultLauncher<I> {\r\n\r\n    }\r\n\r\n    override fun <I : Any?, O : Any?> prepareCall(\r\n        contract: ActivityResultContract<I, O>,\r\n        registry: ActivityResultRegistry,\r\n        callback: ActivityResultCallback<O>\r\n    ): ActivityResultLauncher<I> {\r\n\r\n    }\r\n    \r\n}\r\n```\r\n\r\n## è§£æ±º\r\nFragmentã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã¾ã™ã€‚  \r\n`app`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹`build.gradle`ã‚’é–‹ã„ã¦ã€`dependencies`ã«ä¸€è¡Œè¶³ã—ã¾ã™ã€‚\r\n\r\n```\r\ndependencies {\r\n    // Fragmentã‚’ä½œã‚ã†ã¨ã™ã‚‹ã¨è¬ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã›ã‚ˆã†ã¨ã™ã‚‹ã®ã§\r\n    implementation 'androidx.fragment:fragment-ktx:1.3.0-rc01'\r\n}\r\n```\r\n\r\n## å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://stackoverflow.com/questions/65342763/unable-to-create-fragment-class-in-jetpack-compose"},{"title":"Android ã§å‰é¢ã¨èƒŒé¢ã‚’åŒæ™‚ã«æ’®å½±ã§ãã‚‹ã‚«ãƒ¡ãƒ©ã‚’ä½œã‚ŠãŸã„","link":"/posts/android_front_back_camera/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚  \r\næ–°ç¤¾ä¼šäººã¸ã€æ–°äººã‚‰ã—ããªã„ã¨ã‹è¨€ã‚ã‚ŒãŸã®ã§æ–°äººã‚‰ã—ãã—ã¾ã—ã‚‡ã†ã­ã€‚ï¼ˆå£°ã‚’ãƒ¯ãƒ³ãƒˆãƒ¼ãƒ³ä¸Šã’ã‚‹ã¨ã‹ï¼‰  \r\nåŒæœŸã¯å¤§äº‹ã«ã—ã‚ˆã†ã€‚è»¢è·ã—ã¦ã—ã¾ã„ã¾ã—ãŸãŒã„ã¤ã®é–“ã«ã‹åŒæœŸã¯ã„ãªããªã£ã¦ã¾ã—ãŸã€ã€ã€  \r\n\r\nã‚ã¨zipãƒ•ã‚¡ã‚¤ãƒ«ã‚’è§£å‡ã¨è¨€ã‚ã‚ŒãŸã‚‰å±•é–‹ã®ã“ã¨ã§ã™ã€‚\r\n# ã»ã‚“ã ã„\r\nå‰é¢ã‚«ãƒ¡ãƒ©ã¨èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’åŒæ™‚ã«é–‹ã„ã¦ã€ãƒ¯ã‚¤ãƒ—ã‚«ãƒ¡ãƒ©ï¼Ÿãƒãƒ«ãƒã‚«ãƒ¡ãƒ©ï¼Ÿå‡ºæ¥ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\nã™ã§ã«ã‚ã‚Šãã†ã ã‘ã©ã€ã€ã€\r\n\r\n![Imgur](https://imgur.com/PACr0Zx.png)\r\n\r\n![Imgur](https://imgur.com/2mjyEvn.png)\r\n\r\n# ã‹ã‚“ãã‚‡ã†\r\n\r\n| ãªã¾ãˆ        | ã‚ãŸã„                                                                                      |\r\n|---------------|---------------------------------------------------------------------------------------------|\r\n| è¨€èª          | Kotlin ã¨ OpenGL ã‚’ä½¿ã†ãŸã‚ GLSL                                                            |\r\n| ç«¯æœ«          | Pixel 6 Pro / Xperia Pro-I (ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ™‚ç‚¹ã§ Android 11 ä»¥ä¸Šã‚’æ­è¼‰ã—ãŸç«¯æœ«ãŒå¿…è¦å¤šåˆ†) |\r\n| minSdkVersion | 30                                                                                          |\r\n\r\n`Jetpack Compose`ã‚’UIæ§‹ç¯‰ã«ä½¿ã„ã¾ã™ãŒã€`SurfaceView`ã‚’ä¸»ã«ä½¿ã†ã“ã¨ã«ãªã‚‹ã®ã§åˆ¥ã«`View`ã§ã‚‚ã„ã„ã§ã™ã€‚  \r\nã‚ã¨ Kotlin Coroutine ã‚‚ä½¿ã„ã¾ã™ã€‚ä¾¿åˆ©\r\n\r\n## minSdk\r\nåŒæ™‚ã«ã‚«ãƒ¡ãƒ©ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã™ã‚‹æ©Ÿèƒ½ãŒã€SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ 30ï¼ˆAndroid 11ï¼‰ã‹ã‚‰ã§ã™ã€‚  \r\nãŸã ã€Androidã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’ã™ã‚Œã°ã‚ˆã„ã‚ã‘ã§ã¯ãªãã€ãŠãã‚‰ããƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ¬ãƒ™ãƒ«ã§åŒæ™‚ã«ã‚«ãƒ¡ãƒ©ã‚’é–‹ãæ©Ÿèƒ½ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€  \r\n**Android 11ä»¥é™ãŒãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ç«¯æœ«ã§ãªã„ã¨ãƒ€ãƒ¡ã ã¨æ€ã„ã¾ã™ã€‚**  \r\nä»¥ä¸‹ã®é–¢æ•°ã§åŒæ™‚ã«é–‹ãã“ã¨ãŒå‡ºæ¥ã‚‹ã‚«ãƒ¡ãƒ©ï¼ˆã‚«ãƒ¡ãƒ©IDï¼‰ã®çµ„ã¿åˆã‚ã›ãŒå–å¾—ã§ãã¾ã™ã€‚è¿”ã£ã¦ã“ãªã„å ´åˆã¯å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ï¼\r\n\r\nhttps://developer.android.com/reference/android/hardware/camera2/CameraManager#getConcurrentCameraIds()\r\n\r\nãã‚Œä»¥å¤–ã¯ç‰¹ã«è¨˜è¿°ã•ã‚Œã¦ã„ãªã„ã®ã§ï¼Ÿå¤šåˆ†`Camera2 API`ã§å‰é¢èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’æ™®é€šã«é–‹ã‘ã°ã„ã„ã‚“ã˜ã‚ƒãªã„ã‹ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚\r\n\r\n[https://dic.nicovideo.jp/a/windows 8#h2-4](https://dic.nicovideo.jp/a/windows%208#h2-4)\r\n\r\n## ã—ãã¿\r\nä»Šå›ã¯éŒ²ç”»æ©Ÿèƒ½ã‚’ã¤ã‘ãŸã„ãŸã‚ã€`SurfaceView` ã‚’2ã¤åˆ©ç”¨ã—ã¦å‰é¢ã¨èƒŒé¢ã‚’è¡¨ç¤ºã™ã‚‹ã®ã§ã¯ãªãã€ä¸€ã¤ã® `SurfaceView` ã«å‰é¢ã¨èƒŒé¢ã®ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’åˆæˆã—ãŸçŠ¶æ…‹ã§è¡¨ç¤ºã•ã›ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\nãã®ã€ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’åˆæˆã™ã‚‹ãŸã‚ã« `OpenGL` ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚ã‚«ãƒ¡ãƒ©æ˜ åƒã¯ `SurfaceTexture` ã‚’ä½¿ã†ã“ã¨ã§ã€ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã‹ã‚‰ãƒ†ã‚¯ã‚¹ãƒãƒ£ï¼ˆç”»åƒï¼‰ã¨ã—ã¦åˆ©ç”¨ã§ãã¾ã™ã€‚  \r\n`SurfaceTexture`ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãŒæ¥ãŸã“ã¨ã‚’é€šçŸ¥ã—ã¦ãã‚Œã‚‹ã®ã§ã€æ¥ãŸã‚‰`glDrawArrays`ã—ã¦æç”»ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/s0Qtjhx.png)\r\n\r\nä»Šå›ã‚‚OpenGLå‘¨ã‚Šã¯AOSPã®ã‚³ãƒ¼ãƒ‰ã‚’ãƒ‘ã‚¯ã£ã¦æ¥ã‚ˆã†ã¨æ€ã„ã¾ã™ã€ã€ã€ï¼ˆApache License 2.0ï¼‰  \r\nã¾ãŸã€ä»Šå›ã‚‚ CameraX ã¯ä½¿ã‚ãšã« Camera2 API ã‚’ãã®ã¾ã¾å©ã“ã†ã¨æ€ã„ã¾ã™ã€CameraX API ã‚ã¡ã‚ƒãƒ¢ãƒ€ãƒ³ãªAPIã§æ°—ã«ãªã‚‹ã‘ã©ã€SurfaceTexture + OpenGL ã¿ãŸã„ãªã“ã¨ã£ã¦å‡ºæ¥ã‚‹ã®ã‹ãªã€ã€ã€ã€‚\r\n\r\næµçŸ³ã«ã‚„ã‚Šã¾ã›ã‚“ãŒã€é™æ­¢ç”»æ’®å½±ã ã‘ãªã‚‰ã€`SurfaceView`ã‚’2ã¤ä½¿ã£ã¦Androidã®`PixelCopy`ã‚’ä½¿ã†æ‰‹ã‚‚ã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€ã€ã€  \r\n~~Bitmapé‡ã­ã‚‹ã‚ˆã‚Šã¯ãƒã‚·~~\r\n\r\n## ã¤ãã‚‹\r\nTarget SDK 30 ä»¥ä¸Šã§ä½œã‚Šã¾ã™  \r\nå‰²ã¨åˆã‚ã¦çœŸé¢ç›®ã«ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€ã€ã€\r\n\r\n![Imgur](https://imgur.com/BsCga8R.png)\r\n\r\n# AndroidManifest.xml\r\nã‚«ãƒ¡ãƒ©æ¨©é™ã¨éŒ²ç”»ã§ä½¿ã†ãƒã‚¤ã‚¯æ¨©é™ã‚’\r\n\r\n```xml\r\n    <uses-permission android:name=\"android.permission.CAMERA\" />\r\n    <uses-permission android:name=\"android.permission.RECORD_AUDIO\" />\r\n```\r\n\r\n# ã‚«ãƒ¡ãƒ©ç·¨\r\n`Camera2 API`ãªã®ã§é•·ã€…ã—ã„ã‚³ãƒ¼ãƒ‰ãŒç¶šãã¾ã™ã€ã€ã€\r\n\r\n## å‰é¢ã€èƒŒé¢ã‚«ãƒ¡ãƒ©ã‚’ç®¡ç†ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\nä»Šå›ã¯ã€å‰é¢ã¨èƒŒé¢ã‚«ãƒ¡ãƒ©ã€ãã‚Œãã‚Œã“ã®ã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚  \r\nã‚¯ãƒ©ã‚¹ã®åå‰ã©ã†ã«ã‹ã—ã‚ã‚ˆã€ã€ã€\r\n\r\n```kotlin\r\n/**\r\n * ã‚«ãƒ¡ãƒ©ã‚’é–‹ã‘ãŸã‚Šé–‰ã˜ãŸã‚Šã™ã‚‹å‡¦ç†ã‚’éš è”½ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\n * \r\n * @param context [Context]\r\n * @param cameraId ã‚«ãƒ¡ãƒ©IDã€å‰é¢ or èƒŒé¢\r\n * @param previewSurface ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼Surface\r\n */\r\nclass CameraControl(\r\n    private val context: Context,\r\n    private val cameraId: String,\r\n    private val previewSurface: Surface,\r\n) {\r\n    private val cameraManager = context.getSystemService(Context.CAMERA_SERVICE) as CameraManager\r\n    private val cameraExecutor = Executors.newSingleThreadExecutor()\r\n    private var cameraDevice: CameraDevice? = null\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    suspend fun openCamera() {\r\n        cameraDevice = waitOpenCamera()\r\n    }\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‡ºã™ */\r\n    fun startPreview() {\r\n        val cameraDevice = cameraDevice ?: return\r\n        val captureRequest = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_PREVIEW).apply {\r\n            addTarget(previewSurface)\r\n        }.build()\r\n        val outputList = buildList {\r\n            add(OutputConfiguration(previewSurface))\r\n        }\r\n        SessionConfiguration(SessionConfiguration.SESSION_REGULAR, outputList, cameraExecutor, object : CameraCaptureSession.StateCallback() {\r\n            override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                captureSession.setRepeatingRequest(captureRequest, null, null)\r\n            }\r\n\r\n            override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n                // do nothing\r\n            }\r\n        }).apply { cameraDevice.createCaptureSession(this) }\r\n    }\r\n\r\n    /** çµ‚äº†æ™‚ã«å‘¼ã³å‡ºã™ */\r\n    fun destroy() {\r\n        cameraDevice?.close()\r\n    }\r\n\r\n    /** [cameraId]ã®ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    @SuppressLint(\"MissingPermission\")\r\n    suspend private fun waitOpenCamera() = suspendCoroutine {\r\n        cameraManager.openCamera(cameraId, cameraExecutor, object : CameraDevice.StateCallback() {\r\n            override fun onOpened(camera: CameraDevice) {\r\n                it.resume(camera)\r\n            }\r\n\r\n            override fun onDisconnected(camera: CameraDevice) {\r\n                // do nothing\r\n            }\r\n\r\n            override fun onError(camera: CameraDevice, error: Int) {\r\n                // do nothing\r\n            }\r\n        })\r\n    }\r\n\r\n}\r\n```\r\nã‚«ãƒ¡ãƒ©IDã«å¯¾å¿œã—ãŸã‚«ãƒ¡ãƒ©ã‚’é–‹ã„ã¦ã€Surfaceã«æ˜ åƒã‚’å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«è¨­å®šã—ã¦ã€ãƒ©ã‚¤ãƒ•ã‚µã‚¤ã‚¯ãƒ«ãŒ `onDestroy` ã«ãªã£ãŸã‚‰çµ‚äº†ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\r\n\r\n## ã‚«ãƒ¡ãƒ©IDã‚’å–å¾—ã™ã‚‹é–¢æ•°\r\n`cameraIdList`ã§ã‚«ãƒ¡ãƒ©ãŒå–å¾—ã§ãã‚‹ã®ã§ã€`CameraCharacteristics.LENS_FACING`ã§ å‰é¢ or èƒŒé¢ ã©ã£ã¡ã®ã‚«ãƒ¡ãƒ©ã‹å–å¾—ã§ãã¾ã™ã€‚  \r\nãªã‚“ã‹`cameraIdList`ã€ãƒ•ãƒ­ãƒ³ãƒˆã¨ã‚«ãƒ¡ãƒ©ã§2ã¤ã—ã‹å¸°ã£ã¦ã“ãªã„ã¨æ€ã£ã¦ãŸã‚“ã ã‘ã© (Pixel 6 Pro) ã€ãªã‚“ã‹ã„ã£ã±ã„ã‚ã‚‹ç«¯æœ«ã‚‚ã‚ã‚‹ (Xperia Pro-I ã®å ´åˆã¯ è¶…åºƒè§’ åºƒè§’ é€šå¸¸ ã‚«ãƒ¡ãƒ©ã«ã‚‚ãã‚Œãã‚Œ ã‚«ãƒ¡ãƒ©ID ãŒå‰²ã‚Šå½“ã¦ã‚‰ã‚Œã¦ã‚‹ï¼Ÿ)\r\n\r\n```kotlin\r\nobject CameraTool {\r\n\r\n    /** å‰é¢ã€èƒŒé¢ ã‚«ãƒ¡ãƒ©ã®IDã‚’è¿”ã™ */\r\n    fun getCameraId(context: Context): Pair<String, String> {\r\n        val cameraManager = context.getSystemService(Context.CAMERA_SERVICE) as CameraManager\r\n        val backCameraId = cameraManager.cameraIdList.first { cameraManager.getCameraCharacteristics(it).get(CameraCharacteristics.LENS_FACING) == CameraCharacteristics.LENS_FACING_BACK }\r\n        val frontCameraId = cameraManager.cameraIdList.first { cameraManager.getCameraCharacteristics(it).get(CameraCharacteristics.LENS_FACING) == CameraCharacteristics.LENS_FACING_FRONT }\r\n        return backCameraId to frontCameraId\r\n    }\r\n\r\n}\r\n```\r\n\r\n# OpenGL ç·¨\r\nå‚è€ƒã«ã—ãŸ AOSP ã®ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™ã€‚thx  \r\nhttps://cs.android.com/android/platform/superproject/+/master:cts/tests/tests/media/common/src/android/media/cts/InputSurface.java;l=1\r\n\r\n## GLSurface\r\n`GLSurfaceView` ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã„ããªã‚Šã‚·ã‚§ãƒ¼ãƒ€ãƒ¼æ›¸ãã¨ã“ã‚ã‹ã‚‰å§‹ã‚ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã‚‚ã€ä»Šå›`GLSurfaceView`ã‚’åˆ©ç”¨ã—ã¦ã‚‚å•é¡Œãªã„ã¯ãšã§ã™ã€‚  \r\nã§ã‚‚ãªã‚“ã§ä»Šå›ã¯ä½¿ã£ã¦ãªã„ã‹ã¨ã„ã†ã¨ã€ä»Šå›ã¯éŒ²ç”»æ©Ÿèƒ½ã‚’ã¤ã‘ã‚‹ãŸã‚ã§ã™ã€‚é™æ­¢ç”»æ’®å½±ãªã‚‰`GLSurfaceView`ã§å‡ºæ¥ã‚‹ã¯ãšã§ã™ã€‚ï¼ˆ`glReadPixels`ä½¿ã†ãªã‚‰ï¼‰  \r\n\r\n`GLSurfaceView`ã‚’éŒ²ç”»ã§ãã‚‹ä¾¿åˆ©ãªæ©Ÿèƒ½ãªã‚“ã¦ç„¡ã„ãŸã‚ã€`MediaRecorder`ã§éŒ²ç”»ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nã—ã‹ã—ã€`MediaRecorder`ã®å…¥åŠ›ã«ã¯`GLSurfaceView (SurfaceView)`ã§ã¯ãªãã€`Surface`ã—ã‹å—ã‘ä»˜ã‘ã¾ã›ã‚“ã€‚  \r\nãªã®ã§ã€å…¥åŠ›ç”¨`Surface`ã«`OpenGL`ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°çµæœã‚’å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€ãã‚Œã«ã¯`OpenGL`ã®å‡ºåŠ›ã‚’`Surface`ã«ã™ã‚‹ãŸã‚ã®å‡¦ç†ã‚’1ã‹ã‚‰æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n`SurfaceView`ã¨`OpenGL`ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ãŒ`GLSurfaceView`ãªã®ã§ã™ãŒã€ä»Šå›ã»ã—ã„ã®ã¯`Surface`ã¨`OpenGL`ã‚’ã¾ã¨ã‚ãŸã‚‚ã®ãªã®ã§ã™ã€‚ã§ã‚‚`GLSurface`ã‚¯ãƒ©ã‚¹ãªã‚“ã¦ç„¡ã„ã®ã§ä½œã‚Šã¾ã™ã€ã€ã€  \r\n\r\n`Surface`ãŒå–ã‚Œã‚Œã°ã„ã„ã®ã§ã€`SurfaceView`ã§ã‚‚ã‚‚ã¡ã‚ã‚“ä½¿ãˆã¾ã™ã€‚\r\n\r\nä»¥ä¸‹ãŒã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ãŠãã‚‰ã`GLSurfaceView`å†…éƒ¨ã§ã‚„ã£ã¦ã‚‹ã“ã¨ã‚’ã‚„ã£ã¦ã‚‹ã ã‘ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n// å‚è€ƒã«ã—ãŸ AOSP ã®ã‚³ãƒ¼ãƒ‰ : https://cs.android.com/android/platform/superproject/+/master:cts/tests/tests/media/common/src/android/media/cts/InputSurface.java\r\n\r\n/**\r\n * [Surface]ã¨OpenGLã‚’é€£æºã•ã›ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹\r\n * æœ¬æ¥ [android.opengl.GLSurfaceView] ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ EGL ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’çœç•¥ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€\r\n * ä»Šå›ã¯ [android.view.SurfaceView] ã§ã¯ãªã [Surface] ã ã‘ã§ OpenGL ã‚’åˆ©ç”¨ã—ãŸã„ãŸã‚ã€EGLã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‹ã‚‰è¨˜è¿°ã—ã¦ã„ã‚‹ã€‚\r\n */\r\nclass GLSurface(\r\n    private val surface: Surface,\r\n    private val renderer: CameraGLRenderer\r\n) {\r\n    private var mEGLDisplay = EGL14.EGL_NO_DISPLAY\r\n    private var mEGLContext = EGL14.EGL_NO_CONTEXT\r\n    private var mEGLSurface = EGL14.EGL_NO_SURFACE\r\n\r\n    init {\r\n        eglSetup()\r\n    }\r\n\r\n    /**\r\n     * Prepares EGL.  We want a GLES 2.0 context and a surface that supports recording.\r\n     */\r\n    private fun eglSetup() {\r\n        mEGLDisplay = EGL14.eglGetDisplay(EGL14.EGL_DEFAULT_DISPLAY)\r\n        if (mEGLDisplay == EGL14.EGL_NO_DISPLAY) {\r\n            throw RuntimeException(\"unable to get EGL14 display\")\r\n        }\r\n        val version = IntArray(2)\r\n        if (!EGL14.eglInitialize(mEGLDisplay, version, 0, version, 1)) {\r\n            throw RuntimeException(\"unable to initialize EGL14\")\r\n        }\r\n        // Configure EGL for recording and OpenGL ES 2.0.\r\n        val attribList = intArrayOf(\r\n            EGL14.EGL_RED_SIZE, 8,\r\n            EGL14.EGL_GREEN_SIZE, 8,\r\n            EGL14.EGL_BLUE_SIZE, 8,\r\n            EGL14.EGL_ALPHA_SIZE, 8,\r\n            EGL14.EGL_RENDERABLE_TYPE, EGL14.EGL_OPENGL_ES2_BIT,\r\n            EGL_RECORDABLE_ANDROID, 1,\r\n            EGL14.EGL_NONE\r\n        )\r\n        val configs = arrayOfNulls<EGLConfig>(1)\r\n        val numConfigs = IntArray(1)\r\n        EGL14.eglChooseConfig(mEGLDisplay, attribList, 0, configs, 0, configs.size, numConfigs, 0)\r\n        checkEglError(\"eglCreateContext RGB888+recordable ES2\")\r\n\r\n        // Configure context for OpenGL ES 2.0.\r\n        val attrib_list = intArrayOf(\r\n            EGL14.EGL_CONTEXT_CLIENT_VERSION, 2,\r\n            EGL14.EGL_NONE\r\n        )\r\n        mEGLContext = EGL14.eglCreateContext(\r\n            mEGLDisplay, configs[0], EGL14.EGL_NO_CONTEXT,\r\n            attrib_list, 0\r\n        )\r\n        checkEglError(\"eglCreateContext\")\r\n\r\n        // Create a window surface, and attach it to the Surface we received.\r\n        val surfaceAttribs = intArrayOf(\r\n            EGL14.EGL_NONE\r\n        )\r\n        mEGLSurface = EGL14.eglCreateWindowSurface(mEGLDisplay, configs[0], surface, surfaceAttribs, 0)\r\n        checkEglError(\"eglCreateWindowSurface\")\r\n    }\r\n\r\n    /** æç”»ã™ã‚‹ */\r\n    fun drawFrame() {\r\n        renderer.onDrawFrame()\r\n    }\r\n\r\n    /**\r\n     * Discards all resources held by this class, notably the EGL context.\r\n     */\r\n    fun release() {\r\n        if (mEGLDisplay != EGL14.EGL_NO_DISPLAY) {\r\n            EGL14.eglMakeCurrent(mEGLDisplay, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_SURFACE, EGL14.EGL_NO_CONTEXT)\r\n            EGL14.eglDestroySurface(mEGLDisplay, mEGLSurface)\r\n            EGL14.eglDestroyContext(mEGLDisplay, mEGLContext)\r\n            EGL14.eglReleaseThread()\r\n            EGL14.eglTerminate(mEGLDisplay)\r\n        }\r\n        // surface.release() // GLã¯ç ´æ£„ã—ãªã„\r\n        mEGLDisplay = EGL14.EGL_NO_DISPLAY\r\n        mEGLContext = EGL14.EGL_NO_CONTEXT\r\n        mEGLSurface = EGL14.EGL_NO_SURFACE\r\n    }\r\n\r\n    /**\r\n     * Makes our EGL context and surface current.\r\n     */\r\n    fun makeCurrent() {\r\n        EGL14.eglMakeCurrent(mEGLDisplay, mEGLSurface, mEGLSurface, mEGLContext)\r\n        checkEglError(\"eglMakeCurrent\")\r\n    }\r\n\r\n    /**\r\n     * Calls eglSwapBuffers.  Use this to \"publish\" the current frame.\r\n     */\r\n    fun swapBuffers(): Boolean {\r\n        val result = EGL14.eglSwapBuffers(mEGLDisplay, mEGLSurface)\r\n        checkEglError(\"eglSwapBuffers\")\r\n        return result\r\n    }\r\n\r\n    /**\r\n     * Sends the presentation time stamp to EGL.  Time is expressed in nanoseconds.\r\n     */\r\n    fun setPresentationTime(nsecs: Long) {\r\n        EGLExt.eglPresentationTimeANDROID(mEGLDisplay, mEGLSurface, nsecs)\r\n        checkEglError(\"eglPresentationTimeANDROID\")\r\n    }\r\n\r\n    /**\r\n     * Checks for EGL errors.  Throws an exception if one is found.\r\n     */\r\n    private fun checkEglError(msg: String) {\r\n        val error = EGL14.eglGetError()\r\n        if (error != EGL14.EGL_SUCCESS) {\r\n            throw RuntimeException(\"$msg: EGL error: 0x${Integer.toHexString(error)}\")\r\n        }\r\n    }\r\n\r\n    companion object {\r\n        private const val EGL_RECORDABLE_ANDROID = 0x3142\r\n    }\r\n}\r\n```\r\n\r\n## CameraGLRenderer\r\nã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚  \r\nãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ã€ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ã‚‚ã“ã“ã«æ›¸ãã¾ã™ï¼ˆåˆ¥ã« .glsl ã«ã—ã¦ã‚‚ã„ã„ã§ã™ãŒï¼‰ã€‚\r\n\r\n```kotlin\r\n/**\r\n * ã‚«ãƒ¡ãƒ©æ˜ åƒã‚’ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹\r\n * ãƒ•ãƒ­ãƒ³ãƒˆã€ãƒãƒƒã‚¯ã§ã¯ãªãã€ãƒ¡ã‚¤ãƒ³ã€ã‚µãƒ–ã«ã—ã¦ã„ã‚‹ã€‚å¾Œã§åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½ã‚’ä½œã‚‹ãŸã‚\r\n *\r\n * @param rotation æ˜ åƒã‚’å›è»¢ã™ã‚‹\r\n * @param mainSurfaceTexture ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n * @param subSurfaceTexture ã‚µãƒ–æ˜ åƒã€‚ãƒ¯ã‚¤ãƒ—ã‚«ãƒ¡ãƒ©\r\n */\r\nclass CameraGLRenderer(\r\n    private val rotation: Float,\r\n    private val mainSurfaceTexture: () -> SurfaceTexture,\r\n    private val subSurfaceTexture: () -> SurfaceTexture,\r\n) {\r\n\r\n    private val mMVPMatrix = FloatArray(16)\r\n    private val mSTMatrix = FloatArray(16)\r\n    private val mTriangleVertices = ByteBuffer.allocateDirect(mTriangleVerticesData.size * FLOAT_SIZE_BYTES).run {\r\n        order(ByteOrder.nativeOrder())\r\n        asFloatBuffer().apply {\r\n            put(mTriangleVerticesData)\r\n            position(0)\r\n        }\r\n    }\r\n\r\n    // ãƒãƒ³ãƒ‰ãƒ«ãŸã¡\r\n    private var mProgram = 0\r\n    private var muMVPMatrixHandle = 0\r\n    private var muSTMatrixHandle = 0\r\n    private var maPositionHandle = 0\r\n    private var maTextureHandle = 0\r\n\r\n    // ãƒ†ã‚¯ã‚¹ãƒãƒ£ID\r\n    // SurfaceTexture ã«æ¸¡ã™\r\n    private var mainCameraTextureId = 0\r\n    private var subCameraTextureId = 0\r\n\r\n    // ãƒ†ã‚¯ã‚¹ãƒãƒ£ã®ãƒãƒ³ãƒ‰ãƒ«\r\n    private var uMainCameraTextureHandle = 0\r\n    private var uSubCameraTextureHandle = 0\r\n    private var uDrawMainCameraHandle = 0\r\n\r\n    /** æç”»ã™ã‚‹ */\r\n    fun onDrawFrame() {\r\n        prepareDraw()\r\n        drawMainCamera(mainSurfaceTexture())\r\n        drawSubCamera(subSurfaceTexture())\r\n        GLES20.glFinish()\r\n    }\r\n\r\n    /**\r\n     * ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã®ç”¨æ„ã‚’ã™ã‚‹ã€‚\r\n     * ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã‚’è¿”ã™ã®ã§ã€SurfaceTexture ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿å…¥ã‚Œã¦ã­ã€‚\r\n     *\r\n     * @return ãƒ¡ã‚¤ãƒ³æ˜ åƒã€ã‚µãƒ–æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã€‚SurfaceTexture ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ ã«å…¥ã‚Œã‚‹ã€‚\r\n     */\r\n    fun setupProgram(): Pair<Int, Int> {\r\n        mProgram = createProgram(VERTEX_SHADER, FRAGMENT_SHADER)\r\n        if (mProgram == 0) {\r\n            throw RuntimeException(\"failed creating program\")\r\n        }\r\n        maPositionHandle = GLES20.glGetAttribLocation(mProgram, \"aPosition\")\r\n        checkGlError(\"glGetAttribLocation aPosition\")\r\n        if (maPositionHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for aPosition\")\r\n        }\r\n        maTextureHandle = GLES20.glGetAttribLocation(mProgram, \"aTextureCoord\")\r\n        checkGlError(\"glGetAttribLocation aTextureCoord\")\r\n        if (maTextureHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for aTextureCoord\")\r\n        }\r\n        muMVPMatrixHandle = GLES20.glGetUniformLocation(mProgram, \"uMVPMatrix\")\r\n        checkGlError(\"glGetUniformLocation uMVPMatrix\")\r\n        if (muMVPMatrixHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uMVPMatrix\")\r\n        }\r\n        muSTMatrixHandle = GLES20.glGetUniformLocation(mProgram, \"uSTMatrix\")\r\n        checkGlError(\"glGetUniformLocation uSTMatrix\")\r\n        if (muSTMatrixHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uSTMatrix\")\r\n        }\r\n        uMainCameraTextureHandle = GLES20.glGetUniformLocation(mProgram, \"uMainCameraTexture\")\r\n        checkGlError(\"glGetUniformLocation uMainCameraTextureHandle\")\r\n        if (uMainCameraTextureHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uMainCameraTextureHandle\")\r\n        }\r\n        uSubCameraTextureHandle = GLES20.glGetUniformLocation(mProgram, \"uSubCameraTexture\")\r\n        checkGlError(\"glGetUniformLocation uSubCameraTexture\")\r\n        if (uSubCameraTextureHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uSubCameraTexture\")\r\n        }\r\n        uDrawMainCameraHandle = GLES20.glGetUniformLocation(mProgram, \"uDrawMainCamera\")\r\n        checkGlError(\"glGetUniformLocation uDrawMainCameraHandle\")\r\n        if (uDrawMainCameraHandle == -1) {\r\n            throw RuntimeException(\"Could not get attrib location for uDrawMainCameraHandle\")\r\n        }\r\n\r\n        // ã‚«ãƒ¡ãƒ©2ã¤ãªã®ã§ã€2ã¤åˆ†ã®ãƒ†ã‚¯ã‚¹ãƒãƒ£ã‚’ä½œæˆ\r\n        val textures = IntArray(2)\r\n        GLES20.glGenTextures(2, textures, 0)\r\n\r\n        // ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n        mainCameraTextureId = textures[0]\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)\r\n        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, mainCameraTextureId)\r\n        checkGlError(\"glBindTexture mainCameraTextureId\")\r\n\r\n        // ç¸®å°æ‹¡å¤§æ™‚ã®è£œé–“è¨­å®š\r\n        GLES20.glTexParameterf(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_NEAREST.toFloat())\r\n        GLES20.glTexParameterf(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR.toFloat())\r\n        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE)\r\n        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE)\r\n        checkGlError(\"glTexParameteri mainCameraTexture\")\r\n\r\n        // ã‚µãƒ–æ˜ åƒ\r\n        subCameraTextureId = textures[1]\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)\r\n        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, subCameraTextureId)\r\n        checkGlError(\"glBindTexture subCameraTextureId\")\r\n\r\n        // ç¸®å°æ‹¡å¤§æ™‚ã®è£œé–“è¨­å®š\r\n        GLES20.glTexParameterf(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_MIN_FILTER, GLES20.GL_NEAREST.toFloat())\r\n        GLES20.glTexParameterf(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_MAG_FILTER, GLES20.GL_LINEAR.toFloat())\r\n        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_WRAP_S, GLES20.GL_CLAMP_TO_EDGE)\r\n        GLES20.glTexParameteri(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, GLES20.GL_TEXTURE_WRAP_T, GLES20.GL_CLAMP_TO_EDGE)\r\n        checkGlError(\"glTexParameteri subCameraTexture\")\r\n\r\n        // ã‚¢ãƒ«ãƒ•ã‚¡ãƒ–ãƒ¬ãƒ³ãƒ‰ã‚’æœ‰åŠ¹\r\n        // ã“ã‚Œã«ã‚ˆã‚Šã€é€æ˜ãªãƒ†ã‚¯ã‚¹ãƒãƒ£ãŒã¡ã‚ƒã‚“ã¨é€æ˜ã«æç”»ã•ã‚Œã‚‹\r\n        GLES20.glEnable(GLES20.GL_BLEND)\r\n        GLES20.glBlendFunc(GLES20.GL_SRC_ALPHA, GLES20.GL_ONE_MINUS_SRC_ALPHA)\r\n        checkGlError(\"glEnable BLEND\")\r\n\r\n        return subCameraTextureId to mainCameraTextureId\r\n    }\r\n\r\n    /** æç”»å‰ã«å‘¼ã³å‡ºã™ */\r\n    private fun prepareDraw() {\r\n        // glError 1282 ã®åŸå› ã¨ã‹ã«ãªã‚‹\r\n        GLES20.glUseProgram(mProgram)\r\n        checkGlError(\"glUseProgram\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_POS_OFFSET)\r\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maPosition\")\r\n        GLES20.glEnableVertexAttribArray(maPositionHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maPositionHandle\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_UV_OFFSET)\r\n        GLES20.glVertexAttribPointer(maTextureHandle, 2, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maTextureHandle\")\r\n        GLES20.glEnableVertexAttribArray(maTextureHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maTextureHandle\")\r\n\r\n        // Snapdragon ã ã¨ glClear ãŒç„¡ã„ã¨æ˜ åƒãŒä¹±ã‚Œã‚‹\r\n        GLES20.glClear(GLES20.GL_DEPTH_BUFFER_BIT or GLES20.GL_COLOR_BUFFER_BIT)\r\n    }\r\n\r\n    /** ãƒ¡ã‚¤ãƒ³æ˜ åƒã® [SurfaceTexture] ã‚’æç”»ã™ã‚‹ */\r\n    private fun drawMainCamera(surfaceTexture: SurfaceTexture) {\r\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£æ›´æ–°ã€‚å‘¼ã°ãªã„ã¨çœŸã£é»’\r\n        surfaceTexture.updateTexImage()\r\n        checkGlError(\"drawMainCamera start\")\r\n        surfaceTexture.getTransformMatrix(mSTMatrix)\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE0)\r\n        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, subCameraTextureId)\r\n        // ãƒ¡ã‚¤ãƒ³æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã¯ GLES20.GL_TEXTURE0 ãªã®ã§ 0\r\n        GLES20.glUniform1i(uMainCameraTextureHandle, 0)\r\n        // ã‚µãƒ–æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã¯ GLES20.GL_TEXTURE1 ãªã®ã§ 1\r\n        GLES20.glUniform1i(uSubCameraTextureHandle, 1)\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_POS_OFFSET)\r\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maPosition\")\r\n        GLES20.glEnableVertexAttribArray(maPositionHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maPositionHandle\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_UV_OFFSET)\r\n        GLES20.glVertexAttribPointer(maTextureHandle, 2, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maTextureHandle\")\r\n        GLES20.glEnableVertexAttribArray(maTextureHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maTextureHandle\")\r\n        // ----\r\n        // ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚’æç”»ã™ã‚‹ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n        // ----\r\n        GLES20.glUniform1i(uDrawMainCameraHandle, 1)\r\n        // Matrix.XXX ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¼é–¢æ•°ã§è¡Œåˆ—ã®æ“ä½œã‚’ã™ã‚‹å ´åˆã€é©ç”¨ã•ã›ã‚‹é †ç•ªã«æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\r\n        Matrix.setIdentityM(mMVPMatrix, 0)\r\n        // ç”»é¢å›è»¢ã—ã¦ã„ã‚‹å ´åˆã¯å›è»¢ã™ã‚‹\r\n        Matrix.rotateM(mMVPMatrix, 0, rotation, 0f, 0f, 1f)\r\n\r\n        // æç”»ã™ã‚‹\r\n        GLES20.glUniformMatrix4fv(muSTMatrixHandle, 1, false, mSTMatrix, 0)\r\n        GLES20.glUniformMatrix4fv(muMVPMatrixHandle, 1, false, mMVPMatrix, 0)\r\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4)\r\n        checkGlError(\"glDrawArrays drawMainCamera\")\r\n    }\r\n\r\n    /** ã‚µãƒ–æ˜ åƒã® [SurfaceTexture] ã‚’æç”»ã™ã‚‹ */\r\n    private fun drawSubCamera(surfaceTexture: SurfaceTexture) {\r\n        // ãƒ†ã‚¯ã‚¹ãƒãƒ£æ›´æ–°ã€‚å‘¼ã°ãªã„ã¨çœŸã£é»’\r\n        surfaceTexture.updateTexImage()\r\n        checkGlError(\"drawSubCamera start\")\r\n        surfaceTexture.getTransformMatrix(mSTMatrix)\r\n        GLES20.glActiveTexture(GLES20.GL_TEXTURE1)\r\n        GLES20.glBindTexture(GLES11Ext.GL_TEXTURE_EXTERNAL_OES, mainCameraTextureId)\r\n        // ãƒ¡ã‚¤ãƒ³æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã¯ GLES20.GL_TEXTURE0 ãªã®ã§ 0\r\n        GLES20.glUniform1i(uMainCameraTextureHandle, 0)\r\n        // ã‚µãƒ–æ˜ åƒã®ãƒ†ã‚¯ã‚¹ãƒãƒ£IDã¯ GLES20.GL_TEXTURE1 ãªã®ã§ 1\r\n        GLES20.glUniform1i(uSubCameraTextureHandle, 1)\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_POS_OFFSET)\r\n        GLES20.glVertexAttribPointer(maPositionHandle, 3, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maPosition\")\r\n        GLES20.glEnableVertexAttribArray(maPositionHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maPositionHandle\")\r\n        mTriangleVertices.position(TRIANGLE_VERTICES_DATA_UV_OFFSET)\r\n        GLES20.glVertexAttribPointer(maTextureHandle, 2, GLES20.GL_FLOAT, false, TRIANGLE_VERTICES_DATA_STRIDE_BYTES, mTriangleVertices)\r\n        checkGlError(\"glVertexAttribPointer maTextureHandle\")\r\n        GLES20.glEnableVertexAttribArray(maTextureHandle)\r\n        checkGlError(\"glEnableVertexAttribArray maTextureHandle\")\r\n        // ----\r\n        // ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚’æç”»ã™ã‚‹ãƒ•ãƒ©ã‚°ã‚’ä¸‹ã‚ã—ã¦ã‚µãƒ–æ˜ åƒã‚’æç”»ã™ã‚‹\r\n        // ----\r\n        GLES20.glUniform1i(uDrawMainCameraHandle, 0)\r\n        // Matrix.XXX ã®ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ¼é–¢æ•°ã§è¡Œåˆ—ã®æ“ä½œã‚’ã™ã‚‹å ´åˆã€é©ç”¨ã•ã›ã‚‹é †ç•ªã«æ³¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\r\n        Matrix.setIdentityM(mMVPMatrix, 0)\r\n        // å³ä¸Šã«ç§»å‹•ã•ã›ã‚‹\r\n        Matrix.translateM(mMVPMatrix, 0, 1f - 0.3f, 1f - 0.3f, 1f)\r\n        // åŠåˆ†ãã‚‰ã„ã«ã™ã‚‹\r\n        Matrix.scaleM(mMVPMatrix, 0, 0.3f, 0.3f, 1f)\r\n        // ç”»é¢å›è»¢ã—ã¦ã„ã‚‹å ´åˆã¯å›è»¢ã™ã‚‹\r\n        Matrix.rotateM(mMVPMatrix, 0, rotation, 0f, 0f, 1f)\r\n\r\n        // æç”»ã™ã‚‹\r\n        GLES20.glUniformMatrix4fv(muSTMatrixHandle, 1, false, mSTMatrix, 0)\r\n        GLES20.glUniformMatrix4fv(muMVPMatrixHandle, 1, false, mMVPMatrix, 0)\r\n        GLES20.glDrawArrays(GLES20.GL_TRIANGLE_STRIP, 0, 4)\r\n        checkGlError(\"glDrawArrays drawSubCamera\")\r\n    }\r\n\r\n    private fun createProgram(vertexSource: String, fragmentSource: String): Int {\r\n        val vertexShader = loadShader(GLES20.GL_VERTEX_SHADER, vertexSource)\r\n        if (vertexShader == 0) {\r\n            return 0\r\n        }\r\n        val pixelShader = loadShader(GLES20.GL_FRAGMENT_SHADER, fragmentSource)\r\n        if (pixelShader == 0) {\r\n            return 0\r\n        }\r\n        var program = GLES20.glCreateProgram()\r\n        checkGlError(\"glCreateProgram\")\r\n        if (program == 0) {\r\n            return 0\r\n        }\r\n        GLES20.glAttachShader(program, vertexShader)\r\n        checkGlError(\"glAttachShader\")\r\n        GLES20.glAttachShader(program, pixelShader)\r\n        checkGlError(\"glAttachShader\")\r\n        GLES20.glLinkProgram(program)\r\n        val linkStatus = IntArray(1)\r\n        GLES20.glGetProgramiv(program, GLES20.GL_LINK_STATUS, linkStatus, 0)\r\n        if (linkStatus[0] != GLES20.GL_TRUE) {\r\n            GLES20.glDeleteProgram(program)\r\n            program = 0\r\n        }\r\n        return program\r\n    }\r\n\r\n    private fun loadShader(shaderType: Int, source: String): Int {\r\n        var shader = GLES20.glCreateShader(shaderType)\r\n        checkGlError(\"glCreateShader type=$shaderType\")\r\n        GLES20.glShaderSource(shader, source)\r\n        GLES20.glCompileShader(shader)\r\n        val compiled = IntArray(1)\r\n        GLES20.glGetShaderiv(shader, GLES20.GL_COMPILE_STATUS, compiled, 0)\r\n        if (compiled[0] == 0) {\r\n            GLES20.glDeleteShader(shader)\r\n            shader = 0\r\n        }\r\n        return shader\r\n    }\r\n\r\n    private fun checkGlError(op: String) {\r\n        val error = GLES20.glGetError()\r\n        if (error != GLES20.GL_NO_ERROR) {\r\n            throw RuntimeException(\"$op: glError $error\")\r\n        }\r\n    }\r\n\r\n    companion object {\r\n        private val mTriangleVerticesData = floatArrayOf(\r\n            -1.0f, -1.0f, 0f, 0f, 0f,\r\n            1.0f, -1.0f, 0f, 1f, 0f,\r\n            -1.0f, 1.0f, 0f, 0f, 1f,\r\n            1.0f, 1.0f, 0f, 1f, 1f\r\n        )\r\n\r\n        private const val FLOAT_SIZE_BYTES = 4\r\n        private const val TRIANGLE_VERTICES_DATA_STRIDE_BYTES = 5 * FLOAT_SIZE_BYTES\r\n        private const val TRIANGLE_VERTICES_DATA_POS_OFFSET = 0\r\n        private const val TRIANGLE_VERTICES_DATA_UV_OFFSET = 3\r\n\r\n        /** ãƒãƒ¼ãƒ†ãƒƒã‚¯ã‚¹ã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã€‚ä½ç½®ã‚’æ±ºã‚ã‚‹ */\r\n        private const val VERTEX_SHADER = \"\"\"\r\n            uniform mat4 uMVPMatrix;\r\n            uniform mat4 uSTMatrix;\r\n            attribute vec4 aPosition;\r\n            attribute vec4 aTextureCoord;\r\n            varying vec2 vTextureCoord;\r\n            \r\n            void main() {\r\n              gl_Position = uMVPMatrix * aPosition;\r\n              vTextureCoord = (uSTMatrix * aTextureCoord).xy;\r\n            }\r\n        \"\"\"\r\n\r\n        /** ãƒ•ãƒ©ã‚°ãƒ¡ãƒ³ãƒˆã‚·ã‚§ãƒ¼ãƒ€ãƒ¼ã€‚è‰²ã‚’æ±ºã‚ã‚‹ */\r\n        private const val FRAGMENT_SHADER = \"\"\"\r\n            #extension GL_OES_EGL_image_external : require\r\n            precision mediump float;\r\n            varying vec2 vTextureCoord;\r\n            uniform samplerExternalOES uMainCameraTexture;        \r\n            uniform samplerExternalOES uSubCameraTexture;        \r\n            \r\n            // ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚’æç”»ã™ã‚‹å ´åˆã¯ 1\r\n            uniform int uDrawMainCamera;\r\n        \r\n            void main() {\r\n                vec4 mainCameraTexture = texture2D(uMainCameraTexture, vTextureCoord);\r\n                vec4 subCameraTexture = texture2D(uSubCameraTexture, vTextureCoord);\r\n                \r\n                if (bool(uDrawMainCamera)) {\r\n                    gl_FragColor = mainCameraTexture;                \r\n                } else {\r\n                    gl_FragColor = subCameraTexture;\r\n                }\r\n            }\r\n        \"\"\"\r\n    }\r\n\r\n}\r\n```\r\n\r\nè©³ã—ãã¯`MainActivity`ã«æ›¸ãã¨ãã«ã€ã€\r\n\r\n# MainActivity.kt\r\n\r\n## æ¨©é™ã‚’æ±‚ã‚ã‚‹\r\nç‰¹ã«è¨˜è¿°ã™ã‚‹ã“ã¨ã¯ãªã...\r\n\r\n```\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    private val isPermissionGranted: Boolean\r\n        get() = ContextCompat.checkSelfPermission(this, android.Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED\r\n                && ContextCompat.checkSelfPermission(this, android.Manifest.permission.RECORD_AUDIO) == PackageManager.PERMISSION_GRANTED\r\n\r\n    private val surfaceView by lazy { SurfaceView(this) }\r\n\r\n    private val permissionRequest = registerForActivityResult(ActivityResultContracts.RequestMultiplePermissions()) {\r\n        if (it.all { it.value }) {\r\n            // onResume ã§ä»£æ›¿\r\n            // setup()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(surfaceView)\r\n    }\r\n\r\n    private fun setup() {\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n## SurfaceView ã®æº–å‚™ã‚’å¾…ã¤é–¢æ•°\r\n`MainActivity`ã«`SurfaceView`ã®ç”¨æ„ãŒçµ‚ã‚ã‚‹ã¾ã§å¾…ã¤é–¢æ•°ã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n```\r\n/** Surface ã®ç”¨æ„ãŒçµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹ */\r\nprivate suspend fun waitSurface() = suspendCoroutine { continuation ->\r\n    surfaceView.holder.apply {\r\n        if (surface.isValid) {\r\n            continuation.resume(this)\r\n        } else {\r\n            addCallback(object : SurfaceHolder.Callback {\r\n                override fun surfaceCreated(holder: SurfaceHolder) {\r\n                    continuation.resume(holder)\r\n                }\r\n                override fun surfaceChanged(holder: SurfaceHolder, format: Int, width: Int, height: Int) {\r\n                    // do nothing\r\n                }\r\n                override fun surfaceDestroyed(holder: SurfaceHolder) {\r\n                    // do nothing\r\n                }\r\n            })\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## ã‚«ãƒ¡ãƒ©ã‚’é–‹ã„ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity(), SurfaceTexture.OnFrameAvailableListener {\r\n\r\n    /** ç”Ÿæˆã—ãŸ [GLSurface] */\r\n    private val glSurfaceList = arrayListOf<GLSurface>()\r\n\r\n    /** åˆ©ç”¨ä¸­ã® [CameraControl] */\r\n    private val cameraControlList = arrayListOf<CameraControl>()\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã«ç”Ÿæˆã—ãŸ [SurfaceTexture] */\r\n    private val previewSurfaceTexture = arrayListOf<SurfaceTexture>()\r\n\r\n    /** onFrameAvailable ãŒå‘¼ã°ã‚ŒãŸã‚‰ +1 ã—ã¦ã„ã */\r\n    private var unUsedFrameCount = 0L\r\n\r\n    /** updateTexImage ã‚’å‘¼ã‚“ã ã‚‰ +1 ã—ã¦ã„ã */\r\n    private var usedFrameCount = 0L\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ç”¨ã‚³ãƒ«ãƒ¼ãƒãƒ³Job */\r\n    private var cameraJob: Job? = null\r\n\r\n    // çœç•¥...\r\n\r\n    override fun onFrameAvailable(surfaceTexture: SurfaceTexture?) {\r\n        // æ›´æ–°ã‚’é€šçŸ¥ã™ã‚‹ãŸã‚ã€å€¤ã‚’æ›´æ–°ã™ã‚‹\r\n        latestUpdateCount++\r\n    }\r\n\r\n    override fun onResume() {\r\n        super.onResume()\r\n        if (isPermissionGranted) {\r\n            setup()\r\n        }\r\n    }\r\n\r\n    override fun onPause() {\r\n        super.onPause()\r\n        // ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾\r\n        cameraJob?.cancel()\r\n        previewSurfaceTexture.forEach {\r\n            it.setOnFrameAvailableListener(null)\r\n            it.release()\r\n        }\r\n        glSurfaceList.clear()\r\n        previewSurfaceTexture.forEach { it.release() }\r\n        previewSurfaceTexture.clear()\r\n        cameraControlList.forEach { it.destroy() }\r\n        cameraControlList.clear()\r\n    }\r\n\r\n    private fun setup() {\r\n        cameraJob = lifecycleScope.launch(Dispatchers.IO) {\r\n            // SurfaceView ã‚’å¾…ã¤\r\n            val previewSurface = waitSurface()\r\n\r\n            // CameraRenderer ã‚’ä½œã‚‹\r\n            val cameraGLRenderer = CameraGLRenderer(\r\n                rotation = if (resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE) 90f else 0f, // ç”»é¢å›è»¢\r\n                mainSurfaceTexture = { previewSurfaceTexture[0] },\r\n                subSurfaceTexture = { previewSurfaceTexture[1] }\r\n            )\r\n            // GLSurface ã‚’ä½œã‚‹\r\n            val glSurface = GLSurface(\r\n                surface = previewSurface,\r\n                renderer = cameraGLRenderer,\r\n            )\r\n            glSurface.makeCurrent()\r\n            glSurfaceList += glSurface\r\n\r\n            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã§åˆ©ç”¨ã™ã‚‹ SurfaceTexture ã‚’ç”¨æ„\r\n            // SurfaceTexture ã®å ´åˆã¯ setDefaultBufferSize ã§è§£åƒåº¦ã®è¨­å®šãŒã§ãã‚‹\r\n            val previewSurfaceTexturePair = cameraGLRenderer.setupProgram().let { (mainCameraTextureId, subCameraTextureId) ->\r\n                // ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n                val main = SurfaceTexture(mainCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                // ã‚µãƒ–æ˜ åƒ\r\n                val sub = SurfaceTexture(subCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                main to sub\r\n            }\r\n            previewSurfaceTexture.addAll(previewSurfaceTexturePair.toList())\r\n\r\n            // ã©ã£ã¡ã®ã‚«ãƒ¡ãƒ©ã‚’ãƒ¡ã‚¤ãƒ³æ˜ åƒã«ã™ã‚‹ã‹\r\n            // ä»Šå›ã¯ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚’ãƒãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã€ã‚µãƒ–æ˜ åƒï¼ˆãƒ¯ã‚¤ãƒ—ï¼‰ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚«ãƒ¡ãƒ©ã«æŒ‡å®š\r\n            val previewMainSurfaceTexture = previewSurfaceTexturePair.first\r\n            val previewSubSurfaceTexture = previewSurfaceTexturePair.second\r\n            // ã‚«ãƒ¡ãƒ©ã‚’é–‹ã\r\n            val (backCameraId, frontCameraId) = CameraTool.getCameraId(this@MainActivity)\r\n            cameraControlList += CameraControl(this@MainActivity, backCameraId, Surface(previewMainSurfaceTexture))\r\n            cameraControlList += CameraControl(this@MainActivity, frontCameraId, Surface(previewSubSurfaceTexture))\r\n            cameraControlList.forEach { it.openCamera() }\r\n            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹\r\n            cameraControlList.forEach { it.startPreview() }\r\n\r\n            // OpenGL ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†\r\n            // isActive ã§ã“ã® cameraJob ãŒçµ‚äº†ã•ã‚Œã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ã—ç¶šã‘ã‚‹\r\n            // ã“ã“ã§è¡Œã†ç†ç”±ã§ã™ãŒã€makeCurrent ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ãªã„ã¨ glDrawArray ã§ããªã„ï¼Ÿ + onFrameAvailable ãŒ UIã‚¹ãƒ¬ãƒƒãƒ‰ ãªã®ã§é‡ãŸã„ã“ã¨ã¯ã§ããªã„ãŸã‚ã§ã™ã€‚\r\n            // ãŸã ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ onFrameAvailable ãŒæ›´æ–°ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã®ã§ã€\r\n            // while ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ã¦ æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãŒæ¥ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ã¾ã™ã€‚\r\n            while (isActive) {\r\n                // OpenGL ã®æç”»ã‚ˆã‚Šã‚‚ onFrameAvailable ã®æ›´æ–°ã®ã»ã†ãŒæ—©ã„ï¼ŸãŸã‚ã€æ›´æ–°ãŒè¿½ã„ã¤ã„ã¦ã—ã¾ã†\r\n                // ãã®ãŸã‚ã€æ¶ˆè²»ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã¾ã æ¶ˆè²»ã—ã¦ã„ãªã„ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«ã—ãŸ\r\n                // https://stackoverflow.com/questions/14185661\r\n                if (unUsedFrameCount != usedFrameCount) {\r\n                    glSurfaceList.forEach {\r\n                        it.makeCurrent() // å¤šåˆ†ã„ã‚‹\r\n                        it.drawFrame()\r\n                        it.swapBuffers()\r\n                    }\r\n                    usedFrameCount += 2 // ãƒ¡ã‚¤ãƒ³æ˜ åƒã¨ã‚µãƒ–æ˜ åƒã§2ã¤\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    // çœç•¥...\r\n\r\n    companion object {\r\n\r\n        /** 720P è§£åƒåº¦ å¹… */\r\n        private const val CAMERA_RESOLTION_WIDTH = 1280\r\n\r\n        /** 720P è§£åƒåº¦ é«˜ã• */\r\n        private const val CAMERA_RESOLTION_HEIGHT = 720\r\n\r\n    }\r\n```\r\n\r\n`SurfaceTexture.OnFrameAvailableListener`ã‚’å®Ÿè£…ã—ã¾ã™ã€‚ã“ã‚Œã§`MainActivity`ã«æ–°ã—ã„ã‚«ãƒ¡ãƒ©ã®æ˜ åƒãƒ•ãƒ¬ãƒ¼ãƒ ãŒæ¥ãŸã“ã¨ã‚’çŸ¥ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  \r\næ˜ åƒãŒæ›´æ–°ã•ã‚ŒãŸã‚‰ã€`drawFrame`ã¨`swapBuffers`ã‚’å‘¼ã³å‡ºã™ã®ã§ã™ãŒã€`makeCurrent`ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã®ä¸­ã§å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ï¼Ÿï¼Ÿï¼Ÿã€‚  \r\nã¨ã„ã†ã‚ã‘ã§ã€`while`ãƒ«ãƒ¼ãƒ—å†…ã§ã©ã†ã«ã‹å‡¦ç†ã—ãªã„ã¨ã„ã‘ãªã„ã®ã§ã™ãŒã€å˜ç´”ã«ãƒ•ãƒ©ã‚°ã‚’æŒã£ã¦ã‚‹ã ã‘ã ã¨æç”»ã•ã‚Œãªããªã‚Šã¾ã™ã€‚  \r\nå¤šåˆ†ã“ã‚Œã¨åŒã˜ã§ã™ï¼šhttps://stackoverflow.com/questions/14185661/\r\n\r\nã©ã†ã‚„ã‚‰ã€`OpenGL`ã®æç”»ä¸­ã«`OnFrameAvailableListener`ãŒå‘¼ã°ã‚Œã‚‹ï¼Ÿï¼ˆ`OnFrameAvailableListener`ã®ã»ã†ãŒæ—©ã„ã‚‰ã—ã„ï¼Ÿï¼‰ã®ãŒåŸå› ã‚‰ã—ã„ã§ã™ã€‚  \r\nç›´ã™æ–¹æ³•ã§ã™ãŒã€`OnFrameAvailableListener`ã®å‘¼ã°ã‚ŒãŸå›æ•°ã‚’ã¾ãšå¤‰æ•°ã«æŒã¤ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚ã¤ã¾ã‚Šã¾ã æ¶ˆè²»ã—ã¦ã„ãªã„ãƒ•ãƒ¬ãƒ¼ãƒ æ•°ã§ã™ã­ã€‚  \r\nãã—ã¦ä»Šåº¦ã¯`SurfaceTexture#updateTexImage`ã‚’å‘¼ã‚“ã å›æ•°ã‚’ã¾ãŸå¤‰æ•°ã«æŒã¤ã‚ˆã†ã«ã—ã¾ã™ã€‚ã¤ã¾ã‚Šæ¶ˆè²»ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ æ•°ã§ã™ã­ã€‚  \r\nã‚ã¨ã¯ã“ã‚ŒãŒé•ã†é–“ã¯ãšã£ã¨æç”»ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨ã¨ã‚Šã‚ãˆãšæ²»ã£ã¦ã„ãã†ã§ã™ã€‚  \r\n**ãŒã€ãªã‚“ã‹ã¾ãã‚Œã§å‹•ã„ã¦ã‚‹æ°—ã‚‚ã—ãªãã¯ãªã„ã€ã€**\r\n\r\n```kotlin\r\nif (unUsedFrameCount != usedFrameCount) {\r\n    glSurfaceList.forEach {\r\n        it.makeCurrent() // å¤šåˆ†ã„ã‚‹\r\n        it.drawFrame()\r\n        it.swapBuffers()\r\n    }\r\n    usedFrameCount += 2 // ãƒ¡ã‚¤ãƒ³æ˜ åƒã¨ã‚µãƒ–æ˜ åƒã§2ã¤\r\n    println(\"æœªåˆ©ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  = $unUsedFrameCount / æ¶ˆè²»ãƒ•ãƒ¬ãƒ¼ãƒ  = $usedFrameCount\")\r\n}\r\n```\r\n\r\n```\r\næœªåˆ©ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  = 6550 / æ¶ˆè²»ãƒ•ãƒ¬ãƒ¼ãƒ  = 6572\r\næœªåˆ©ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  = 6554 / æ¶ˆè²»ãƒ•ãƒ¬ãƒ¼ãƒ  = 6574\r\næœªåˆ©ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  = 6558 / æ¶ˆè²»ãƒ•ãƒ¬ãƒ¼ãƒ  = 6576\r\næœªåˆ©ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  = 6562 / æ¶ˆè²»ãƒ•ãƒ¬ãƒ¼ãƒ  = 6578\r\næœªåˆ©ç”¨ãƒ•ãƒ¬ãƒ¼ãƒ  = 6562 / æ¶ˆè²»ãƒ•ãƒ¬ãƒ¼ãƒ  = 6580\r\n```\r\n\r\nã¡ãªã¿ã«`OnFrameAvailableListener`ã¯å¼•æ•°ã‚’çœç•¥ã—ãŸå ´åˆã¯UIã‚¹ãƒ¬ãƒƒãƒ‰ã£ã½ã„ã§ã™ã€‚HandlerãŒæ¸¡ã›ã‚‹ã®ã§åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚å‡ºæ¥ã‚‹ã‚“ã‹ãªã€‚  \r\nå¤šåˆ†`drawFrame`ã¨`swapBuffers`ã‚’UIã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚„ã£ãŸã‚‰é‡ãŸããªã‚‹ã¨æ€ã†ã€ã€ã€\r\n\r\n`CameraGLRenderer`ã®`rotation`ã§æ˜ åƒã®å›è»¢ã‚’ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã§ç”»é¢å›è»¢ã—ã¦ã‚‚æ˜ åƒãŒå¼•ãä¼¸ã°ã•ã‚ŒãŸã‚Šã—ã¾ã›ã‚“ï¼å¤šåˆ†ã€‚\r\næ˜ åƒã®è§£åƒåº¦ã§ã™ãŒã€`SurfaceTexture`ã®å ´åˆã¯`SurfaceTexture#setDefaultBufferSize`ã§æŒ‡å®šã§ãã¾ã™ã€‚  \r\n\r\nã‚ã¨ã¯ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾ã§ã™ã­ã€`onResume`ã§ã‚«ãƒ¡ãƒ©ã‚’é–‹ã`onPause`ã§å¾Œç‰‡ä»˜ã‘ã‚’ã—ã¾ã™ã€‚ã‚«ãƒ¡ãƒ©ã¯ä»–ã‚¢ãƒ—ãƒªã‚‚åˆ©ç”¨ã™ã‚‹ãŸã‚ã¡ã‚ƒã‚“ã¨ä½¿ã£ãŸã‚‰å¾Œç‰‡ä»˜ã‘ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n# SurfaceViewãŒå¼•ãä¼¸ã°ã•ã‚Œã¦ã„ã‚‹\r\nç¸¦ç”»é¢ãªã‚‰ã€æ¨ªå¹…ã„ã£ã±ã„ã«ç¸¦ã‚’èª¿æ•´ã™ã‚‹ã€‚æ¨ªç”»é¢ãªã‚‰ç¸¦ã„ã£ã±ã„ã«ã—ã¦æ¨ªã‚’èª¿æ•´ã™ã‚‹ã€‚ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã°ã„ã„ã®ã§ã™ãŒã€é¢å€’ãªã®ã§ã€  \r\n`View`ãªã‚‰`ConstraintLayout`ã®`layout_constraintDimensionRatio`ã€`JetpackCompose`ãªã‚‰`Modifier.aspect`ãŒã‚ã‚‹ã®ã§ä½¿ã†ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\nsetContent {\r\n    Box(modifier = Modifier.fillMaxSize()) {\r\n        AndroidView(\r\n            modifier = Modifier\r\n                .align(Alignment.Center)\r\n                // 16:9 ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«ã™ã‚‹\r\n                .aspectRatio(\r\n                    if (resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE) {\r\n                        CAMERA_RESOLTION_WIDTH.toFloat() / CAMERA_RESOLTION_HEIGHT.toFloat()\r\n                    } else {\r\n                        CAMERA_RESOLTION_HEIGHT.toFloat() / CAMERA_RESOLTION_WIDTH.toFloat()\r\n                    }\r\n                ),\r\n            factory = { surfaceView }\r\n        )\r\n    }\r\n}\r\n```\r\n\r\n# ã‚·ã‚¹ãƒ†ãƒ ãƒãƒ¼ã‚’æ¶ˆã—ãŸã„\r\nã¯ã„ã€‚\r\n\r\n```kotlin\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n\r\n    // ã“ã‚Œ\r\n    WindowCompat.getInsetsController(window, window.decorView).apply {\r\n        hide(WindowInsetsCompat.Type.systemBars())\r\n        systemBarsBehavior = WindowInsetsControllerCompat.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE\r\n    }\r\n    \r\n    setContent {\r\n        // çœç•¥...\r\n    }\r\n}\r\n```\r\n\r\nã¾ãŸã€ãƒãƒƒãƒã‚„ãƒ‘ãƒ³ãƒãƒ›ãƒ¼ãƒ«ãŒã‚ã‚‹å ´åˆã¯è¿½åŠ ã§ä»¥ä¸‹ã‚’æ›¸ãè¶³ã™ã“ã¨ã§æ¶ˆã™ã“ã¨ãŒã§ãã¾ã™ã€‚\r\n\r\n```kotlin\r\nwindow.setDecorFitsSystemWindows(false)\r\nwindow.attributes.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\r\n```\r\n\r\n# æ’®å½±æ©Ÿèƒ½\r\nã¨ã‚Šã‚ãˆãšæ’®å½±ãƒœã‚¿ãƒ³ã‚’ç½®ãã¾ã™ã€‚è©±ã¯ãã‚Œã‹ã‚‰\r\n\r\n```kotlin\r\nBox(\r\n    modifier = Modifier\r\n        .background(Color.Black)\r\n        .fillMaxSize()\r\n) {\r\n    AndroidView(\r\n        modifier = Modifier\r\n            .align(Alignment.Center)\r\n            // 16:9 ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«ã™ã‚‹\r\n            .aspectRatio(\r\n                if (resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE) {\r\n                    CAMERA_RESOLTION_WIDTH.toFloat() / CAMERA_RESOLTION_HEIGHT.toFloat()\r\n                } else {\r\n                    CAMERA_RESOLTION_HEIGHT.toFloat() / CAMERA_RESOLTION_WIDTH.toFloat()\r\n                }\r\n            ),\r\n        factory = { surfaceView }\r\n    )\r\n    Button(\r\n        modifier = Modifier.align(Alignment.BottomCenter),\r\n        onClick = { /* TODO */ }\r\n    ) { Text(text = \"æ’®å½±ã™ã‚‹\") }\r\n}\r\n```\r\n\r\n## 2ã¤ã®æ–¹æ³•ã§æ’®å½±ã§ãã‚‹\r\n1ã¤ç›®ãŒã€ä»Šæç”»ã—ã¦ã„ã‚‹ `SurfaceView` ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹æ–¹æ³•ã€‚  \r\n`OpenGL`ã«æ¨™æº–è£…å‚™ã—ã¦ã„ã‚‹`glReadPixels`ã‚’ä½¿ã†ã‹ã€`SurfaceView`ã‚’`PixelCopy`ã§`Bitmap`ã«ã—ã¦ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n`PixelCopy`ã®ä¾‹ã¯ã„ã£ã±ã„ã‚ã‚‹ã¨æ€ã†ã®ã§ã€`OpenGL`ã®æ–¹ã§ä½œã£ã¦ã¿ã¾ã™ã€‚\r\n\r\nã‚‚ã†ä¸€ã¤ã¯ã€`ImageReader`ã‚’åˆ©ç”¨ã™ã‚‹æ–¹æ³•ã€‚  \r\nã“ã‚Œã¯`Surface`ã®å…¥åŠ›ã‹ã‚‰ç”»åƒã‚’ç”Ÿæˆã§ãã‚‹ã‚„ã¤ã§ã™ã€‚å¤šåˆ†ã“ã£ã¡ã‚’ä½¿ã†ã®ãŒæ­£æ”»æ³•ãªæ°—ãŒã—ã¾ã™ã€‚\r\n\r\n### glReadPixels ã™ã‚‹\r\n`MainActivity`ã«æ›¸ãã¾ã—ãŸã€‚\r\n\r\n```kotlin\r\n/** glReadPixels ã™ã‚‹å ´åˆã¯ trueã€‚å‡¦ç†ã‚’å—ã‘ä»˜ã‘ãŸã‚‰ false */\r\nprivate var isCaptureRequest = false\r\n\r\n/** SurfaceView ã®ã‚µã‚¤ã‚º */\r\nprivate var size: IntRect? = null\r\n\r\n// çœç•¥\r\n\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n\r\n    WindowCompat.getInsetsController(window, window.decorView).apply {\r\n        hide(WindowInsetsCompat.Type.systemBars())\r\n        systemBarsBehavior = WindowInsetsControllerCompat.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE\r\n    }\r\n    window.setDecorFitsSystemWindows(false)\r\n    window.attributes.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\r\n\r\n    setContent {\r\n        Box(\r\n            modifier = Modifier\r\n                .background(Color.Black)\r\n                .fillMaxSize()\r\n        ) {\r\n            AndroidView(\r\n                modifier = Modifier\r\n                    .align(Alignment.Center)\r\n                    .onGloballyPositioned {\r\n                        // ã‚µã‚¤ã‚ºã‚’ã¨ã‚‹\r\n                        size = it.size.toIntRect()\r\n                    }\r\n                    // 16:9 ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«ã™ã‚‹\r\n                    .aspectRatio(\r\n                        if (resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE) {\r\n                            CAMERA_RESOLTION_WIDTH.toFloat() / CAMERA_RESOLTION_HEIGHT.toFloat()\r\n                        } else {\r\n                            CAMERA_RESOLTION_HEIGHT.toFloat() / CAMERA_RESOLTION_WIDTH.toFloat()\r\n                        }\r\n                    ),\r\n                factory = { surfaceView }\r\n            )\r\n            Button(\r\n                modifier = Modifier.align(Alignment.BottomCenter),\r\n                onClick = {\r\n                    // æ’®å½±ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n                    isCaptureRequest = true\r\n                }\r\n            ) { Text(text = \"æ’®å½±ã™ã‚‹\") }\r\n        }\r\n    }\r\n}\r\n\r\n// çœç•¥\r\n\r\nprivate fun setup() {\r\n    cameraJob = lifecycleScope.launch(Dispatchers.IO) {\r\n\r\n        // çœç•¥\r\n\r\n        while (isActive) {\r\n\r\n            // çœç•¥...\r\n\r\n            // æ’®å½±ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã‚ã£ãŸå ´åˆ\r\n            if (isCaptureRequest) {\r\n                isCaptureRequest = false\r\n                val bitmap = capture(size!!.width, size!!.height)\r\n                insertPhoto(\"${System.currentTimeMillis()}.jpg\", bitmap)\r\n                bitmap.recycle()\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/** ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«ç™»éŒ²ã™ã‚‹ */\r\nfun insertPhoto(name: String, bitmap: Bitmap) {\r\n    val contentResolver = contentResolver\r\n    val contentValues = contentValuesOf(\r\n        MediaStore.Images.Media.DISPLAY_NAME to name,\r\n        MediaStore.Images.Media.RELATIVE_PATH to \"${Environment.DIRECTORY_PICTURES}/ArisaDroid\"\r\n    )\r\n    val uri = contentResolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues) ?: return\r\n    contentResolver.openOutputStream(uri).use { outputStream ->\r\n        bitmap.compress(Bitmap.CompressFormat.JPEG, 100, outputStream)\r\n    }\r\n}\r\n\r\n/** OpenGLã®æç”»å†…å®¹ã‚’ Bitmap ã«ã™ã‚‹ */\r\nfun capture(width: Int, height: Int): Bitmap {\r\n    val pixels = IntArray(width * height)\r\n    val buffer = IntBuffer.wrap(pixels)\r\n    buffer.position(0)\r\n    GLES20.glReadPixels(0, 0, width, height, GLES20.GL_RGBA, GLES20.GL_UNSIGNED_BYTE, buffer)\r\n    val bitmap = Bitmap.createBitmap(width, height, Bitmap.Config.ARGB_8888)\r\n    bitmap.copyPixelsFromBuffer(buffer)\r\n    return bitmap\r\n}\r\n\r\n// çœç•¥\r\n\r\n```\r\n\r\nã©ã†ã—ã¦ã‚‚`makeCurrent`ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ãªã„ã¨å‘¼ã³å‡ºã›ãªã„é–¢ä¿‚ä¸Šã€é›‘ãªå‡¦ç†ã«ãªã£ã¦ã—ã¾ã£ãŸã€‚  \r\næ‰‹è»½ï¼Ÿã«ã‚­ãƒ£ãƒ—ãƒãƒ£å‡ºæ¥ã‚‹ä¸€æ–¹ã€å•é¡Œç‚¹ã¨ã—ã¦ã¯è§£åƒåº¦ã§ã¯ãªãã€`SurfaceView`ã®ã‚µã‚¤ã‚ºã«ãªã£ã¦ã—ã¾ã†ç‚¹ã§ã™ã­ã€‚ã‚ã¨åè»¢ã—ã¦ã‚‹ã—å›è»¢ã‚‚ã—ã¦ã„ã‚‹ã®ã§ã‚ã‚“ã©ã„ï¼ï¼ï¼  \r\nãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚‚ããŸã­ãˆã—ã€‚\r\n\r\n### ã‚‚ã†ä¸€ã¤ã®æ–¹æ³•ã€ImageReader\r\nå¤šåˆ†ã“ã£ã¡ã§æ’®å½±ã™ã‚‹ã®ãŒæ­£è§£ã ã¨æ€ã„ã¾ã™ã€‚  \r\n`ImageReader`ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€`Surface`ã®å‡ºåŠ›ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã‚«ãƒ¡ãƒ©ã®æ˜ åƒã‚„`MediaCodec`ã®å‡ºåŠ›å…ˆ`Surface`ã¨ã—ã¦`ImageReader`ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ç”»åƒã®`JPEG`ã¨ã‹ã§å–å¾—ã§ãã‚‹ã‚“ã ã¨æ€ã„ã¾ã™ã€‚  \r\nãªã®ã§ã€ä»Šå›ã¯`ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨SurfaceView`ã¨ã¯åˆ¥ã«`é™æ­¢ç”»æ’®å½±ç”¨Surface`ã‚’ä½œã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚  \r\nçµµã«ã™ã‚‹ã¨ã“ã‚“ãªã‚¤ãƒ¡ãƒ¼ã‚¸ã§ã™ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/IbiX9B3.png)\r\n\r\n#### ImageReader ã§æ’®å½±ã™ã‚‹\r\n\r\n##### CameraControl\r\n`Surface`ã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ’®å½±ç”¨ã§2ã¤å–ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  \r\n`captureSurface`ãŒå¼•æ•°ã«å¢—ãˆã¦ã„ã‚‹ç‚¹ã€`startCamera`ã«`captureSurface`ã‚’è¿½åŠ ã™ã‚‹å‡¦ç†ãŒãµãˆã¦ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * ã‚«ãƒ¡ãƒ©ã‚’é–‹ã‘ãŸã‚Šé–‰ã˜ãŸã‚Šã™ã‚‹å‡¦ç†ã‚’éš è”½ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\n *\r\n * @param context [Context]\r\n * @param cameraId ã‚«ãƒ¡ãƒ©IDã€å‰é¢ or èƒŒé¢\r\n * @param previewSurface ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼Surface\r\n * @param captureSurface æ’®å½±ã€éŒ²ç”» ç”¨Surface\r\n */\r\nclass CameraControl(\r\n    context: Context,\r\n    private val cameraId: String,\r\n    private val previewSurface: Surface,\r\n    private val captureSurface: Surface\r\n) {\r\n    private val cameraManager = context.getSystemService(Context.CAMERA_SERVICE) as CameraManager\r\n    private val cameraExecutor = Executors.newSingleThreadExecutor()\r\n    private var cameraDevice: CameraDevice? = null\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    suspend fun openCamera() {\r\n        cameraDevice = waitOpenCamera()\r\n    }\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹ã™ã‚‹ */\r\n    fun startCamera() {\r\n        val cameraDevice = cameraDevice ?: return\r\n        val captureRequest = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE).apply {\r\n            addTarget(previewSurface)\r\n            addTarget(captureSurface)\r\n        }.build()\r\n        val outputList = buildList {\r\n            add(OutputConfiguration(previewSurface))\r\n            add(OutputConfiguration(captureSurface))\r\n        }\r\n        SessionConfiguration(SessionConfiguration.SESSION_REGULAR, outputList, cameraExecutor, object : CameraCaptureSession.StateCallback() {\r\n            override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                captureSession.setRepeatingRequest(captureRequest, null, null)\r\n            }\r\n\r\n            override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n                // do nothing\r\n            }\r\n        }).apply { cameraDevice.createCaptureSession(this) }\r\n    }\r\n\r\n    /** çµ‚äº†æ™‚ã«å‘¼ã³å‡ºã™ */\r\n    fun destroy() {\r\n        cameraDevice?.close()\r\n    }\r\n\r\n    /** [cameraId]ã®ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    @SuppressLint(\"MissingPermission\")\r\n    suspend private fun waitOpenCamera() = suspendCoroutine {\r\n        cameraManager.openCamera(cameraId, cameraExecutor, object : CameraDevice.StateCallback() {\r\n            override fun onOpened(camera: CameraDevice) {\r\n                it.resume(camera)\r\n            }\r\n\r\n            override fun onDisconnected(camera: CameraDevice) {\r\n                // do nothing\r\n            }\r\n\r\n            override fun onError(camera: CameraDevice, error: Int) {\r\n                // do nothing\r\n            }\r\n        })\r\n    }\r\n\r\n}\r\n```\r\n\r\n##### MainActivity\r\n`setup`ã§ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨ã®Surfaceã€æ’®å½±ç”¨ã®Surfaceã®2ã¤åˆ†ã€ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚  \r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity(), SurfaceTexture.OnFrameAvailableListener {\r\n\r\n    // çœç•¥...\r\n\r\n    private val isLandscape: Boolean\r\n        get() = resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    /** é™æ­¢ç”»æ’®å½±  */\r\n    private var imageReader: ImageReader? = null\r\n\r\n    // çœç•¥...\r\n\r\n    private fun setup() {\r\n        cameraJob = lifecycleScope.launch(Dispatchers.IO) {\r\n            // SurfaceView ã‚’å¾…ã¤\r\n            val previewSurface = waitSurface()\r\n            // é™æ­¢ç”»æ’®å½±ã§åˆ©ç”¨ã™ã‚‹ ImageReader\r\n            // Surface ã®å…¥åŠ›ã‹ã‚‰ç”»åƒã‚’ç”Ÿæˆã§ãã‚‹\r\n            val imageReader = ImageReader.newInstance(\r\n                if (isLandscape) CAMERA_RESOLTION_WIDTH else CAMERA_RESOLTION_HEIGHT,\r\n                if (isLandscape) CAMERA_RESOLTION_HEIGHT else CAMERA_RESOLTION_WIDTH,\r\n                PixelFormat.RGBA_8888, // JPEG ã¯ OpenGL ä½¿ã£ãŸã›ã„ãªã®ã‹åˆ©ç”¨ã§ããªã„\r\n                2\r\n            )\r\n            this@MainActivity.imageReader = imageReader\r\n\r\n            // CameraRenderer ã‚’ä½œã‚‹\r\n            val previewCameraGLRenderer = CameraGLRenderer(\r\n                rotation = if (isLandscape) 90f else 0f, // ç”»é¢å›è»¢\r\n                mainSurfaceTexture = { previewSurfaceTexture[0] },\r\n                subSurfaceTexture = { previewSurfaceTexture[1] }\r\n            )\r\n            val captureCameraGLRenderer = CameraGLRenderer(\r\n                rotation = if (isLandscape) 90f else 0f, // ç”»é¢å›è»¢\r\n                mainSurfaceTexture = { previewSurfaceTexture[2] },\r\n                subSurfaceTexture = { previewSurfaceTexture[3] }\r\n            )\r\n            // GLSurface ã‚’ä½œã‚‹\r\n            val previewGlSurface = GLSurface(\r\n                surface = previewSurface,\r\n                renderer = previewCameraGLRenderer,\r\n            )\r\n            val captureGlSurface = GLSurface(\r\n                surface = imageReader.surface,\r\n                renderer = captureCameraGLRenderer\r\n            )\r\n            glSurfaceList += previewGlSurface\r\n            glSurfaceList += captureGlSurface\r\n\r\n            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ / é™æ­¢ç”»æ’®å½± ã§åˆ©ç”¨ã™ã‚‹ SurfaceTexture ã‚’ç”¨æ„\r\n            // SurfaceTexture ã®å ´åˆã¯ setDefaultBufferSize ã§ã‚«ãƒ¡ãƒ©ã®è§£åƒåº¦ã®è¨­å®šãŒã§ãã‚‹ (720P ãªã©)\r\n            previewGlSurface.makeCurrent()\r\n            val previewSurfaceTexturePair = previewCameraGLRenderer.setupProgram().let { (mainCameraTextureId, subCameraTextureId) ->\r\n                // ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n                val main = SurfaceTexture(mainCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                // ã‚µãƒ–æ˜ åƒ\r\n                val sub = SurfaceTexture(subCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                main to sub\r\n            }\r\n            captureGlSurface.makeCurrent()\r\n            val captureSurfaceTexturePair = captureCameraGLRenderer.setupProgram().let { (mainCameraTextureId, subCameraTextureId) ->\r\n                // ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n                val main = SurfaceTexture(mainCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                // ã‚µãƒ–æ˜ åƒ\r\n                val sub = SurfaceTexture(subCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                main to sub\r\n            }\r\n            previewSurfaceTexture.addAll(previewSurfaceTexturePair.toList())\r\n            previewSurfaceTexture.addAll(captureSurfaceTexturePair.toList())\r\n\r\n            // ã©ã£ã¡ã®ã‚«ãƒ¡ãƒ©ã‚’ãƒ¡ã‚¤ãƒ³æ˜ åƒã«ã™ã‚‹ã‹\r\n            // ä»Šå›ã¯ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚’ãƒãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã€ã‚µãƒ–æ˜ åƒï¼ˆãƒ¯ã‚¤ãƒ—ï¼‰ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚«ãƒ¡ãƒ©ã«æŒ‡å®š\r\n            // ä»¥ä¸‹ã®ãƒªã‚¹ãƒˆã¯ ãƒ¡ã‚¤ãƒ³/ã‚¶ãƒ– æ˜ åƒã«æŒ‡å®šã™ã‚‹ SurfaceTexture ã®ãƒªã‚¹ãƒˆ\r\n            val mainSurfaceTexture = listOf(previewSurfaceTexturePair.first, captureSurfaceTexturePair.first)\r\n            val subSurfaceTexture = listOf(previewSurfaceTexturePair.second, captureSurfaceTexturePair.second)\r\n\r\n            // ã‚«ãƒ¡ãƒ©ã‚’é–‹ã\r\n            val (backCameraId, frontCameraId) = CameraTool.getCameraId(this@MainActivity)\r\n            cameraControlList += CameraControl(this@MainActivity, backCameraId, Surface(mainSurfaceTexture[0]), Surface(mainSurfaceTexture[1]))\r\n            cameraControlList += CameraControl(this@MainActivity, frontCameraId, Surface(subSurfaceTexture[0]), Surface(subSurfaceTexture[1]))\r\n            cameraControlList.forEach { it.openCamera() }\r\n            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹\r\n            cameraControlList.forEach { it.startCamera() }\r\n\r\n            // OpenGL ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†\r\n            // isActive ã§ã“ã® cameraJob ãŒçµ‚äº†ã•ã‚Œã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ã—ç¶šã‘ã‚‹\r\n            // ã“ã“ã§è¡Œã†ç†ç”±ã§ã™ãŒã€makeCurrent ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ãªã„ã¨ glDrawArray ã§ããªã„ï¼Ÿ + onFrameAvailable ãŒ UIã‚¹ãƒ¬ãƒƒãƒ‰ ãªã®ã§é‡ãŸã„ã“ã¨ã¯ã§ããªã„ãŸã‚ã§ã™ã€‚\r\n            // ãŸã ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ onFrameAvailable ãŒæ›´æ–°ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã®ã§ã€\r\n            // while ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ã¦ æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãŒæ¥ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ã¾ã™ã€‚\r\n            while (isActive) {\r\n                // OpenGL ã®æç”»ã‚ˆã‚Šã‚‚ onFrameAvailable ã®æ›´æ–°ã®ã»ã†ãŒæ—©ã„ï¼ŸãŸã‚ã€æ›´æ–°ãŒè¿½ã„ã¤ã„ã¦ã—ã¾ã†\r\n                // ãã®ãŸã‚ã€æ¶ˆè²»ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã¾ã æ¶ˆè²»ã—ã¦ã„ãªã„ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«ã—ãŸ\r\n                // https://stackoverflow.com/questions/14185661\r\n                if (unUsedFrameCount != usedFrameCount) {\r\n                    glSurfaceList.forEach {\r\n                        it.makeCurrent() // å¤šåˆ†ã„ã‚‹\r\n                        it.drawFrame()\r\n                        it.swapBuffers()\r\n                    }\r\n                    usedFrameCount += 2 // ãƒ¡ã‚¤ãƒ³æ˜ åƒã¨ã‚µãƒ–æ˜ åƒã§2ã¤\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** [imageReader]ã‹ã‚‰å–ã‚Šå‡ºã—ã¦ä¿å­˜ã™ã‚‹ */\r\n    private fun capture() {\r\n        lifecycleScope.launch(Dispatchers.IO) {\r\n            // ImageReader ã‹ã‚‰å–ã‚Šå‡ºã™\r\n            val image = imageReader?.acquireLatestImage() ?: return@launch\r\n            val width = image.width\r\n            val height = image.height\r\n            val planes = image.planes\r\n            val buffer = planes[0].buffer\r\n            // ãªãœã‹ ImageReader ã®ã‚µã‚¤ã‚ºã«åŠ ãˆã¦ã€ä½•æ•…ã‹ Padding ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹\r\n            val pixelStride = planes[0].pixelStride\r\n            val rowStride = planes[0].rowStride\r\n            val rowPadding = rowStride - pixelStride * width\r\n            // Bitmap ä½œæˆ\r\n            val readBitmap = Bitmap.createBitmap(width + rowPadding / pixelStride, height, Bitmap.Config.ARGB_8888)\r\n            readBitmap.copyPixelsFromBuffer(buffer)\r\n            // ä½™åˆ†ãª Padding ã‚’æ¶ˆã™\r\n            val originWidth = if (isLandscape) CAMERA_RESOLTION_WIDTH else CAMERA_RESOLTION_HEIGHT\r\n            val originHeight = if (isLandscape) CAMERA_RESOLTION_HEIGHT else CAMERA_RESOLTION_WIDTH\r\n            val editBitmap = Bitmap.createBitmap(readBitmap, 0, 0, originWidth, originHeight)\r\n            readBitmap.recycle()\r\n            // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«ç™»éŒ²ã™ã‚‹\r\n            val contentResolver = contentResolver\r\n            val contentValues = contentValuesOf(\r\n                MediaStore.Images.Media.DISPLAY_NAME to \"${System.currentTimeMillis()}.jpg\",\r\n                MediaStore.Images.Media.RELATIVE_PATH to \"${Environment.DIRECTORY_PICTURES}/ArisaDroid\"\r\n            )\r\n            val uri = contentResolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues) ?: return@launch\r\n            contentResolver.openOutputStream(uri).use { outputStream ->\r\n                editBitmap.compress(Bitmap.CompressFormat.JPEG, 100, outputStream)\r\n            }\r\n            editBitmap.recycle()\r\n            image.close()\r\n        }\r\n    }\r\n\r\n```\r\n\r\nã‚ã¨ã¯`capture`é–¢æ•°ã‚’å‘¼ã¶éƒ¨åˆ†ã‚’ä½œã‚Šã€ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾ã®ãŸã‚ã®å‘¼ã³å‡ºã—ã‚’è¿½åŠ ã™ã‚‹ã€‚\r\n\r\n```kotlin\r\nButton(\r\n    modifier = Modifier\r\n        .padding(bottom = 30.dp)\r\n        .align(Alignment.BottomCenter),\r\n    onClick = { capture() }\r\n) { Text(text = \"æ’®å½±ã™ã‚‹\") }\r\n```\r\n\r\n```kotlin\r\noverride fun onPause() {\r\n    super.onPause()\r\n    // ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾\r\n    cameraJob?.cancel()\r\n    previewSurfaceTexture.forEach {\r\n        it.setOnFrameAvailableListener(null)\r\n        it.release()\r\n    }\r\n    imageReader?.close()\r\n    previewSurfaceTexture.clear()\r\n    glSurfaceList.forEach { it.release() }\r\n    glSurfaceList.clear()\r\n    cameraControlList.forEach { it.destroy() }\r\n    cameraControlList.clear()\r\n}\r\n```\r\n\r\nã“ã‚Œã§ç¸¦ã§ã‚‚æ¨ªã§ã‚‚æ’®å½±ãŒã§ãã¦ã„ã‚‹ã¯ãšã§ã™ã€ã€ã€ï¼ã©ã†ã§ã—ã‚‡ã†ï¼Ÿ  \r\n`glReadPixels`ã¨é•ã„ã€æ’®å½±ã®å†™çœŸã‚µã‚¤ã‚ºã‚’æŒ‡å®šã§ãã¾ã™ã€‚ï¼ˆã¾ãå¾Œè¿°ã—ã¾ã™ãŒ`ImageReader`ã®ã›ã„ã§`Bitmap`ã‚’åŠ å·¥ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã™ãŒï¼‰ï¼ˆ`glReadPixels`ã§ã‚‚`Bitmap`ã‚’åŠ å·¥ã™ã‚Œã°ã‚µã‚¤ã‚ºå¤‰æ›´ã§ãã¾ã™ãŒã€ã€ã€ï¼‰  \r\n\r\nã‚ãªã¨ã—ã¦ã¯ã€`ImageReader`ã‹ã‚‰å–å¾—ã—ãŸç”»åƒã«é»’å¸¯ãŒä½•æ•…ã‹è¿½åŠ ã•ã‚Œã‚‹ã®ãŒã‚ã‚Šã¾ã™ã€‚  \r\nä½•æ•…ã‹`newInstance`ã—ãŸã¨ãã«æŒ‡å®šã—ãŸã‚µã‚¤ã‚ºã¨ã€ç”Ÿæˆã—ãŸ`Bitmap`ã®ã‚µã‚¤ã‚ºãŒä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚ï¼ˆ`Bitmap.createBitmap`ã«æ¸¡ã™ã‚µã‚¤ã‚ºã¯å³å®ˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¹±ã‚Œã¾ã™ï¼‰  \r\nã‚ˆãåˆ†ã‹ã‚‰ã‚“ã®ã§`Bitmap.createBitmap(åŠ å·¥å‰Bitmap , left , top , right , bottom )`ã§è¦ã‚‰ãªã„éƒ¨åˆ†ã‚’å‰Šã‚Šã¾ã—ãŸã€‚OOMãªã‚Šãã†ã§æ€–ã„  \r\n\r\nã‚ã¨ãã®ã¾ã¾`JPEG`ã¨ã—ã¦å–ã‚Šå‡ºã™æ©Ÿèƒ½ãŒ`ImageReader`ã«ã‚ã‚‹ã¿ãŸã„ã§ã™ãŒã€`OpenGL`ã¨ã‹ã§åŠ å·¥ã—ã¦ã„ã‚‹ã›ã„ã‹ã€ä»¥ä¸‹ã®ã‚¨ãƒ©ãƒ¼ã§åˆ©ç”¨ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚  \r\nï¼ˆ`rgba override blob format buffer should have height == width`ï¼‰  \r\n`PixelFormat.RGBA_8888`ã‚’ä½¿ã„ã€`Bitmap.createBitmap`ã§`Bitmap`ã«ã—ãŸã‚ã¨ã€`Bitmap#compress`ã‚’å‘¼ã³å‡ºã™ã“ã¨ã§`JPEG`ç”»åƒã«ã§ãã¾ã™ã€‚\r\n\r\n# éŒ²ç”»æ©Ÿèƒ½ã‚’ã¤ã‘ã‚‹ (ã¤ã¾ã‚Šæœ€çµ‚çš„ãª MainActivity )\r\n`ImageReader`ã®ã‚ˆã†ã«ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”¨Surfaceä»¥å¤–ã«éŒ²ç”»ç”¨Surfaceã‚’ç”¨æ„ã™ã‚‹ã“ã¨ã§åˆ©ç”¨ã§ãã¾ã™ã€‚  \r\néŒ²ç”»ç”¨Surfaceã¯`MediaRecorder`ã‹ã‚‰å–å¾—ã§ãã‚‹ã‚„ã¤ã§ã™ã€‚ä½ãƒ¬ãƒ™ãƒ«ã®`MediaCodec`ã§ã‚‚éŒ²ç”»ã§ãã¾ã™ãŒã‚ã–ã‚ã–é›£ã—ã„æ–¹ä½¿ã†å¿…è¦ã‚‚ãªã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/PsDLFGR.png)\r\n\r\nã„ã‹å®Ÿè£…ä¾‹ã€‚`MainActivity`ã«å…¨éƒ¨æ›¸ãã¾ã—ãŸã€‚å·®åˆ†ã‚‚å¤šã„ã®ã§å…¨éƒ¨ã®ã›ã¾ã™ã€‚è§£èª¬ã¯å¾Œã§  \r\né™æ­¢ç”»æ’®å½±ã¨å‹•ç”»æ’®å½±ã¯ã©ã£ã¡ã‹ã—ã‹åˆ©ç”¨ã§ããªã„ç”¨ã«ãªã£ã¦ã¾ã™ï¼ˆã¾ããˆãˆã‚„ã‚ï¼‰ã€‚  \r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity(), SurfaceTexture.OnFrameAvailableListener {\r\n\r\n    private val isPermissionGranted: Boolean\r\n        get() = ContextCompat.checkSelfPermission(this, android.Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED\r\n                && ContextCompat.checkSelfPermission(this, android.Manifest.permission.RECORD_AUDIO) == PackageManager.PERMISSION_GRANTED\r\n\r\n    private val isLandscape: Boolean\r\n        get() = resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE\r\n\r\n    private val surfaceView by lazy { SurfaceView(this) }\r\n\r\n    private val permissionRequest = registerForActivityResult(ActivityResultContracts.RequestMultiplePermissions()) {\r\n        if (it.all { it.value }) {\r\n            // onResume ã§ä»£æ›¿\r\n            // setup()\r\n        }\r\n    }\r\n\r\n    /** ç”Ÿæˆã—ãŸ [GLSurface] */\r\n    private val glSurfaceList = arrayListOf<GLSurface>()\r\n\r\n    /** åˆ©ç”¨ä¸­ã® [CameraControl] */\r\n    private val cameraControlList = arrayListOf<CameraControl>()\r\n\r\n    /** ç”Ÿæˆã—ãŸ [SurfaceTexture] */\r\n    private val previewSurfaceTexture = arrayListOf<SurfaceTexture>()\r\n\r\n    /** onFrameAvailable ãŒå‘¼ã°ã‚ŒãŸã‚‰ +1 ã—ã¦ã„ã */\r\n    private var unUsedFrameCount = 0L\r\n\r\n    /** updateTexImage ã‚’å‘¼ã‚“ã ã‚‰ +1 ã—ã¦ã„ã */\r\n    private var usedFrameCount = 0L\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ç”¨ã‚¹ãƒ¬ãƒƒãƒ‰ */\r\n    private var cameraJob: Job? = null\r\n\r\n    /**\r\n     * æ’®å½±ãƒ¢ãƒ¼ãƒ‰\r\n     *\r\n     * é™æ­¢ç”»æ’®å½±ãªã‚‰[imageReader]ã€å‹•ç”»æ’®å½±ãªã‚‰[mediaRecorder]ãŒä½¿ã‚ã‚Œã¾ã™\r\n     */\r\n    private var currentCaptureMode = CameraCaptureMode.VIDEO\r\n\r\n    /** é™æ­¢ç”»æ’®å½±  */\r\n    private var imageReader: ImageReader? = null\r\n\r\n    /** éŒ²ç”»æ©Ÿèƒ½ */\r\n    private var mediaRecorder: MediaRecorder? = null\r\n\r\n    /** éŒ²ç”»ä¸­ã‹ */\r\n    private var isRecording = false\r\n\r\n    /** éŒ²ç”»ä¸­ãƒ•ã‚¡ã‚¤ãƒ« */\r\n    private var saveVideoFile: File? = null\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        // ã“ã‚Œ\r\n        WindowCompat.getInsetsController(window, window.decorView).apply {\r\n            hide(WindowInsetsCompat.Type.systemBars())\r\n            systemBarsBehavior = WindowInsetsControllerCompat.BEHAVIOR_SHOW_TRANSIENT_BARS_BY_SWIPE\r\n        }\r\n        window.setDecorFitsSystemWindows(false)\r\n        window.attributes.layoutInDisplayCutoutMode = WindowManager.LayoutParams.LAYOUT_IN_DISPLAY_CUTOUT_MODE_SHORT_EDGES\r\n\r\n        setContent {\r\n            Box(\r\n                modifier = Modifier\r\n                    .background(Color.Black)\r\n                    .fillMaxSize()\r\n            ) {\r\n                AndroidView(\r\n                    modifier = Modifier\r\n                        .align(Alignment.Center)\r\n                        // 16:9 ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã«ã™ã‚‹\r\n                        .aspectRatio(\r\n                            if (resources.configuration.orientation == Configuration.ORIENTATION_LANDSCAPE) {\r\n                                CAMERA_RESOLTION_WIDTH.toFloat() / CAMERA_RESOLTION_HEIGHT.toFloat()\r\n                            } else {\r\n                                CAMERA_RESOLTION_HEIGHT.toFloat() / CAMERA_RESOLTION_WIDTH.toFloat()\r\n                            }\r\n                        ),\r\n                    factory = { surfaceView }\r\n                )\r\n                Button(\r\n                    modifier = Modifier\r\n                        .padding(bottom = 30.dp)\r\n                        .align(Alignment.BottomCenter),\r\n                    onClick = { capture() }\r\n                ) { Text(text = \"æ’®å½± éŒ²ç”» ã™ã‚‹\") }\r\n            }\r\n        }\r\n    }\r\n\r\n    override fun onFrameAvailable(surfaceTexture: SurfaceTexture?) {\r\n        // æ›´æ–°ã‚’é€šçŸ¥ã™ã‚‹ãŸã‚ã€å€¤ã‚’æ›´æ–°ã™ã‚‹\r\n        unUsedFrameCount++\r\n    }\r\n\r\n    override fun onResume() {\r\n        super.onResume()\r\n        if (isPermissionGranted) {\r\n            setup()\r\n        } else {\r\n            permissionRequest.launch(arrayOf(android.Manifest.permission.CAMERA, android.Manifest.permission.RECORD_AUDIO))\r\n        }\r\n    }\r\n\r\n    override fun onPause() {\r\n        super.onPause()\r\n        lifecycleScope.launch(Dispatchers.IO) {\r\n            cameraDestroy()\r\n        }\r\n    }\r\n\r\n    /** ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾ã€‚ã‚µã‚¹ãƒšãƒ³ãƒ‰é–¢æ•°ãªã®ã§çµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹ */\r\n    private suspend fun cameraDestroy() {\r\n        // ã‚­ãƒ£ãƒ³ã‚»ãƒ«å¾…ã¡ã‚’ã™ã‚‹ã“ã¨ã§GLã®ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹ã®ã‚’å¾…ã¤ï¼ˆå¤šåˆ†æç”»ä¸­ã«çµ‚äº†ã™ã‚‹ã¨è½ã¡ã‚‹ï¼‰\r\n        cameraJob?.cancelAndJoin()\r\n        previewSurfaceTexture.forEach {\r\n            it.setOnFrameAvailableListener(null)\r\n            it.release()\r\n        }\r\n        previewSurfaceTexture.clear()\r\n        imageReader?.close()\r\n        glSurfaceList.forEach { it.release() }\r\n        glSurfaceList.clear()\r\n        cameraControlList.forEach { it.destroy() }\r\n        cameraControlList.clear()\r\n        if (isRecording) {\r\n            mediaRecorder?.stop()\r\n        }\r\n        mediaRecorder?.release()\r\n        mediaRecorder = null\r\n    }\r\n\r\n    private fun setup() {\r\n        cameraJob = lifecycleScope.launch(Dispatchers.IO) {\r\n            // SurfaceView ã‚’å¾…ã¤\r\n            val previewSurface = waitSurface()\r\n            // æ’®å½±ãƒ¢ãƒ¼ãƒ‰ã«åˆã‚ã›ãŸ Surface ã‚’ä½œã‚‹ï¼ˆé™æ­¢ç”»æ’®å½±ã€å‹•ç”»æ’®å½±ï¼‰\r\n            val captureSurface = if (currentCaptureMode == CameraCaptureMode.PICTURE) {\r\n                // é™æ­¢ç”»æ’®å½±ã§åˆ©ç”¨ã™ã‚‹ ImageReader\r\n                // Surface ã®å…¥åŠ›ã‹ã‚‰ç”»åƒã‚’ç”Ÿæˆã§ãã‚‹\r\n                val imageReader = ImageReader.newInstance(\r\n                    if (isLandscape) CAMERA_RESOLTION_WIDTH else CAMERA_RESOLTION_HEIGHT,\r\n                    if (isLandscape) CAMERA_RESOLTION_HEIGHT else CAMERA_RESOLTION_WIDTH,\r\n                    PixelFormat.RGBA_8888, // JPEG ã¯ OpenGL ä½¿ã£ãŸã›ã„ãªã®ã‹åˆ©ç”¨ã§ããªã„\r\n                    2\r\n                )\r\n                this@MainActivity.imageReader = imageReader\r\n                imageReader.surface\r\n            } else {\r\n                // ãƒ¡ã‚½ãƒƒãƒ‰å‘¼ã³å‡ºã—ã«ã¯é †ç•ªãŒã‚ã‚Šã¾ã™\r\n                val mediaRecorder = (if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) MediaRecorder(this@MainActivity) else MediaRecorder()).apply {\r\n                    setAudioSource(MediaRecorder.AudioSource.MIC)\r\n                    setVideoSource(MediaRecorder.VideoSource.SURFACE)\r\n                    setOutputFormat(MediaRecorder.OutputFormat.MPEG_4)\r\n                    setVideoEncoder(MediaRecorder.VideoEncoder.H264)\r\n                    setAudioEncoder(MediaRecorder.AudioEncoder.AAC)\r\n                    setAudioChannels(2)\r\n                    setVideoEncodingBitRate(1_000_000)\r\n                    setVideoFrameRate(30)\r\n                    if (isLandscape) {\r\n                        setVideoSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    } else {\r\n                        setVideoSize(CAMERA_RESOLTION_HEIGHT, CAMERA_RESOLTION_WIDTH)\r\n                    }\r\n                    setAudioEncodingBitRate(128_000)\r\n                    setAudioSamplingRate(44_100)\r\n                    saveVideoFile = File(getExternalFilesDir(null), \"${System.currentTimeMillis()}.mp4\")\r\n                    setOutputFile(saveVideoFile!!)\r\n                    prepare()\r\n                }\r\n                this@MainActivity.mediaRecorder = mediaRecorder\r\n                mediaRecorder.surface\r\n            }\r\n\r\n            // CameraRenderer ã‚’ä½œã‚‹\r\n            val previewCameraGLRenderer = CameraGLRenderer(\r\n                rotation = if (isLandscape) 90f else 0f, // ç”»é¢å›è»¢\r\n                mainSurfaceTexture = { previewSurfaceTexture[0] },\r\n                subSurfaceTexture = { previewSurfaceTexture[1] }\r\n            )\r\n            val captureCameraGLRenderer = CameraGLRenderer(\r\n                rotation = if (isLandscape) 90f else 0f, // ç”»é¢å›è»¢\r\n                mainSurfaceTexture = { previewSurfaceTexture[2] },\r\n                subSurfaceTexture = { previewSurfaceTexture[3] }\r\n            )\r\n            // GLSurface ã‚’ä½œã‚‹\r\n            val previewGlSurface = GLSurface(\r\n                surface = previewSurface,\r\n                renderer = previewCameraGLRenderer,\r\n            )\r\n            val captureGlSurface = GLSurface(\r\n                surface = captureSurface,\r\n                renderer = captureCameraGLRenderer\r\n            )\r\n            glSurfaceList += previewGlSurface\r\n            glSurfaceList += captureGlSurface\r\n\r\n            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ / é™æ­¢ç”»æ’®å½± ã§åˆ©ç”¨ã™ã‚‹ SurfaceTexture ã‚’ç”¨æ„\r\n            // SurfaceTexture ã®å ´åˆã¯ setDefaultBufferSize ã§ã‚«ãƒ¡ãƒ©ã®è§£åƒåº¦ã®è¨­å®šãŒã§ãã‚‹ (720P ãªã©)\r\n            previewGlSurface.makeCurrent()\r\n            val previewSurfaceTexturePair = previewCameraGLRenderer.setupProgram().let { (mainCameraTextureId, subCameraTextureId) ->\r\n                // ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n                val main = SurfaceTexture(mainCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                // ã‚µãƒ–æ˜ åƒ\r\n                val sub = SurfaceTexture(subCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                main to sub\r\n            }\r\n            captureGlSurface.makeCurrent()\r\n            val captureSurfaceTexturePair = captureCameraGLRenderer.setupProgram().let { (mainCameraTextureId, subCameraTextureId) ->\r\n                // ãƒ¡ã‚¤ãƒ³æ˜ åƒ\r\n                val main = SurfaceTexture(mainCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                // ã‚µãƒ–æ˜ åƒ\r\n                val sub = SurfaceTexture(subCameraTextureId).apply {\r\n                    setDefaultBufferSize(CAMERA_RESOLTION_WIDTH, CAMERA_RESOLTION_HEIGHT)\r\n                    setOnFrameAvailableListener(this@MainActivity)\r\n                }\r\n                main to sub\r\n            }\r\n            previewSurfaceTexture.addAll(previewSurfaceTexturePair.toList())\r\n            previewSurfaceTexture.addAll(captureSurfaceTexturePair.toList())\r\n\r\n            // ã©ã£ã¡ã®ã‚«ãƒ¡ãƒ©ã‚’ãƒ¡ã‚¤ãƒ³æ˜ åƒã«ã™ã‚‹ã‹\r\n            // ä»Šå›ã¯ãƒ¡ã‚¤ãƒ³æ˜ åƒã‚’ãƒãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã€ã‚µãƒ–æ˜ åƒï¼ˆãƒ¯ã‚¤ãƒ—ï¼‰ã‚’ãƒ•ãƒ­ãƒ³ãƒˆã‚«ãƒ¡ãƒ©ã«æŒ‡å®š\r\n            // Pair ã¯ ãƒ¡ã‚¤ãƒ³æ˜ åƒã«æŒ‡å®šã™ã‚‹ SurfaceTexture ã®ãƒªã‚¹ãƒˆ\r\n            val mainSurfaceTexture = listOf(previewSurfaceTexturePair.first, captureSurfaceTexturePair.first)\r\n            val subSurfaceTexture = listOf(previewSurfaceTexturePair.second, captureSurfaceTexturePair.second)\r\n\r\n            // ã‚«ãƒ¡ãƒ©ã‚’é–‹ã\r\n            val (backCameraId, frontCameraId) = CameraTool.getCameraId(this@MainActivity)\r\n            cameraControlList += CameraControl(this@MainActivity, backCameraId, Surface(mainSurfaceTexture[0]), Surface(mainSurfaceTexture[1]))\r\n            cameraControlList += CameraControl(this@MainActivity, frontCameraId, Surface(subSurfaceTexture[0]), Surface(subSurfaceTexture[1]))\r\n            cameraControlList.forEach { it.openCamera() }\r\n            // ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹\r\n            cameraControlList.forEach { it.startCamera() }\r\n\r\n            // OpenGL ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã‚’è¡Œã†\r\n            // isActive ã§ã“ã® cameraJob ãŒçµ‚äº†ã•ã‚Œã‚‹ã¾ã§ãƒ«ãƒ¼ãƒ—ã—ç¶šã‘ã‚‹\r\n            // ã“ã“ã§è¡Œã†ç†ç”±ã§ã™ãŒã€makeCurrent ã—ãŸã‚¹ãƒ¬ãƒƒãƒ‰ã§ãªã„ã¨ glDrawArray ã§ããªã„ï¼Ÿ + onFrameAvailable ãŒ UIã‚¹ãƒ¬ãƒƒãƒ‰ ãªã®ã§é‡ãŸã„ã“ã¨ã¯ã§ããªã„ãŸã‚ã§ã™ã€‚\r\n            // ãŸã ã€ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã¯ onFrameAvailable ãŒæ›´æ–°ã•ã‚ŒãŸã‚¿ã‚¤ãƒŸãƒ³ã‚°ãªã®ã§ã€\r\n            // while ãƒ«ãƒ¼ãƒ—ã‚’å›ã—ã¦ æ–°ã—ã„ãƒ•ãƒ¬ãƒ¼ãƒ ãŒæ¥ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ã¾ã™ã€‚\r\n            while (isActive) {\r\n                // OpenGL ã®æç”»ã‚ˆã‚Šã‚‚ onFrameAvailable ã®æ›´æ–°ã®ã»ã†ãŒæ—©ã„ï¼ŸãŸã‚ã€æ›´æ–°ãŒè¿½ã„ã¤ã„ã¦ã—ã¾ã†\r\n                // ãã®ãŸã‚ã€æ¶ˆè²»ã—ãŸãƒ•ãƒ¬ãƒ¼ãƒ ã¨ã¾ã æ¶ˆè²»ã—ã¦ã„ãªã„ãƒ•ãƒ¬ãƒ¼ãƒ ã‚’æ¯”è¼ƒã™ã‚‹ã‚ˆã†ã«ã—ãŸ\r\n                // https://stackoverflow.com/questions/14185661\r\n                if (unUsedFrameCount != usedFrameCount && isActive) {\r\n                    glSurfaceList.forEach {\r\n                        it.makeCurrent() // å¤šåˆ†ã„ã‚‹\r\n                        it.drawFrame()\r\n                        it.swapBuffers()\r\n                    }\r\n                    usedFrameCount += 2 // ãƒ¡ã‚¤ãƒ³æ˜ åƒã¨ã‚µãƒ–æ˜ åƒã§2ã¤\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** æ’®å½±ã€éŒ²ç”»ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã */\r\n    private fun capture() {\r\n        lifecycleScope.launch(Dispatchers.IO) {\r\n            if (currentCaptureMode == CameraCaptureMode.VIDEO) {\r\n                // éŒ²ç”»ãƒ¢ãƒ¼ãƒ‰\r\n                if (!isRecording) {\r\n                    mediaRecorder?.start()\r\n                } else {\r\n                    // å¤šåˆ† MediaRecorder ã‚’ä½œã‚Šç›´ã•ãªã„ã¨ã„ã‘ãªã„\r\n                    cameraDestroy()\r\n                    // å‹•ç”»ãƒ•ã‚©ãƒ«ãƒ€ ã«ä¿å­˜ã™ã‚‹\r\n                    val contentResolver = contentResolver\r\n                    val contentValues = contentValuesOf(\r\n                        MediaStore.Video.Media.DISPLAY_NAME to saveVideoFile?.name,\r\n                        MediaStore.Video.Media.RELATIVE_PATH to \"${Environment.DIRECTORY_MOVIES}/ArisaDroid\"\r\n                    )\r\n                    contentResolver.insert(MediaStore.Video.Media.EXTERNAL_CONTENT_URI, contentValues)?.also { uri ->\r\n                        contentResolver.openOutputStream(uri)?.use { outputStream ->\r\n                            saveVideoFile?.inputStream()?.use { inputStream ->\r\n                                inputStream.copyTo(outputStream)\r\n                            }\r\n                        }\r\n                    }\r\n                    setup()\r\n                }\r\n                isRecording = !isRecording\r\n            } else {\r\n                // é™æ­¢ç”»ãƒ¢ãƒ¼ãƒ‰\r\n                // ImageReader ã‹ã‚‰å–ã‚Šå‡ºã™\r\n                val image = imageReader?.acquireLatestImage() ?: return@launch\r\n                val width = image.width\r\n                val height = image.height\r\n                val planes = image.planes\r\n                val buffer = planes[0].buffer\r\n                // ãªãœã‹ ImageReader ã®ã‚µã‚¤ã‚ºã«åŠ ãˆã¦ã€ä½•æ•…ã‹ Padding ãŒå…¥ã£ã¦ã„ã‚‹ã“ã¨ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹\r\n                val pixelStride = planes[0].pixelStride\r\n                val rowStride = planes[0].rowStride\r\n                val rowPadding = rowStride - pixelStride * width\r\n                // Bitmap ä½œæˆ\r\n                val readBitmap = Bitmap.createBitmap(width + rowPadding / pixelStride, height, Bitmap.Config.ARGB_8888)\r\n                readBitmap.copyPixelsFromBuffer(buffer)\r\n                // ä½™åˆ†ãª Padding ã‚’æ¶ˆã™\r\n                val originWidth = if (isLandscape) CAMERA_RESOLTION_WIDTH else CAMERA_RESOLTION_HEIGHT\r\n                val originHeight = if (isLandscape) CAMERA_RESOLTION_HEIGHT else CAMERA_RESOLTION_WIDTH\r\n                val editBitmap = Bitmap.createBitmap(readBitmap, 0, 0, originWidth, originHeight)\r\n                readBitmap.recycle()\r\n                // ã‚®ãƒ£ãƒ©ãƒªãƒ¼ã«ç™»éŒ²ã™ã‚‹\r\n                val contentResolver = contentResolver\r\n                val contentValues = contentValuesOf(\r\n                    MediaStore.Images.Media.DISPLAY_NAME to \"${System.currentTimeMillis()}.jpg\",\r\n                    MediaStore.Images.Media.RELATIVE_PATH to \"${Environment.DIRECTORY_PICTURES}/ArisaDroid\"\r\n                )\r\n                val uri = contentResolver.insert(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, contentValues) ?: return@launch\r\n                contentResolver.openOutputStream(uri).use { outputStream ->\r\n                    editBitmap.compress(Bitmap.CompressFormat.JPEG, 100, outputStream)\r\n                }\r\n                editBitmap.recycle()\r\n                image.close()\r\n            }\r\n        }\r\n    }\r\n\r\n    /** Surface ã®ç”¨æ„ãŒçµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹ */\r\n    private suspend fun waitSurface() = suspendCoroutine { continuation ->\r\n        surfaceView.holder.apply {\r\n            if (surface.isValid) {\r\n                continuation.resume(this.surface)\r\n            } else {\r\n                var callback: SurfaceHolder.Callback? = null\r\n                callback = object : SurfaceHolder.Callback {\r\n                    override fun surfaceCreated(holder: SurfaceHolder) {\r\n                        continuation.resume(holder.surface)\r\n                        removeCallback(callback)\r\n                    }\r\n\r\n                    override fun surfaceChanged(holder: SurfaceHolder, format: Int, width: Int, height: Int) {\r\n                        // do nothing\r\n                    }\r\n\r\n                    override fun surfaceDestroyed(holder: SurfaceHolder) {\r\n                        // do nothing\r\n                    }\r\n                }\r\n                addCallback(callback)\r\n            }\r\n        }\r\n    }\r\n\r\n    /** æ’®å½±ãƒ¢ãƒ¼ãƒ‰ */\r\n    private enum class CameraCaptureMode {\r\n        PICTURE,\r\n        VIDEO,\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** 720P è§£åƒåº¦ å¹… */\r\n        private const val CAMERA_RESOLTION_WIDTH = 1280\r\n\r\n        /** 720P è§£åƒåº¦ é«˜ã• */\r\n        private const val CAMERA_RESOLTION_HEIGHT = 720\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ã¤ã„ã§ã« æœ€çµ‚çš„ãª CameraControl \r\n\r\n```kotlin\r\n/**\r\n * ã‚«ãƒ¡ãƒ©ã‚’é–‹ã‘ãŸã‚Šé–‰ã˜ãŸã‚Šã™ã‚‹å‡¦ç†ã‚’éš è”½ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\n *\r\n * @param context [Context]\r\n * @param cameraId ã‚«ãƒ¡ãƒ©IDã€å‰é¢ or èƒŒé¢\r\n * @param previewSurface ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼Surface\r\n * @param captureSurface æ’®å½±ã€éŒ²ç”» ç”¨Surface\r\n */\r\nclass CameraControl(\r\n    context: Context,\r\n    private val cameraId: String,\r\n    private val previewSurface: Surface,\r\n    private val captureSurface: Surface\r\n) {\r\n    private val cameraManager = context.getSystemService(Context.CAMERA_SERVICE) as CameraManager\r\n    private val cameraExecutor = Executors.newSingleThreadExecutor()\r\n    private var cameraDevice: CameraDevice? = null\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    suspend fun openCamera() {\r\n        cameraDevice = waitOpenCamera()\r\n    }\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹ã™ã‚‹ */\r\n    fun startCamera() {\r\n        val cameraDevice = cameraDevice ?: return\r\n        val captureRequest = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE).apply {\r\n            addTarget(previewSurface)\r\n            addTarget(captureSurface)\r\n        }.build()\r\n        val outputList = buildList {\r\n            add(OutputConfiguration(previewSurface))\r\n            add(OutputConfiguration(captureSurface))\r\n        }\r\n        SessionConfiguration(SessionConfiguration.SESSION_REGULAR, outputList, cameraExecutor, object : CameraCaptureSession.StateCallback() {\r\n            override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                captureSession.setRepeatingRequest(captureRequest, null, null)\r\n            }\r\n\r\n            override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n                // do nothing\r\n            }\r\n        }).apply { cameraDevice.createCaptureSession(this) }\r\n    }\r\n\r\n    /** çµ‚äº†æ™‚ã«å‘¼ã³å‡ºã™ */\r\n    fun destroy() {\r\n        cameraDevice?.close()\r\n    }\r\n\r\n    /** [cameraId]ã®ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    @SuppressLint(\"MissingPermission\")\r\n    suspend private fun waitOpenCamera() = suspendCoroutine {\r\n        cameraManager.openCamera(cameraId, cameraExecutor, object : CameraDevice.StateCallback() {\r\n            override fun onOpened(camera: CameraDevice) {\r\n                it.resume(camera)\r\n            }\r\n\r\n            override fun onDisconnected(camera: CameraDevice) {\r\n                // do nothing\r\n            }\r\n\r\n            override fun onError(camera: CameraDevice, error: Int) {\r\n                // do nothing\r\n            }\r\n        })\r\n    }\r\n\r\n}\r\n```\r\n\r\n## è§£èª¬\r\n`currentCaptureMode`ã¯é™æ­¢ç”»ãŒå‹•ç”»ã©ã£ã¡ãªã®ã‹ãŒå…¥ã£ã¦ã¾ã™ã€‚`setup()`ã®å‘¼ã³å‡ºã—å‰ã®ã¿å¤‰æ›´ã§ãã¾ã™ã€‚  \r\n`MediaRecorder`ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯æŒ‡å®šã«`H.264`ã‚’ä½¿ã£ãŸã®ã§ã™ãŒã€`H.264`ãªã®ã§ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã‚’å‰²ã‚Šã¨é«˜ã‚ã«ã—ãªã„ã¨æ®‹å¿µãªç”»è³ªã«ãªã‚‹ã¨æ€ã„ã¾ã™ï¼ˆä»Šå›ã¯`1Mbps`ã«ã—ã¦ã¿ãŸã‘ã©æ®‹å¿µãªç”»è³ªï¼‰  \r\n\r\né™æ­¢ç”»æ’®å½±ã¨é•ã„ã€éŒ²ç”»ã‚’çµ‚äº†ã™ã‚‹ã¨`MediaRecorder`ã‚’ä½œã‚Šç›´ã™å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€ã€éƒ¨åˆ†çš„ã«ä½œã‚Šç›´ã™ã®ã¯ï¼ˆå¤šåˆ†ï¼‰ã§ããªã„ã®ã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‹ã‚‰ä½œã‚Šç›´ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nãªã®ã§ã€`onPause`ä»¥å¤–ã§ã‚‚ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾å‡ºæ¥ã‚‹ã‚ˆã†`cameraDestory()`é–¢æ•°ã«åˆ‡ã‚Šå‡ºã—ã€éŒ²ç”»åœæ­¢æ™‚ã«å…¨éƒ¨ä½œã‚Šç›´ã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚ï¼ˆæ­£è§£ãªã®ã‹ã¯çŸ¥ã‚‰ãªã„ã€ã€ã€ãã—ã¦è‹¥å¹²æ™‚é–“ãŒã‹ã‹ã‚‹ï¼‰  \r\n \r\n`cameraJob.cancelAndJoin()`ã™ã‚‹ã“ã¨ã§ã€ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãŒå®Œäº†ã™ã‚‹ã¾ã§å¾…ã£ã¦ãã‚Œã¾ã™ã€‚`cancel`ã ã¨ç›´ã¡ã«ã¯çµ‚äº†ã—ãªã„ã‚‰ã—ã„ã€‚  \r\n`OpenGL ã® while ãƒ«ãƒ¼ãƒ—`ã‚’æŠœã‘ãŸå¾Œã«ã‚«ãƒ¡ãƒ©ã¨ã‹ã®ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹æ”¾ã—ãªã„ã¨`EGL`ãŒãªã‚“ã¨ã‹ã§è½ã¡ã¦ã—ã¾ã†ã®ã§æ°—ã‚’ã¤ã‘ã‚ˆã†  \r\nï¼ˆã‚‚ã‚ã‚‚ã‚ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾å¾Œã«`whileãƒ«ãƒ¼ãƒ—`ãŒç”Ÿãæ®‹ã£ã¦ãŸã‚‰ã—ãè½ã¡ãŸï¼‰\r\n\r\n# ããƒ¼ã™ã“ãƒ¼ã©\r\nã™ãä½¿ãˆã‚‹ã¨æ€ã†\r\n\r\n- https://github.com/takusan23/MultiCamera\r\n    - ã“ã®è¨˜äº‹æ™‚ç‚¹ã®ã‚³ãƒ¼ãƒ‰\r\n- https://github.com/takusan23/ArisaDroid\r\n    - çœŸé¢ç›®ã«ä½œã‚ã†ã¨ã—ãŸã‘ã©è€ƒãˆã‚‹ã“ã¨å¤šã™ãã¦ä½œã‚‹ã‹è¿·ã£ã¦ã‚‹\r\n    - è¨˜è¿°æ™‚æ™‚ç‚¹ã‹ã‚‰ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰å¤‰æ›´ã—ã¦ã‚‹ã¨æ€ã†ã‹ã‚‰å‰è€…ã®æ–¹ã‚’ä½¿ã£ã¦ãã ã•ã„\r\n\r\n# ãã®ã»ã‹\r\n## eglSwapBuffers: EGL error: 0x300d\r\n- `makeCurrent`å‘¼ã‚“ã§ã¾ã™ã‹ï¼Ÿ\r\n- `Surface`ã‚’ç ´æ£„ã—ãŸå¾Œã«`eglSwapBuffers`ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã›ã‚“ã‹ï¼Ÿ\r\n\r\n## Surface ãŒçµ‚äº†ã—ãŸã‚‰ ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾ã™ã‚‹\r\næ›¸ã„ã¦ã¾ã›ã‚“ãŒã€ã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nthx!!!\r\n\r\n- https://github.com/android/camera-samples\r\n- https://stackoverflow.com/questions/14185661\r\n- https://cs.android.com/android/platform/superproject/+/master:cts/tests/media/common/src/android/mediav2/common/cts/InputSurface.java;l=1?\r\n- https://techbooster.org/android/application/17026/\r\n- https://medium.com/@itometeam/camera2-apiã‚’ä½¿ã„ã“ãªã™-part-1-ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®è¡¨ç¤º-e5e799a7b4dd\r\n\r\n# ãŠã¾ã‘ ã‚ºãƒ¼ãƒ ã™ã‚‹ å‰æç·¨\r\nã›ã£ã‹ããªã®ã§ã‚ºãƒ¼ãƒ æ©Ÿèƒ½ã‚’ã¤ã‘ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\n`Camera 2 API`ã§ã¯`Android 11`ä»¥å‰ã‹ã‚‰ä½¿ãˆã‚‹`SCALER_CROP_REGION`ã¨ä»¥é™ã§åˆ©ç”¨ã§ãã‚‹`CONTROL_ZOOM_RATIO_RANGE`ãŒã‚ã‚‹ã£ã½ã„ã§ã™ã€‚  \r\nä»Šå›ã¯å¾Œè€…ã®`CONTROL_ZOOM_RATIO_RANGE`ã‚’è©¦ã—ã¾ã™ã€‚ãªã‚“ã‹å‰è€…ã¯ã‚ºãƒ¼ãƒ ç¯„å›²ã‚’è‡ªå‰ã§è¨ˆç®—ï¼Ÿï¼ˆå››è§’å½¢ã®åº§æ¨™ã‚’è‡ªå‰ã§ç”¨æ„ã™ã‚‹ï¼Ÿï¼‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚‰ã—ãã€  \r\nå¾Œè€…ã¯ãã®ã¾ã¾ 1f~ (åºƒè§’æ­è¼‰æ™‚ã¯ .7f ~ ã§ã—ã‚‡ã†ã‹) ã®ã‚ˆã†ãªæŒ‡å®šãŒã§ãã‚‹ã‚ˆã†ã§ã™ã€‚  \r\n\r\n`Pixel 6 Pro`ã ã¨æœ›é ã‚«ãƒ¡ãƒ©ï¼ˆãƒšãƒªã‚¹ã‚³ãƒ¼ãƒ—ï¼‰ã‚‚åºƒè§’ã‚«ãƒ¡ãƒ©ã‚‚`CONTROL_ZOOM_RATIO_RANGE`ã‚’å¤‰æ›´ã™ã‚‹ã“ã¨ã§å¤‰æ›´ã—ãŸå€¤ã«ã‚ˆã£ã¦é©åˆ‡ãªã‚«ãƒ¡ãƒ©ãŒè‡ªå‹•ã§é¸æŠã•ã‚Œã‚‹ã‚‰ã—ã„ã§ã™ã€‚ï¼ˆ20ã‚’å…¥ã‚ŒãŸã‚‰æœ›é ã€0.6ã‚’å…¥ã‚ŒãŸã‚‰åºƒè§’ ã¿ãŸã„ãªï¼‰\r\n\r\nãŒã€â†‘ã®æ–¹æ³•ãŒä½¿ãˆã‚‹ã®ã¯ã€**è«–ç†ã‚«ãƒ¡ãƒ©**ã®å ´åˆã®ã¿ã§ã™ã€‚ï¼ˆ`getCameraIdList`ã§ãƒ•ãƒ­ãƒ³ãƒˆã€ãƒãƒƒã‚¯ã§ãã‚Œãã‚Œä¸€å€‹ãšã¤é…åˆ—ã«å…¥ã£ã¦ã„ã‚‹å ´åˆï¼‰  \r\n**ãã‚Œã¨ã¯åˆ¥ã«**`Camera 2 API`ã®`getCameraIdList`ã§ãƒãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã®æ•°ã ã‘è¿”ã£ã¦ãã‚‹å ´åˆï¼ˆæ¨™æº–ã€åºƒè§’ã€æœ›é  ãã‚Œãã‚Œã«IDãŒæŒ¯ã‚‰ã‚Œã¦ã„ã‚‹ï¼‰ã€é¸æŠä¸­ã®ã‚«ãƒ¡ãƒ©ã®ã‚ºãƒ¼ãƒ ã®ã¿ãŒåˆ©ç”¨ã§ãã¾ã™ã€‚  \r\nï¼ˆæ¨™æº–ã‚«ãƒ¡ãƒ©ã®å ´åˆã¯æ¨™æº–ã‚«ãƒ¡ãƒ©ãŒä½¿ãˆã‚‹ã‚ºãƒ¼ãƒ ç¯„å›²ã®ã¿ã€‚ã‚‚ã—æ¨™æº–â†’æœ›é ã«ã—ãŸã„å ´åˆã¯ã‚«ãƒ¡ãƒ©ã‚’é–‹ãç›´ã™ã¨ã“ã‚ã‹ã‚‰ã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ï¼‰  \r\nï¼ˆç«¯æœ«ã«ã‚ˆã£ã¦ã¯éŒ²ç”»ä¸­ã¯ç‰©ç†ã‚«ãƒ¡ãƒ©ã‚’å¤‰æ›´ã§ããªã„ã‚„ã¤ãŒã‚ã‚Šã¾ã™ãŒã“ã®è¾ºãŒå½±éŸ¿ã—ã¦ã„ãã†ã§ã™ã­ã€‚ï¼‰  \r\nï¼ˆä»Šå›ã¯é¢å€’ãªã®ã§ã‚„ã‚‰ãªã„ã§ã™ã€ã€ã€ï¼‰  \r\n\r\n## ã‚ºãƒ¼ãƒ ã™ã‚‹\r\n`CameraControl`å†…ã«ã‚ºãƒ¼ãƒ ã§ãã‚‹ç¯„å›²ã‚’å–å¾—ã§ãã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚  \r\n`Pixel 6 Pro`ã®ãƒãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã®å ´åˆã¯`0.6704426..20.0`ãŒè¿”ã£ã¦ãã¾ã—ãŸã€‚20å€ã‚ºãƒ¼ãƒ ï¼ï¼ãƒšãƒªã‚¹ã‚³ãƒ¼ãƒ—ã™ã”ã„ã€‚å¯å‹•éƒ¨å“ã‚’è¼‰ã›ã‚‹å‹‡æ°—ï¼ï¼  \r\nï¼ˆãƒšãƒªã‚¹ã‚³ãƒ¼ãƒ—ã®ã›ã„ã§ã‚¹ãƒãƒ›ã‚’æŒ¯ã‚‹ã¨ã‚«ã‚¿ã‚«ã‚¿éŸ³ãŒé³´ã‚‹ã‚“ã ã‘ã©ã¡ã‚‡ã£ã¨æ€–ã„ã€‚`pixel 6 pro rattle`ã§æ¤œç´¢æ¤œç´¢ï¼‰\r\n\r\n```kotlin\r\nclass CameraControl(\r\n    context: Context,\r\n    private val cameraId: String,\r\n    private val previewSurface: Surface,\r\n    private val captureSurface: Surface\r\n) {\r\n\r\n    /** ã‚ºãƒ¼ãƒ å‡ºæ¥ã‚‹å€¤ã®ç¯„å›²ã‚’è¿”ã™ */\r\n    val zoomRange = cameraManager.getCameraCharacteristics(cameraId)?.get(CameraCharacteristics.CONTROL_ZOOM_RATIO_RANGE)?.let {\r\n        // Pixel 6 Pro ã®å ´åˆã¯ 0.6704426..20.0 ã®ã‚ˆã†ãªå€¤ã«ãªã‚‹\r\n        it.lower..it.upper\r\n    } ?: 0f..0f\r\n\r\n```\r\n\r\nå¾Œã¯ã‚«ãƒ¡ãƒ©é–‹å§‹æ™‚ã«ã‚ºãƒ¼ãƒ ã™ã‚‹å€¤ã‚’æ¸¡ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\nå·®åˆ†ãŒé¢å€’ãªã®ã§å…¨éƒ¨å¼µã‚Šã¾ã™ã€‚`captureRequest`ã¨`currentCaptureSession`ã‚’ä»–ã®æ§‹æˆã§ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ç§»å‹•ã•ã›ã¾ã—ãŸã€‚  \r\n`setRepeatingRequest`ã§ã‚ºãƒ¼ãƒ å¾Œã®æ§‹æˆã§ã‚«ãƒ¡ãƒ©ã‚’åˆ©ç”¨ã§ãã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass CameraControl(\r\n    context: Context,\r\n    private val cameraId: String,\r\n    private val previewSurface: Surface,\r\n    private val captureSurface: Surface\r\n) {\r\n    private val cameraManager = context.getSystemService(Context.CAMERA_SERVICE) as CameraManager\r\n    private val cameraExecutor = Executors.newSingleThreadExecutor()\r\n    private var cameraDevice: CameraDevice? = null\r\n\r\n    private var captureRequest: CaptureRequest.Builder? = null\r\n    private var currentCaptureSession: CameraCaptureSession? = null\r\n    private val outputList = buildList {\r\n        add(OutputConfiguration(previewSurface))\r\n        add(OutputConfiguration(captureSurface))\r\n    }\r\n\r\n    /** ã‚ºãƒ¼ãƒ å‡ºæ¥ã‚‹å€¤ã®ç¯„å›²ã‚’è¿”ã™ */\r\n    val zoomRange = cameraManager.getCameraCharacteristics(cameraId)?.get(CameraCharacteristics.CONTROL_ZOOM_RATIO_RANGE)?.let {\r\n        // Pixel 6 Pro ã®å ´åˆã¯ 0.6704426..20.0 ã®ã‚ˆã†ãªå€¤ã«ãªã‚‹\r\n        it.lower..it.upper\r\n    } ?: 0f..0f\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    suspend fun openCamera() {\r\n        cameraDevice = waitOpenCamera()\r\n    }\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’é–‹å§‹ã™ã‚‹ */\r\n    fun startCamera() {\r\n        val cameraDevice = cameraDevice ?: return\r\n        if (captureRequest == null) {\r\n            captureRequest = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_STILL_CAPTURE).apply {\r\n                addTarget(previewSurface)\r\n                addTarget(captureSurface)\r\n            }\r\n        }\r\n        SessionConfiguration(SessionConfiguration.SESSION_REGULAR, outputList, cameraExecutor, object : CameraCaptureSession.StateCallback() {\r\n            override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                currentCaptureSession = captureSession\r\n                captureSession.setRepeatingRequest(captureRequest!!.build(), null, null)\r\n            }\r\n\r\n            override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n                // do nothing\r\n            }\r\n        }).apply { cameraDevice.createCaptureSession(this) }\r\n    }\r\n\r\n    /**\r\n     * ã‚ºãƒ¼ãƒ ã™ã‚‹\r\n     * [startCamera]ã‚’å‘¼ã³å‡ºã—ãŸå¾Œã®ã¿åˆ©ç”¨å¯èƒ½\r\n     */\r\n    fun zoom(zoom: Float = 1f) {\r\n        val captureRequest = captureRequest ?: return\r\n        val currentCaptureSession = currentCaptureSession ?: return\r\n\r\n        captureRequest.set(CaptureRequest.CONTROL_ZOOM_RATIO, zoom)\r\n        currentCaptureSession.setRepeatingRequest(captureRequest.build(), null, null)\r\n    }\r\n\r\n    /** çµ‚äº†æ™‚ã«å‘¼ã³å‡ºã™ */\r\n    fun destroy() {\r\n        cameraDevice?.close()\r\n    }\r\n\r\n    /** [cameraId]ã®ã‚«ãƒ¡ãƒ©ã‚’é–‹ã */\r\n    @SuppressLint(\"MissingPermission\")\r\n    suspend private fun waitOpenCamera() = suspendCoroutine {\r\n        cameraManager.openCamera(cameraId, cameraExecutor, object : CameraDevice.StateCallback() {\r\n            override fun onOpened(camera: CameraDevice) {\r\n                it.resume(camera)\r\n            }\r\n\r\n            override fun onDisconnected(camera: CameraDevice) {\r\n                // do nothing\r\n            }\r\n\r\n            override fun onError(camera: CameraDevice, error: Int) {\r\n                // do nothing\r\n            }\r\n        })\r\n    }\r\n}\r\n```\r\n\r\nã‚ã¨ã¯ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã®UIéƒ¨å“ã‚’ç½®ã„ã¦å®Œæˆã€‚  \r\nã‚«ãƒ¡ãƒ©ã‚’é…åˆ—ã§ç®¡ç†ã™ã‚‹ã®ã€è‰¯ããªã‹ã£ãŸã§ã™ã­ã€‚\r\n\r\n```kotlin\r\nval zoomValue = remember { mutableStateOf(1f) }\r\nval zoomRange = remember { mutableStateOf(0f..1f) }\r\nSideEffect {\r\n    // é Compose ãªã‚³ãƒ¼ãƒ‰ã®ã§è‹¥å¹²é•å’Œæ„Ÿ\r\n    zoomRange.value = cameraControlList.firstOrNull()?.zoomRange ?: 0f..1f\r\n}\r\n\r\nSlider(\r\n    value = zoomValue.value,\r\n    valueRange = zoomRange.value,\r\n    onValueChange = {\r\n        zoomValue.value = it\r\n        // å‰é¢ã‚«ãƒ¡ãƒ© ã¯æœ€åˆ\r\n        cameraControlList.first().zoom(it)\r\n    }\r\n)\r\n```\r\nã“ã‚Œã§ã¡ã‚ƒã‚“ã¨ã‚ºãƒ¼ãƒ ã§ãã‚‹ã¯ãšã€ã€‚æ¨™æº–ã‚¢ãƒ—ãƒªä»¥å¤–ã§ã‚‚ãƒšãƒªã‚¹ã‚³ãƒ¼ãƒ—ã‚«ãƒ¡ãƒ©ãŒä½¿ãˆã¦ã™ã”ã„ã€‚\r\n\r\n# ãŠã‚ã‚Šã«1\r\nãŠãã‚‰ãã€é™æ­¢ç”»æ’®å½±ã®å ´åˆã¯`CameraCaptureSession#setRepeatingRequest`ã§ã¯ãªãã€`CameraCaptureSession#capture`ã‚’å‘¼ã³å‡ºã™ã¹ãã§ã™ã­ã€‚ã‚ã‚“ã©ã„ã®ã§ã‚„ã£ã¦ã¾ã›ã‚“ãŒã€‚  \r\nãã‚Œã¨`CameraX`ãŒä½¿ãˆãŸã‚‰ã¨ã¦ã‚‚æ¥½ã ã¨æ€ã„ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸå¾Œã€`å‰é¢ã€èƒŒé¢`ã‚«ãƒ¡ãƒ©ã‚’åŒæ™‚ã«é–‹ã“ã†ã¨ã—ã¾ã—ãŸãŒã€ã€ã€  \r\næ®‹å¿µãªãŒã‚‰ã§ããªã„ï¼Ÿã£ã½ã„ã®ã§ã€ä»Šå›ã®ã‚ˆã†ãªåŒæ™‚ã«ã‚«ãƒ¡ãƒ©ã‚’åˆ©ç”¨ã™ã‚‹å ´åˆã¯`Cameara2 API`ã‚’ä½¿ã†ã—ã‹ãªã•ãã†ã§ã™ã­ã€‚èª°ã‚‚ã—ãªã„ã§ã—ã‚‡ã†ãŒ  \r\n\r\n```plaintext\r\nE/CameraXBasic: Use case binding failed\r\n    java.lang.IllegalArgumentException: Multiple LifecycleCameras with use cases are registered to the same LifecycleOwner.\r\n```\r\n\r\nã‚ã¨`CameraX`ã§ã‚‚`SurfaceTexture`ã‚‚å¤šåˆ†ä½¿ãˆãã†ï¼Ÿã ã‘ã©ã€`ImageAnalysis`ï¼Ÿã¨ã‹è¨€ã†ã®ã§`Bitmap`ãŒå–ã‚Œã‚‹ã‚‰ã—ã„ï¼Ÿã®ã§ãã‚Œã‚’`OpenGL`ã«è»¢é€ã™ã‚Œã°è‰¯ã•ãã†ã§ã™ã€‚  \r\nä½•ã‚‚åˆ†ã‹ã‚‰ã‚“ã€‚\r\n\r\n# ãŠã‚ã‚Šã«2\r\nã¤ã‹ã‚ŒãŸ  \r\nã“ã†ã—ã¦ã‚«ãƒ¡ãƒ©ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã‚‹ã¨ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’å‡ºã™ã¾ã§ãªã®ã«ã™ã”ã„å¤§å¤‰ã ãªã‚ã¨ã„ã†ã¨ã“ã‚ã§ã™ã€‚ï¼ˆ`CameraX`ã‚’ä½¿ãˆã‚‹ãªã‚‰ä½¿ãˆã‚ˆã¨ã„ã†è©±ã§ã¯ã‚ã‚‹ï¼‰  \r\n\r\nãã‚Œãªã®ã«é›»æ± æ®‹é‡ãŒ10%ã‚’åˆ‡ã£ãŸã‚‰ä½¿ãˆãªããªã‚‹ã¨ã‹ã§é¨’ãŒã‚Œã¦ã¦æµçŸ³ã«ã‹ã‚ã„ãã†ã ã¨æ€ã„ã¾ã—ãŸã€‚ï¼ˆã¨ã„ã†ã‹ã“ã‚Œã§è¨˜äº‹ã«ã™ã‚‹ã‚“ã‹ï¼Ÿï¼‰  \r\nhttps://www.itmedia.co.jp/news/articles/2302/17/news190.html\r\n\r\nè€èˆ—ãƒ¡ãƒ¼ã‚«ãƒ¼ãªã®ã§é»æ˜æœŸã«10%ã‚ã£ã¦ã‚‚ã„ããªã‚Šé›»æ± ãŒåˆ‡ã‚Œã‚‹ã¨ã‹ã‚ã£ãŸã ã‚ã†ã—ã€  \r\nã‚«ãƒ¡ãƒ©ã‚ˆã‚Šã‚‚é‡è¦ãªãƒ—ãƒ­ã‚»ã‚¹ãŒå­˜åœ¨ã™ã‚‹ã‚ˆã†ãªæ°—ãŒã™ã‚‹ã—ï¼ˆã‚­ãƒ£ãƒªã‚¢ç«¯æœ«ã ã‹ã‚‰ãªãŠã•ã‚‰ï¼‰ã§ã€å®‰å…¨ãªæ–¹ã«å€’ã—ã¦ã„ã‚‹ã®ã§å…¨ç„¶å•é¡Œãªã„ã¨æ€ã†ã‚“ã§ã™ãŒã€‚ã€‚ã€‚ã€‚  \r\n\r\nå‹•ç”»æ’®å½±ãªã‚‰ãªãŠã•ã‚‰ã§ã™ã­ã€‚é€”ä¸­ã§é›»æ± ãŒåˆ‡ã‚Œã¦å†ç”Ÿã§ããªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºæ¥ã‚‹ã‚ˆã‚Šäºˆã‚åˆ©ç”¨ã§ããªã„æ–¹ã¸å€’ã™ã¹ãã§ã™ã­ã€‚ã‚·ãƒ£ãƒƒãƒˆãƒ€ã‚¦ãƒ³ã¾ã§ã®é–“ã«ä¿å­˜ã§ãã‚‹ã‹åˆ†ã‹ã‚‰ã‚“ã€ã€ã€  \r\nï¼ˆæœ€å¾Œã«`moov atom`ã‚’å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€ã‚‰ã—ã„ï¼ˆè¦æ¤œè¨¼ï¼‰ã®ã§é–“ã«åˆã‚ãªã„å¯èƒ½æ€§ã‚‚ã‚ã‚‹ï¼Ÿæ›¸ãè¾¼ã‚ãªã‹ã£ãŸã‚‰å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦èªè­˜ã•ã‚Œãªã„ã®ã§ã€ã€ã€ï¼‰  \r\n\r\nä»¥ä¸Šã§ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚8888"},{"title":"NewRadioSupporter ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¿½åŠ ã™ã‚‹ãŸã‚ Glance ã‚’ä½¿ã£ã¦ã¿ãŸ","link":"/posts/android_glance_new_radio_supporter/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n\r\nã‚¹ã‚¿ãƒ‡ã‚£Â§ã‚¹ãƒ†ãƒ‡ã‚£2 æ”»ç•¥ã—ã¾ã—ãŸã€ãˆã¡ãˆã¡ã§ã—ãŸ  \r\n\r\n![Imgur](https://imgur.com/QAZ5pFC.png)\r\n\r\nE-mote æ­è¼‰ã ã‹ã‚‰ç«‹ã¡çµµãŒã‚ã£ã¡ã‚ƒå‹•ãã€  \r\næœ¬ç·¨é–¢ä¿‚ãªã„ã‘ã© UI ã‚‚ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é ‘å¼µã£ã¦ã¦ã™ã”ã„ã¨æ€ã£ãŸï¼ˆã“ãªã¿ã‹ã‚“ã€å¤§å¤‰ãã†\r\n\r\n![Imgur](https://imgur.com/b5hbK9R.png)\r\n\r\n![Imgur](https://imgur.com/5Mo4atS.png)\r\n\r\nã‚„ãˆã¡ã‚ƒã‚“ï¼ï¼  \r\nå‰ä½œãƒ’ãƒ­ã‚¤ãƒ³?ã¨ã®ã‚„ã‚Šã¨ã‚ŠãŒã‚ã£ãŸã‚“ã§ã™ã‘ã©ã‚„ãˆã¡ã‚ƒã‚“ãƒ«ãƒ¼ãƒˆã®ãŒå¥½ã¿  \r\nãªã¾ã‚Šã‹ã‚ã„ã„\r\n\r\n![Imgur](https://imgur.com/VqPDyZ2.png)\r\n\r\n\r\nç”±ä¹ƒã¡ã‚ƒã‚“ã‹ã‚ã„ã„ã®ã§ãœã²ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/oTgUbyj.png)\r\n\r\n![Imgur](https://imgur.com/yktGFri.png)\r\n\r\nã“ã®ç›®ã™ã\r\n\r\n![Imgur](https://imgur.com/lWfNy23.png)\r\n\r\n![Imgur](https://imgur.com/Jb0694m.png)\r\n\r\nã‚¤ãƒ™ãƒ³ãƒˆCGè²¼ã‚‹ã‚ã‘ã«ã¯è¡Œã‹ãªã„ã‘ã©ãƒ’ãƒ­ã‚¤ãƒ³ã‚‚èƒŒæ™¯ã‚‚ã‚ã£ã¡ã‚ƒãã‚Œã„ã§ã—ãŸã€ã™ã”ã„  \r\néå»ã®è©±ã¨ã‹ã¡ã‚‡ã‚ã£ã¨å‡ºã¦ãã‚‹ã®ã§ç”±ä¹ƒã¡ã‚ƒã‚“ãƒ«ãƒ¼ãƒˆã¯æœ€å¾ŒãŒè‰¯ã„ã‹ã‚‚ï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\n`NewRadioSupporter` ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¿½åŠ ã—ã¾ã—ãŸï¼ãŠå¾…ãŸã›ã—ã¡ã‚ƒã„ã¾ã—ãŸ  \r\nãƒ›ãƒ¼ãƒ ç”»é¢ã‹ã‚‰ã™ãç¢ºèªã§ãã¾ã™ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/NswvS41.png)\r\n\r\nå¤§ãã„ã‚µã‚¤ã‚ºã‚‚ä½œã‚Šã¾ã—ãŸã€  \r\nå¾Œè¿°ã—ã¾ã™ãŒ`Jetpack Glance`ãŒé¢å€’ãªã“ã¨ã‚’å…¨éƒ¨è‚©ä»£ã‚Šã—ã¦ãã‚ŒãŸã®ã§å¤§ãã„ã‚µã‚¤ã‚ºã‚‚é›£ã—ããªã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/vpC9HXU.png)\r\n\r\nï¼ˆå°ã•ã„ã‚¢ãƒ—ãƒªã¿ãŸã„ã§çµæ§‹æ°—ã«å…¥ã£ã¦ã‚‹ï¼‰\r\n\r\nã©ã†ã§ã‚‚ã„ã„ã‘ã©ãƒ‰ã‚³ãƒ¢ã®`n28`è¦‹ã¤ã‘ãŸã€ã‚ãƒ¼ã„  \r\n\r\né«˜ã„ã‚­ãƒ£ãƒªã‚¢ç‰ˆè²·ã£ã¦ã‚ˆã‹ã£ãŸï¼ˆã¾ããƒŸãƒªæ³¢ã‚¢ãƒ³ãƒ†ãƒŠã»ã—ã‹ã£ãŸã—...ï¼‰\r\n\r\nã§ã€ä»Šå›ã¯ã“ã®`NewRadioSupporter`ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã‚‹ãŸã‚ã«ä½¿ã£ãŸ`Jetpack Glance`ã®ãŠè©±ã§ã™ã€‚\r\n\r\n# Android Jetpack Glance\r\nhttps://developer.android.com/jetpack/compose/glance\r\n\r\n`Jetpack Compose`ãªæ–‡æ³•ã§ã€`Android`ã®`ãƒ›ãƒ¼ãƒ ç”»é¢ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ`ãŒä½œã‚Œã‚‹ã€‚ \r\nã†ãƒ¼ã‚“`xml + RemoteViews`ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã£ãŸã“ã¨ãŒã‚ã‚‹èº«ã‹ã‚‰ã™ã‚‹ã¨ç¾å®Ÿå‘³ãŒç„¡ã„ã‚“ã ã‘ã©ã€ç¢ºã‹ã«å‹•ã„ã¦ã„ã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \r\n\r\n```kotlin\r\nclass MyAppWidget : GlanceAppWidget() {\r\n    override suspend fun provideGlance(context: Context, id: GlanceId) {\r\n        provideContent {\r\n            Text(\"Hello World\")\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n**ãªã‚“ã§å‹•ã„ã¦ã‚‹ã‹åˆ†ã‹ã‚‰ã‚“ãã¦æœ¬å½“ã«é­”æ³•ã¿ãŸã„**  \r\nä¸æ€è­°ã§ãŸã¾ã‚‰ãªã„ã‘ã©ã€ã€ã€ã‚‚ã—ã“ã‚Œãªã‚‰é›£ã—ã™ãã¦åœ°ç„ã®`xml + RemoteViews`ã‹ã‚‰é–‹æ”¾ã•ã‚Œã‚‹ã£ã¦ã“ã¨ã§ã„ã„ï¼Ÿ\r\n\r\n# Android ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯é›£ã—ã„\r\nãƒ¬ãƒ“ãƒ¥ãƒ¼ã«æ¥ã¦ãŸã—ç§ã‚‚æ¬²ã—ã‹ã£ãŸã‚“ã§ã™ã‘ã©ã€ã€ã€  \r\nã‚ã€ã“ã®éƒ¨åˆ†ã¯èª­ã‚“ã§ã‚‚èª­ã¾ãªãã¦ã‚‚ã©ã£ã¡ã§ã‚‚ã„ã„ã§ã™ã€‚\r\n\r\n## Android 2 ã¨ã‹ã‹ã‚‰å­˜åœ¨ã™ã‚‹ã®ã§ãƒ¡ã‚½ãƒƒãƒ‰ãŒå¤ã„ã¾ã‚“ã¾\r\nã—ã°ã‚‰ãæ”¾ç½®ã•ã‚Œã¦ã„ãŸã‚¤ãƒ¡ãƒ¼ã‚¸ã€ã€ã‚ã¨å¾Œæ–¹äº’æ›ã®ãŸã‚ã«ä¸‹æ‰‹ã«æ‰‹ã‚’å‡ºã›ãªã‹ã£ãŸå¯èƒ½æ€§ã€‚  \r\nå¤ã„ã‹ã‚‰æƒ…å ±ãŒã‚ã‚‹ã®ã‹ã¨æ€ã†ã¨ã‚ã‚“ã¾ã‚Š...ã€‚  \r\nå®Ÿéš›å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ—¥æœ¬èªç‰ˆã¯ã„ã¤ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã ã‚ˆã£ã¦è¨€ã„ãŸããªã‚‹ã€ã€ã¯ã\r\n- https://developer.android.com/guide/topics/appwidgets?hl=ja\r\n- https://developer.android.com/guide/topics/appwidgets/overview?hl=ja\r\n\r\nï¼ˆæ—¥æœ¬èªç‰ˆãªã‚“ã¦è¦‹ã‚‹ãªã¨ã„ã†è©±ã§ã¯ã‚ã‚‹\r\n\r\n## RemoteViews ã§ä½¿ãˆã‚‹ View ã®ã¿\r\næ±ºã¾ã£ãŸ`View`ã—ã‹ä½¿ãˆãªã„ï¼  \r\nhttps://developer.android.com/reference/android/widget/RemoteViews\r\n\r\n`ConstraintLayout`ã‚‚ä½¿ãˆã¾ã›ã‚“ã€‚`RelativeLayout`ã¨ã‹ä»Šæ›´ã‚„ã‚‹ãã‚‰ã„ãªã‚‰`LinearLayout`ã¨ã‹`FrameLayout`ä½¿ã£ãŸã»ã†ãŒè‰¯ã•ãã†ã€‚  \r\nã‚ã¨ã€`xml`ãŒãƒ™ãƒ¼ã‚¹ãªã®ã§ã€ã¡ã‚‡ã£ã¨å‡ã£ãŸäº‹ã™ã‚‹ã¨ã‚ã‚“ã©ã„ã§ã™ã€‚è§’ã‚’ä¸¸ãã—ãŸã„å ´åˆã¯`ã‚«ã‚¹ã‚¿ãƒ Drawable`ã‚’ä½œã‚‰ãªã„ã¨è¡Œã‘ãªã„ã€`Jetpack Compose`ã ã¨ä¸€ç™ºãªã®ã«ã¤ã‚‰ã„ã­ã€‚\r\n\r\nã¾ãŸã€`findViewById`ã¯ä½¿ãˆãªã„ã€‚ã˜ã‚ƒã‚ã©ã†ã‚„ã£ã¦ãƒ†ã‚­ã‚¹ãƒˆã‚„ç”»åƒã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‚“ã ã£ã¦è©±ã§ã™ãŒã€  \r\n`RemoteViews`ã«ãƒ†ã‚­ã‚¹ãƒˆè¨­å®šãƒ¡ã‚½ãƒƒãƒ‰ã€ç”»åƒè¨­å®šãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã®ã§ã€`xml`ã®`android:id`ã¨å€¤ã‚’ãã‚Œãã‚Œã‚»ãƒƒãƒˆã—ã¦ã„ãå½¢ã«ãªã‚Šã¾ã™ã€‚  \r\nhttps://developer.android.com/reference/android/widget/RemoteViews#setTextViewText(int,%20java.lang.CharSequence)\r\n\r\n```kotlin\r\nval views = RemoteViews(context.packageName, R.layout.music_control_widget).apply {\r\n    setTextViewText(R.id.widget_title, \"title\")\r\n    setTextViewText(R.id.widget_album, \"album\")\r\n    setTextViewText(R.id.widget_artist, \"artist\")\r\n}\r\n```\r\n\r\n`Visibility`å¤‰æ›´ã‚„ã€`Drawable`ã‚»ãƒƒãƒˆãªã‚“ã‹ã®åŸºæœ¬çš„ãªã‚„ã¤ã¯ã‚ã‚Šã¾ã™ãŒã€ã‚ã‚“ã¾ã‚Šå‡ã£ãŸãƒ¡ã‚½ãƒƒãƒ‰ã¾ã§ã¯ãªã„ã®ã§å‡ºæ¥ãªã„äº‹ã‚‚ã‚ã‚‹ã€‚  \r\nä¸€å¿œã€ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã˜ã¿ãŸäº‹ãŒã§ãã¾ã™ãŒã€ã€ã€ã“ã‚Œã‚‚ä¸‡èƒ½ã§ã¯ãªã„ã‚‰ã—ãã€`LinearLayout`ã®`setOrientation`ã—ã‚ˆã†ã¨ã—ãŸã‚‰è½ã¡ãŸ  \r\nhttps://developer.android.com/develop/ui/views/appwidgets/enhance#use-runtime-mod-of-remoteviews\r\n\r\n**ã‚ã¨ã¤ã‚‰ã„ã®ãŒãƒªã‚¹ãƒˆç³»**ã€‚`Gmail`ã¨ã‹`Google Keep`ã¨ã‹ã®ãƒªã‚¹ãƒˆã§ã‚¢ã‚¤ãƒ†ãƒ å¢—ã‚„ã—ãŸã‚Šã§ãã‚‹ã‚„ã¤ã€‚ã‚ã‚ŒãŒé›£ã—ã„  \r\næœ€è¿‘ã¯ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå……å®Ÿã—ã¦ã¦è‰¯ã„æ„Ÿã˜ãªã®ã§ã™ãŒã€ãƒªã‚¹ãƒˆã®å„ã‚¢ã‚¤ãƒ†ãƒ ã‚’æŠ¼ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚ã‚‰ã‹ã˜ã‚ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹ã¨ã‹ã€  \r\nãƒªã‚¹ãƒˆã¸ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã€ãªã‚“ã‹ã‚ˆãã‚ã‹ã‚‰ãªã„ã‚„ã¤ã‚’ç¶™æ‰¿ã™ã‚‹ã‚“ã ã‘ã©ã€å®Ÿè£…ã—ãªã„ã¨ã„ã‘ãªã„ãƒ¡ã‚½ãƒƒãƒ‰ãŒå¤šãåœ§å€’ã•ã‚Œã‚‹ã€‚\r\n\r\n- https://developer.android.com/develop/ui/views/appwidgets/collections#behavior\r\n- https://developer.android.com/develop/ui/views/appwidgets/collections#implement-collections\r\n\r\n## ã™ãå£Šã‚Œã‚‹\r\nãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’å¤‰æ›´ã•ã›ã‚‹ã¨ï¼Ÿã€**ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã¯åˆ©ç”¨ã§ãã¾ã›ã‚“**ã¿ãŸã„ãªè¡¨ç¤ºã«ãªã£ã¦ã€ç½®ãç›´ã•ãªã„ã¨ã„ã‘ãªã„  \r\nã‚¢ãƒ—ãƒªã‚¢ã‚¤ã‚³ãƒ³é•·æŠ¼ã—â†’`ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆ`ã‚’æŠ¼ã™ã¨ã™ãå†è¨­ç½®ã§ãã¾ã™ï¼ˆæ™‚çŸ­ãƒ†ã‚¯  \r\n\r\nhttps://support.google.com/android/answer/9450271?hl=ja#zippy=%2Cã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¿½åŠ ã™ã‚‹ã‚µã‚¤ã‚ºå¤‰æ›´ã™ã‚‹\r\n\r\n`Logcat`è¿½ã£ã¦ã£ãŸã‚‰ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã™ã‚‹ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰æ›¸ã„ã¦ãŸã†ã‚ãƒ¼ã¿ãŸã„ãªã€‚\r\n\r\n## ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†ãŒé›£ã—ã„\r\nãƒ¯ãƒŠãŒå¤šã™ãã‚‹\r\n\r\nå‰è¿°ã®é€šã‚Š`findViewById`ãŒä½¿ãˆãªã„ã®ã§ã€`setOnClickListener { }`ãªã‚“ã¦ã‚‚ã®ã¯ä½¿ãˆãªã„ã€‚  \r\nãªã®ã§ã€ã‚ã‚‰ã‹ã˜ã‚`PendinIntent`ã¨ã„ã†æŠ¼ã—ãŸæ™‚ã«ç™ºè¡Œã™ã‚‹`Intent`ã‚’è¨­å®šã—ã¦ãŠãã¾ã™ã€‚ï¼ˆã™ãä½¿ã†ã‚ã‘ã˜ã‚ƒãªã„ã®ã§`Pending`ãª`Intent`ï¼‰  \r\nã‚¢ãƒ—ãƒªã®ç”»é¢ã‚’é–‹ã`PendingIntent.getActivity`ã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹`PendingIntent.getService`ã€ä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã¶ãŸã‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å—ã‘å–ã‚‹`PendinIntent.getBroadcast`ãªã©ã€‚\r\n\r\nä»»æ„ã®ã‚³ãƒ¼ãƒ‰ã‚’å‘¼ã¶ãŸã‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’å—ã‘å–ã‚‹ã‚„ã¤ã¯`AppWidgetProvider#onReceive`ã«æ›¸ãã€‚ã™ããƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ¬ã‚·ãƒ¼ãƒãƒ¼ãŒä½¿ãˆã‚‹çŠ¶æ…‹ã«ã¯ãªã£ã¦ã‚‹ã€‚  \r\n`PendingIntent`ã‚’ä½œã‚‹éš›ã¯ã€ã“ã®ã‚¯ãƒ©ã‚¹ï¼ˆä»¥ä¸‹ã®ä¾‹ã ã¨`ExampleWidget`ï¼‰ã«å‘ã‘ãŸ`PendingIntent`ã‚’ä½œã£ã¦ã‚»ãƒƒãƒˆã™ã‚Œã°è‰¯ã„ã€‚\r\n`context`ãŒã‚‚ã‚‰ãˆã‚‹ã‘ã©ã€`Activity`ã®`context`ã§ã¯ãªã„ã®ã§ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã¯å‡ºã›ãªã„ã€‚  \r\n`Kotlin Coroutines ã® suspend é–¢æ•°`ã‚’å‘¼ã³ã ã‘ã‚Œã°`goAsync()`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nclass ExampleWidget : AppWidgetProvider() {\r\n\r\n    /** ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆå—ã‘å–ã‚Š */\r\n    override fun onReceive(context: Context?, intent: Intent?) {\r\n        // Intent ã« PendinIntent ã§ã‚»ãƒƒãƒˆã—ãŸ Intent ãŒã‚ã‚‹ã¯ãš\r\n        // æŠ¼ã—ãŸã‚‰ Toast ã‚’å‡ºã™ãªã©\r\n        // ã“ã“ã§ã¯ Context#startActivity ã¯ä½¿ãˆãªã„ã®ã§ã€PendingIntent.getActivity ã‚’ä½¿ã†\r\n    }\r\n\r\n}\r\n```\r\n\r\nã±ã£ã¨è¦‹ä½•ã‚‚é›£ã—ã„ã“ã¨ã¯ãªã„ã‚ˆã†ã«è¦‹ãˆã‚‹ãŒã€ã€ã€ãªã‚“ã‹**ãŸã¾ã«ã‚ˆãåå¿œã—ãªã„æ™‚**ãŒãŸã¾ã«ã‚ˆãã‚ã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \r\n`PendingIntent`ã®å¼•æ•°ã«æ¸¡ã—ãŸ`requestCode`ãŒé‡è¤‡ã—ã¦ã„ã‚‹ã¨æŠ¼ã—ã¦ã‚‚`BroadcastReceiver`ãŒåå¿œã—ãªã„ãƒ»ãƒ»ãƒ»ã‹ã‚‰é‡è¤‡ã—ãªã„ã‚ˆã†ã«ã™ã‚Œã°ç›´ã‚‹ã¨ã‹...  \r\n**ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å†è¨­ç½®ã™ã‚‹ã¨ãƒœã‚¿ãƒ³ãŒåå¿œã™ã‚‹ã‚ˆã†ã«ãªã‚‹æ™‚ãŒã‚ã‚‹...ã¨ã‹ã€‚**  \r\né›£ã—ã™ãã‚‹\r\n\r\næ›¸ãå‡ºã—ã¦ã¿ã‚‹ã¨ãã‚“ãªã«ç„¡ã„ãª...ç¢ºã‹ã«ã—ã‚“ã©ã‹ã£ãŸè¨˜æ†¶ã¯ã‚ã‚‹ã‚“ã ã‘ã©ã€‚\r\n\r\n# Android Jetpack Glance\r\nã“ã‚Œã‚‰ã®å•é¡ŒãŒçµæ§‹è§£æ±ºã—ã¾ã™ï¼ï¼\r\n\r\n## Jetpack Compose ã®æ–‡æ³•ã§æ›¸ã‘ã‚‹\r\n`xml`ã§æ›¸ãå¿…è¦ãŒãªã„ã®ã§ã¨ã¦ã‚‚è¦‹ã‚„ã™ã„ã€‚ã‚„ã£ã±ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¨è¡Œãæ¥ã™ã‚‹ã®ã¤ã‚‰ã„ã‚ˆãªã€‚  \r\nä½¿ãˆã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯`androidx.glance`ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å‚˜ä¸‹ã«ã‚ã‚‹`Composable é–¢æ•°`ã«é™å®šã•ã‚Œã‚‹ã€‚æœ€çµ‚çš„ã«ã¯`RemoteViews`ã«å¤‰æ›ã™ã‚‹ãŸã‚è‡´ã—æ–¹ãªã„ã€‚  \r\nï¼ˆãªã®ã§ã€ã‚ˆã£ã¦`Jetpack Compose`ã¨`UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã‚’ç›¸äº’åˆ©ç”¨ã§ãã‚‹ã‚ã‘ã§ã¯ãªã„ï¼‰\r\n\r\nãŸã ã€`UI`é–¢ä¿‚ãªã„`Composable é–¢æ•°`ã¯ä½¿ãˆã¡ã‚ƒã„ã¾ã™ï¼  \r\n`Flow#collectAsState`ã¨ã‹`LaunchedEffect { }`ã¨ã‹ã€‚ãªã‚“ã§å‹•ãã®ã‹æœ¬å½“ã«ä¸æ€è­°\r\n\r\nãã—ã¦ä½•ã‚ˆã‚Šå¬‰ã—ã„ã®ãŒã€**ãƒªã‚¹ãƒˆç³»ãŒã‚ã¡ã‚ƒã‚ã¡ã‚ƒç°¡å˜**ã«ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸ  \r\n`LazyColumn`ãŒ`Glance`ã§ã‚‚å‹•ãã€‚æœ¬å½“ã«æ„Ÿå‹•ã€‚ã“ã‚“ãªæ¥½ã—ã¦ã„ã„ã®ã‹ï¼Ÿ\r\n\r\n## ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’å°‘ã—ã®é–“å‹•çš„ã«ã§ãã‚‹\r\nã©ã†ã„ã†ã“ã¨ã‹ã¨ã„ã†ã¨ã€`Jetpack Glance`ã¯`Jetpack Compose`ã®æ–‡æ³•ã§æ›¸ã‹ã‚ŒãŸ`UI`ã‚’`RemoteViews`ã«å¤‰æ›ã™ã‚‹ãŸã‚ã«ã€`Composable é–¢æ•°`ã‚’ç›£è¦–ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã‚ã‘ã§ã€  \r\nãã®ç›£è¦–ã®ãŸã‚ã®æ™‚é–“ãŒã‚ã‚‹ã‚ã‘ã§ã™ã€‚ãã®é–“ã¯å‹•çš„ãªã®ã§ã€`remember { mutableStateOf() }`ãªã‚“ã‹ã‚‚ä½¿ãˆã¡ã‚ƒã†ã‚ã‘ã§ã™ã€‚\r\n\r\n```kotlin\r\nclass GlanceCountWidget : GlanceAppWidget() {\r\n\r\n    override suspend fun provideGlance(\r\n        context: Context,\r\n        id: GlanceId\r\n    ) = provideContent {\r\n\r\n        // ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\r\n        // TODO å†èµ·å‹•ã¨ã‹ã§å€¤ã‚’ãƒ­ã‚¹ãƒˆã™ã‚‹ã®ã§ã€æ°¸ç¶šåŒ–ãŒå¿…è¦\r\n        var counter by remember { mutableStateOf(0) }\r\n\r\n        // ãƒ†ãƒ¼ãƒã®è¨­å®š\r\n        GlanceTheme(colors = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) GlanceTheme.colors else colors) {\r\n            \r\n            // æ¨ªä¸¦ã³\r\n            Row(\r\n                modifier = GlanceModifier\r\n                    .fillMaxSize()\r\n                    .padding(5.dp)\r\n                    .background(GlanceTheme.colors.secondaryContainer)\r\n                    .cornerRadius(16.dp),\r\n                horizontalAlignment = Alignment.Horizontal.CenterHorizontally,\r\n                verticalAlignment = Alignment.Vertical.CenterVertically\r\n            ) {\r\n\r\n                Button(\r\n                    modifier = GlanceModifier.size(50.dp),\r\n                    text = \"-1\",\r\n                    onClick = { counter-- }\r\n                )\r\n\r\n                Text(\r\n                    modifier = GlanceModifier.defaultWeight(),\r\n                    text = counter.toString(),\r\n                    style = TextStyle(\r\n                        fontSize = 20.sp,\r\n                        textAlign = TextAlign.Center\r\n                    )\r\n                )\r\n\r\n                Button(\r\n                    modifier = GlanceModifier.size(50.dp),\r\n                    text = \"+1\",\r\n                    onClick = { counter++ }\r\n                )\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®è‰² */\r\n        val colors = ColorProviders(\r\n            light = LightColorScheme,\r\n            dark = DarkColorScheme\r\n        )\r\n\r\n    }\r\n}\r\n```\r\n\r\nå®Œå…¨ãªã‚³ãƒ¼ãƒ‰â†’ https://github.com/takusan23/GlanceCountWidget  \r\næœ€æ–°ã® Android Studio ã§ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã¯ãšã§ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/QuivkuX.png)\r\n\r\n`Jetpack Glance`ã§`Flow#collectAsState`ã‚„`LaunchedEffect { }`ãŒå‹•ãã®ã¯ã€ã“ã®å‹•çš„ãªé–“ãŒå­˜åœ¨ã™ã‚‹ã‹ã‚‰ãªã‚“ã§ã™ã­ã€‚  \r\nã¡ãªã¿ã«ã€æ•°åç§’é–“ã®é–“ã—ã‹å‹•ã‹ãªã„ã®ã§ã€ã‚‚ã—çŠ¶æ…‹ã‚’ä¿æŒã—ã¦ãŠããŸã„ï¼ˆä¸Šã®ä¾‹ã ã¨ã‚«ã‚¦ãƒ³ãƒˆã‚’å¼•ãç¶™ããŸã„ï¼‰å ´åˆã¯`SharedPreferences`ã‚„`DataStore`ç­‰ã®ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚·ã‚¹ãƒ†ãƒ ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\nè©³ã—ãã¯ï¼šhttps://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:glance/glance-appwidget/integration-tests/demos/src/main/java/androidx/glance/appwidget/demos/ActionAppWidget.kt\r\n\r\n## ãã“ãã“æ–°ã—ã„æŠ€è¡“ã§å‹•ã„ã¦ã„ã‚‹\r\n`Jetpack Compose`ã‹ã‚‰`RemoteViews`ã«å¤‰æ›ã™ã‚‹éƒ¨åˆ†ã§`WorkManager`ï¼ŸãŒä½¿ã‚ã‚Œã¦ã„ãŸã‚Šã€éåŒæœŸå‡¦ç†ã«`Kotlin Coroutines`ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ç¥ï¼ï¼ï¼\r\n\r\n## Modifier\r\n`Jetpack Glance`å°‚ç”¨ã®`GlanceModifier`ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚  \r\nè§’ã‚’ä¸¸ãã™ã‚‹å‡¦ç†ãŒ`Jetpack Compose`ã¨åŒã˜ãä¸€è¡Œã§æ›¸ã‘ã¾ã™ã€‚  \r\n\r\nã‚‚ã†`ã‚«ã‚¹ã‚¿ãƒ Drawable`ä½œã‚‰ãšã«æ¸ˆã¿ã¾ã™ãƒ»ãƒ»ãƒ»ï¼\r\n\r\n## æŠ¼ã—ãŸã¨ãã®å‡¦ç†\r\nã“ã‚Œã‚‚ã‚ã£ã¡ã‚ƒç°¡ç•¥åŒ–ã•ã‚Œã¦ã„ã¦ã€ãªã‚“ã¨`GlanceModifier.clickable { }`ã‚’ä½¿ã†ã ã‘ã§ã™ã€‚  \r\nå†…éƒ¨ã§ã¯`BroadcastReceiver`ãŒå‹•ã„ã¦ã„ã‚‹ãŸã‚ã€`Context#startActivity`ãŒå‘¼ã³å‡ºã›ãªã„ç­‰ã®æˆç´„ãŒã‚ã‚‹ã‚‚ã®ã®ã€`BroadcastReceiver#onReceive`ã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ›¸ãã‚ˆã‚Šä½•å€ã‚‚åˆ†ã‹ã‚Šã‚„ã™ã„ï¼ï¼ï¼  \r\nã‚‚ã¡ã‚ã‚“`Activity`ã‚’é–‹ãæ–¹æ³•ã‚‚ã¡ã‚ƒã‚“ã¨ã‚ã‚Šã¾ã™ã€‚\r\n\r\n# å®Ÿéš›ã«ä½œã£ã¦ã¿ã‚‹ï¼ï¼\r\nä»Šå›ã¯å†™çœŸã‚’ä¸€è¦§è¡¨ç¤ºã™ã‚‹ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã§ã‚‚ä½œã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  \r\nãŸã ã€ãã‚Œã ã¨æ—¢ã«ã‚ã‚‹ã¨æ€ã†ã®ã§ã€å†™çœŸã‚’æŠ¼ã—ãŸã‚‰ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå†…ã§è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ï¼ˆä¸€è¦§è¡¨ç¤ºã‹ã‚‰1ã¤ã ã‘ï¼‰ã—ã¦ã¿ã¾ã™ã€‚  \r\næœ¬å½“ã«ãƒŸãƒ‹ã‚¢ãƒ—ãƒªã‚’ç›®æŒ‡ã—ã¦ã„ãã¾ã™ã€‚\r\n\r\nã„ã‚„ï½ï½ï½ã“ã‚Œ`RemoteViews`ã§ã‚„ã‚ã†ã¨ã™ã‚‹ã¨ã‚ã£ã¡ã‚ƒã ã‚‹ã„ã‚„ã‚ãªã\r\n\r\n<video src=\"https://user-images.githubusercontent.com/32033405/270123308-7dee0de2-5ab1-4621-9af0-33a9168d28dd.mp4\" width=\"200\" controls></video>\r\n\r\n## ç’°å¢ƒ\r\n\r\nã“ã†ã—ã https://developer.android.com/jetpack/compose/glance\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                                  |\r\n|----------------|-----------------------------------------|\r\n| Android Studio | Android Studio Giraffe 2022.3.1 Patch 1 |\r\n| ç«¯æœ«           | Xperia 1 V / Google Pixel 6 Pro         |\r\n| targetSdk      | 34 (Android 14)                         |\r\n\r\n## é©å½“ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹\r\n`Jetpack Compose`ãŒå…¥ã£ã¦ã„ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚æ–°è¦ã«ä½œã‚‹ãªã‚‰`Empty Compose Project`ï¼Ÿ  \r\n`Jetpack Compose`ãªã„å ´åˆã¯ã¾ãšå…¥ã‚Œã‚‹ã¨ã“ã‚ã‹ã‚‰ã§ã™ã­\r\n\r\n`Empty Compose Project`ã§ã€å¾Œã¯é©å½“ã«ã€  \r\n`Android`æœ€ä½ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯`6`ãŒè‰¯ã„ã‚‰ã—ã„ï¼ˆ`Jetpack Glance`ãŒ`5`ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¦ãªã„ã¨ã‹ãªã‚“ã¨ã‹ï¼‰\r\n\r\n![Imgur](https://imgur.com/qPEIStn.png)\r\n\r\n`kts`ã‚’ä½¿ã†ã‹ã¯ãŠã¾ã‹ã›ã—ã¾ã™ã€æ–°è¦ã§ä½œã‚‹ãªã‚‰`kts`ã§è‰¯ã„ã‹ã‚‚ã€ä»Šã‚ã‚‹ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æ›¸ãæ›ãˆã¦ã¾ã§ã¯ãƒ¡ãƒªãƒƒãƒˆãªã•ãã†ã€‚\r\n\r\n## Jetpack Glance ã‚’å…¥ã‚Œã‚‹\r\n\r\n`app`ã®ä¸­ã®`build.gradle.kts`ï¼ˆã‚‚ã—ãã¯`build.gradle`ï¼‰ã§ã€ä»¥ä¸‹ã‚’è¶³ã™  \r\n`glance`ã¨ã€ç”»åƒèª­ã¿è¾¼ã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®`Glide`ã§ã™ã€‚\r\n\r\n```kotlin\r\n\r\ndependencies {\r\n\r\n    // ã“ã‚Œã‚‰\r\n    // For AppWidgets support\r\n    implementation (\"androidx.glance:glance-appwidget:1.0.0\")\r\n    // For interop APIs with Material 3\r\n    implementation (\"androidx.glance:glance-material3:1.0.0\")\r\n    // ç”»åƒèª­ã¿è¾¼ã¿ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\n    implementation(\"com.github.bumptech.glide:glide:4.16.0\")\r\n\r\n    // ä»¥ä¸‹çœç•¥...\r\n\r\n\r\n```\r\n\r\nã‚ã¨ã¯ã€`targetSdk`ã‚’`34`ã«ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nandroid {\r\n    namespace = \"io.github.takusan23.touchphotowidget\"\r\n    compileSdk = 34 // ã“ã“\r\n\r\n    defaultConfig {\r\n        applicationId = \"io.github.takusan23.touchphotowidget\"\r\n        minSdk = 23\r\n        targetSdk = 34 // ã“ã“\r\n        versionCode = 1\r\n        versionName = \"1.0\"\r\n\r\n    // ä»¥ä¸‹çœç•¥...\r\n```\r\n\r\n## xmlã‚’æ›¸ã\r\nã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ˆæœ€å°å¹…ã¨ã‹ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆè¨­å®šç”¨ Activity ã®æŒ‡å®šï¼‰ã‚’æ›¸ãã€‚\r\n\r\n`res`ã®ä¸­ã«`xml`ãŒã‚ã‚‹ã¯ãšãªã®ã§ã€ãã“ã«é©å½“ã«`touch_photo_widget_info.xml`ã¿ãŸã„ãªã®ã‚’ç½®ã\r\n\r\n![Imgur](https://imgur.com/YcQfzr8.png)\r\n\r\nå¾Œã¯é©å½“ã«ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<appwidget-provider xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:description=\"@string/app_name\"\r\n    android:minWidth=\"40dp\"\r\n    android:minHeight=\"40dp\"\r\n    android:previewImage=\"@drawable/ic_launcher_foreground\"\r\n    android:resizeMode=\"horizontal|vertical\"\r\n    android:targetCellWidth=\"1\"\r\n    android:targetCellHeight=\"1\"\r\n    android:updatePeriodMillis=\"86400000\"\r\n    android:widgetCategory=\"home_screen\" />\r\n```\r\n\r\nã“ã‚Œã‚‰ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è©³ç´°ã¯ä»¥ä¸‹ã€‚  \r\nhttps://developer.android.com/develop/ui/views/appwidgets#other-attributes  \r\n\r\n`description`ã¨ã‹`previewImage`ã¯ã¡ã‚ƒã‚“ã¨ã—ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„\r\n\r\n## Jetpack Glance ã®ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã™ã‚‹\r\n2ã¤ç”¨æ„ã—ã¾ã™ã€‚  \r\nã¾ãšã¯ `GlanceAppWidget`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass TouchPhotoWidget : GlanceAppWidget() {\r\n\r\n    override suspend fun provideGlance(context: Context, id: GlanceId) {\r\n        // TODO ã“ã®å¾Œã™ãï¼\r\n    }\r\n\r\n}\r\n```\r\n\r\næ¬¡ã«ã€`GlanceAppWidgetReceiver`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚‚ä½œã‚Šã¾ã™ã€‚  \r\n`glanceAppWidget`ã¯ã€â†‘ã§ä½œã£ãŸ`GlanceAppWidget`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’æ¸¡ã›ã°å¤§ä¸ˆå¤«\r\n\r\n```kotlin\r\nclass TouchPhotoWidgetReceiver : GlanceAppWidgetReceiver() {\r\n\r\n    override val glanceAppWidget: GlanceAppWidget\r\n        get() = TouchPhotoWidget()\r\n\r\n}\r\n```\r\n\r\nå¤šåˆ†ã“ã†ãªã£ã¦ã‚‹ã¯ãšã€‚\r\n\r\n![Imgur](https://imgur.com/4uaG1JW.png)\r\n\r\n## AndroidManifest ã‚’æ›¸ã\r\n`<receiver>`ã‚’æ›¸ãã¾ã™ã€‚  \r\n`android:name=\".TouchPhotoWidgetReceiver\"`ã¨ã€`android:resource=\"@xml/touch_photo_widget_info\"`ã¯å„è‡ªé•ã†å€¤ã«ãªã‚‹ã¯ãšï¼\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\">\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:dataExtractionRules=\"@xml/data_extraction_rules\"\r\n        android:fullBackupContent=\"@xml/backup_rules\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.TouchPhotoWidget\"\r\n        tools:targetApi=\"31\">\r\n\r\n        <!-- è©³ç´°ã¯... -->\r\n\r\n        <!-- <application> ã®ä¸­ã«â†“ã‚’æ›¸ã -->\r\n        <receiver\r\n            android:name=\".TouchPhotoWidgetReceiver\"\r\n            android:exported=\"true\">\r\n            <intent-filter>\r\n                <action android:name=\"android.appwidget.action.APPWIDGET_UPDATE\" />\r\n            </intent-filter>\r\n            <meta-data\r\n                android:name=\"android.appwidget.provider\"\r\n                android:resource=\"@xml/touch_photo_widget_info\" />\r\n        </receiver>\r\n\r\n    </application>\r\n\r\n</manifest>\r\n```\r\n\r\n## ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ›¸ã\r\n`TouchPhotoWidget`ï¼ˆ`GlanceAppWidget`ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ï¼‰ã‚’é–‹ãã€`provideGlance`ã®ä¸­ã§ã€`provideContent { }`ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚  \r\n`provideContent`ã®ãƒ–ãƒ­ãƒƒã‚¯å†…ã¯`Composable`ãªã®ã§ã€ã‚ã¨ã¯ã“ã“ã«ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ›¸ã„ã¦ã„ãã ã‘ã§ã™ï¼  \r\nã¾ã˜ã§é­”æ³•ã¿ãŸã„ã«å‹•ãã€‚\r\n\r\n```kotlin\r\nclass TouchPhotoWidget : GlanceAppWidget() {\r\n\r\n    override suspend fun provideGlance(context: Context, id: GlanceId) {\r\n        provideContent {\r\n            // Composable\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\né©å½“ã«ã€`Hello World`ã¨ã€ã‚ã¨æŠ¼ã—ãŸã‚‰ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã«ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã€‚  \r\nå‰è¿°ã®é€šã‚Šã€`Glance`ç”¨ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™å¿…è¦ãŒã‚ã‚‹ã®ã§ã€`import`ã®éš›ã¯æ³¨æ„ã—ã¦ãã ã•ã„  \r\nï¼ˆ`GlanceModifier`ãŒå¼•æ•°ã«å…¥ã£ã¦ã„ã‚‹ã‹ã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åãŒ`androidx.glance`ã§å§‹ã¾ã£ã¦ã„ã‚‹ã‹ï¼‰\r\n\r\n![Imgur](https://imgur.com/mWiqkEt.png)\r\n\r\n```kotlin\r\nclass TouchPhotoWidget : GlanceAppWidget() {\r\n\r\n    override suspend fun provideGlance(context: Context, id: GlanceId) {\r\n        provideContent {\r\n            Box(\r\n                modifier = GlanceModifier\r\n                    // match_parent\r\n                    .fillMaxSize()\r\n                    // èƒŒæ™¯è‰²\r\n                    .background(Color.White)\r\n                    // æŠ¼ã—ãŸã‚‰ Activity èµ·å‹•\r\n                    .clickable(actionStartActivity<MainActivity>()),\r\n                contentAlignment = Alignment.Center\r\n            ) {\r\n\r\n                Text(\r\n                    text = \"Hello World\",\r\n                    style = TextStyle(fontSize = 24.sp)\r\n                )\r\n\r\n            }\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nã‚ã¨ã¯å®Ÿè¡Œã—ã¦ã€å®Ÿéš›ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ç½®ã„ã¦ã¿ã¦ãã ã•ã„ã€  \r\nã©ã†ã§ã—ã‚‡ã†ã€ã¡ã‚ƒã‚“ã¨`Hello World`ãŒå‡ºã¦ã€æŠ¼ã—ã¦èµ·å‹•ã—ã¾ã™ã‹ï¼Ÿ\r\n\r\n`RemoteViews`æ™‚ä»£ã‚ˆã‚Šãšã£ã£ã£ã£ã£ã£ã£ã¨ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã­ã€æ„Ÿå‹•\r\n\r\n# ã„ã‚ˆã„ã‚ˆå†™çœŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã‚‹\r\nãŒã€ãã®å‰ã«å†™çœŸã®å–å¾—ã®è©±ã‚’ã—ãªã„ã¨ãªã‚“ã§ã™ã‚ˆã­ã€‚\r\n\r\n## å†™çœŸã‚’å–å¾—ã™ã‚‹ READ_EXTERNAL_STORAGE / READ_MEDIA_IMAGES\r\n`Android 13`ä»¥ä¸Šã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹å ´åˆï¼ˆä»Šå›ã¯`14`ãªã®ã§ã‚‚ã¡ã‚ã‚“ã“ã¡ã‚‰ã®å¯¾è±¡ï¼‰ã€`READ_EXTERNAL_STORAGE`ã§ã¯ãªã`READ_MEDIA_IMAGES`ã®æ¨©é™ã‚’å®£è¨€ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãã†ã€‚  \r\nãŸã ã—ã€ã“ã®æ¨©é™ã¯`13`ã‹ã‚‰ãªã®ã§ã€ãã‚Œä»¥å‰ã®`Android`ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹å ´åˆã¯å¼•ãç¶šã`READ_EXTERNAL_STORAGE`ã‚’å®£è¨€ã—ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚  \r\n\r\nï¼ˆã¡ãªã¿ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚ã‚‹ã‹ã‚ã‹ã‚“ãªã„ã§ã™ãŒã€è‡ªåˆ†ãŒä½œã£ãŸå†™çœŸï¼ˆè‡ªåˆ†ã®ã‚¢ãƒ—ãƒªã‹ã‚‰`ContentResolver#insert`ï¼‰ã®å ´åˆã¯â†‘ã®æ¨©é™ç„¡ã—ã§å–å¾—ã§ããŸã¯ãšã€‚ã€‚ã€‚ï¼‰\r\n\r\n### å†™çœŸã‚’å–ã‚Šå‡ºã™ã«ã¯\r\nãƒ‘ã‚¹ã‚’æ¸¡ã™æ–¹æ³•ã¯å–ã‚Œã¾ã›ã‚“ï¼ˆ`Android 10`ã‹ã‚‰ã®`Scoped Storage`ã®ã›ã„ï¼‰ã€‚ã¤ã¾ã‚Šã€ä»¥ä¸‹ã®ã‚ˆã†ãªæ–¹æ³•ã¯å–ã‚Œã¾ã›ã‚“  \r\n`val file = File(\"sdcard/DCIM/Example.jpg\")`\r\n\r\nã˜ã‚ƒã‚ã©ã†ã™ã‚‹ã‚“ã ã£ã¦è©±ã§ã™ãŒã€`Android`ã§ã¯`ç”»åƒ`ç­‰ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¿ãŸã„ãªã‚„ã¤ã«å•ã„åˆã‚ã›ã‚‹ã¨å–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\n`MediaStore`ã¨ã‹`ContentResolver`ã¨ã‹è¨€ã‚ã‚Œã¦ã‚‹ã‚„ã¤ã§ã™ã€‚  \r\n\r\n#### MediaStore ã‹ã‚‰ Uri ã‚’å–ã‚Šå‡ºã™\r\nä¾‹ã§ã™ã€ã“ã‚“ãªæ„Ÿã˜ã ã¨æ€ã†ã€‚  \r\n`SQL`ã£ã½ã„ã‚„ã¤ã§å–å¾—ã—ãŸã„ãƒ¡ãƒ‡ã‚£ã‚¢ã‚’å–ã‚Šå‡ºã—ã¦ã€`cursor`ã§ä¸Šã‹ã‚‰èˆã‚ã¦ã„ãã¾ã™ã€‚  \r\nã‚‚ã¡ã‚ã‚“ã€ã“ã‚Œã‚’å®Ÿè¡Œã™ã‚‹å‰ã«æ¨©é™ãŒã‚ã‚‹ã‹ã®ãƒã‚§ãƒƒã‚¯ãŒå¿…è¦ã§ã™ã€‚\r\n\r\n`(0 until 10).map { }`ã¨ã‹ã§æŒ‡å®šã—ãŸæ•°ã®é…åˆ—ã‚’ä½œã‚Œã¾ã™ã€‚æ›¸ã„ã¦ã¦æ¥½ã—ã„`Kotlin`\r\n\r\n```kotlin\r\nval uriList: List<Uri> = context.contentResolver.query(\r\n    // ä¿å­˜å…ˆã€SDã‚«ãƒ¼ãƒ‰ã¨ã‹ã‚‚ã‚ã£ãŸã¯ãš\r\n    MediaStore.Images.Media.EXTERNAL_CONTENT_URI,\r\n    // ä»Šå›ã¯ãƒ¡ãƒ‡ã‚£ã‚¢ã® ID ã‚’å–å¾—ã€‚ä»–ã«ã‚‚ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‹ã‚ã‚Šã¾ã™\r\n    // å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã«ã¯ã€ã¾ãš ID ã‚’å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\r\n    arrayOf(MediaStore.MediaColumns._ID),\r\n    // SQL ã® WHEREã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ãŒä¼´ã†å ´åˆã¯ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’ä½¿ã„ã¾ã—ã‚‡ã†\r\n    null,\r\n    // SQL ã® WHERE ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã®å€¤\r\n    null,\r\n    // SQL ã® ORDER BY\r\n    null\r\n)?.use { cursor ->\r\n    // ä¸€å¿œæœ€åˆã«ç§»å‹•ã—ã¦ãŠã\r\n    cursor.moveToFirst()\r\n    // é…åˆ—ã‚’è¿”ã™\r\n    (0 until cursor.count)\r\n        .map {\r\n            // ID å–å¾—\r\n            val id = cursor.getLong(cursor.getColumnIndexOrThrow(MediaStore.MediaColumns._ID))\r\n            // Uri ã®å–å¾—\r\n            val uri = ContentUris.withAppendedId(MediaStore.Images.Media.EXTERNAL_CONTENT_URI, id)\r\n            // æ¬¡ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã«ç§»å‹•\r\n            cursor.moveToNext()\r\n            // è¿”ã™\r\n            uri\r\n        }\r\n} ?: emptyList()\r\n```\r\n\r\n# å†™çœŸã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’ä½œã‚‹\r\n\r\n## æ¨©é™\r\n`AndroidManifest.xml`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚  \r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\">\r\n\r\n    <!-- Android 12 ã¾ã§ã¯ã“ã¡ã‚‰ã®æ¨©é™ãŒå¿…è¦ -->\r\n    <uses-permission\r\n        android:name=\"android.permission.READ_EXTERNAL_STORAGE\"\r\n        android:maxSdkVersion=\"32\" />\r\n\r\n    <!-- Android 13 ã‹ã‚‰ã¯ã“ã¡ã‚‰ -->\r\n    <uses-permission android:name=\"android.permission.READ_MEDIA_IMAGES\" />\r\n\r\n    <!-- ä»¥ä¸‹çœç•¥ -->\r\n```\r\n\r\n## æ¨©é™ã‚’è¦æ±‚ã™ã‚‹\r\n`MainActivity`ã«æ›¸ãã¾ã™ã€‚  \r\næ¨©é™ãŒãªã‘ã‚Œã°è¦æ±‚ã™ã‚‹ãƒœã‚¿ãƒ³ã‚’å‡ºã—ã¾ã™ã€‚ç°¡å˜ã«ãªã‚Šã¾ã—ãŸã­ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    @OptIn(ExperimentalMaterial3Api::class)\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        setContent {\r\n            val context = LocalContext.current\r\n            val isGranted = remember {\r\n                // åˆæœŸå€¤ã¯æ¨©é™ãŒã‚ã‚‹ã‹\r\n                mutableStateOf(ContextCompat.checkSelfPermission(context, REQUEST_PERMISSION) == PackageManager.PERMISSION_GRANTED)\r\n            }\r\n            // æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\r\n            val requestPermission = rememberLauncherForActivityResult(contract = ActivityResultContracts.RequestPermission()) {\r\n                isGranted.value = it\r\n            }\r\n\r\n            TouchPhotoWidgetTheme {\r\n                Scaffold(\r\n                    topBar = { TopAppBar(title = { Text(text = stringResource(id = R.string.app_name)) }) }\r\n                ) {\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxSize()\r\n                            .padding(it),\r\n                        verticalArrangement = Arrangement.Center,\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n\r\n                        if (isGranted.value) {\r\n                            Text(text = \"ãƒ›ãƒ¼ãƒ ç”»é¢ã‚’é•·æŠ¼ã—ã—ã¦ã€ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’è¿½åŠ ã—ã¦ãã ã•ã„\")\r\n                        } else {\r\n                            Text(text = \"å†™çœŸã‚’å–å¾—ã™ã‚‹æ¨©é™ãŒå¿…è¦ã§ã™\")\r\n                            Button(onClick = {\r\n                                requestPermission.launch(REQUEST_PERMISSION)\r\n                            }) { Text(text = \"æ¨©é™ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹\") }\r\n                        }\r\n\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** å¿…è¦ãªæ¨©é™ */\r\n        val REQUEST_PERMISSION = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.TIRAMISU) {\r\n            android.Manifest.permission.READ_MEDIA_IMAGES\r\n        } else {\r\n            android.Manifest.permission.READ_EXTERNAL_STORAGE\r\n        }\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ç”»åƒã®å–å¾—å‡¦ç†\r\nç”»åƒã‚’èª­ã¿è¾¼ã‚€ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ï¼ï¼ï¼  \r\n`ID`ã‚’ã¨ã£ã¦ã€`Uri`ã«ã—ã¦ã€`Bitmap`ã‚’å–å¾—ã™ã‚‹æ„Ÿã˜ã§ã™ã€‚\r\n\r\nã€ã€ã€ã¨æ€ã£ã¦ãŸã‚“ã§ã™ã‘ã©ã€ãƒ¡ãƒ¢ãƒªä½¿ã„éãã§æ€’ã‚‰ã‚ŒãŸãŸã‚ã€`Glide`ã¨ã„ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§`Bitmap`ã‚’èª­ã¿è¾¼ã‚€ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\r\n\r\n```kotlin\r\nobject PhotoTool {\r\n\r\n    /**\r\n     * å†™çœŸã‚’å–å¾—ã™ã‚‹\r\n     *\r\n     * @param context [Context]\r\n     * @param limit ä¸Šé™\r\n     * @param size [Bitmap] ã®å¤§ãã•\r\n     * @return [PhotoData] ã®é…åˆ—\r\n     */\r\n    suspend fun getLatestPhotoBitmap(\r\n        context: Context,\r\n        limit: Int = 20,\r\n        size: Int = 200\r\n    ): List<PhotoData> = withContext(Dispatchers.IO) {\r\n        val contentResolver = context.contentResolver\r\n        val uri = MediaStore.Images.Media.EXTERNAL_CONTENT_URI\r\n        val selection = arrayOf(MediaStore.MediaColumns._ID)\r\n        val sortOrder = \"${MediaStore.MediaColumns.DATE_ADDED} DESC\"\r\n\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\r\n            // LIMIT ãŒä½¿ãˆã‚‹\r\n            contentResolver.query(\r\n                uri,\r\n                selection,\r\n                bundleOf(\r\n                    ContentResolver.QUERY_ARG_LIMIT to limit,\r\n                    ContentResolver.QUERY_ARG_SQL_SORT_ORDER to sortOrder\r\n                ),\r\n                null\r\n            )\r\n        } else {\r\n            // ä½¿ãˆãªã„ã®ã§ã€å–ã‚Šå‡ºã™éš›ã«ã‚„ã‚‹\r\n            contentResolver.query(\r\n                uri,\r\n                selection,\r\n                null,\r\n                null,\r\n                sortOrder\r\n            )\r\n        }?.use { cursor ->\r\n            cursor.moveToFirst()\r\n            // è¿”ã™\r\n            (0 until min(cursor.count, limit))\r\n                .map {\r\n                    // ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã® ID ã‚’å–å¾—\r\n                    val id = cursor.getLong(cursor.getColumnIndexOrThrow(MediaStore.MediaColumns._ID))\r\n                    cursor.moveToNext()\r\n                    id\r\n                }\r\n                .map { id ->\r\n                    // ID ã‹ã‚‰ Uri ã‚’å–å¾—\r\n                    ContentUris.withAppendedId(uri, id)\r\n                }\r\n                .map { uri ->\r\n                    // Uri ã‹ã‚‰ Bitmap ã‚’è¿”ã™\r\n                    // Glide ã§å°ã•ãã—ã¦ã‹ã‚‰ Bitmap ã‚’å–å¾—ã™ã‚‹\r\n                    PhotoData(getBitmap(context, uri, size), uri)\r\n                }\r\n        } ?: emptyList()\r\n    }\r\n\r\n    /**\r\n     * ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n     * Glide ã‚’ä½¿ã†ã®ã§å°ã•ãã—ã¦ Bitmap ã‚’è¿”ã›ã¾ã™\r\n     *\r\n     * @param context [Context]\r\n     * @param uri [Uri]\r\n     * @param size ã‚µã‚¤ã‚º\r\n     * @return [Bitmap]\r\n     */\r\n    suspend fun getBitmap(\r\n        context: Context,\r\n        uri: Uri,\r\n        size: Int,\r\n    ): Bitmap = withContext(Dispatchers.IO) {\r\n        Glide.with(context)\r\n            .asBitmap()\r\n            .load(uri)\r\n            .submit(size, size)\r\n            .get()\r\n    }\r\n\r\n    /**\r\n     * [Bitmap] ã¨ [Uri] ã®ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹\r\n     */\r\n    data class PhotoData(\r\n        val bitmap: Bitmap,\r\n        val uri: Uri\r\n    )\r\n\r\n}\r\n```\r\n\r\n## ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«å…¥ã‚Œã‚‹\r\nã‚ã¨ã¯ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆä¸Šã§ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ï¼  \r\n`Jetpack Compose`ã¿ãŸã„ãªæ„Ÿã˜ã§æ›¸ã„ã¦ã„ã‘ã°è‰¯ã„ã¯ãšã€‚`LocalContext`ã¯ãªã•ãã†ãªã®ã§ã€å¼•æ•°ã«ã‚ã‚‹`Context`ã‚’ãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã™ã‚‹ã¨è‰¯ã•ãã†\r\n\r\n```kotlin\r\nclass TouchPhotoWidget : GlanceAppWidget() {\r\n\r\n    override suspend fun provideGlance(context: Context, id: GlanceId) {\r\n        provideContent {\r\n\r\n            // æŠ¼ã—ãŸç”»åƒã€é¸æŠã—ã¦ã„ãªã„å ´åˆã¯ null\r\n            val selectPhoto = remember { mutableStateOf<PhotoTool.PhotoData?>(null) }\r\n            // ç”»åƒä¸€è¦§\r\n            val bitmapList = remember { mutableStateOf(emptyList<PhotoTool.PhotoData>()) }\r\n\r\n            // ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰\r\n            LaunchedEffect(key1 = Unit) {\r\n                bitmapList.value = PhotoTool.getLatestPhotoBitmap(context)\r\n            }\r\n\r\n            Box(\r\n                modifier = GlanceModifier\r\n                    .fillMaxSize()\r\n                    .background(Color.White)\r\n            ) {\r\n                if (selectPhoto.value != null) {\r\n                    // é¸æŠã—ãŸç”»åƒãŒã‚ã‚‹\r\n                    PhotoDetail(\r\n                        photoData = selectPhoto.value!!,\r\n                        onBack = { selectPhoto.value = null }\r\n                    )\r\n                } else {\r\n                    // ä¸€è¦§è¡¨ç¤º\r\n                    PhotoGridList(\r\n                        photoDataList = bitmapList.value,\r\n                        onClick = { bitmap -> selectPhoto.value = bitmap }\r\n                    )\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã§å†™çœŸã‚’è¡¨ç¤ºã™ã‚‹\r\n     *\r\n     * @param context [Context]\r\n     * @param onClick å†™çœŸã‚’æŠ¼ã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹\r\n     */\r\n    @Composable\r\n    fun PhotoGridList(\r\n        photoDataList: List<PhotoTool.PhotoData>,\r\n        onClick: (PhotoTool.PhotoData) -> Unit\r\n    ) {\r\n        LazyVerticalGrid(\r\n            modifier = GlanceModifier.fillMaxSize(),\r\n            gridCells = GridCells.Fixed(4)\r\n        ) {\r\n            items(photoDataList) { photoData ->\r\n                Image(\r\n                    modifier = GlanceModifier\r\n                        .fillMaxWidth()\r\n                        .height(100.dp)\r\n                        .clickable { onClick(photoData) },\r\n                    provider = ImageProvider(photoData.bitmap),\r\n                    contentScale = ContentScale.Crop,\r\n                    contentDescription = null\r\n                )\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * å†™çœŸã®è©³ç´°ç”»é¢\r\n     *\r\n     * @param photoData [PhotoTool.PhotoData]\r\n     * @param onBack æˆ»ã‚‹æŠ¼ã—ãŸæ™‚\r\n     */\r\n    @Composable\r\n    fun PhotoDetail(\r\n        photoData: PhotoTool.PhotoData,\r\n        onBack: () -> Unit\r\n    ) {\r\n        // ç”»åƒã‚¢ãƒ—ãƒªã§é–‹ããŸã‚ã® Intent\r\n        // data ã« Uri ã‚’æ¸¡ã™ã“ã¨ã§å¯¾å¿œã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚’ã‚ã¶ã‚Šå‡ºã™\r\n        val intent = remember { Intent(Intent.ACTION_VIEW, photoData.uri) }\r\n\r\n        Column(modifier = GlanceModifier.fillMaxSize()) {\r\n            Row(\r\n                modifier = GlanceModifier\r\n                    .fillMaxWidth()\r\n                    .padding(5.dp)\r\n            ) {\r\n                Button(\r\n                    modifier = GlanceModifier.padding(10.dp),\r\n                    text = \"æˆ»ã‚‹\",\r\n                    onClick = onBack\r\n                )\r\n                Spacer(modifier = GlanceModifier.defaultWeight())\r\n                Button(\r\n                    modifier = GlanceModifier.padding(10.dp),\r\n                    text = \"é–‹ã\",\r\n                    onClick = actionStartActivity(intent)\r\n                )\r\n            }\r\n            Image(\r\n                modifier = GlanceModifier.fillMaxSize(),\r\n                provider = ImageProvider(photoData.bitmap),\r\n                contentDescription = null\r\n            )\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ä½¿ã£ã¦ã¿ã‚‹\r\nã“ã‚“ãªæ„Ÿã˜ã«ä¸€è¦§è¡¨ç¤ºã•ã‚Œã¦ã¦ã€\r\n\r\n![Imgur](https://imgur.com/uPnmC3M.png)\r\n\r\næŠ¼ã™ã¨ä¸€æšã ã‘è¡¨ç¤ºã•ã‚Œã¾ã™ï¼\r\n\r\n![Imgur](https://imgur.com/XuFaZJt.png)\r\n\r\n`æˆ»ã‚‹`ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨æˆ»ã‚Œã¾ã™ã€‚ã‚ã¨`é–‹ã`ã‚’æŠ¼ã™ã¨ã‚¢ãƒ—ãƒªã‚’é¸æŠã™ã‚‹ç”»é¢ãŒå‡ºã¾ã™ï¼  \r\n`Intent(Intent.ACTION_VIEW, photoData.uri)`â†ã“ã®`ç¬¬2å¼•æ•°`ã«`Uri`ã‚’å…¥ã‚Œã‚‹ã‚„ã¤\r\n\r\n![Imgur](https://imgur.com/WsHKYrd.png)\r\n\r\nã¡ãª`Android 14`ã§æŠ¼ã—ãŸã‚‰è½ã¡ãŸ  \r\n`PendingIntent`ã®å¼•æ•°ã‚’`FLAG_IMMUTABLE`ã«ã—ãªã„ã¨ã„ã‘ãªã„ã‚“ã ã‘ã©ã€ç¾çŠ¶ã¯`Glance`ãŒå†…éƒ¨ã§`PendingIntent`ã‚’ä½œã£ã¦ã„ã‚‹ã®ã§ç›´ã›ãªã„ã€‚  \r\n`RemoteViews`ã‚’ä½œã£ã¦ã€`PendingIntent`ã‚’æ¸¡ã—ã¦ã€ãã®`RemoteViews`ã‚’`Glance`ã§ä½¿ã†ï¼ˆç›¸äº’åˆ©ç”¨ãŒã§ãã‚‹ï¼‰ã—ã‹ãªã•ãã†ãƒ»ãƒ»ãƒ»\r\n\r\n```plaintext\r\nUnrecognized Action: androidx.glance.appwidget.action.StartActivityIntentAction@3cb3c84\r\n    java.lang.IllegalArgumentException: io.github.takusan23.touchphotowidget: Targeting U+ (version 34 and above) disallows creating or retrieving a PendingIntent with FLAG_MUTABLE, an implicit Intent within and without FLAG_NO_CREATE and FLAG_ALLOW_UNSAFE_IMPLICIT_INTENT for security reasons. To retrieve an already existing PendingIntent, use FLAG_NO_CREATE, however, to create a new PendingIntent with an implicit Intent use FLAG_IMMUTABLE.\r\n    at android.os.Parcel.createExceptionOrNull(Parcel.java:3061)\r\n    at android.os.Parcel.createException(Parcel.java:3041)\r\n    at android.os.Parcel.readException(Parcel.java:3024)\r\n    at android.os.Parcel.readException(Parcel.java:2966)\r\n    at android.app.IActivityManager$Stub$Proxy.getIntentSenderWithFeature(IActivityManager.java:6568)\r\n    at android.app.PendingIntent.getActivityAsUser(PendingIntent.java:571)\r\n    at android.app.PendingIntent.getActivity(PendingIntent.java:552)\r\n    at androidx.glance.appwidget.action.ApplyActionKt.getPendingIntentForAction(ApplyAction.kt:82)\r\n    at androidx.glance.appwidget.action.ApplyActionKt.getPendingIntentForAction$default(ApplyAction.kt:73)\r\n```\r\n\r\n## è¦‹ãŸç›®ã‚’æ•´ãˆã‚‹\r\n\r\n### è‰²\r\n\r\nã¾ãš`GlanceTheme`ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ã€è¦ªã‚’`GlanceTheme`ã§å›²ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n// ãƒ†ãƒ¼ãƒæ©Ÿèƒ½\r\nGlanceTheme(\r\n    colors = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n        GlanceTheme.colors\r\n    } else {\r\n        colors\r\n    }\r\n) {\r\n    Box(\r\n        modifier = GlanceModifier\r\n            .fillMaxSize()\r\n            .background(GlanceTheme.colors.secondaryContainer)\r\n    ) {\r\n        if (selectPhoto.value != null) {\r\n            // é¸æŠã—ãŸç”»åƒãŒã‚ã‚‹\r\n            PhotoDetail(\r\n                photoData = selectPhoto.value!!,\r\n                onBack = { selectPhoto.value = null }\r\n            )\r\n        } else {\r\n            // ä¸€è¦§è¡¨ç¤º\r\n            PhotoGridList(\r\n                photoDataList = bitmapList.value,\r\n                onClick = { bitmap -> selectPhoto.value = bitmap }\r\n            )\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`Android 12`ä»¥é™ã¯`Dynamic Color ( Material You )`ã‚’ä½¿ã„ã¾ã™ã€‚  \r\nãã‚Œä»¥ä¸‹ã§ä½¿ã†ãŸã‚ã®`colors`ã¯ã€`Empty Compose Project`æ›¸ã„ãŸæ™‚ã«ä»˜ã„ã¦ããŸã‚„ã¤ã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\ncompanion object {\r\n    val colors = ColorProviders(\r\n        light = LightColorScheme,\r\n        dark = DarkColorScheme\r\n    )\r\n}\r\n```\r\n\r\nèƒŒæ™¯ã®è‰²ã¯ã€`secondaryContainer`ã«ã™ã‚‹ã¨è‰¯ã•ãã†ã§ã™ã€‚\r\n\r\n```kotlin\r\nBox(\r\n    modifier = GlanceModifier\r\n        .fillMaxSize()\r\n        .background(GlanceTheme.colors.secondaryContainer)\r\n) { }\r\n```\r\n\r\nãƒœã‚¿ãƒ³ã®è‰²ã¯ã€ã‚¢ã‚¤ã‚³ãƒ³ã ã‘ã®ã‚„ã¤ã ã¨`primary`ã£ã½ã„ã€‚  \r\nå¡—ã‚Šã¤ã¶ã—ã‚¢ã‚¤ã‚³ãƒ³ã®å ´åˆã¯ã€å¡—ã‚Šã¤ã¶ã—ãŒ`primary`ã§ã€ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ãŒ`primaryContainer`ã£ã½ã„ï¼ˆ`Container`ãŒé€†è»¢ï¼ï¼Ÿï¼‰  \r\n\r\nã‚ã¨é©å½“ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŒã£ã¦ãã¾ã—ãŸã€‚`Icon`ã¯å¤šåˆ†ãªã•ãã†ãªã®ã§ã€`Image`ã‚’ä½¿ã†ã§ã‚ã£ã¦ãã†ã€‚\r\n\r\n```kotlin\r\nRow(\r\n    modifier = GlanceModifier\r\n        .fillMaxWidth()\r\n        .padding(5.dp)\r\n) {\r\n    // æˆ»ã‚‹ãƒœã‚¿ãƒ³\r\n    Image(\r\n        modifier = GlanceModifier\r\n            .size(40.dp)\r\n            .padding(5.dp)\r\n            .cornerRadius(10.dp)\r\n            .clickable(onBack),\r\n        provider = ImageProvider(resId = R.drawable.outline_arrow_back_24),\r\n        contentDescription = null,\r\n        colorFilter = ColorFilter.tint(GlanceTheme.colors.primary)\r\n    )\r\n    Spacer(modifier = GlanceModifier.defaultWeight())\r\n    // ã‚¢ãƒ—ãƒªã‚’é–‹ã\r\n    // å¡—ã‚Šã¤ã¶ã—\r\n    Image(\r\n        modifier = GlanceModifier\r\n            .size(40.dp)\r\n            .padding(5.dp)\r\n            .background(GlanceTheme.colors.primary)\r\n            .cornerRadius(10.dp)\r\n            .clickable(actionStartActivity(intent)),\r\n        provider = ImageProvider(resId = R.drawable.outline_open_in_new_24),\r\n        contentDescription = null,\r\n        colorFilter = ColorFilter.tint(GlanceTheme.colors.primaryContainer)\r\n    )\r\n}\r\n```\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ã—ã¦ã¿ãŸã€‚ä»–ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚‚åŒã˜æ„Ÿã˜ã®è‰²ä½¿ã„ã—ã¦ãã†ï¼\r\n\r\n![Imgur](https://imgur.com/SZ2wqhi.png)\r\n\r\nã¡ãªã¿ã«ã€`primaryContainer`ã¯å®Ÿéš›ã«ã¯`Android`ã®ã‚«ãƒ©ãƒ¼ãƒªã‚½ãƒ¼ã‚¹ã®`ID`ã‚’æŒ‡ã—ã¦ã„ã‚‹ï¼ˆ`android.R.color.xxxxx`ã¿ãŸã„ãªï¼‰ã®ã§ã€ä»¥ä¸‹ã®`colors.xml`ã‚’è¦‹ã‚‹ã¨å®Ÿéš›ã®`ID`ã‚’è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\nhttps://cs.android.com/androidx/platform/frameworks/support/+/androidx-main:glance/glance/src/main/res/values-v31/colors.xml;l=1\r\n\r\n`primary`ã¯`@android:color/system_accent1_600`ã‚’æŒ‡å®šã™ã‚‹ã®ã¨åŒã˜åƒãã‚’ã™ã‚‹ã¿ãŸã„ã§ã™ã­ï¼\r\n\r\n## ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³\r\nã“ã‚Œã ã¨ã€æ¨ªå¹…ã«é–¢ä¿‚ãªã`4ã¤`è¡¨ç¤ºã—ã¦ã„ã‚‹ã®ã§ã€å¹…ãŒãªã„ã¨ãã¯`2`ã¨ã‹ã«ã—ãŸã„ï¼ã¿ãŸã„ãªã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚  \r\nã“ã‚Œã‚‚`Jetpack Glance`ãªã‚‰ç°¡å˜ã«ã§ãã‚‹ã®ã§ã‚„ã‚Šã¾ã™ã€‚ï¼ˆ`RemoteViews`ã ã£ãŸã‚‰ã‚„ã‚ŠãŸããªã„\r\n\r\nã¾ãšã¯å¤§ãã•ã‚’å®šç¾©ã—ã¦\r\n\r\n```kotlin\r\ncompanion object {\r\n\r\n    /** å°ã•ã„ã‚µã‚¤ã‚º */\r\n    private val SMALL = DpSize(width = 100.dp, height = 100.dp)\r\n\r\n    /** å¤§ãã„ã‚µã‚¤ã‚º */\r\n    private val LARGE = DpSize(width = 250.dp, height = 100.dp)\r\n    \r\n}\r\n```\r\n\r\næ¬¡ã«ã€`GlanceAppWidget`ã®`sizeMode`ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¦ã€`SizeMode.Responsive`ã‚’ä½œã£ã¦è¿”ã—ã¦ã‚ã’ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass TouchPhotoWidget : GlanceAppWidget() {\r\n\r\n    /** ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®åˆ©ç”¨å¯èƒ½ãªã‚µã‚¤ã‚ºã€‚é€šå¸¸ã¨æ¨ªã«é•·ã„ã‚µã‚¤ã‚º */\r\n    override val sizeMode = SizeMode.Responsive(setOf(SMALL, LARGE))\r\n\r\n```\r\n\r\nã‚ã¨ã¯ã€`LocalSize`ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã€ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æ¨ªä¸¦ã³ã‚»ãƒ«æ•°ã®éƒ¨åˆ†ã§ä½¿ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã§å†™çœŸã‚’è¡¨ç¤ºã™ã‚‹\r\n *\r\n * @param context [Context]\r\n * @param onClick å†™çœŸã‚’æŠ¼ã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹\r\n */\r\n@Composable\r\nfun PhotoGridList(\r\n    photoDataList: List<PhotoTool.PhotoData>,\r\n    onClick: (PhotoTool.PhotoData) -> Unit\r\n) {\r\n    // ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å¤§ãã•ã«ã‚ˆã£ã¦æ¨ªã«ä¸¦ã¹ã‚‹æ•°ã‚’å¤‰ãˆã‚‹\r\n    val gridSize = if (LocalSize.current.width >= LARGE.width) 4 else 2\r\n\r\n    LazyVerticalGrid(\r\n        modifier = GlanceModifier.fillMaxSize(),\r\n        gridCells = GridCells.Fixed(gridSize)\r\n    ) {\r\n        // ä»¥ä¸‹çœç•¥...\r\n```\r\n\r\nã“ã‚Œã§ã€æ¨ªå¹…ãŒå°ã•ã„ã¨ãã¯æ¨ªä¸¦ã³ãŒ2ã¤ã«ãªã‚Šã¾ã—ãŸã€‚  \r\nå¤šåˆ†ã‚‚ã£ã¨åˆ»ã‚€ã“ã¨ãŒã§ãã‚‹ã¯ãšã§ã™ã€‚ã„ã‚„ï½ï½æ¥½ã§ã™ã­ã“ã‚Œ\r\n\r\n![Imgur](https://imgur.com/l0X4b6s.png)\r\n\r\nã¡ãªã¿ã«ã€æ™®é€šã«ã“ãƒ¼ã‚†ãƒ¼ã“ã¨ã‚‚ã§ãã‚‹ã®ã§ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå…¨ä½“ã‚’å¤‰ãˆã‚‹ã“ã¨ã‚‚å‡ºæ¥ã¾ã™ã€‚  \r\næœ¬å½“ã«ãªã‚“ã§å‹•ã„ã¦ã‚‹ã‹ä¸æ€è­°ã ...\r\n\r\n```kotlin\r\nval size = LocalSize.current\r\n// ã‚µã‚¤ã‚ºã«ã‚ˆã£ã¦ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹\r\nif (size.width >= LARGE.width) {\r\n    LargeWidgetContent()\r\n} else {\r\n    SmallWidgetContent()\r\n}\r\n```\r\n\r\n# ã“ã“ã¾ã§ã‚³ãƒ¼ãƒ‰å…¨éƒ¨\r\n\r\n```kotlin\r\nclass TouchPhotoWidget : GlanceAppWidget() {\r\n\r\n    /** ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®åˆ©ç”¨å¯èƒ½ãªã‚µã‚¤ã‚ºã€‚é€šå¸¸ã¨æ¨ªã«é•·ã„ã‚µã‚¤ã‚º */\r\n    override val sizeMode = SizeMode.Responsive(setOf(SMALL, LARGE))\r\n\r\n    override suspend fun provideGlance(context: Context, id: GlanceId) {\r\n        provideContent {\r\n\r\n            // æŠ¼ã—ãŸç”»åƒã€é¸æŠã—ã¦ã„ãªã„å ´åˆã¯ null\r\n            val selectPhoto = remember { mutableStateOf<PhotoTool.PhotoData?>(null) }\r\n            // ç”»åƒä¸€è¦§\r\n            val bitmapList = remember { mutableStateOf(emptyList<PhotoTool.PhotoData>()) }\r\n\r\n            // ç”»åƒã‚’ãƒ­ãƒ¼ãƒ‰\r\n            LaunchedEffect(key1 = Unit) {\r\n                bitmapList.value = PhotoTool.getLatestPhotoBitmap(context)\r\n            }\r\n\r\n            // ãƒ†ãƒ¼ãƒæ©Ÿèƒ½\r\n            GlanceTheme(\r\n                colors = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n                    GlanceTheme.colors\r\n                } else {\r\n                    colors\r\n                }\r\n            ) {\r\n                Box(\r\n                    modifier = GlanceModifier\r\n                        .fillMaxSize()\r\n                        .background(GlanceTheme.colors.secondaryContainer)\r\n                ) {\r\n                    if (selectPhoto.value != null) {\r\n                        // é¸æŠã—ãŸç”»åƒãŒã‚ã‚‹\r\n                        PhotoDetail(\r\n                            photoData = selectPhoto.value!!,\r\n                            onBack = { selectPhoto.value = null }\r\n                        )\r\n                    } else {\r\n                        // ä¸€è¦§è¡¨ç¤º\r\n                        PhotoGridList(\r\n                            photoDataList = bitmapList.value,\r\n                            onClick = { bitmap -> selectPhoto.value = bitmap }\r\n                        )\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ã‚°ãƒªãƒƒãƒ‰è¡¨ç¤ºã§å†™çœŸã‚’è¡¨ç¤ºã™ã‚‹\r\n     *\r\n     * @param context [Context]\r\n     * @param onClick å†™çœŸã‚’æŠ¼ã—ãŸã‚‰å‘¼ã°ã‚Œã‚‹\r\n     */\r\n    @Composable\r\n    fun PhotoGridList(\r\n        photoDataList: List<PhotoTool.PhotoData>,\r\n        onClick: (PhotoTool.PhotoData) -> Unit\r\n    ) {\r\n        // ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã®å¤§ãã•ã«ã‚ˆã£ã¦æ¨ªã«ä¸¦ã¹ã‚‹æ•°ã‚’å¤‰ãˆã‚‹\r\n        val gridSize = if (LocalSize.current.width >= LARGE.width) 4 else 2\r\n\r\n        LazyVerticalGrid(\r\n            modifier = GlanceModifier.fillMaxSize(),\r\n            gridCells = GridCells.Fixed(gridSize)\r\n        ) {\r\n            items(photoDataList) { photoData ->\r\n                Image(\r\n                    modifier = GlanceModifier\r\n                        .fillMaxWidth()\r\n                        .height(100.dp)\r\n                        .clickable { onClick(photoData) },\r\n                    provider = ImageProvider(photoData.bitmap),\r\n                    contentScale = ContentScale.Crop,\r\n                    contentDescription = null\r\n                )\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * å†™çœŸã®è©³ç´°ç”»é¢\r\n     *\r\n     * @param photoData [PhotoTool.PhotoData]\r\n     * @param onBack æˆ»ã‚‹æŠ¼ã—ãŸæ™‚\r\n     */\r\n    @Composable\r\n    fun PhotoDetail(\r\n        photoData: PhotoTool.PhotoData,\r\n        onBack: () -> Unit\r\n    ) {\r\n        // ç”»åƒã‚¢ãƒ—ãƒªã§é–‹ããŸã‚ã® Intent\r\n        // data ã« Uri ã‚’æ¸¡ã™ã“ã¨ã§å¯¾å¿œã—ã¦ã„ã‚‹ã‚¢ãƒ—ãƒªã‚’ã‚ã¶ã‚Šå‡ºã™\r\n        val intent = remember { Intent(Intent.ACTION_VIEW, photoData.uri) }\r\n\r\n        Column(modifier = GlanceModifier.fillMaxSize()) {\r\n            Row(\r\n                modifier = GlanceModifier\r\n                    .fillMaxWidth()\r\n                    .padding(5.dp)\r\n            ) {\r\n                // æˆ»ã‚‹ãƒœã‚¿ãƒ³\r\n                Image(\r\n                    modifier = GlanceModifier\r\n                        .size(40.dp)\r\n                        .padding(5.dp)\r\n                        .cornerRadius(10.dp)\r\n                        .clickable(onBack),\r\n                    provider = ImageProvider(resId = R.drawable.outline_arrow_back_24),\r\n                    contentDescription = null,\r\n                    colorFilter = ColorFilter.tint(GlanceTheme.colors.primary)\r\n                )\r\n                Spacer(modifier = GlanceModifier.defaultWeight())\r\n                // ã‚¢ãƒ—ãƒªã‚’é–‹ã\r\n                // å¡—ã‚Šã¤ã¶ã—\r\n                Image(\r\n                    modifier = GlanceModifier\r\n                        .size(40.dp)\r\n                        .padding(5.dp)\r\n                        .background(GlanceTheme.colors.primary)\r\n                        .cornerRadius(10.dp)\r\n                        .clickable(actionStartActivity(intent)),\r\n                    provider = ImageProvider(resId = R.drawable.outline_open_in_new_24),\r\n                    contentDescription = null,\r\n                    colorFilter = ColorFilter.tint(GlanceTheme.colors.primaryContainer)\r\n                )\r\n            }\r\n            Image(\r\n                modifier = GlanceModifier.fillMaxSize(),\r\n                provider = ImageProvider(photoData.bitmap),\r\n                contentDescription = null\r\n            )\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** Material You ãŒä½¿ãˆãªã„ç”¨ */\r\n        val colors = ColorProviders(\r\n            light = LightColorScheme,\r\n            dark = DarkColorScheme\r\n        )\r\n\r\n        /** å°ã•ã„ã‚µã‚¤ã‚º */\r\n        private val SMALL = DpSize(width = 100.dp, height = 100.dp)\r\n\r\n        /** å¤§ãã„ã‚µã‚¤ã‚º */\r\n        private val LARGE = DpSize(width = 250.dp, height = 100.dp)\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n## Android Jetpack Glance çŸ¥è¦‹\r\næœ€å¾Œã«ã“ã‚Œä½œã£ã¦ãŸã‚Šã€`NewRadioSupporter`ã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆä½œã£ã¦ãŸã¨ãã®çŸ¥è¦‹ã‚’æ®‹ã—ã¾ã™ã€‚\r\n\r\n- `provideContent { }`ã¯`45`ç§’é–“å‹•ãç¶šã‘ã‚‹ï¼Ÿ\r\n    - â†‘ ã®é–“ã€`collectAsState`ã¨ã‹ãŒå‹•ãã®ã‹\r\n    - `GlanceAppWidget#provideGlance`ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ãã ã•ã„ã€‚\r\n- ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’æ›´æ–°ã™ã‚‹é–¢æ•°ãŒã‚ã‚Šã¾ã™ã€‚\r\n    - `TouchPhotoWidget().update()`ã¨ã‹`TouchPhotoWidget().updateAll()`ã¨ã‹\r\n    - ã“ã‚Œã‚‰ã¯ã€`provideContent { }`ãŒå‹•ã„ã¦ã„ã‚‹ã¨ãã¯ç‰¹ã«ä½•ã‚‚ã—ãªã•ãã†\r\n        - `WorkManager`ãŒå‹•ã„ã¦ã„ã‚‹é–“ï¼Ÿã¯æ—¢ã«ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå‹•ã„ã¦ã‚‹ã®ã§ç‰¹ã«ä½•ã‚‚ã—ãªã„ï¼Ÿ\r\n- `GlanceModifier.clickable { }`ã®éš›ã€`provideContent { }`ãŒèµ·å‹•ã—ã¦ã„ãªã‹ã£ãŸã‚‰èµ·å‹•ã™ã‚‹ã½ã„\r\n    - `WorkManager`ãŒè£ã§å‹•ã\r\n        - ãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã§æŠ¼ã™ã¨ã€`45`ç§’ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã‚‚å»¶é•·ã™ã‚‹ã‚‰ã—ã„\r\n- å¤šåˆ†ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆå¤‰æ›´æ™‚ã«å†è¨­ç½®ãŒå¿…è¦ãªã®ã¯å¤‰ã‚ã£ã¦ãªã„ã¨æ€ã†ã€`RemoteViews`ã ã‹ã‚‰ä»•æ–¹ãªã„ã®ã‹ã‚‚\r\n\r\n# ãŠã‚ã‚Šã«\r\nã“ã‚Œã‚‚`iOS`ã§ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆãŒå…¥ã£ãŸå½±éŸ¿ã¿ãŸã„ãªã®ãŒã‚ã‚‹ã‚“ã§ã™ã‹ã­ï¼Ÿ  \r\nã‚‚ã—ã‚‚å…¥ã‚‰ãªã‘ã‚Œã°ã€`Android`ã‚‚ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆå‘¨ã‚Šã®æ”¹ä¿®ãŒå…¥ã‚‰ãšåœ°ç„ã®ã¾ã¾ã ã£ãŸã®ã§ã—ã‚‡ã†ã‹ãƒ»ãƒ»ãƒ»ã‚ã‚ŠãŒã¨ã†`iOS`  \r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™ã€‚æœ€æ–°ã®`Android Studio`ã§å®Ÿè¡Œã§ãã‚‹ã¯ãšã§ã™ã€‚  \r\nhttps://github.com/takusan23/TouchPhotoWidget\r\n\r\n# ãŠã‚ã‚Šã«2\r\n`BroadcastReceiver`ã§æ€ã„å‡ºã—ãŸã€ãƒ¬ã‚·ãƒ¼ãƒãƒ¼ã®ã‚¹ãƒšãƒ«ã€ãŸã¾ã«`Reciever`ã£ã¦æ›¸ã„ã¡ã‚ƒã†\r\n\r\n# ãŠã‚ã‚Šã«3\r\n`NewRadioSupporter` å¯©æŸ»å‡ºã—ã—ã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/XxAV4Y9.png)"},{"title":"Glideã§ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰","link":"/posts/android_glide_crossfade/","markdown":"\r\n[å…¬å¼ã«ä¹—ã£ã¦ã¾ã™ãŒãƒ¡ãƒ¢ã§](https://bumptech.github.io/glide/doc/options.html#transitionoptions)\r\n\r\n# ã‚¯ãƒ­ã‚¹ãƒ•ã‚§ãƒ¼ãƒ‰ã—ã¦è¡¨ç¤º\r\n\r\n```kotlin\r\nGlide.with(imageView)\r\n    .load(\"URL\")\r\n    .transition(DrawableTransitionOptions.withCrossFade()) // ã“ã‚Œ\r\n    .into(imageView)\r\n```\r\n\r\n## ãŠã¾ã‘ è§’ã‚’ä¸¸ãã™ã‚‹\r\n\r\n```kotlin\r\nGlide.with(imageView)\r\n    .load(\"URL\")\r\n    .apply(RequestOptions.bitmapTransform(RoundedCorners(10))) // ã“ã‚Œ\r\n    .into(imageView)\r\n```"},{"title":"Android Studio Bumblebee ã§ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã® build.gradle ã®æ›¸ãæ–¹ãŒå¤‰ã‚ã£ãŸã¿ãŸã„","link":"/posts/android_gradle_bumblebee/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n\r\n# æœ¬é¡Œ\r\næ›¸ãæ–¹å¤‰ã‚ã£ã¦ã‚‹\r\n\r\n```java\r\n// ä»Šã¾ã§ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« build.gradle (appã˜ã‚ƒãªã„æ–¹)\r\n\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nbuildscript {\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n    }\r\n    dependencies {\r\n        classpath \"com.android.tools.build:gradle:7.0.4\"\r\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:1.6.10\"\r\n\r\n        // NOTE: Do not place your application dependencies here; they belong\r\n        // in the individual module build.gradle files\r\n    }\r\n}\r\n\r\ntask clean(type: Delete) {\r\n    delete rootProject.buildDir\r\n}\r\n```\r\n\r\n```java\r\n// Android Studio Bumblebee ä»¥é™\r\n\r\nbuildscript {\r\n    ext {\r\n        compose_version = '1.1.0-rc03'\r\n    }\r\n}// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nplugins {\r\n    id 'com.android.application' version '7.1.0' apply false\r\n    id 'com.android.library' version '7.1.0' apply false\r\n    id 'org.jetbrains.kotlin.android' version '1.6.10' apply false\r\n}\r\n\r\ntask clean(type: Delete) {\r\n    delete rootProject.buildDir\r\n}\r\n```\r\n\r\n# å…¬å¼ã«æ¡ˆå†…ã‚ã‚‹ã‚„ã‚“\r\n\r\nhttps://developer.android.com/studio/releases/gradle-plugin#settings-gradle\r\n\r\n`buildscript`ã®`repositories`ãŒ`settings.gradle`ã¸ç§»å‹•ã—ãŸã¿ãŸã„\r\n\r\n```java\r\n// Android Studio Bumblebee ä»¥é™ ã® settings.gradle\r\n\r\npluginManagement {\r\n    repositories {\r\n        gradlePluginPortal()\r\n        google()\r\n        mavenCentral()\r\n    }\r\n}\r\ndependencyResolutionManagement {\r\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n    }\r\n}\r\nrootProject.name = \"JetpackComposeParentClickEvent\"\r\ninclude ':app'\r\n```\r\n\r\n# ãŠã¾ã‘ build.gradle.kts ã™ã‚‹ãªã‚‰\r\n\r\n`Gradle 7.2`ã«ã™ã‚Œã°æ—¢å­˜ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚æ›¸ãæ›ãˆã§ãã‚‹ã®ã‹ãªï¼Ÿ  \r\n\r\n```\r\n# gradle-wrapper.properties\r\n\r\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-7.2-bin.zip # ã“ã“ã‚’ 7.2  \r\n```\r\n\r\n## build.gradle.kts (appãƒ•ã‚©ãƒ«ãƒ€ã˜ã‚ƒãªã„æ–¹)\r\n\r\n```kotlin\r\nbuildscript {\r\n    val kotlinVersion: String by extra(\"1.6.10\")\r\n    val composeVersion: String by extra(\"1.1.0-rc03\")\r\n}\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nplugins {\r\n    id(\"com.android.application\").version(\"7.1.0\").apply(false)\r\n    id(\"com.android.library\").version(\"7.1.0\").apply(false)\r\n    id(\"org.jetbrains.kotlin.android\").version(\"1.6.10\").apply(false)\r\n}\r\n\r\ntasks.register(\"clean\") {\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n```\r\n\r\n## settings.gradle.kts\r\n\r\n```kotlin\r\npluginManagement {\r\n    repositories {\r\n        gradlePluginPortal()\r\n        google()\r\n        mavenCentral()\r\n    }\r\n}\r\n\r\ndependencyResolutionManagement {\r\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n        jcenter() // Warning: this repository is going to shut down soon\r\n    }\r\n}\r\n// ã“ã“ã‹ã‚‰ä¸‹ã¯å„è‡ªæ›¸ãæ›ãˆã¦\r\nrootProject.name = \"ChocoDroid\"\r\ninclude(\":app\")\r\n```\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã‚½ãƒ•ãƒˆãƒãƒ³ã‚¯ãŒAndroid/iPhoneåˆ¥ã®SIMã‚’ç™ºè¡Œã™ã‚‹ã®è¾ã‚ãŸã‚‰ã—ã„"},{"title":"build.gradle.ktsã¸ç§»è¡Œã—ã¦ã¤ã„ã§ã«Gradleã‚¿ã‚¹ã‚¯å…¥é–€","link":"/posts/android_gradle_to_kts/","markdown":"\r\n(Android Studio Bumblebee ä»¥é™æ›¸ãæ–¹å¤‰ã‚ã£ãŸã®ã§ä¸€ç•ªæœ€å¾Œã‚‚å‚ç…§ã«ã—ã¦ãã ã•ã„)\r\n\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nAndroid 12ã€ã‚ã‚“ã¾è©•åˆ¤ã‚ˆããªã„ãªï¼Ÿ1ç”»é¢ã§è¦‹ã‚Œã‚‹æƒ…å ±é‡ãŒæ¸›ã£ãŸæ„Ÿã¯ã‚ã‚‹ã¨æ€ã†ã€‚  \r\nã‚ªãƒ¼ãƒãƒ¼ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã®æŒ™å‹•ã¯è³›å¦ä¸¡è«–ï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\nbuild.gradleã‚’build.gradle.ktsã¸æ›¸ãæ›ãˆã¾ã™ã€‚  \r\nè‡ªåˆ†ç”¨ã§ã™ã€‚\r\n\r\nç§»è¡Œã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆã¯ã€ã©ã†ã ã‚ã†ã€‚\r\n\r\n## ç§»è¡Œå‰\r\n\r\n`build.gradle`\r\n\r\n```java\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nbuildscript {\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n    }\r\n    dependencies {\r\n        classpath 'com.android.tools.build:gradle:7.0.3'\r\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.31\"\r\n\r\n        // NOTE: Do not place your application dependencies here; they belong\r\n        // in the individual module build.gradle files\r\n    }\r\n}\r\n\r\ntask clean(type: Delete) {\r\n    delete rootProject.buildDir\r\n}\r\n```\r\n\r\n`app/build.gradle`\r\n\r\n```java\r\nplugins {\r\n    id 'com.android.application'\r\n    id 'kotlin-android'\r\n}\r\n\r\nandroid {\r\n    compileSdk 31\r\n    buildToolsVersion \"30.0.3\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.mobilestatuswidget\"\r\n        minSdk 24\r\n        targetSdk 31\r\n        versionCode 2\r\n        versionName \"1.1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildFeatures {\r\n        viewBinding true\r\n    }\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility JavaVersion.VERSION_1_8\r\n        targetCompatibility JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = '1.8'\r\n    }\r\n}\r\n\r\ndependencies {\r\n    // ã‚°ãƒ©ãƒ•\r\n    implementation 'com.github.PhilJay:MPAndroidChart:v3.1.0'\r\n    // Activity Result API\r\n    implementation 'androidx.activity:activity-ktx:1.4.0-rc01'\r\n    implementation 'androidx.fragment:fragment-ktx:1.3.6'\r\n    // Coroutine\r\n    implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.5.2\"\r\n\r\n    implementation 'androidx.core:core-ktx:1.6.0'\r\n    implementation 'androidx.appcompat:appcompat:1.3.1'\r\n    implementation 'com.google.android.material:material:1.4.0'\r\n    implementation 'androidx.constraintlayout:constraintlayout:2.1.1'\r\n    testImplementation 'junit:junit:4.13.2'\r\n    androidTestImplementation 'androidx.test.ext:junit:1.1.3'\r\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'\r\n}\r\n```\r\n\r\n# ç§»è¡Œã™ã‚‹\r\nåå‰ã‚’`build.gradle`ã‹ã‚‰`build.gradle.kts`ã«ã—ã¾ã™ã€‚  \r\nãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§`Shift`+`F6`ã§åå‰å¤‰æ›´ç”»é¢ã‚’å‘¼ã³å‡ºã›ã¾ã™ã€‚  \r\n\r\nç§»è¡Œã—ãŸã‚‰ã¨ã‚Šã‚ãˆãš`Sync now`æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚ç›´ã™ã¹ãé …ç›®ãŒèµ¤ããªã£ã¦å‡ºã‚‹ã¯ãšã€‚\r\n\r\n## build.gradle.kts ç§»è¡Œä¾‹\r\n\r\n```kotlin\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nbuildscript {\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n    }\r\n    dependencies {\r\n        classpath(\"com.android.tools.build:gradle:7.0.3\")\r\n        classpath(\"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.31\")\r\n\r\n        // NOTE: Do not place your application dependencies here; they belong\r\n        // in the individual module build.gradle files\r\n    }\r\n}\r\n\r\ntasks.register(\"clean\") {\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n```\r\n\r\nä¸€ç•ªæœ€å¾Œã®`tasks.register`ã¯ä»–ã«ã‚‚æ›¸ãæ–¹ã‚ã‚‹ã¿ãŸã„ãªã®ã§èª¿ã¹ã¦ã¿ã¦ãã ã•ã„ã€‚\r\n\r\n## app/build.gradle.kts ç§»è¡Œä¾‹\r\n\r\n```kotlin\r\nplugins {\r\n    id(\"com.android.application\")\r\n    id(\"kotlin-android\")\r\n}\r\n\r\nandroid {\r\n    compileSdk = 31\r\n    buildToolsVersion = \"30.0.3\"\r\n\r\n    defaultConfig {\r\n        applicationId = \"io.github.takusan23.mobilestatuswidget\"\r\n        minSdk = 24\r\n        targetSdk = 31\r\n        versionCode = 2\r\n        versionName = \"1.1.0\"\r\n\r\n        testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildFeatures {\r\n        viewBinding = true\r\n    }\r\n    buildTypes {\r\n        release {\r\n            isMinifyEnabled = false\r\n            proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"proguard-rules.pro\")\r\n        }\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility = JavaVersion.VERSION_1_8\r\n        targetCompatibility = JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = \"1.8\"\r\n    }\r\n}\r\n\r\ndependencies {\r\n    // ã‚°ãƒ©ãƒ•\r\n    implementation(\"com.github.PhilJay:MPAndroidChart:v3.1.0\")\r\n    // Activity Result API\r\n    implementation(\"androidx.activity:activity-ktx:1.4.0-rc01\")\r\n    implementation(\"androidx.fragment:fragment-ktx:1.3.6\")\r\n    // Coroutine\r\n    implementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.5.2\")\r\n\r\n    implementation(\"androidx.core:core-ktx:1.6.0\")\r\n    implementation(\"androidx.appcompat:appcompat:1.3.1\")\r\n    implementation(\"com.google.android.material:material:1.4.0\")\r\n    implementation(\"androidx.constraintlayout:constraintlayout:2.1.1\")\r\n    testImplementation(\"junit:junit:4.13.2\")\r\n    androidTestImplementation(\"androidx.test.ext:junit:1.1.3\")\r\n    androidTestImplementation(\"androidx.test.espresso:espresso-core:3.4.0\")\r\n}\r\n```\r\n\r\n`Kotlin`ã£ã½ã„æ›¸ãæ–¹ã«ãªã£ã¦è¬ãŒæ¸›ã£ãŸã‚ˆã†ãªæ°—ãŒã™ã‚‹ã€‚\r\n\r\n## å¤‰æ•°ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆ\r\n`Jetpack Compose` ~~ï¼ˆç•¥ã—ã¦JCï¼‰~~ ã‚’ä½¿ã£ã¦ã„ã‚‹ä¾‹ã§ã¯ã€build.gradleã§Composeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰æ•°ã§å®£è¨€ã—ã¦ã€`app/build.gradle`ã§å‚ç…§ã—ã¦ã„ã‚‹ã®ãŒã‚ˆãã‚ã‚‹ã¨æ€ã„ã¾ã™ãŒã€  \r\nã“ã®ã¾ã¾ã§ã¯ç§»è¡Œã§ããªã„ã®ã§æ›¸ãç›´ã—ã¾ã™ã€‚\r\n\r\n### build.gralde.kts ã§å¤‰æ•°ã‚’å®£è¨€ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nbuildscript {\r\n    \r\n    /** Kotlinã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ */\r\n    val kotlinVersion by extra(\"1.5.31\")\r\n\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n    }\r\n    dependencies {\r\n        classpath(\"com.android.tools.build:gradle:7.0.3\")\r\n        classpath(\"org.jetbrains.kotlin:kotlin-gradle-plugin:${kotlinVersion}\")\r\n\r\n        // NOTE: Do not place your application dependencies here; they belong\r\n        // in the individual module build.gradle files\r\n    }\r\n}\r\n\r\ntasks.register(\"clean\") {\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n```\r\n\r\næ–‡å­—åˆ—ã«åŸ‹ã‚è¾¼ã‚€å ´åˆã¯`\"${å¤‰æ•°å}\"`ã§å‡ºæ¥ã¾ã™ã€‚ã“ã“ã‚‰ã¸ã‚“ã¯ã•ã™ãŒKotlin\r\n\r\n### app/build.gradle.kts ã§ä½¿ã†\r\nã•ã¦ã€ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰å‚ç…§ã™ã‚‹æ–¹æ³•ã§ã™ãŒã€`rootProject.extra`ã§å‡ºæ¥ã¾ã™ã€‚\r\n\r\n```kotlin\r\nval kotlinVersion: String by rootProject.extra\r\n\r\nplugins {\r\n    id(\"com.android.application\")\r\n    id(\"kotlin-android\")\r\n}\r\n\r\nandroid {\r\n    compileSdk = 31\r\n    buildToolsVersion = \"30.0.3\"\r\n\r\n    // çœç•¥\r\n```\r\n\r\nãã®ä»–è©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆã¯ï¼šhttps://docs.gradle.org/current/userguide/kotlin_dsl.html\r\n\r\n# ãŠã¾ã‘\r\n\r\nã›ã£ã‹ãKotlinã§`Gradle`ã‹ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚“ã ã—`Gradle Task`ã«å…¥é–€ã—ã¦ã¿ãŸã€‚  \r\n\r\n## ã©ã†ã„ã†ã“ã¨ï¼Ÿ\r\n![Imgur](https://imgur.com/sEs48Eb.png)\r\n\r\nã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†ãŒã€`build.gradle.kts`ã®ä¸€ç•ªä¸‹ã«æ›¸ã„ã¦ã‚ã‚‹å†…å®¹ãªã‚“ã ã‘ã©ã€  \r\n\r\nâ†“ã“ã‚Œ\r\n```kotlin\r\ntasks.register(\"clean\") {\r\n    println(\"run clean !!!!!\")\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã‚’è‡ªåˆ†ã§ã‹ã‘ã‚‹ã‚ˆã£ã¦è©±ã€‚ã—ã‹ã‚‚Kotlinã§ã‹ã‘ã‚‹\r\n\r\n## æ–°ã—ã„ã‚¿ã‚¹ã‚¯ã‚’ä½œæˆ\r\n\r\n```kotlin\r\ntasks.register(\"helloWorld\"){\r\n    doFirst {\r\n        println(\"Hello World\")\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§ã¯ã‚ãƒ¼ã‚ãƒ¼ã‚‹ã©ã—ã¦ãã‚Œã‚‹ã‚¿ã‚¹ã‚¯ãŒå®Œæˆã§ã™ã€‚`Sync now`ã—ã¾ã™ã‹ã£ã¦ä¸Šã®æ–¹ã«å‡ºã¦ã‚‹ã¨æ€ã†ã®ã§ã€`Sync now`ã—ã¦ã€  \r\næ—©é€Ÿå®Ÿè¡Œã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚å³ä¸Šã«ã‚ã‚‹`Gradle`ã‚’æŠ¼ã—ã¦ã€ğŸ˜ã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŠ¼ã—ã¦macOSã®Spotlightã¿ãŸã„ãªå…¥åŠ›æ¬„ãŒå‡ºãŸã‚‰ã€`gradle helloWorld`ã¨æ‰“ã¡ã¾ã™ã€‚ã“ã‚Œã§å‡ºã‚‹ã¯ãšã€‚\r\n\r\n![Imgur](https://imgur.com/D2KXZ6q.png)\r\n\r\nã“ã‚Œã§æŒ¨æ‹¶ã—ã¦ãã‚Œã‚Œã°æˆåŠŸ\r\n\r\n```\r\n> Task :helloWorld\r\nHello World\r\n```\r\n\r\n## ã‚‚ã†å°‘ã—å®Ÿç”¨çš„ãªã®ã‚’é ¼ã‚€\r\n\r\n`app/build.gradle.kts`ã§è¿½åŠ ã—ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§ã‚’`libraryList.txt`ã¨ã—ã¦æ›¸ãå‡ºã™ã‚¿ã‚¹ã‚¯ã§ã™ã€‚\r\n\r\n```kotlin\r\ntasks.register(\"exportDependency\") {\r\n    doFirst {\r\n        // ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å…ˆ\r\n        val libraryListFile = File(rootDir, \"libraryList.txt\")\r\n        libraryListFile.createNewFile()\r\n        // æ›¸ãè¾¼ã‚€æ–‡å­—åˆ—\r\n        val libraryListText = project(\"app\")\r\n            .configurations[\"implementationDependenciesMetadata\"]\r\n            .resolvedConfiguration\r\n            .firstLevelModuleDependencies\r\n            .joinToString(separator = \"\\n-----\\n\") {\r\n                \"\"\"\r\n                name = ${it.name}\r\n                version = ${it.moduleVersion}\r\n                \"\"\".trimIndent()\r\n            }\r\n        // æ›¸ãè¾¼ã‚€\r\n        libraryListFile.writeText(libraryListText) // Kotlinã®æ‹¡å¼µé–¢æ•°ã‚‚å‘¼ã¹ã‚‹ï¼ï¼Ÿ\r\n    }\r\n}\r\n```\r\n\r\nã‹ã‘ãŸã‚‰`Sync now`ã—ã¦å®Ÿè¡Œã—ã¦ã¿ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/pnfG0CG.png)\r\n\r\nå®Ÿè¡Œã™ã‚‹ã¨ã€ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºæ¥ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/kH4LTbg.png)\r\n\r\nã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸€è¦§ç”»é¢ã‚’ä½œã‚‹ã¨ãã«å½¹ã«ç«‹ã¡ãã†ã§ã™ã­ï¼\r\n\r\n# ãŠã¾ã‘ 2021/11/23\r\n`build.gradle.kts`å¾Œã«è¬ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆï¼ˆæ–‡æ³•ã¨ã‹ã¯ã‚ã£ã¦ã‚‹ã®ã«ï¼‰\r\n\r\n![Imgur](https://imgur.com/pZA4RPN.png)\r\n\r\nã¾ãšãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‰ã˜ã‚‹ã‹Android Studioè‡ªä½“ã‚’é–‰ã˜ã¾ã™ã€‚  \r\nãã®å¾Œã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆmacOSãªã‚‰ã‚ã®é¡”ã®ã‚„ã¤ã€‚Finderã ã£ã‘ï¼Ÿï¼‰ã§é–‹ã„ã¦ã€`.idea`ã‚’æ¶ˆã™ã‹ã€é©å½“ã«åå‰ã‚’å¤‰ãˆã¾ã™ã€‚  \r\n\r\nãã®ã‚ã¨å†åº¦Android Studioã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã€å®Ÿè¡Œãƒœã‚¿ãƒ³ã®è¿‘ãã«ã‚ã‚‹`Make Project`ãƒœã‚¿ãƒ³ï¼ˆCtrl+F9ï¼‰ã‚’æŠ¼ã›ã°æ²»ã‚Šã¾ã—ãŸã€‚  \r\n\r\n# ãŠã¾ã‘ 2022/01/30 è¿½è¨˜\r\nAndroid Studio Bumblebee ä»¥é™æ›¸ãæ–¹å¤‰ã‚ã£ãŸã®ã§ç½®ã„ã¦ãŠãã¾ã™\r\n\r\n## ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« build.gradle.kts\r\n\r\n```kotlin\r\nbuildscript {\r\n    val kotlinVersion: String by extra(\"1.6.10\")\r\n    val composeVersion: String by extra(\"1.1.0-rc03\")\r\n}\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nplugins {\r\n    id(\"com.android.application\").version(\"7.1.0\").apply(false)\r\n    id(\"com.android.library\").version(\"7.1.0\").apply(false)\r\n    id(\"org.jetbrains.kotlin.android\").version(\"1.6.10\").apply(false)\r\n}\r\n\r\ntasks.register(\"clean\") {\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n```\r\n\r\n## settings.gradle.kts\r\n\r\n```kotlin\r\npluginManagement {\r\n    repositories {\r\n        gradlePluginPortal()\r\n        google()\r\n        mavenCentral()\r\n    }\r\n}\r\n\r\ndependencyResolutionManagement {\r\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n        jcenter() // Warning: this repository is going to shut down soon\r\n    }\r\n}\r\n// ã“ã“ã‹ã‚‰ä¸‹ã¯å„è‡ªæ›¸ãæ›ãˆã¦\r\nrootProject.name = \"ChocoDroid\"\r\ninclude(\":app\")\r\n```\r\n\r\n\r\n# çµ‚ã‚ã‚Šã«\r\n`buildSrc`ã®è©±ã˜ã‚ƒãªãã¦ã”ã‚ã‚“ã€‚"},{"title":"å°‘ã—å‰ã®ã‚¢ãƒ—ãƒªã®æ”¹ä¿®ã‚’ã—ãŸã¨ãã®ãƒ¡ãƒ¢","link":"/posts/android_hisasiburi_dev/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚   \r\n`kotlin-android-extensions`ãŒç¾å½¹ã®é ƒã®ã‚¢ãƒ—ãƒªã§ã™ã€‚\r\n\r\n# æœ¬é¡Œ\r\nå°‘ã—å‰ã«ä½œã£ãŸã‚¢ãƒ—ãƒªã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒã¤ã„ã¦ãŸã®ã§æ”¹ä¿®ã—ã‚ˆã†ã¨ã—ãŸã¨ãã«é­é‡ã—ãŸã“ã¨ãªã©ã€‚\r\n\r\n# Android Gradle plugin requires Java 11 to run. You are currently using Java 1.8.\r\n\r\nGradleã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`7.x`ç³»ã«ã™ã‚‹ã¨è¨€ã‚ã‚Œã‚‹ã€‚\r\n\r\n`build.gradle`(appã˜ã‚ƒãªã„)ã‚’é–‹ã„ã¦ã€`com.android.tools.build:gradle:7.0.0`ã«ã—ã¦ã€`gradle-wapper.properties`ã‚‚`7.x`ç³»ã«ã™ã‚‹ã¨è¨€ã‚ã‚Œã¾ã™ã€‚ã“ã®ã‚¨ãƒ©ãƒ¼\r\n\r\n```gradle\r\nbuildscript {\r\n    ext.kotlin_version = '1.5.10'\r\n    repositories {\r\n        google()\r\n        jcenter()\r\n    }\r\n    dependencies {\r\n        // ã“ã‚Œ7.xã¸\r\n        classpath 'com.android.tools.build:gradle:7.0.0'\r\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\r\n        // NOTE: Do not place your application dependencies here; they belong\r\n        // in the individual module build.gradle files\r\n    }\r\n}\r\n```\r\n\r\n```properties\r\n#Sat Aug 07 02:47:13 JST 2021\r\ndistributionBase=GRADLE_USER_HOME\r\n#ã“ã‚Œ7.xç³»ã¸\r\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-7.0.2-bin.zip\r\ndistributionPath=wrapper/dists\r\nzipStorePath=wrapper/dists\r\nzipStoreBase=GRADLE_USER_HOME\r\n```\r\n\r\nã“ã®ã‚¨ãƒ©ãƒ¼ã®è§£æ±ºæ–¹æ³•ã§ã™ãŒã€`IDEA`ã®è¨­å®šã‚’é–‹ãã€`Build, Execution, Deployment`ã¸é€²ã¿ã€`Build Tools`ã®ä¸­ã®`Gradle`ã‚’é¸ã³ã€`Gradle JDK`ã‚’`Java 11ä»¥é™`ã«ã™ã‚Œã°ã„ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/G3obZ0x.png)\r\n\r\n# Execution failed for task ':app:kaptDebugKotlin'.\r\n\r\n```\r\nExecution failed for task ':app:kaptDebugKotlin'.\r\n> A failure occurred while executing org.jetbrains.kotlin.gradle.internal.KaptWithoutKotlincTask$KaptExecutionWorkAction\r\n   > java.lang.reflect.InvocationTargetException (no error message)\r\n```\r\n\r\nã“ã‚Œã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¸€æ—¦é–‰ã˜ã¦ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã§é–‹ã„ãŸå¾Œã€`.idea`ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¶ˆã—ã¦ã€å†åº¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã¨ãªã‚“ã‹æ²»ã‚Šã¾ã—ãŸã€‚ãªãœï¼Ÿ\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nç·Šæ€¥é€Ÿå ±ãƒ¡ãƒ¼ãƒ«ã¯SIMã‚«ãƒ¼ãƒ‰ãŒåˆºã•ã£ã¦ã„ã‚Œã°å¥‘ç´„ã®æœ‰ç„¡ã«é–¢ä¿‚ãªãå—ä¿¡å‡ºæ¥ã‚‹ã‚‰ã—ã„ã€‚"},{"title":"Jetpack Composeã‚’æ—¢å­˜ã‚¢ãƒ—ãƒªã¸å°å…¥","link":"/posts/android_jc/","markdown":"\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚ãƒ‹ã‚³ç”Ÿã§CLANNADä¸€æŒ™è¦‹ã¦ã¾ã™ã€‚  \næœ¬ç·¨ã§æµã‚Œã¦ã‚‹BGMã™ãã™ã\n\n# å‰æ\n- `Kotlin Android Extensions`ã¯ä½¿ãˆãªã„æ¨¡æ§˜ã€‚`ViewBinding`ã¸ä¹—ã‚Šæ›ãˆã¦ã€‚  \n\n# ç’°å¢ƒ\n\n| ãªã¾ãˆ           | ã‚ãŸã„                                          |\n|------------------|-------------------------------------------------|\n| `Android Studio` | `Android Studio Arctic Fox \\ 2020.3.1 Canary 3` |\n| minSdkVersion    | 21                                              |\n\n\n# é­é‡ã—ãŸå•é¡Œ 2021/01/03 ç¾åœ¨\n\n- Android 5ã§ãƒªã‚½ãƒ¼ã‚¹ãŒè¦‹ã¤ã‹ã‚‰ãªã„ã‚¨ãƒ©ãƒ¼ã§ã‚¯ãƒ©ãƒƒã‚·ãƒ¥\nä»Šã¾ã§ã®æ–¹æ³•ã§Drawableã‚’å–å¾—ã—ã¦Bitmapã¸å¤‰æ›ã—ã¦Composeã§æ‰±ãˆã‚‹Bitmapã¸å¤‰æ›ã™ã‚Œã°å–ã‚Œã‚‹ã€‚\n\n```kotlin\nval icon = AmbientContext.current.getDrawable(R.drawable.android)?.toBitmap()?.asImageBitmap()\nif (icon != null) {\n    Icon(\n        modifier = Modifier.padding(5.dp),\n        bitmap = icon\n    )\n}\n```\n\n- ~~`ScrollableRow`ã§`AndroidView`ãŒãšã‚Œã‚‹~~ **Beta03ã§ä¿®æ­£ã•ã‚Œã¾ã—ãŸã€‚**\n    - Android 7ä»¥å‰ã§è¦³æ¸¬\n    - ~~ç›´ã—æ–¹ã¯ã‚ã‹ã‚‰ã‚“~~**Beta03ã«ä¸Šã’ã‚Œã°ãŠï½‹(Kotlinã¯1.4.31)**\n\n- ãã‚‚ãã‚‚Android Studioã§JDKã®ãƒ‘ã‚¹ãŒé–“é•ã£ã¦ã‚‹ã¨ã‹è¨€ã‚ã‚Œã¦ãƒ“ãƒ«ãƒ‰ã¾ã§é€²ã‚ãªã„\n    - `.idea`ã‚’æ¶ˆã—ã¦ã¿ã‚‹(ã‹é©å½“ã«åå‰ã‚’å¤‰ãˆã‚‹)ã¨ç›´ã‚Šã¾ã—ãŸã€‚\n\n\n# æ—¢å­˜ã‚¢ãƒ—ãƒªã¸å°å…¥\n\nå‰²ã¨é »ç¹ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå…¥ã‚‹ã®ã§ã€[ã“ã£ã¡ã‚‚è¦‹ã¦](/posts/android_jc_recipe/)\n\n## AGPã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ\nå¿…è¦ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€ãŸã—ã‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã„ã˜ã£ã¦ã‚‹ã¨ãã‚‚AGPã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãªã‚“ã¨ã‹ã¿ãŸã„ãªæ„Ÿã˜ã§ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸè¨˜æ†¶ãŒã‚ã‚‹ã®ã§æ›´æ–°ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚  \nå®¶ã®Wi-Fié…ãã¦ã¤ã‚‰ã„  \n\nå¤šåˆ†å³ä¸‹ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ï¼Ÿã¿ãŸã„ãªé€šçŸ¥ãŒå‡ºã¦ã‚‹ã¨æ€ã†ã®ã§ãã“ã‹ã‚‰\n\n![Imgur](https://imgur.com/PzEdNV0.png)\n\n## Kotlinã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ\n`app`ãƒ•ã‚©ãƒ«ãƒ€ã˜ã‚ƒãªã„æ–¹ã®`build.gradle`ã‚’é–‹ã„ã¦ã€æ›¸ãæ›ãˆã¦ã„ãã¾ã™ã€‚\n\n```java\nbuildscript {\n    ext.kotlin_version = '1.4.21'\n    repositories {\n        google()\n        jcenter()\n        \n    }\n    dependencies {\n        classpath 'com.android.tools.build:gradle:7.0.0-alpha03'\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version\"\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n```\n\n`ext.kotlin_version`ã‚’`1.4.21`ã¸å¤‰ãˆã¾ã™ã€‚  \n`classpath 'com.android.tools.build:gradle:7.0.0-alpha03'`ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹ã¨ãã†ãªã‚‹ã¨æ€ã†ã€‚\n\n### app/build.gradle\n`app`ãƒ•ã‚©ãƒ«ãƒ€ã®æ–¹ã®`build.gradle`ã‚’é–‹ã„ã¦ã€å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚  \nä»¥ä¸‹ã¯ä¸€ä¾‹ã§ã™ã€‚\n\n```java\napply plugin: 'com.android.application'\n\napply plugin: 'kotlin-android'\n\n// apply plugin: 'kotlin-android-extensions' ã•ã‚ˆãªã‚‰\n\napply plugin: 'kotlin-kapt' // Roomä½¿ã†ã¨ãã®ãªã«ã‹ã€‚ä¸€ç•ªä¸Šã«\n\nandroid {\n\n    compileSdkVersion 30\n    defaultConfig {\n        applicationId \"io.github.takusan23.tatimidroid\"\n        minSdkVersion 22\n        targetSdkVersion 30\n        versionCode 78\n        versionName \"12.2.1\"\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n    buildTypes {\n        release {\n            minifyEnabled false\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\n        }\n    }\n\n    // Kotlinã‚’æ›¸ããã£ã‹ã‘ã«ãªã£ãŸ Kotlin Android Extensions ãŒã„ã‚ˆã„ã‚ˆéæ¨å¥¨ã«ãªã£ã¦ã—ã¾ã£ãŸ\n    // ã®ã§ViewBindingã«ä¹—ã‚Šæ›ãˆã‚‹\n    buildFeatures {\n        // ViewBindingæœ‰åŠ¹\n        viewBinding true\n        // Jetpack Composeæœ‰åŠ¹\n        compose true\n    }\n\n    compileOptions {\n        targetCompatibility 1.8\n        sourceCompatibility 1.8\n    }\n\n    kotlinOptions {\n        jvmTarget = '1.8'\n        useIR = true\n    }\n\n    composeOptions {\n        kotlinCompilerVersion kotlin_version // 1.4.21ãŒå…¥ã‚‹ã¨æ€ã†\n        kotlinCompilerExtensionVersion '1.0.0-alpha09'\n    }\n}\n\ndependencies {\n    implementation fileTree(dir: 'libs', include: ['*.jar'])\n\n    // Jetpack Compose --- ã“ã“ã‹ã‚‰\n\n    implementation 'androidx.compose.ui:ui:1.0.0-alpha09'\n    // Tooling support (Previews, etc.)\n    implementation 'androidx.compose.ui:ui-tooling:1.0.0-alpha09'\n    // Foundation (Border, Background, Box, Image, Scroll, shapes, animations, etc.)\n    implementation 'androidx.compose.foundation:foundation:1.0.0-alpha09'\n    // Material Design\n    implementation 'androidx.compose.material:material:1.0.0-alpha09'\n    // Material design icons\n    implementation 'androidx.compose.material:material-icons-core:1.0.0-alpha09'\n    implementation 'androidx.compose.material:material-icons-extended:1.0.0-alpha09'\n    // Integration with observables\n    implementation 'androidx.compose.runtime:runtime-livedata:1.0.0-alpha09'\n\n    // Jetpack Compose --- ã“ã“ã¾ã§\n\n}\n```\n\n`buildFeatures`ã¨ã‹`kotlinOptions`ã€`composeOptions`ã¨  \n`dependencies`ã«æ›¸ãè¶³ã™æ„Ÿã˜ã§ã™ã‹ã­\n\nã§ããŸã‚‰`Sync`ã—ã¦`Build`ã—ã¾ã™ã€‚\n\n# Jetpack Compose ã‚’è©¦ã™\n\né©å½“ã«ã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦æ›¸ã„ã¦ã„ãã¾ã™ã€‚\n\n```kotlin\n/**\n * Jetpack Compose ç•¥ã—ã¦JC\n * */\n\n@Composable\nfun VideoInfoCard() {\n    Card(modifier = Modifier.padding(10.dp)) {\n        Text(text = \"Hello World\")\n    }\n}\n\n@Preview\n@Composable\nfun PreviewVideoInfoCard() {\n    VideoInfoCard()\n}\n```\n\n`@Preview`ã‚’ã¤ã‘ã‚‹ã“ã¨ã§éš£ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚`@Preview`ã‚’ä»˜ã‘ãŸé–¢æ•°ã«ã¯å¼•æ•°ã‚’è¨­å®šã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚\n\n## Activityã«ç½®ã\n\nsetContentView()ã®ä»£ã‚ã‚Šã«`setContent { }`ã‚’ç½®ã„ã¦ãã®ä¸­ã«ã•ã£ãæ›¸ã„ãŸ`VideoInfoCard()`ã‚’æ›¸ãã¾ã—ã‚‡ã†\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            VideoInfoCard()\n        }\n    }\n}\n```\n\nä»–ã«ã‚‚`@Preview`ã®ã¤ã„ãŸé–¢æ•°ã®ã¨ã“ã‚ã§å®Ÿæ©Ÿãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒä½¿ãˆã¾ã™ãŒã€  \nç§ã®ç’°å¢ƒã§ã¯ã†ã¾ãå‹•ã‹ãªã‹ã£ãŸã®ã§`Activity`ã«ç½®ã„ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚\n\n## Modifierã«ã¤ã„ã¦\nã‚ˆãç™»å ´ã™ã‚‹`Modifier`ã€å¤šåˆ†ã™ã¹ã¦ã®`Compose`ã§å…±é€šã™ã‚‹`height`ã¨ã‹`width`ã¨ã‹`padding`ã¨ã‹ã‚’è¨­å®šã™ã‚‹ã¨ãã«ä½¿ã†ã€‚  \nxmlã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆçµ„ã‚“ã§ãŸã¨ãã‚‚å…±é€šã§ä½¿ãˆãŸå±æ€§ã‚ã£ãŸã‹ã‚‰å¤šåˆ†ãã‚“ãªã‚„ã¤  \n\né€£çµã—ã¦è¨­å®šã—ã¦ã„ãã¾ã™\n\n```kotlin\nImage(\n    imageVector = Icons.Outlined.Book,\n    modifier = Modifier.height(50.dp).width(50.dp),\n)\n```\n\n# ãƒ¬ã‚·ãƒ”é›†\nJetpack ComposeãŒæµè¡Œã‚‹ã¨é¡˜ã£ã¦  \næ‰‹ã‚’å‹•ã‹ãã†\n\n## ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹\n`var count by remember { mutableStateOf(0) }`ã‚’ä½¿ã†ã“ã¨ã§ã‚«ã‚¦ãƒ³ãƒˆå€¤ã‚’ä¿æŒã§ãã¾ã™ã€‚  \n`var count = 0`ã¯å‹•ãã¾ã›ã‚“ã§ã—ãŸã€‚\n\n```kotlin\n\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            TestCompose()\n        }\n    }\n}\n\n@Composable\nfun TestCompose() {\n    // æŠ¼ã—ãŸå›æ•°ã‚’ä¿æŒã™ã‚‹\n    var count by remember { mutableStateOf(0) }\n\n    Column(\n        modifier = Modifier.padding(10.dp), // ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿\n        horizontalAlignment = Alignment.CenterHorizontally, // çœŸã‚“ä¸­ã«ã™ã‚‹\n    ) {\n        Text(\n            text = \"æŠ¼ã—ãŸå›æ•° $count\",\n        )\n        Button(\n            onClick = {\n                // ãŠã—ãŸã¨ã\n                count += 1\n            },\n            colors = ButtonDefaults.textButtonColors(backgroundColor = Color.White)\n        ) {\n            Text(text = \"ã“ã“ã‚’ãŠã›ï¼\")\n        }\n    }\n}\n\n@Preview\n@Composable\nfun TestComposePreview() {\n    TestCompose()\n}\n```\n\nå®Ÿè¡Œçµæœ\n\n![Imgur](https://imgur.com/MHExL7O.png)\n\n\n## å¥½ããªUIã«ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç½®ããŸã„ï¼ˆ`Button { }`ä»¥å¤–ã§æŠ¼ã›ã‚‹ã‚ˆã†ã«ã—ãŸã„ï¼‰\nModifierã«ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‚„ã¤ãŒã‚ã‚Šã¾ã™ã€‚`Ripple`ï¼ˆæ³¢ã¿ãŸã„ãªã‚„ã¤ï¼‰ã‚‚ã§ãã¾ã™ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            ClickableCompose()\n        }\n    }\n}\n\n@Composable\nfun ClickableCompose() {\n    // æŠ¼ã—ãŸå›æ•°ã‚’ä¿æŒã™ã‚‹\n    var count by remember { mutableStateOf(0) }\n    Row(\n        verticalAlignment = Alignment.CenterVertically,\n        modifier = Modifier\n            .width(150.dp)\n            .height(100.dp)\n            .clickable(\n                onClick = { count++ },\n                indication = rememberRipple(color = Color.Blue),\n                interactionSource = remember { MutableInteractionSource() },\n            )\n    ) {\n        Text(text = \"ãŠã›ã¾ã™ã‚ˆï½ $count\")\n        Image(imageVector = Icons.Outlined.Add)\n    }\n}\n```\nå®Ÿè¡Œçµæœ\n\n![Imgur](https://imgur.com/dHQELFC.png)\n\n## ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¡¨ç¤º + æŠ¼ã›ã‚‹ã‚ˆã†ã«ã™ã‚‹\n\nä»Šã¾ã§ã€ãƒãƒ†ãƒªã‚¢ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ã†éš›ã¯`Asset Studio`ã‹ã‚‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’æŒã£ã¦ãã‚‹ã¨æ€ã†ã‚“ã§ã™ãŒã€  \n\n![Imgur](https://imgur.com/QEgIZ6J.png)\n\nãªã‚“ã¨ï¼`Jetpack Compose`ã‚’ä½¿ã†ã“ã¨ã§ã‚³ãƒ¼ãƒ‰ä¸€è¡Œã§ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”¨æ„ã§ãã¾ã™ã€‚`Outlined`ä»¥å¤–ã‚‚ç”¨æ„ã§ãã¾ã™ã€‚\n\n```kotlin\nIcon(imageVector = Icons.Outlined.Android)\n```\n\n```kotlin\n\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            TestCompose()\n        }\n    }\n}\n\n@Composable\nfun TestCompose() {\n    // æŠ¼ã—ãŸå›æ•°ã‚’ä¿æŒã™ã‚‹\n    var count by remember { mutableStateOf(0) }\n\n    Row(\n        modifier = Modifier.padding(10.dp), // ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿\n        verticalAlignment = Alignment.CenterVertically, // ã¾ã‚“ãªã‹ã«\n    ) {\n        Text(\n            text = \"æŠ¼ã—ãŸå›æ•° $count\",\n        )\n        IconButton(onClick = {\n            // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—\n            count++\n        }) {\n            Icon(imageVector = Icons.Outlined.Home)\n        }\n    }\n}\n\n@Preview\n@Composable\nfun TestComposePreview() {\n    TestCompose()\n}\n```\n\nå®Ÿè¡Œçµæœ\n\n![Imgur](https://imgur.com/srZwt5e.png)\n\n## å‹•ç”»èª¬æ˜æ–‡è¦‹ãˆéš ã‚Œã™ã‚‹ã‚„ã¤\n\n```kotlin\n\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            VideoInfo()\n        }\n    }\n}\n\n@Composable\nfun VideoInfo() {\n    // è¡¨ç¤ºã™ã‚‹ã‹\n    var isShow by remember { mutableStateOf(false) }\n    Card(\n        modifier = Modifier.padding(10.dp)\n    ) {\n        Column(modifier = Modifier.padding(10.dp)) {\n            Row {\n                Text(text = \"å‹•ç”»ã‚¿ã‚¤ãƒˆãƒ«\", modifier = Modifier.weight(1f)) // ã‚¢ã‚¤ã‚³ãƒ³ã¾ã§ãšã£ã¨ä¼¸ã°ã™\n                IconButton(onClick = {\n                    isShow = !isShow\n                }) {\n                    // ã‚¢ã‚¤ã‚³ãƒ³ã‚‚å¤‰æ›´\n                    Icon(imageVector = if (isShow) Icons.Outlined.ExpandLess else Icons.Outlined.ExpandMore)\n                }\n            }\n\n            // è¡¨ç¤ºã™ã‚‹ã‹\n            if (isShow) {\n                Text(\n                    text = \"\"\"\n                    ãƒ‹ã‚³å‹•ã«ã‚‚ã‚µãƒ ãƒç™»éŒ²æ©Ÿèƒ½ã¤ã„ã¦ã‹ã‚‰æœ€å¾Œä¸€ç¬ã ã‘ã‚µãƒ ãƒç”¨ã®ç”»åƒã‚’è¡¨ç¤ºã•ã›ã‚‹ã‚„ã¤ã‚‚è¦‹ãªããªã‚Šã¾ã—ãŸã­ã€‚\n                    \"\"\".trimIndent()\n                )\n            }\n\n        }\n    }\n}\n```\n\nå®Ÿè¡Œçµæœ\n\n![Imgur](https://imgur.com/wwflXdr.png)\n\n## ãƒªã‚¹ãƒˆè¡¨ç¤º\n\n`RecyclerView`ã¿ãŸã„ã«ç”»é¢å¤–ã¯è¡¨ç¤ºã—ãªã„`LazyColumn`ã£ã¦ã®ãŒã‚ã‚Šã¾ã™ã®ã§ã“ã‚Œã‚’ä½¿ã£ã¦ã„ãã¾ã™\n\nã¾ãšRecyclerViewã®Adapterã¿ãŸã„ã«ä¸€ã¤ã ã‘ã®ã‚„ã¤ã‚’ç”¨æ„ã—ã¾ã™ã€‚\n\n```kotlin\n@Composable\nfun BlogCard(blogTitle: String) {\n    // æŠ¼ã—ãŸå›æ•°ã‚’ä¿æŒã™ã‚‹\n    var count by remember { mutableStateOf(0) }\n\n    Card(\n        modifier = Modifier.padding(10.dp),\n        elevation = 10.dp\n    ) {\n        Column(\n            modifier = Modifier.padding(10.dp), // ã‚¹ãƒšãƒ¼ã‚¹ç¢ºä¿\n            verticalArrangement = Arrangement.Center, // ã¾ã‚“ãªã‹ã«\n        ) {\n            Row(\n                verticalAlignment = Alignment.CenterVertically\n            ) {\n                Image(\n                    imageVector = Icons.Outlined.Book,\n                    modifier = Modifier.height(50.dp).width(50.dp),\n                )\n                Text(\n                    text = blogTitle,\n                    modifier = Modifier.weight(1f)\n                )\n            }\n            Divider(modifier = Modifier.padding(0.dp, 10.dp, 0.dp, 0.dp)) // åŒºåˆ‡ã‚Šç·š\n            IconButton(onClick = {\n                // ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—\n                count++\n            }) {\n                Row(\n                    verticalAlignment = Alignment.CenterVertically\n                ) {\n                    Icon(imageVector = Icons.Outlined.FavoriteBorder)\n                    Text(text = \"$count\")\n                }\n            }\n        }\n    }\n}\n```\n\n\nãã—ãŸã‚‰ä¸€è¦§è¡¨ç¤ºã‚’ä½œã£ã¦å®Œæˆ\n\n```kotlin\n\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            BlogCardList()\n        }\n    }\n}\n\n@Composable\nfun BlogCardList() {\n    val blogList = listOf(\n        \"Jetpack Compose ç•¥ã—ã¦ï¼Ÿ\",\n        \"MotionLayoutã§ãƒŸãƒ‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼\",\n        \"2020å¹´ãŠã™ã™ã‚ãƒœã‚«ãƒ­\",\n        \"ãƒœã‚«ãƒ­ãƒãƒ©ãƒ¼ãƒ‰ã„ã„ã‚ˆã­\",\n    )\n    Surface(Modifier.fillMaxSize()) {\n        LazyColumn(content = {\n            items(blogList) {\n                BlogCard(it)\n            }\n        })\n    }\n}\n\n@Preview\n@Composable\nfun TestComposePreview() {\n    BlogCardList()\n}\n```\n\nã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¨æ€ã†ã€‚`RecyclerView`ã‚ˆã‚Šä¸€è¦§è¡¨ç¤ºãŒã‹ã‚“ãŸã‚“ã§å¬‰ã—ã„ã€‚  \n(Vue.jsã®`v-for`ã¿ãŸã„ã§ä½¿ã„ã‚„ã™ã„)\n\n![Imgur](https://imgur.com/gh2VjIL.png)\n\n# Fragment ã«è¨­ç½®ã™ã‚‹\n\nã¨ã‚Šã‚ãˆãšä¸€ã¤ã«Fragmentã‹ã‚‰Jetpack Composeä½¿ã£ã¦ã¿ã‚ˆã†ã‹ãªã£ã¦ã€‚ãã‚“ãªæ–¹ã«\n\n## ä»Šï¼ˆ2020/12/30ç¾åœ¨ï¼‰ã ã‘ï¼Ÿ\nFragmentã‚’ä½œã‚‹ã«ã¯Fragmentã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã‚ã’ãªã„ã¨ã€`prepareCall`ã¨ã‹è¨€ã†è¬ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æ›¸ã‹ãªã„ã¨ã„ã‘ãªããªã‚Šã¾ã™ï¼ˆæ­£ä½“ä¸æ˜ï¼‰  \n`app`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹`build.gradle`ã‚’é–‹ã„ã¦`dependencies`ã«æ›¸ãè¶³ã—ã¾ã™\n\n```java\ndependencies {\n    // Fragmentã‚’ä½œã‚ã†ã¨ã™ã‚‹ã¨è¬ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã•ã›ã‚ˆã†ã¨ã™ã‚‹ã®ã§\n    implementation 'androidx.fragment:fragment-ktx:1.3.0-rc01'\n}\n```\n\nãã—ãŸã‚‰`BlogListFragment.kt`ã‚’ä½œæˆã—ã¦ã‚³ãƒ”ãƒš\n\n```kotlin\nclass BlogListFragment : Fragment() {\n    override fun onCreateView(inflater: LayoutInflater, container: ViewGroup?, savedInstanceState: Bundle?): View? {\n        return ComposeView(requireContext()).apply {\n            setContent {\n                MaterialTheme {\n                    Scaffold(\n                        topBar = {\n                            TopAppBar() {\n                                Column(\n                                    horizontalAlignment = Alignment.CenterHorizontally,\n                                    verticalArrangement = Arrangement.Center,\n                                    modifier = Modifier.fillMaxHeight().padding(10.dp),\n                                ) {\n                                    Text(text = \"ãƒ–ãƒ­ã‚°ä¸€è¦§\")\n                                }\n                            }\n                        }\n                    ) {\n                        BlogCardList()\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\n`BlogCardList()`ã©ã“ã‹ã‚‰å‡ºã¦ããŸã‚“ã ã£ã¦è©±ã§ã™ãŒã€`MainActivity.kt`ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã—ãŸã€‚  \næœ¬æ¥ã¯Composeã®UIç”¨ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã™ã¹ãã§ã™ã€‚  \n\nã‚ã¨`BlogCardList()`é–¢æ•°ï¼Ÿãƒ¡ã‚½ãƒƒãƒ‰ï¼Ÿã¯ã©ã“ã®ã‚¯ãƒ©ã‚¹ã«ã‚‚æ‰€å±ã—ã¦ã„ãªã„ï¼ˆclass { } ã®ä¸­ã«æ›¸ã„ã¦ãªã„ï¼‰  \n**ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«é–¢æ•°**ã£ã¦ã‚„ã¤ãªã®ã§ã€ã©ã“ã§ã‚‚ã‹ã‘ã¾ã™ï¼Ÿã€‚æ³¨æ„ç‚¹ã§ã™ãŒ**åå‰ãŒã‹ã¶ã‚‹**ã¨ã‚¨ãƒ©ãƒ¼ã«ãªã‚Šã¾ã™ã€‚\n\nå¾Œã¯Activityã«ç½®ãã¾ã—ã‚‡ã†ã€‚ä»Šã¾ã§ã®XMLãªæ„Ÿã˜ã§  \nã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã§ã¯xmlä½¿ã‚ãš(R.layout.activity_main)ã€å‹•çš„ã«FrameLayoutã‚’ç½®ã„ã¦ã¾ã™ãŒåˆ¥ã«XMLã§FrameLayoutç½®ã„ã¦idè¨­å®šã—ã¦ã‚‚ã„ã„ã§ã™ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n\n        // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆä½œã‚‹ã®ã‚ã‚“ã©ã„ã®ã§å‹•çš„ã«ä½œã‚‹ã€‚åˆ¥ã«XMLã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆç½®ã„ã¦ã‚‚ã„ã„\n        val fragmentHostLayout = FrameLayout(this)\n        fragmentHostLayout.id = View.generateViewId()\n        setContentView(fragmentHostLayout)\n\n        supportFragmentManager.beginTransaction().replace(fragmentHostLayout.id, BlogListFragment()).commit()\n\n    }\n}\n```\n\nã¡ãªã¿ã«`Navigation`ã¯ä½¿ã£ãŸã“ã¨ãŒãªã„ã§ã™ã€‚`argument`æ¸¡ã™ã®ãŒæ¥½ã«ãªã‚‹ã¨ã‹ãªã‚“ã¨ã‹\n\n## çœŸã‚“ä¸­ã«è¡¨ç¤ºã•ã›ãŸã„\nä¸€ç•ªå®Ÿç”¨æ€§ãŒã‚ã‚Šãã†\n\n### Rowï¼ˆæ¨ªä¸¦ã³ç·¨ï¼‰\n\næ³¨æ„ç‚¹ã¨ã—ã¦ã¯`verticalAlignment`ã¨`horizontalArrangement`ã§æŒ‡å®šã—ã¦ã„ã‚‹å€¤ã®ã‚¹ãƒšãƒ«ãŒè‹¥å¹²ä¼¼ã¦ã‚‹ã£ã¦ã“ã¨ã§ã™ã‹ã­ã€‚\n\n| ãªã¾ãˆ                | ã‚ãŸã„                         |\n|-----------------------|--------------------------------|\n| verticalAlignment     | **Alignment**.CenterVertically |\n| horizontalArrangement | **Arrangement**.Center         |\n\n### Columnï¼ˆç¸¦ä¸¦ã³ç·¨ï¼‰\n`Row`ã¨ã¯é€†ã«ãªã‚Šã¾ã™ã€‚\n\n| ãªã¾ãˆ              | ã‚ãŸã„                           |\n|---------------------|----------------------------------|\n| verticalArrangement | **Arrangement**.Center           |\n| horizontalAlignment | **Alignment**.CenterHorizontally |\n\nä»¥ä¸‹ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰\n\n```kotlin\n\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    setContent {\n        CardCenterText()\n    }\n}\n\n@Composable\nfun CardCenterText() {\n    Column {\n        Card(\n            modifier = Modifier.padding(10.dp).fillMaxWidth().height(100.dp),\n            backgroundColor = Color.Cyan,\n        ) {\n            Row(\n                horizontalArrangement = Arrangement.Center,\n                verticalAlignment = Alignment.CenterVertically,\n            ) {\n                Text(text = \"ã¾ã‚“ãªã‹ã«å±…åº§ã‚‹ Row\")\n                Icon(imageVector = Icons.Outlined.Android)\n            }\n        }\n        Card(\n            modifier = Modifier.padding(10.dp).fillMaxWidth().height(100.dp),\n            backgroundColor = Color.Cyan,\n        ) {\n            Column(\n                verticalArrangement = Arrangement.Center,\n                horizontalAlignment = Alignment.CenterHorizontally,\n            ) {\n                Text(text = \"ã¾ã‚“ãªã‹ã«å±…åº§ã‚‹ Column\")\n                Icon(imageVector = Icons.Outlined.Android)\n            }\n        }\n    }\n}\n```\n\nã“ã‚“ãªæ„Ÿã˜\n\n![Imgur](https://imgur.com/ejw6EYv.png)\n\n\n# é­é‡ã—ãŸã‚¨ãƒ©ãƒ¼\n\n## R.jar: ãƒ—ãƒ­ã‚»ã‚¹ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã›ã‚“ã€‚åˆ¥ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒä½¿ç”¨ä¸­ã§ã™ã€‚\n\n`@Preview`ã‹ã‚‰å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨å¤±æ•—ã™ã‚‹ã€‚ã®ã§ã€`Activityã¨ã‹Fragment`ã«ç½®ã„ã¦ã„ã¤ã‚‚ã©ãŠã‚Šå®Ÿè¡Œã—ãŸã»ã†ãŒã„ã„ã€‚ã¦ã‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚ˆã‚Šæ—©ããªã„ï¼Ÿ\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            VideoInfo()\n        }\n    }\n}\n```\n\nã©ã†ã—ã¦ã‚‚`@Preview`ã‹ã‚‰å®Ÿè¡Œã—ãŸã‘ã‚Œã°\n\n`Make Project`ã—ãŸå¾Œã«å®Ÿè¡Œã•ã›ã‚‹ã¨ã†ã¾ãã„ãï¼Ÿ\n\n![Imgur](https://imgur.com/QwiEqH5.png)\n\n## Type 'TypeVariable(T)' has no method 'getValue(Nothing?, KProperty<*>)' and thus it cannot serve as a delegate\n\n### by remember { } ã˜ã‚ƒãªã„ã‚‚ã†ä¸€ã¤ã®æ–¹æ³•\n\n```kotlin\n// ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãƒ‡ãƒªã‚²ãƒ¼ãƒˆ ã¨ã‹è¨€ã†æ›¸ãæ–¹\nvar selectTabIndex_ by remember { mutableStateOf(0) }\n// ã‚¢ã‚¯ã‚»ã‚¹\nselectTabIndex_ = 0\n\n// å‰²ã‚Šå½“ã¦æ¼”ç®—å­\nvar selectTabIndex = remember { mutableStateOf(0) }\nselectTabIndex.value = 0\n```\n\nä¸Šã‚‚ä¸‹ã‚‚åŒã˜ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ã ã‚ãªå ´åˆã¯ä¸‹ã®æ–¹ã‚’è©¦ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã‚¢ã‚¯ã‚»ã‚¹ã®éš›ã«`value`ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ãŒ\n\n\n### else\n\nãªã‚“ã‹ã‚³ãƒ”ãƒšã—ç›´ã—ãŸã‚‰æ²»ã£ãŸã€‚ä¸€å¿œä½¿ã£ã¦ã‚‹`import`æ›¸ã„ã¦ãŠãã¾ã™ã­\n\n```kotlin\nimport android.os.Bundle\nimport androidx.appcompat.app.AppCompatActivity\nimport androidx.compose.foundation.Image\nimport androidx.compose.foundation.layout.*\nimport androidx.compose.foundation.lazy.LazyColumn\nimport androidx.compose.material.*\nimport androidx.compose.material.icons.Icons\nimport androidx.compose.material.icons.outlined.Book\nimport androidx.compose.material.icons.outlined.FavoriteBorder\nimport androidx.compose.runtime.*\nimport androidx.compose.ui.Alignment\nimport androidx.compose.ui.Modifier\nimport androidx.compose.ui.platform.setContent\nimport androidx.compose.ui.tooling.preview.Preview\nimport androidx.compose.ui.unit.dp\n```\n\n## Caused by: java.lang.ClassNotFoundException: Composable Method ~\n\n`@Preview`ã®ã¤ã„ãŸé–¢æ•°ã‚’æ¶ˆã—ã¦ãã®ã¾ã¾å®Ÿè¡Œã™ã‚‹ã¨å‡ºã‚‹ã€‚åˆ‡ã‚Šæ›¿ãˆã¦ã‚ã’ã‚ˆã†\n\n![Imgur](https://imgur.com/VXetpSK.png)\n\n\n## java.lang.NoSuchMethodError: No static method ~\n\né–¢æ•°æœ‰ã‚‹ã®ã«ç„¡ã„ã¨ã‹è¨€ã£ã¦ãã‚‹ã‚„ã¤ã€‚\n\nãƒ„ãƒ¼ãƒ«ãƒãƒ¼ã®`Build`ã‹ã‚‰`Clean Project`ã‚’å®Ÿè¡Œã—ãŸå¾Œã«å†åº¦å®Ÿè¡Œã™ã‚‹ã¨ç›´ã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ãª\n\n![Imgur](https://imgur.com/O8goR2b.png)\n\n## ãªã‚“ã‹çœŸã£èµ¤ã«ãªã£ãŸã€‚Importã—ã¦ã‚‚ãªã‚“ã‹åˆ¥ãªã®ãŒImportã•ã‚Œã‚‹ã‚“ã ã‘ã©ï¼Ÿ\n\n`Sync Project`ã—ãŸã‚‰ãªã‚“ã‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã›ã‚“ã‹ï¼Ÿ(Android Gradle Pluginã ã¨æ€ã‚ã‚Œ)ã£ã¦èã‹ã‚ŒãŸã®ã§ã‚¢ãƒ—ãƒ‡ã—ãŸã‚‰ãªã‚“ã‹æ²»ã£ãŸã€‚é›£ã—ã„ã­\n\n![Imgur](https://imgur.com/ZSiRS9T.png)\n\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\n`Android Studio Arctic Fox | 2020.3.1 Canary 3`ã§å‹•ä½œç¢ºèªæ¸ˆã§ã™ã€‚  \nã¨ã‚Šã‚ãˆãšãƒ–ãƒ­ã‚°ä¸€è¦§ã‚’è¡¨ç¤ºã•ã›ãŸçŠ¶æ…‹ã®ç”»é¢ãŒé–‹ãã‚ˆã†ã«ãªã£ã¦ã‚‹ã¯ãšã§ã™ã€‚\n\nhttps://github.com/takusan23/BlogListCompose\n\n# çµ‚ã‚ã‚Šã«\n- CPUã¨ã‹ãƒ¡ãƒ¢ãƒªã¨ã‹ã®ãƒªã‚½ãƒ¼ã‚¹ãã£ã£ã£ãæŒã£ã¦ã„ããªã“ã„ã¤ã€‚ãƒ¡ãƒ¢ãƒªã‚‚16GBã‚ã‚‹ã®ã«ç„¡ããªã‚Šãã†()  \n- ã‚ã¨ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¾ã ä¸ååˆ†æ„Ÿã€‚ãªã‚“ã‹ãšã‚ŒãŸã‚Šã™ã‚‹ã—ã€‚\n    - Activityã«ç½®ã„ã¦æ™®é€šã«å®Ÿè¡Œã—ãŸã»ã†ãŒ(ç§ã¯)ã¯ã‚„ã‹ã£ãŸ\n- ã‚¢ã‚¤ã‚³ãƒ³ãŒã™ã§ã«ç”¨æ„ã•ã‚Œã¦ã„ã‚‹ã®ã¯å¬‰ã—ã„ã€‚å–ã‚Šè¾¼ã‚€ä½œæ¥­ãŒãªããªã£ãŸ\n    - ãŸã Android Studioã®Drawableè¡¨ç¤ºæ©Ÿèƒ½ãŒä¾¿åˆ©ã ã£ãŸã®ã§ã¡ã‚‡ã£ã¨ã¤ã‚‰ã„\n\nã‚ã¨`margin`ã£ã¦ãªã„ã®ã‹ãªã€‚è¦‹ã¤ã‘ã‚‰ã‚Œãªã‹ã£ãŸã‚“ã ã‘ã©  \n"},{"title":"Jetpack Composeã§çœŸã‚“ä¸­ã«ã™ã‚‹","link":"/posts/android_jc_center/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã‚†ã³ã•ãã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³ã€æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\n\r\n![Imgur](https://imgur.com/LAo5lKO.png)\r\n\r\nã“ã®å­ã‹ã‚ã„ã„ï¼ˆãŠé…’ã®è©±åˆ†ã‹ã‚‰ã‚“ã‹ã£ãŸã‘ã©ï¼‰\r\n\r\nã‚ã¨ãƒ’ãƒ­ã‚¤ãƒ³ã‚«ã‚¹ã‚¿ãƒ ãƒ‘ãƒƒãƒã‚’å¤æ­©ã¡ã‚ƒã‚“ã«ã—ãŸã¨ãã®ã‚¯ã‚¤ãƒƒã‚¯ãƒ­ãƒ¼ãƒ‰ã®éŸ³å£°å¯æ„›ã‹ã£ãŸ\r\n\r\n# æœ¬é¡Œ\r\nJetpack Composeã§`gravity=\"center\"`ã™ã‚‹æ–¹æ³•ã§ã™  \r\nä»Šæ›´ãªãŒã‚‰ãƒ¡ãƒ¢\r\n\r\n# ãã®å‰ã«\r\n`Android Studio`ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆï¼Ÿã‹ã‚‰`Empty Compose`ã‚’é¸æŠã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã™ã‚‹ã¨ã€å®Ÿè¡Œã§ãã¾ã›ã‚“ã€‚  \r\n`Jetpack Compose`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`1.0.0-rc01`ã¸ã€`Kotlin`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`1.5.10`ã¸è¨­å®šã—ã¦ãã ã•ã„ã€‚\r\n\r\n(appãƒ•ã‚©ãƒ«ãƒ€ã§ã¯ãªã„æ–¹ã®`build.gradle`)\r\n\r\n```gradle\r\nbuildscript {\r\n    ext {\r\n        compose_version = '1.0.0-rc01' // ã“ã“ã‚’1.0.0-rc01ã¸\r\n    }\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n    }\r\n    dependencies {\r\n        classpath \"com.android.tools.build:gradle:7.0.0-beta05\"\r\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.10\" // ã“ã“ã‚’1.5.10ã¸\r\n\r\n        // NOTE: Do not place your application dependencies here; they belong\r\n        // in the individual module build.gradle files\r\n    }\r\n}\r\n```\r\n\r\n(appãƒ•ã‚©ãƒ«ãƒ€ã®`build.gradle`)\r\n\r\n```gradle\r\ncomposeOptions {\r\n    kotlinCompilerExtensionVersion compose_version\r\n    kotlinCompilerVersion '1.5.10' // 1.5.10ã¸\r\n}\r\n```\r\n\r\n# Layout ç·¨\r\nã“ã“ã§è¨€ã†`Layout`ã¯ã€`Column`ã€`Row`ã€`Box`ã¿ãŸã„ãªã‚„ã¤ã§ã™ã€‚  \r\n`Alignment.Center`ä»¥å¤–ã«ã‚‚`Start`ã¨ã‹ã‚ã£ãŸã¨æ€ã†ã®ã§ã©ã†ã\r\n\r\n## Box\r\nViewæ™‚ä»£ã®`FrameLayout`ã«å½“ãŸã‚‹ã‚„ã¤ã€‚é‡ã­ã‚‰ã‚Œã¾ã™ã€‚\r\n\r\n```kotlin\r\nBox(\r\n    modifier = Modifier.fillMaxSize(),\r\n    contentAlignment = Alignment.Center\r\n) {\r\n    Text(text = \"Android\")\r\n    Text(text = \"Jetpack\")\r\n    Text(text = \"Compose\")\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/WS0R8dv.png)\r\n\r\n## Column\r\nç¸¦ç©ã¿LinearLayout\r\n\r\n```kotlin\r\nColumn(\r\n    modifier = Modifier.fillMaxSize(),\r\n    horizontalAlignment = Alignment.CenterHorizontally, // æ¨ªæ–¹å‘\r\n    verticalArrangement = Arrangement.Center // ç¸¦æ–¹å‘\r\n) {\r\n    Text(text = \"Android\")\r\n    Text(text = \"Jetpack\")\r\n    Text(text = \"Compose\")\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/SvrEPky.png)\r\n\r\n\r\n## Row\r\næ¨ªä¸¦ã¹LinearLayout  \r\nColumnã®ã¨ãã¨é€†ã«ãªã‚Šã¾ã™ã­ã€‚\r\n\r\n```kotlin\r\nRow(\r\n    modifier = Modifier.fillMaxSize(),\r\n    horizontalArrangement = Arrangement.Center,\r\n    verticalAlignment = Alignment.CenterVertically\r\n) {\r\n    Text(text = \"Android\")\r\n    Text(text = \"Jetpack\")\r\n    Text(text = \"Compose\")\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/43hkYm7.png)\r\n\r\n# å…¨éƒ¨çœŸã‚“ä¸­ã§ã‚ã‚‹å¿…è¦ã¯ãªã„ã¨ãã®ãŸã‚ã®\r\n`Box`ã€`Column`ã€`Row`ã®å­ä¾›ã®ã¨ãã ã‘ä½¿ãˆã‚‹`Modifier`ã®é–¢æ•°ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n## Box\r\n\r\n```kotlin\r\nBox(modifier = Modifier.fillMaxSize()) {\r\n    Text(text = \"Android\", modifier = Modifier.align(alignment = Alignment.TopStart)) // å·¦ä¸Š\r\n    Text(text = \"Jetpack\", modifier = Modifier.align(alignment = Alignment.Center)) // çœŸã‚“ä¸­\r\n    Text(text = \"Compose\", modifier = Modifier.align(alignment = Alignment.BottomEnd)) // å³ä¸‹\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/u8sk2nm.png)\r\n\r\n## Column\r\n\r\n```kotlin\r\nColumn(\r\n    modifier = Modifier.fillMaxSize(),\r\n) {\r\n    Text(text = \"Android\",modifier = Modifier.align(alignment = Alignment.Start)) // å·¦\r\n    Text(text = \"Jetpack\",modifier = Modifier.align(alignment = Alignment.CenterHorizontally)) // çœŸã‚“ä¸­\r\n    Text(text = \"Compose\",modifier = Modifier.align(alignment = Alignment.End)) // å³\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/UYfAYOz.png)\r\n\r\n## Row\r\n\r\n```kotlin\r\nRow(\r\n    modifier = Modifier.fillMaxSize(),\r\n) {\r\n    Text(text = \"Android\",modifier = Modifier.align(Alignment.Top)) // ä¸Š\r\n    Text(text = \"Jetpack\",modifier = Modifier.align(Alignment.CenterVertically)) // çœŸã‚“ä¸­\r\n    Text(text = \"Compose\",modifier = Modifier.align(Alignment.Bottom)) // ä¸‹\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/cEHpKIy.png)\r\n\r\nãªãŠã€ä¸Šè¨˜ã®æ–¹æ³•ã¯`Modifier`ãŒå¼•æ•°ã«å–ã£ã¦ã‚ã‚‹ã“ã¨ãŒå¿…é ˆãªãŸã‚ã€  \r\nã‚ªãƒªã‚¸ãƒŠãƒ«`@Composable`ãªé–¢æ•°ã®å ´åˆã¯å¼•æ•°ã«`Modifier`ã‚’å–ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã€‚\r\n\r\n```kotlin\r\nRow(\r\n    modifier = Modifier.fillMaxSize(),\r\n) {\r\n    Text(text = \"Android\", modifier = Modifier.align(Alignment.Top)) // ä¸Š\r\n    Text(text = \"Jetpack\", modifier = Modifier.align(Alignment.CenterVertically)) // çœŸã‚“ä¸­\r\n    Text(text = \"Compose\", modifier = Modifier.align(Alignment.Bottom)) // ä¸‹\r\n    \r\n    ComposeHelloWorldText(Modifier.align(Alignment.Top))\r\n}\r\n\r\n// çœç•¥\r\n\r\n@Composable\r\nfun ComposeHelloWorldText(modifier: Modifier = Modifier) {\r\n    Text(\r\n        text = \"Hello World\",\r\n        modifier = modifier\r\n    )\r\n}\r\n```\r\n\r\nã¡ãªã¿ã«`ColumnScope`ã€`RowScope`ã€`BoxScope`ã®æ‹¡å¼µé–¢æ•°ã¨ã—ãŸ`@Composable`ãªé–¢æ•°ã‚‚ä½œã‚Œãªã„ã‚ã‘ã˜ã‚ƒãªã„ã‘ã©ãªã‚“ã‹è‡ªç”±åº¦ãŒæ¸›ã‚‹ã®ã§ã‚„ã‚ã¨ã“ã†ï¼Ÿ\r\n\r\n```kotlin\r\nRow(\r\n    modifier = Modifier.fillMaxSize(),\r\n) {\r\n    Text(text = \"Android\", modifier = Modifier.align(Alignment.Top)) // ä¸Š\r\n    Text(text = \"Jetpack\", modifier = Modifier.align(Alignment.CenterVertically)) // çœŸã‚“ä¸­\r\n    Text(text = \"Compose\", modifier = Modifier.align(Alignment.Bottom)) // ä¸‹\r\n\r\n    // è¦ªãŒRowé™å®š\r\n    ComposeHelloWorldText2()\r\n}\r\n\r\n// çœç•¥\r\n\r\n@Composable\r\nfun RowScope.ComposeHelloWorldText2() {\r\n    Text(\r\n        text = \"Hello World\",\r\n        modifier = Modifier.align(Alignment.Top),\r\n    )\r\n}\r\n```\r\n\r\n\r\n# çµ‚ã‚ã‚Šã«\r\n`comp`ã¾ã§å…¥åŠ›ã™ã‚Œã°`@Composable`ãªé–¢æ•°ã‚’ä¸€ç¬ã§ä½œã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/GbDP9rT.png)\r\n\r\n![Imgur](https://imgur.com/LJZx5Wq.png)\r\n\r\nã‚ã¨ã‚¯ã‚½ã©ã†ã§ã‚‚ã„ã„ã‚“ã ã‘ã©ã€ã‚¨ãƒ­ã‚²ã‚’ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚¹ãƒãƒ›ã‹ã‚‰éŠã¶ã¨ãã¯`Steam Link`ã‚’ä½¿ã†ã¨ã„ã„ã‹ã‚‚ã€‚ãƒ«ãƒ¼ã‚¿ãƒ¼ã‚’è¶…ãˆã‚‰ã‚Œã‚‹(åŒã˜ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã«ã„ã‚‹å¿…è¦ãŒãªã„)ã®ã§å¤–ã‹ã‚‰ã§ã‚‚å‡ºæ¥ã‚‹ã®ãŒå¼·ã„ã€‚  "},{"title":"Jetpack Composeã§ã‚«ã‚¹ã‚¿ãƒ ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ","link":"/posts/android_jc_custom_layout/","markdown":"\r\n<img src=\"https://imgur.com/fQzaLrQ.png\" width=400>\r\n\r\nã‹ã‚ã„ã„ï¼ˆæ›²ã‚‚ã„ã„ï¼‰\r\n\r\n# æœ¬é¡Œ\r\nJetpackComposeã§æŠ˜ã‚Šè¿”ã™ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒã»ã—ã„ã®ã§ä½œã£ãŸã€‚ \r\n\r\n<img src=\"https://imgur.com/AgAFKs6.png\" width=300>\r\n\r\n# å®Œæˆå“ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼‰ã¯ã“ã¡ã‚‰\r\n\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ã—ãŸã®ã§ã“ã®è¨˜äº‹èª­ã¾ãªãã¦ã„ã„ã‚ˆ\r\n\r\nhttps://github.com/takusan23/ComposeOrigamiLayout\r\n\r\nå°å…¥æ–¹æ³•ã¯READMEèª­ã‚“ã§ï¼ˆç‰¹ã«å¤‰ã‚ã£ãŸã“ã¨ã¯ã—ã¦ãªã„ï¼‰\r\n\r\n## ç’°å¢ƒ\r\næœ€æ–°ã®é–‹ç™ºç’°å¢ƒã‚’ä½¿ãŠã†\r\n\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|Android Studio|Android Studio Arctic Fox 2020.3.1 Canary 9|\r\n|JetpackCompose|1.0.0-beta01|\r\n\r\n## JetpackCompose å°å…¥\r\n\r\nappãƒ•ã‚©ãƒ«ãƒ€å†…ã®build.gradleã‚’é–‹ã„ã¦\r\n\r\n```gradle\r\nandroid {\r\n    // çœç•¥\r\n    kotlinOptions {\r\n        jvmTarget = '1.8'\r\n        useIR = true\r\n    }\r\n    buildFeatures {\r\n        compose true\r\n    }\r\n    composeOptions {\r\n        kotlinCompilerExtensionVersion '1.0.0-beta01'\r\n        kotlinCompilerVersion '1.4.30'\r\n    }\r\n}\r\n\r\ndependencies {\r\n\r\n    implementation \"androidx.compose.ui:ui:1.0.0-beta01\"\r\n    implementation \"androidx.compose.material:material:1.0.0-beta01\"\r\n    implementation \"androidx.compose.ui:ui-tooling:1.0.0-beta01\"\r\n\r\n}\r\n```\r\n\r\n# ä½œæˆ\r\né©å½“ãªKotlinãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¦Composeãªé–¢æ•°ã‚’ä½œã£ã¦ã„ãã¾ã—ã‚‡ã†\r\n\r\n```kotlin\r\n@Composable\r\nfun OrigamiLayout() {\r\n    \r\n}\r\n```\r\n\r\n## ã‚«ã‚¹ã‚¿ãƒ Layout\r\n`View`ã§è¨€ã†ã¨ã“ã‚ã®`ViewGroup`ã§ã™ã­ã€‚  \r\nã¨ã‚Šã‚ãˆãšå¼•æ•°ã‚’ã‚»ãƒƒãƒˆã—ã¦ã‚ã’ã¦ã€`Layout()`ã‚’ç½®ãã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * æŠ˜ã‚Šè¿”ã™Layout\r\n *\r\n * @param modifier Paddingãªã©\r\n * @param content è¡¨ç¤ºã—ãŸã„éƒ¨å“\r\n * */\r\n@Composable\r\nfun OrigamiLayout(\r\n    modifier: Modifier = Modifier,\r\n    content: @Composable () -> Unit,\r\n) {\r\n    Layout(\r\n        content = content,\r\n        modifier = modifier\r\n    ) { measurables, constraints ->\r\n\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã‹ã‚‰è¿”ã‚Šå€¤ã‚’æ›¸ã„ã¦ã‚ã’ã¾ã™\r\n\r\n## measurables ã¨ constraints\r\n\r\n- constraints\r\n\r\n`constraints`ã£ã¦ã®ã¯è¦ªã®éƒ¨å“ã®å¤§ãã•ã¨ã‹ãŒå–ã‚Œã‚‹ã‚„ã¤ã§ã™ã­ã€‚\r\n\r\nã©ã†ã„ã†ã“ã¨ã‹ã¨ã„ã†ã¨ã€\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            ComposeOrigamiLayoutTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(color = MaterialTheme.colors.background) {\r\n                    \r\n                    Column(\r\n                        modifier = Modifier.width(200.dp) // ã“ã‚Œã¨\r\n                    ) {\r\n                        Layout(content = {\r\n                            Text(text = \"Hello World\")\r\n                        }) { measurables, constraints ->\r\n\r\n                            println(200.dp.toPx())\r\n                            println(constraints.maxWidth) // ã“ã‚Œ\r\n\r\n                            layout(constraints.maxWidth, constraints.maxHeight) {\r\n\r\n                            }\r\n                        }\r\n                    }\r\n                    \r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n```\r\n\r\nã“ã‚Œã¨ã€€ã“ã‚Œã€€ã£ã¦æ›¸ã„ã¦ã‚ã‚‹éƒ¨åˆ†ã¯åŒã˜å€¤ã«ãªã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚  \r\nä¸€å¿œ200dpã®å€¤ã‚’pxã«ã—ã¦å‡ºåŠ›ã—ã¾ã—ãŸãŒåŒã˜å€¤ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n- measurables\r\nã“ã„ã¤ã¯`content`å¼•æ•°ã«å…¥ã‚ŒãŸUIéƒ¨å“ã®å¤§ãã•ã‚’æ¸¬å®šã™ã‚‹ã¨ãã«ä½¿ã†ã€‚  \r\næœ€å¤§å€¤ã¨æœ€å°å€¤ã®æƒ…å ±ã‚’æ¸¡ã™ã¨å¤§ãã•ãŒå…¥ã£ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã—ã¦ãã‚Œã‚‹ã€‚\r\n\r\n## ã“ã‚Œã‹ã‚‰ç½®ãéƒ¨å“ã®å¤§ãã•ã‚’æ¸¬å®šã™ã‚‹\r\n`Measurable#measure()`ã¯ä¸€åº¦ã—ã‹å‘¼ã¹ã¾ã›ã‚“ã€‚ï¼ˆå¤šåˆ†ï¼‰\r\n\r\n```kotlin\r\n/**\r\n * æŠ˜ã‚Šè¿”ã™Layout\r\n *\r\n * @param modifier Paddingãªã©\r\n * @param content è¡¨ç¤ºã—ãŸã„éƒ¨å“\r\n * */\r\n@Composable\r\nfun OrigamiLayout(\r\n    modifier: Modifier = Modifier,\r\n    content: @Composable () -> Unit,\r\n) {\r\n    Layout(\r\n        content = content,\r\n        modifier = modifier\r\n    ) { measurables, constraints ->\r\n        // ã“ã®ä¸­ã«å…¥ã‚‹Composeï¼ˆå­ä¾›Composeï¼‰ã®å¹…ã¨ã‹ã®æƒ…å ±ã®é…åˆ—ã«ã™ã‚‹\r\n        val placeableList = measurables.map { it.measure(Constraints(0, constraints.maxWidth, 0, constraints.maxHeight)) }.toMutableList()\r\n    }\r\n}\r\n```\r\n\r\n## ãŠã‘ã‚‹ã‹ã©ã†ã‹ï¼ˆæŠ˜ã‚Šè¿”ã™ã‹ã©ã†ã‹ï¼‰\r\næŠ˜ã‚Šè¿”ã™ã‹ã©ã†ã‹ã®è¨ˆç®—ã‚’ã“ã“ã§è¡Œã„ã¾ã™ã€‚ã¨ã‚Šã¾ã‚³ãƒ”ãƒš  \r\nãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã«ã—ã¦ã‚‚è‰¯ã‹ã£ãŸã‘ã©ï¼“ã¤ã ã£ãŸã®ã§Tripleã«Xåº§æ¨™ã€Yåº§æ¨™ã€placeableã‚’ãã‚Œãã‚Œå…¥ã‚ŒãŸ\r\n\r\n```kotlin\r\nLayout(\r\n    content = content,\r\n    modifier = modifier\r\n) { measurables, constraints ->\r\n    // ã“ã®ä¸­ã«å…¥ã‚‹éƒ¨å“ã®å¹…ã¨ã‹ã®æƒ…å ±ã®é…åˆ—ã«ã™ã‚‹\r\n    val placeableList = measurables.map { it.measure(Constraints(0, constraints.maxWidth, 0, constraints.maxHeight)) }.toMutableList()\r\n    // æœ€çµ‚çš„ã«å…¥ã‚Œã‚‹ã¨ãã«ä½¿ã†ã‚„ã¤\r\n    val childrenDataList = arrayListOf<Triple<Int, Int, Placeable>>()\r\n    // ã“ã®Composeã®å¹…\r\n    val origamiWidth = constraints.maxWidth\r\n    // é«˜ã•è¨ˆç®—\r\n    var origamiHeight = 0\r\n    // åˆ—ã«å…¥ã£ã¦ã‚‹Composeã®åˆè¨ˆã®å¹…\r\n    var lineWidth = 0\r\n    // å­ä¾›ComposeãŒã®ä½ç½®ã‚’æ±ºå®šã™ã‚‹\r\n    placeableList.forEach { placeable ->\r\n        if (lineWidth + placeable.width < origamiWidth) {\r\n            // ä»Šã®è¡Œã®å¹…ãŒè¶³ã‚Šã¦ã„ã‚‹å ´åˆ\r\n            // width / height / placeable\r\n            childrenDataList.add(Triple(lineWidth, origamiHeight, placeable))\r\n            lineWidth += placeable.width\r\n        } else {\r\n            // è¶³ã‚Šã¦ãªã„\r\n            // æ¬¡ã¯ã‚‚ã†å…¥ã‚‰ãªã„ã®ã§æ¬¡ã®è¡Œã¸\r\n            lineWidth = 0\r\n            origamiHeight += placeable.height\r\n            // width / height / placeable\r\n            childrenDataList.add(Triple(lineWidth, origamiHeight, placeable))\r\n            // å¹…ã‚’è¶³ã™\r\n            lineWidth = placeable.width\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## é…ç½®ã™ã‚‹\r\n`layout()`ã‚’å‘¼ã‚“ã§ã€`placeRelative()`ã‚’å‘¼ã¶ã“ã¨ã§éƒ¨å“ãŒé…ç½®ã•ã‚Œã¾ã™ã€‚  \r\n\r\n```kotlin\r\nLayout(\r\n    content = content,\r\n    modifier = modifier\r\n) { measurables, constraints ->\r\n    // ã“ã®ä¸­ã«å…¥ã‚‹éƒ¨å“ã®å¹…ã¨ã‹ã®æƒ…å ±ã®é…åˆ—ã«ã™ã‚‹\r\n    val placeableList = measurables.map { it.measure(Constraints(0, constraints.maxWidth, 0, constraints.maxHeight)) }.toMutableList()\r\n    // æœ€çµ‚çš„ã«å…¥ã‚Œã‚‹ã¨ãã«ä½¿ã†ã‚„ã¤\r\n    val childrenDataList = arrayListOf<Triple<Int, Int, Placeable>>()\r\n    // ã“ã®Composeã®å¹…\r\n    val origamiWidth = constraints.maxWidth\r\n    // é«˜ã•è¨ˆç®—\r\n    var origamiHeight = 0\r\n    // åˆ—ã«å…¥ã£ã¦ã‚‹Composeã®åˆè¨ˆã®å¹…\r\n    var lineWidth = 0\r\n    // å­ä¾›ComposeãŒã®ä½ç½®ã‚’æ±ºå®šã™ã‚‹\r\n    placeableList.forEach { placeable ->\r\n        if (lineWidth + placeable.width < origamiWidth) {\r\n            // ä»Šã®è¡Œã®å¹…ãŒè¶³ã‚Šã¦ã„ã‚‹å ´åˆ\r\n            // width / height / placeable\r\n            childrenDataList.add(Triple(lineWidth, origamiHeight, placeable))\r\n            lineWidth += placeable.width\r\n        } else {\r\n            // è¶³ã‚Šã¦ãªã„\r\n            // æ¬¡ã¯ã‚‚ã†å…¥ã‚‰ãªã„ã®ã§æ¬¡ã®è¡Œã¸\r\n            lineWidth = 0\r\n            origamiHeight += placeable.height\r\n            // width / height / placeable\r\n            childrenDataList.add(Triple(lineWidth, origamiHeight, placeable))\r\n            // å¹…ã‚’è¶³ã™\r\n            lineWidth = placeable.width\r\n        }\r\n    }\r\n    // origamiHeightã¯ã€éƒ¨å“ã‚’ç½®ãéš›ã®åº§æ¨™ï¼ˆå·¦ä¸Šï¼‰ã«ãªã‚Šã¾ã™ã®ã§ã€é«˜ã•ã¨ã—ã¦ä½¿ã†ã«ã¯ã‚‚ã†ä¸€åº¦éƒ¨å“ã®é«˜ã•ã‚’è¶³ã—ã¦ã‚ã’ãªã„ã¨ã„ã‘ãªã„\r\n    val lastItemHeight = if (placeableList.isEmpty()) 0 else placeableList.last().height\r\n    layout(width = constraints.maxWidth, height = origamiHeight + lastItemHeight) {\r\n        childrenDataList.forEach { triple ->\r\n            val xPos = triple.first\r\n            val yPos = triple.second\r\n            val placeable = triple.third\r\n            // è¨­ç½®\r\n            placeable.placeRelative(xPos, yPos)\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## ç½®ã„ã¦ä½¿ã£ã¦ã¿ã‚‹\r\n\r\n```kotlin\r\n@Composable\r\nfun HomeScreen() {\r\n    Column(\r\n        modifier = Modifier.fillMaxHeight(),\r\n    ) {\r\n        // æ–‡å­—åˆ—é…åˆ—\r\n        val list = remember { mutableStateListOf<String>() }\r\n        // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å…¥ã‚Œã¦ã‚‹æ–‡å­—åˆ—\r\n        val editTextValue = remember { mutableStateOf(\"\") }\r\n        // æŠ˜ã‚Šè¿”ã™ã‚„ã¤\r\n        OrigamiLayout {\r\n            // ãƒ†ã‚­ã‚¹ãƒˆé…ç½®\r\n            list.forEach { text ->\r\n                OutlinedButton(\r\n                    onClick = { },\r\n                    modifier = Modifier.padding(2.dp)\r\n                ) {\r\n                    Text(\r\n                        text = text\r\n                    )\r\n                }\r\n            }\r\n        }\r\n        // è¿½åŠ \r\n        Row {\r\n            // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹\r\n            TextField(\r\n                modifier = Modifier.weight(1f),\r\n                value = editTextValue.value,\r\n                onValueChange = { editTextValue.value = it }\r\n            )\r\n            // è¿½åŠ ãƒœã‚¿ãƒ³\r\n            Button(\r\n                onClick = {\r\n                    list.add(editTextValue.value)\r\n                },\r\n                modifier = Modifier\r\n                    .padding(10.dp)\r\n            ) {\r\n                Text(text = \"Add Text\")\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã‚ã¨ã¯MainActivityãªã‚“ã‹ã«ç½®ã„ã¦å®Œæˆ\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            ComposeOrigamiLayoutTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(color = MaterialTheme.colors.background) {\r\n                    HomeScreen()\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nèª¬æ˜ã™ã£ã¨ã°ã¡ã‚ƒã£ãŸã‘ã©ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/OnLimT7.png)\r\n\r\n## çŸ­ã„é †ã«ã—ã¦ã‚¹ãƒšãƒ¼ã‚¹ã‚’æœ‰åŠ¹æ´»ç”¨ã•ã›ã‚‹\r\n**ä¸¦ã³æ›¿ãˆã—ã¦ã‚‚å•é¡Œãªã„ãªã‚‰**ã®è©±ã§ã™ãŒ  \r\nã“ã®å°ã•ã„é †ã«ä¸¦ã³æ›¿ãˆã‚‹ã‚„ã¤(`ArrayList#sort{ }`)ä¾¿åˆ©\r\n\r\n```kotlin\r\n/**\r\n * æŠ˜ã‚Šè¿”ã™Layout\r\n *\r\n * @param modifier Paddingãªã©\r\n * @param isAcceptSort ä¸¦ã³æ›¿ãˆã—ã¦ã‚‚ã„ã„ãªã‚‰true\r\n * @param content è¡¨ç¤ºã—ãŸã„éƒ¨å“\r\n * */\r\n@Composable\r\nfun OrigamiLayout(\r\n    modifier: Modifier = Modifier,\r\n    isAcceptSort: Boolean = false,\r\n    content: @Composable () -> Unit,\r\n) {\r\n    Layout(\r\n        content = content,\r\n        modifier = modifier\r\n    ) { measurables, constraints ->\r\n        // ã“ã®ä¸­ã«å…¥ã‚‹Composeï¼ˆå­ä¾›Composeï¼‰ã®å¹…ã¨ã‹ã®æƒ…å ±ã®é…åˆ—ã«ã™ã‚‹\r\n        // ãªã‚“ã‹Constraints()ã®maxã®ã¨ã“ã‚ã¯MAX_VALUEå…¥ã‚Œã¨ã„ã¦minã«ã¯0ã‚’å…¥ã‚Œã¦ã‚ã’ã‚Œã°å¤§ãã•ãŒå–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹\r\n        val placeableList = measurables.map { it.measure(Constraints(0, constraints.maxWidth, 0, constraints.maxHeight)) }.toMutableList()\r\n        // æœ€çµ‚çš„ã«å…¥ã‚Œã‚‹ã¨ãã«ä½¿ã†ã‚„ã¤\r\n        val childrenDataList = arrayListOf<Triple<Int, Int, Placeable>>()\r\n        // ã“ã®Composeã®å¹…\r\n        val origamiWidth = constraints.maxWidth\r\n        // é«˜ã•è¨ˆç®—\r\n        var origamiHeight = 0\r\n        // åˆ—ã«å…¥ã£ã¦ã‚‹Composeã®åˆè¨ˆã®å¹…\r\n        var lineWidth = 0\r\n        // ä¸¦ã³æ›¿ãˆã‚’è¨±å¯ã—ã¦ã„ã‚‹å ´åˆã¯ä¸¦ã³æ›¿ãˆã‚‹\r\n        if(isAcceptSort){\r\n            placeableList.sortBy { placeable -> placeable.width }\r\n        }\r\n        // å­ä¾›ComposeãŒã®ä½ç½®ã‚’æ±ºå®šã™ã‚‹\r\n        placeableList.forEach { placeable ->\r\n            if (lineWidth + placeable.width < origamiWidth) {\r\n                // ä»Šã®è¡Œã®å¹…ãŒè¶³ã‚Šã¦ã„ã‚‹å ´åˆ\r\n                // width / height / placeable\r\n                childrenDataList.add(Triple(lineWidth, origamiHeight, placeable))\r\n                lineWidth += placeable.width\r\n            } else {\r\n                // è¶³ã‚Šã¦ãªã„\r\n                // æ¬¡ã¯ã‚‚ã†å…¥ã‚‰ãªã„ã®ã§æ¬¡ã®è¡Œã¸\r\n                lineWidth = 0\r\n                origamiHeight += placeable.height\r\n                // width / height / placeable\r\n                childrenDataList.add(Triple(lineWidth, origamiHeight, placeable))\r\n                // æ¬¡ã®è¡Œã«ç§»å‹•ã—ã¦å¹…ã‚’è¶³ã™\r\n                lineWidth = placeable.width\r\n            }\r\n        }\r\n        // å­Composeã‚’ç½®ã„ã¦ã„ã\r\n        // origamiHeightã¯ã€éƒ¨å“ã‚’ç½®ãéš›ã®åº§æ¨™ï¼ˆå·¦ä¸Šï¼‰ã«ãªã‚Šã¾ã™ã®ã§ã€é«˜ã•ã¨ã—ã¦ä½¿ã†ã«ã¯ã‚‚ã†ä¸€åº¦éƒ¨å“ã®é«˜ã•ã‚’è¶³ã—ã¦ã‚ã’ãªã„ã¨ã„ã‘ãªã„\r\n        val lastItemHeight = if (placeableList.isEmpty()) 0 else placeableList.last().height\r\n        layout(width = constraints.maxWidth, height = origamiHeight + lastItemHeight) {\r\n            childrenDataList.forEach { triple ->\r\n                val xPos = triple.first\r\n                val yPos = triple.second\r\n                val placeable = triple.third\r\n                // è¨­ç½®\r\n                placeable.placeRelative(xPos, yPos)\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nä½¿ã†æ–¹ã§`true`ã—ã¦ã‚ã’ã‚‹ã€‚\r\n\r\n```kotlin\r\n@Composable\r\nfun HomeScreen() {\r\n    Column(\r\n        modifier = Modifier.fillMaxHeight(),\r\n    ) {\r\n        // æ–‡å­—åˆ—é…åˆ—\r\n        val list = remember { mutableStateListOf<String>() }\r\n        // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹ã«å…¥ã‚Œã¦ã‚‹æ–‡å­—åˆ—\r\n        val editTextValue = remember { mutableStateOf(\"\") }\r\n        // æŠ˜ã‚Šè¿”ã™ã‚„ã¤\r\n        OrigamiLayout(\r\n            isAcceptSort = true // ã‚½ãƒ¼ãƒˆæœ‰åŠ¹\r\n        ) {\r\n            // ãƒ†ã‚­ã‚¹ãƒˆé…ç½®\r\n            list.forEach { text ->\r\n                OutlinedButton(\r\n                    onClick = { },\r\n                    modifier = Modifier.padding(2.dp)\r\n                ) {\r\n                    Text(\r\n                        text = text\r\n                    )\r\n                }\r\n            }\r\n        }\r\n        // è¿½åŠ \r\n        Row {\r\n            // ãƒ†ã‚­ã‚¹ãƒˆãƒœãƒƒã‚¯ã‚¹\r\n            TextField(\r\n                modifier = Modifier.weight(1f),\r\n                value = editTextValue.value,\r\n                onValueChange = { editTextValue.value = it }\r\n            )\r\n            // è¿½åŠ ãƒœã‚¿ãƒ³\r\n            Button(\r\n                onClick = {\r\n                    list.add(editTextValue.value)\r\n                },\r\n                modifier = Modifier\r\n                    .padding(10.dp)\r\n            ) {\r\n                Text(text = \"Add Text\")\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§çŸ­ã„é †ã«ä¸Šã‹ã‚‰å…¥ã£ã¦ã„ãã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/AgAFKs6.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚  \r\n\r\n\r\n\r\nå‚è€ƒã«ã—ã¾ã—ãŸã€‚ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚\r\n\r\nhttps://qiita.com/takahirom/items/c6625cbc7ebdda49de2f\r\n\r\nhttps://developer.android.com/jetpack/compose/layout?hl=ja"},{"title":"Jetpack Compose ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã«çœŸã£ç™½","link":"/posts/android_jc_darkmode_white/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\n# æœ¬é¡Œ\r\nãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰æ™‚ã«é»’ããªã‚‰ãªã„\r\n\r\n![Imgur](https://imgur.com/tHm9Hog.png)\r\n\r\n# ç›´ã—æ–¹\r\n\r\n`Surface`ã§å›²ã£ã¦ã‚ã’ã¾ã™ã€‚`material3`ã‚’å…¥ã‚Œã¦ã„ã‚‹å ´åˆã¯`material3`ã®æ–¹ã®`Surface`ã§å›²ã£ã¦ã‚ã’ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nSurface {\r\n    Column(modifier = Modifier.padding(10.dp)) {\r\n        SetupButtons(\r\n            modifier = Modifier\r\n                .fillMaxWidth(),\r\n            text = stringResource(id = R.string.launch_server),\r\n            icon = painterResource(id = R.drawable.ic_outline_file_download_24),\r\n            description = stringResource(id = R.string.launch_server_description),\r\n            onClick = { onNavigate(NavigationLinkList.ServerSetupScreen) }\r\n        )\r\n        SetupButtons(\r\n            modifier = Modifier\r\n                .fillMaxWidth()\r\n                .padding(top = 10.dp),\r\n            text = stringResource(id = R.string.launch_client),\r\n            icon = painterResource(id = R.drawable.ic_outline_file_upload_24),\r\n            onClick = { onNavigate(NavigationLinkList.ClientSetupScreen) }\r\n        )\r\n    }\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/EnBTZRz.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚"},{"title":"Jetpack Composeã«Material3ã‚’å…¥ã‚Œã¦ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ä½¿ã†","link":"/posts/android_jc_dynamic_color/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\nã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ã‚ˆã‚Šæ„›ã‚’è¾¼ã‚ã¦ æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\n\r\nãªã‚“ã‹è‰²ã€…æ€ã†ã“ã¨ã¯ã‚ã‚‹ã‘ã©æœ€å¾Œã®ã‚¿ã‚¤ãƒˆãƒ«å›åã¨EDæ›²ã§è¨±ã—ãŸæ„Ÿã‚ã‚‹ã€‚  \r\nã‚ã¨ã“ã®å­ã‹ã‚ã„ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/u03dpx2.png)\r\n\r\nã‚µãƒ–ãƒ’ãƒ­ã‚¤ãƒ³ã®æ‰±ã„é›‘ã™ãã¦æ‚²ã—ããªã£ã¡ã‚ƒã£ãŸ\r\n\r\nâ†“  \r\nâ†“  \r\nâ†“  \r\n\r\nã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ã‚ˆã‚Šæ„›ã‚’è¾¼ã‚ã¦ APOLLOCRISIS æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\nä»Šæœˆã®ã‚¨ãƒ­ã‚²ã®æ—¥ã‹ã‚‰ç„¡æ–™é…ä¿¡ã•ã‚Œã‚‹ã¿ãŸã„ãªã®ã§**å‰ä½œã‚„ã£ãŸäººã¯çµ¶å¯¾ã‚„ã‚ã†**ã€‚ã‚„ã£ã¦ãƒ­ãƒŸã¡ã‚ƒã‚“ã‚’åŠ©ã‘ã¦ã‚ã’ã¦ã€ã€ã€\r\n\r\n![Imgur](https://imgur.com/ilgmLD0.png)\r\n\r\né‡ä¸Šã•ã‚“ã„ã„äºº\r\n\r\n# æœ¬é¡Œ\r\n`Jetpack Compose`ã«ã‚‚`Material3`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚  \r\nãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã¡ãªã¿ã«`BottomNavigationBar`ã®é«˜ã•ã¯`56.dp`ï¼Ÿã‹ã‚‰`80.dp`ã¨å¤§ãããªã‚Šã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/S1bWXYG.png)\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                             |\r\n|----------------|------------------------------------|\r\n| Android        | 12 (ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ä½¿ã†ãªã‚‰å¿…é ˆ) |\r\n| Android Stuido | Arctic Fox 2020.3.1 Patch 3        |\r\n| targetSdk      | 31                                 |\r\n\r\n# å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\r\n\r\n## å°å…¥\r\n\r\nhttps://developer.android.com/jetpack/compose/themes/material#material3\r\n\r\n## Material3\r\n\r\nhttps://m3.material.io/\r\n\r\n## 1. å°å…¥\r\n\r\n`app/build.gradle`ã«æ›¸ãè¶³ã™ã ã‘ã§ã™ã€‚ï¼ˆæ–°ä¸–ç•Œã®ï¼‰Î±ç‰ˆãªã®ã§å®‰å®šã—ãªã„ã‹ã‚‚ã‚‰ã—ã„ã§ã™ã€‚\r\n\r\n```\r\ndependencies {\r\n\r\n    // Jetpack Compose\r\n    implementation(\"androidx.compose.ui:ui:1.1.0-beta01\")\r\n    implementation(\"androidx.compose.material:material:1.1.0-beta01\")\r\n    implementation(\"androidx.compose.ui:ui-tooling-preview:1.1.0-beta01\")\r\n    androidTestImplementation(\"androidx.compose.ui:ui-test-junit4:1.1.0-beta01\")\r\n    debugImplementation(\"androidx.compose.ui:ui-tooling:1.1.0-beta01\")\r\n\r\n    // â†“ã“ã‚Œ\r\n    implementation(\"androidx.compose.material3:material3:1.0.0-alpha01\")\r\n\r\n}\r\n```\r\n\r\n## 2. Theme.kt (MaterialTheme)ã‚’æ›¸ãæ›ãˆã‚‹\r\næ¬¡ã«`Theme.kt`ã‹`MaterialTheme`ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚  \r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆæ™‚ã‹ã‚‰`Composeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ`ã‚’é¸ã‚“ã å ´åˆã¯`Theme.kt`ã£ã¦åå‰ã§`MaterialTheme`ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ã„ã‚‹é–¢æ•°ãŒã‚ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\nä»¥ä¸‹ã¯ä¸€ä¾‹ã§ã™ã€‚  \r\nãªã‚“ã‹è‰²ã®æ‰±ã„ãŒå¤‰ã‚ã£ã¦ã‚‹ã®ã§ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã§è‰²ã‚’åãå‡ºã—ã¦ã‚‚ã‚‰ã£ã¦ã‚‚ã„ã„ã‹ã‚‚ï¼Ÿ  \r\n\r\nhttps://material-foundation.github.io/material-theme-builder/\r\n\r\n```kotlin\r\nval PrimaryColor = Color(0xff8c9bde)\r\nval DarkColor = Color(0xff7873c2)\r\nval LightColor = Color(0xffd1f7e3)\r\n\r\n@SuppressLint(\"NewApi\")\r\n@Composable\r\nfun ComposeDynamicColorTheme(\r\n    darkTheme: Boolean = isSystemInDarkTheme(),\r\n    isEnableDynamicColor: Boolean = true,\r\n    content: @Composable () -> Unit,\r\n) {\r\n    val context = LocalContext.current\r\n    // ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ä½¿ã†ï¼Ÿ\r\n    val isUseDynamicColor = Build.VERSION.SDK_INT >= Build.VERSION_CODES.S\r\n            && isEnableDynamicColor\r\n\r\n    // Android 12ä»¥é™ã§\r\n    val colorScheme = when {\r\n        isUseDynamicColor && darkTheme -> dynamicDarkColorScheme(context)\r\n        isUseDynamicColor && !darkTheme -> dynamicLightColorScheme(context)\r\n        darkTheme -> darkColorScheme(\r\n            primary = PrimaryColor,\r\n            secondary = LightColor,\r\n            tertiary = DarkColor,\r\n        )\r\n        else -> lightColorScheme(\r\n            primary = PrimaryColor,\r\n            secondary = LightColor,\r\n            tertiary = DarkColor,\r\n        )\r\n    }\r\n\r\n    MaterialTheme(\r\n        colorScheme = colorScheme,\r\n        content = content\r\n    )\r\n}\r\n```\r\n\r\n`MaterialTheme`ã¯`androidx.compose.material3.MaterialTheme`ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nimport android.annotation.SuppressLint\r\nimport android.os.Build\r\nimport androidx.compose.foundation.isSystemInDarkTheme\r\nimport androidx.compose.material3.*\r\nimport androidx.compose.runtime.Composable\r\nimport androidx.compose.ui.graphics.Color\r\nimport androidx.compose.ui.platform.LocalContext\r\n```\r\n\r\n#### æ³¨æ„ç‚¹ï¼Ÿ\r\n\r\n`(androidx.compose.material.)MaterialTheme.colors`ã¯ä½¿ãˆãªããªã‚Šã¾ã™ã€‚   \r\n`(androidx.compose.material3.)MaterialTheme.colorScheme`ã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚ãªã„å ´åˆã¯`import`é–“é•ãˆã¦ã¾ã™ã€‚\r\n\r\n`backgroundColor`ã¯`containerColor`ã«å¤‰ã‚ã£ãŸæ¨¡æ§˜ï¼Ÿ\r\n\r\n## 3. ã²ãŸã™ã‚‰ `import androidx.compose.material`ã‹ã‚‰`import androidx.compose.material3`ã«æ›¸ãæ›ãˆã¦ã\r\n\r\nå¯¾å¿œã—ã¦ã„ã‚‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¯ä»¥ä¸‹ã§ã™ã€‚  \r\n\r\nhttps://developer.android.com/jetpack/androidx/releases/compose-material3  \r\n\r\n`Text`ã€`Icon`ãªã‚“ã‹ã‚‚`Material3`ã§ç”¨æ„ã•ã‚Œã¦ã„ã‚‹æ–¹ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\né¸ã¶éš›ã¯`material3`ã£ã¦æ›¸ã„ã¦ã‚ã‚‹æ–¹ã‚’ã€‚  \r\n\r\n![Imgur](https://imgur.com/1CMjVPr.png)\r\n\r\nä»¥ä¸‹ä¾‹ã§ã™ã€‚  \r\nã‚³ãƒ”ãƒšã™ã‚‹éš›ã¯ã€`ic_android_black_24dp`ã‚’`Android Studio`ã®`Vector Asset`ã‹ã‚‰è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    @OptIn(ExperimentalMaterial3Api::class)\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            ComposeDynamicColorTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(color = MaterialTheme.colorScheme.background) {\r\n\r\n                    Scaffold(\r\n                        topBar = { MediumTopAppBar(title = { Text(text = \"ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼\") }) },\r\n                        bottomBar = {\r\n                            NavigationBar {\r\n                                NavigationBarItem(\r\n                                    selected = true,\r\n                                    icon = { Icon(painter = painterResource(id = R.drawable.ic_android_black_24dp), contentDescription = null) },\r\n                                    label = { Text(text = \"Android\") },\r\n                                    onClick = { }\r\n                                )\r\n                            }\r\n                        },\r\n                        floatingActionButton = {\r\n                            ExtendedFloatingActionButton(\r\n                                text = { Text(text = \"ExtendedFAB\") },\r\n                                icon = { Icon(painter = painterResource(id = R.drawable.ic_android_black_24dp), contentDescription = null) },\r\n                                onClick = { }\r\n                            )\r\n                        },\r\n                        content = {\r\n                            Button(onClick = { }) {\r\n                                Text(text = \"Hello World\")\r\n                            }\r\n                        },\r\n                    )\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã‚ˆãƒ¼ã“ãMaterial3ã®ä¸–ç•Œã¸...\r\n\r\n![Imgur](https://imgur.com/fa8uwGI.png)\r\n\r\n# ã¤ã¾ãšã„ãŸç‚¹\r\n\r\n## Scaffoldã«SnackbarHostãŒç„¡ã„\r\n\r\n`Scaffold`ã‚’ä½¿ã†ã¨ã„ã„æ„Ÿã˜ã«`Snackbar`ã‚’è¡¨ç¤ºã§ãã‚‹ã‚“ã§ã™ã‘ã©ã€`Material3`ã®`Scaffold`ã«ã¯`Snackbar`ã‚’è¡¨ç¤ºã™ã‚‹æ©Ÿèƒ½ãŒç¾çŠ¶ãªã„ã§ã™ã€‚   `Snackbar`ã‚’Composeã§è¡¨ç¤ºã•ã›ã‚‹ã«ã¯ã€`SnackbarHost`ã‚’è¿½åŠ ã™ã‚Œã°ã„ã„ã®ã§ã€`Scaffold`ã«`SnackbarHost`ã‚’è¿½åŠ ã—ãŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * Material3ã®Scaffoldã«SnackBarç„¡ã„ã®ã§é©å½“ã«ä½œã‚‹\r\n *\r\n * [Scaffold]ã«[SnackbarHost]ã‚’è¿½åŠ ã—ã¦ã‚‹ã ã‘ã§ã™ã€‚\r\n * */\r\n@ExperimentalMaterial3Api\r\n@Composable\r\nfun M3Scaffold(\r\n    modifier: Modifier = Modifier,\r\n    scaffoldState: ScaffoldState = rememberScaffoldState(),\r\n    snackbarHostState: SnackbarHostState = remember { SnackbarHostState() },\r\n    topBar: @Composable () -> Unit = {},\r\n    bottomBar: @Composable () -> Unit = {},\r\n    floatingActionButton: @Composable () -> Unit = {},\r\n    floatingActionButtonPosition: FabPosition = FabPosition.End,\r\n    drawerContent: @Composable (ColumnScope.() -> Unit)? = null,\r\n    drawerGesturesEnabled: Boolean = true,\r\n    drawerShape: Shape = RoundedCornerShape(16.dp),\r\n    drawerTonalElevation: Dp = DrawerDefaults.Elevation,\r\n    drawerContainerColor: Color = MaterialTheme.colorScheme.surface,\r\n    drawerContentColor: Color = contentColorFor(drawerContainerColor),\r\n    drawerScrimColor: Color = DrawerDefaults.scrimColor,\r\n    containerColor: Color = MaterialTheme.colorScheme.background,\r\n    contentColor: Color = contentColorFor(containerColor),\r\n    content: @Composable (PaddingValues) -> Unit,\r\n) {\r\n    Scaffold(\r\n        modifier = modifier,\r\n        scaffoldState = scaffoldState,\r\n        topBar = topBar,\r\n        bottomBar = bottomBar,\r\n        floatingActionButton = floatingActionButton,\r\n        floatingActionButtonPosition = floatingActionButtonPosition,\r\n        drawerContent = drawerContent,\r\n        drawerGesturesEnabled = drawerGesturesEnabled,\r\n        drawerShape = drawerShape,\r\n        drawerTonalElevation = drawerTonalElevation,\r\n        drawerContainerColor = drawerContainerColor,\r\n        drawerContentColor = drawerContentColor,\r\n        drawerScrimColor = drawerScrimColor,\r\n        containerColor = containerColor,\r\n        contentColor = contentColor,\r\n        content = {\r\n            Box {\r\n                content(it)\r\n                SnackbarHost(\r\n                    modifier = Modifier\r\n                        .padding(it)\r\n                        .align(Alignment.BottomCenter),\r\n                    hostState = snackbarHostState\r\n                )\r\n            }\r\n        }\r\n    )\r\n}\r\n```\r\n\r\nä½¿ã†éš›ã¯ã“ã‚“ãªãµã†ã«\r\n\r\n\r\n```kotlin\r\nval scaffoldState = rememberScaffoldState()\r\nval snackbarHostState = remember { SnackbarHostState() }\r\n\r\nLaunchedEffect(key1 = Unit, block = {\r\n    snackbarHostState.showSnackbar(\"Hello World\")\r\n})\r\n\r\nM3Scaffold(\r\n    scaffoldState = scaffoldState,\r\n    snackbarHostState = snackbarHostState,\r\n    content = {\r\n        // components...\r\n    },\r\n)\r\n```\r\n\r\n## @ExperimentalMaterial3Api vs @OptIn(ExperimentalMaterial3Api::class)\r\n\r\nã©ã£ã¡ä½¿ã†ã‹ã£ã¦è©±\r\n\r\n- @ExperimentalMaterial3Api\r\n    - å‘¼ã³å‡ºã—å…ˆã«ã‚‚æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ï¼ˆä¼æ¬ã™ã‚‹ï¼‰\r\n    - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ãŒè­¦å‘Šã‚’å‡ºã—ãŸã„ã¨ãã«ä½¿ã†\r\n\r\n- @OptIn(ExperimentalMaterial3Api::class)\r\n    - å‘¼ã³å‡ºã—å…ˆã«ã¯æ›¸ã‹ãªãã¦ã„ã„ï¼ˆä¼æ¬ã—ãªã„ï¼‰\r\n    - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåˆ©ç”¨è€…ãŒè­¦å‘Šã‚’é£²ã‚“ã å ´åˆã¯ã“ã£ã¡ã‚’ä½¿ã†\r\n\r\nå¤šåˆ†ã“ã‚“ãªæ„Ÿã˜ã ã¨æ€ã†ã€‚\r\n\r\n## Material3ç‰ˆSurface ã® tonalElevation\r\n`Surface`ã®å¼•æ•°ã®èª¬æ˜è¦‹ã‚‹ã¨ã“ã†ã§ã™ã€‚\r\n\r\n```\r\nã‚«ãƒ©ãƒ¼ãŒColorScheme.surfaceã®å ´åˆã€æ¨™é«˜ãŒé«˜ã„ã»ã©ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒã§ã¯è‰²ãŒæ¿ƒããªã‚Šã€ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒã§ã¯è‰²ãŒè–„ããªã‚Šã¾ã™ã€‚\r\n\r\nDeepLç¿»è¨³\r\n```\r\n\r\nã¨ã„ã†ã‚ã‘ã§`Surface`ã®èƒŒæ™¯è‰²ãŒ`ColorScheme.surface`ã®å ´åˆã¯`tonalElevation`ã‚’è€ƒæ…®ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã‚ã‘ã§ã™ã€‚ãˆï¼Ÿãã‚“ãªã®ã©ã†ã§ã‚‚ã„ã„ã ã£ã¦ï¼Ÿ\r\n\r\n### NavigationBarã®è‰²ã«ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®è‰²ã‚’è¨­å®šã—ãŸã„\r\n\r\n`NavigationBar`ã®è‰²ã¯`ColorScheme.surface`ãªè¨³ã§ã™ãŒã€`tonalElevation`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã®ã§ãã®ã¾ã¾ã§ã¯åŒã˜è‰²ã«ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚\r\n\r\n```kotlin\r\nval context = LocalContext.current\r\nval surfaceColor = MaterialTheme.colorScheme.surface\r\nLaunchedEffect(key1 = surfaceColor, block = {\r\n    (context as? Activity)?.window?.navigationBarColor = Color.argb(\r\n        surfaceColor.toArgb().alpha,\r\n        surfaceColor.toArgb().red,\r\n        surfaceColor.toArgb().green,\r\n        surfaceColor.toArgb().blue,\r\n    )\r\n})\r\n```\r\n\r\nãã®ãŸã‚ã«`ColorScheme.surfaceColorAtElevation`ã®å®Ÿè£…ã‚’ãŠå€Ÿã‚Šã—ã¾ã™ã€‚  \r\n`surfaceColorAtElevation`è‡ªä½“ã‚’ä½¿ãˆã‚Œã°ã„ã„ã‚“ã§ã™ã‘ã©`internal`ã§ä¿è­·ã•ã‚Œã¦ã„ã¦ç„¡ç†ã§ã—ãŸã€‚\r\n\r\n```kotlin\r\nfun ColorScheme.applyTonalElevation(\r\n    elevation: Dp,\r\n): androidx.compose.ui.graphics.Color {\r\n    if (elevation == 0.dp) return surface\r\n    val alpha = ((4.5f * ln(elevation.value + 1)) + 2f) / 100f\r\n    return primary.copy(alpha = alpha).compositeOver(surface)\r\n}\r\n```\r\n\r\nã‚ã¨ã¯æ›¸ãæ›ãˆã¦\r\n\r\n```kotlin\r\nval context = LocalContext.current\r\nval bottomNavColor = MaterialTheme.colorScheme.applyTonalElevation(3.dp)\r\nLaunchedEffect(key1 = bottomNavColor, block = {\r\n    (context as? Activity)?.window?.navigationBarColor = Color.argb(\r\n        bottomNavColor.toArgb().alpha,\r\n        bottomNavColor.toArgb().red,\r\n        bottomNavColor.toArgb().green,\r\n        bottomNavColor.toArgb().blue,\r\n    )\r\n})\r\n```\r\n\r\nã“ã‚Œã§ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒãƒ¼ã®è‰²ã‚’è¨­å®šã§ãã¾ã—ãŸã€‚  \r\n\r\n![Imgur](https://imgur.com/F2wVIwz.png)\r\n\r\n# çµ‚ã‚ã‚Šã«\r\n\r\nAndroid 12L ã£ã¦ã®ãŒç™ºè¡¨ã•ã‚ŒãŸã¿ãŸã„ã§ã™ã­ã€‚ãˆï¼ŸAndroid 3.0ï¼ŸçŸ¥ã‚‰ãªã„ã§ã™ã­ï¼Ÿï¼ˆå›½ç”£å…¨ç››æœŸï¼Ÿï¼‰"},{"title":"Jetpack Composeã§ã‚‚èƒŒæ™¯æŠ¼ã—ãŸã‚‰TextFieldã®ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’å¤–ã™","link":"/posts/android_jc_focus_requester/","markdown":"\r\n#DroidKaigiã®è·ç‰©å±Šãã¾ã—ãŸã€‚ãƒ‰ãƒ­ã‚¤ãƒ‰å›ã‹ã‚ã„ã„\r\n\r\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">ãƒ‰ãƒ­ã‚¤ãƒ‰å›ã‹ã‚ã„ã„<a href=\"https://twitter.com/hashtag/DroidKaigi?src=hash&amp;ref_src=twsrc%5Etfw\">#DroidKaigi</a> <a href=\"https://t.co/zKheIh1M6F\">pic.twitter.com/zKheIh1M6F</a></p>&mdash; ãŸãã•ã‚“ (@takusan__23) <a href=\"https://twitter.com/takusan__23/status/1448877475254079488?ref_src=twsrc%5Etfw\">October 15, 2021</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\r\n\r\nAndroid Developersã®ã‚·ãƒ¼ãƒ«ã€è²´é‡ã§ã¯\r\n\r\n# ã‚³ãƒ¼ãƒ‰\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            ReleaseTextFieldFocusTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(color = MaterialTheme.colors.background) {\r\n\r\n                    // è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã‚’ç§»å‹•ã•ã›ã‚‹ã®ã«ä½¿ã†\r\n                    val focusRequester = remember { FocusRequester() }\r\n                    val interactionSource = remember { MutableInteractionSource() }\r\n\r\n                    Column(\r\n                        modifier = Modifier\r\n                            .fillMaxSize()\r\n                            .clickable(\r\n                                interactionSource = interactionSource,\r\n                                enabled = true,\r\n                                indication = null,\r\n                                onClick = { focusRequester.requestFocus() } // æŠ¼ã—ãŸã‚‰å¤–ã™\r\n                            )\r\n                            .focusRequester(focusRequester) // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹æ“ä½œã™ã‚‹ã‚„ã¤ã‚’ã‚»ãƒƒãƒˆ\r\n                            .focusTarget(), // ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å½“ãŸã‚‹ã‚ˆã†ã«\r\n                        verticalArrangement = Arrangement.Center,\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n\r\n                        val text = remember { mutableStateOf(\"\") }\r\n\r\n                        OutlinedTextField(\r\n                            modifier = Modifier\r\n                                .fillMaxWidth()\r\n                                .padding(10.dp),\r\n                            value = text.value,\r\n                            label = { Text(text = \"ãƒ•ã‚©ãƒ¼ã‚«ã‚¹å¤–ã™ã‚µãƒ³ãƒ—ãƒ«\") },\r\n                            onValueChange = { text.value = it }\r\n                        )\r\n\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`Modifier.clickable()`ã®å¼•æ•°ãŒå¤šã„ç†ç”±ã¯RippleåŠ¹æœã‚’ç„¡ãã™ãŸã‚ã§ã™ã€‚  \r\nä»¥ä¸Šã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚"},{"title":"ä»–ã®äººãŒä½œã£ãŸJetpack Composeã®ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒªãŒãƒ“ãƒ«ãƒ‰ã§ããªã‹ã£ãŸè©±","link":"/posts/android_jc_gradle_err/","markdown":"\r\nWWDCã®å­£ç¯€ã§ã™ã­ã€‚WWDCã‚’è¦‹ã‚‹ã¨ãã¯ã„ã¤ã‚‚**macwebcasterã®åŒæ™‚ç¿»è¨³**ãŒå±…ãŸã®ã§ã™ãŒã€ä»Šå¹´ã‹ã‚‰ã¯å±…ã¾ã›ã‚“ã€‚  \r\nãªã®ã§ä»Šå›ã®ç™ºè¡¨ä¼šã§æ°—ã«ãªã‚‹ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã®ã‚¢ãƒ³ã‚±ãƒ¼ãƒˆã‚‚ã‚ã‚Šã¾ã›ã‚“ã€‚å¯‚ã—ã„ã­ã€‚\r\n\r\n# æœ¬é¡Œ\r\nhttps://github.com/Gurupreet/ComposeCookBook\r\n\r\nã‚’Cloneã—ã¦ãƒ“ãƒ«ãƒ‰ã—ãŸã„ã‚“ã ã‘ã©ãªã‚“ã‹ã§ããªã‹ã£ãŸã€‚\r\n\r\n# ä»ŠåŒ—ç”£æ¥­\r\n\r\n`Android Studio`å·¦ä¸Šã®`File`ã‹ã‚‰ã€`Project Structure...`ã‚’é¸ã³ã€`Gradle Version`ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã—ã¦ã€`Try Again`ã—ãŸã‚ã¨ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æˆ»ã—ãŸã‚‰ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/WYJR2kZ.png)\r\n\r\n# ç¬¬ä¸€é–¢é–€\r\n\r\n```\r\nUnsupported Kotlin plugin version.\r\nUnresolved reference: compileSdk\r\n```\r\n\r\nã“ã‚Œã¯ã€`Android Studio`å·¦ä¸Šã®`File`ã‹ã‚‰ã€`Project Structure...`ã‚’é¸æŠã—ã¦ã€`Gradle Version`ã‚’ä¸Šã’ãŸã‚‰ãªã‚“ã‹ç›´ã£ãŸã€‚\r\n\r\n# ç¬¬äºŒé–¢é–€\r\n\r\nã‚¨ãƒ©ãƒ¼ã®æ•°ã¯æ¸›ã‚Šã¾ã—ãŸãŒã¾ã é€šã‚Šã¾ã›ã‚“ã€‚\r\n\r\n```\r\nMultiple builders are available to build a model of type 'org.jetbrains.plugins.gradle.model.internal.DummyModel'.\r\n```\r\n\r\nä»Šåº¦ã¯`Gradle Version`ã‚’ã‚‚ã¨ã«æˆ»ã—ãŸã‚‰ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\n`build.gradle.kts`ã«ç§»è¡Œã™ã¹ããªã®ã‹ãªã€‚`ext`ã®å¤‰æ•°ã¯è£œå……åŠ¹ã‹ãªã„ã—ã€‚  \r\n`buildSrc`ã«ã‚ˆã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç®¡ç†è‰¯ã•ãã†ã€‚\r\n\r\n# ãŠã¾ã‘\r\nã‚·ã‚¹ãƒ†ãƒ ãƒ‰ãƒ©ã‚¤ãƒ–ãŒå®¹é‡ä¸è¶³ã«ãªã£ãŸã®ã§ä»¥ä¸‹ã‚’æ¶ˆã—ãŸã€‚\r\n\r\n- `C:\\Users\\ãƒ¦ãƒ¼ã‚¶ãƒ¼å\\.gradle\\wrapper\\dists`\r\n    - ä½¿ã£ã¦ãªã„`Gradle`ã‚’æ¶ˆãã†ã€‚\r\n- `C:\\Users\\ãƒ¦ãƒ¼ã‚¶ãƒ¼å\\AppData\\Local\\Android\\Sdk\\system-images`\r\n    - å¤ã„Androidã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¨ã‹ä½¿ã£ã¦ãªã„ã‹ã‚‰æ¶ˆãã†ã€‚\r\n\r\nã‚ã¨ã‚·ã‚¹ãƒ†ãƒ ãƒ‰ãƒ©ã‚¤ãƒ–ã ã‘ã˜ã‚ƒãªãã¦RAMã‚‚è¶³ã‚Šãªãã¦ã—ã‚“ã©ã„ã€‚16GBã§è¶³ã‚Šãªããªã‚‹ã¨ã‹ãƒã‚¸ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/Jtqw95M.png)"},{"title":"Jetpack Composeã®ç·´ç¿’","link":"/posts/android_jc_hihyou_kuukan_client/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \n\nã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³ã‚’å®Œèµ°ã—ã¾ã—ãŸã€‚  \n\nã“ã¨ã­ã¡ã‚ƒã‚“ãŒå¯æ„›ã‹ã£ãŸã§ã™ã€‚ç¶šããŒæ°—ã«ãªã‚‹ã‹ã‚‰å¾Œæ—¥è«‡ã¿ãŸã„ãªã®ãŒæ¬²ã—ã„ã¨æ€ã£ãŸã€‚      \nBGMãƒ¢ãƒ¼ãƒ‰ã§OPã®æ›²ãŒèã‘ãªã„ã®ã§åˆå›é™å®šç‰ˆã‚’è²·ãˆã°ã‚ˆã‹ã£ãŸã‹ãªã£ã¦ã¡ã‚‡ã£ã¨å¾Œæ‚”ã—ã¦ãŸã‚Šã‚‚ã™ã‚‹ã€‚  \n\n<img src=\"https://imgur.com/CNT3gWS.png\" width=\"500\">\n\n# æœ¬é¡Œ\nJetpackComposeã§ErogameScapeã®æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã£ã¦ã¿ã¾ã™ã€‚\n\n## ç’°å¢ƒ\n| ãªã¾ãˆ          | ã‚ãŸã„ |\n|-----------------|--------|\n| Jetpack Compose | Beta05 |\n\n## ä»Šå›ã®ä»•çµ„ã¿çš„ãª\n[ErogameScape](https://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/sql_for_erogamer_form.php)ã£ã¦ã„ã†ã‚¨ãƒ­ã‚²å°‚é–€ã‚µã‚¤ãƒˆãŒã‚ã‚‹ã‚“ã§ã™ãŒã€ã“ã‚ŒSQLã‚’æ›¸ã„ã¦POSTã™ã‚‹ã¨ãªã‚“ã¨ãƒ‡ãƒ¼ã‚¿ãŒè¿”ã£ã¦ãã¾ã™ã€‚ã“ã®ã‚µã‚¤ãƒˆã‚„ã°ã„\n\n```sql\nSELECT * FROM gamelist WHERE gamename = 'å½¼å¥³ã®ã‚»ã‚¤ã‚¤ã‚­'\n```\n\n<img src=\"https://imgur.com/BfK6Eea.png\" width=\"500\">\n\n### ä½¿ã†ãƒ†ãƒ¼ãƒ–ãƒ«\n- gamelist\n    - ã‚²ãƒ¼ãƒ æƒ…å ±ãŒå…¥ã£ã¦ã„ã‚‹\n- brandlist\n    - gamelistã«ã¯ãƒ–ãƒ©ãƒ³ãƒ‰åãŒå…¥ã£ã¦ãªã„ã®ã§åˆ¥ã«å–å¾—\n- campaign_gameã€campaignlist\n    - ï¼ˆã¤ã„ã§ãªã®ã§ï¼‰ã‚»ãƒ¼ãƒ«ä¸­ã®ã‚²ãƒ¼ãƒ ãŒå…¥ã£ã¦ã‚‹\n\n`campaign_game`ãƒ†ãƒ¼ãƒ–ãƒ«ãªã‚“ã§ã™ãŒã€ãªã‚“ã‹[ã“ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§](https://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/sql_for_erogamer_tablelist.php)ã«ã¯ä¹—ã£ã¦ã„ãªã„ã®ã§ã™ãŒã€ä»–ã®äººãŒæ›¸ã„ãŸSQLã§ã¯ãªãœã‹ã‚»ãƒ¼ãƒ«ä¸­ã®ã‚²ãƒ¼ãƒ ãŒå–å¾—ã§ãã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \nãã‚Œã§ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ã‚’è¿”ã™SQLã‚’æ›¸ã„ã¦è¦‹ã‚‹ã¨ãŸã—ã‹ã«ã‚ã‚‹ã‚“ã§ã™ã­ã€‚ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¦§ã®ã‚µã‚¤ãƒˆãŒæ›´æ–°ã•ã‚Œã¦ã„ãªã„ã ã‘ã‹ãªã€‚\n\n```sql\nSELECT * FROM pg_tables\n```\n\n### ä»Šå›ä½¿ã†SQLæ–‡\nJetpackComposeãŒæœ¬é¡Œãªã®ã«æ™‚é–“ãŒã‹ã‹ã£ã¦ã—ã¾ã£ãŸã€‚  \nã‚²ãƒ¼ãƒ ã®æƒ…å ±ã®ã»ã‹ã€ãƒ–ãƒ©ãƒ³ãƒ‰åã€ã‚»ãƒ¼ãƒ«ä¸­ãªã‚‰ã‚»ãƒ¼ãƒ«æƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\n\n```sql\nSELECT DISTINCT g.id,\n    g.gamename,\n    c.content,\n    c.name,\n    c.end_timestamp,\n    g.furigana,\n    g.sellday,\n    g.brandname,\n    b.brandname,\n    g.model,\n    COALESCE(g.median, -1) AS median,\n    COALESCE(g.average2, -1) AS average2,\n    COALESCE(g.stdev, -1) AS stdev,\n    COALESCE(g.count2, -1) AS count2,\n    g.dmm,\n    COALESCE(g.max2, -1) AS max2,\n    COALESCE(g.min2, -1) AS min2,\n    g.shoukai\nFROM gamelist g\n    INNER JOIN brandlist b ON g.brandname = b.id\n    LEFT OUTER JOIN (\n        SELECT g.content,\n            l.name,\n            g.game,\n            l.end_timestamp\n        FROM campaign_game g\n            INNER JOIN campaignlist l ON g.campaign = l.id\n        WHERE l.end_timestamp > now()\n    ) c ON g.id = c.game\nWHERE g.gamename = 'ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³'\n```\n\n<div style=\"overflow-y:scroll\">\n<table>\n<tbody><tr><th>id</th><th>gamename</th><th>content</th><th>name</th><th>end_timestamp</th><th>furigana</th><th>sellday</th><th>brandname</th><th>brandname</th><th>model</th><th>median</th><th>average2</th><th>stdev</th><th>count2</th><th>dmm</th><th>max2</th><th>min2</th><th>shoukai</th></tr>\n<tr><td>27418</td><td>ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³</td><td></td><td></td><td></td><td>ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³</td><td>2019-03-29</td><td>84</td><td>æˆ¯ç”»</td><td>PC</td><td>82</td><td>80</td><td>13</td><td>348</td><td>eg_0012</td><td>100</td><td>0</td><td>http://products.web-giga.com/aonatsu/</td></tr>\n<tr><td>29203</td><td>ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³</td><td></td><td></td><td></td><td>ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³</td><td>2020-04-23</td><td>781</td><td>ã‚¨ãƒ³ã‚¿ãƒ¼ã‚°ãƒ©ãƒ </td><td>PS4</td><td>78</td><td>78</td><td>18</td><td>2</td><td></td><td>90</td><td>65</td><td>http://www.entergram.co.jp/aonatsu/</td></tr>\n<tr><td>29204</td><td>ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³</td><td></td><td></td><td></td><td>ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³</td><td>2020-04-23</td><td>781</td><td>ã‚¨ãƒ³ã‚¿ãƒ¼ã‚°ãƒ©ãƒ </td><td>PSV</td><td>87</td><td>87</td><td>3</td><td>3</td><td></td><td>90</td><td>85</td><td>http://www.entergram.co.jp/aonatsu/</td></tr>\n</tbody></table>\n</div >\n\nã‚»ãƒ¼ãƒ«ä¸­ãªã‚‰ã“ã†ãªã‚Šã¾ã™ã€‚\n\n<div style=\"overflow-y:scroll\">\n<table>\n<tbody><tr><th>id</th><th>gamename</th><th>content</th><th>name</th><th>end_timestamp</th><th>furigana</th><th>sellday</th><th>brandname</th><th>brandname</th><th>model</th><th>median</th><th>average2</th><th>stdev</th><th>count2</th><th>dmm</th><th>max2</th><th>min2</th><th>shoukai</th></tr>\n<tr><td>20228</td><td>å½¼å¥³ã®ã‚»ã‚¤ã‚¤ã‚­</td><td>1,017å†† 50%OFF</td><td>  ã‚¹ãƒ—ãƒªãƒ³ã‚°ã‚»ãƒ¼ãƒ« 2021</td><td>2021-05-10 17:00:00</td><td>ã‚«ãƒã‚¸ãƒ§ãƒã‚»ã‚¤ã‚¤ã‚­</td><td>2014-12-19</td><td>702</td><td>feng</td><td>PC</td><td>75</td><td>74</td><td>9</td><td>665</td><td>feng_0003</td><td>100</td><td>10</td><td>http://www.feng.jp/seiiki/</td></tr>\n</tbody></table>\n</div>\n\n#### ç°¡å˜ã«è§£èª¬\n`SELECT`ã¯å–ã‚Šå‡ºã™åˆ—ã‚’æ›¸ãå‡ºã—ã¦ã„ãã¾ã™ã€‚  \n`FROM`ã¯ã©ã“ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–ã‚Šå‡ºã™ã‹ã§ã™ã€‚ã¾ãšã¯ã‚²ãƒ¼ãƒ ã®æƒ…å ±ã®å…¥ã£ã¦ã‚‹ãƒ†ãƒ¼ãƒ–ãƒ«ã§ã™ã­ã€‚  \nãã‚Œã‹ã‚‰ã€`INNER JOIN`ã‚’åˆ©ç”¨ã—ã¦ãƒ–ãƒ©ãƒ³ãƒ‰åãƒ†ãƒ¼ãƒ–ãƒ«ã‚’çµåˆã—ã¾ã™ã€‚`ON`ã®ã‚ã¨ã®æ¡ä»¶å¼ã«å½“ã¦ã¯ã¾ã‚Œã°çµåˆã•ã‚Œã¾ã™ã€‚  \nè¤‡æ•°ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’æ‰±ã†å ´åˆã¯ãƒ†ãƒ¼ãƒ–ãƒ«åã®ã‚ã¨ã«åå‰ã‚’ã¤ã‘ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ï¼ˆã“ã®ä¾‹ã§ã¯`g`ã¨ã‹`b`ã¨ã‹ï¼‰  \n\n`COALESCE`ã£ã¦ã®ã¯NULLã®ã¨ãã«å¤‰ã‚ã‚Šã«è¡¨ç¤ºã™ã‚‹å€¤ã‚’ã‚»ãƒƒãƒˆã§ãã‚‹ã‚„ã¤ã§ã™ã€‚ä»Šå›ã¯NULLã®å ´åˆ`-1`ã‚’å…¥ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚  \n`AS åå‰`ã¯åˆ—ã®åå‰ã‚’å¤‰ãˆã‚‹ã¨ãã«ä½¿ã†ã‚“ã§ã™ãŒä»Šå›ã¯ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°ã—ã¡ã‚ƒã†ã®ã§ã‚ã‚“ã¾ã‚Šé–¢ä¿‚ãªã„ã€‚\n\n#### ã‚»ãƒ¼ãƒ«ä¸­ãªã‚‰ã‚»ãƒ¼ãƒ«æƒ…å ±ã‚’å–ã‚‹\n`LEFT OUTER JOIN`ã£ã¦ã„ã†ã®ã¯ã€`ON`ã®æ¡ä»¶å¼ãŒå½“ã¦ã¯ã¾ã‚‰ãªã„ã¨ãã«ã¯ä»£ã‚ã‚Šã«NULLã‚’å…¥ã‚Œã¦ãã‚Œã‚‹ã‚„ã¤ã§ã™ã€‚  \n`INNER JOIN`ã‚’ä½¿ã£ã¦ã—ã¾ã†ã¨ã‚»ãƒ¼ãƒ«ã—ã¦ã‚‹ã¨ãã¯è¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ã‚»ãƒ¼ãƒ«ã—ã¦ãªã„ã¨ãã¯è¡¨ç¤ºã•ã‚Œãªããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚  \n\nã§ã€`LEFT OUTER JOIN`ã®ã‚ã¨ã®`SELECT`ã§ã™ãŒã€ã“ã‚Œã¯ã‚µãƒ–ã‚¯ã‚¨ãƒªã£ã¦å‘¼ã°ã‚Œã‚‹ã‚„ã¤ã§ã‚¯ã‚¨ãƒªå†…ã§ä½¿ã†å€¤ã‚’ã‚¯ã‚¨ãƒªã‚’ä½¿ã£ã¦å–ã‚Šå‡ºã™ã¨ãã«ä½¿ã„ã¾ã™ã€‚  \n\n```sql\nSELECT g.content,\n    l.name,\n    g.game,\n    l.end_timestamp\nFROM campaign_game g\n    INNER JOIN campaignlist l ON g.campaign = l.id\nWHERE l.end_timestamp > now()\n```\n\nã“ã®ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå†…å®¹ãŒè¿”ã£ã¦ãã¾ã™ã€‚`campaign_game`ã¨`campaignlist`ã®ãƒ†ãƒ¼ãƒ–ãƒ«ã‚’çµåˆã—ã¦ã€ã‚»ãƒ¼ãƒ«ä¸­ã§ã‚ã‚‹ã‚‚ã®ã‚’å–å¾—ã™ã‚‹ã‚¯ã‚¨ãƒªã§ã™ã€‚  \n\n| content        | name                  | game  | end_timestamp       |\n|----------------|-----------------------|-------|---------------------|\n| 1,017å†† 50%OFF | ã‚¹ãƒ—ãƒªãƒ³ã‚°ã‚»ãƒ¼ãƒ« 2021 | 20228 | 2021-05-10 17:00:00 |\n\nã“ã®çµæœã‚’ã€`LEFT OUTER JOIN`ã§çµåˆã—ã¾ã™ã€‚ä¸Šã®ã‚µãƒ³ãƒ—ãƒ«ã§ã¯`c`ã‚’ã‚¯ã‚¨ãƒªçµæœã®åå‰ã¨ã—ã¦æŒ‡å®šã—ã¦ã„ã‚‹ãŸã‚ã€`c.content`ã§ã‚»ãƒ¼ãƒ«ã®å€¤æ®µã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n\n`WHERE g.gamename = 'ã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³'`ã¯ã‚²ãƒ¼ãƒ åãŒã€Œã‚¢ã‚ªãƒŠãƒ„ãƒ©ã‚¤ãƒ³ã€ã¨ä¸€è‡´ã™ã‚‹ã‚‚ã®ã‚’å–å¾—ã™ã‚‹ã¨ã„ã†æ„å‘³ã§ã™ã€‚\n\nç–²ã‚ŒãŸã®ã§ã‚ã¨ã¯å„è‡ªèª¿ã¹ã¦ã€‚\n\nãã®ä»–ä½¿ã†ã‚‚ã®ã¨ã—ã¦ã¯\n\n- ViewModel / LiveData\n    - SQLã‚’POSTã™ã‚‹å‡¦ç†ã‚’Activityã«æ›¸ãã‚ã‘ã«è¡Œã‹ãªã„ã®ã§\n- OkHttp\n    - POSTã™ã‚‹ã¨ãã«ä½¿ã†\n- Jsoup\n    - POSTã—ãŸçµæœã‚’å–ã‚Šå‡ºã™ãŸã‚\n- Glide\n    - ç”»åƒèª­ã¿è¾¼ã¿\n- Coroutine\n    - éåŒæœŸå‡¦ç†ãŠåŠ©ã‘\n\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå…¥ã‚Œã‚‹\n\n```gradle\ndependencies {\n\n    // OkHttp\n    implementation(\"com.squareup.okhttp3:okhttp:4.9.1\")\n    // HTML Parser\n    implementation 'org.jsoup:jsoup:1.13.1'\n    // Coroutineã¨LifeCycleè€ƒãˆã¦ãã‚Œã‚‹ã‚„ã¤\n    implementation \"androidx.lifecycle:lifecycle-runtime-ktx:2.3.1\"\n    // Coroutines\n    implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.3\"\n    // ViewModel\n    implementation \"androidx.lifecycle:lifecycle-viewmodel-ktx:2.3.1\"\n    // LiveData\n    implementation \"androidx.lifecycle:lifecycle-livedata-ktx:2.3.1\"\n    // Glide\n    implementation 'com.github.bumptech.glide:glide:4.11.0'\n    // Composeã§LiveData\n    implementation \"androidx.compose.runtime:runtime-livedata:$compose_version\"\n    \n    // ä»¥ä¸‹çœç•¥\n\n}\n```\n\n## AndroidManifest.xml\nã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆãƒ‘ãƒ¼ãƒŸãƒƒã‚·ãƒ§ãƒ³ã‚’å¿˜ã‚Œãšã«\n\n## ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹\n\n`GameData.kt`\n\n```kotlin\n/**\n * ã‚²ãƒ¼ãƒ æƒ…å ±\n *\n * https://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/sql_for_erogamer_tablelist.php\n *\n * @param id ID\n * @param gamename åå‰\n * @param brandname_id ãƒ–ãƒ©ãƒ³ãƒ‰ã®ID\n * @param brandname ãƒ–ãƒ©ãƒ³ãƒ‰å\n * @param content ã‚»ãƒ¼ãƒ«æƒ…å ±\n * @param endTimeStamp ã‚»ãƒ¼ãƒ«çµ‚äº†æ—¥æ™‚\n * @param model PCã¨ã‹PSVã¨ã‹\n * @param name ã‚»ãƒ¼ãƒ«å\n * @param furigana åå‰ã®ãµã‚ŠãŒãª\n * @param sellday ç™ºå£²æ—¥\n * @param median å¾—ç‚¹ä¸­å¤®å€¤\n * @param average2 å¹³å‡å€¤\n * @param stdev æ¨™æº–åå·®\n * @param count2 å¾—ç‚¹ãƒ‡ãƒ¼ã‚¿æ•°\n * @param dmm DMMï¼ˆFANZAï¼‰ã®URLã®ä¸€éƒ¨\n * @param max2 æœ€é«˜å¾—ç‚¹\n * @param min2 æœ€ä½å¾—ç‚¹\n * @param shoukai ã‚ªãƒ•ã‚£ã‚·ãƒ£ãƒ«HPã®URL\n * */\ndata class GameData(\n    val id: Int,\n    val gamename: String,\n    val content: String,\n    val name: String,\n    val endTimeStamp: String,\n    val furigana: String,\n    val sellday: String,\n    val brandname_id: Int,\n    val brandname: String,\n    val model: String,\n    val median: Int,\n    val average2: Int,\n    val stdev: Int,\n    val count2: Int,\n    val dmm: String,\n    val max2: Int,\n    val min2: Int,\n    val shoukai: String,\n)\n```\n\n## ãƒ‡ãƒ¼ã‚¿å–å¾—é–¢æ•°ã‚’æ›¸ã\n\n\n`ErogameScape.kt`\n\n```kotlin\n/**\n * https://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/sql_for_erogamer_tablelist.php\n * */\nobject ErogameScape {\n\n    private val okHttpClient = OkHttpClient()\n\n    /**\n     * ã‚²ãƒ¼ãƒ æƒ…å ±ã‚’å–å¾—ã™ã‚‹\n     *\n     * @param gameName ã‚²ãƒ¼ãƒ åã€‚ã€Œå½¼å¥³ã®ã‚»ã‚¤ã‚¤ã‚­ã€ãªã©\n     * @return æˆåŠŸã™ã‚Œã°[GameData]ã®é…åˆ—ï¼ˆã‚³ãƒ³ã‚·ãƒ¥ãƒ¼ãƒãƒ¼ç§»æ¤ãªã©ãŒã‚ã‚‹ãŸã‚ï¼‰\n     * */\n    suspend fun getGameInfo(gameName: String) = withContext(Dispatchers.Default) {\n        // ã‚²ãƒ¼ãƒ æƒ…å ±é…åˆ—\n        val gameInfoList = arrayListOf<GameData>()\n        // POSTå†…å®¹\n        val sql = \"\"\" \n SELECT DISTINCT g.id,\n    g.gamename,\n    c.content,\n    c.name,\n    c.end_timestamp,\n    g.furigana,\n    g.sellday,\n    g.brandname,\n    b.brandname,\n    g.model,\n    COALESCE(g.median, -1) AS median,\n    COALESCE(g.average2, -1) AS average2,\n    COALESCE(g.stdev, -1) AS stdev,\n    COALESCE(g.count2, -1) AS count2,\n    g.dmm,\n    COALESCE(g.max2, -1) AS max2,\n    COALESCE(g.min2, -1) AS min2,\n    g.shoukai\nFROM gamelist g\n    INNER JOIN brandlist b ON g.brandname = b.id\n    LEFT OUTER JOIN (\n        SELECT g.content,\n            l.name,\n            g.game,\n            l.end_timestamp\n        FROM campaign_game g\n            INNER JOIN campaignlist l ON g.campaign = l.id\n        WHERE l.end_timestamp > now()\n    ) c ON g.id = c.game\nWHERE g.gamename = '$gameName'\n \"\"\"\n        val formData = FormBody.Builder().apply {\n            add(\"sql\", sql)\n        }.build()\n        val request = Request.Builder().apply {\n            url(\"https://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/sql_for_erogamer_form.php\")\n            post(formData)\n        }.build()\n        // POSTãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã™\n        val response = okHttpClient.newCall(request).execute()\n        // ã‚¹ã‚¯ãƒ¬ã‚¤ãƒ”ãƒ³ã‚°\n        if (response.isSuccessful) {\n            val document = Jsoup.parse(response.body!!.string())\n            val trElementList = document.getElementsByTag(\"tr\")\n            repeat(trElementList.size - 1) {\n                // ãƒ†ãƒ¼ãƒ–ãƒ«ä¸€è¡Œç›®ã¯ã„ã‚‰ãªã„\n                val index = it + 1\n                val trElement = trElementList[index]\n                val tdList = trElement.getElementsByTag(\"td\")\n                val id = tdList[0].text().toInt()\n                val gamename = tdList[1].text()\n                val content = tdList[2].text()\n                val name = tdList[3].text()\n                val end_time_stamp = tdList[4].text()\n                val furigana = tdList[5].text()\n                val sellday = tdList[6].text()\n                val brandname_id = tdList[7].text().toInt()\n                val brandname = tdList[8].text()\n                val model = tdList[9].text()\n                val median = tdList[10].text().toInt()\n                val average2 = tdList[11].text().toInt()\n                val stdev = tdList[12].text().toInt()\n                val count2 = tdList[13].text().toInt()\n                val dmm = tdList[14].text()\n                val max2 = tdList[15].text().toInt()\n                val min2 = tdList[16].text().toInt()\n                val shoukai = tdList[17].text()\n                // ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã¸\n                val gameData = GameData(\n                    id,\n                    gamename,\n                    content,\n                    name,\n                    end_time_stamp,\n                    furigana,\n                    sellday,\n                    brandname_id,\n                    brandname,\n                    model,\n                    median,\n                    average2,\n                    stdev,\n                    count2,\n                    dmm,\n                    max2,\n                    min2,\n                    shoukai,\n                )\n                gameInfoList.add(gameData)\n            }\n        }\n        return@withContext gameInfoList\n    }\n\n}\n```\n\n## ViewModel\n`MainViewModel.kt`\n\né€šä¿¡ã¯ã“ã“ã§ã‚„ã£ã¦ã‚‹ã€‚\n\n```kotlin\n/**\n * [MainActivity]ã§ä½¿ã†ViewModel\n * */\nclass MainViewModel(application: Application) : AndroidViewModel(application) {\n\n    private val context = application.applicationContext\n\n    private val _gameInfoLiveData = MutableLiveData<GameData>()\n\n    /** çµæœã‚’é€ä¿¡ã™ã‚‹LiveData */\n    val gameInfoLiveData = _gameInfoLiveData as LiveData<GameData>\n\n    /**\n     * ã‚²ãƒ¼ãƒ ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°\n     * @param gameName ã‚²ãƒ¼ãƒ åã€‚ã€Œå½¼å¥³ã®ã‚»ã‚¤ã‚¤ã‚­ã€ãªã©\n     * */\n    fun getGameInfo(gameName: String) {\n        viewModelScope.launch {\n            val data = ErogameScape.getGameInfo(gameName)\n            if (data != null) {\n                _gameInfoLiveData.postValue(data!!)\n            }\n        }\n    }\n\n}\n```\n\n# JetpackCompose\nViewModelã§å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚\n\n## å„ç¨®éƒ¨å“ã‚’ç”¨æ„ã™ã‚‹\næ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã¨ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®éƒ¨å“ã‚’\n\n`GameInfoUI.kt`\n\n```kotlin\n/**\n * æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹\n * */\n@Composable\nfun SearchBox(\n    searchText: String,\n    onChangeSearchText: (String) -> Unit,\n    onClickSearchButton: () -> Unit,\n) {\n    Card(\n        modifier = Modifier.padding(5.dp),\n        elevation = 10.dp,\n        shape = RoundedCornerShape(10.dp)\n    ) {\n        Row(modifier = Modifier.padding(start = 10.dp, end = 10.dp)) {\n            TextField(\n                modifier = Modifier.weight(1f),\n                trailingIcon = {\n                    IconButton(onClick = { onClickSearchButton() }) {\n                        Icon(\n                            painter = painterResource(R.drawable.ic_baseline_search_24),\n                            contentDescription = \"search\"\n                        )\n                    }\n                },\n                value = searchText,\n                onValueChange = { text -> onChangeSearchText(text) },\n                placeholder = { Text(text = \"ã‚®ãƒ£ãƒ«ã‚²ã€ã‚¨ãƒ­ã‚²ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥åŠ›\") },\n                maxLines = 1,\n                colors = TextFieldDefaults.textFieldColors(\n                    backgroundColor = Color.Transparent,\n                    focusedIndicatorColor = Color.Transparent,\n                    disabledIndicatorColor = Color.Transparent,\n                    errorIndicatorColor = Color.Transparent,\n                    unfocusedIndicatorColor = Color.Transparent,\n                )\n            )\n        }\n    }\n}\n\n/**\n * ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã®ç”»åƒã‚’è¡¨ç¤ºã™ã‚‹\n * */\n@Composable\nfun InternetImage(url: String) {\n    val bitmap = remember { mutableStateOf<Bitmap?>(null) }\n    Glide.with(LocalContext.current).asBitmap().load(url).into(object : CustomTarget<Bitmap>() {\n        override fun onResourceReady(resource: Bitmap, transition: Transition<in Bitmap>?) {\n            bitmap.value = resource\n        }\n\n        override fun onLoadCleared(placeholder: Drawable?) {\n\n        }\n    })\n    if (bitmap.value != null) {\n        Image(\n            bitmap = bitmap.value!!.asImageBitmap(),\n            contentDescription = \"å†™çœŸ\",\n            modifier = Modifier\n                .clip(RoundedCornerShape(10.dp))\n                .width(200.dp)\n                .height(200.dp)\n        )\n    }\n}\n\n/**\n * äºŒæ®µã®Textã€‚ä¸Šã®æ®µã®ã»ã†ãŒæ–‡å­—ãŒå¤§ãã„\n * */\n@Composable\nfun RankText(modifier: Modifier, title: String, value: String) {\n    Column(modifier, horizontalAlignment = Alignment.CenterHorizontally) {\n        Text(\n            text = value,\n            fontSize = 20.sp,\n            fontWeight = FontWeight.W500,\n            textAlign = TextAlign.Center,\n        )\n        Text(text = title)\n    }\n}\n```\n\n## çµæœç”»é¢\n\nUIä½œã‚‹ã®é›£ã—ã„ã€‚  \nã‚ã¨ã‚¢ã‚¤ã‚³ãƒ³ã‚’ https://fonts.google.com/icons ã‹ã‚‰æŒã£ã¦ããŸã®ã§å„è‡ªå…¥ã‚Œã¦ã­\n\n`GameInfoScreen.kt`\n\n```kotlin\n/**\n * ã‚²ãƒ¼ãƒ æƒ…å ±è¡¨ç¤ºç”»é¢\n * */\n@Composable\nfun GameInfoScreen(viewModel: MainViewModel) {\n    val context = LocalContext.current\n    // æ¤œç´¢ãƒ¯ãƒ¼ãƒ‰\n    val searchText = remember { mutableStateOf(\"\") }\n    // ã‚²ãƒ¼ãƒ æƒ…å ±LiveDataã‚’å¤‰æ›ã™ã‚‹\n    val gameInfoList = viewModel.gameInfoLiveDataList.observeAsState()\n\n    Scaffold(\n        topBar = {\n            SearchBox(searchText = searchText.value, onChangeSearchText = { searchText.value = it }) {\n                // æ¤œç´¢ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ã\n                viewModel.getGameInfo(searchText.value)\n            }\n        }\n    ) {\n        if (gameInfoList.value != null) {\n            // ä»Šå›ã¯ä¸€å€‹ã ã‘è¡¨ç¤º\n            val gameInfo = gameInfoList.value!![0]\n            // å†™çœŸURL\n            val imgUrl = \"https://pics.dmm.co.jp/digital/pcgame/${gameInfo.dmm}/${gameInfo.dmm}ps.jpg\"\n\n            Column {\n                // æƒ…å ±\n                Row {\n                    InternetImage(url = imgUrl)\n                    Column {\n                        Text(text = gameInfo.gamename, fontSize = 25.sp)\n                        Text(text = gameInfo.furigana)\n                        Text(text = gameInfo.brandname, fontSize = 20.sp)\n                        Text(text = \"ç™ºå£²æ—¥\\n${gameInfo.sellday}\")\n                    }\n                }\n                // ã‚»ãƒ¼ãƒ«æƒ…å ±ãŒã‚ã‚Œã°\n                if (gameInfo.content.isNotEmpty()) {\n                    Card(\n                        border = BorderStroke(1.dp, MaterialTheme.colors.primaryVariant),\n                        elevation = 0.dp,\n                        modifier = Modifier\n                            .padding(10.dp)\n                            .fillMaxWidth()\n                    ) {\n                        Column(modifier = Modifier.padding(10.dp)) {\n                            Text(text = \"${gameInfo.name} (${gameInfo.end_time_stamp} ã¾ã§)\")\n                            Text(text = gameInfo.content, fontSize = 20.sp)\n                        }\n                    }\n                }\n                // DMMã§è³¼å…¥ã™ã‚‹ãƒœã‚¿ãƒ³\n                Button(\n                    modifier = Modifier\n                        .padding(10.dp)\n                        .fillMaxWidth(),\n                    onClick = {\n                        context.startActivity(Intent(Intent.ACTION_VIEW, \"https://dlsoft.dmm.co.jp/detail/${gameInfo.dmm}/\".toUri()))\n                    },\n                ) {\n                    Icon(painter = painterResource(id = R.drawable.ic_store_black_24dp), contentDescription = \"shop\")\n                    Text(text = \"DMMã§è³¼å…¥ã™ã‚‹\")\n                }\n                // è©•ä¾¡ãªã©\n                Divider()\n                Row {\n                    RankText(\n                        modifier = Modifier\n                            .weight(1f)\n                            .padding(5.dp),\n                        \"æœ€é«˜å¾—ç‚¹\",\n                        gameInfo.max2.toString()\n                    )\n                    RankText(\n                        modifier = Modifier\n                            .weight(1f)\n                            .padding(5.dp),\n                        \"å¾—ç‚¹ä¸­å¤®å€¤\",\n                        gameInfo.median.toString()\n                    )\n                    RankText(\n                        modifier = Modifier\n                            .weight(1f)\n                            .padding(5.dp),\n                        \"æœ€ä½å¾—ç‚¹\",\n                        gameInfo.min2.toString()\n                    )\n                }\n                Row {\n                    RankText(\n                        modifier = Modifier\n                            .weight(1f)\n                            .padding(5.dp),\n                        \"å¾—ç‚¹ãƒ‡ãƒ¼ã‚¿æ•°\",\n                        gameInfo.count2.toString()\n                    )\n                    RankText(\n                        modifier = Modifier\n                            .weight(1f)\n                            .padding(5.dp),\n                        \"å¹³å‡å€¤\",\n                        gameInfo.average2.toString()\n                    )\n                    RankText(\n                        modifier = Modifier\n                            .weight(1f)\n                            .padding(5.dp),\n                        \"æ¨™æº–åå·®\",\n                        gameInfo.stdev.toString()\n                    )\n                }\n                Divider()\n                // ErogameScapeã§é–‹ã\n                OutlinedButton(\n                    modifier = Modifier\n                        .padding(10.dp)\n                        .fillMaxWidth(),\n                    onClick = {\n                        context.startActivity(Intent(Intent.ACTION_VIEW, \"https://erogamescape.dyndns.org/~ap2/ero/toukei_kaiseki/game.php?game=${gameInfo.id}\".toUri()))\n                    },\n                ) {\n                    Icon(painter = painterResource(id = R.drawable.ic_open_in_browser_black_24dp), contentDescription = \"shop\")\n                    Text(text = \"ErogameScapeã§é–‹ã\")\n                }\n            }\n        }\n    }\n}\n```\n\n## MainActivity\n\n```kotlin\nclass MainActivity : ComponentActivity() {\n\n    private val viewModel by viewModels<MainViewModel>()\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            ErogameScapeDroidTheme {\n                Surface(color = MaterialTheme.colors.background) {\n                    // ã‚²ãƒ¼ãƒ è©³ç´°ç”»é¢\n                    GameInfoScreen(viewModel = viewModel)\n                }\n            }\n        }\n    }\n}\n```\n\nå‹•ã‹ã™ã¨ã“ã‚“ãªæ„Ÿã˜\n\n<img src=\"https://imgur.com/SYlsfEY.png\" width=\"300\">\n<img src=\"https://imgur.com/pzYjBlU.png\" width=\"300\">\n\nUIä½œã‚‹ã®ã£ã¦é›£ã—ã„ã‚ˆãª\n\n# çµ‚ã‚ã‚Šã«\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚ã‚Šã¾ã™ã€‚  \n\nhttps://github.com/takusan23/ErogameScapeDroid/tree/efa4137b777c4e069ebc7fa3eda5fcbccdba7500"},{"title":"JetpackComposeã§è¦ªã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒã»ã—ã„","link":"/posts/android_jc_parent_component_click/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã©ã†ã§ã‚‚ã„ã„ã‚“ã§ã™ã‘ã©Next.jsã§ä½œã‚Šç›´ã—ãŸã“ã®ã‚µã‚¤ãƒˆã€Googleã«ç„¡äº‹å«Œã‚ã‚Œã¦ã„ã‚‹æ¨¡æ§˜\r\n\r\n![Imgur](https://imgur.com/UD5eqeu.png)\r\n\r\n![Imgur](https://imgur.com/JQOKdAD.png)\r\n\r\n# æœ¬é¡Œ\r\nJetpackComposeã§å­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã‚‹ã¨è¦ªã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã¯ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆãŒè²°ãˆã¾ã›ã‚“ã€‚  \r\nå­ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æ¶ˆè²»ã•ã‚Œã¦ã‚‚è¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ã¦ã»ã—ã„ã€‚\r\n\r\nã®ã§ä½œã£ãŸ\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„     |\r\n|----------------|------------|\r\n| Android        | 12         |\r\n| Android Studio | Bumblebee  |\r\n| Kotlin         | 1.6.10     |\r\n| Compose        | 1.1.0-rc03 |\r\n\r\n# ä½œã‚‹\r\n\r\n## ParentPointerEvent.kt\r\nãƒ•ã‚¡ã‚¤ãƒ«åã¯ä½•ã§ã‚‚ã„ã„ã§ã™ãŒã¨ã‚Šã‚ãˆãšä¸€ã¤Ktã‚’ä½œæˆã—ã¾ã™ã€‚\r\n\r\nãã—ã¦ä¸­èº«ã¯ã“ã‚Œ(ã”ã‚ã‚“ã‚³ãƒ¡ãƒ³ãƒˆéƒ¨åˆ†ã¯ã‚ã£ã¦ã‚‹ã‹ã©ã†ã‹åˆ†ã‹ã‚‰ã‚“)\r\n\r\n```kotlin\r\n/**\r\n * å­è¦ç´ ã§ã‚¿ãƒƒãƒ—ãŒæ¶ˆè²»ã®æœ‰ç„¡ã«é–¢ã‚ã‚‰ãšè¦ªè¦ç´ ã¸ã‚¿ãƒƒãƒã‚¤ãƒ™ãƒ³ãƒˆãŒè¡Œãã‚ˆã†ã«ã—ãŸã‚‚ã®\r\n *\r\n * @param onTap æŠ¼ã—ãŸã¨ã\r\n * */\r\nsuspend fun PointerInputScope.detectParentComponentTapGestures(onTap: ((Offset) -> Unit)? = null) = coroutineScope {\r\n    forEachGesture {\r\n        awaitPointerEventScope {\r\n            // awaitPointerEvent ã‚’ä½¿ã†ã“ã¨ã§ã‚¯ãƒªãƒƒã‚¯ãŒæ¶ˆè²»ã•ã‚Œã¦ã‚‹ã‹ã©ã†ã‹é–¢ä¿‚ãªãã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’å¾…æ©Ÿ\r\n            awaitPointerEvent()\r\n            var upOrCancel: PointerInputChange? = null\r\n            try {\r\n                upOrCancel = withTimeout(Long.MAX_VALUE / 2) {\r\n                    // ã“ã“ã§ã‚¿ãƒƒãƒ—åˆ¤å®šã‚’ã—ã¦ã„ã‚‹ã€‚é•·æŠ¼ã—ã¨ã‹ç”»é¢å¤–ã‚¿ãƒƒãƒã¯nullã«ãªã‚‹\r\n                    waitForUpIgnoreOrCancellation()\r\n                }\r\n                upOrCancel?.consumeDownChange()\r\n            } catch (_: PointerEventTimeoutCancellationException) {\r\n                consumeUntilUp()\r\n            }\r\n            if (upOrCancel != null) {\r\n                onTap?.invoke(upOrCancel.position)\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã‹ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹ã€‚\r\n * [AwaitPointerEventScope.waitForUpOrCancellation]ã§ã¯ä»–ã§ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¶ˆè²»ã•ã‚ŒãŸã‚‰ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã¾ã™ãŒã€\r\n * ã“ã‚Œã¯ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã®æ¶ˆè²»ã•ã‚Œã¦ã„ã¦ã‚‚ã‚­ãƒ£ãƒ³ã‚»ãƒ«æ‰±ã„ã—ã¾ã›ã‚“ã€‚\r\n *\r\n * @return ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰[PointerInputChange]ã€‚ãƒ‰ãƒ©ãƒƒã‚°æ“ä½œã‚„ã‚­ãƒ£ãƒ³ã‚»ãƒ«ãªã‚‰null\r\n * */\r\nprivate suspend fun AwaitPointerEventScope.waitForUpIgnoreOrCancellation(): PointerInputChange? {\r\n    while (true) {\r\n        val event = awaitPointerEvent(PointerEventPass.Main)\r\n        // ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¶ˆè²»ã•ã‚Œã¦ã‚‚ã•ã‚Œã¦ãªãã¦ã‚‚ã„ã„ã‚„ã¤\r\n        if (event.changes.all { it.changedToUpIgnoreConsumed() }) {\r\n            // All pointers are up\r\n            return event.changes[0]\r\n        }\r\n\r\n        if (event.changes.any { it.consumed.downChange || it.isOutOfBounds(size, extendedTouchPadding) }) {\r\n            return null // Canceled\r\n        }\r\n\r\n        // Check for cancel by position consumption. We can look on the Final pass of the\r\n        // existing pointer event because it comes after the Main pass we checked above.\r\n        val consumeCheck = awaitPointerEvent(PointerEventPass.Final)\r\n        if (consumeCheck.changes.any { it.positionChangeConsumed() }) {\r\n            return null\r\n        }\r\n    }\r\n}\r\n\r\n/** ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã™ã¹ã¦æ¶ˆè²»ã™ã‚‹ */\r\nprivate suspend fun AwaitPointerEventScope.consumeUntilUp() {\r\n    do {\r\n        val event = awaitPointerEvent()\r\n        event.changes.forEach { it.consumeAllChanges() }\r\n    } while (event.changes.any { it.pressed })\r\n}\r\n```\r\n\r\n# ã“ã‚Œã®ä½¿ã„æ–¹\r\n\r\nè¦ªè¦ç´ ã§ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒã»ã—ã„ï¼ï¼ï¼ã¨ãã«ã•ã£ãæ›¸ã„ãŸã‚„ã¤ã‚’ä½¿ã„ã¾ã™\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    @OptIn(ExperimentalMaterialApi::class)\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        setContent {\r\n            // è¦ªè¦ç´ ã‚’æŠ¼ã—ãŸã¨ãã®æ™‚é–“\r\n            var parentClickTime by remember { mutableStateOf(0L) }\r\n            // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã®æ™‚é–“\r\n            var buttonClickTime by remember { mutableStateOf(0L) }\r\n\r\n            MaterialTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(\r\n                    modifier = Modifier.fillMaxSize(),\r\n                    color = MaterialTheme.colors.background\r\n                ) {\r\n\r\n                    Column {\r\n                        Text(text = \"è¦ªè¦ç´ æŠ¼ã—ãŸã¨ãï¼š${parentClickTime.toTimeFormat()}\")\r\n                        Text(text = \"å­è¦ç´ æŠ¼ã—ãŸã¨ãï¼š${buttonClickTime.toTimeFormat()}\")\r\n\r\n                        // é©å½“ãªåºƒã•ã®è¦ªè¦ç´ ã‚’ä½œæˆ\r\n                        Box(\r\n                            modifier = Modifier\r\n                                .size(200.dp)\r\n                                .background(Color.LightGray)\r\n                                .pointerInput(Unit) {\r\n                                    // è¦ªè¦ç´ ã ã‘ã©ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã¨5000å…†å††ã»ã—ã„ï¼ï¼ï¼\r\n                                    detectParentComponentTapGestures {\r\n                                        parentClickTime = System.currentTimeMillis()\r\n                                    }\r\n                                },\r\n                            contentAlignment = Alignment.Center\r\n                        ) {\r\n                            Button(onClick = { buttonClickTime = System.currentTimeMillis() }) {\r\n                                Text(text = \"ãŠã›ï¼\")\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** ãƒŸãƒªç§’UnixTimeã‚’æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸å¤‰æ›ã™ã‚‹æ‹¡å¼µé–¢æ•° */\r\n    fun Long.toTimeFormat(): String? {\r\n        val simpleDateFormat = SimpleDateFormat(\"HH:mm:ss.SSS\", Locale.getDefault())\r\n        return simpleDateFormat.format(this)\r\n    }\r\n\r\n}\r\n```\r\n\r\n# å®Ÿéš›ã«èµ·å‹•ã•ã›ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¯ãš\r\n\r\n- è¦ªè¦ç´ (ç°è‰²ã®éƒ¨åˆ†)ã ã‘ã‚¯ãƒªãƒƒã‚¯ã—ãŸå ´åˆ\r\n    - è¦ªè¦ç´ æŠ¼ã—ãŸã¨ãã®æ™‚é–“ã ã‘ãŒæ›´æ–°ã•ã‚Œã‚‹\r\n\r\n![Imgur](https://imgur.com/3eM10f8.png)\r\n\r\n- ãƒœã‚¿ãƒ³ã‚‚æŠ¼ã—ãŸå ´åˆ\r\n    - è¦ªè¦ç´ æŠ¼ã—ãŸã¨ãã€å­è¦ç´ æŠ¼ã—ãŸã¨ãä¸¡æ–¹ã®æ™‚é–“ãŒæ›´æ–°ã•ã‚Œã‚‹\r\n\r\n![Imgur](https://imgur.com/2V1N7ey.png)\r\n\r\n## ä»•çµ„ã¿çš„ãªãªã«ã‹\r\n`PointerInputScope.detectTapGestures`ã‚’ã»ã¼ãƒ‘ã‚¯ã£ã¦ä½œã‚Šã¾ã—ãŸ\r\n\r\n```kotlin\r\nBox(\r\n    modifier = Modifier\r\n        .pointerInput(Unit) {\r\n            // â†“ã“ã‚Œã®ä¸­èº«ã‚’ã»ã¨ã‚“ã©ãƒ‘ã‚¯ã£ã¦ä½œã£ãŸ\r\n            detectTapGestures(onTap = {\r\n                \r\n            })\r\n        },\r\n    contentAlignment = Alignment.Center\r\n) { }\r\n```\r\n\r\n`PointerInputScope.detectTapGestures`ã‹ã‚‰ã€\r\n\r\nã¾ã æ¶ˆè²»ã•ã‚Œã¦ã„ãªã„ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ã‚‹ã¾ã§å¾…æ©Ÿã‚µã‚¹ãƒšãƒ³ãƒ‰é–¢æ•°\r\n\r\nã‚’ æ¶ˆè²»ã•ã‚Œã¦ã„ã¦ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ã‚‹ã¾ã§å¾…ã¤ã‚µã‚¹ãƒšãƒ³ãƒ‰é–¢æ•° ã¸æ›¸ãæ›ãˆã‚‹ã“ã¨ã§å‹•ã‹ã—ã¦ã„ã¾ã™ã€‚\r\n\r\n- æœ€åˆã®`awaitFirstDown()`ã‚’`awaitPointerEvent()`ã«ã™ã‚‹ã“ã¨ã§æ¶ˆè²»ã•ã‚Œã¦ã„ã¦ã‚‚ã„ã„ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒæ¥ã‚‹ã¾ã§å¾…æ©Ÿ\r\n- ä¸Šè¨˜ã®ç†ç”±ã‹ã‚‰`event.changes.fastAll { it.changedToUp() }` ã‚’ `event.changes.all { it.changedToUpIgnoreConsumed() }`ã«ã—ã¾ã—ãŸ\r\n- onTap ä»¥å¤–ã¯ä½¿ã‚ãªã„ã®ã§å‰Šé™¤\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\r\n\r\nhttps://github.com/takusan23/JetpackComposeParentClickEvent"},{"title":"Jetpack Composeã§ä¸€ç•ªå¤§ãã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã™ã¹ã¦åˆã‚ã›ãŸã„","link":"/posts/android_jc_parent_size/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nç„¡ç·šLANå­æ©Ÿã‚’è²·ã„æ›¿ãˆãŸã‚‰`Gradle sync`ã§ã‚³ã‚±ãªããªã‚Šã¾ã—ãŸã€‚ä»Šã¾ã§ã¯ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ‹¾ã£ã¦ãã‚‹ã¨ã“ã‚ã§ã‚ˆãã‚³ã‚±ã¦ãŸã®ã§...\r\n\r\n# æœ¬é¡Œ\r\nä¸€ç•ªå¤§ãã„ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã™ã¹ã¦åˆã‚ã›ãŸã„ã€‚\r\n\r\n![Imgur](https://imgur.com/cXiFrne.png)\r\n\r\n# ä½œã‚Šæ–¹\r\n\r\n```kotlin\r\n@Composable\r\nfun ParentDynamicWidth() {\r\n    Column(modifier = Modifier.width(IntrinsicSize.Max)) {\r\n        Button(\r\n            onClick = { },\r\n            modifier = Modifier.fillMaxWidth()\r\n        ) {\r\n            Text(text = \"Jetpack Compose\")\r\n        }\r\n        Button(\r\n            onClick = { },\r\n            modifier = Modifier.fillMaxWidth()\r\n        ) {\r\n            Text(text = \"Android\")\r\n        }\r\n        Button(\r\n            onClick = { },\r\n            modifier = Modifier.fillMaxWidth()\r\n        ) {\r\n            Text(text = \"Kotlin \")\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nè¦ªè¦ç´ ã«`Modifier.width(IntrinsicSize.Max)`ã‚’ä»˜ã‘ã¦ã€å­è¦ç´ ã«ã¯`Modifier.fillMaxWidth()`ã‚’ä»˜ã‘ã¦ã‚ã’ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/GAwVnRH.png)\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nãã‚ãã‚å¯ãŸã„ã®ã§ã“ã“ã‚‰ã¸ã‚“ã§å¤±ç¤¼ã—ã¾ã™ã€‚\r\n\r\n# å‚è€ƒãƒªãƒ³ã‚¯\r\nhttps://stackoverflow.com/questions/66458270/modifier-wrapcontentwidth-vs-modifier-widthintrinsicsize-max-in-android-jetp"},{"title":"Jetpack Compose ã®ä¾‹","link":"/posts/android_jc_recipe/","markdown":"è¿½è¨˜ï¼š2021/07/15ï¼š1.0.0-rc02ãŒå‡ºã¦ã¾ã™ã€‚\n\n\nè¿½è¨˜ï¼š2021/07/14ï¼š1.0.0-rc01ãŒå‡ºã¦ã¾ã™ã€‚\næ­£å¼ãƒªãƒªãƒ¼ã‚¹ã‚‚è¿‘ã„ã€‚ã‚ã¨ãªã‚“ã‹Android Studioã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ©Ÿèƒ½ãŒ4ã‚“ã§ã‚‹ã¿ãŸã„ã ã‹ã‚‰ã€`ui-tooling`ã ã‘ã¯`Beta09`ã®ã¾ã¾ãŒã„ã„ã‚‰ã—ã„ï¼Ÿ  \nè©³ç´°ï¼šhttps://stackoverflow.com/questions/68224361/jetpack-compose-cant-preview-after-updating-to-1-0-0-rc01\n\n```\ncomposeOptions {\n    kotlinCompilerVersion '1.5.10'\n    kotlinCompilerExtensionVersion '1.0.0-rc01'\n}\n```\n\nè¿½è¨˜ï¼š2021/06/26ï¼šBeta09ãŒå‡ºã¦ã¾ã™ã€‚  \nãã‚Œã¨ã€ç¾çŠ¶ï¼ŸAndroidStudioã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‹ã‚‰Empty Compose Activityã‚’é¸æŠã—ã¦ãã®ã¾ã¾ã®çŠ¶æ…‹ã§å®Ÿè¡Œã™ã‚‹ã¨èµ·å‹•ã—ã¾ã›ã‚“ã€‚Kotlinã¨JetpackComposeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚åˆè¦‹æ®ºã—ã ã‚ã“ã‚Œ\n\n```\njava.lang.NoSuchMethodError: No static method copy-H99Ercs$default\n```\n\n`build.gradle`(appãƒ•ã‚©ãƒ«ãƒ€ã§ã¯ãªã„æ–¹)\n\n```kotlin\nbuildscript {\n    ext {\n        compose_version = '1.0.0-beta09' // beta09ã¸\n    }\n    repositories {\n        google()\n        mavenCentral()\n    }\n    dependencies {\n        classpath \"com.android.tools.build:gradle:7.0.0-beta04\"\n        classpath \"org.jetbrains.kotlin:kotlin-gradle-plugin:1.5.10\" // 1.5.10ã¸\n\n        // NOTE: Do not place your application dependencies here; they belong\n        // in the individual module build.gradle files\n    }\n}\n```\n\n`app/build.gradle`(appãƒ•ã‚©ãƒ«ãƒ€ã®æ–¹ã®build.gradle)\n\n```gradle\n    composeOptions {\n        kotlinCompilerExtensionVersion compose_version\n        kotlinCompilerVersion '1.5.10' // 1.5.10ã¸\n    }\n```\n\nã“ã‚Œã§å®Ÿè¡Œã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\n\nè¿½è¨˜ï¼š2021/06/06ï¼šçŸ¥ã‚‰ã‚“é–“ã«Jetpack Compose Beta08ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚Kotlinã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’1.5.10ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n```\ncomposeOptions {\n    kotlinCompilerVersion '1.5.10'\n    kotlinCompilerExtensionVersion '1.0.0-beta08'\n}\n```\n\nã‚ã¨ `Composeç‰ˆãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ©ã‚¤ãƒ–ãƒ©ãƒª` ã®ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ãŒè¦ªåˆ‡ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚Googleæœ¬æ°—ã‚„ã‚“\nhttps://developer.android.com/reference/kotlin/androidx/compose/material/package-summary#overview\n\n\nã€å‰²ã¨ç ´å£Šçš„ä»•æ§˜å¤‰æ›´ã€‘`beta08`ã‹ã‚‰`Surface()`ã¨`Card()`ã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆã¯`Modifier`çµŒç”±ã§ã¯ãªãã€`onClick`ã®å¼•æ•°ã‚’ä½¿ã†ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\n\n- beta07ã¾ã§    \n```kotlin\nSurface(modifier = Modifier.clickable {  }) {\n\n}\n```\n\n- beta08ä»¥é™\n```kotlin\nSurface(onClick = { }) {\n\n}\n```\n\nãã—ã¦`Surface()`ã€`Card()`ã§`onClick`å¼•æ•°ã‚’ä½¿ã†éš›ã¯ã€`@ExperimentalMaterialApi`ã‚’Composeãªé–¢æ•°ã«ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n```kotlin\n@ExperimentalMaterialApi\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n\n    setContent {\n        Surface(onClick = { }) {\n        \n        }    \n    }\n\n}\n```\n\nè¿½è¨˜ï¼š2021/05/22ï¼šJetpack ComposeãŒã„ã¤ã®é–“ã«ã‹beta07ã¾ã§é€²ã‚“ã§ã¾ã—ãŸã€‚  \nã‚ã¨Google I/Oã§è¨€ã£ã¦ãŸã‘ã©ãƒ›ãƒ¼ãƒ ç”»é¢ã®ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆã‚‚Jetpack Composeã§æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã¨ã‹ãªã‚“ã¨ã‹\n\nè¿½è¨˜ï¼š2021/04/11ï¼šBeta04ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚å¤šåˆ†Kotlinã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n```\ncomposeOptions {\n    kotlinCompilerVersion '1.4.32'\n    kotlinCompilerExtensionVersion '1.0.0-beta04'\n}\n```\n\nè¿½è¨˜ï¼š2021/03/25ï¼šBeta03ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚`AndroidView`ã®å•é¡ŒãŒä¿®æ­£ã•ã‚Œã¦ã„ã¾ã™ã€‚  \nã¤ã„ã§ã«ã€Android 7ä»¥å‰ï¼Ÿã§èµ·ãã¦ãŸã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«`AndroidView`ãŒãšã‚Œã‚‹å•é¡Œã‚‚ç›´ã£ã¦ã¾ã—ãŸã€‚\n\nè¿½è¨˜ï¼š2021/03/13ï¼šBeta02ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸã€‚ä¸€ç·’ã«Kotlinã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’`1.4.31`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \n`ComposeView`ã®å•é¡ŒãŒä¿®æ­£ã•ã‚Œã¾ã—ãŸï¼ˆå¤šåˆ†ï¼‰ã€‚\n\n(ãªãŠä»Šåº¦ã¯ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«æ™‚ã«`AndroidView()`ãŒãšã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸæ¨¡æ§˜)\n\n```gradle\ncomposeOptions {\n    kotlinCompilerVersion '1.4.31'\n    kotlinCompilerExtensionVersion '1.0.0-beta02'\n}\n```\n\nã¾ãŸã€`AppCompat`ã€`Fragment`ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ãã‚Œãã‚Œ`1.3`ä»¥ä¸Šã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \n\n```gradle\ndependencies {\n    implementation 'androidx.fragment:fragment-ktx:1.3.1'\n    implementation 'androidx.appcompat:appcompat:1.3.0-beta01'\n}\n```\n\nè¿½è¨˜ 2021/03/02: Jetpack Compose Beta ãŒãƒªãƒªãƒ¼ã‚¹ã•ã‚Œã¾ã—ãŸï¼ã€‚ã¤ã„ã«ï¼ˆå¾…æœ›ã®ï¼‰ãƒ™ãƒ¼ã‚¿ç‰ˆã«ãªã‚Šã¾ã™\n\nè¿½è¨˜ 2021/02/15ï¼šJetpack Composeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒ`alpha 12`ã«ãªã‚Šã¾ã—ãŸã€‚  \nå½±éŸ¿ãŒã‚ã£ãŸã¨ã„ãˆã°ã€  \n- `vectorResource`ãŒéæ¨å¥¨ã€‚`painterResource`ã‚’ä½¿ã†ã‚ˆã†ã«ã€‚\n    - ã‚ˆã£ã¦`Icon`ã¸Drawableã‚’æ¸¡ã™ã¨ãã®å¼•æ•°ã¯`imageVector`ã§ã¯ãªãã€`painter`ã«ãªã‚Šã¾ã™ã€‚\n\n```kotlin\nIcon(\n    painter = painterResource(R.drawable.ic_outline_open_in_browser_24px),\n    contentDescription = \"ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•\"\n)\t\n```\n\n- Contextå–å¾—æ™‚ã«ä½¿ã†ã€`AmbientContext.current`ãŒ`LocalContext.current`ã«å¤‰æ›´ã«ãªã‚Šã¾ã—ãŸã€‚\n\n- Android StudioãŒå¯¾å¿œã—ã¦ãªã„ã®ã‹ã€Kotlinã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’1.4.30ã«ã—ã¦ã‚‚ã€**ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã®ã§åˆ©ç”¨ã§ãã¾ã›ã‚“**ã£ã¦IDEã«è¨€ã‚ã‚Œã¾ã™ã€‚ \n    -  **ã‚¨ãƒ©ãƒ¼å‡ºã‚‹ã‘ã©å®Ÿè¡Œã¯ã§ãã‚‹ã€‚ä¿®æ­£å¾…ã¡**\n    - `'padding(Dp): Modifier' is only available since Kotlin 1.4.30 and cannot be used in Kotlin 1.4`\n    - è§£æ±ºæ–¹æ³•ã¯ã€è¨­å®šã‚’é–‹ãã€`Languages & Frameworks`ã¸é€²ã¿ã€`Kotlin`ã‚’é¸ã³ã€`Update Channel`ã‚’`Early Access Preview 1.4.x`ã«ã—ã¦`Install`ã‚’æŠ¼ã›ã°ã„ã„ã‚‰ã—ã„ã€‚\n        - ã“ã“ã‚‰ã¸ã‚“å‚ç…§ï¼šhttps://github.com/android/compose-samples/pull/387#issuecomment-777515590\n\n\nè¿½è¨˜ï¼š`Icon`ã®å¢—ãˆã¦ã‚‹ã®ã§ã‚³ãƒ”ãƒšã˜ã‚ƒå‹•ã‹ãªããªã‚Šã¾ã—ãŸã€‚  \n`contentDescription`ã¨ã„ã†æ–‡å­—åˆ—ã‚’å…¥ã‚Œã‚‹å¼•æ•°ãŒå¢—ãˆã¦ã¾ã™ã€‚ã®ã§ã€ã‚³ãƒ”ãƒšã—ãŸã‚‰`Icon`ã®å¼•æ•°ã‚’è¶³ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«\n```kotlin\nIcon(\n    imageVector = Icons.Outlined.Home,\n    contentDescription = \"ã‚¢ã‚¤ã‚³ãƒ³ã®èª¬æ˜ã€‚ãªã‘ã‚Œã°nullã§ã‚‚ã„ã„\"\n)\n```\n\nã“ã®ç¶šãã§ã™ã€‚ãã®ã†ã¡è¿½è¨˜ã—ã«æ¥ã‚‹\n\nhttps://takusan.negitoro.dev/posts/android_jc/\n\n## Snackbarè¡¨ç¤º\n\n`Scaffold { }`ã§å›²ã£ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \nSnackbarè¡¨ç¤ºä»¥å¤–ã§ã‚‚ã‚¢ãƒ—ãƒªãƒãƒ¼ã¨ã‹ãƒ‰ãƒ­ãƒ¯ãƒ¼ã®è¡¨ç¤ºã§ã‚‚ä½¿ã†ã®ã§ç½®ã„ã¦ãŠã„ã¦æã¯ãªã„ã¯ãšã€‚\n\nã¾ãŸã€Composeå†…ã§åˆ©ç”¨ã§ãã‚‹ã‚³ãƒ«ãƒ¼ãƒãƒ³(`rememberCoroutineScope()`)ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\n\n```kotlin\n@ExperimentalMaterialApi\noverride fun onCreate(savedInstanceState: Bundle?) {\n    super.onCreate(savedInstanceState)\n    setContent {\n        MaterialTheme {\n            val state = rememberScaffoldState()\n            val scope = rememberCoroutineScope()\n            Scaffold(\n                scaffoldState = state,\n                topBar = {\n                    TopAppBar() {\n                        Column(\n                            horizontalAlignment = Alignment.CenterHorizontally,\n                            verticalArrangement = Arrangement.Center,\n                            modifier = Modifier.fillMaxHeight().padding(10.dp),\n                        ) {\n                            Text(text = \"ãƒ–ãƒ­ã‚°ä¸€è¦§\")\n                        }\n                    }\n                }\n            ) {\n                OutlinedButton(onClick = {\n                    scope.launch {\n                        val result = state.snackbarHostState.showSnackbar(\n                            message = \"Snackbarè¡¨ç¤º\",\n                            actionLabel = \"æŠ¼ã›ã¾ã™\",\n                            duration = SnackbarDuration.Short,\n                        )\n                        // æŠ¼ã›ãŸã‹ã©ã†ã‹\n                        if (result == SnackbarResult.ActionPerformed) {\n                            Toast.makeText(this@MainActivity, \"æŠ¼ã›ã¾ã—ãŸï¼\", Toast.LENGTH_SHORT).show()\n                        }\n                    }\n                }) {\n                    Text(text = \"Snackbarè¡¨ç¤º\")\n                }\n            }\n        }\n    }\n}\n```\n\nå®Ÿè¡Œçµæœ\n\n![Imgur](https://imgur.com/T2NNPnK.png)\n\nå‚è€ƒã«ã—ã¾ã—ãŸï¼šhttps://gist.github.com/gildor/82ec960cc0c5873453f024870495eab3\n\n## Contextå–å¾—\nãƒªã‚½ãƒ¼ã‚¹å–å¾—ç­‰ã¯ç”¨æ„ã•ã‚Œã¦ã‚‹ã‘ã©ã€ãã‚Œä»¥å¤–ã§Contextã‚’ä½¿ã„ãŸã„å ´åˆã¯ã“ã†ã§ã™ï¼\n\n```kotlin\n@Composable\nfun needContext() {\n    val context = LocalContext.current\n}\n```\n\n## ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ï¼Ÿ\n\nãªã‚“ã‹ã‚³ãƒ«ãƒ¼ãƒãƒ³ã€2ç¨®é¡ã‚ã‚‹ã£ã½ã„ã€‚  \n\n### LaunchedEffect vs rememberCoroutineScope\nãªã‚“ã‹è­¦å‘Šå‡ºã¦ãŸã®ã§è¿½è¨˜ï¼ˆ2021/04/19ï¼‰\n\n### LaunchedEffect\n\nã“ã‚Œã¯`@Composable`ãŒã¤ã„ãŸé–¢æ•°å†…ã§ã—ã‹å‘¼ã¹ã¾ã›ã‚“ã€‚  \n`Button()`ã‚„`Text()`ã‚’ç½®ãæ„Ÿã˜ã§ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\n\n```kotlin\n@Composable\nfun TimerText() {\n    val timerCount = remember { mutableStateOf(0) }\n    /**\n     * ã“ã“ã¯ã‚³ãƒ³ãƒãƒ¼ã‚¶ãƒ–ãƒ«ã®ã‚¹ã‚³ãƒ¼ãƒ—å†…\n     *\n     * Button()ã‚„Text()ãŒè¨­ç½®å¯èƒ½\n     * */\n    LaunchedEffect(key1 = Unit, block = {\n        while (true) {\n            timerCount.value += 1\n            delay(1000)\n        }\n    })\n    Text(text = \"${timerCount.value} ç§’çµŒé\")\n}\n\n```\n\nã¾ãŸã€`key1`ã®ä¸­èº«ãŒå¤‰ã‚ã‚‹ã¨ã€ä»Šã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€æ–°ã—ã„ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒèµ·å‹•ã™ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚\n\n```kotlin\n@Composable\nfun TimerText() {\n    val timerCount = remember { mutableStateOf(0) }\n    val isRunning = remember { mutableStateOf(false) }\n    /**\n     * Button()ã‚„Text()ãŒè¨­ç½®å¯èƒ½ãªå ´æ‰€\n     *\n     * Composableå†…ã§åˆ©ç”¨ã§ãã‚‹ã‚³ãƒ«ãƒ¼ãƒãƒ³\n     *\n     * key1ãŒå¤‰æ›´ã•ã‚Œã‚‹ã¨ã€æ—¢å­˜ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€æ–°ã—ãã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒèµ·å‹•ã™ã‚‹\n     * */\n    LaunchedEffect(key1 = isRunning.value, block = {\n        timerCount.value = 0\n        while (isRunning.value) {\n            timerCount.value += 1\n            delay(1000)\n        }\n    })\n    Button(onClick = {\n        isRunning.value = !isRunning.value\n    }) {\n        if (isRunning.value) {\n            Text(text = \"${timerCount.value} ç§’çµŒé\")\n        } else {\n            Text(text = \"ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹\")\n        }\n    }\n}\n```\n\n### rememberCoroutineScope\nã˜ã‚ƒã‚`rememberCoroutineScope`ã¯ãªã‚“ã ã‚ˆã£ã¦è©±ã§ã™ãŒã€ã“ã‚Œã¯`Composable`ãªé–¢æ•°ã§ã¯ãªã„ã¨ã“ã‚ã§ä½¿ã†ã®ãŒæ­£è§£ã‚‰ã—ã„ã§ã™ã€‚  \n(ä¾‹ãˆã°ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°ã¯`Composableãªé–¢æ•°`ã§ã¯ãªã„)\n\n```kotlin\n@Composable\nfun RememberCoroutine() {\n    val scope = rememberCoroutineScope()\n    val context = LocalContext.current\n\n    Button(onClick = {\n        // ã“ã“ã¯Composableãªé–¢æ•°ã§ã¯ãªã„\n        scope.launch {\n            // Toastè¡¨ç¤ºãŒçµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹\n            suspendToast(context)\n            println(\"çµ‚äº†\")\n        }\n    }) {\n        Text(text = \"rememberCoroutineScope\")\n    }\n}\n\n/** Toastè¡¨ç¤ºãŒçµ‚ã‚ã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹é–¢æ•° */\nsuspend fun suspendToast(context: Context) {\n    Toast.makeText(context, \"rememberCoroutineScope\", Toast.LENGTH_SHORT).show()\n    delay(2 * 1000) // 2ç§’ãã‚‰ã„\n}\n```\n\nã‚ã£ã¦ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ã®ã§ã€è©³ã—ãã¯å…¬å¼ã§  \nhttps://developer.android.com/jetpack/compose/lifecycle\n\n## ãƒ†ãƒ¼ãƒã¨ã‹æ–‡å­—ã®è‰²ã«ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã‚’ä½¿ã„ãŸã„ï¼\n`Color.parseColor()`ãŒãã®ã¾ã¾ã§ã¯ä½¿ãˆãªã„ã®ã§ã€`androidx.compose.ui.graphics`ã®æ–¹ã®`Color`ã®å¼•æ•°ã«å…¥ã‚Œã¦ã‚ã’ã¾ã™ã€‚\n\n```kotlin\nText(\n    text = AnniversaryDate.makeAnniversaryMessage(anniversary),\n    color = Color(android.graphics.Color.parseColor(\"#252525\"))\n)\n```\n\n## ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰\n\nã¾ãšã¯`ThemeColor.kt`ã¿ãŸã„ãªè‰²ã ã‘ã‚’æ›¸ã„ã¦ãŠãã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦ã¯ã‚Šã¤ã‘  \n~~ãªã‚“ã‹`isDarkMode`ã«`@Composable`ã‚’ä»˜ã‘ã‚‹ç†ç”±ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ãŒãã†ãªã£ã¦ãŸã®ã§ä¾¿ä¹—~~  \n`@Composable`ã‚’ã¤ã‘ã‚‹ã¨`LocalContext`ç­‰ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚  \nã¤ã‘ãªã„å ´åˆã ã¨(ä»Šå›ã®å ´åˆã¯)å¼•æ•°ã«`Context`ãŒå¿…è¦ã«ãªã‚‹ã€‚ãªã‚‹ã»ã©ãªã‚\n\n```kotlin\n// å¼•æ•°ã«ContextãŒå¿…è¦\nfun isDarkMode(context: Context) {}\n\n// ã„ã‚‰ãªã„\n@Composable\nfun isDarkMode() {\n    val context = LocalContext.current\n}\n```\n\nã“ã“ã‹ã‚‰ä¾‹ã§ã™\n\n```kotlin\n/**\n * [MaterialTheme]ã«æ¸¡ã™ãƒ†ãƒ¼ãƒã€‚ã‚³ãƒ¼ãƒ‰ã§ãƒ†ãƒ¼ãƒã®è¨­å®šãŒã§ãã‚‹ã£ã¦ãƒã‚¸ï¼Ÿ\n * */\n\n/** ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€‚OLEDç‰¹åŒ– */\nval DarkColors = darkColors(\n    primary = Color.White,\n    secondary = Color.Black,\n)\n\n/** ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ */\nval LightColors = lightColors(\n    primary = Color(android.graphics.Color.parseColor(\"#757575\")),\n    primaryVariant = Color(android.graphics.Color.parseColor(\"#494949\")),\n    secondary = Color(android.graphics.Color.parseColor(\"#a4a4a4\")),\n)\n\n/** ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ */\n@Composable\nfun isDarkMode(): Boolean {\n    // Composableã‚’ã¤ã‘ã‚‹ã¨LocalContextç­‰ã€Composableå†…ã§ã—ã‹å‘¼ã¹ãªã„é–¢æ•°ã‚’å‘¼ã¹ã‚‹ï¼ˆãã‚Œã¯ãã†ï¼‰\n    // ä»Šå›ã¯Contextã‚’å¼•æ•°ã«å–ã‚‰ãªãã¦ã‚‚LocalContextã‚’ä½¿ã†ã“ã¨ãŒå‡ºæ¥ãŸ\n    val context = LocalContext.current\n    val conf = context.resources.configuration\n    val nightMode = conf.uiMode and Configuration.UI_MODE_NIGHT_MASK\n    return nightMode == Configuration.UI_MODE_NIGHT_YES // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ true\n}\n```\n\nãã—ãŸã‚‰`MaterialTheme { }`ã«æ¸¡ã—ã¦ã‚ã’ã¾ã™ã€‚ifæ–‡ã‚’ä¸€è¡Œã§æ›¸ã\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            MaterialTheme(\n                // è‰²ã®è¨­å®š\n                colors = if (isDarkMode(AmbientContext.current)) DarkColors else LightColors\n            ) {\n                Scaffold {\n                    Column(\n                        modifier = Modifier.fillMaxWidth().fillMaxHeight(),\n                        verticalArrangement = Arrangement.Center,\n                        horizontalAlignment = Alignment.CenterHorizontally,\n                    ) {\n                        // ã“ã®ï¼’ã¤ã€ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ç™½è‰²ã€ãã‚Œä»¥å¤–ãªã‚‰é»’è‰²ã«ãªã‚‹ã¯ãš\n                        Text(text = \"ã‚‚ã˜ã®ã„ã‚\")\n                        Icon(imageVector = Icons.Outlined.Home)\n                    }\n                }\n            }\n        }\n    }\n}\n```\n\nã¡ã‚ƒã‚“ã¨å‹•ã‘ã°ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã®ã¨ãã¯çœŸã£æš—ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚AOD\n\n![Imgur](https://imgur.com/pMaRzgc.png)\n\nã¡ãªã¿ã«é»’åŸºèª¿ã«ã™ã‚‹ã¨`Icon()`ç­‰ãŒå‹æ‰‹ã«æ¤œçŸ¥ã—ã¦ã‚¢ã‚¤ã‚³ãƒ³ã®è‰²ã‚’ç™½è‰²ã«å¤‰æ›´ã—ã¦ãã‚Œã‚‹ãã†ã§ã™ã€‚ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰å¯¾å¿œã®æ‰‹é–“ãŒæ¸›ã‚‹\n\n\n## ã‚¿ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ\nè¦‹ã¤ã‘ãŸã®ã§å ±å‘Šã—ã¾ã™ã­ã€‚ãã‚“ãªã«é›£ã—ããªã„ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            MaterialTheme(\n                // è‰²ã®è¨­å®š\n                colors = if (isDarkMode(AmbientContext.current)) DarkColors else LightColors\n            ) {\n                Scaffold {\n                    Column(\n                        modifier = Modifier.fillMaxWidth().fillMaxHeight(),\n                        verticalArrangement = Arrangement.Center,\n                        horizontalAlignment = Alignment.CenterHorizontally,\n                    ) {\n\n                        // é¸æŠä¸­ã‚¿ãƒ–\n                        var selectTabIndex by remember { mutableStateOf(0) }\n\n                        TabLayout(\n                            selectTabIndex = selectTabIndex,\n                            tabClick = { index -> selectTabIndex = index }\n                        )\n                        Text(text = \"é¸æŠä¸­ï¼š$selectTabIndex\")\n\n                    }\n                }\n            }\n        }\n    }\n}\n\n\n/**\n * ã‚¿ãƒ–ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ\n *\n * @param selectTabIndex é¸æŠã™ã‚‹ã‚¿ãƒ–ã‚’å…¥ã‚Œã¦ã­\n * @param tabClick ã‚¿ãƒ–ã‚’æŠ¼ã—ãŸæ™‚\n * */\n@Composable\nfun TabLayout(selectTabIndex: Int, tabClick: (Int) -> Unit) {\n    TabRow(\n        modifier = Modifier.padding(10.dp),\n        selectedTabIndex = selectTabIndex,\n        backgroundColor = Color.Transparent,\n    ) {\n        Tab(selected = selectTabIndex == 0, onClick = {\n            tabClick(0)\n        }) {\n            Icon(imageVector = Icons.Outlined.Android)\n            Text(text = \"Android 9\")\n        }\n        Tab(selected = selectTabIndex == 1, onClick = {\n            tabClick(1)\n        }) {\n            Icon(imageVector = Icons.Outlined.Android)\n            Text(text = \"Android 10\")\n        }\n        Tab(selected = selectTabIndex == 2, onClick = {\n            tabClick(2)\n        }) {\n            Icon(imageVector = Icons.Outlined.Android)\n            Text(text = \"Android 11\")\n        }\n    }\n}\n```\n\nå‹•ä½œçµæœ\n\n![Imgur](https://imgur.com/nXfFeG5.png)\n\n## å‹•çš„ã«ãƒ†ãƒ¼ãƒã‚’å¤‰ãˆã‚‹\n\n`MaterialTheme`ã®`colors`ã®éƒ¨åˆ†ã‚’å¤‰ãˆã‚‹ã“ã¨ã§ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œå¾“æ¥ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã˜ã‚ƒã§ããªã„ã‹ã‚‰Composeã®å¼·ã¿ã˜ã‚ƒãªã„ï¼Ÿ\n\nã¾ãšã¯è‰²ã®æƒ…å ±ã‚’ç½®ã„ã¦ãŠãã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¦ã€ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚\n\n`ThemeColor.kt`\n\n```kotlin\n/** ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã€‚OLEDç‰¹åŒ– */\nval DarkColors = darkColors(\n    primary = Color.White,\n    secondary = Color.Black,\n)\n\n/** ãƒ©ã‚¤ãƒˆãƒ†ãƒ¼ãƒ */\nval LightColors = lightColors(\n    primary = Color(android.graphics.Color.parseColor(\"#FF6200EE\")),\n    primaryVariant = Color(android.graphics.Color.parseColor(\"#FF3700B3\")),\n    secondary = Color(android.graphics.Color.parseColor(\"#FFFFFF\")),\n)\n\n/** é’åŸºèª¿ */\nval blueTheme = lightColors(\n    primary = Color(android.graphics.Color.parseColor(\"#0277bd\")),\n    primaryVariant = Color(android.graphics.Color.parseColor(\"#58a5f0\")),\n    secondary = Color(android.graphics.Color.parseColor(\"#004c8c\")),\n)\n\n/** èµ¤åŸºèª¿ */\nval redTheme = lightColors(\n    primary = Color(android.graphics.Color.parseColor(\"#c2185b\")),\n    primaryVariant = Color(android.graphics.Color.parseColor(\"#8c0032\")),\n    secondary = Color(android.graphics.Color.parseColor(\"#fa5788\")),\n)\n\n/** ç·‘åŸºèª¿ */\nval greenTheme = lightColors(\n    primary = Color(android.graphics.Color.parseColor(\"#1b5e20\")),\n    primaryVariant = Color(android.graphics.Color.parseColor(\"#003300\")),\n    secondary = Color(android.graphics.Color.parseColor(\"#4c8c4a\")),\n)\n\n/** ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ */\n@Composable\nfun isDarkMode(context: Context): Boolean {\n    val conf = context.resources.configuration\n    val nightMode = conf.uiMode and Configuration.UI_MODE_NIGHT_MASK\n    return nightMode == Configuration.UI_MODE_NIGHT_YES // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ true\n}\n```\n\nãã®å¾Œã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚’ä¸€ç·’ã«æ›¸ã„ãŸäººã¯ã“ã£ã‹ã‚‰æ›ã‘ã°ã„ã„ã§ã™ã€‚\n\n```java\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n\n            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n            val defaultTheme = if (isDarkMode(AmbientContext.current)) DarkColors else LightColors\n\n            // è‰²ã‚’ä¿æŒã™ã‚‹\n            val themes = remember { mutableStateOf(defaultTheme) }\n\n            MaterialTheme(\n                // è‰²ã®è¨­å®š\n                colors = themes.value\n            ) {\n                Scaffold(\n                    topBar = {\n                        TopAppBar() {\n                            Column(\n                                horizontalAlignment = Alignment.CenterHorizontally,\n                                verticalArrangement = Arrangement.Center,\n                                modifier = Modifier.fillMaxHeight().padding(10.dp),\n                            ) {\n                                Text(text = \"å‹•çš„ãƒ†ãƒ¼ãƒ\")\n                            }\n                        }\n                    }\n                ) {\n                    // ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ\n                    DynamicThemeButtons(themeClick = { themes.value = it})\n                }\n            }\n        }\n    }\n}\n\n/**\n * å‹•çš„ã«ãƒ†ãƒ¼ãƒã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚\n *\n * @param themeClick ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹ã€‚å¼•æ•°ã«ã¯ãƒ†ãƒ¼ãƒï¼ˆ[Colors]ï¼‰ãŒå…¥ã£ã¦ã‚‹\n * */\n@Composable\nfun DynamicThemeButtons(\n    themeClick: (Colors) -> Unit,\n) {\n\n    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n    val defaultTheme = if (isDarkMode(context = AmbientContext.current)) DarkColors else LightColors\n\n    Column(\n        verticalArrangement = Arrangement.Center,\n        horizontalAlignment = Alignment.CenterHorizontally,\n    ) {\n        Button(\n            modifier = Modifier.padding(5.dp),\n            onClick = { themeClick(blueTheme) }\n        ) {\n            Text(text = \"é’\")\n        }\n        Button(modifier = Modifier.padding(5.dp),\n            onClick = { themeClick(redTheme) }\n        ) {\n            Text(text = \"èµ¤\")\n        }\n        Button(modifier = Modifier.padding(5.dp),\n            onClick = { themeClick(greenTheme) }\n        ) {\n            Text(text = \"ç·‘\")\n        }\n        Button(modifier = Modifier.padding(5.dp),\n            onClick = { themeClick(defaultTheme) }\n        ) {\n            Text(text = \"ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\")\n        }\n    }\n\n}\n```\n\nå®Ÿè¡Œçµæœ\n\nãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨è‰²ãŒåˆ‡ã‚Šæ›¿ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/cijIOts.png)\n\n![Imgur](https://imgur.com/Xr8lRaT.png)\n\n## è¡¨ç¤ºã€éè¡¨ç¤ºã‚’ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã—ã¦ã»ã—ã„\n\n`AnimatedVisibility`ã£ã¦ã®ãŒã‚ã‚Šã¾ã™ã€‚  \n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    \n    @ExperimentalAnimationApi\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n\n            // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ\n            val defaultTheme = if (isDarkMode(AmbientContext.current)) DarkColors else LightColors\n\n            // è‰²ã‚’ä¿æŒã™ã‚‹\n            val themes = remember { mutableStateOf(defaultTheme) }\n\n            MaterialTheme(\n                // è‰²ã®è¨­å®š\n                colors = themes.value\n            ) {\n                VisibilityAnimationSample()\n            }\n        }\n    }\n}\n\n@ExperimentalAnimationApi\n@Composable\nfun VisibilityAnimationSample() {\n    // è¡¨ç¤ºã™ã‚‹ã‹\n    val isShow = remember { mutableStateOf(false) }\n    Column(\n        modifier = Modifier\n            .fillMaxWidth()\n            .fillMaxHeight(),\n        verticalArrangement = Arrangement.Center,\n        horizontalAlignment = Alignment.CenterHorizontally,\n    ) {\n        AnimatedVisibility(visible = isShow.value) {\n            // ã“ã®ä¸­ã«æ›¸ã„ãŸã‚„ã¤ãŒã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚ŒãªãŒã‚‰è¡¨ç¤ºã•ã‚Œã‚‹\n            Column {\n                // 10å€‹ãã‚‰ã„\n                repeat(10) {\n                    Icon(imageVector = Icons.Outlined.Android, modifier = Modifier.rotate(90f * it))\n                }\n            }\n        }\n        // è¡¨ç¤ºã€éè¡¨ç¤ºåˆ‡ã‚Šæ›¿ãˆ\n        Button(onClick = { isShow.value = !isShow.value }) {\n            Text(text = \"ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã›ãªãŒã‚‰è¡¨ç¤º\")\n        }\n    }\n}\n```\n\nç”»åƒã˜ã‚ƒã‚ã‹ã‚‰ã‚“ã‘ã©ã€ã¡ã‚ƒã‚“ã¨ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã•ã‚Œã¦ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/VFFCZR9.png)\n\n\n## å³å¯„ã›\n`android:gravity=\"right\"`ã‚’Jetpack Composeã§ã‚‚ã‚„ã‚ŠãŸã„ã‚ã‘ã§ã™ã­ã€‚é‡è¦ãªç‚¹ã¯`fillMaxWidth()`ã‚’ä½¿ã†ã¨ã“ã‚ã§ã™\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            GravityRight()\n        }\n    }\n}\n\n@Composable\nfun GravityRight() {\n    Column {\n        Row(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalArrangement = Arrangement.End,\n            verticalAlignment = Alignment.CenterVertically,\n        ) {\n            Text(text = \"å³ã«å¯„ã£ã¦ã‚‹ Row\")\n            IconButton(onClick = { /*TODO*/ }) {\n                Icon(imageVector = Icons.Outlined.Adb)\n            }\n        }\n        Divider() // åŒºåˆ‡ã‚Š\n        Column(\n            modifier = Modifier.fillMaxWidth(),\n            horizontalAlignment = Alignment.End,\n            verticalArrangement = Arrangement.Center\n        ) {\n            Text(text = \"å³ã«å¯„ã£ã¦ã‚‹ Column\")\n            IconButton(onClick = { /*TODO*/ }) {\n                Icon(imageVector = Icons.Outlined.Adb)\n            }\n        }\n    }\n}\n```\n\nã“ã†ãªã‚‹ã¯ãš\n\n![Imgur](https://imgur.com/38Uu9zz.png)\n\n\n## å‡ç­‰ã«ä¸¦ã¹ã‚‹\n`LinearLayout`ã¨åŒã˜ã‚ˆã†ã«`weight`ã‚’è¨­å®šã™ã‚Œã°ã§ãã¾ã™ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            WeightSample()\n        }\n    }\n}\n\n@Composable\nfun WeightSample() {\n    Row(\n        modifier = Modifier.fillMaxWidth()\n    ) {\n        Button(modifier = Modifier.weight(1f).padding(5.dp), onClick = { /*TODO*/ }) {\n            Text(text = \"ã¼ãŸã‚“ã ã‚ˆãƒ¼\")\n        }\n        Button(modifier = Modifier.weight(1f).padding(5.dp), onClick = { /*TODO*/ }) {\n            Text(text = \"ã¼ãŸã‚“ã ã‚ˆãƒ¼\")\n        }\n        Button(modifier = Modifier.weight(1f).padding(5.dp), onClick = { /*TODO*/ }) {\n            Text(text = \"ã¼ãŸã‚“ã ã‚ˆãƒ¼\")\n        }\n    }\n}\n```\n\nã“ã†ãªã‚‹ã¯ãš\n\n![Imgur](https://imgur.com/6YRtu3S.png)\n\n## ä½™ã‚Šã®ã‚¹ãƒšãƒ¼ã‚¹ã‚’åŸ‹ã‚ã‚‹\nåŸ‹ã‚ãŸã„éƒ¨å“ã«å¯¾ã—ã¦`weight(1f)`ã‚’è¶³ã—ã¦ã‚ã’ã‚‹ã“ã¨ã§ã€ä»–ã®éƒ¨å“ã®äº‹ã‚’è€ƒãˆãªãŒã‚‰åŸ‹ã‚ãŸã„éƒ¨å“ã§åŸ‹ã‚ã¦ãã‚Œã¾ã™ã€‚  \nã“ã£ã¡ã‚‚è¦ªè¦ç´ ã«`fillMaxWidth()`ã‚’æŒ‡å®šã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚(ç”»é¢ã„ã£ã±ã„ä½¿ã†ãªã‚‰)\n\n```kotlin   \nclass MainActivity : AppCompatActivity() {\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContent {\n            MessageSendUI()\n        }\n    }\n}\n\n@Composable\nfun MessageSendUI() {\n    Row(\n        modifier = Modifier.fillMaxWidth(),\n        verticalAlignment = Alignment.CenterVertically\n    ) {\n        val message = remember { mutableStateOf(\"\") }\n        // ã“ã®éƒ¨å“ã‚’æœ€å¤§ã¾ã§åºƒã’ãŸã„\n        OutlinedTextField(\n            value = message.value,\n            onValueChange = { message.value = it },\n            modifier = Modifier\n                .padding(5.dp)\n                .weight(1f)\n        )\n        IconButton(\n            onClick = { /*TODO*/ },\n            modifier = Modifier.padding(5.dp)\n        ) {\n            Icon(imageVector = Icons.Outlined.Send)\n        }\n    }\n}\n```\n\nã“ã†ãªã‚‹ã¯ãš\n\n![Imgur](https://imgur.com/dcxKhg3.png)\n\n## ã‚‚ã£ã¨ã‚µãƒ³ãƒ—ãƒ«æ›¸ã‘ï¼\n\n`Jetpack Compose`ã‚’æ›¸ã„ã¦ã‚‹äººã®ã‚µãƒ³ãƒ—ãƒ«ã«ã¯å‹ã¦ãªã„ã¨ã„ã†ã‚ã‘ã§`ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰`ã®æ¢ã—æ–¹ã§ã‚‚ã€‚\n\n#### 1.Android Studioã§ä½¿ã„ãŸã„UIéƒ¨å“ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’é–‹ã\n\n`Button`ã¨ã‹`OutlinedButton`ã¨ã‹`MaterialTheme`ã®éƒ¨åˆ†ã§`Ctrl æŠ¼ã—ãªãŒã‚‰ ã‚¯ãƒªãƒƒã‚¯`ã™ã‚‹ã“ã¨ã§é£›ã¹ã¾ã™ã€‚\n\nã“ã‚“ãªã®ãŒå‡ºã‚‹ã¨æ€ã†\n\n![Imgur](https://imgur.com/PovnHgF.png)\n\n#### 2.ãƒ–ãƒ©ã‚¦ã‚¶ã§\n\nhttps://cs.android.com/\n\nã‚’é–‹ãã¾ã™ã€‚\n\n#### 3.@sample ã®éƒ¨åˆ†ã‚’æ¢ã—ã¾ã™ã€‚\n\nã•ã£ãã®ç”»åƒã ã¨ã€\n\n```java\n@sample androidx.compose.material.samples.OutlinedButtonSample\n```\n\nã®ã¨ã“ã‚ã§ã™ã­\n\n#### 4.æ¤œç´¢æ¬„ã«å…¥ã‚Œã‚‹\nã§ã€ä½•ã‚’æ¤œç´¢æ¬„ã«å…¥ã‚Œã‚Œã°ã„ã„ã‚“ã ã£ã¦è©±ã§ã™ãŒã€ã•ã£ãè¦‹ã¤ã‘ãŸ`@sample ï½`ã®éƒ¨åˆ†ã€  \næœ€å¾Œã‹ã‚‰`.`ã¾ã§ã®éƒ¨åˆ†ã‚’å…¥åŠ›ã—ã¾ã™ã€‚\n\n```java\n@sample androidx.compose.material.samples.OutlinedButtonSample\n```\n\nã ã¨ã€`OutlinedButtonSample`ãŒãã†ã§ã™ã€‚\n\n\næ—©é€Ÿæ¤œç´¢æ¬„ã«å…¥ã‚Œã¾ã—ã‚‡ã†\n\n![Imgur](https://imgur.com/zUlBhLR.png)\n\n#### 5.ã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è§£ã\n\næ¤œç´¢æ¬„ã«å…¥ã‚ŒãŸã‚‰ãŠãã‚‰ãä¸€ç•ªæœ€åˆã®ã‚µã‚¸ã‚§ã‚¹ãƒˆãŒä½¿ã„æ–¹ã®ä¾‹ã«ãªã£ã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚\n\nã‚ã¨ã¯èª­ã‚“ã§ã„ãã—ã‹ç„¡ã„ã§ã™ã€‚\n\n![Imgur](https://imgur.com/7dM94mY.png)\n\n\n## ã‚µãƒ³ãƒ—ãƒ«ã‚¢ãƒ—ãƒª\n\nä»Šã¾ã§ã‚„ã£ãŸã“ã¨(ã ã„ãŸã„)ã‚’ä¸€ã¤ã®ã‚¢ãƒ—ãƒªã«ã—ã¦ã¿ã¾ã—ãŸã€‚ã©ã†ãã€‚\n\nhttps://github.com/takusan23/JetpackComposeSampleApp\n\n### ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\n\nhttps://github.com/takusan23/JetpackComposeSampleApp/releases/tag/1.0"},{"title":"Jetpack Composeã®TabRowã®ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ã®è§’ã‚’ä¸¸ã","link":"/posts/android_jc_tab_rounded_indicator/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\n# æœ¬é¡Œ\r\næœ€è¿‘ã®ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã«ã‚ã‚‹ã‚¿ãƒ–ã®ä¸‹ã®é¸æŠä¸­ã‚’ç¤ºã™æ£’ã®ç«¯ã£ã“ãŒä¸¸ã„ã‚„ã¤ã‚’ã‚„ã‚ŠãŸã„ã€‚  \r\nã¡ãªã¿ã«ã“ã‚Œã¯PlayStoreã€‚ã‚ªãƒ¼ãƒ—ãƒ³ã‚½ãƒ¼ã‚¹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹è¦‹ã‚‹ã¨Composeã®æ–‡å­—ãŒ...ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/DS6aAR4.png)\r\n\r\n# ã‚³ãƒ¼ãƒ‰\r\n\r\n```kotlin\r\n@Composable\r\nfun RoundedIndicatorTabRow() {\r\n    val selectIndex = remember { mutableStateOf(0) }\r\n    TabRow(\r\n        selectedTabIndex = selectIndex.value,\r\n        contentColor = MaterialTheme.colors.primary,\r\n        backgroundColor = MaterialTheme.colors.background,\r\n        indicator = { tabPositions ->\r\n            // ãƒ†ã‚­ã‚¹ãƒˆã®ä¸‹ã«å‡ºã‚‹ã‚ã®æ£’ã®ã‚„ã¤\r\n            Box(\r\n                modifier = Modifier\r\n                    .tabIndicatorOffset(tabPositions[selectIndex.value])\r\n                    .height(3.dp)\r\n                    .padding(start = 20.dp, end = 20.dp)\r\n                    .background(LocalContentColor.current, RoundedCornerShape(100, 100, 0, 0))\r\n            )\r\n        }\r\n    ) {\r\n        Tab(\r\n            selected = 0 == selectIndex.value,\r\n            modifier = Modifier.padding(5.dp),\r\n            onClick = { selectIndex.value = (0) },\r\n            content = {\r\n                Text(text = \"ãƒ›ãƒ¼ãƒ \")\r\n            }\r\n        )\r\n        Tab(\r\n            selected = 1 == selectIndex.value,\r\n            modifier = Modifier.padding(5.dp),\r\n            onClick = { selectIndex.value = (1) },\r\n            content = {\r\n                Text(text = \"é€šçŸ¥\")\r\n            }\r\n        )\r\n        Tab(\r\n            selected = 2 == selectIndex.value,\r\n            modifier = Modifier.padding(5.dp),\r\n            onClick = { selectIndex.value = (1) },\r\n            content = {\r\n                Text(text = \"ãŠæ°—ã«å…¥ã‚Š\")\r\n            }\r\n        )\r\n        Tab(\r\n            selected = 3 == selectIndex.value,\r\n            modifier = Modifier.padding(5.dp),\r\n            onClick = { selectIndex.value = (1) },\r\n            content = {\r\n                Text(text = \"è¨­å®š\")\r\n            }\r\n        )\r\n    }\r\n\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/ibFilId.png)"},{"title":"Jetpack Compose ã® TextField ã§ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®å¤‰æ›´","link":"/posts/android_jc_textfield_cursor/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nè‡ªåˆ†ç”¨ãƒ¡ãƒ¢ã€‚ã‚ã®æ–‡å­—å…¥åŠ›ä¸­ã®ã‚«ãƒ¼ã‚½ãƒ«ï¼Ÿç‚¹æ»…ã—ã¦ã‚‹ã‚„ã¤ã£ã¦ã‚­ãƒ£ãƒ¬ãƒƒãƒˆã£ã¦è¨€ã†ã‚‰ã—ã„ã§ã™ã‚ˆï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\n\r\nJetpack Compose ã§ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®ã¯ã©ã“ã§å¤‰æ›´ã§ãã‚‹ã®\r\n\r\n## ã“ãŸãˆ\r\n\r\n`String`ã§ã¯ãªã`TextFieldValue`ã‚’å¼•æ•°ã«å–ã‚‹`TextField`ã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€  \r\n`TextFieldValue`çµŒç”±ã§ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®ã‚’å¤‰æ›´ã§ãã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            TextFieldCursorPosTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(modifier = Modifier.fillMaxSize(), color = MaterialTheme.colors.background) {\r\n\r\n                    val textFieldValue = remember { mutableStateOf(TextFieldValue()) }\r\n\r\n                    LaunchedEffect(key1 = textFieldValue.value.text, block = {\r\n                        val textBoxValue = textFieldValue.value.text\r\n                        // ã“ã“ã§æ–‡å­—å¤‰æ›´æ™‚ã®ã‚¤ãƒ™ãƒ³ãƒˆãŒå–ã‚Œã‚‹ã‚ˆ...\r\n                    })\r\n\r\n                    Column(\r\n                        verticalArrangement = Arrangement.Center,\r\n                        horizontalAlignment = Alignment.CenterHorizontally\r\n                    ) {\r\n                        OutlinedTextField(\r\n                            value = textFieldValue.value,\r\n                            onValueChange = { textFieldValue.value = it }\r\n                        )\r\n\r\n                        // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æœ€å¾Œã«æŒã£ã¦ã„ã\r\n                        Button(onClick = { textFieldValue.value = textFieldValue.value.copy(selection = TextRange(textFieldValue.value.text.length)) }) {\r\n                            Text(text = \"æœ€å¾Œã¸\")\r\n                        }\r\n\r\n                        // ã‚«ãƒ¼ã‚½ãƒ«ã‚’æœ€åˆã«æŒã£ã¦ã„ã\r\n                        Button(onClick = { textFieldValue.value = textFieldValue.value.copy(selection = TextRange(0)) }) {\r\n                            Text(text = \"æœ€åˆã¸\")\r\n                        }\r\n\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nãŸã ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã¨ã€ã‚«ãƒ¼ã‚½ãƒ«ã‚’å‹•ã‹ã™ãŸã³ã«`onValueChange = { }`ãŒå‘¼ã°ã‚Œã‚‹ã®ã§ã€\r\nä»Šã¾ã§é€šã‚Šã«æ–‡å­—å¤‰æ›´æ™‚ã ã‘å‘¼ã°ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã„å ´åˆã¯`LaunchedEffect`ã®`key`ã«å…¥ã‚Œã‚Œã°è‰¯ã„ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã„ã¾ã—ãŸã€‚\r\n\r\n## åˆ©ç”¨ä¾‹\r\næ¤œç´¢ã§ã‚ã‚‹ã‚µã‚¸ã‚§ã‚¹ãƒˆï¼ˆãƒ†ã‚­ã‚¹ãƒˆè£œå……ã®ã‚„ã¤ï¼‰ã¨ã‹ã§ä½¿ãˆã‚‹ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã„ã¾ã—ãŸ\r\n\r\n```\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    private val ALL_LIST = listOf(\r\n        \"Android 12\",\r\n        \"Android 13 DP\",\r\n        \"Android JetpackCompose\",\r\n        \"Android Room\",\r\n        \"Android LiveData\",\r\n        \"Android ViewModel\",\r\n    )\r\n\r\n    @OptIn(ExperimentalMaterialApi::class)\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            TextFieldCursorPosTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(modifier = Modifier.fillMaxSize(), color = MaterialTheme.colors.background) {\r\n                    // ã‚µã‚¸ã‚§ã‚¹ãƒˆä¸€è¦§\r\n                    val suggestList = remember { mutableStateListOf<String>() }\r\n                    // å…¥åŠ›æ¬„ã®æ–‡å­—\r\n                    val textFieldValue = remember { mutableStateOf(TextFieldValue()) }\r\n                    // æ–‡å­—ã ã‘å¤‰æ›´æ¤œçŸ¥\r\n                    LaunchedEffect(key1 = textFieldValue.value.text, block = {\r\n                        suggestList.clear()\r\n                        suggestList.addAll(ALL_LIST.filter { it.contains(textFieldValue.value.text) })\r\n                    })\r\n                    Column(modifier = Modifier.padding(10.dp)) {\r\n                        OutlinedTextField(\r\n                            value = textFieldValue.value,\r\n                            onValueChange = { textFieldValue.value = it }\r\n                        )\r\n                        LazyColumn(content = {\r\n                            items(suggestList) { suggestText ->\r\n                                Surface(\r\n                                    onClick = {\r\n                                        textFieldValue.value = textFieldValue.value.copy(\r\n                                            text = suggestText,\r\n                                            selection = TextRange(suggestText.length) // æŠ¼ã—ãŸã‚‰ã‚«ãƒ¼ã‚½ãƒ«ã‚’æœ€å¾Œã«ç§»å‹•\r\n                                        )\r\n                                    }\r\n                                ) { Text(modifier = Modifier.padding(10.dp), text = suggestText) }\r\n                            }\r\n                        })\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/XUHFn8t.png)\r\n\r\n### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\n\r\nãŠã„ã¦ãŠãã¾ã™\r\n\r\nhttps://github.com/takusan23/TextFieldCursorPos\r\n\r\n## ãŠã‚ã‚Šã«\r\n\r\n```kotlin\r\nTextFieldValue(\r\n    text = \"å…¥åŠ›ä¸­æ–‡å­—\",    // å…¥åŠ›ã—ã¦ã„ã‚‹æ–‡å­—\r\n    selection = TextRange(0),   // ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®æƒ…å ±ã€ã‚‚ã—ãã¯é•·æŠ¼ã—ã§æ–‡å­—ã‚’ç¯„å›²æŒ‡å®šã—ãŸéš›ã®ä½ç½®æƒ…å ±\r\n    composition = null // å¤‰æ›å‰ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚‹å ´åˆã¯ãã®ç¯„å›²ã€‚nullã‚’å…¥ã‚Œã‚‹ã¨ç¢ºå®šã«ãªã‚‹ï¼ˆæ–‡å­—å…¥åŠ›ä¸­ã®ãƒœãƒ¼ãƒ€ãƒ¼ãƒ©ã‚¤ãƒ³ãŒæ¶ˆãˆã‚‹ï¼‰\r\n)\r\n```\r\n\r\nèŠ±ç²‰ã‚„ã°ã„"},{"title":"JetpackComposeã®TextFieldã‚’Viewã®EditTextã«ä¼¼ã›ãŸã„","link":"/posts/android_jc_traditional_text_field/","markdown":"\r\n`BasicTextField`ã‚’ä½¿ãˆã°ã„ã„ã§ã™ã€‚\r\n"},{"title":"Jetpack Compose ã¨ ViewModel","link":"/posts/android_jc_viewmodel/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚  \r\næ¥½å¤©ãƒ¢ãƒã‚¤ãƒ«ã®ãƒ†ã‚¶ãƒªãƒ³ã‚°ã§ã“ã®è¨˜äº‹æ›¸ã„ã¦ã¾ã™ã€‚\r\n\r\n# æœ¬é¡Œ\r\nJetpack Composeã§ViewModelã‚’ä½¿ã†ã¨ãã©ã†ã™ã‚Œã°ãˆãˆã®ï¼Ÿ\r\n\r\n# ãªã‚“ã‹ã„ã„æ„Ÿã˜ã«ã‚„ã£ã¦ãã‚Œã‚‹ã€‚\r\nViewModelã«Keyã‚’å†…éƒ¨çš„ã«ä»˜ã‘ã¦ãã‚Œã‚‹ã®ã§ã€åŒã˜ã‚¹ã‚³ãƒ¼ãƒ—ã§ã‚‚è¤‡æ•°ã®ViewModelãŒæŒã¦ã¾ã—ãŸã€‚ã‚ˆãè€ƒãˆã¦ã‚ã‚‹\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            ComposeViewModelTheme {\r\n                // A surface container using the 'background' color from the theme\r\n                Surface(color = MaterialTheme.colors.background) {\r\n\r\n                    val currentPageName = remember { mutableStateOf(\"home\") }\r\n\r\n                    Scaffold(\r\n                        bottomBar = {\r\n                            BottomNavigation {\r\n                                BottomNavigationItem(\r\n                                    selected = currentPageName.value == \"home\",\r\n                                    onClick = { currentPageName.value = \"home\" },\r\n                                    label = { Text(text = \"Home\") },\r\n                                    icon = { Icon(painter = painterResource(id = R.drawable.ic_baseline_home_24), contentDescription = \"home\") }\r\n                                )\r\n                                BottomNavigationItem(\r\n                                    selected = currentPageName.value == \"notification\",\r\n                                    onClick = { currentPageName.value = \"notification\" },\r\n                                    label = { Text(text = \"Notification\") },\r\n                                    icon = { Icon(painter = painterResource(id = R.drawable.ic_baseline_notifications_24), contentDescription = \"notification\") }\r\n                                )\r\n                            }\r\n                        }\r\n                    ) {\r\n                        // ãƒšãƒ¼ã‚¸åˆ‡ã‚Šæ›¿ãˆ\r\n                        when (currentPageName.value) {\r\n                            \"home\" -> HomeScreen()\r\n                            \"notification\" -> NotificationScreen()\r\n                        }\r\n                    }\r\n\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Composable\r\nfun HomeScreen() {\r\n    val viewModel = viewModel<HomeViewModel>()\r\n    Text(text = \"Home Screen ${viewModel.hashCode()}\")\r\n}\r\n\r\n@Composable\r\nfun NotificationScreen() {\r\n    val viewModel = viewModel<NotificationViewModel>()\r\n    Text(text = \"Notification is empty ${viewModel.hashCode()}\")\r\n}\r\n```\r\n\r\n## ViewModelProvider#Factory\r\nã«ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass InfoViewModel(application: Application, private val gameId: Int) : AndroidViewModel(application) {\r\n\r\n}\r\n```\r\n\r\n```kotlin\r\nclass InfoViewModelFactory(val application: Application, val gameId: Int) : ViewModelProvider.Factory {\r\n\r\n    override fun <T : ViewModel?> create(modelClass: Class<T>): T {\r\n        return InfoViewModel(application, gameId) as T\r\n    }\r\n\r\n}\r\n```\r\n\r\n```kotlin\r\nGameInfoScreen(viewModel = viewModel(factory = InfoViewModelFactory(application, \"contentId\")))\r\n```\r\n\r\n```kotlin\r\n@Composable\r\nfun GameInfoScreen(viewModel: InfoViewModel) {\r\n    // çœç•¥\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# ã‚µãƒ³ãƒ—ãƒ«\r\nä¸€ã¤ã®Activityã«Jetpack Composeã§2ç”»é¢å®Ÿç¾ã—ã¦ã¾ã™\r\n\r\nhttps://github.com/takusan23/ErogameScapeDroid\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nJetpack Composeã§æ›¸ãç›´ã—ãŸã„ã‘ã©æ™‚é–“ãŒãªã„ã€‚"},{"title":"Jetpack Composeã®viewModel()ãŒèµ¤ããªã‚‹","link":"/posts/android_jc_viewmodel_fun_err/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nWWDCã‚‚å¤œå‹¤ã§è¦‹ã‚Œã¾ã›ã‚“ã€‚ã‚ã¨ã¾ã„ã¦ã¤ãŒã‚»ãƒ¼ãƒ«ä¸­ãªã‚“ã ã£ã¦ï¼Ÿæ°—ã«ãªã‚‹\r\n\r\n# æœ¬é¡Œ\r\n\r\n`viewModel()`é–¢æ•°ãŒãªã‚“ã‹èµ¤ããªã£ã¦ã‚‹ã€‚åˆ¥ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚ã„ã˜ã£ã¦ãªã„ã®ã«\r\n\r\n![Imgur](https://imgur.com/Nt8YeKE.png)\r\n\r\n# ç›´ã—æ–¹\r\n\r\nå·¦ä¸Šã®`File`ã‹ã‚‰`Invalidate Caches/ Restart...`ã‚’é¸ã‚“ã§ã€`Invalidate and Restart`ã‚’æŠ¼ã›ã°å‹æ‰‹ã«Android StudioãŒå†èµ·å‹•ã™ã‚‹ã€‚\r\n\r\n![Imgur](https://imgur.com/alXmBnd.png)\r\n\r\n# çµ‚ã‚ã‚Šã«\r\n`Jetpack Compose`ã§ã¯`ViewModel`ã‚’ä½¿ã‚ãªã„ã¿ãŸã„ãªã®ã‚’è¦³æ¸¬ã—ãŸã‘ã©ã©ã†ã„ã†ã“ã¨ãªã®ï¼Ÿ  "},{"title":"è‡ªä½œAndroidãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ Maven Central ã¸å…¬é–‹ã™ã‚‹","link":"/posts/android_library_publish_to_maven_central/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\nä¿å¥å®¤ã®ã‚»ãƒ³ã‚»ãƒ¼ã¨ã‚´ã‚¹ãƒ­ãƒªã®æ ¡åŒ» æ”»ç•¥ã—ã¾ã—ãŸã€‚å‰ä½œã¯ã‚„ã£ã¦ãªã„ã§ã™ã€‚  \r\nãƒ­ãƒ¼ãƒ—ãƒ©ã‚¤ã‚¹ã ã‘ã©ã‚·ãƒŠãƒªã‚ªãŒã¡ã‚ƒã‚“ã¨ã—ã¦ã„ã¦ã„ã„ã¨æ€ã„ã¾ã—ãŸã€‚ãŠã™ã™ã‚\r\n\r\n![Imgur](https://imgur.com/zgom8f4.png)\r\n\r\n![Imgur](https://imgur.com/mS4S4ne.png)\r\n\r\nã¿ã‚“ãªã‹ã‚ã„ã„\r\n\r\n![Imgur](https://imgur.com/roZOqlK.png)\r\n\r\néˆ´ãƒ«ãƒ¼ãƒˆã‚‚è¿‘ã€…ç™ºå£²ã¿ãŸã„ãªã®ã§æ¥½ã—ã¿ã§ã™ã­ã€‚ããƒ¼\r\n\r\n![Imgur](https://imgur.com/8PamPDe.png)\r\n\r\n# æœ¬é¡Œ\r\nã¡ã‚‡ã£ã¨å‰ã«æ›¸ã„ãŸã‚¢ãƒ—ãƒªã®ã‚³ã‚¢éƒ¨åˆ†ã‚’ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«åˆ‡ã‚Šå‡ºã—ãŸã€‚\r\n- https://github.com/takusan23/Coneco/tree/master/conecocore\r\n- https://github.com/takusan23/Coneco/tree/master/conecohls\r\n\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œã£ãŸã®ã§ã›ã£ã‹ããªã‚‰å…¬é–‹ã—ã‚ˆã†ã¨ã„ã†ã‚ã‘ã§ã€  \r\n`Maven Central`ã¸å…¬é–‹ã—ã€ä»–ã®äººã‹ã‚‰ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ã¿ã¾ã™ï¼\r\n\r\n# ç’°å¢ƒ\r\n\r\n- ãƒªãƒã‚¸ãƒˆãƒª\r\n    - https://github.com/takusan23/Coneco\r\n- build.gradle.kts ã‚’ä½¿ã„ã¾ã™\r\n    - åˆ¥ã«ç§»è¡Œã—ã¦ã‚‚ä¾¿åˆ©ã«ã¯ãªã‚‰ãªã„ã¨æ€ã„ã¾ã™...\r\n- Windows 10 Pro\r\n\r\n## ç”¨èªé›†\r\nãªã‚“ã ã‹ã‚ˆãåˆ†ã‹ã‚‰ã‚“åå‰ã°ã£ã‹å‡ºã‚‹ã®ã§ã¾ã¨ã‚ã¾ã™ã€‚  \r\nãã‚Œãã‚Œã®ç«‹ã¡ä½ç½®ã‚’ç†è§£ã™ã‚‹ã®ã§ãŠè…¹ã„ã£ã±ã„ã«ãªã‚Šãã†ã€‚\r\n\r\n- Sonatype Jira\r\n    - ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã™ã‚‹ãŸã‚ä½¿ã†\r\n        - å¤šåˆ†ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†ã—ã¦ã‚‹ä¸­ã®äººã¨ã‚„ã‚Šå–ã‚Šã™ã‚‹ã®ã«ä½¿ã†\r\n        - Jira ãƒã‚±ãƒƒãƒˆã‚’åˆ‡ã£ã¦æ‹…å½“è€…ã«ãŠé¡˜ã„ã™ã‚‹\r\n        - ãƒã‚±ãƒƒãƒˆã‚’åˆ‡ã‚‹ã«ã¯ Jira ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚‚ä½œã‚‰ãªã„ã¨ã„ã‘ãªã„\r\n- Sonatype OSSRH\r\n    - Sonatype OpenSourceSoftware Repository Hosting ã®ç•¥ã‚‰ã—ã„\r\n    - ã¾ãšã¯ã“ã“ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n- MavenCentral\r\n    - Sonatype OSSRH ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒå•é¡Œãªã‘ã‚Œã° MavenCentral ã¸å…¬é–‹ã™ã‚‹ã€‚\r\n    - ã‚ˆãåˆ†ã‹ã‚‰ã‚“\r\n\r\n## æµã‚Œ\r\n- Sonatype (Atlassian) Jira ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹\r\n- ãƒªãƒã‚¸ãƒˆãƒªã®ä½œæˆã‚’ãŠé¡˜ã„ã™ã‚‹Jiraãƒã‚±ãƒƒãƒˆã‚’åˆ‡ã‚‹\r\n    - ã‚°ãƒ«ãƒ¼ãƒ—IDï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ã€GitHub Pagesï¼‰ã®ã©ã‚Œã‹ã‚’åˆ©ç”¨ã™ã‚‹\r\n- ç½²åã«ä½¿ã†GPGéµã‚’ä½œæˆã™ã‚‹\r\n- Gradleã‚’æ›¸ã\r\n- ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹\r\n- Sonatypeã®ç®¡ç†ç”»é¢ã‹ã‚‰MavenCentralã«å…¬é–‹ã™ã‚‹\r\n- ãŠã‚ã‚Š\r\n\r\nãªã’ãˆã‚ˆ...\r\n\r\n## å…¬å¼\r\n\r\nhttps://central.sonatype.org/publish/publish-guide/\r\n\r\n## ä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\nã‚ã‚Šåº§æ¤…å­\r\n\r\nhttps://github.com/gradle-nexus/publish-plugin\r\n\r\nhttps://github.com/Kotlin/dokka\r\n\r\n(Dokkaã§javadoc.jar ç”Ÿæˆ : https://kotlinlang.org/docs/dokka-gradle.html#build-javadoc-jar)\r\n\r\n## å‚è€ƒã«ã—ã¾ã—ãŸã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\r\nhttps://getstream.io/blog/publishing-libraries-to-mavencentral-2021/\r\n\r\nhttp://yuki312.blogspot.com/2021/08/maven-central-repository.html\r\n\r\n\r\n# Sonatype Atlassian Jira ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ä½œæˆ\r\nã“ã“ã‹ã‚‰ä½œã‚Œã¾ã™ã€‚  \r\nhttps://issues.sonatype.org/secure/Signup!default.jspa\r\n\r\nFull name ã¯é©å½“ã§ã„ã„ã‚“ã˜ã‚ƒã­ã€ãƒã‚«æ­£ç›´ã«ã‹ãå¿…è¦ã¯ãªã•ãã†é›°å›²æ°—ï¼ˆçŸ¥ã‚‰ã‚“ã‘ã©ã‚ã¨ã‹ã‚‰å¤‰æ›´ã§ãã‚‹ï¼‰ã€‚  \r\n**Usernameã¯å¤‰æ›´ã§ããªã„ä¸Šã«ç®¡ç†ç”»é¢ã¸ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹éš›ã‚‚ä½¿ã‚ã‚Œã‚‹ã®ã§ã‚ˆãè€ƒãˆãŸã»ã†ãŒè‰¯ã•ãã†**\r\n\r\nhttps://central.sonatype.org/publish/manage-user/#change-my-full-name-e-mail-address-or-password\r\n\r\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã®æ¡ä»¶é›£ã—ãã¦è‰ã€‚æœ€å¾Œã®è¨˜å·ã¨ã‹ã©ã†ã‚„ã£ã¦å‡ºã™ã‚“ã ã‚ˆ\r\n\r\n```\r\nYou must specify a password that satisfies the password policy.\r\nThe password must contain at least 1 special character, such as &, %, â„¢, or Ã‰.\r\n```\r\n\r\nå‡ºæ¥ãŸã‚‰ã“ã†ãªã‚‹ã€‚ä½œã£ãŸã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã€é©å½“ã«åˆæœŸè¨­å®šã‚’é€²ã‚ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/4NYMvGD.png)\r\n\r\nAtlassian Jira è‡ªä½“ã«ã¯æ—¥æœ¬èªãŒã‚ã‚Šã¾ã™ã€‚ãªãŠæ—¥æœ¬èªã§å¯¾å¿œã—ã¦ãã‚Œã‚‹ã¨ã¯è¨€ã£ã¦ã„ãªã„ã€‚\r\n\r\n![Imgur](https://imgur.com/wHObSuK.png)\r\n\r\n# ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦ã‚‚ã‚‰ã†Jiraãƒã‚±ãƒƒãƒˆã‚’åˆ‡ã‚‹\r\n**ä½œæˆ**ã‹ã‚‰ãƒã‚±ãƒƒãƒˆã‚’åˆ‡ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/UK5Aezu.png)\r\n\r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã€èª²é¡Œã‚¿ã‚¤ãƒ— ã¯ãã®ã¾ã¾ã§ãŠã£ã‘ãƒ¼\r\n\r\n![Imgur](https://imgur.com/K8YduK0.png)\r\n\r\nãã—ã¦ä»¥ä¸‹ã®é …ç›®ã‚’åŸ‹ã‚ã¦ã„ãã¾ã™ã€‚  \r\nGroup Idã£ã¦ã®ã¯`io.github.takusan23`ã¿ãŸã„ãªã‚„ã¤ã§ã™ã€‚    \r\nè‡ªåˆ†ã§æŒã£ã¦ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‹ä½¿ãˆã‚‹ã¿ãŸã„ã§ã™ãŒã€ä»Šå›ã¯GitHub Pagesã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ã„ã¾ã™ã€‚  \r\nã‚ˆããƒ©ã‚¤ãƒ–ãƒ©ãƒªå°å…¥æ™‚ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒé€†ã«ãªã£ãŸæ–‡å­—åˆ—ã‚’å…¥ã‚Œã‚‹ã¨æ€ã†ã®ã§ã™ãŒã€ãã‚Œã§ã™ã€‚\r\n\r\n`implementation(\"io.github.takusan23:conecocore:1.0.0\")` â† ã“ã® `io.github.takusan23`ãŒã‚°ãƒ«ãƒ¼ãƒ—ID\r\n\r\n| ãªã¾ãˆ                    | æ›¸ãã“ã¨                                                 | ä¾‹                                                                                                          |\r\n|---------------------------|----------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|\r\n| è¦ç´„                      | ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œã£ã¦æ¬²ã—ã„ã‚ˆï½çš„ãª                         | Create repository for io.github.takusan23                                                                   |\r\n| èª¬æ˜                      | ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œã£ãŸã‹ã‚‰MavenCentralã§å…¬é–‹ã—ãŸã„ã‚“ã ï¼ï½çš„ãª | I created an Android library that connects multiple videos. I would like to publish it using Maven Central. |\r\n| Group Id                  | ã‚°ãƒ«ãƒ¼ãƒ—IDã€GitHub Pagesã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã‹                   | io.github.takusan23                                                                                         |\r\n| Project URL               | GitHubã®ãƒªãƒã‚¸ãƒˆãƒªã¸ã®URL                                | https://github.com/takusan23/Coneco                                                                         |\r\n| SCM url                   | Project URLã§æ›¸ã„ãŸURLã«`.git`ã‚’ã¤ã‘ã‚Œã°è‰¯ã•ãã†         | https://github.com/takusan23/Coneco.git                                                                     |\r\n| Already Synced to Central | åˆã‚ã¦ãªã‚‰Noã§è‰¯ã„ã¨æ€ã†                                 | No                                                                                                          |\r\n\r\nä»¥ä¸‹ä¾‹ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/kanqUyx.png)\r\n\r\nä½œæˆã‚’æŠ¼ã™ã¨ã€ã“ã‚“ãªé¢¨ã«ãªã‚‹ã®ã§ãƒã‚±ãƒƒãƒˆã®è©³ç´°ãƒšãƒ¼ã‚¸ã¸é£›ã³ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/Bnxb0zf.png)\r\n\r\n## æ•°åç§’å¾…ã£ã¦ã„ã‚‹ã¨...\r\nãƒã‚±ãƒƒãƒˆã¸ã‚³ãƒ¡ãƒ³ãƒˆãŒä»˜ãã¾ã™ã€‚ï¼ˆBotãªã‚“ã§ã™ã‘ã©ã­åˆè¦‹ã•ã‚“ï¼‰  \r\n\r\n![Imgur](https://imgur.com/lljwjuq.png)\r\n\r\nã“ã“ã§ã‚°ãƒ«ãƒ¼ãƒ—IDã®æ¤œè¨¼ã‚’è¡Œã„ã¾ã™ã€ãŒç‰¹ã«é›£ã—ã„ã“ã¨ã‚’ã™ã‚‹ã‚ã‘ã§ã‚‚ãªãã€  \r\nè‡ªåˆ†ã®GitHubã®ãƒªãƒã‚¸ãƒˆãƒªã«ä½œã£ãŸJiraãƒã‚±ãƒƒãƒˆã®ãƒã‚±ãƒƒãƒˆç•ªå·ï¼ˆOSSRH- ã‹ã‚‰å§‹ã¾ã‚‹ã‚„ã¤ï¼‰ã®åå‰ã§ãƒªãƒã‚¸ãƒˆãƒªã‚’ä½œæˆã—ã‚ã£ã¦å†…å®¹ã§ã™ã€‚\r\n\r\nã¨ã„ã†ã‚ã‘ã§ä½œæˆã—ã¦\r\n\r\n![Imgur](https://imgur.com/VtlXUag.png)\r\n\r\nãƒã‚±ãƒƒãƒˆã®ã‚³ãƒ¡ãƒ³ãƒˆã«ä½œã£ãŸã“ã¨ã‚’çŸ¥ã‚‰ã›ã¾ã™ã€‚  \r\n\r\n```\r\nCreated repository forÂ https://github.com/takusan23/OSSRH-79851\r\n```\r\n\r\n![Imgur](https://imgur.com/tSevFmy.png)\r\n\r\nãƒã‚±ãƒƒãƒˆã‚’Openã«ã—ã‚ã£ã¦è¨€ã‚ã‚Œã¦ã‚‹ã‚“ã ã‘ã©å‹æ‰‹ã«Openã«ãªã£ã¦ãŸ\r\n\r\n![Imgur](https://imgur.com/396HM8B.png)\r\n\r\n## æ•°åˆ†å¾Œã«...\r\n\r\nMavenCentralã§`io.github.takusan23`ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸãï¼ã£ã¦ãƒ¡ãƒ¼ãƒ«ãŒæ¥ã¾ã—ãŸã€‚æ­¯ç£¨ãçµ‚ã‚ã£ãŸã‚‰ä»•äº‹çµ‚ã‚ã£ã¦ãŸã€‚æœ‰èƒ½ã‹ã‚ˆ\r\n\r\n![Imgur](https://imgur.com/k01PjD8.png)\r\n\r\nã“ã‚Œã§ã€https://s01.oss.sonatype.org/ ã«ãƒ­ã‚°ã‚¤ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\nãƒ­ã‚°ã‚¤ãƒ³ã¯ã“ã“ã§ã™ã€‚  \r\nUsernameã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯ã•ã£ãã®Jiraã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨åŒã˜ã‚‚ã®ã‚’ä½¿ãˆã°OKã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/zyI6CQw.png)\r\n\r\n![Imgur](https://imgur.com/dqOgO67.png)\r\n\r\n# ç½²åã§ä½¿ã†éµã‚’ä½œæˆã™ã‚‹\r\nå…¬å¼ï¼šhttps://central.sonatype.org/publish/requirements/gpg/\r\n\r\nç§ã¯ Windowsãƒ¦ãƒ¼ã‚¶ãƒ¼ ãªã®ã§ Gpg4win ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\nhttps://gpg4win.org/index.html\r\n\r\n![Imgur](https://imgur.com/p2ekpeb.png)\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®æ¡ˆå†…ã«å¾“ã£ã¦å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/xdPIIfD.png)\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã‚‰é–‹ãã¾ã™ã€‚GUIãŒä»˜å±ã—ã¦ã¾ã™ã®ã§ä½¿ã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/isJTqGm.png)\r\n\r\n## ç½²åã®ä¸­èº«\r\nè©³ç´°è¨­å®šã¯ã€`è©³ç´°è¨­å®š`ã‚’æŠ¼ã™ã¨é–‹ãã¾ã™ã€‚\r\n\r\n| ãªã¾ãˆ                                      | ã‚ãŸã„                                          |\r\n|---------------------------------------------|-------------------------------------------------|\r\n| åå‰                                        | å„è‡ªã®åå‰                                      |\r\n| ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹                              | å„è‡ªã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹                            |\r\n| éµã®è¦ç´                                     | RSA +RSA (4096 ãƒ“ãƒƒãƒˆ)                          |\r\n| è¨¼æ˜æ›¸ã®åˆ©ç”¨ç›®çš„                            | ç½²å ï¼ˆæœ‰åŠ¹æœŸé™æ±ºã‚ã‚‹ã“ã¨ã‚‚å¯èƒ½ã€ä»Šå›ã¯ã—ãªã„ï¼‰ |\r\n| Protect the generated key with a passphrase | ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹                                |\r\n\r\n![Imgur](https://imgur.com/YNdDU66.png)\r\n\r\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/R2kALYR.png)\r\n\r\nã§ãã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/N5svyQA.png)\r\n\r\n### ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¨å¤±åŠ¹è¨¼æ˜æ›¸ã®ä½œæˆ\r\nä¸€å¿œä½œæˆã—ã¾ã™ã€‚\r\n\r\nãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã¯ã‚­ãƒ¼ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å‡ºã—ã€`Backup Secret Keys...`ã§å‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/NprkeQg.png)\r\n\r\nå¤±åŠ¹è¨¼æ˜æ›¸ã‚’ä½œã£ã¦ãŠãã¨ã€ä¸‡ãŒä¸€ç§˜å¯†éµãŒæ¼ã‚ŒãŸå ´åˆã«ç„¡åŠ¹ã«ã§ãã¾ã™ã€‚  \r\nã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã€`è©³ç´°`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/12Qnqs7.png)\r\n\r\nãã—ãŸã‚‰`Generate revocation certificate`ã‚’æŠ¼ã™ã“ã¨ã§ç™ºè¡Œã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/HVpCBv3.png)\r\n\r\n## å…¬é–‹éµã‚’éµã‚µãƒ¼ãƒãƒ¼ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\nGUIã§ã‚„ã‚‹æ–¹æ³•ãŒã‚ã‹ã‚‰ã‚“ã‹ã£ãŸã®ã§ã€ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã‚„ã‚Šã¾ã™ã€‚  \r\nã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã€PowerShellç­‰ã‚’èµ·å‹•ã—ã¦ã€ã¾ãšéµä¸€è¦§ã‚’å‡ºã—ã¾ã™\r\n\r\n`gpg --list-keys`\r\n\r\nãã—ãŸã‚‰é•·ã„16é€²æ•°ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€ã“ã®16é€²æ•°ã®æœ€å¾Œã‹ã‚‰8æ–‡å­—åˆ†ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ãŠãã¾ã™ã€‚\r\n\r\næ¬¡ã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\r\n\r\n```shell\r\ngpg --keyserver keyserver.ubuntu.com --send-keys <ã‚³ãƒ”ãƒ¼ã—ãŸ16é€²æ•°>\r\n```\r\n\r\n![Imgur](https://imgur.com/PHk9DF8.png)\r\n\r\n## ç½²åéµã‚’Base64ã«ã™ã‚‹\r\næœ€å¾Œã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ç½²åã§ä½¿ã†ã®ã§ã€ç§˜å¯†éµã‚’Base64ã§æ›¸ãå‡ºã—ã¦ãŠãã¾ã™ã€‚  \r\n**ç§˜å¯†éµãªã®ã§æ‰±ã„ã«ã¯ååˆ†æ°—ã‚’ã¤ã‘ã¦ã­ï¼ï¼ï¼ï¼**\r\n\r\n`macOS`ã¨ã‹ã ã¨ãƒ¯ãƒ³ãƒ©ã‚¤ãƒŠãƒ¼ã¿ãŸã„ãªã‚“ã§ã™ãŒã€Windowsã®å ´åˆã¯ã¡ã‚‡ã£ã¨ã‚ã‚“ã©ã„ã§ã™ã­...  \r\né©å½“ãªãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šãã®ä¸­ã§ã€PowerShellãªã©ã‚’èµ·å‹•ã—ã¦...\r\n\r\n```shell\r\ngpg --export-secret-keys ã‚³ãƒ”ãƒ¼ã—ãŸ16é€²æ•° > export_secret\r\ncertutil -f -encode export_secret export_secret_base64\r\n```\r\n\r\n`export_secret_base64`ãƒ•ã‚¡ã‚¤ãƒ«ãŒã§ãã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚Base64ãªãƒ•ã‚¡ã‚¤ãƒ«ã¯æ–‡å­—ãªã®ã§ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ã‘ã¾ã™ã€‚  \r\næœ€åˆã®`-----BEGIN CERTIFICATE-----`ã¨æœ€å¾Œã®`-----END CERTIFICATE-----`ã‚’æ¶ˆã—ã¦ã€æ”¹è¡Œã‚‚æ¶ˆã—ã¾ã™\r\n\r\n# ã„ã‚ˆã„ã‚ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã™ã‚‹ãŸã‚ã®Gradleã‚¿ã‚¹ã‚¯ã‚’æ›¸ã„ã¦ã„ã...\r\n\r\n**2023/02/19 ã‚ã£ã¡ã‚ƒé–“é•ãˆã¦ã¾ã—ãŸã€‚ã™ã„ã¾ã›ï½ã€‚ã‚½ãƒ¼ã‚¹ã¨javadocãŒå…¥ã‚‹ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚**\r\n\r\n## ãƒ«ãƒ¼ãƒˆ (.idea ãŒã‚ã‚‹å ´æ‰€) ã® build.gradle.kts\r\n\r\nã¾ãšãƒ«ãƒ¼ãƒˆã«ã‚ã‚‹ build.gradle.kts ã¸æ›¸ãè¶³ã—ã¾ã™ã€‚  \r\n`kts`ã§æ›¸ã„ãŸå ´åˆã€åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’æ›¸ã„ã¦`apply from`ã™ã‚‹æ–¹æ³•ãŒä½¿ãˆãªã„ã¿ãŸã„ãªã®ã§ã€ç›´æ¥æ›¸ãã—ã‹ãªã„ã§ã™ã€‚  \r\n(å‚è€ƒã«ã—ãŸè¨˜äº‹ã§ã¯åˆ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«åˆ†ã‘ã¦ãŸã€~~ã‚ã‚Œï¼Ÿktsã«ç§»è¡Œã™ã‚‹ãƒ¡ãƒªãƒƒãƒˆãƒã‚¸ã§ãªããªã„...~~)\r\n\r\nhttps://github.com/gradle/kotlin-dsl-samples/issues/1287\r\n\r\n```kotlin\r\nbuildscript {\r\n    val kotlinVersion: String by extra(\"1.7.10\")\r\n    val composeVersion: String by extra(\"1.3.1\")\r\n}\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nplugins {\r\n    id(\"com.android.application\").version(\"7.4.0\").apply(false)\r\n    id(\"com.android.library\").version(\"7.4.0\").apply(false)\r\n    id(\"org.jetbrains.kotlin.android\").version(\"1.7.10\").apply(false)\r\n    // ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆã¨ Maven Central ã¸å…¬é–‹ã‚’ã—ã¦ãã‚Œã‚‹ã‚„ã¤\r\n    id(\"org.jetbrains.dokka\").version(\"1.7.10\")\r\n    id(\"io.github.gradle-nexus.publish-plugin\").version(\"1.1.0\")\r\n}\r\n\r\ntasks.register(\"clean\") {\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n\r\n// ãƒ©ã‚¤ãƒ–ãƒ©ãƒªç½²åæƒ…å ±ãŒãªãã¦ã‚‚ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\r\nextra[\"signing.keyId\"] = \"\"\r\nextra[\"signing.password\"] = \"\"\r\nextra[\"signing.key\"] = \"\"\r\nextra[\"ossrhUsername\"] = \"\"\r\nextra[\"ossrhPassword\"] = \"\"\r\nextra[\"sonatypeStagingProfileId\"] = \"\"\r\n\r\n// ç½²åæƒ…å ±ã‚’èª­ã¿å‡ºã™ã€‚é–‹ç™ºç’°å¢ƒã§ã¯ local.properties ã«ç½²åæƒ…å ±ã‚’ç½®ã„ã¦ã„ã‚‹ã€‚\r\nval secretPropsFile = project.rootProject.file(\"local.properties\")\r\nif (secretPropsFile.exists()) {\r\n    // èª­ã¿å‡ºã—ã¦ã€extra ã¸æ ¼ç´ã™ã‚‹\r\n    val properties = java.util.Properties().apply {\r\n        load(secretPropsFile.inputStream())\r\n    }\r\n    properties.forEach { name, value -> extra[name as String] = value }\r\n} else {\r\n    // ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ã‹ã‚‰èª­ã¿å‡ºã™ã€‚CI/CD ç”¨\r\n    extra[\"ossrhUsername\"] = System.getenv(\"OSSRH_USERNAME\")\r\n    extra[\"ossrhPassword\"] = System.getenv(\"OSSRH_PASSWORD\")\r\n    extra[\"sonatypeStagingProfileId\"] = System.getenv(\"SONATYPE_STAGING_PROFILE_ID\")\r\n    extra[\"signing.keyId\"] = System.getenv(\"SIGNING_KEY_ID\")\r\n    extra[\"signing.password\"] = System.getenv(\"SIGNING_PASSWORD\")\r\n    extra[\"signing.key\"] = System.getenv(\"SIGNING_KEY\")\r\n}\r\n\r\n// Sonatype OSSRH ãƒªãƒã‚¸ãƒˆãƒªæƒ…å ±\r\nnexusPublishing.repositories.sonatype {\r\n    stagingProfileId.set(extra[\"sonatypeStagingProfileId\"] as String)\r\n    username.set(extra[\"ossrhUsername\"] as String)\r\n    password.set(extra[\"ossrhPassword\"] as String)\r\n    nexusUrl.set(uri(\"https://s01.oss.sonatype.org/service/local/\"))\r\n    snapshotRepositoryUrl.set(uri(\"https://s01.oss.sonatype.org/content/repositories/snapshots/\"))\r\n}\r\n```\r\n\r\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®æ–¹ã® build.gradle.kts\r\nã“ã£ã¡ã‚‚åŒæ§˜ç›´æ¥æ›¸ãã—ã‹ãªã„ã§ã™ã€‚  \r\n`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå`ã€`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª¬æ˜`ã®éƒ¨åˆ†ã‚„ã€  \r\nä½œè€…ã¨ã‹ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨ã‹ãŒæ›¸ã„ã¦ã‚ã‚‹ä¸‹ã®éƒ¨åˆ†ã¯å„è‡ªæ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚\r\n\r\n| ãªã¾ãˆ     | ã›ã¤ã‚ã„                                                |\r\n|------------|---------------------------------------------------------|\r\n| groupId    | Sonatype OSSRH ã®Jiraãƒã‚±ãƒƒãƒˆã§æ±ºã‚ãŸã®ã¨åŒã˜ã‚°ãƒ«ãƒ¼ãƒ—ID |\r\n| artifactId | ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã¨ã‚‚è¨€ã†                                    |\r\n| version    | ãƒãƒ¼ã‚¸ãƒ§ãƒ³                                              |\r\n\r\n```kotlin\r\nplugins {\r\n    id(\"com.android.library\")\r\n    id(\"org.jetbrains.kotlin.android\")\r\n    // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«åŒæ¢±ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆå™¨\r\n    id(\"org.jetbrains.dokka\")\r\n    // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œæˆã«å¿…è¦\r\n    `maven-publish`\r\n    signing\r\n}\r\n\r\n// ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãƒãƒ¼ã‚¸ãƒ§ãƒ³\r\nval libraryVersion = \"1.0.2\"\r\n// ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå\r\nval libraryName = \"conecocore\"\r\n// ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®èª¬æ˜\r\nval libraryDescription = \"It is a library that connects multiple videos into one.\"\r\n\r\nandroid {\r\n    compileSdk = 33\r\n    namespace = \"io.github.takusan23.conecocore\"\r\n\r\n    defaultConfig {\r\n        minSdk = 21\r\n        targetSdk = 33\r\n\r\n        testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\"\r\n        consumerProguardFile(\"consumer-rules.pro\")\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            isMinifyEnabled = false\r\n            proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"proguard-rules.pro\")\r\n        }\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility = JavaVersion.VERSION_1_8\r\n        targetCompatibility = JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = \"1.8\"\r\n    }\r\n}\r\n\r\ndependencies {\r\n\r\n    implementation(\"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.6.0\")\r\n\r\n    implementation(\"androidx.core:core-ktx:1.7.0\")\r\n    implementation(\"androidx.appcompat:appcompat:1.4.1\")\r\n\r\n    testImplementation(\"junit:junit:4.13.2\")\r\n    androidTestImplementation(\"androidx.test.ext:junit:1.1.3\")\r\n    androidTestImplementation(\"androidx.test.espresso:espresso-core:3.4.0\")\r\n}\r\n\r\nval androidSourcesJar = tasks.register<Jar>(\"androidSourcesJar\") {\r\n    archiveClassifier.set(\"sources\")\r\n    from(android.sourceSets[\"main\"].java.srcDirs)\r\n}\r\n\r\ntasks.dokkaJavadoc {\r\n    outputDirectory.set(File(buildDir, \"dokkaJavadoc\"))\r\n}\r\n\r\nval javadocJar = tasks.register<Jar>(\"dokkaJavadocJar\") {\r\n    dependsOn(tasks.dokkaJavadoc)\r\n    from(tasks.dokkaJavadoc.flatMap { it.outputDirectory })\r\n    archiveClassifier.set(\"javadoc\")\r\n}\r\n\r\nartifacts {\r\n    archives(androidSourcesJar)\r\n    archives(javadocJar)\r\n}\r\n\r\nsigning {\r\n    // ãƒ«ãƒ¼ãƒˆ build.gradle.kts ã® extra ã‚’è¦‹ã«è¡Œã\r\n    useInMemoryPgpKeys(\r\n        rootProject.extra[\"signing.keyId\"] as String,\r\n        rootProject.extra[\"signing.key\"] as String,\r\n        rootProject.extra[\"signing.password\"] as String,\r\n    )\r\n    sign(publishing.publications)\r\n}\r\n\r\nafterEvaluate {\r\n    publishing {\r\n        publications {\r\n            create<MavenPublication>(\"maven\") {\r\n                groupId = \"io.github.takusan23\"\r\n                artifactId = libraryName\r\n                version = libraryVersion\r\n                if (project.plugins.hasPlugin(\"com.android.library\")) {\r\n                    from(components[\"release\"])\r\n                } else {\r\n                    from(components[\"java\"])\r\n                }\r\n                artifact(androidSourcesJar)\r\n                artifact(javadocJar)\r\n                pom {\r\n                    // ãƒ©ã‚¤ãƒ–ãƒ©ãƒªæƒ…å ±\r\n                    name.set(artifactId)\r\n                    description.set(libraryDescription)\r\n                    url.set(\"https://github.com/takusan23/Coneco/\")\r\n                    // ãƒ©ã‚¤ã‚»ãƒ³ã‚¹\r\n                    licenses {\r\n                        license {\r\n                            name.set(\"Apache License 2.0\")\r\n                            url.set(\"https://github.com/takusan23/Coneco/blob/master/LICENSE\")\r\n                        }\r\n                    }\r\n                    // é–‹ç™ºè€…\r\n                    developers {\r\n                        developer {\r\n                            id.set(\"takusan_23\")\r\n                            name.set(\"takusan_23\")\r\n                            url.set(\"https://takusan.negitoro.dev/\")\r\n                        }\r\n                    }\r\n                    // git\r\n                    scm {\r\n                        connection.set(\"scm:git:github.com/takusan23/Coneco\")\r\n                        developerConnection.set(\"scm:git:ssh://github.com/takusan23/Coneco\")\r\n                        url.set(\"https://github.com/takusan23/Coneco\")\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n# local.properties ã«èªè¨¼æƒ…å ±ã‚’æ›¸ãè¾¼ã‚€\r\nã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯gitã®ç®¡ç†ä¸‹ã«ã—ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚çµ¶å¯¾äººã«ã¯è¦‹ã›ã¡ã‚ƒã ã‚ã§ã™ã‚ˆã€‚  \r\nãªã‚“ã‹æ›¸ã„ã¦ã‚ã‚‹ã‹ã‚‚ã ã‘ã©ãã®ä¸‹ã«ã‹ã‘ã°ã„ã„ã§ã™ã€‚\r\n\r\n```properties\r\n# Gitç®¡ç†ä¸‹ã«å…¥ã‚Œã¦ã¯ãœã£ã£ã£ãŸã„ãƒ€ãƒ¡ã§ã™\r\n# çµ¶å¯¾ç§˜å¯†ã§ã™\r\n# éµIDã®æœ€å¾Œ8æ¡\r\nsigning.keyId=xxxxxx\r\n# ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\r\nsigning.password=password\r\n# ç§˜å¯†éµã®Base64\r\nsigning.key=xxxxxxxxx\r\n# Sonatype OSSRH ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å\r\nossrhUsername=takusan_23\r\n# Sonatype OSSRH ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰\r\nossrhPassword=password\r\n# Sonatype ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«Id\r\nsonatypeStagingProfileId=8320....\r\n```\r\n\r\n## ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«Id ã©ã“ã‚„ã­ã‚“\r\n\r\nSonatype OSSRH ã® nexus repository manager ã¸ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚  \r\nhttps://s01.oss.sonatype.org\r\n\r\nãã—ãŸã‚‰ã€å·¦å´ã«ã‚ã‚‹ä¸­ã‹ã‚‰ã€`Staging Profiles`ã‚’æŠ¼ã—ã¦ã€è‡ªåˆ†ã®åå‰ã®éƒ¨åˆ†ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\næŠ¼ã—ãŸã‚‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹æ¬„ã‚’è¦‹ã¾ã™ã€‚`stagingProfiles;`ã®ã‚ã¨ã®16é€²æ•°ãŒ`ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«Id`ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/z9PU7tD.png)\r\n\r\n# å…¬é–‹ã™ã‚‹ãï¼ï¼ï¼ï¼\r\nã¨ã„ã£ã¦ã‚‚ç›´æ¥`MavenCentral`ã«å…¬é–‹ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªãã€ä¸€æ—¦`Sonatype OSSRH`ã®`nexus repository manager`ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¾ã™ã€‚  \r\nãã®å¾Œå•é¡ŒãŒãªã‘ã‚Œã°å…¬é–‹ã¨ã„ã†æµã‚Œã«ãªã‚Šã¾ã™ã€‚\r\n\r\nAndroid Studioã®å³å´ã«ã‚ã‚‹`Gradle`ã‚’æŠ¼ã—ã¦ãã†ã•ã‚“ã®ãƒãƒ¼ã‚¯ğŸ˜ã‚’æŠ¼ã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™ã€‚  \r\nå‚è€ƒã«ã—ãŸè¨˜äº‹ã¨ã‚³ãƒãƒ³ãƒ‰ãŒå¤‰ã‚ã£ã¦ã¾ã™ã­ã€‚\r\nhttps://github.com/gradle-nexus/publish-plugin\r\n\r\n```\r\ngradle :ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå(ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å):publishToSonatype\r\n```\r\n\r\n![Imgur](https://imgur.com/d5Stw0C.png)\r\n\r\næ•°åç§’å¾Œã«çµ‚äº†ã—ã¾ã—ãŸã€‚  \r\nãƒ—ãƒ©ã‚°ã‚¤ãƒ³ä½œã£ãŸã‚„ã¤ã™ã’ãˆï¼\r\n\r\n![Imgur](https://imgur.com/OCI1AHS.png)\r\n\r\n# Sonatype OSSRH nexus repository manager ã® ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ãƒªãƒã‚¸ãƒˆãƒªã‚’è¦‹ã«è¡Œã\r\n\r\nã¾ãŸã•ã£ãã®ãƒªãƒã‚¸ãƒˆãƒªã®URL https://s01.oss.sonatype.org/ ã‚’é–‹ã„ã¦ã€`Staging Repositories`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\næŠ¼ã—ãŸã‚‰ã€`Refresh`ã‚’æŠ¼ã—ã¦æœ€æ–°ã®çŠ¶æ…‹ã«ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\nã©ã†ã§ã™ã‹ï¼Ÿã‚ã‚Šã¾ã—ãŸã‹ï¼ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/QQk5ikQ.png)\r\n\r\nå•é¡ŒãŒãªã‘ã‚Œã°**Close**ã‚’ã€ã‚„ã‚Šç›´ã—ãŸã„å ´åˆã¯**Drop**ã§æ¶ˆã›ã¾ã™ã€‚  \r\n\r\n## Close ã‚’æŠ¼ã™\r\n`Close`ã‚’æŠ¼ã™ã¨ã€MavenCentralã¸å…¬é–‹ã™ã‚‹ï¼Ÿæº–å‚™ãŒå§‹ã¾ã‚Šã¾ã™ã€‚  \r\nè‡ªå‹•ã§å…¬é–‹ã•ã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„ã®ã§ã€ã¾ã å®‰å¿ƒã§ãã¾ã™ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/omkAFZU.png)\r\n\r\nã—ã°ã‚‰ãå¾…ã£ã¦ã„ã‚‹ã¨**Release**ãŒæŠ¼ã›ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã—ãŸã€‚  \r\nã„ãããŠãŠãŠãŠãŠã€æ–°æ›²ï¼\r\n\r\n![Imgur](https://imgur.com/EdiIqLW.png)\r\n\r\n`Confirm`ã‚’æŠ¼ã—ã¦ãƒªãƒªãƒ¼ã‚¹ã§ã™ï¼\r\n\r\n![Imgur](https://imgur.com/Ys8HBSc.png)\r\n\r\næ•°æ™‚é–“å¾Œã« https://repo1.maven.org/maven2/ ã‹ã‚‰è¦‹ã‚Œã‚‹ã‚ˆã†ã«ãªã‚‹ã¿ãŸã„ãªã®ã§æ¥½ã—ã¿ã§ã™ã­ã€‚\r\n\r\n# å…¬é–‹ã•ã‚ŒãŸã‹è¦‹ã‚‹\r\nhttps://repo1.maven.org/maven2/ ã‚’é–‹ã„ã¦è¾¿ã£ã¦ã„ã‘ã°ã„ã„ã§ã™ã€‚ \r\nã‚ã£ãŸï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/b38RD5W.png)\r\n\r\n## search.maven.org ã§ã‚‚ç¢ºèªã™ã‚‹\r\nã•ã‚‰ã«å¾…ã£ã¦ã‚‹ã¨ã€ https://search.maven.org ã§æ¤œç´¢å‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/v02mUI0.png)\r\n\r\n\r\nã†ãŠãŠãŠãŠã€ãªã‚“ã‹ã™ã”ã„\r\n\r\n![Imgur](https://imgur.com/0IIme8l.png)\r\n\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®è©³ç´°ç”»é¢ã¯ã“ã‚“ãªæ„Ÿã˜ã€å°å…¥æ–¹æ³•ã¨ã‹æ›¸ã„ã¦ã‚ã‚‹ã€‚\r\n\r\n![Imgur](https://imgur.com/KTPtKXR.png)\r\n\r\n# ä½¿ã†å´ã«ãªã‚‹\r\n\r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ¬ãƒ™ãƒ«(appãƒ•ã‚©ãƒ«ãƒ€å†…)ã®`build.gradle`ã«æ›¸ãè¶³ã™ã¨è¿½åŠ ã§ãã¾ã™ã€‚ã‚„ã£ãŸãœ\r\n\r\n```\r\nimplementation '<ã‚°ãƒ«ãƒ¼ãƒ—Id>:<ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåï¼ˆã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆIdï¼‰>:<ãƒãƒ¼ã‚¸ãƒ§ãƒ³>'\r\n```\r\n\r\nä»Šå›ä½œã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã¨ã“ã†ã§ã™ã­ã€‚\r\n\r\n```java\r\n// build.gradle\r\nimplementation 'io.github.takusan23:conecocore:1.0.0'\r\n\r\n// build.gradle.kts ã®å ´åˆ\r\nimplementation(\"io.github.takusan23:conecocore:1.0.0\")\r\n```\r\n\r\nã“ã‚Œã§ä»–ã®å¤§æ‰‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã‚ˆã†ã«å°å…¥ã§ãã¾ã™ã€‚ãã£ãå¤§å¤‰ã ãªã“ã‚Œ...\r\n\r\n![Imgur](https://imgur.com/qek6dbP.png)\r\n\r\n~~(ãªã‚“ã‹åˆ¥ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç”Ÿæˆã—ãªã„ã¨ãƒ€ãƒ¡ã¿ãŸã„ã§ã™ã­...)~~\r\n\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚ŒãŸéš›ã«ä¸€ç·’ã«`XXX-sources.jar`ãŒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã®ã§ã€IDEä¸Šã§ã‚‚ãã®ã¾ã¾è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/AwCm0Oh.png)\r\n\r\n![Imgur](https://imgur.com/RuVmcSf.png)\r\n\r\n# ä»–ã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã—ãŸã„å ´åˆ\r\nã™ã§ã«ãƒªãƒã‚¸ãƒˆãƒªãŒã‚ã‚‹(Sonatype OSSRH nexus repository manager ãŒä½¿ãˆã‚‹)ã®ã§ã€`build.gradle.kts`ã®ã¨ã“ã‚ã‹ã‚‰ã‚„ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nã©ã†ã\r\n\r\nhttps://github.com/takusan23/Coneco\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\n4æœˆã‚‚çµ‚ã‚ã‚Šã¾ã™ã­..."},{"title":"Androidã®MediaCodecã‚’åˆ©ç”¨ã—ã¦è¤‡æ•°ã®å‹•ç”»ã‚’ç¹‹ã’ã¦ä¸€ã¤ã®å‹•ç”»ã«ã™ã‚‹","link":"/posts/android_mediacodec_merge_video/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã‚¢ã‚¤ã‚«ã‚®2 æ”»ç•¥ã—ã¾ã—ãŸã€‚<span style=\"font-size:10px\">å£°å„ªè²·ã„ã ã£ãŸã‘ã©</span>äºˆæƒ³ä»¥ä¸Šã§é¢ç™½ã‹ã£ãŸã§ã™ã€‚  \r\nãšãƒ¼ãƒ¼ãƒ¼ã£ã¨ã‹ã‚ã„ã‹ã£ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/SBK2sis.png)\r\n\r\n![Imgur](https://imgur.com/PC8tXYN.png)\r\n\r\n![Imgur](https://imgur.com/wPFTJ6b.png)\r\n\r\nã‹ã‚ã„ã„\r\n\r\n# æœ¬é¡Œ\r\nHLSå½¢å¼ã®å‹•ç”»ã£ã¦`MPEG2-TS ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ`ãŒè¤‡æ•°æµã‚Œã¦ãã‚‹ã‚“ã ã‘ã©ã€ã“ã‚Œä¸€ã¤ã®`mp4`ã¨ã‹ã«ã§ããªã„ã®ã‹ã£ã¦è©±ã€‚  \r\nè¤‡æ•°ã®å‹•ç”»ã£ã¦è¨€ã£ã¦ã‚‹ã‘ã©ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨ã‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒåŒã˜å ´åˆã«é™ã‚‹ã‘ã©...\r\n\r\n### ç•ªå¤–ç·¨ FFmpeg ã§ã‚ˆããªã„ï¼Ÿ\r\nGPLã€Œã‚„ã‚ï¼ã€  \r\nãƒ©ã‚¤ã‚»ãƒ³ã‚¹å•é¡Œã‚‚ã‚ã‚‹ã£ã¡ã‚ƒã‚ã‚‹ã‘ã©ã€ãã‚Œã‚ˆã‚Šã‚¢ãƒ—ãƒªã®ã‚µã‚¤ã‚ºãŒãƒ‡ã‚«ããªã‚Šãã†...\r\n\r\n### ç•ªå¤–ç·¨ MediaCodecã®ä½¿ã„æ–¹ã®ä¾‹ãŒè¦‹ãŸã‹ã£ãŸã‚“ã ã‘ã©æ¤œç´¢å¦¨å®³ã™ã‚‹ã®è¾ã‚ãªã„ï¼Ÿ\r\nhttps://github.com/takusan23/MediaCodecDecode  \r\nã®ãƒ–ãƒ©ãƒ³ãƒã«éŸ³å£°ã€æ˜ åƒãã‚Œãã‚Œã‚’MediaCodecã‚’åˆ©ç”¨ã—ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã‚µãƒ³ãƒ—ãƒ«ãŒã‚ã‚Šã¾ã™ã€‚ãƒãƒ©ã‚·ã®è£çš„ãªæ„Ÿã˜ã§ã©ã†ã...  \r\n(`masterãƒ–ãƒ©ãƒ³ãƒ`ä»¥å¤–ã§ä½œæ¥­ã—ã¦ãŸã›ã„ã§GitHubã®è‰ãŒç”Ÿãˆã¦ãªã„ã‚ˆ...ï¼›ï¼›)\r\n\r\n- å‹•ç”»ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦SurfaceViewã¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹\r\n    - https://github.com/takusan23/MediaCodecDecode/blob/video-decode/app/src/main/java/io/github/takusan23/mediacodecdecode/MainActivity.kt\r\n- å‹•ç”»ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦AudioTarckã§éŸ³å£°ã‚’å†ç”Ÿã™ã‚‹\r\n    - https://github.com/takusan23/MediaCodecDecode/blob/audio-decode/app/src/main/java/io/github/takusan23/mediacodecdecode/MainActivity.kt\r\n\r\n## å¤šåˆ†èª­ã¾ãªãã¦ã„ã„ å‹•ç”»ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ ã®è©±\r\nå¤šåˆ†åŸºç¤çš„ãªè©±ãªã®ã§è¦‹ãªãã¦è‰¯ãã€‚ã¨ã„ã†ã‹ã‚ã£ã¦ã‚‹ã‹åˆ†ã‹ã‚‰ãªã„ï¼›ï¼›\r\n\r\n### ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\r\n`MPEG2-TS`ã¨ã‹`mp4`ã¨ã‹ã¯ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã‚ã‚Šã€éŸ³å£°ãƒ»æ˜ åƒã‚’ãã‚Œãã‚Œã—ã¾ã£ã¦ãŠãã‚‚ã®ã§ã™ã€‚ï¼ˆå¤šåˆ†ï¼‰  \r\nä¸Šè¨˜2ã¤ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãªã‚‰ã€æ˜ åƒï¼ˆH.264ãŒå¤šã„ï¼Ÿï¼‰ã¨éŸ³å£°ï¼ˆAACãŒå¤šã„ï¼Ÿï¼‰ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\nAndroidã ã¨`MediaExtractor`ã€`MediaMuxer`ã‚ãŸã‚Šã§è§¦ã‚Šã¾ã™ã€‚\r\n\r\n### ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\nã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã®ç¨®é¡ã€‚  \r\næ˜ åƒãªã‚‰H.264ï¼ˆAVCï¼‰ã¨ã‹H.265ï¼ˆHEVCï¼‰ã®ã“ã¨ã€‚  \r\néŸ³å£°ãªã‚‰AACã¨ã‹ï¼Ÿ\r\n\r\nAndroidã§ã¯`MediaCodec`ã§è§¦ã‚Šã¾ã™ã­\r\n\r\nã“ã†æ›¸ã„ã¦ã¿ã‚‹ã¨ã€FFmpegã£ã¦ã“ã®è¾ºã‚ˆãã‚ã‹ã‚‰ã‚“ãã¦ã‚‚é©å½“ã«ã‚„ã£ã¦ãã‚Œã¦ãŸã‚“ã‚„ãªã‚...\r\n\r\n### HLS\r\nAppleæ§˜ãŒä½œã£ãŸæ˜ åƒã‚’ã”ã¾ãã‚Œã«ã—ã¦é€ã‚‹æŠ€è¡“ã€‚ãƒ©ã‚¤ãƒ–é…ä¿¡ã¨ã‹æš—å·åŒ–ã—ãŸã„å‹•ç”»ã®å ´åˆã«ä½¿ã£ã¦ã‚‹ã¨ã‹ãªã‚“ã¨ã‹ã€‚  \r\n\r\nè¶…çµ¶ã©ã†ã§ã‚‚ã„ã„ã‘ã©ã€Appleã®WWDCã£ã¦æ˜”ã¯Appleãƒ‡ãƒã‚¤ã‚¹ã˜ã‚ƒãªã„ã¨è¦‹ã‚Œãªã‹ã£ãŸï¼ˆæ˜”ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã®ä¸­ã§ã‚‚HLSã«å¯¾å¿œã—ã¦ã‚‹ã®ã¯Appleã®Safariã ã‘ã ã£ãŸï¼Ÿï¼‰  \r\nãªã®ã§Windows/Androidãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯VLCã«WWDCã®HLSã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥ã‚Œã¦è¦‹ã¦ãŸã‚ˆã†ãªã€‚  \r\nãã®å¾Œã€ä»Šã¯ç„¡ã„ã‘ã©EdgeHTMLãªEdgeã§HLSãŒï¼ˆApple Safariä»¥å¤–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã—ã¦ã¯åˆï¼Ÿï¼‰ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã€Appleãƒ‡ãƒã‚¤ã‚¹ or Windows 10 ã®Edgeãƒ–ãƒ©ã‚¦ã‚¶ã§è¦‹ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã‚ˆã†ãªã€‚  \r\nä»Šæ—¥ã¯ãƒ¢ãƒ€ãƒ³ãƒ–ãƒ©ã‚¦ã‚¶ã§è¦‹ã‚Œã‚‹ã»ã‹ã€Appleå…¬å¼ãŒã‚ˆã†ã¤ã¹ã«ãƒŸãƒ©ãƒ¼ã—ã¦ã‚‹ã®ã§ã„ã„æ™‚ä»£ã«ãªã‚Šã¾ã—ãŸã­â†ï¼Ÿï¼Ÿï¼Ÿ\r\n\r\n# ç’°å¢ƒ\r\nå®Ÿæ©ŸãŒãŠã™ã™ã‚ã§ã™ã€‚\r\n\r\n| ãªã¾ãˆ           | ã‚ãŸã„                                         |\r\n|------------------|------------------------------------------------|\r\n| ç«¯æœ«             | Pixel 3 XL / Xperia 5 â…¡ / Xiaomi Mi 11 Lite 5G |\r\n| SoC (Snapdragon) | SDM 845 / SDM 865 / SDM 780G                   |\r\n| Android          | 12 / 11 / 11                                   |\r\n| è¨€èª             | Kotlin                                         |\r\n\r\n# æœ¬æ—¥ã®ãƒ¡ã‚¤ãƒ³ MediaCodec \r\nhttps://developer.android.com/reference/android/media/MediaCodec\r\n\r\næ‰±ã„ãŒã¨ã¦ã‚‚é›£ã—ã„ã€‚å…¬å¼ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚‚é•·ã„èª¬æ˜ãŒã‚ã‚‹ã‘ã©åˆ†ã‹ã‚‰ã‚“ã¨ã„ã†ã“ã¨ãŒã‚ã‹ã‚‹ã€‚  \r\nå„ãƒ¡ã‚½ãƒƒãƒ‰ã¯æœ€çµ‚çš„ã«Cè¨€èªã§æ›¸ã‹ã‚ŒãŸã‚³ãƒ¼ãƒ‰ã«ãŸã©ã‚Šç€ãã‚‰ã—ã„ã€ä½•ã‚‚åˆ†ã‹ã‚‰ã‚“ã€‚\r\n\r\n## ç™»å ´äººç‰©\r\n\r\n- MediaFormat\r\n- MediaExtractor\r\n- MediaMuxer\r\n- MediaCodec\r\n\r\n### MediaFormat\r\næ˜ åƒã€éŸ³å£°ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã‚‹ã€‚ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆãªã©ã€‚  \r\nã“ã‚Œã‚’`MediaCodec`ã‚„`MediaMuxer`ã¸æ¸¡ã™ã€‚  \r\nã§ã‚‚å‹•ç”»ã®æƒ…å ±ãªã‚“ã¦åˆ†ã‹ã‚‰ã‚“ã®ã§ã€`MediaExtractor`ã‚’åˆ©ç”¨ã—ã¦MediaFormatã‚’å–å¾—ã—ã¦ã‹ã‚‰ä½œã‚‹ã®ãŒã„ã„ï¼Ÿ\r\n\r\n```kotlin\r\nval videoMediaFormat = // MediaExtractorã®èª¬æ˜ã§...\r\n\r\nval height = videoMediaFormat?.getInteger(MediaFormat.KEY_HEIGHT) ?: 720\r\nval width = videoMediaFormat?.getInteger(MediaFormat.KEY_WIDTH) ?: 1280\r\nval encoderMediaFormat = MediaFormat.createVideoFormat(ENCODE_MIME_TYPE, width, height).apply {\r\n    setInteger(MediaFormat.KEY_MAX_INPUT_SIZE, INPUT_BUFFER_SIZE)\r\n    setInteger(MediaFormat.KEY_BIT_RATE, BIT_RATE)\r\n    setInteger(MediaFormat.KEY_FRAME_RATE, 30)\r\n    setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 1)\r\n    setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface)\r\n}\r\n```\r\n\r\n### MediaExtractor\r\n`MP4`ã€`MPEG2-TS`ã¨ã‹ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ã€æ˜ åƒãƒ»éŸ³å£°ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿(`MediaFormat`)ã‚’å–ã‚Šå‡ºã—ãŸã‚Šã€`MediaCodec`ã¸æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã€‚  \r\nç§ã‚‚ã‚ˆãçŸ¥ã‚‰ãªã„ã‚“ã ã‘ã©ã€`MediaExtractor`ã‹ã‚‰å‡ºã¦ããŸ`MediaFormat`ã‚’ç›´æ¥`MediaCodec`ã¸æ¸¡ã™ã¨ã‚³ã‚±ã‚‹å ´åˆãŒã‚ã‚‹ï¼Ÿ  \r\nAndroidã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼(Storage Access Framework)ã®çµæœ(Uriã€contentã‚¹ã‚­ãƒ¼ãƒ )ã®å ´åˆã¯å¤šåˆ†å—ã‘ä»˜ã‘ãªã„ã¨æ€ã„ã¾ã™ï¼ˆçŸ¥ã‚‰ã‚“ã‘ã©ï¼‰ã€‚  \r\nãªã®ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸ã°ã›ãŸå¾Œã€é¸æŠã—ãŸUriãŒã‚‚ã‚‰ãˆã‚‹ã®ã§InputStreamã‚’ä½¿ã„ã€ä¸€åº¦ã‚¢ãƒ—ãƒªå†…ã®å›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n// MP4ã¨ã‹MPEG2-TSã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æ¸¡ã™\r\nval extractor = MediaExtractor().apply { setDataSource(\"file:///\") }\r\n// æ˜ åƒãƒ‡ãƒ¼ã‚¿ã®MediaFormatã‚’å–ã‚Šå‡ºã™\r\nval videoMediaFormat = (0 until extractor.trackCount) // [0,1] ã®ã‚ˆã†ãªé…åˆ—ã‚’ä½œã‚‹\r\n    .map { extractor.getTrackFormat(it) } // [MediaFormat,MediaFormat] ã«å¤‰æ›ã™ã‚‹\r\n    .firstOrNull { it.getString(MediaFormat.KEY_MIME)?.startsWith(\"video/\") == true } // é…åˆ—ã®ä¸­ã‹ã‚‰MIME_TYPEãŒ video/ ã‹ã‚‰å§‹ã¾ã‚‹ã®ã‚’è¿”ã™\r\n// éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã®MediaFormat\r\nval audioMediaFormat = (0 until extractor.trackCount)\r\n    .map { extractor.getTrackFormat(it) }\r\n    .firstOrNull { it.getString(MediaFormat.KEY_MIME)?.startsWith(\"audio/\") == true }\r\n\r\n// MediaCodecã¸ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™\r\nval inputBuffer = decodeMediaCodec.getInputBuffer(inputBufferId)!!\r\nval size = extractor.readSampleData(inputBuffer, 0)\r\n\r\n// ä½¿ã„çµ‚ã‚ã£ãŸã‚‰\r\nextractor.release()\r\n```\r\n\r\n#### Uriã‚³ãƒ”ãƒ¼ä¾‹\r\nä»Šå›ã®è©±ã§ã¯ãªã„ã®ã§é©å½“ã«...\r\n\r\n```kotlin\r\n// Uriã ã¨...\r\nval uri = // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã®çµæœ\r\nval inputStream = contentResolver.openInputStream(uri)!!\r\n// å›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«ã‚³ãƒ”ãƒ¼\r\nval tempFile = File(getExternalFilesDir(null), \"copy.mp4\")\r\ntempFile.createNewFile()\r\ntempFile.writeBytes(inputStream.readBytes()) // ã‚‚ã—2GBã‚’è¶…ãˆã‚‹ãªã‚‰ä½¿ãˆãªã„\r\ninputStream.close()\r\nval filePath = tempFile.path // file ã‚¹ã‚­ãƒ¼ãƒ \r\n```\r\n\r\n### MediaMuxer\r\n`MediaCodec`ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ˜ åƒã€éŸ³å£°ã‚’MP4ã¨ã‹ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸æ ¼ç´ã™ã‚‹ã€‚  \r\n`MediaMuxer`ã¸æ¸¡ã™`MediaFormat`ã¯`MediaCodec#getOutputFormat()`ã¨ã‹`MediaExtractor#getTrackFormat()`ã§è²°ãˆã‚‹ã‚„ã¤ã˜ã‚ƒãªã„ã¨å¤±æ•—ã™ã‚‹ï¼Ÿï¼ˆã‚³ãƒ¼ãƒ‡ãƒƒã‚¯å›ºæœ‰ãƒ‡ãƒ¼ã‚¿ãŒç„¡ã„ã¨ã‹ã§ï¼‰  \r\nå‚è€ƒï¼šhttps://stackoverflow.com/questions/19505845/mediamuxer-error-failed-to-stop-the-muxer\r\n\r\n```kotlin\r\n// æ˜ åƒMediaFormat\r\nval videoMediaFormat = // ä¸Šã§æ›¸ã„ãŸã®ã§çœç•¥...\r\n// MediaMuxerä½œæˆ\r\nval mediaMuxer = MediaMuxer(mergedFile.path, OUTPUT_CONATINER_FORMAT)\r\n// æ˜ åƒãƒˆãƒ©ãƒƒã‚¯è¿½åŠ \r\nval videoTrackIndex = mediaMuxer.addTrack(videoMediaFormat) // ã“ã“ã§å…¥ã‚Œã‚‹MediaFormatã¯MediaCodec#getOutputFormat()ã§è²°ãˆã‚‹ã®ã‚’å…¥ã‚Œã‚‹ã¨ç¢ºå®Ÿï¼Ÿ\r\nmediaMuxer.start()\r\n\r\n// MediaCodecã®çµæœã‚’æ›¸ãè¾¼ã‚€...\r\nmediaMuxer.writeSampleData(videoTrackIndex, /* outputBuffer, outputBufferInfo */)\r\n\r\n// å¾Œç‰‡ä»˜ã‘\r\nmediaMuxer.stop()\r\nmediaMuxer.release()\r\n```\r\n\r\n### MediaCodec\r\nã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸæ˜ åƒãƒ»éŸ³å£°ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ã€ã‚‚ã—ãã¯ãã®é€†ã‚’ã™ã‚‹ã€‚  \r\néåŒæœŸãƒ¢ãƒ¼ãƒ‰ã¨åŒæœŸãƒ¢ãƒ¼ãƒ‰ãŒã‚ã‚‹ã‘ã©ã©ã£ã¡ãŒã„ã„ã‚“ã ã‚ã†ã€‚ä»Šå›ã¯åŒæœŸãƒ¢ãƒ¼ãƒ‰ã§æ›¸ãã¾ã™ã€‚  \r\nAOSPã®ã‚½ãƒ¼ã‚¹è¦—ã„ãŸã‘ã©ã€Android 11ã‹ã‚‰æ­è¼‰ã•ã‚ŒãŸå†…éƒ¨éŸ³å£°ã¨ç”»é¢éŒ²ç”»ã‚’åˆæˆã™ã‚‹éƒ¨åˆ†ã§ã‚‚åŒæœŸãƒ¢ãƒ¼ãƒ‰ãªMediaCodecã‚’ä½¿ã£ã¦ãŸ  \r\nhttps://cs.android.com/android/platform/superproject/+/master:frameworks/base/packages/SystemUI/src/com/android/systemui/screenrecord/ScreenInternalAudioRecorder.java;l=234?q=internalaudio\r\n\r\nåˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰å¿…é ˆã§ã™ã€‚\r\n\r\n```kotlin\r\n// ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆH.264 -> ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰MediaCodec\r\nval decodeMediaCodec = MediaCodec.createDecoderByType(\"video/avc\").apply {\r\n    configure(decoderMediaFormat, null, null, 0)\r\n    start()\r\n}\r\n// ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨\r\nval decoderBufferInfo = MediaCodec.BufferInfo()\r\nwhile (true) {\r\n    // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼éƒ¨åˆ†\r\n    val inputBufferId = decodeMediaCodec.dequeueInputBuffer(TIMEOUT_US)\r\n    if (inputBufferId >= 0) {\r\n        // Extractorã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿ã ã™\r\n        val inputBuffer = decodeMediaCodec.getInputBuffer(inputBufferId)!!\r\n        val size = mediaExtractor.readSampleData(inputBuffer, 0)\r\n        if (size > 0) {\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æµã™\r\n            decodeMediaCodec.queueInputBuffer(inputBufferId, 0, size, mediaExtractor.sampleTime, 0)\r\n            mediaExtractor.advance()\r\n        } else {\r\n            // ãƒ‡ãƒ¼ã‚¿ãªããªã£ãŸå ´åˆã¯çµ‚äº†\r\n            decodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM)\r\n            // é–‹æ”¾\r\n            mediaExtractor.release()\r\n            // çµ‚äº†\r\n            break\r\n        }\r\n    }\r\n    // ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœ\r\n    val outputBufferId = decodeMediaCodec.dequeueOutputBuffer(decoderBufferInfo, TIMEOUT_US)\r\n    if (outputBufferId >= 0) {\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’ã‚‚ã‚‰ã†\r\n        // è¿”ã™\r\n        decodeMediaCodec.releaseOutputBuffer(outputBufferId, true)\r\n    }\r\n}\r\n```\r\n\r\n# ã“ã‚Œã‚‰ã‚’è¸ã¾ãˆã¦è¤‡æ•°ã®å‹•ç”»ã‚’ç¹‹ã’ãŸã„\r\n\r\n## éŸ³å£°\r\néŸ³å£°ã®å ´åˆã¯ã€å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`MediaExtractor`ã¸å…¥ã‚Œã¦ã€ãƒ‡ãƒ¼ã‚¿ã‚’`MediaCodec`ã¸çªã£è¾¼ã¿ã¾ã™ã€‚  \r\nç”Ÿãƒ‡ãƒ¼ã‚¿ãŒå‡ºã¦ãã‚‹ã®ã§ã€ã“ã‚Œã‚’ä¸€æ—¦é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚Šæ›¸ãè¾¼ã‚“ã§ãŠãã¾ã™ã€‚  \r\nã“ã‚Œã‚’çµåˆã—ãŸã„å‹•ç”»å…¨ã¦ã§ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœãŒå…ˆç¨‹ã®é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã¾ã£ã¦ã„ã‚‹ã‚ˆã†ã«ã€‚  \r\n\r\nãã®ã‚ã¨ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ã®`MediaCodec`ã‚’ä½œã‚Šå…ˆç¨‹ã®é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚“ã§ãŠã„ãŸãƒ‡ãƒ¼ã‚¿ã‚’çªã£è¾¼ã¿ã¾ã™ã€‚  \r\nã™ã‚‹ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒå‡ºã¦ãã‚‹ã®ã§ã€`MediaMuxer`ã¸æ¸¡ã—ã¾ã™ã€‚\r\n\r\nã“ã‚Œã§ãªã‚“ã‹å‹•ã„ã¦ã‚‹ã€‚ãªã‚“ã§ã ã‚ã†\r\n\r\nã‚ã¨å‰²ã¨æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã“ã‚Œ...\r\n\r\n![Imgur](https://imgur.com/qCxBbMW.png)\r\n\r\n## æ˜ åƒ\r\næ˜ åƒã®å ´åˆã€éŸ³å£°ã®ã‚ˆã†ã«ä¸€æ™‚çš„ã«ç”Ÿï¼ˆæ„å‘³æ·±ï¼‰ãƒ‡ãƒ¼ã‚¿ã‚’å¤–å‡ºã—ï¼ˆæ„å‘³æ·±ï¼‰ã—ã¦ãŠãæ–¹æ³•ãŒä½¿ãˆãªã„ã¨æ€ã„ã¾ã™ã€‚æ˜ åƒã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã¨ã‹ãƒ‡ã‚«ã™ãã§ãƒ¤ãƒãã†ã€‚  \r\nãªã®ã§ä»£ã‚ã‚Šã«ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®å…¥åŠ›ç”¨`Surface`ã¸ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’æ›¸ãè¾¼ã‚€æ–¹æ³•ã‚’ä½¿ã„ã¾ã™ã€‚  \r\n\r\nãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®è¨­å®šæ™‚ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®`Surface`ã‚’æŒ‡å®šã—ã¦ãŠãã¾ã™ã€‚  \r\nçµåˆã—ãŸã„å‹•ç”»ã‚’é †æ¬¡`MediaExtractor`ã§èª­ã¿å‡ºã—ã¦ã€ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æµã—ã¾ã™ã€‚  \r\nãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿çµ‚ã‚ã£ãŸã‚‰æ¬¡ã®å‹•ç”»ã«ã—ã¦ã¾ãŸãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æµã—ã¦ã‚ã’ã¾ã™ã€‚ã“ã‚Œã‚’ç„¡ããªã‚‹ã¾ã§ã‚„ã‚Šã¾ã™ã€‚\r\n\r\nãã‚Œã§`Surface`ã¸æ˜ åƒãŒæµã‚Œã¦ãã‚‹ã®ã§ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã§å—ã‘å–ã‚Š`MediaMuxer`ã¸æ¸¡ã—ã¾ã™ã€‚  \r\næœ¬æ¥ã¯`Surface`ã‚’æŒ‡å®šã™ã‚‹éƒ¨åˆ†ã«`SurfaceView`ã®`Surface`ã‚’å…¥ã‚Œã¦æ˜ åƒã‚’å‡ºåŠ›ã™ã‚‹ã‚“ã ã¨æ€ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/BlWU5jP.png)\r\n\r\nã¡ãªã¿ã«å½¢å¼ãŒç•°ãªã‚‹å ´åˆã¯ç„¡ç†ã ã¨æ€ã„ã¾ã™ã€‚OpenGLã¨ã‹ãŒå‡ºæ¥ã‚Œã°åˆ¥ã ã¨æ€ã†\r\n\r\n## éŸ³å£°ã¨æ˜ åƒã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸æ ¼ç´\r\n`MediaExtractor`ã§å–ã‚Šå‡ºã—ã¦ã€`MediaMuxer`ã«å…¥ã‚Œã‚Œã°OK\r\n\r\n![Imgur](https://imgur.com/QV1cYdL.png)\r\n\r\n# å®Ÿéš›ã«ä½œã£ã¦ã¿ãŸï¼\r\næ”»ç•¥ã®ã‚«ã‚®ã¯ã€`presentationTime`ã«ã‚ã‚Šã¾ã™ï¼(ãƒ•ãƒ¬ãƒ¼ãƒ ã®æ™‚é–“ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã‚„ã¤)  \r\n(å‰å›ã®å‹•ç”»ã®ä½ç½®ã‚’è¶³ã—ã¦ã„ã)\r\n\r\n## äºˆã‚ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ãŠã\r\nä»Šå›ã¯ã€äºˆã‚ã‚¢ãƒ—ãƒªå›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆ`getExternalFilesDir(null)`ï¼‰ã®ã¨ã“ã‚ã«å‹•ç”»ã‚’å…¥ã‚Œã¦ãŠãã¾ã™ã€‚  \r\nHLSã‚’æƒ³å®šã—ã¦ã€`FFmpeg`ã§`.ts`ãƒ•ã‚¡ã‚¤ãƒ«ã¸å¤‰æ›ã—ã¦è»¢é€ã—ã¾ã™ã€‚  \r\nå‘½åè¦å‰‡ã¯ ãƒ•ã‚¡ã‚¤ãƒ«å+ç•ªå·+æ‹¡å¼µå­ ã§ã€ã‚ã¨ã§é…åˆ—ã«ã™ã‚‹éš›ã«æ­£è¦è¡¨ç¾ã§å–ã‚Šå‡ºã—ã¦æ•°å­—ã®å°ã•ã„é †ã«ä¸¦ã¹æ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚ \r\n\r\nãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã¨ã‹ã§é¸ã°ã›ãŸã„ã‘ã©é•·ããªã‚‹ã®ã§ã‚«ãƒƒãƒˆã§...\r\n\r\n`io.github.takusan23.ï½`ã®éƒ¨åˆ†ã¯å„è‡ªé•ã†ã¨æ€ã†...\r\n\r\n![Imgur](https://imgur.com/qLPsuYH.png)\r\n\r\n### ã¡ãªã¿ã«\r\nAndroidæ¨™æº–ã®ãƒ•ã‚¡ã‚¤ãƒ©ãƒ¼ã ã¨ã€`Android/data`ãŒç«¯æœ«ã§ã‚‚è¦‹ã‚Œã¾ã™ã€‚\r\n\r\n## éŸ³å£°éƒ¨åˆ†\r\néŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’æ›¸ãã¾ã—ãŸã€‚  \r\nèª¬æ˜ã¯ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚  \r\n`setInteger`ã€`setLong`ã¯ã¡ã‚ƒã‚“ã¨é¸ã°ãªã„ã¨ã ã‚ã§ã™ã€‚  \r\n`getInteger`ã®å€¤ãŒãªã„å ´åˆã¯ä»£ã‚ã‚Šã‚’æŒ‡å®šã—ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ï¼ˆã§ã‚‚`getInteger`ã®ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤æŒ‡å®šä»˜ããƒ¡ã‚½ãƒƒãƒ‰ãŒAndroid 10ä»¥é™ã ã£ãŸ...ï¼‰  \r\n\r\nãªã‚“ã‹`MediaExtractor`ã§ã‚‚ã‚‰ãˆã‚‹`MediaFormat`çµŒç”±ã§ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã‚‚å–å¾—ã§ãã‚‹ã¯ãšã§ã™ãŒã€ãªã‚“ã‹ã‚´ãƒŸã¿ãŸã„ãªéŸ³è³ªã ã£ãŸã®ã§å¼•æ•°ã«å–ã‚‹ã‚ˆã†ã«ã—ãŸã€‚ \r\n\r\n```kotlin\r\n/**\r\n * éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã™ã‚‹\r\n *\r\n * @param videoList çµåˆã™ã‚‹å‹•ç”»ã€éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®é…åˆ—ã€‚å…¥ã£ã¦ã„ã‚‹é †ç•ªã©ãŠã‚Šã«çµåˆã—ã¾ã™ã€‚\r\n * @param mergeFilePath çµåˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆ\r\n * @param tempRawDataFile ä¸€æ™‚çš„ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜å…ˆ\r\n * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã€‚ãªã‚“ã‹ã‚´ãƒŸã¿ãŸã„ãªéŸ³è³ªã ã£ãŸ...\r\n * */\r\nclass AudioDataMerge(\r\n    videoList: List<File>,\r\n    private val mergeFilePath: File,\r\n    private val tempRawDataFile: File,\r\n    private val bitRate: Int = 192_000,\r\n) {\r\n\r\n    /** ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n    private val TIMEOUT_US = 10000L\r\n\r\n    /** MediaCodecã§ã‚‚ã‚‰ãˆã‚‹InputBufferã®ã‚µã‚¤ã‚º */\r\n    private val INPUT_BUFFER_SIZE = 655360\r\n\r\n    /** çµåˆã™ã‚‹å‹•ç”»ã®é…åˆ—ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ */\r\n    private val videoListIterator = videoList.listIterator()\r\n\r\n    /** ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜ã§ä½¿ã† */\r\n    private val bufferedOutputStream by lazy { tempRawDataFile.outputStream().buffered() }\r\n\r\n    /** ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å‡ºã—ã§ä½¿ã† */\r\n    private val bufferedInputStream by lazy { tempRawDataFile.inputStream().buffered() }\r\n\r\n    /** ãƒ•ã‚¡ã‚¤ãƒ«åˆæˆ */\r\n    private val mediaMuxer by lazy { MediaMuxer(mergeFilePath.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4) }\r\n\r\n    /** å–ã‚Šå‡ºã—ãŸ[MediaFormat] */\r\n    private var currentMediaFormat: MediaFormat? = null\r\n\r\n    /** ç¾åœ¨é€²è¡Œä¸­ã®[MediaExtractor] */\r\n    private var currentMediaExtractor: MediaExtractor? = null\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ [MediaCodec] */\r\n    private var encodeMediaCodec: MediaCodec? = null\r\n\r\n    /** ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ [MediaCodec] */\r\n    private var decodeMediaCodec: MediaCodec? = null\r\n\r\n    /**\r\n     * çµåˆã‚’é–‹å§‹ã™ã‚‹\r\n     *\r\n     * åŒæœŸå‡¦ç†ã«ãªã‚‹ã®ã§ã€åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„\r\n     * */\r\n    fun merge() {\r\n\r\n        /**\r\n         * MediaExtractorã§å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã™\r\n         *\r\n         * @param path å‹•ç”»ãƒ‘ã‚¹\r\n         * */\r\n        fun extractVideoFile(path: String) {\r\n            // å‹•ç”»ã®æƒ…å ±ã‚’èª­ã¿å‡ºã™\r\n            val (_mediaExtractor, index, format) = extractMedia(path, \"audio/\") ?: return\r\n            currentMediaExtractor = _mediaExtractor\r\n            currentMediaFormat = format\r\n            // éŸ³å£°ã®ãƒˆãƒ©ãƒƒã‚¯ã‚’é¸æŠ\r\n            currentMediaExtractor?.selectTrack(index)\r\n        }\r\n\r\n        // æœ€åˆã®å‹•ç”»ã‚’è§£æ\r\n        extractVideoFile(videoListIterator.next().path)\r\n\r\n        // è§£æçµæœã‹ã‚‰å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™\r\n        val mimeType = currentMediaFormat?.getString(MediaFormat.KEY_MIME)!! // AACãªã‚‰ audio/mp4a-latm\r\n        val samplingRate = currentMediaFormat?.getInteger(MediaFormat.KEY_SAMPLE_RATE)!! // 44100\r\n        val channelCount = currentMediaFormat?.getInteger(MediaFormat.KEY_CHANNEL_COUNT)!! // 2\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«ã‚»ãƒƒãƒˆã™ã‚‹MediaFormat\r\n        val audioMediaFormat = MediaFormat.createAudioFormat(mimeType, samplingRate, channelCount).apply {\r\n            setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n            setInteger(MediaFormat.KEY_MAX_INPUT_SIZE, INPUT_BUFFER_SIZE)\r\n            setInteger(MediaFormat.KEY_AAC_PROFILE, MediaCodecInfo.CodecProfileLevel.AACObjectLC)\r\n        }\r\n\r\n        // éŸ³å£°ã‚’è¿½åŠ ã—ã¦ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ã‚’ã‚‚ã‚‰ã†\r\n        // å¤šåˆ† addTrack ã™ã‚‹éš›ã¯ MediaExtractor çµŒç”±ã§å–å¾—ã—ãŸ MediaFormat ã‚’å…¥ã‚Œãªã„ã¨ã„ã‘ãªã„ï¼Ÿ\r\n        val audioTrackIndex = mediaMuxer.addTrack(currentMediaFormat!!)\r\n\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆaac -> ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰MediaCodec\r\n        decodeMediaCodec = MediaCodec.createDecoderByType(mimeType).apply {\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã¯ MediaExtractor ã® MediaFormat ã§è‰¯ã•ãã†\r\n            configure(currentMediaFormat!!, null, null, 0)\r\n        }\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ -> aacï¼‰MediaCodec\r\n        encodeMediaCodec = MediaCodec.createEncoderByType(mimeType).apply {\r\n            configure(audioMediaFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n\r\n        // nonNull\r\n        val decodeMediaCodec = decodeMediaCodec!!\r\n        val encodeMediaCodec = encodeMediaCodec!!\r\n        // ã‚¹ã‚¿ãƒ¼ãƒˆ\r\n        decodeMediaCodec.start()\r\n        encodeMediaCodec.start()\r\n        mediaMuxer.start()\r\n\r\n        // å†ç”Ÿä½ç½®ãªã©\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n\r\n        /**\r\n         * ãƒ‡ãƒ¼ã‚¿ã‚’é †æ¬¡èª­ã¿å‡ºã—ã¦ã€[MediaCodec]ã§ç”Ÿãƒ‡ãƒ¼ã‚¿ã¸å¤‰æ›ã™ã‚‹ã€‚\r\n         * å¤‰æ›ã—ãŸç”Ÿãƒ‡ãƒ¼ã‚¿ã¯[tempRawDataFile]ã¸ä¸€æ™‚çš„ã«å…¥ã‚Œã‚‹ã€‚\r\n         * */\r\n        var totalPresentationTime = 0L\r\n        var prevPresentationTime = 0L\r\n        while (true) {\r\n            // ã‚‚ã— -1 ãŒè¿”ã£ã¦ãã‚Œã° configure() ãŒé–“é•ã£ã¦ã‚‹\r\n            val inputBufferId = decodeMediaCodec.dequeueInputBuffer(TIMEOUT_US)\r\n            if (inputBufferId >= 0) {\r\n                // Extractorã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿ã ã™\r\n                val inputBuffer = decodeMediaCodec.getInputBuffer(inputBufferId)!!\r\n                val size = currentMediaExtractor!!.readSampleData(inputBuffer, 0)\r\n                if (size > 0) {\r\n                    // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æµã™\r\n                    decodeMediaCodec.queueInputBuffer(inputBufferId, 0, size, currentMediaExtractor!!.sampleTime + totalPresentationTime, 0)\r\n                    currentMediaExtractor!!.advance()\r\n                    // ä¸€å€‹å‰ã®å‹•ç”»ã®å‹•ç”»ã‚µã‚¤ã‚ºã‚’æ§ãˆã¦ãŠã\r\n                    // else ã§ extractor.sampleTime ã™ã‚‹ã¨æ—¢ã«-1ã«ã£ã¦ã„ã‚‹ã®ã§\r\n                    if (currentMediaExtractor!!.sampleTime != -1L) {\r\n                        prevPresentationTime = currentMediaExtractor!!.sampleTime\r\n                    }\r\n                } else {\r\n                    totalPresentationTime += prevPresentationTime\r\n                    // ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã®ã§æ¬¡ãƒ‡ãƒ¼ã‚¿ã¸\r\n                    if (videoListIterator.hasNext()) {\r\n                        // æ¬¡ãƒ‡ãƒ¼ã‚¿ã¸\r\n                        val file = videoListIterator.next()\r\n                        // å¤šåˆ†ã„ã‚‹\r\n                        decodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, 0)\r\n                        // å‹•ç”»ã®æƒ…å ±ã‚’èª­ã¿å‡ºã™\r\n                        currentMediaExtractor!!.release()\r\n                        extractVideoFile(file.path)\r\n                    } else {\r\n                        // ãƒ‡ãƒ¼ã‚¿ãªããªã£ãŸå ´åˆã¯çµ‚äº†ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n                        decodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM)\r\n                        // é–‹æ”¾\r\n                        currentMediaExtractor!!.release()\r\n                        // çµ‚äº†\r\n                        break\r\n                    }\r\n                }\r\n            }\r\n\r\n            /**\r\n             * ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’å—ã‘å–ã£ã¦ã€ä¸€æ™‚çš„ã«ä¿å­˜ã™ã‚‹\r\n             * */\r\n            val outputBufferId = decodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n            if (outputBufferId >= 0) {\r\n                // ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’ã‚‚ã‚‰ã†\r\n                val outputBuffer = decodeMediaCodec.getOutputBuffer(outputBufferId)!!\r\n                // ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ™‚çš„ã«ä¿å­˜ã™ã‚‹\r\n                val chunk = ByteArray(bufferInfo.size)\r\n                outputBuffer[chunk]\r\n                bufferedOutputStream.write(chunk)\r\n                // æ¶ˆã—ãŸã»ã†ãŒã„ã„ã‚‰ã—ã„\r\n                outputBuffer.clear()\r\n                // è¿”å´\r\n                decodeMediaCodec.releaseOutputBuffer(outputBufferId, false)\r\n            }\r\n        }\r\n\r\n        // Xiaomiç«¯æœ«ã§è½ã¡ãŸã®ã§ä¾‹å¤–å‡¦ç†\r\n        try {\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n            decodeMediaCodec.stop()\r\n            decodeMediaCodec.release()\r\n            bufferedOutputStream.close()\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        }\r\n\r\n        // èª­ã¿å‡ºã—æ¸ˆã¿ã®ä½ç½®ã¨æ™‚é–“\r\n        var totalBytesRead = 0\r\n        var presentationTime = 0L\r\n\r\n        /**\r\n         * ä¸€æ™‚çš„ã«ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã—ã¦ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«å…¥ã‚Œã‚‹ã€‚\r\n         * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰çµæœã‚’[MediaMuxer]ã¸å…¥ã‚Œã¦å®Œæˆã€‚\r\n         * */\r\n        while (true) {\r\n            val inputBufferId = encodeMediaCodec.dequeueInputBuffer(TIMEOUT_US)\r\n            if (inputBufferId >= 0) {\r\n                // ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ãŸç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æ¸¡ã™\r\n                val inputBuffer = encodeMediaCodec.getInputBuffer(inputBufferId)!!\r\n                val buffer = ByteArray(inputBuffer.capacity())\r\n                val size = bufferedInputStream.read(buffer)\r\n                // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æ¸¡ã™\r\n                if (size > 0) {\r\n                    // æ›¸ãè¾¼ã‚€ã€‚æ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã¯[onOutputBufferAvailable]ã§å—ã‘å–ã‚Œã‚‹\r\n                    inputBuffer.put(buffer, 0, size)\r\n                    encodeMediaCodec.queueInputBuffer(inputBufferId, 0, size, presentationTime, 0)\r\n                    totalBytesRead += size\r\n                    // ã‚ã‚“ã¾ã‚Šåˆ†ã‹ã‚‰ã‚“\r\n                    presentationTime = 1000000L * (totalBytesRead / (channelCount * 2)) / samplingRate\r\n                } else {\r\n                    // çµ‚äº†\r\n                    encodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM)\r\n                }\r\n            }\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã‹ã‚‰ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚‹\r\n            val outputBufferId = encodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n            if (outputBufferId >= 0) {\r\n                // ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’ã‚‚ã‚‰ã†\r\n                val outputBuffer = encodeMediaCodec.getOutputBuffer(outputBufferId)!!\r\n                if (bufferInfo.size > 0) {\r\n                    // æ›¸ãè¾¼ã‚€\r\n                    mediaMuxer.writeSampleData(audioTrackIndex, outputBuffer, bufferInfo)\r\n                    // è¿”å´\r\n                    encodeMediaCodec.releaseOutputBuffer(outputBufferId, false)\r\n                } else {\r\n                    // ã‚‚ã†ç„¡ã„ï¼\r\n                    break\r\n                }\r\n            }\r\n        }\r\n\r\n        // Xiaomiç«¯æœ«ã§è½ã¡ãŸã®ã§ä¾‹å¤–å‡¦ç†\r\n        try {\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n            encodeMediaCodec.stop()\r\n            encodeMediaCodec.release()\r\n            bufferedInputStream.close()\r\n\r\n            // MediaMuxerã‚‚çµ‚äº†\r\n            // MediaMuxer#stopã§ã‚³ã‚±ã‚‹å ´åˆã€å¤§ä½“MediaFormatã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä¸è¶³ã§ã™ã€‚\r\n            // MediaExtractorã§å‡ºã¦ããŸFormatã‚’å…¥ã‚Œã‚‹ã¨ç›´ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n            mediaMuxer.stop()\r\n            mediaMuxer.release()\r\n\r\n            // ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®å‰Šé™¤\r\n            tempRawDataFile.delete()\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        }\r\n    }\r\n\r\n    /** å¼·åˆ¶çµ‚äº†æ™‚ã«å‘¼ã¶ */\r\n    fun stop() {\r\n        decodeMediaCodec?.stop()\r\n        decodeMediaCodec?.release()\r\n        bufferedOutputStream.close()\r\n        encodeMediaCodec?.stop()\r\n        encodeMediaCodec?.release()\r\n        bufferedInputStream.close()\r\n        currentMediaExtractor?.release()\r\n        mediaMuxer.stop()\r\n        mediaMuxer.release()\r\n        tempRawDataFile.delete()\r\n    }\r\n\r\n    /**\r\n     * å¼•æ•°ã«æ¸¡ã—ãŸå‹•ç”»ãƒ‘ã‚¹[videoPath]ã®æƒ…å ±ã‚’[MediaExtractor]ã§å–ã‚Šå‡ºã™\r\n     *\r\n     * @param mimeType éŸ³å£°ãªã‚‰ audio/ å‹•ç”»ãªã‚‰ video/\r\n     * @param videoPath å‹•ç”»ã®å‹•ç”»ãƒ‘ã‚¹\r\n     * */\r\n    private fun extractMedia(videoPath: String, mimeType: String): Triple<MediaExtractor, Int, MediaFormat>? {\r\n        val mediaExtractor = MediaExtractor().apply { setDataSource(videoPath) }\r\n        val (index, track) = (0 until mediaExtractor.trackCount)\r\n            .map { index -> index to mediaExtractor.getTrackFormat(index) }\r\n            .firstOrNull { (_, track) -> track.getString(MediaFormat.KEY_MIME)?.startsWith(mimeType) == true } ?: return null\r\n        return Triple(mediaExtractor, index, track)\r\n    }\r\n\r\n}\r\n```\r\n\r\n### MainActivity.kt\r\n\r\n```kotlin\r\n/**\r\n * å‹•ç”»ä¿å­˜å…ˆ\r\n *\r\n * /sdcard/Android/data/{ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸Id}/files/video\r\n * */\r\nclass MainActivity : AppCompatActivity() {\r\n    /** å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€å */\r\n    private val FOLDER_NAME = \"bakkure\"\r\n\r\n    /** ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private val MERGE_FILE_NAME = \"merged.aac\"\r\n\r\n    /** ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ */\r\n    private val TEMP_RAW_DATA_FILE_NAME = \"temp_raw_data\"\r\n\r\n    /** éŸ³å£°ãã£ã¤ã‘ã‚‹ã‚„ã¤ */\r\n    private lateinit var audioDataMerge: AudioDataMerge\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        // çµåˆã—ãŸã„å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒç½®ã„ã¦ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€\r\n        val videoFolder = File(getExternalFilesDir(null), FOLDER_NAME).apply {\r\n            if (!exists()) {\r\n                mkdir()\r\n            }\r\n        }\r\n\r\n        // æœ€çµ‚çš„ã«çµåˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\r\n        val mergedFile = File(getExternalFilesDir(null), MERGE_FILE_NAME).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n        // éŸ³å£°ã ã‘ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ãŠã„ã¦ãŠããƒ•ã‚¡ã‚¤ãƒ«\r\n        val tempRawDataFile = File(getExternalFilesDir(null), TEMP_RAW_DATA_FILE_NAME).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n        // æ•°å­—ã‚’è¦‹ã¤ã‘ã‚‹æ­£è¦è¡¨ç¾\r\n        val numberRegex = \"(\\\\d+)\".toRegex()\r\n        // çµåˆã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…åˆ—\r\n        val videoList = videoFolder.listFiles()\r\n            // ?.filter { it.extension == \"ts\" } // ã“ã‚Œå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ãŒå…¥ã£ã¦ãã‚‹å ´åˆã¯ã“ã“ã§è¦‹åˆ‡ã‚Šã‚’ã¤ã‘ã‚‹\r\n            ?.toList()\r\n            ?.sortedBy { numberRegex.find(it.name)?.groupValues?.get(0)?.toIntOrNull() ?: 0 } // æ•°å­—ã®è‹¥ã„é †ã«ã™ã‚‹\r\n\r\n        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ\r\n        audioDataMerge = AudioDataMerge(videoList!!, mergedFile, tempRawDataFile)\r\n\r\n        // åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ·å‹•ã—ã¦é–‹å§‹\r\n        // ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¨ã‹ã‚’ä½¿ã†ã¹ãã§ã™...\r\n        thread {\r\n            val startMs = System.currentTimeMillis()\r\n            showMessage(\"é–‹å§‹ï¼š$startMs\")\r\n            audioDataMerge.merge()\r\n            showMessage(\"çµ‚äº†ï¼š${System.currentTimeMillis() - startMs} Ms\")\r\n        }\r\n    }\r\n\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        audioDataMerge.stop()\r\n    }\r\n\r\n    private fun showMessage(message: String) {\r\n        println(message)\r\n        runOnUiThread { Toast.makeText(this@MainActivity, message, Toast.LENGTH_SHORT).show() }\r\n    }\r\n}\r\n```\r\n\r\n## æ˜ åƒéƒ¨åˆ†\r\næ˜ åƒãƒ‡ãƒ¼ã‚¿ã‚’Surfaceã¸æç”»ã—ã¦çµåˆã™ã‚‹ã‚¯ãƒ©ã‚¹ã‚’æ›¸ãã¾ã—ãŸã€‚  \r\nèª¬æ˜ã¯ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ãŠãã¾ã—ãŸã€‚  \r\nç·‘ã§å‡ºåŠ›ã•ã‚ŒãŸå ´åˆã¯MediaFormatã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒãŠã‹ã—ã„ã‹ã‚‚ã€‚(csd-1,csd-0 ã¨ã‹ï¼Ÿ)  \r\nãªã‚“ã‹å‹•ã‹ãªã„å ´åˆã¯ã€è§£åƒåº¦ã¯16ã®å€æ•°ã§ã‚ã‚‹ã‹ç¢ºèªã™ã‚‹ã¨ã„ã„ã®ã‹ã‚‚ï¼Ÿ\r\n- 1280 x 720\r\n    - ä½™ã‚Šå‡ºãªã„\r\n- 720 x 480\r\n    - ä½™ã‚Šå‡ºãªã„\r\n- 640 x 360\r\n    - 360 / 16 ã§ä½™ã‚ŠãŒå‡ºã‚‹ã®ã§ã€å‰²ã‚Šåˆ‡ã‚Œã‚‹ 368 ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹\r\n\r\n```kotlin\r\n/**\r\n * æ˜ åƒãƒ‡ãƒ¼ã‚¿ã‚’çµåˆã™ã‚‹\r\n *\r\n * @param videoList çµåˆã™ã‚‹å‹•ç”»ã€éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®é…åˆ—ã€‚å…¥ã£ã¦ã„ã‚‹é †ç•ªã©ãŠã‚Šã«çµåˆã—ã¾ã™ã€‚\r\n * @param mergeFilePath çµåˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å…ˆ\r\n * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã€‚ä½•æ•…ã‹å–ã‚Œãªã‹ã£ãŸ\r\n * @param frameRate ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆã€‚ä½•æ•…ã‹å–ã‚Œãªã‹ã£ãŸ\r\n * */\r\nclass VideoDataMerge(\r\n    videoList: List<File>,\r\n    private val mergeFilePath: File,\r\n    private val bitRate: Int = 1_000_000, // 1Mbps\r\n    private val frameRate: Int = 30, // 30fps\r\n) {\r\n\r\n    /** ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n    private val TIMEOUT_US = 10000L\r\n\r\n    /** MediaCodecã§ã‚‚ã‚‰ãˆã‚‹InputBufferã®ã‚µã‚¤ã‚º */\r\n    private val INPUT_BUFFER_SIZE = 655360\r\n\r\n    /** çµåˆã™ã‚‹å‹•ç”»ã®é…åˆ—ã®ã‚¤ãƒ†ãƒ¬ãƒ¼ã‚¿ */\r\n    private val videoListIterator = videoList.listIterator()\r\n\r\n    /** ãƒ•ã‚¡ã‚¤ãƒ«åˆæˆ */\r\n    private val mediaMuxer by lazy { MediaMuxer(mergeFilePath.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4) }\r\n\r\n    /** å–ã‚Šå‡ºã—ãŸ[MediaFormat] */\r\n    private var currentMediaFormat: MediaFormat? = null\r\n\r\n    /** ç¾åœ¨é€²è¡Œä¸­ã®[MediaExtractor] */\r\n    private var currentMediaExtractor: MediaExtractor? = null\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ [MediaCodec] */\r\n    private var encodeMediaCodec: MediaCodec? = null\r\n\r\n    /** ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ [MediaCodec] */\r\n    private var decodeMediaCodec: MediaCodec? = null\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã¨ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®æ©‹æ¸¡ã—ã‚’ã™ã‚‹Surface */\r\n    private var encoderSurface: Surface? = null\r\n\r\n    /**\r\n     * çµåˆã‚’é–‹å§‹ã™ã‚‹\r\n     *\r\n     * åŒæœŸå‡¦ç†ã«ãªã‚‹ã®ã§ã€åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§å®Ÿè¡Œã—ã¦ãã ã•ã„\r\n     * */\r\n    fun merge() {\r\n        /**\r\n         * MediaExtractorã§å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿å‡ºã™\r\n         *\r\n         * @param path å‹•ç”»ãƒ‘ã‚¹\r\n         * */\r\n        fun extractVideoFile(path: String) {\r\n            // å‹•ç”»ã®æƒ…å ±ã‚’èª­ã¿å‡ºã™\r\n            val (_mediaExtractor, index, format) = extractMedia(path, \"video/\") ?: return\r\n            currentMediaExtractor = _mediaExtractor\r\n            currentMediaFormat = format\r\n            // éŸ³å£°ã®ãƒˆãƒ©ãƒƒã‚¯ã‚’é¸æŠ\r\n            currentMediaExtractor?.selectTrack(index)\r\n            currentMediaExtractor?.seekTo(0, MediaExtractor.SEEK_TO_PREVIOUS_SYNC)\r\n        }\r\n\r\n        // æœ€åˆã®å‹•ç”»ã‚’è§£æ\r\n        extractVideoFile(videoListIterator.next().path)\r\n\r\n        // è§£æçµæœã‹ã‚‰å„ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™\r\n        // å‹•ç”»ã®å¹…ã€é«˜ã•ã¯16ã®å€æ•°ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆã©ã“ã«æ›¸ã„ã¦ã‚“ã­ã‚“ã‚¯ã‚½ãŒï¼‰\r\n        val mimeType = currentMediaFormat?.getString(MediaFormat.KEY_MIME)!! // video/avc\r\n        val width = currentMediaFormat?.getInteger(MediaFormat.KEY_WIDTH)!! // 1280\r\n        val height = currentMediaFormat?.getInteger(MediaFormat.KEY_HEIGHT)!! // 720\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«ã‚»ãƒƒãƒˆã™ã‚‹MediaFormat\r\n        val videoMediaFormat = MediaFormat.createVideoFormat(mimeType, width, height).apply {\r\n            setInteger(MediaFormat.KEY_MAX_INPUT_SIZE, INPUT_BUFFER_SIZE)\r\n            setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n            setInteger(MediaFormat.KEY_FRAME_RATE, frameRate)\r\n            setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, 1)\r\n            setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface)\r\n        }\r\n\r\n        // å¾Œã«æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã®ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ãŒå…¥ã‚‹\r\n        // encodeMediaCodec.outputFormat ã‚’ MediaMuxer ã¸æ¸¡ã™\r\n        var videoTrackIndex = NO_INDEX_VALUE\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆç”Ÿãƒ‡ãƒ¼ã‚¿ -> H.264ï¼‰MediaCodec\r\n        encodeMediaCodec = MediaCodec.createEncoderByType(mimeType).apply {\r\n            configure(videoMediaFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®Surfaceã‚’å–å¾—\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®å‡ºåŠ›Surfaceã®é …ç›®ã«ã“ã‚Œã‚’æŒ‡å®šã—ã¦ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«æ˜ åƒãƒ‡ãƒ¼ã‚¿ãŒSurfaceçµŒç”±ã§è¡Œãã‚ˆã†ã«ã™ã‚‹\r\n        encoderSurface = encodeMediaCodec!!.createInputSurface()\r\n\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ‰ç”¨ï¼ˆH.264 -> ç”Ÿãƒ‡ãƒ¼ã‚¿ï¼‰MediaCodec\r\n        decodeMediaCodec = MediaCodec.createDecoderByType(mimeType).apply {\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ‰æ™‚ã¯ MediaExtractor ã® MediaFormat ã§è‰¯ã•ãã†\r\n            configure(currentMediaFormat!!, encoderSurface, null, 0)\r\n        }\r\n\r\n        // nonNull\r\n        val decodeMediaCodec = decodeMediaCodec!!\r\n        val encodeMediaCodec = encodeMediaCodec!!\r\n        encodeMediaCodec.start()\r\n        decodeMediaCodec.start()\r\n\r\n        // å‰å›ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¶³ã—ãŸå‹•ç”»æ™‚é–“\r\n        var totalPresentationTime = 0L\r\n        var prevPresentationTime = 0L\r\n\r\n        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿æ ¼ç´ç”¨\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n\r\n        // ãƒ«ãƒ¼ãƒ—åˆ¶å¾¡\r\n        var outputDone = false\r\n        var inputDone = false\r\n\r\n        /**\r\n         *  --- è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å…¨ã¦ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹ ---\r\n         * */\r\n        while (!outputDone) {\r\n            if (!inputDone) {\r\n\r\n                val inputBufferId = decodeMediaCodec.dequeueInputBuffer(TIMEOUT_US)\r\n                if (inputBufferId >= 0) {\r\n                    val inputBuffer = decodeMediaCodec.getInputBuffer(inputBufferId)!!\r\n                    val size = currentMediaExtractor!!.readSampleData(inputBuffer, 0)\r\n                    if (size > 0) {\r\n                        // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æµã™\r\n                        // ä»Šã¾ã§ã®å‹•ç”»ã®åˆ†ã®å†ç”Ÿä½ç½®ã‚’è¶³ã—ã¦ãŠã\r\n                        decodeMediaCodec.queueInputBuffer(inputBufferId, 0, size, currentMediaExtractor!!.sampleTime + totalPresentationTime, 0)\r\n                        currentMediaExtractor!!.advance()\r\n                        // ä¸€å€‹å‰ã®å‹•ç”»ã®å‹•ç”»ã‚µã‚¤ã‚ºã‚’æ§ãˆã¦ãŠã\r\n                        // else ã§ extractor.sampleTime ã™ã‚‹ã¨æ—¢ã«-1ã«ã£ã¦ã„ã‚‹ã®ã§\r\n                        if (currentMediaExtractor!!.sampleTime != -1L) {\r\n                            prevPresentationTime = currentMediaExtractor!!.sampleTime\r\n                        }\r\n                    } else {\r\n                        totalPresentationTime += prevPresentationTime\r\n                        // ãƒ‡ãƒ¼ã‚¿ãŒãªã„ã®ã§æ¬¡ãƒ‡ãƒ¼ã‚¿ã¸\r\n                        if (videoListIterator.hasNext()) {\r\n                            // æ¬¡ãƒ‡ãƒ¼ã‚¿ã¸\r\n                            val file = videoListIterator.next()\r\n                            // å¤šåˆ†ã„ã‚‹\r\n                            decodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, 0)\r\n                            // å‹•ç”»ã®æƒ…å ±ã‚’èª­ã¿å‡ºã™\r\n                            currentMediaExtractor!!.release()\r\n                            extractVideoFile(file.path)\r\n                        } else {\r\n                            // ãƒ‡ãƒ¼ã‚¿ãªããªã£ãŸå ´åˆã¯çµ‚äº†\r\n                            decodeMediaCodec.queueInputBuffer(inputBufferId, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM)\r\n                            // é–‹æ”¾\r\n                            currentMediaExtractor!!.release()\r\n                            // çµ‚äº†\r\n                            inputDone = true\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            var decoderOutputAvailable = true\r\n            while (decoderOutputAvailable) {\r\n                // SurfaceçµŒç”±ã§ãƒ‡ãƒ¼ã‚¿ã‚’è²°ã£ã¦ä¿å­˜ã™ã‚‹\r\n                val encoderStatus = encodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (encoderStatus >= 0) {\r\n                    val encodedData = encodeMediaCodec.getOutputBuffer(encoderStatus)!!\r\n                    if (bufferInfo.size > 1) {\r\n                        if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_CODEC_CONFIG == 0) {\r\n                            // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€...\r\n                            mediaMuxer.writeSampleData(videoTrackIndex, encodedData, bufferInfo)\r\n                        } else if (videoTrackIndex == NO_INDEX_VALUE) {\r\n                            // MediaMuxerã¸æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹ã®ã¯ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã†\r\n                            // ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚„ã‚‹ã¨å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚ŒãŸMediaFormatãŒæ‰‹ã«å…¥ã‚‹(csd-0 ã¨ã‹)\r\n                            // æ˜ åƒãŒã¶ã£å£Šã‚Œã¦ã„ã‚‹å ´åˆï¼ˆç·‘ã§å¡—ã‚Šã¤ã¶ã•ã‚Œã¦ã‚‹ã¨ã‹ï¼‰ã¯å¤šåˆ†ã“ã®ã‚ãŸã‚ŠãŒæ€ªã—ã„\r\n                            val newFormat = encodeMediaCodec.outputFormat\r\n                            videoTrackIndex = mediaMuxer.addTrack(newFormat)\r\n                            mediaMuxer.start()\r\n                        }\r\n                    }\r\n                    outputDone = bufferInfo.flags and MediaCodec.BUFFER_FLAG_END_OF_STREAM != 0\r\n                    encodeMediaCodec.releaseOutputBuffer(encoderStatus, false)\r\n                }\r\n                if (encoderStatus != MediaCodec.INFO_TRY_AGAIN_LATER) {\r\n                    continue\r\n                }\r\n                // Surfaceã¸ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°ã™ã‚‹ã€‚\r\n                val outputBufferId = decodeMediaCodec.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (outputBufferId == MediaCodec.INFO_TRY_AGAIN_LATER) {\r\n                    decoderOutputAvailable = false\r\n                } else if (outputBufferId >= 0) {\r\n                    val doRender = bufferInfo.size != 0\r\n                    decodeMediaCodec.releaseOutputBuffer(outputBufferId, doRender)\r\n                    if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_END_OF_STREAM != 0) {\r\n                        decoderOutputAvailable = false\r\n                        encodeMediaCodec.signalEndOfInputStream()\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        // Xiaomiç«¯æœ«ã§è½ã¡ãŸã®ã§ä¾‹å¤–å‡¦ç†\r\n        try {\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n            decodeMediaCodec.stop()\r\n            decodeMediaCodec.release()\r\n            // Surfaceé–‹æ”¾\r\n            encoderSurface?.release()\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼çµ‚äº†\r\n            encodeMediaCodec.stop()\r\n            encodeMediaCodec.release()\r\n            // MediaMuxerã‚‚çµ‚äº†\r\n            mediaMuxer.stop()\r\n            mediaMuxer.release()\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        }\r\n    }\r\n\r\n    /** å¼·åˆ¶çµ‚äº†æ™‚ã«å‘¼ã¶ */\r\n    fun stop() {\r\n        decodeMediaCodec?.stop()\r\n        decodeMediaCodec?.release()\r\n        encoderSurface?.release()\r\n        encodeMediaCodec?.stop()\r\n        encodeMediaCodec?.release()\r\n        currentMediaExtractor?.release()\r\n        mediaMuxer.stop()\r\n        mediaMuxer.release()\r\n    }\r\n\r\n    /**\r\n     * å¼•æ•°ã«æ¸¡ã—ãŸå‹•ç”»ãƒ‘ã‚¹[videoPath]ã®æƒ…å ±ã‚’[MediaExtractor]ã§å–ã‚Šå‡ºã™\r\n     *\r\n     * @param mimeType éŸ³å£°ãªã‚‰ audio/ å‹•ç”»ãªã‚‰ video/\r\n     * @param videoPath å‹•ç”»ã®å‹•ç”»ãƒ‘ã‚¹\r\n     * */\r\n    private fun extractMedia(videoPath: String, mimeType: String): Triple<MediaExtractor, Int, MediaFormat>? {\r\n        val mediaExtractor = MediaExtractor().apply { setDataSource(videoPath) }\r\n        val (index, track) = (0 until mediaExtractor.trackCount)\r\n            .map { index -> index to mediaExtractor.getTrackFormat(index) }\r\n            .firstOrNull { (_, track) -> track.getString(MediaFormat.KEY_MIME)?.startsWith(mimeType) == true } ?: return null\r\n        return Triple(mediaExtractor, index, track)\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ãŒç©ºã®å ´åˆ */\r\n        const val NO_INDEX_VALUE = -100\r\n\r\n    }\r\n\r\n}\r\n```\r\n\r\n### MainActivity.kt\r\néŸ³å£°ã¨ã‚ã‚“ã¾ã‚Šå¤‰ã‚ã‚‰ã‚“ã€‚  \r\nãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã€ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆã‚’èª¿æ•´ã—ãŸã„å ´åˆã¯å¼•æ•°ã«æ¸¡ã›ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * å‹•ç”»ä¿å­˜å…ˆ\r\n *\r\n * /sdcard/Android/data/io.github.takusan23.androidmediacodecvideomerge/files/video\r\n * */\r\nclass MainActivity : AppCompatActivity() {\r\n    /** å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€å */\r\n    private val FOLDER_NAME = \"bakkure\"\r\n\r\n    /** ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private val MERGE_FILE_NAME = \"merged.mp4\"\r\n\r\n    /** æ˜ åƒãã£ã¤ã‘ã‚‹ã‚„ã¤ */\r\n    private lateinit var videoDataMerge: VideoDataMerge\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        // çµåˆã—ãŸã„å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒç½®ã„ã¦ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€\r\n        val videoFolder = File(getExternalFilesDir(null), FOLDER_NAME).apply {\r\n            if (!exists()) {\r\n                mkdir()\r\n            }\r\n        }\r\n\r\n        // æœ€çµ‚çš„ã«çµåˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\r\n        val mergedFile = File(getExternalFilesDir(null), MERGE_FILE_NAME).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n        // æ•°å­—ã‚’è¦‹ã¤ã‘ã‚‹æ­£è¦è¡¨ç¾\r\n        val numberRegex = \"(\\\\d+)\".toRegex()\r\n        // çµåˆã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…åˆ—\r\n        val videoList = videoFolder.listFiles()\r\n            // ?.filter { it.extension == \"ts\" } // ã“ã‚Œå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ãŒå…¥ã£ã¦ãã‚‹å ´åˆã¯ã“ã“ã§è¦‹åˆ‡ã‚Šã‚’ã¤ã‘ã‚‹\r\n            ?.toList()\r\n            ?.sortedBy { numberRegex.find(it.name)?.groupValues?.get(0)?.toIntOrNull() ?: 0 } // æ•°å­—ã®è‹¥ã„é †ã«ã™ã‚‹\r\n\r\n        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ\r\n        videoDataMerge = VideoDataMerge(videoList!!, mergedFile, /*bitRate = 1_000_000, frameRate = 30*/)\r\n\r\n        // åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ·å‹•ã—ã¦é–‹å§‹\r\n        // ã‚³ãƒ«ãƒ¼ãƒãƒ³ã¨ã‹ã‚’ä½¿ã†ã¹ãã§ã™...\r\n        thread {\r\n            val startMs = System.currentTimeMillis()\r\n            showMessage(\"é–‹å§‹ï¼š$startMs\")\r\n            videoDataMerge.merge()\r\n            showMessage(\"çµ‚äº†ï¼š${System.currentTimeMillis() - startMs} Ms\")\r\n        }\r\n    }\r\n\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        videoDataMerge.stop()\r\n    }\r\n\r\n    private fun showMessage(message: String) {\r\n        println(message)\r\n        runOnUiThread { Toast.makeText(this@MainActivity, message, Toast.LENGTH_SHORT).show() }\r\n    }\r\n}\r\n```\r\n\r\n## éŸ³å£°ã¨æ˜ åƒã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸æ ¼ç´ã™ã‚‹\r\nã“ã£ã‹ã‚‰ã¯ãã‚“ãªã«é›£ã—ããªã„ã§ã™ã€‚  \r\nãã‚Œãã‚Œã‚’`MediaExtractor`ã§å–ã‚Šå‡ºã—ã¦ã€ãã®ã¾ã¾`MediaMuxer`ã¸æ¸¡ã™ã ã‘ã§ã™ï¼\r\n\r\n```kotlin\r\n/**\r\n * éŸ³å£°ã¨æ˜ åƒã‚’ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸ã—ã¾ã£ã¦ä¸€ã¤ã®å‹•ç”»ã«ã™ã‚‹é–¢æ•°ãŒã‚ã‚‹\r\n * */\r\nobject MergedDataMuxer {\r\n\r\n    /**\r\n     * ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸æ ¼ç´ã™ã‚‹\r\n     *\r\n     * @param resultFile æœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«\r\n     * @param mergeFileList ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¸å…¥ã‚Œã‚‹éŸ³å£°ã€æ˜ åƒãƒ‡ãƒ¼ã‚¿ã®[File]\r\n     * */\r\n    @SuppressLint(\"WrongConstant\")\r\n    fun mixed(\r\n        resultFile: File,\r\n        mergeFileList: List<File>,\r\n    ) {\r\n        // æ˜ åƒã¨éŸ³å£°ã‚’è¿½åŠ ã—ã¦ä¸€ã¤ã®å‹•ç”»ã«ã™ã‚‹\r\n        val mediaMuxer = MediaMuxer(resultFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4)\r\n\r\n        // éŸ³å£°ã€æ˜ åƒãƒ•ã‚¡ã‚¤ãƒ«ã® ãƒˆãƒ©ãƒƒã‚¯ç•ªå· ã¨ [MediaExtractor] ã® Pair\r\n        val trackIndexToExtractorPairList = mergeFileList\r\n            .map {\r\n                // MediaExtractorã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå–å¾—\r\n                val mediaExtractor = MediaExtractor().apply { setDataSource(it.path) }\r\n                val mediaFormat = mediaExtractor.getTrackFormat(0) // éŸ³å£°ã«ã¯éŸ³å£°ã€æ˜ åƒã«ã¯æ˜ åƒã—ã‹ç„¡ã„ã®ã§ 0\r\n                mediaExtractor.selectTrack(0)\r\n                mediaFormat to mediaExtractor\r\n            }\r\n            .map { (format, extractor) ->\r\n                // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’MediaMuxerã«æ¸¡ã—ã¦ã€ãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã—ã¦ã‚‚ã‚‰ã†\r\n                val videoTrackIndex = mediaMuxer.addTrack(format)\r\n                videoTrackIndex to extractor\r\n            }\r\n        // MediaMuxerã‚¹ã‚¿ãƒ¼ãƒˆ\r\n        mediaMuxer.start()\r\n        // æ˜ åƒã¨éŸ³å£°ã‚’ä¸€ã¤ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚“ã§ã„ã\r\n        trackIndexToExtractorPairList.forEach { (index, extractor) ->\r\n            val byteBuffer = ByteBuffer.allocate(1024 * 4096)\r\n            val bufferInfo = MediaCodec.BufferInfo()\r\n            // ãƒ‡ãƒ¼ã‚¿ãŒç„¡ããªã‚‹ã¾ã§å›ã™\r\n            while (true) {\r\n                // ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã™\r\n                val offset = byteBuffer.arrayOffset()\r\n                bufferInfo.size = extractor.readSampleData(byteBuffer, offset)\r\n                // ã‚‚ã†ç„¡ã„å ´åˆ\r\n                if (bufferInfo.size < 0) break\r\n                // æ›¸ãè¾¼ã‚€\r\n                bufferInfo.presentationTimeUs = extractor.sampleTime\r\n                bufferInfo.flags = extractor.sampleFlags // LintãŒã‚­ãƒ¬ã‚‹ã‘ã©é»™ã‚‰ã›ã‚‹\r\n                mediaMuxer.writeSampleData(index, byteBuffer, bufferInfo)\r\n                // æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã«é€²ã‚ã‚‹\r\n                extractor.advance()\r\n            }\r\n            // ã‚ã¨ã—ã¾ã¤\r\n            extractor.release()\r\n        }\r\n        // ã‚ã¨ã—ã¾ã¤\r\n        mediaMuxer.stop()\r\n        mediaMuxer.release()\r\n    }\r\n\r\n}\r\n```\r\n\r\n## æœ€çµ‚çš„ãª MainActivity\r\n\r\n```kotlin\r\n/**\r\n * å‹•ç”»ä¿å­˜å…ˆ\r\n *\r\n * /sdcard/Android/data/io.github.takusan23.androidmediacodecvideomerge/files/video\r\n * */\r\nclass MainActivity : AppCompatActivity() {\r\n    /** å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€å */\r\n    private val FOLDER_NAME = \"bakkure\"\r\n\r\n    /** æ˜ åƒ ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private val MERGE_VIDEO_FILE_NAME = \"video_merge.mp4\"\r\n\r\n    /** éŸ³å£° ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private val MERGE_AUDIO_FILE_NAME = \"audio_merge.aac\"\r\n\r\n    /** æ˜ åƒã¨éŸ³å£°ã‚’åˆã‚ã›ãŸãƒ•ã‚¡ã‚¤ãƒ« */\r\n    private val FINAL_RESULT_FILE = \"final_merge.mp4\"\r\n\r\n    /** ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ */\r\n    private val TEMP_RAW_DATA_FILE_NAME = \"temp_raw_data\"\r\n\r\n    /** æ˜ åƒãã£ã¤ã‘ã‚‹ã‚„ã¤ */\r\n    private lateinit var videoDataMerge: VideoDataMerge\r\n\r\n    /** éŸ³å£°ãã£ã¤ã‘ã‚‹ã‚„ã¤ */\r\n    private lateinit var audioDataMerge: AudioDataMerge\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        // çµåˆã—ãŸã„å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ãŒç½®ã„ã¦ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€\r\n        val videoFolder = File(getExternalFilesDir(null), FOLDER_NAME).apply {\r\n            if (!exists()) {\r\n                mkdir()\r\n            }\r\n        }\r\n\r\n        // æœ€çµ‚çš„ã«çµåˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€‚æ˜ åƒ\r\n        val videoMergedFile = File(getExternalFilesDir(null), MERGE_VIDEO_FILE_NAME).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n        // æœ€çµ‚çš„ã«çµåˆã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã€‚éŸ³å£°\r\n        val audioMergedFile = File(getExternalFilesDir(null), MERGE_AUDIO_FILE_NAME).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n        // éŸ³å£°ã ã‘ã®ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ãŠã„ã¦ãŠããƒ•ã‚¡ã‚¤ãƒ«\r\n        val tempRawDataFile = File(getExternalFilesDir(null), TEMP_RAW_DATA_FILE_NAME).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n        // æœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«\r\n        val finalResultFile = File(getExternalFilesDir(null), FINAL_RESULT_FILE).apply {\r\n            if (!exists()) {\r\n                delete()\r\n            }\r\n            createNewFile()\r\n        }\r\n\r\n\r\n        // æ•°å­—ã‚’è¦‹ã¤ã‘ã‚‹æ­£è¦è¡¨ç¾\r\n        val numberRegex = \"(\\\\d+)\".toRegex()\r\n        // çµåˆã™ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é…åˆ—\r\n        val videoList = videoFolder.listFiles()\r\n            // ?.filter { it.extension == \"ts\" } // ã“ã‚Œå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ä»¥å¤–ãŒå…¥ã£ã¦ãã‚‹å ´åˆã¯ã“ã“ã§è¦‹åˆ‡ã‚Šã‚’ã¤ã‘ã‚‹\r\n            ?.toList()\r\n            ?.sortedBy { numberRegex.find(it.name)?.groupValues?.get(0)?.toIntOrNull() ?: 0 } // æ•°å­—ã®è‹¥ã„é †ã«ã™ã‚‹\r\n        // ?.dropLast(6)\r\n\r\n        // ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ä½œæˆ\r\n        videoDataMerge = VideoDataMerge(videoList!!, videoMergedFile /*bitRate = 1_000_000, frameRate = 30*/)\r\n        audioDataMerge = AudioDataMerge(videoList!!, audioMergedFile, tempRawDataFile, bitRate = 192_000)\r\n\r\n        // åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã‚’èµ·å‹•ã—ã¦é–‹å§‹\r\n        // éŸ³å£°ã¨æ˜ åƒã‚’ãã‚Œãã‚Œä¸¦åˆ—ã§å®Ÿè¡Œã—ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™...ï¼ˆãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®èµ·å‹•åˆ¶é™ã«å¼•ã£ã‹ã‹ã‚‰ãªã‘ã‚Œã°ï¼‰\r\n        // ä»Šå›ã¯ã‚³ãƒ«ãƒ¼ãƒãƒ³å…¥ã‚Œã¦ãªã„ã®ã§ç›´åˆ—ã§è¡Œã„ã¾ã™...\r\n        thread {\r\n            // æ˜ åƒãƒ‡ã‚³ãƒ¼ãƒ‰\r\n            val videoStartMs = System.currentTimeMillis()\r\n            showMessage(\"æ˜ åƒé–‹å§‹ï¼š$videoStartMs\")\r\n            videoDataMerge.merge()\r\n            showMessage(\"æ˜ åƒçµ‚äº†ï¼š${System.currentTimeMillis() - videoStartMs} Ms\")\r\n\r\n            // éŸ³å£°ãƒ‡ã‚³ãƒ¼ãƒ‰\r\n            val audioStartMs = System.currentTimeMillis()\r\n            showMessage(\"éŸ³å£°é–‹å§‹ï¼š$audioStartMs\")\r\n            audioDataMerge.merge()\r\n            showMessage(\"éŸ³å£°çµ‚äº†ï¼š${System.currentTimeMillis() - audioStartMs} Ms\")\r\n\r\n            // åˆæˆ...\r\n            MergedDataMuxer.mixed(finalResultFile, listOf(audioMergedFile, videoMergedFile))\r\n            showMessage(\"åˆæˆçµ‚äº†ï¼š${System.currentTimeMillis() - videoStartMs} Ms\")\r\n        }\r\n    }\r\n\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        videoDataMerge.stop()\r\n        audioDataMerge.stop()\r\n    }\r\n\r\n    private fun showMessage(message: String) {\r\n        println(message)\r\n        runOnUiThread { Toast.makeText(this@MainActivity, message, Toast.LENGTH_SHORT).show() }\r\n    }\r\n}\r\n```\r\n\r\n## ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯\r\næ˜ åƒ -> éŸ³å£° -> åˆæˆ ã¨ã„ã†æ„Ÿã˜ã«ç›´åˆ—ã§ã‚„ã£ã¦ã„ã‚‹\r\n\r\n5:14åˆ†ã®å‹•ç”»ã‚’FFmpegã§ç´°åˆ‡ã‚Œã«ã—ã¦åˆæˆãƒ†ã‚¹ãƒˆ  \r\nå„tsãƒ•ã‚¡ã‚¤ãƒ« 1MB ï½ 2MB ãã‚‰ã„ã€‚ã“ã‚ŒãŒ30å€‹ã€‚\r\n\r\n- https://www.youtube.com/watch?v=F2ZAlXrldIM\r\n    - 5åˆ†14ç§’\r\n    - 1280 x 720\r\n        - è§£åƒåº¦ã®å‰²ã«ç”»è³ªãŒæ‚ªã„ï¼ˆãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã®ã›ã„ï¼Ÿï¼‰\r\n    - 60 fps\r\n    - ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã¯ã‚ã‹ã‚‰ã‚“\r\n    - H.264 / AAC\r\n\r\n- Pixel 3 XL\r\n    - Snapdragon 845 / RAM 4GB (ãƒã‚¤ã‚¨ãƒ³ãƒ‰ãªåŒä¸–ä»£ã®ã‚¹ãƒãƒ›ã¨æ¯”ã¹ã¦ã‚‚å°‘ãªã„)\r\n\r\n```\r\næ˜ åƒçµ‚äº†ï¼š1090457 Ms\r\néŸ³å£°çµ‚äº†ï¼š231366 Ms\r\nåˆæˆçµ‚äº†ï¼š1332262 Ms\r\nãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼š105 MB â†ï¼ï¼Ÿ\r\n```\r\n\r\n- Xperia 5 â…¡\r\n    - Snapdragon 865 / RAM 8GB\r\n\r\n```\r\næ˜ åƒçµ‚äº†ï¼š817174 Ms\r\néŸ³å£°çµ‚äº†ï¼š174536 Ms\r\nåˆæˆçµ‚äº†ï¼š995225 Ms\r\nãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼š46.80 MB\r\n```\r\n\r\n- Xiaomi Mi 11 Lite 5G\r\n    - Snapdragon 780G / RAM 6GB\r\n\r\n```\r\næ˜ åƒçµ‚äº†ï¼š871282 Ms\r\néŸ³å£°çµ‚äº†ï¼š187584 Ms\r\nåˆæˆçµ‚äº†ï¼š1063305 Ms\r\nãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºï¼š49.81 MB\r\n```\r\n\r\n# ãƒ¡ãƒ¢\r\n\r\n- Pixel 3 XL ã ã¨ãªã‚“ã‹æ˜ åƒãƒ‡ãƒ¼ã‚¿ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒã‚¯ã‚½ã§ã‹ã„\r\n    - ä»Šå›ä½¿ã£ãŸ Xperia / Xiaomi ã¨æ¯”ã¹ã¦ã‚‚ãã£ãã§ã‹ã„\r\n- `MediaCodec#getInputBuffer()`ã®ã‚µã‚¤ã‚ºã‚’å¤‰æ›´ã™ã‚‹\r\n    - åˆæœŸçŠ¶æ…‹ã ã¨`4096`ãã‚‰ã„ã ã£ãŸã¯ãš\r\n        - `MediaCodec#configure()`ã§`MediaFormat.KEY_MAX_INPUT_SIZE`ã‚’ã„ã„æ„Ÿã˜ã«ã™ã‚Œã°å¤§ããå‡ºæ¥ã¾ã™\r\n- 1ã€2å¹´å‰ãã‚‰ã„ã«AOSPã‚’ãƒ‘ã‚¯ã£ã¦ä½œã£ãŸå†…éƒ¨éŸ³å£°éŒ²ç”»ã®ã‚µãƒ³ãƒ—ãƒ«ãŒã„ã„æ„Ÿã˜ã«å½¹ç«‹ã£ãŸã€‚ã‚ã‚ŠãŒã¨ã†éå»ã®ç§\r\n    - https://github.com/takusan23/InternalAudioRecorder\r\n- ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãŒèµ·å‹•ã—ãªã„\r\n    - Cãƒ‰ãƒ©ã‚¤ãƒ–ç©ºã„ã¦ã‚‹ï¼Ÿ\r\n- å‡ºåŠ›ãŒã¶ã£å£Šã‚Œã‚‹ï¼ˆç·‘è‰²ã¨ã‹ï¼‰\r\n    - MediaMuxerã¸æ¸¡ã—ãŸMediaFormatã æ­£ã—ããªã„ã‹ã‚‚\r\n        - `MediaCodec#getOutputFormat()`ã§å–ã‚Œã‚‹ã‚„ã¤ã‚’å…¥ã‚Œã‚Œã°ã„ã„ã¨æ€ã†\r\n- è§£åƒåº¦ãŒ16ã®å€æ•°ã˜ã‚ƒãªã„ã¨ã ã‚\r\n    - å…¬å¼ã«æ›¸ã„ã¦ãªã„ã£ã½ã„ï¼Ÿ\r\n\r\n# ã™ãºã—ã‚ƒã‚‹ ã•ã‚“ãã™\r\nã¨ã¦ã‚‚ã¨ã¦ã‚‚å‚è€ƒã«ã—ã¾ã—ãŸ\r\n\r\n- https://android.googlesource.com/platform/cts/+/jb-mr2-release/tests/tests/media/src/android/media/cts/ExtractDecodeEditEncodeMuxTest.java\r\n    - Apache License, Version 2.0\r\n- https://github.com/ypresto/android-transcoder/blob/ac94c6b059785bc7440e35422bf18d3a9913e884/lib/src/main/java/net/ypresto/androidtranscoder/engine/VideoTrackTranscoder.java\r\n    - Apache License, Version 2.0\r\n- https://github.com/zolad/VideoSlimmer\r\n    - Apache License, Version 2.0\r\n\r\n# ãŠã¾ã‘\r\nå‚è€ƒã«ã—ãŸã‚µãƒ³ãƒ—ãƒ«ã«OpenGLã‚’åˆ©ç”¨ã™ã‚‹ä¾‹ãŒã‚ã£ãŸã®ã§ä½œã£ã¦ã¿ã¾ã—ãŸã€  \r\nä½•ã‚„ã£ã¦ã‚‹ã®ã‹ã¯ã¾ã˜ã§ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ãªã‚“ã§ã“ã‚Œã§å‹•ãã®...ï¼Ÿ\r\n\r\nOpenGLã‚’åˆ©ç”¨ã™ã‚‹ã¨åˆ†ã‹ã‚‰ã‚“ã‘ã©ã€å½¢å¼ãŒç•°ãªã‚‹ï¼ˆæ¨ªç¸¦ã®å¤§ãã•ãŒé•ã†ï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚çµåˆã§ãã‚‹ã£ã½ã„ï¼ˆãªã‚“ã§ï¼Ÿï¼‰\r\n\r\n- https://github.com/takusan23/AndroidMediaCodecVideoMerge/blob/master/app/src/main/java/io/github/takusan23/androidmediacodecvideomerge/VideoDataOpenGlMerge.kt\r\n    - OpenGLã‚’åˆ©ç”¨ã—ãŸ VideoDataMerge\r\n    - VideoDataMerge ã¨ä½¿ã„æ–¹ã¯åŒã˜...\r\n- https://github.com/takusan23/AndroidMediaCodecVideoMerge/blob/master/app/src/main/java/io/github/takusan23/androidmediacodecvideomerge/gl/TextureRenderer.java\r\n    - å¿…è¦ã€‚ä½•ã‚„ã£ã¦ã‚‹ã®ã‹ã¯åˆ†ã‹ã‚‰ã‚“\r\n- https://github.com/takusan23/AndroidMediaCodecVideoMerge/blob/master/app/src/main/java/io/github/takusan23/androidmediacodecvideomerge/gl/CodecInputSurface.java\r\n    - å¿…è¦ã€‚ä½•ã‚„ã£ã¦ã‚‹ã®ã‹ã¯åˆ†ã‹ã‚‰ã‚“\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\næ°—ãŒå‘ã„ãŸã‚‰åˆæˆã‚¢ãƒ—ãƒªã‚’ä½œã‚ŠãŸã„ã§ã™...\r\n\r\nhttps://github.com/takusan23/AndroidMediaCodecVideoMerge\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\nDreamin'Her -åƒ•ã¯ã€å½¼å¥³ã®å¤¢ã‚’è¦‹ã‚‹ã€‚-  \r\n\r\nã£ã¦ã‚„ã¤å…¨å¹´é½¢ãªã‚“ã ã‘ã©ã‚ã£ã¡ã‚ƒæ°—ã«ãªã‚‹ã€‚~~è²·ãŠã†ã‹ãª~~\r\n\r\nã‹ã£ãŸã€ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç‰ˆé«˜ã„ã‚ˆã‰\r\n\r\n![Imgur](https://imgur.com/oiBU1KT.png)"},{"title":"MediaControllerCompat#transportControlsã§ãƒªãƒ”ãƒ¼ãƒˆã€ã‚·ãƒ£ãƒƒãƒ•ãƒ«æ“ä½œã™ã‚‹","link":"/posts/android_mediasession_callback/","markdown":"\r\næœ¬å½“ã‹ã©ã†ã‹ã¯çŸ¥ã‚Šã¾ã›ã‚“ãŒãƒ¡ãƒ¢ã¨ã—ã¦ç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\n## æœ¬é¡Œ\r\n`Fragment/Activity`ã«ç´ã¥ã‘ã—ãŸ`MediaControllerCompat`ã§  \r\n`transportControls.setRepeatMode()`ã‚„`transportControls.setShuffleMode()`ã‚’å‘¼ã‚“ã ã®ã«ã€\r\n`repeatMode`ã‚„`shuffleMode`ãŒå¤‰ã‚ã‚‰ãªã„å•é¡Œ\r\n\r\n## è§£æ±ºæ–¹æ³•\r\n\r\n```kotlin\r\nprivate val callback = object : MediaSessionCompat.Callback() {\r\n    /** ãƒªãƒ”ãƒ¼ãƒˆãƒ¢ãƒ¼ãƒ‰å¤‰æ›´ */\r\n    override fun onSetRepeatMode(repeatMode: Int) {\r\n        super.onSetRepeatMode(repeatMode)\r\n        // ã‚‚ã—ã‹ã—ã¦ï¼šã“ã®ä¸€è¡Œå¿…é ˆï¼Ÿ\r\n        mediaSessionCompat.setRepeatMode(repeatMode)\r\n        if (repeatMode == PlaybackStateCompat.REPEAT_MODE_ALL) {\r\n            // ç„¡é™ãƒ«ãƒ¼ãƒ—ãƒ«ãƒ¼ãƒ—ã™ã‚‹\r\n            exoPlayer.repeatMode = Player.REPEAT_MODE_ALL\r\n        } else {\r\n            // åŒã˜æ›²ã‚’ä½•å›ã‚‚èãã€‚\r\n            exoPlayer.repeatMode = Player.REPEAT_MODE_ONE\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`mediaSessionCompat.setRepeatMode(repeatMode)`ã‚’å‘¼ã‚“ã ã‚‰ç›´ã£ãŸ"},{"title":"Androidã§å¥½ããªéŸ³æ¥½ã‚¢ãƒ—ãƒªã®æ“ä½œã¨ã‹æ¥½æ›²æƒ…å ±å–å¾—ã¨ã‹","link":"/posts/android_mediasession_manager/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã‚½ãƒ‹ãƒ¼ã®ã‚¤ãƒ¤ãƒ›ãƒ³ã®ã‚¢ãƒ—ãƒªãŒæ¥½æ›²æƒ…å ±ã‚’å–å¾—ã§ãã¦ã„ãŸã®ã§è¬ã ãªãƒ¼ã£ã¦æ€ã£ã¦èª¿æŸ»ã—ãŸã€‚ï¼ˆã¡ãªã¿ã«ã“ã‚Œã‹ã‚‰æ›¸ãã“ã¨ã¨ã¯é–¢ä¿‚ãªã„ã€‚å¤šåˆ†åˆ¥ã®ä»•çµ„ã¿ã§å–å¾—ã—ã¦ã‚‹ï¼‰\r\n\r\n# æœ¬é¡Œ\r\nRootæ¨©é™ã¨ã‹ãªã—ã§å†ç”Ÿä¸­ã®éŸ³æ¥½ã‚¢ãƒ—ãƒªã‹ã‚‰æ¥½æ›²æƒ…å ±å–å¾—ã¨ã‹éŸ³æ¥½æ“ä½œã‚’ã—ã¾ã™ã€‚  \r\nå¤šåˆ†ã„ã¾å­˜åœ¨ã—ã¦ã„ã‚‹éŸ³æ¥½ã‚¢ãƒ—ãƒªã§ã¯MediaSessionã‚’ä½¿ã£ã¦ã„ã‚‹ã¯ãšãªã®ã§ã€å¤šåˆ†å„è‡ªå¥½ããªéŸ³æ¥½ã‚¢ãƒ—ãƒªã§å‹•ãã¯ãšã§ã™ã€‚\r\n\r\n## MediaSession #ã¨ã¯\r\néŸ³æ¥½ã‚¢ãƒ—ãƒªãŒã„ã¾å†ç”Ÿã—ã¦ã„ã‚‹æ›²ã®æƒ…å ±ã‚’å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹ã®ã«ä½¿ã†ã€‚  \r\nä»–ã«ã‚‚ä»–ã‹ã‚‰éŸ³æ¥½ã‚¢ãƒ—ãƒªã¸æ¬¡ã®æ›²è¡Œã‘ï¼ã¨ã‹æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹ã®ã«ã‚‚ä½¿ã†ã€‚  \r\n\r\nã“ã‚Œã®ãŠã‹ã’ã§ã€\r\n\r\n- Googleã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã€ä»ŠéŸ³æ¥½ã‚¢ãƒ—ãƒªãŒå†ç”Ÿã—ã¦ã„ã‚‹æ›²åã‚’æ•™ãˆã¦ãã‚ŒãŸã‚Š\r\n    - æ¬¡ã®æ›²ã«ã—ã¦ã¨ã‹ã‚‚å¯¾å¿œã—ã¦ã‚‹\r\n- ãƒ­ãƒƒã‚¯ç”»é¢ã®èƒŒæ™¯ã«ã‚¢ãƒ«ãƒãƒ ã‚¸ãƒ£ã‚±ãƒƒãƒˆãŒè¡¨ç¤ºã•ã‚ŒãŸã‚Š    \r\n    - Android 11ãã‚‰ã„ã§å»ƒæ­¢ã«ãªã£ãŸã‘ã©ã­ã€‚\r\n- Bluetoothã‚¤ãƒ¤ãƒ›ãƒ³ã¨ã®æ¥ç¶šãŒåˆ‡æ–­ã•ã‚ŒãŸéš›ã«ä¸€æ™‚åœæ­¢ã™ã‚‹\r\n\r\nãªã©ã€‚\r\n\r\n![Imgur](https://imgur.com/8oYASKU.png)\r\n\r\nâ†‘ [ãã†è¨€ãˆã°SMEEãŒæ–°ä½œå‡ºã™ã£ã½ã„ã§ã™ã‚ˆï¼Ÿ](http://www.hook-net.jp/smee/smee13th/)ã€‚ã„ã‚„ã“ã‚Œä»¥ä¸Šæ‰‹ã‚’å‡ºã—ãŸã‚‰ã¾ã˜ã§è©°ã‚“ã§ã‚‹ã‚²ãƒ¼ãƒ çµ‚ã‚ã‚‰ãªããªã‚‹ã€‚\r\n\r\nã¡ãªã¿ã«ä»–ã®ã‚¢ãƒ—ãƒªãŒéŸ³ã‚’å‡ºã™ã‹ã‚‰ã€ã„ã¾å†ç”Ÿã—ã¦ã„ã‚‹éŸ³æ¥½ã‚¢ãƒ—ãƒªã¯ä¸€æ™‚åœæ­¢ã—ã¦ã­ã£ã¦ã‚„ã¤ã¯`AudioFocus`ã£ã¦ã‚„ã¤ã ã¨æ€ã†ã€‚MediaSessionã®æ©Ÿèƒ½ã˜ã‚ƒãªã‹ã£ãŸã¯ãšã€‚\r\n\r\n## æ­£è¦ãƒ«ãƒ¼ãƒˆã§æ¥½æ›²æƒ…å ±å–å¾—ã¨ã‹ã™ã‚‹ã«ã¯\r\n`MediaSessionManager`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ã€ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹MediaSessionã®Controllerã‚’è²°ãˆã¾ã™ã€‚  \r\nã“ã‚Œã‚’ä½¿ã†ã¨æ¥½æ›²æƒ…å ±(`MediaMetadata`)ã‚„ã€æ“ä½œ(`TransportControls`)ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\nãªã‚“ã ã‘ã©ã€ã“ã‚Œã‚·ã‚¹ãƒ†ãƒ æ¨©é™ã®`MEDIA_CONTENT_CONTROL`ã‹ã€é€šçŸ¥é ˜åŸŸã®ç›£è¦–æ¨©é™ã®ã©ã¡ã‚‰ã‹ãŒå¿…è¦ã§ã™ã€‚  \r\nRootç„¡ã„ã®ã§å¿…ç„¶çš„ã«å¾Œè€…ã—ã‹ç„¡ã„ã§ã™ã€‚ã¾ããã‚“ãªé›£ã—ããªã„ã®ã§å¤§ä¸ˆå¤«ã§ã™ã€‚\r\n\r\n## é€šçŸ¥é ˜åŸŸã®ç›£è¦–æ¨©é™\r\n`NotificationListenerService`ã£ã¦ã‚„ã¤ã‚’ä½¿ã†ã¨ãã«å¿…è¦ã«ãªã‚‹ã€‚  \r\nDangerPermissionã‚ˆã‚Šä¸Šã®ã€è¨­å®šç”»é¢ã¸èª˜å°ã—ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ONã«ã—ã¦ã‚‚ã‚‰ã†ç³»ã®æ¨©é™ã§ã™ã€‚  \r\n\r\n# é€šçŸ¥ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã‚‹\r\né©å½“ã«`NotificationListenerService`ã‚’ç¶™æ‰¿ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚  \r\nå¤šåˆ†ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¯ãƒ©ã‚¹ãŒã‚ã‚Œã°ã„ã„ã®ã§ç‰¹ã«ç¶™æ‰¿ã—ã¦ä½•ã‹æ›¸ãã“ã¨ã¯ç„¡ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MediaSessionNotificationListenerService : NotificationListenerService() {\r\n\r\n}\r\n```\r\n\r\n# AndroidManifest.xmlã«æ›¸ãè¶³ã™\r\n`<application>`ã®ä¸­ã«æ›¸ãè¶³ã—ã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    package=\"io.github.takusan23.getcurrentplayingmusic\">\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.GetCurrentPlayingMusic\">\r\n        <activity\r\n            android:name=\".MainActivity\"\r\n            android:exported=\"true\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n\r\n\r\n        <service\r\n            android:name=\".MediaSessionNotificationListenerService\"\r\n            android:exported=\"true\"\r\n            android:label=\"@string/app_name\"\r\n            android:permission=\"android.permission.BIND_NOTIFICATION_LISTENER_SERVICE\">\r\n            <intent-filter>\r\n                <action android:name=\"android.service.notification.NotificationListenerService\" />\r\n            </intent-filter>\r\n        </service>\r\n\r\n    </application>\r\n\r\n</manifest>\r\n```\r\n\r\n# ã‚¢ãƒ—ãƒªã‚’å®Ÿè¡Œã™ã‚‹ã€‚\r\nèµ·å‹•ã—ãŸã‚‰ã€é–‰ã˜ã¦è¨­å®šç”»é¢ã¸é€²ã¿ã€  \r\n\r\n- Android 12\r\n    - é€šçŸ¥ > ãƒ‡ãƒã‚¤ã‚¹ã¨ã‚¢ãƒ—ãƒªã®é€šçŸ¥ \r\n- Android 11\r\n    - ã‚¢ãƒ—ãƒªã¨é€šçŸ¥ > ç‰¹åˆ¥ãªã‚¢ãƒ—ãƒªã‚¢ã‚¯ã‚»ã‚¹ > é€šçŸ¥ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹\r\n- Android 5\r\n    - éŸ³ã¨é€šçŸ¥ > é€šçŸ¥ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹\r\n- MIUI 12\r\n    - ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ä¿è­· > ç‰¹åˆ¥ãªæ¨©é™ > é€šçŸ¥ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹\r\n\r\nã‹ã‚‰ã“ã®ã‚¢ãƒ—ãƒªã¸æ¨©é™ã‚’ä»˜ä¸ã—ã¦ãã ã•ã„ã€‚  \r\nã“ã‚Œã§æº–å‚™å®Œäº†ã§ã™ï¼\r\n\r\n# ç¾åœ¨å†ç”Ÿã—ã¦ã„ã‚‹æ¥½æ›²æƒ…å ±ã‚’å–å¾—\r\n\r\n`activity_main.xml`ã«æœ€åˆã‹ã‚‰ã‚ã‚‹TextViewã«é©å½“ã«IDã‚’æŒ¯ã£ã¦ãŠã„ã¦ãã ã•ã„ã€‚\r\n\r\n`MediaController#getMetadata`ã‹ã‚‰å–å¾—ã§ãã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        val textView = findViewById<TextView>(R.id.activity_main_text_view)\r\n\r\n        // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹MediaSessionã®Controllerå–å¾—\r\n        val mediaSessionManager = getSystemService(Context.MEDIA_SESSION_SERVICE) as MediaSessionManager\r\n        val componentName = ComponentName(this, MediaSessionNotificationListenerService::class.java)\r\n        // æ›²åã‚’ã‚»ãƒƒãƒˆ\r\n        val currentPlayingMediaController = mediaSessionManager.getActiveSessions(componentName)[0]\r\n        textView.text = currentPlayingMediaController.metadata?.getString(MediaMetadata.METADATA_KEY_TITLE) // ã‚¿ã‚¤ãƒˆãƒ«å–å¾—\r\n        \r\n    }\r\n}\r\n```\r\n\r\n# ä¸€æ™‚åœæ­¢æ“ä½œãªã©\r\n`MediaController#getTransportControls`ã‹ã‚‰ä¸€æ™‚åœæ­¢æ“ä½œã‚„ã€å†ç”Ÿã¨ã‹å‡ºæ¥ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        val textView = findViewById<TextView>(R.id.activity_main_text_view)\r\n\r\n        // ç¾åœ¨ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŠ¶æ…‹ã«ãªã£ã¦ã„ã‚‹MediaSessionã®Controllerå–å¾—\r\n        val mediaSessionManager = getSystemService(Context.MEDIA_SESSION_SERVICE) as MediaSessionManager\r\n        val componentName = ComponentName(this, MediaSessionNotificationListenerService::class.java)\r\n        // æ›²åã‚’ã‚»ãƒƒãƒˆ\r\n        val currentPlayingMediaController = mediaSessionManager.getActiveSessions(componentName)[0]\r\n        textView.text = currentPlayingMediaController.metadata?.getString(MediaMetadata.METADATA_KEY_TITLE)\r\n\r\n        // ä¸€æ™‚åœæ­¢\r\n        currentPlayingMediaController.transportControls.pause()\r\n    }\r\n}\r\n```\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã“ã‚Œã‚’å¿œç”¨ã—ãŸã€éŸ³æ¥½ã‚¢ãƒ—ãƒªã®ã‚¦ã‚¤ã‚¸ã‚§ãƒƒãƒˆã ã‘ã‚’è¿½åŠ ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚  \r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼šhttps://github.com/takusan23/MyMusicControlWidget\r\n\r\nPlayã‚¹ãƒˆã‚¢ï¼šhttps://play.google.com/store/apps/details?id=io.github.takusan23.mymusiccontrolwidget\r\n\r\nAPKãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼šhttps://github.com/takusan23/MyMusicControlWidget/releases"},{"title":"Androidã§æ¥ç¶šä¸­ã®ãƒãƒ³ãƒ‰ã‚’å–å¾—ã™ã‚‹","link":"/posts/android_mobile_data_band/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚\n\n<img src=\"https://imgur.com/31rkY0c.png\" width=\"300\">\n\nåº—å“¡ã¡ã‚ƒã‚“ã®ã‚»ã‚¤ã‚¤ã‚­ã€ã€ã€ã©ã“ï¼Ÿ\n\n# æœ¬é¡Œ\nAndroidã§æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ã‚’å–å¾—ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚ŠãŸã„ã€‚  \nBand 3ã¨ã‹ãã†ã„ã†ã®ãŒã»ã—ã„\n\n# ä¸€ç­‹ç¸„ã§ã¯è¡Œã‹ãªã„\n`getBand()`ã¿ãŸã„ãªé–¢æ•°ã¯ç„¡ã„ã€‚ã˜ã‚ƒã‚ä¸–ã®ä¸­ã®é›»æ¸¬[^1]ã‚¢ãƒ—ãƒªã¯ã©ã†ã‚„ã£ã¦ãƒãƒ³ãƒ‰ã‚’å–å¾—ã—ã¦ã„ã‚‹ã®ã£ã¦è©±ã§ã™ãŒã€  \n`EARFCN`ã¨ã„ã†å€¤ãŒå–å¾—ã§ãã‚‹ã®ã§ã€`EARFCN`ã®å€¤ã¨`ãƒãƒ³ãƒ‰ä¸€è¦§`ã‚’ç…§ã‚‰ã—åˆã‚ã›ã‚‹ã“ã¨ã§ãƒãƒ³ãƒ‰ã‚’å–å¾—ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\n\nå‘¨æ³¢æ•°ã‚‚`EARFCN`ã‹ã‚‰å‡ºã™ã“ã¨ãŒã§ãã‚‹ã¿ãŸã„ã§ã™ã€‚\n\nã¡ãªã¿ã«3Gã§ã¯`UARFCN`ã€5Gã§ã¯`NRARFCN`ã¨å‘¼ã°ã‚Œã¦ã„ã‚‹ãã†ã€‚\n\nEARFCNã‹ã‚‰ãƒãƒ³ãƒ‰ã‚’å‰²ã‚Šå‡ºã™ã‚µã‚¤ãƒˆâ†’https://www.sqimway.com/lte_band.php\n\n# ã¨ã‚Šã‚ãˆãšEARFCNã‚’å–å¾—ã—ã¦ã¿ã‚‹\n\n## app/build.gradle\n\n`ViewBinding`ã€`Acitivty Result API`ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™\n\n```\nandroid {\n    compileSdkVersion 30\n    buildToolsVersion \"30.0.3\"\n\n    defaultConfig {\n        applicationId \"io.github.takusan23.connectionband\"\n        minSdkVersion 24\n        targetSdkVersion 30\n        versionCode 1\n        versionName \"1.0\"\n\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n    }\n\n    buildFeatures{\n        viewBinding true\n    }\n\n    // çœç•¥\n\n}\n\ndependencies {\n\n    // Activity Result API\n    implementation 'androidx.activity:activity-ktx:1.3.0-alpha06'\n    implementation 'androidx.fragment:fragment-ktx:1.3.2'\n\n\n}\n```\n\n## activity_main.xml\n\n`TextView`ã¨`Button`ã‚’ãŠã„ã¦ãŠãã¾ã—ã‚‡ã†\n\n```xml\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\n    xmlns:tools=\"http://schemas.android.com/tools\"\n    android:layout_width=\"match_parent\"\n    android:layout_height=\"match_parent\"\n    tools:context=\".MainActivity\">\n\n    <TextView\n        android:id=\"@+id/activity_main_text_view\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:text=\"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è¨ˆæ¸¬\"\n        app:layout_constraintBottom_toBottomOf=\"parent\"\n        app:layout_constraintLeft_toLeftOf=\"parent\"\n        app:layout_constraintRight_toRightOf=\"parent\"\n        app:layout_constraintTop_toTopOf=\"parent\" />\n\n    <Button\n        android:id=\"@+id/activity_main_button\"\n        android:layout_width=\"wrap_content\"\n        android:layout_height=\"wrap_content\"\n        android:layout_marginTop=\"16dp\"\n        android:text=\"è¨ˆæ¸¬\"\n        app:layout_constraintEnd_toEndOf=\"parent\"\n        app:layout_constraintStart_toStartOf=\"parent\"\n        app:layout_constraintTop_toBottomOf=\"@+id/activity_main_text_view\" />\n\n</androidx.constraintlayout.widget.ConstraintLayout>\n```\n\n## AndroidManifest.xml\n\nAndroid 10ä»¥é™ã¯ã“ã®æ¨©é™ãŒç„¡ã„ã¨æœ€æ–°ã®å€¤ãŒå–ã‚Œãªã„ã€‚\n\n```xml\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\n```\n\n## MainActivity.kt\n\n### æ¨©é™ã¨ViewBinding\n\nã¨ã‚Šã‚ãˆãšæ¨©é™ã‚‚ã‚‰ã†ã®ã¨ã€`ViewBinding`ã®ç”¨æ„ã‚’ã—ã¾ã™ã€‚\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\n\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n        if (isGranted) {\n            // æ¨©é™ã‚‚ã‚‰ãˆãŸ\n\n        }\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(viewBinding.root)\n\n        start()\n\n        viewBinding.activityMainButton.setOnClickListener {\n            start()\n        }\n\n    }\n\n    /** æ¨©é™ãŒã‚ã‚Œã°è¨ˆæ¸¬ã€ãªã‘ã‚Œã°æ¨©é™ã‚’ã‚‚ã‚‰ã† */\n    private fun start() {\n        if (ContextCompat.checkSelfPermission(this, android.Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n            // æ¨©é™ã‚ã‚Š\n\n        } else {\n            // æ¨©é™ãªã—ã€‚è²°ã„ã«è¡Œã\n            permissionCallBack.launch(android.Manifest.permission.ACCESS_FINE_LOCATION)\n        }\n    }\n\n\n}\n```\n\n## EARFCNã®å–å¾—\n`getEarfcn`é–¢æ•°å†…ã«æ›¸ã„ã¦ã„ãã¾ã™ã€‚\n\n```kotlin\n/** TextViewã«ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤ºã•ã›ã‚‹ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã«ãªã‚Šã¾ã™ */\nprivate fun getEarfcn(result: (CellInfo) -> Unit) {\n    val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\n    if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {\n        // Android 10ä»¥é™\n        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n            telephonyManager.requestCellInfoUpdate(mainExecutor, object : TelephonyManager.CellInfoCallback() {\n                override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\n                    result.invoke(cellInfo[0])\n                }\n            })\n        }\n    } else {\n        // Android 9ä»¥å‰\n        result.invoke(telephonyManager.allCellInfo[0])\n    }\n}\n```\n\n# EARFCNã‹ã‚‰ãƒãƒ³ãƒ‰ã‚’å‰²ã‚Šå‡ºã™é–¢æ•°\n\nã¨ã€ãã®å‰ã«`EARFCN`ã®å€¤ã¨ãƒãƒ³ãƒ‰ã®ç›¸å¯¾è¡¨ãŒå¿…è¦ã§ã™ã®ã§ç”¨æ„ã—ã¾ã—ã‚‡ã†ã€‚ \n\n- https://www.arib.or.jp/english/html/overview/doc/STD-T104v2_10/5_Appendix/Rel11/36/36101-b50.pdf\n    - 33ãƒšãƒ¼ã‚¸ç›®ã€`Table 5.7.3-1: E-UTRA channel numbers`\n- `lte band earfcn table` ã¨ã‹ã§æ¤œç´¢\n\nå¤šåˆ†PDFè¦‹ã‚‹ã®ãŒæ—©ã„ã¨æ€ã„ã¾ã™ã€‚\n\nä¸­ã‚’è¦‹ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã®è¡¨ãŒå‡ºã¦ãã¾ã™ã€‚ï¼ˆä»¥ä¸‹ã¯ã‚¯ã‚½ç°¡ç•¥ç‰ˆï¼‰\n\n| band | Range of Ndl |\n|------|--------------|\n| 1    | 0 - 599      |\n| 2    | 600 - 1199   |\n| 3    | 1200 - 1949  |\n\nå–å¾—ã—ãŸ`EARFCN`ãŒ`1850`ã®å ´åˆã¯ã€`1200 ã‹ã‚‰ 1949 ã¾ã§`ã®`Band 3`ãŒæ­£è§£ï¼ã¨ãªã‚‹ã‚ã‘ã§ã™ã€‚  \n`1500`ã®å ´åˆã§ã‚‚ã€`1200 ã‹ã‚‰ 1949 ã¾ã§`ã®`Band 3`ãŒæ­£è§£ã¨ãªã‚Šã¾ã™ã€‚\n\nã“ã®è¡¨ã¨ç…§ã‚‰ã—åˆã‚ã›ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚\n\n## ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„\nãƒ‡ãƒ¼ã‚¿3ã¤ãªã®ã§`Triple`ã§ã‚‚è‰¯ã‹ã£ãŸã§ã™ã­\n\n```kotlin\n/**\n * ãƒãƒ³ãƒ‰ã®è¡¨ãƒ‡ãƒ¼ã‚¿\n * @param bandNumber ãƒãƒ³ãƒ‰ã®ç•ªå·\n * @param nDlMin Earfcnã“ã“ã‹ã‚‰\n * @param nDlMax Earfcnã“ã“ã¾ã§\n * */\ndata class BandData(val bandNumber: Int, val nDlMin: Int, val nDlMax: Int)\n```\n\n## å¤‰æ›ã™ã‚‹é–¢æ•°\n\nKotlinã®(0..10)ã¿ãŸã„ãªã‚„ã¤ã®ãŠã‹ã’ã§æ¥½ã§ã™ã­ã€‚  \n(æ¯”è¼ƒæ¼”ç®—å­ä½¿ã£ã¦ç¯„å›²å†…ã‹ã©ã†ã‹ã‚’èª¿ã¹ã¦ã‚‚ã„ã„ã‘ã©)\n\n```kotlin\n/** EARFCNã‹ã‚‰ãƒãƒ³ãƒ‰ã‚’å‰²ã‚Šå‡ºã™ */\nprivate fun getBand(earfcn: Int): Int {\n    /**\n     * https://www.arib.or.jp/english/html/overview/doc/STD-T104v2_10/5_Appendix/Rel11/36/36101-b50.pdf\n     *\n     * 33ãƒšãƒ¼ã‚¸ç›®ã€ã€ŒTable 5.7.3-1: E-UTRA channel numbersã€å‚ç…§\n     * */\n    val bandList = listOf(\n            BandData(1, 0, 599),\n            BandData(2, 600, 1199),\n            BandData(3, 1200, 1949),\n            BandData(4, 1950, 2399),\n            BandData(5, 2400, 2649),\n            BandData(6, 2650, 2749),\n            BandData(7, 2750, 3449),\n            BandData(8, 3450, 3799),\n            BandData(9, 3800, 4149),\n            BandData(10, 4150, 4749),\n            BandData(11, 4750, 4949),\n            BandData(12, 5010, 5179),\n            BandData(13, 5180, 5279),\n            BandData(14, 5280, 5279),\n            BandData(17, 5730, 5849),\n            BandData(18, 5850, 5999),\n            BandData(19, 6000, 6149),\n            BandData(20, 6150, 6449),\n            BandData(21, 6450, 6599),\n            BandData(22, 6600, 7399),\n            BandData(23, 7500, 7699),\n            BandData(24, 7700, 8039),\n            BandData(25, 8040, 8689),\n            BandData(26, 8690, 9039),\n            BandData(27, 9040, 9209),\n            BandData(28, 9210, 9659),\n            BandData(29, 9660, 9769),\n            BandData(30, 9770, 9869),\n            BandData(31, 9870, 9919),\n            BandData(32, 9920, 10359),\n            BandData(65, 65536, 66435),\n            BandData(66, 66436, 67335),\n            BandData(67, 67336, 67535),\n            BandData(68, 67536, 67835),\n            BandData(69, 67836, 68335),\n            BandData(70, 68336, 68585),\n            BandData(71, 68586, 68935),\n    )\n    // æ¢ã™\n    return bandList.find { bandData -> earfcn in bandData.nDlMin..bandData.nDlMax }?.bandNumber ?: 0\n}\n```\n\n## åˆä½“\nEARFCNå–å¾—é–¢æ•°ã¨åˆä½“ã•ã›ã¾ã™ã€‚\n\n```kotlin\n/** æ¥ç¶šã—ã¦ã„ã‚‹ãƒãƒ³ãƒ‰ã‚’TextViewã«å…¥ã‚Œã‚‹ */\nprivate fun setBandToTextView() {\n    getEarfcn { cellInfo ->\n        if (cellInfo is CellInfoLte) {\n           val band = getBand(cellInfo.cellIdentity.earfcn)\n            viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${band}\"\n        }\n    }\n}\n```\n\nãã—ã¦æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã®ã¨ã“ã‚ã¨ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ã“ã‚ã«æ›¸ã„ã¦å®Œæˆ\n\n```kotlin\nprivate val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n    if (isGranted) {\n        // æ¨©é™ã‚‚ã‚‰ãˆãŸ\n        setBandToTextView()\n    }\n}\n```\n\n```kotlin\n/** æ¨©é™ãŒã‚ã‚Œã°è¨ˆæ¸¬ã€ãªã‘ã‚Œã°æ¨©é™ã‚’ã‚‚ã‚‰ã† */\nprivate fun start() {\n    if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n        // æ¨©é™ã‚ã‚Š\n        setBandToTextView()\n    } else {\n        // æ¨©é™ãªã—ã€‚è²°ã„ã«è¡Œã\n        permissionCallBack.launch(Manifest.permission.ACCESS_FINE_LOCATION)\n    }\n}\n```\n\n# å…¨éƒ¨ãã£ã¤ã‘ã¦ã“ã†\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\n\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n        if (isGranted) {\n            // æ¨©é™ã‚‚ã‚‰ãˆãŸ\n            setBandToTextView()\n        }\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(viewBinding.root)\n\n        start()\n\n        viewBinding.activityMainButton.setOnClickListener {\n            start()\n        }\n\n    }\n\n    /** æ¨©é™ãŒã‚ã‚Œã°è¨ˆæ¸¬ã€ãªã‘ã‚Œã°æ¨©é™ã‚’ã‚‚ã‚‰ã† */\n    private fun start() {\n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n            // æ¨©é™ã‚ã‚Š\n            setBandToTextView()\n        } else {\n            // æ¨©é™ãªã—ã€‚è²°ã„ã«è¡Œã\n            permissionCallBack.launch(Manifest.permission.ACCESS_FINE_LOCATION)\n        }\n    }\n\n    /** æ¥ç¶šã—ã¦ã„ã‚‹ãƒãƒ³ãƒ‰ã‚’TextViewã«å…¥ã‚Œã‚‹ */\n    private fun setBandToTextView() {\n        getEarfcn { cellInfo ->\n            when (cellInfo) {\n                is CellInfoLte -> {\n                    // 4G / LTE\n                    val band = getBand(cellInfo.cellIdentity.earfcn)\n                    viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${band}\"\n                }\n            }\n        }\n    }\n\n    /** TextViewã«ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤ºã•ã›ã‚‹ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã«ãªã‚Šã¾ã™ */\n    private fun getEarfcn(result: (CellInfo) -> Unit) {\n        val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\n        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {\n            // Android 10ä»¥é™\n            if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n                telephonyManager.requestCellInfoUpdate(mainExecutor, object : TelephonyManager.CellInfoCallback() {\n                    override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\n                        result.invoke(cellInfo[0])\n                    }\n                })\n            }\n        } else {\n            // Android 9ä»¥å‰\n            result.invoke(telephonyManager.allCellInfo[0])\n        }\n    }\n\n    /** EARFCNã‹ã‚‰ãƒãƒ³ãƒ‰ã‚’å‰²ã‚Šå‡ºã™ */\n    private fun getBand(earfcn: Int): Int {\n        /**\n         * https://www.arib.or.jp/english/html/overview/doc/STD-T104v2_10/5_Appendix/Rel11/36/36101-b50.pdf\n         *\n         * 33ãƒšãƒ¼ã‚¸ç›®ã€ã€ŒTable 5.7.3-1: E-UTRA channel numbersã€å‚ç…§\n         * */\n        val bandList = listOf(\n                BandData(1, 0, 599),\n                BandData(2, 600, 1199),\n                BandData(3, 1200, 1949),\n                BandData(4, 1950, 2399),\n                BandData(5, 2400, 2649),\n                BandData(6, 2650, 2749),\n                BandData(7, 2750, 3449),\n                BandData(8, 3450, 3799),\n                BandData(9, 3800, 4149),\n                BandData(10, 4150, 4749),\n                BandData(11, 4750, 4949),\n                BandData(12, 5010, 5179),\n                BandData(13, 5180, 5279),\n                BandData(14, 5280, 5279),\n                BandData(17, 5730, 5849),\n                BandData(18, 5850, 5999),\n                BandData(19, 6000, 6149),\n                BandData(20, 6150, 6449),\n                BandData(21, 6450, 6599),\n                BandData(22, 6600, 7399),\n                BandData(23, 7500, 7699),\n                BandData(24, 7700, 8039),\n                BandData(25, 8040, 8689),\n                BandData(26, 8690, 9039),\n                BandData(27, 9040, 9209),\n                BandData(28, 9210, 9659),\n                BandData(29, 9660, 9769),\n                BandData(30, 9770, 9869),\n                BandData(31, 9870, 9919),\n                BandData(32, 9920, 10359),\n                BandData(65, 65536, 66435),\n                BandData(66, 66436, 67335),\n                BandData(67, 67336, 67535),\n                BandData(68, 67536, 67835),\n                BandData(69, 67836, 68335),\n                BandData(70, 68336, 68585),\n                BandData(71, 68586, 68935),\n        )\n        // æ¢ã™\n        return bandList.find { bandData -> earfcn in bandData.nDlMin..bandData.nDlMax }?.bandNumber ?: 0\n    }\n\n    /**\n     * ãƒãƒ³ãƒ‰ã®è¡¨ãƒ‡ãƒ¼ã‚¿\n     * @param bandNumber ãƒãƒ³ãƒ‰ã®ç•ªå·\n     * @param nDlMin Earfcnã“ã“ã‹ã‚‰\n     * @param nDlMax Earfcnã“ã“ã¾ã§\n     * */\n    data class BandData(val bandNumber: Int, val nDlMin: Int, val nDlMax: Int)\n\n}\n```\n\nå‹•ã‹ã™ã¨ã“ã‚“ãªã‹ã‚“ã˜\n\n![Imgur](https://imgur.com/FIzgY7v.png)\n\n## ç•ªå¤–ç·¨ï¼š5Gï¼ˆNRï¼‰ã«å¯¾å¿œã™ã‚‹\nNew Radioã®ç•¥ã‚‰ã—ã„ã€‚  \n\n- https://www.etsi.org/deliver/etsi_ts/138100_138199/13810101/15.08.02_60/ts_13810101v150802p.pdf\n    - 30ãƒšãƒ¼ã‚¸ç›®ã€ã€ŒTable 5.4.2.3-1: Applicable NR-ARFCN per operating bandã€å‚ç…§\n\nã“ã“ã«4Gã®ã¨ãã¿ãŸã„ãªè¡¨ãŒã‚ã‚‹ã®ã§\n\n| band | Downlink Range of NREF |\n|------|------------------------|\n| n1   | 422000 â€“ 434000        |\n| n2   | 386000  â€“ 398000       |\n| n3   | 361000 - 376000        |\n\nã“ã‚Œã‚’é…åˆ—ã«å…¥ã‚Œã¦ã“ã‚“ãªæ„Ÿã˜ã«ã€‚\n\nã‚ã€ãƒŸãƒªæ³¢ã®æ–¹ã¯ã€\n\n- https://www.etsi.org/deliver/etsi_ts/138100_138199/13810102/15.08.00_60/ts_13810102v150800p.pdf\n    - 27ãƒšãƒ¼ã‚¸ç›®ã€ã€ŒTable 5.4.2.3-1: Applicable NR-ARFCN per operating bandã€\n\nã ã¨æ€ã„ã¾ã™ã€‚ï¼ˆå¤šåˆ†ï¼‰\n\n```kotlin\n/** ãƒãƒ³ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚5Gå¯¾å¿œç‰ˆ */\nprivate fun getNRBand(arfcn: Int): Int {\n    /**\n     * https://www.etsi.org/deliver/etsi_ts/138100_138199/13810101/15.08.02_60/ts_13810101v150802p.pdf\n     *\n     * 30ãƒšãƒ¼ã‚¸ç›®ã€ã€ŒTable 5.4.2.3-1: Applicable NR-ARFCN per operating bandã€å‚ç…§\n     * */\n    val bandList = listOf(\n            BandData(1, 422000, 434000),\n            BandData(2, 386000, 398000),\n            BandData(3, 361000, 376000),\n            BandData(5, 173800, 178800),\n            BandData(7, 524000, 538000),\n            BandData(8, 185000, 192000),\n            BandData(20, 158200, 164200),\n            BandData(28, 151600, 160600),\n            BandData(38, 514000, 524000),\n            BandData(41, 499200, 537999),\n            BandData(50, 286400, 303400),\n            BandData(51, 285400, 286400),\n            BandData(66, 422000, 440000),\n            BandData(70, 399000, 404000),\n            BandData(71, 123400, 130400),\n            BandData(74, 295000, 303600),\n            BandData(75, 286400, 303400),\n            BandData(76, 285400, 286400),\n            BandData(77, 620000, 680000),\n            BandData(78, 620000, 653333),\n            BandData(79, 693334, 733333),\n            // 5G ãƒŸãƒªæ³¢\n            BandData(257, 2054166, 2104165),\n            BandData(258, 2016667, 2070832),\n            BandData(260, 2229166, 2279165),\n            BandData(261, 2070833, 2084999),\n    )\n    // æ¢ã™\n    return bandList.find { bandData -> arfcn in bandData.nDlMin..bandData.nDlMax }?.bandNumber ?: 0\n}\n```\n\n```kotlin\n/** æ¥ç¶šã—ã¦ã„ã‚‹ãƒãƒ³ãƒ‰ã‚’TextViewã«å…¥ã‚Œã‚‹ */\nprivate fun setBandToTextView() {\n    getEarfcn { cellInfo ->\n        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.R) {\n            when (cellInfo) {\n                is CellInfoLte -> {\n                    // 4G / LTE\n                    val band = getBand(cellInfo.cellIdentity.earfcn)\n                    viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${band}\"\n                }\n                is CellInfoNr -> {\n                    // 5G NR\n                    val band = getNRBand((cellInfo.cellIdentity as CellIdentityNr).nrarfcn)\n                    viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼šn${band}\"\n                }\n            }\n        } else {\n            when (cellInfo) {\n                is CellInfoLte -> {\n                    // 4G / LTE\n                    val band = getBand(cellInfo.cellIdentity.earfcn)\n                    viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${band}\"\n                }\n            }\n        }\n    }\n}\n```\n\nä½œã£ãŸã®ã¯ã„ã„ã‘ã©5Gã‚¨ãƒªã‚¢ã«è¡Œã‹ãªã„ã¨ã‚ã£ã¦ã‚‹ã‹ã©ã†ã‹ã‚ã‹ã‚‰ãªã„ã€‚\n\n# å…¨éƒ¨ãã£ã¤ã‘ã¦\n\n```kotlin\nclass MainActivity : AppCompatActivity() {\n\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\n\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\n        if (isGranted) {\n            // æ¨©é™ã‚‚ã‚‰ãˆãŸ\n            setBandToTextView()\n        }\n    }\n\n    override fun onCreate(savedInstanceState: Bundle?) {\n        super.onCreate(savedInstanceState)\n        setContentView(viewBinding.root)\n\n        start()\n\n        viewBinding.activityMainButton.setOnClickListener {\n            start()\n        }\n\n    }\n\n    /** æ¨©é™ãŒã‚ã‚Œã°è¨ˆæ¸¬ã€ãªã‘ã‚Œã°æ¨©é™ã‚’ã‚‚ã‚‰ã† */\n    private fun start() {\n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n            // æ¨©é™ã‚ã‚Š\n            setBandToTextView()\n        } else {\n            // æ¨©é™ãªã—ã€‚è²°ã„ã«è¡Œã\n            permissionCallBack.launch(Manifest.permission.ACCESS_FINE_LOCATION)\n        }\n    }\n\n    /** æ¥ç¶šã—ã¦ã„ã‚‹ãƒãƒ³ãƒ‰ã‚’TextViewã«å…¥ã‚Œã‚‹ */\n    private fun setBandToTextView() {\n        getEarfcn { cellInfo ->\n            if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.R) {\n                when (cellInfo) {\n                    is CellInfoLte -> {\n                        // 4G / LTE\n                        val band = getBand(cellInfo.cellIdentity.earfcn)\n                        viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${band}\"\n                    }\n                    is CellInfoNr -> {\n                        // 5G NR\n                        val band = getNRBand((cellInfo.cellIdentity as CellIdentityNr).nrarfcn)\n                        viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼šn${band}\"\n                    }\n                }\n            } else {\n                when (cellInfo) {\n                    is CellInfoLte -> {\n                        // 4G / LTE\n                        val band = getBand(cellInfo.cellIdentity.earfcn)\n                        viewBinding.activityMainTextView.text = \"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${band}\"\n                    }\n                }\n            }\n        }\n    }\n\n    /** TextViewã«ãƒãƒ³ãƒ‰ã‚’è¡¨ç¤ºã•ã›ã‚‹ã€‚ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å½¢å¼ã«ãªã‚Šã¾ã™ */\n    private fun getEarfcn(result: (CellInfo) -> Unit) {\n        val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\n        if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {\n            // Android 10ä»¥é™\n            if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\n                telephonyManager.requestCellInfoUpdate(mainExecutor, object : TelephonyManager.CellInfoCallback() {\n                    override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\n                        result.invoke(cellInfo[0])\n                    }\n                })\n            }\n        } else {\n            // Android 9ä»¥å‰\n            result.invoke(telephonyManager.allCellInfo[0])\n        }\n    }\n\n    /** EARFCNã‹ã‚‰ãƒãƒ³ãƒ‰ã‚’å‰²ã‚Šå‡ºã™ */\n    private fun getBand(earfcn: Int): Int {\n        /**\n         * https://www.arib.or.jp/english/html/overview/doc/STD-T104v2_10/5_Appendix/Rel11/36/36101-b50.pdf\n         *\n         * 33ãƒšãƒ¼ã‚¸ç›®ã€ã€ŒTable 5.7.3-1: E-UTRA channel numbersã€å‚ç…§\n         * */\n        val bandList = listOf(\n                BandData(1, 0, 599),\n                BandData(2, 600, 1199),\n                BandData(3, 1200, 1949),\n                BandData(4, 1950, 2399),\n                BandData(5, 2400, 2649),\n                BandData(6, 2650, 2749),\n                BandData(7, 2750, 3449),\n                BandData(8, 3450, 3799),\n                BandData(9, 3800, 4149),\n                BandData(10, 4150, 4749),\n                BandData(11, 4750, 4949),\n                BandData(12, 5010, 5179),\n                BandData(13, 5180, 5279),\n                BandData(14, 5280, 5279),\n                BandData(17, 5730, 5849),\n                BandData(18, 5850, 5999),\n                BandData(19, 6000, 6149),\n                BandData(20, 6150, 6449),\n                BandData(21, 6450, 6599),\n                BandData(22, 6600, 7399),\n                BandData(23, 7500, 7699),\n                BandData(24, 7700, 8039),\n                BandData(25, 8040, 8689),\n                BandData(26, 8690, 9039),\n                BandData(27, 9040, 9209),\n                BandData(28, 9210, 9659),\n                BandData(29, 9660, 9769),\n                BandData(30, 9770, 9869),\n                BandData(31, 9870, 9919),\n                BandData(32, 9920, 10359),\n                BandData(65, 65536, 66435),\n                BandData(66, 66436, 67335),\n                BandData(67, 67336, 67535),\n                BandData(68, 67536, 67835),\n                BandData(69, 67836, 68335),\n                BandData(70, 68336, 68585),\n                BandData(71, 68586, 68935),\n        )\n        // æ¢ã™\n        return bandList.find { bandData -> earfcn in bandData.nDlMin..bandData.nDlMax }?.bandNumber ?: 0\n    }\n\n    /** ãƒãƒ³ãƒ‰ã‚’å–å¾—ã™ã‚‹ã€‚5Gå¯¾å¿œç‰ˆ */\n    private fun getNRBand(arfcn: Int): Int {\n        val bandList = listOf(\n                BandData(1, 422000, 434000),\n                BandData(2, 386000, 398000),\n                BandData(3, 361000, 376000),\n                BandData(5, 173800, 178800),\n                BandData(7, 524000, 538000),\n                BandData(8, 185000, 192000),\n                BandData(20, 158200, 164200),\n                BandData(28, 151600, 160600),\n                BandData(38, 514000, 524000),\n                BandData(41, 499200, 537999),\n                BandData(50, 286400, 303400),\n                BandData(51, 285400, 286400),\n                BandData(66, 422000, 440000),\n                BandData(70, 399000, 404000),\n                BandData(71, 123400, 130400),\n                BandData(74, 295000, 303600),\n                BandData(75, 286400, 303400),\n                BandData(76, 285400, 286400),\n                BandData(77, 620000, 680000),\n                BandData(78, 620000, 653333),\n                BandData(79, 693334, 733333),\n                // 5G ãƒŸãƒªæ³¢\n                BandData(257, 2054166, 2104165),\n                BandData(258, 2016667, 2070832),\n                BandData(260, 2229166, 2279165),\n                BandData(261, 2070833, 2084999),\n        )\n        // æ¢ã™\n        return bandList.find { bandData -> arfcn in bandData.nDlMin..bandData.nDlMax }?.bandNumber ?: 0\n    }\n\n    /**\n     * ãƒãƒ³ãƒ‰ã®è¡¨ãƒ‡ãƒ¼ã‚¿\n     * @param bandNumber ãƒãƒ³ãƒ‰ã®ç•ªå·\n     * @param nDlMin Earfcnã“ã“ã‹ã‚‰\n     * @param nDlMax Earfcnã“ã“ã¾ã§\n     * */\n    data class BandData(val bandNumber: Int, val nDlMin: Int, val nDlMax: Int)\n\n}\n```\n\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\n\nhttps://github.com/takusan23/ConnectionBand\n\n# çµ‚ã‚ã‚Šã«\nä¼‘æ—¥çµ‚ã‚ã‚‹ã®æ—©ã™ãã€‚  \nã‚ã¨æ©Ÿå†…ãƒ¢ãƒ¼ãƒ‰ãƒãƒãƒãƒã—ã¦ãŸã‚‰å®¶ã§ã‚‚æ¥½å¤©å›ç·šæ´ã‚€ã‚ˆã†ã«ãªã£ã¦ãŸã€‚ã†ã‚Œã—ã„\n\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">æ©Ÿå†…ãƒ¢ãƒ¼ãƒ‰ã½ã¡ã½ã¡ã—ã¦ãŸã‚‰æ¥½å¤©ã®è‡ªç¤¾å›ç·šæ´ã‚“ã  <a href=\"https://t.co/GPq60McH5o\">pic.twitter.com/GPq60McH5o</a></p>&mdash; ãŸãã•ã‚“ (@takusan__23) <a href=\"https://twitter.com/takusan__23/status/1381290674478145537?ref_src=twsrc%5Etfw\">April 11, 2021</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\n\n[^1]:é›»æ³¢æ¸¬å®šã®ç•¥ã‚‰ã—ã„"},{"title":"Android10ä»¥é™ã§ã‚‚ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹","link":"/posts/android_mobile_data_usage_api/","markdown":"\r\n20GBã¾ã§ã®ãƒ—ãƒ©ãƒ³ãŒMNO4ç¤¾ã¨ã‚‚å‡ºæƒã„ã¾ã—ãŸã­ã€‚MNOã®å‰²ã«å®‰ã„\r\n\r\n# æœ¬é¡Œ\r\nAndroidã§é€šä¿¡é‡ã‚’å–å¾—ã—ãŸã„ã€‚\r\n\r\n## AOSPã®é€šä¿¡é‡ã‚’è¡¨ç¤ºã™ã‚‹è¨­å®šé …ç›®ã‚’è¦‹ã¦ã¿ã‚‹\r\n\r\nèˆˆå‘³ãªã‘ã‚Œã°[#ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰](#ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰)ã¾ã§é£›ã°ã—ã¦ã‚‚ã„ã„ã‚ˆã€‚èª­ã‚“ã§ã‚‚ã„ã„ã‘ã©\r\n\r\nAndroidã®è¨­å®šã‚¢ãƒ—ãƒªã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è¿½ã„ã‹ã‘ã¦ã€é€šä¿¡é‡ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹éƒ¨åˆ†ã‚’è¦‹ã¤ã‘ã¾ã™ã€‚\r\n\r\nAOSPãƒŸãƒ©ãƒ¼GitHubï¼šhttps://github.com/aosp-mirror/platform_packages_apps_settings\r\n\r\n## ã©ã“ã«ã‚ã‚‹ã®ï¼Ÿ\r\næ—¥æœ¬èªã®ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºã§ä½¿ã†`string.xml`ã‚’é–‹ã„ã¦ã€ãã“ã‹ã‚‰ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹è¨­å®šã§ä½¿ã£ã¦ã‚‹æ–‡å­—åˆ—ã‚’æ¢ã™ã€‚  \r\nè¦‹ã¤ã‘ãŸã‚‰ãã®nameå±æ€§ã®å€¤ã‚’ä½¿ã£ã¦æ¤œç´¢ã‚’ã‹ã‘ã‚Œã°è¦‹ã¤ã‘ã‚‰ã‚Œã‚‹ã¨æ€ã†ã€‚\r\n\r\nã¨ã‚Šã‚ãˆãšãã‚Œã£ã½ã„ã®ã‚’è¦‹ã¤ã‘ãŸã®ã§ã“ã‚Œã§æ¤œç´¢ã‚’ã‹ã‘ã‚‹\r\n\r\n```xml\r\n<string name=\"cell_data_warning\" msgid=\"5664921950473359634\">\"è­¦å‘Šã™ã‚‹ãƒ‡ãƒ¼ã‚¿ä½¿ç”¨é‡: <xliff:g id=\"ID_1\">^1</xliff:g>\"</string>\r\n````\r\n\r\nã“ã‚Œã§æ¤œç´¢ã‚’ã‹ã‘ã‚‹ã¨ã€`DataUsageSummaryPreferenceController.java`ã£ã¦ã®ã«ãŸã©ã‚Šç€ãã¾ã™\r\n\r\nãã—ãŸã‚‰ã€ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã«é–¢ä¿‚ã—ã¦ãã†ãªéƒ¨åˆ†ã‚’æ¢ã—ã¾ã™ã€‚ã“ã“ã¨ã‹ã©ã†ã§ã—ã‚‡ã†ï¼Ÿ\r\n\r\n```java\r\nsummaryPreference.setUsageNumbers(displayUsageLevel(usageLevel),\r\n/* dataPlanSize */ -1L,\r\n/* hasMobileData */ true);\r\n```\r\n\r\n`usageLevel`ã£ã¦ã®ã¯ã©ã“ã‹ã‚‰æ¥ã¦ã‚‹ã‹ã¨ã„ã†ã¨ã€\r\n\r\n```java\r\nmDataUsageController = new DataUsageController(context);\r\n\r\n// çœç•¥\r\n\r\nfinal DataUsageController.DataUsageInfo info =\r\nmDataUsageController.getDataUsageInfo(mDefaultTemplate);\r\nlong usageLevel = info.usageLevel;\r\n```\r\n\r\n`DataUsageController`ã£ã¦ã®ã‹ã‚‰å–å¾—ã—ã¦ã„ã‚‹ãã†ã§ã™ã®ã§ã€`DataUsageController`ã‚’æ¢ã—ã¾ã™ã€‚\r\n\r\nã¨ã“ã‚ãŒã€`DataUsageController`ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚   \r\nã—ã‚ƒãƒ¼ãªã„ã®ã§Googleã§æ¤œç´¢ã‚’ã™ã‚‹ã¨`platform_frameworks_base/blob/master/packages/SettingsLib/src/com/android/settingslib/net/DataUsageController.java`ã ãã†ã§ã™ã€‚\r\n\r\n`DataUsageController.java`ã‚’é–‹ãã€`getDataUsageInfo()`ã‚’æ¢ã—ã¾ã™ã€‚ã‚ã‚Šã¾ã—ãŸã€‚ã‚‚ã†ã‚´ãƒ¼ãƒ«ã¯è¿‘ã„\r\n\r\n```java\r\npublic DataUsageInfo getDataUsageInfo(NetworkTemplate template) {\r\n    // çœç•¥\r\n    final long totalBytes = getUsageLevel(template, start, end);\r\n    // çœç•¥\r\n}\r\n```\r\n\r\n`DataUsageController#getUsageLevel`ã‚’è¦‹ã¾ã™  \r\n\r\n```java\r\nfinal Bucket bucket = mNetworkStatsManager.querySummaryForDevice(template, start, end);\r\nif (bucket != null) {\r\n    return bucket.getRxBytes() + bucket.getTxBytes();\r\n}\r\n```\r\n\r\nã“ã“ã§ä½¿ã£ã¦ã„ã‚‹`querySummaryForDevice`ã¯ã€`@hide`ã•ã‚Œã¦ã„ã‚‹ã®ã§ä½¿ãˆã¾ã›ã‚“ãŒã€`@hide`ã®ã¤ã„ã¦ã„ãªã„`querySummaryForDevice`ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚\r\n\r\n# ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰\r\n`ã‚¯ãƒ©ã‚¹å#ãƒ¡ã‚½ãƒƒãƒ‰å`ã¿ãŸã„ã«`#`ã§åŒºåˆ‡ã‚‹æ›¸ãæ–¹ãŒã‚ã£ã¦ã‚‹ã®ã‹ã©ã†ã‹ã¯çŸ¥ã‚‰ãªã„ [^1]\r\n```\r\nNetworkStatsManager#querySummaryForDevice(\r\n    int networkType, \r\n    String subscriberId, \r\n    long startTime, \r\n    long endTime\r\n)\r\n```\r\nã“ã“ã§æ‚²å ±ã§ã™ã€‚`subscriberId`ã¯Android 10ã‹ã‚‰ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ã‚¢ãƒ—ãƒªã§ã¯å–ã‚Œã¾ã›ã‚“ã€‚\r\n\r\nã—ã‹ã—ã€ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹ã‚’èª­ã‚“ã§ã¿ã‚‹ã¨\r\n\r\n|parameters|description|\r\n|---|---|\r\n|subscriberId|æ–‡å­—åˆ—ã€‚è©²å½“ã™ã‚‹å ´åˆã¯ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ãƒ»ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ã‚¤ã‚¹ã®ã‚µãƒ–ã‚¹ã‚¯ãƒ©ã‚¤ãƒ IDã€‚API ãƒ¬ãƒ™ãƒ« 29 ä»¥é™ã€subscriberId ã¯è¿½åŠ ã®åˆ¶é™ã«ã‚ˆã£ã¦ä¿è­·ã•ã‚Œã¾ã™ã€‚subscriberId ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã®æ–°ã—ã„è¦ä»¶ã‚’æº€ãŸã—ã¦ã„ãªã„ã‚¢ãƒ—ãƒªã‚’å‘¼ã³å‡ºã™ã¨ã€ã™ã¹ã¦ã®ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ä½¿ç”¨çŠ¶æ³ã‚’å—ä¿¡ã™ã‚‹ãŸã‚ã«ã€ãƒ¢ãƒã‚¤ãƒ«ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®ç¨®é¡ã‚’ç…§ä¼šã™ã‚‹éš›ã« NULL å€¤ã‚’æä¾›ã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ç´°ã«ã¤ã„ã¦ã¯ã€TelephonyManager#getSubscriberId() ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚ï¼ˆDeeplç¿»è¨³ï¼šhttps://www.deepl.com/translatorï¼‰|\r\n\r\n`null`ã‚’æ¸¡ã›ã°ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã§ãã‚‹ã£ã½ã„ã€‚  \r\nã§ã‚‚è¤‡æ•°SIMãŒåˆºã•ã£ã¦ãŸã‚‰ã©ã†ãªã‚‹ã‚“ã ã‚ã†ã­ï¼Ÿ\r\n\r\n# ä½œã‚‹\r\n\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|Android|11|\r\n|å®Ÿæ©Ÿ|Pixel 3 XL|\r\n|minSdkVersion|23|\r\n\r\n## activity_main.xml\r\n\r\næœ€åˆã‹ã‚‰ç½®ã„ã¦ã‚ã‚‹TextViewã«IDã‚’æŒ¯ã£ã¦ãŠã„ã¦ãã ã•ã„ã€‚é©å½“ã«`activity_main_text_view`ã¨ã§ã‚‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <TextView\r\n        android:id=\"@+id/activity_main_text_view\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"Hello World!\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintLeft_toLeftOf=\"parent\"\r\n        app:layout_constraintRight_toRightOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n## AndroidManifest.xml\r\n\r\nã€Œ`PACKAGE_USAGE_STATS`ã€æ¨©é™ãŒå¿…è¦ã§ã™ã€‚ã—ã‹ã‚‚ãƒ€ã‚¤ã‚¢ãƒ­ã‚°å½¢å¼ã§ã¯ãªã„ã€è¨­å®šç”»é¢ã«èª˜å°ã™ã‚‹ã‚¿ã‚¤ãƒ—ã®ã‚„ã¤ã§ã™ã€‚  \r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    package=\"io.github.takusan23.mobiledatausage\">\r\n\r\n    <!-- ä½¿ç”¨çŠ¶æ³ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ æ¨©é™ -->\r\n    <uses-permission android:name=\"android.permission.PACKAGE_USAGE_STATS\"/>\r\n\r\n    <application\r\n        android:allowBackup=\"true\"\r\n        android:icon=\"@mipmap/ic_launcher\"\r\n        android:label=\"@string/app_name\"\r\n        android:roundIcon=\"@mipmap/ic_launcher_round\"\r\n        android:supportsRtl=\"true\"\r\n        android:theme=\"@style/Theme.MobileDataUsage\">\r\n        <activity android:name=\".MainActivity\">\r\n            <intent-filter>\r\n                <action android:name=\"android.intent.action.MAIN\" />\r\n\r\n                <category android:name=\"android.intent.category.LAUNCHER\" />\r\n            </intent-filter>\r\n        </activity>\r\n    </application>\r\n\r\n</manifest>\r\n```\r\n\r\n## MainActivity.kt\r\n### æ¨©é™ã‚’ç¢ºèªã€ã‚‚ã‚‰ã†ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã\r\næ¨©é™ã®ç¢ºèªã‚‚ã„ã¤ã‚‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒä½¿ãˆãªã„ã®ã§ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nå‚è€ƒï¼šhttps://stackoverflow.com/questions/28921136/how-to-check-if-android-permission-package-usage-stats-permission-is-given\r\n\r\n```kotlin\r\n/**\r\n * PACKAGE_USAGE_STATSã®æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹\r\n * @return æ¨©é™ãŒã‚ã‚Œã°true\r\n * */\r\nfun checkUsageStatsPermission(): Boolean {\r\n    val appOpsManager = getSystemService(APP_OPS_SERVICE) as AppOpsManager\r\n    val mode = if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {\r\n        // Android 10 ä»¥é™\r\n        appOpsManager.unsafeCheckOpNoThrow(AppOpsManager.OPSTR_GET_USAGE_STATS, Process.myUid(), application.packageName)\r\n    } else {\r\n        // Android 9 ä»¥å‰\r\n        appOpsManager.checkOpNoThrow(AppOpsManager.OPSTR_GET_USAGE_STATS, Process.myUid(), application.packageName)\r\n    }\r\n    return mode == AppOpsManager.MODE_ALLOWED\r\n}\r\n```\r\n\r\nã“ã‚Œã‚’ä½¿ã£ã¦ã€æ¨©é™ãŒãªã‘ã‚Œã°å–å¾—ã™ã‚‹ç”»é¢ã¸é£›ã°ã™ã‚ˆã†ã«ã—ã¾ã™\r\n\r\n```kotlin\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n    setContentView(R.layout.activity_main)\r\n    if (checkUsageStatsPermission()) {\r\n        // æ¨©é™ãŒã‚ã‚‹\r\n    } else {\r\n        // ãªã„\r\n        startActivity(Intent(Settings.ACTION_USAGE_ACCESS_SETTINGS))\r\n    }\r\n}\r\n```\r\n\r\n## ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹\r\nã¨ã‚Šã‚ãˆãšä»Šæœˆã®åˆ©ç”¨åˆ†ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã‚’æ›¸ã„ã¦ã¿ã‚‹\r\n\r\n```kotlin\r\n/**\r\n * ä»Šæœˆã®ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹ã€‚å˜ä½ã¯ãƒã‚¤ãƒˆ\r\n * @return ãƒã‚¤ãƒˆå˜ä½ã§è¿”ã™\r\n * */\r\nfun getMobileDataUsageFromCurrentMonth(): Long {\r\n    val networkStatsManager = getSystemService(Context.NETWORK_STATS_SERVICE) as NetworkStatsManager\r\n    // é›†è¨ˆé–‹å§‹ã®æ—¥ä»˜ãã®æœˆã®æœ€åˆã®æ—¥\r\n    val startTime = Calendar.getInstance().apply {\r\n        set(Calendar.DAY_OF_MONTH, 1)\r\n        set(Calendar.HOUR_OF_DAY, 0)\r\n        set(Calendar.MINUTE, 0)\r\n        set(Calendar.SECOND, 0)\r\n    }.time.time\r\n    // é›†è¨ˆçµ‚äº†ã¯ç¾åœ¨æ™‚åˆ»\r\n    val endTime = Calendar.getInstance().time.time\r\n    // å•ã„åˆã‚ã›ã‚‹\r\n    val bucket = networkStatsManager.querySummaryForDevice(ConnectivityManager.TYPE_MOBILE, null, startTime, endTime)\r\n    // é€ä¿¡ + å—ä¿¡\r\n    return bucket.txBytes + bucket.rxBytes\r\n}\r\n```\r\n\r\næœ€å¾Œã«TextViewã«å…¥ã‚Œã‚‹ã‚ˆã†ã«ã—ã¦å®Œæˆ\r\n\r\n```kotlin\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n    setContentView(R.layout.activity_main)\r\n    // findViewByIdã‚ˆã‚ŠViewBindingã‚’ä½¿ã£ãŸã»ã†ãŒã„ã„\r\n    val textView = findViewById<TextView>(R.id.activity_main_text_view)\r\n    if (checkUsageStatsPermission()) {\r\n        // æ¨©é™ãŒã‚ã‚‹\r\n        val byte = getMobileDataUsageFromCurrentMonth()\r\n        // MBã¸å¤‰æ›\r\n        val usageMB = byte / 1024f / 1024f\r\n        // TextViewã«å…¥ã‚Œã‚‹\r\n        textView.text = \"$usageMB MB\"\r\n    } else {\r\n        // ãªã„\r\n        startActivity(Intent(Settings.ACTION_USAGE_ACCESS_SETTINGS))\r\n    }\r\n}\r\n```\r\n\r\n# çµæœ\r\nå¤šåˆ†ã‚ã£ã¦ã‚‹ï¼ˆAOSPè¦‹ã¦ä½œã£ãŸã‚“ã ã‹ã‚‰ãã‚Šã‚ƒãã†ã ã‚ï¼‰\r\n\r\n![Imgur](https://imgur.com/V6gKPaz.png)\r\n\r\n# å…¨éƒ¨ãã£ã¤ã‘ãŸã‚³ãƒ¼ãƒ‰\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        // findViewByIdã‚ˆã‚ŠViewBindingã‚’ä½¿ã£ãŸã»ã†ãŒã„ã„\r\n        val textView = findViewById<TextView>(R.id.activity_main_text_view)\r\n\r\n        if (checkUsageStatsPermission()) {\r\n            // æ¨©é™ãŒã‚ã‚‹\r\n            val byte = getMobileDataUsageFromCurrentMonth()\r\n            // MBã¸å¤‰æ›ã€‚Byte -> KB -> MB\r\n            val usageMB = byte / 1024f / 1024f\r\n            // TextViewã«å…¥ã‚Œã‚‹\r\n            textView.text = \"$usageMB MB\"\r\n        } else {\r\n            // ãªã„\r\n            startActivity(Intent(Settings.ACTION_USAGE_ACCESS_SETTINGS))\r\n        }\r\n\r\n    }\r\n\r\n    /**\r\n     * PACKAGE_USAGE_STATSã®æ¨©é™ãŒä»˜ä¸ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹\r\n     * @return æ¨©é™ãŒã‚ã‚Œã°true\r\n     * */\r\n    fun checkUsageStatsPermission(): Boolean {\r\n        val appOpsManager = getSystemService(APP_OPS_SERVICE) as AppOpsManager\r\n        val mode = if (android.os.Build.VERSION.SDK_INT >= android.os.Build.VERSION_CODES.Q) {\r\n            // Android 10 ä»¥é™\r\n            appOpsManager.unsafeCheckOpNoThrow(AppOpsManager.OPSTR_GET_USAGE_STATS, Process.myUid(), application.packageName)\r\n        } else {\r\n            // Android 9 ä»¥å‰\r\n            appOpsManager.checkOpNoThrow(AppOpsManager.OPSTR_GET_USAGE_STATS, Process.myUid(), application.packageName)\r\n        }\r\n        return mode == AppOpsManager.MODE_ALLOWED\r\n    }\r\n\r\n    /**\r\n     * ä»Šæœˆã®ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿åˆ©ç”¨é‡ã‚’å–å¾—ã™ã‚‹ã€‚å˜ä½ã¯ãƒã‚¤ãƒˆ\r\n     * @return ãƒã‚¤ãƒˆå˜ä½ã§è¿”ã™\r\n     * */\r\n    fun getMobileDataUsageFromCurrentMonth(): Long {\r\n        val networkStatsManager = getSystemService(Context.NETWORK_STATS_SERVICE) as NetworkStatsManager\r\n        // é›†è¨ˆé–‹å§‹ã®æ—¥ä»˜ãã®æœˆã®æœ€åˆã®æ—¥\r\n        val startTime = Calendar.getInstance().apply {\r\n            set(Calendar.DAY_OF_MONTH, 1)\r\n            set(Calendar.HOUR_OF_DAY, 0)\r\n            set(Calendar.MINUTE, 0)\r\n            set(Calendar.SECOND, 0)\r\n        }.time.time\r\n        // é›†è¨ˆçµ‚äº†ã¯ç¾åœ¨æ™‚åˆ»\r\n        val endTime = Calendar.getInstance().time.time\r\n        // å•ã„åˆã‚ã›ã‚‹\r\n        val bucket = networkStatsManager.querySummaryForDevice(ConnectivityManager.TYPE_MOBILE, null, startTime, endTime)\r\n        // é€ä¿¡ + å—ä¿¡\r\n        return bucket.txBytes + bucket.rxBytes\r\n    }\r\n\r\n}\r\n```\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™ã€‚  \r\nhttps://github.com/takusan23/MobileDataUsage\r\n\r\nAOSPã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰èª­ã‚€ã¨ã“ã‚ã„ã‚‰ã‚“ã‹ã£ãŸæ°—ãŒã™ã‚‹\r\n\r\n\r\n[^1]: ã€Œjava class method hash tag symbolã€ã¨ã‹ã§æ¤œç´¢æ¤œç´¢ï¼"},{"title":"Androidã®NavigationViewã£ã¦ä¾¿åˆ©ã˜ã‚ƒã­ã£ã¦è©±ã€‚ä¸‹ã‹ã‚‰å‡ºã¦ãã‚‹ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ä½œã‚Šæ–¹","link":"/posts/android_navigation_view/","markdown":"\r\nä»Šã¾ã§`TextView`ä¸¦ã¹ã¦ãŸã®ãŒï½‚ï½‹ã¿ãŸã„ã ã‚  \r\nãã‚“ãªã“ã¨ã‚ˆã‚Š7æœˆã§ã™ã­ã€‚\r\n\r\n# æœ¬é¡Œ\r\nã“ã†ã„ã†ã®ã‚’ä½œã‚Šã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/u1b56Rr.png)\r\n\r\n# ç’°å¢ƒ\r\n| ãªã¾ãˆ  | ã‚ãŸã„                            |\r\n|---------|-----------------------------------|\r\n| Android | 11 Beta 1 (5ä»¥é™ãªã‚‰å‹•ãã¯ãšã§ã™) |\r\n| è¨€èª    | Kotlin                            |\r\n\r\n# ãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹\r\n\r\n`appãƒ•ã‚©ãƒ«ãƒ€`ã®æ–¹ã«ã‚ã‚‹`build.gradle`ã‚’é–‹ãã¾ã™ã€‚  \r\né–‹ã„ãŸã‚‰ã€`dependencies`ã«è¿½è¨˜ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    // Material Design\r\n    implementation 'com.google.android.material:material:1.3.0-alpha01'\r\n    // çœç•¥\r\n}\r\n```\r\n\r\nã‚ã¨å¤šåˆ†é–¢ä¿‚ãªã„ã‘ã©ã€Java 8ã‚’ä½¿ã†ã‚ˆã†ã«ã—ã¦ãŠãã¨ä»Šå¾Œå¹¸ã›ã«ãªã‚Œã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\n```gradle\r\nandroid {\r\n    compileSdkVersion 30\r\n    buildToolsVersion \"30.0.0\"\r\n    // çœç•¥\r\n    compileOptions {\r\n        sourceCompatibility = 1.8\r\n        targetCompatibility = 1.8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = \"1.8\"\r\n    }\r\n}\r\n```\r\n\r\n# styles.xml ã‚’æ›¸ãæ›ãˆã‚‹\r\nã“ã‚Œã—ãªã„ã¨ **ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æŠ¼ã—ãŸã¨ãã®èƒŒæ™¯** ãŒã¡ã‚ƒã‚“ã¨åæ˜ ã•ã‚Œãªã„ã¨æ€ã„ã¾ã™ã€‚  \r\nã¨ã„ã£ã¦ã‚‚`parent`ã‚’`Theme.MaterialComponents.Light.DarkActionBar`ã«å¤‰æ›´ã™ã‚‹ã ã‘ã§ã™ã€‚é›£ã—ããªã„\r\n\r\n```xml\r\n<resources>\r\n    <!-- Base application theme. -->\r\n    <style name=\"AppTheme\" parent=\"Theme.MaterialComponents.Light.DarkActionBar\">\r\n        <!-- Customize your theme here. -->\r\n        <item name=\"colorPrimary\">@color/colorPrimary</item>\r\n        <item name=\"colorPrimaryDark\">@color/colorPrimaryDark</item>\r\n        <item name=\"colorAccent\">@color/colorAccent</item>\r\n    </style>\r\n\r\n</resources>\r\n```\r\n\r\n# ãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½œæˆ\r\n## menuãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã\r\n\r\n`res`ã®ä¸­ã«`menu`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚Šã¾ã™ã€‚  \r\nã§ããŸã‚‰ã€`bottom_fragment_menu.xml`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ãã¾ã™ã€‚\r\n\r\n## ã‚¢ã‚¤ã‚³ãƒ³ã‚’å–ã£ã¦ãã‚‹\r\nAndroid Studio 4.0 ã‹ã‚‰ã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸ã¶éš›ã«ã€Outlinedãªã‚¢ã‚¤ã‚³ãƒ³ãŒé¸æŠå¯èƒ½ã«ãªã‚Šã¾ã—ãŸã€‚ãŸã™ã‹ã‚‹  \r\n`Vector Asset`ã‚’é–‹ã„ã¦ã€å¥½ããªã‚¢ã‚¤ã‚³ãƒ³ã‚’å–ã£ã¦ãã¦ãã ã•ã„ã€‚  \r\nèµ·å‹•æ–¹æ³•ã¯ã€`Shiftã‚­ãƒ¼ã‚’3é€£ç¶š`æŠ¼ã—ã¦`Vector Asset`ã£ã¦å…¥åŠ›ã™ã‚Œã°å¤šåˆ†å‡ºã‚‹ã¨æ€ã„ã¾ã™ã€‚`macOSã®Spotlightçš„ãªãªã«ã‹ï¼ˆmacOSè§¦ã£ãŸã“ã¨ç„¡ã„ã‘ã©ï¼‰`\r\n\r\n![Imgur](https://imgur.com/EIxL4JP.png)\r\n\r\n## bottom_fragment_menu.xml ã‚’æ›¸ã\r\nä»¥ä¸‹ã®ã‚ˆã†ã«ã€‚  \r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<menu xmlns:android=\"http://schemas.android.com/apk/res/android\">\r\n    <group android:checkableBehavior=\"single\">\r\n        <item\r\n            android:id=\"@+id/nav_menu_java\"\r\n            android:icon=\"@drawable/ic_outline_settings_24\"\r\n            android:title=\"Java\" />\r\n        <item\r\n            android:id=\"@+id/nav_menu_kotlin\"\r\n            android:icon=\"@drawable/ic_outline_settings_24\"\r\n            android:title=\"Kotlin\" />\r\n        <item\r\n            android:id=\"@+id/nav_menu_js\"\r\n            android:icon=\"@drawable/ic_outline_settings_24\"\r\n            android:title=\"JS\" />\r\n    </group>\r\n</menu>\r\n```\r\n\r\n# MainActivity\r\n## activity_main.xml\r\nãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ›¸ãæ›ãˆã¾ã™ã€‚ãƒœã‚¿ãƒ³ä¸€å€‹ç½®ãã ã‘ãªã®ã§`ConstraintLayout`ã‚’ãã®ã¾ã¾ä½¿ãŠã†ã¨æ€ã„ã¾ã™ã€‚  \r\nã„ã¤ã‹ã¯ã¡ã‚ƒã‚“ã¨`ConstraintLayout`ã§ãã‚‹ã‚ˆã†ã«ã—ã¦**MotionLayoutã®åˆã‚æ–¹**ã¿ãŸã„ãªè¨˜äº‹ã‚’æ›¸ããŸã„ã€‚  \r\nã¡ãªã¿ã«ç¾çŠ¶`MotionLayout`ä½¿ã†ã¨`RecyclerView`ã®ã‚¯ãƒªãƒƒã‚¯ãŒè¡Œã‹ãªã„ï¼ˆãŸã¾ã«ã‚ˆãã‚¯ãƒªãƒƒã‚¯ãŒåå¿œã—ãªããªã‚‹ï¼‰ã®ã§ã‚‚ã†å°‘ã—æ§˜å­è¦‹ã—ãŸã»ã†ãŒè‰¯ã„ã€‚\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <Button\r\n        android:id=\"@+id/activity_main_bottom_menu\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"BottomMenu\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintLeft_toLeftOf=\"parent\"\r\n        app:layout_constraintRight_toRightOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n## MainActivity.kt\r\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’é–‹ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n        // BottomFragmenté–‹ã\r\n        activity_main_bottom_menu.setOnClickListener {\r\n            MenuBottomFragment().show(supportFragmentManager, \"menu\")\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`MenuBottomFragment`ãŒèµ¤ããªã‚‹ã®ã§ã“ã‚Œã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\r\n\r\n# MenuBottomFragment.kt\r\nã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nã‚ˆãã‚ã‹ã‚‰ã‚“äººã¯`MainActivity.kt`ã®ã‚ã‚‹å ´æ‰€ã«`MenuBottomFragment.kt`ã‚’ä½œã‚Œã°ã„ã„ã§ã™ã€‚\r\n\r\n## bottom_fragment_menu.xml\r\n`res/layout`ã®ä¸­ã«`bottom_fragment_menu.xml`ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚  \r\nä¸­èº«ã¯ã“ã‚“ãªæ„Ÿã˜ã§\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:orientation=\"vertical\">\r\n\r\n    <com.google.android.material.navigation.NavigationView\r\n        android:id=\"@+id/bottom_fragment_menu_navigation_view\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"match_parent\"\r\n        app:menu=\"@menu/bottom_fragment_menu\" />\r\n\r\n</LinearLayout>\r\n```\r\n\r\n## MenuBottomFragment.kt\r\n\r\nä»Šå›ã¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æŠ¼ã—ãŸã‚‰Toastã‚’å‡ºã™ã‚ˆã†ã«ã—ã¦ã¿ã¾ã—ãŸã€‚\r\n\r\n```kotlin\r\nclass MenuBottomFragment : BottomSheetDialogFragment() {\r\n\r\n    override fun onCreateView(\r\n        inflater: LayoutInflater,\r\n        container: ViewGroup?,\r\n        savedInstanceState: Bundle?\r\n    ): View? {\r\n        return inflater.inflate(R.layout.bottom_fragment_menu, container, false)\r\n    }\r\n\r\n    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {\r\n        super.onViewCreated(view, savedInstanceState)\r\n        // ãƒ¡ãƒ‹ãƒ¥ãƒ¼æŠ¼ã—ãŸã¨ã\r\n        bottom_fragment_menu_navigation_view.setNavigationItemSelectedListener {\r\n            Toast.makeText(context, it.title, Toast.LENGTH_SHORT).show()\r\n            true\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nã“ã‚Œã§çµ‚ã‚ã‚Šã§ã™ã€‚ãŠã¤88888888888\r\n\r\nã‚ã¨ã¯èµ·å‹•ã—ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ä¸‹ã‹ã‚‰ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/NavigationViewSample\r\n\r\n# ãŠã‚ã‚Šã«\r\nAndroid Studioãã‚“ã«èƒŒæ™¯ç”»åƒã‚»ãƒƒãƒˆã—ã¦ã‚‹ã›ã„ã§ã‚¹ã‚¯ã‚·ãƒ§ãŒå–ã‚Œãªã‹ã£ãŸã€‚  \r\næ¬¡ã‹ã‚‰ã¯Previewç‰ˆã‚’ãƒ–ãƒ­ã‚°æ›¸ãç”¨ã«å…¥ã‚Œã¦ãŠããŸã„ã¨æ€ã„ã¾ã—ãŸã¾ã‚‹"},{"title":"ndk-bundle did not have a source.properties file ã‚’ç›´ã™","link":"/posts/android_ndk_setup/","markdown":"\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªå…¥ã‚ŒãŸã‚‰å‡ºãŸã®ã§è§£æ±ºæ–¹æ³•ã§ã™ã€‚\r\n\r\n## ç’°å¢ƒ\r\n\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|--|--|\r\n|Android Studio|Android Studio 4.1|\r\n\r\n## ã§ã‚‹ãˆã‚‰ãƒ¼\r\n\r\n```\r\n> NDK at C:\\Users\\takusan23\\AppData\\Local\\Android\\Sdk\\ndk-bundle did not have a source.properties file\r\n```\r\n\r\n## NDKã‚’å…¥ã‚Œã‚‹\r\n\r\nã‚‚ã†å°å…¥æ¸ˆã¿ãªã‚‰é£›ã°ã—ã¦ã„ã„ã§ã™ã€‚\r\n\r\n`SDK Manager`ã‹ã‚‰å°å…¥ã§ãã¾ã™ã€‚\r\n\r\n`SDK Tools`ã¸ã‚¿ãƒ–ç§»å‹•ã—ã¦ã€`NDK`ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦`Apply`ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚\r\n\r\n## `local.properties`ã‚’é–‹ã\r\n\r\né–‹ã„ãŸã‚‰ã€`sdk.dir`ã®ã—ãŸã«ä¸€è¡Œè¶³ã—ã¾ã™ã€‚  \r\n\r\n```\r\nndk.dir=C\\:\\\\Users\\\\ãƒ¦ãƒ¼ã‚¶ãƒ¼å\\\\AppData\\\\Local\\\\Android\\\\Sdk\\\\ndk\\\\21.3.6528147\r\n```\r\n\r\nãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ã¨ã“ã‚ã¯å„è‡ªå¤‰ãˆã¦ã­ã€‚\r\n\r\n`Windows`ã¯ã“ã†ã§ã™ãŒã€`macOS`ã¯çŸ¥ã‚‰ãªã„\r\n\r\nã“ã‚Œã§ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚"},{"title":"Androidã§æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹ã¨ä½•ã‚‚ã—ã¦ã„ãªã„ã®ã«å£Šã‚ŒãŸ","link":"/posts/android_new_project_jdk_error/","markdown":"æ¯å› Java ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¶³ã‚Šãªã„ã£ã¦å‡ºã¦ãã‚‹ã‚“ã ã‘ã©ãªãœï¼Ÿ\r\n\r\n```\r\nThe consumer was configured to find a runtime of a library compatible with Java 8\r\n```\r\n\r\n# ä¿®æ­£\r\nè¨­å®šã‚’é–‹ã„ã¦ã€`Build, Execution, Deployment`ã‚’æŠ¼ã—ã¦`Build Tools`ã‚’ãŠã—ã¦`Gradle`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\nãã—ã¦ã€`Gradle JDK`ã®éƒ¨åˆ†ã‚’`11`ä»¥ä¸Šã®`Java`ã«ã—ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/3AT260T.png)\r\n\r\n## 11 ä»¥ä¸Šã® Java ãŒãªã„\r\nå…¥ã‚Œã¾ã—ã‚‡ã†ã€‚  \r\nå¤šåˆ† `Android Studio` å…¥ã‚ŒãŸã¨ãã«ã¤ã„ã¦ãã‚‹ã¯ãšã§ã™ãŒã€ã‚‚ã—ãªã„å ´åˆã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n## Java ã‚’å…¥ã‚Œã‚‹\r\nå®Ÿã¯ `Java (JDK)` ã¯ `Oracle` ä»¥å¤–ã®ãƒ™ãƒ³ãƒ€ãƒ¼ã‚‚ä½œã£ã¦ã„ã¦ï¼ˆãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã‚„ã‚¢ãƒã‚¾ãƒ³ãªã©ï¼‰ã€å¥½ããª`11 ä»¥é™ã®JDK`ã‚’å…¥ã‚Œã¦â†‘ã®è¨­å®šã‚’å®Œäº†ã•ã›ã‚Œã°è§£æ±ºã—ã¾ã™ã€‚  \r\nãŠã™ã™ã‚ã¯`Eclipse Temurin ï¼ˆæ—§ AdoptOpenJDKï¼‰`ã§ã™ã€‚åˆ¥ã«`Oracle JDK / OpenJDK`ã§ã‚‚ã„ã„ã§ã™ãŒ\r\n\r\n![Imgur](https://imgur.com/p8I1NTw.png)\r\n\r\nhttps://adoptium.net/download/\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã€ã•ã£ãã®`Android Studio`ã®è¨­å®šç”»é¢ã‚’é–‹ã„ã¦ã€ã•ã£ãå…¥ã‚ŒãŸJavaã‚’é¸æŠã—ã¦é–‰ã˜ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/KtIdNeW.png)\r\n\r\nã‚ã¨ã¯ `Try Again` ã‚’æŠ¼ã—ã¦å®Œäº†\r\n\r\n![Imgur](https://imgur.com/VDYTzU3.png)\r\n\r\nä»¥ä¸Šã§ã¤ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸã€‚  "},{"title":"5Gãªã®ã«é€šä¿¡å§‹ã‚ã‚‹ã¨4Gã«ãªã‚‹ã‚„ã¤","link":"/posts/android_new_radio_api/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã‚¦ãƒã¯ã‚‚ã†ã€å»¶æœŸã§ããªã„ã€‚ æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\n\r\nhttp://www.cuffs.co.jp/products/enking/\r\n\r\nã¿ã‚“ãªå¯æ„›ã‹ã£ãŸã§ã™ã€‚  \r\nã‚·ãƒŠãƒªã‚ªãªã‚‰æœªæ¥ã¡ã‚ƒã‚“ã‹ãªãƒ¼\r\n\r\n![Imgur](https://imgur.com/gn5s67t.png)\r\n![Imgur](https://imgur.com/ofeHzOf.png)\r\n\r\nã§ã‚‚ã‚„ã£ã±åƒç´—ã•ã‚“ãŒå¯æ„›ã‹ã£ãŸã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/QfWM9eI.png)\r\n![Imgur](https://imgur.com/fmBl3jo.png)\r\n\r\nã¨ã‚Šã‚ãˆãšã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°è¦‹ã¦ã»ã—ã„ã€ãƒ†ãƒ³ãƒè‰¯ãã¦è‰¯ã\r\n\r\n## æœ¬é¡Œ\r\nPixel 6 Pro ã‚’æ›´æ–°ã—ãŸã‚‰ã¤ã„ã«docomoã®5Gã‚’æ´ã‚€ã‚ˆã†ã«ãªã£ãŸã€‚ã„ãˆãƒ¼ã„  \r\n(ã¡ãªã¿ã«12æœˆã®ãƒ‘ãƒƒãƒã€ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã«å•é¡ŒãŒã‚ã‚‹ã¿ãŸã„ã§é…ä¿¡æ­¢ã¾ã£ã¦ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚ã„ã¾ã‹ã‚‰é©ç”¨ã™ã‚‹ã®ã¯è¾ã‚ã¦1æœˆã®ãƒ‘ãƒƒãƒã¾ã§å¾…ã£ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚)\r\n\r\nããƒ¼ã™ï¼šhttps://9to5google.com/2021/12/30/pixel-6-december-update-delay/\r\n\r\n<img width=\"200\" src=\"https://imgur.com/Mg1qpT3.png\">\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€Android 11ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸ 5Gï¼ˆNR / New Radioï¼‰å‘ã‘ã®APIã‚’è©¦ã—ã¦ã¿ã‚‹\r\n\r\nhttps://developer.android.com/about/versions/11/features/5g\r\n\r\n(æ­£ç›´ç§ã‚‚ã‚ˆãã‚ã‹ã£ã¦ãªã„)\r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ   | ã‚ãŸã„                              |\r\n|----------|-------------------------------------|\r\n| ç«¯æœ«     | Google Pixel 6 Pro                  |\r\n| Android  | 12                                  |\r\n| ã‚­ãƒ£ãƒªã‚¢ | docomo (ã‚®ã‚¬ãƒ›ãƒ—ãƒ¬ãƒŸã‚¢å¥‘ç´„ã—ã¦ããŸ) |\r\n\r\n## ãã®å‰ã«ï¼š5Gæ¥ãŸï¼é€šä¿¡å§‹ã‚ãŸã‚ï½—â†’4Gã«åˆ‡ã‚Šæ›¿ã‚ã‚‹\r\nä»•æ§˜ã§ã™ã€‚\r\n\r\nhttps://www.nttdocomo.co.jp/area/5g/notice.html\r\n\r\n### 5Gãªã®ã«4Gã«åˆ‡ã‚Šæ›¿ã‚ã‚‹ã®ã¯ãªãœï¼Ÿ\r\n5Gã®å±•é–‹ã§ã¯ã€`ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (SA)`æ–¹å¼ã¨ã€`ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (NSA)`æ–¹å¼ãŒã‚ã£ã¦ã€ç¾çŠ¶æ™®åŠã—ã¦ã‚‹5Gã¯`NSAæ–¹å¼`ã§ã™ã€‚   \r\nå‰è€…ã®`SAæ–¹å¼`ã§ã¯ã€**5GåŸºåœ°å±€å˜ä½“**ã§å‹•ãã“ã¨ãŒã§ãã¾ã™ãŒã€  \r\nå¾Œè€…ã®`NSAæ–¹å¼`ã§ã¯**å¾“æ¥ã®4GåŸºåœ°å±€è¨­å‚™(eNB)ã«5GåŸºåœ°å±€(gNB)ã‚’å°å…¥ã—ãŸç‰©ã§**ã€åˆ¶å¾¡ä¿¡å·(C-Plane)ã«4Gã®é›»æ³¢ã‚’åˆ©ç”¨ã—å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿è»¢é€(U-Plane)ã§ã¯5Gã®é›»æ³¢ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚   \r\n4Gã¨5Gã‚’åŒæ™‚ã«åˆ©ç”¨ã™ã‚‹`EN-DC`ã£ã¦è¨€ã†æŠ€è¡“ã‚’æ¡ç”¨ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚ã“ã®å ´åˆã§ã¯4Gã‚’`ãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰`ã€5Gã‚’`ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒãƒ¼ãƒ‰`ã¨å‘¼ã‚“ã§ã„ã‚‹ã‚ˆã†ã§ã™ã€‚\r\n\r\næµã‚Œã¨ã—ã¦ã¯ã€\r\n- 4GåŸºåœ°å±€ã¸å°å…¥ã—ãŸ5GåŸºåœ°å±€(NSAæ–¹å¼)ãŒã‚ã£ã¦ã€  \r\n- ãã®4GåŸºåœ°å±€ã®åœå†…ã«å…¥ã£ãŸå ´åˆã«ã€5GåŸºåœ°å±€ã®å­˜åœ¨ãŒ4Gã®åˆ¶å¾¡ä¿¡å·ã§é€ã‚‰ã‚Œã¦æ¥ã‚‹ã€‚\r\n    - ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒãƒ¼ãƒ‰ã®5GåŸºåœ°å±€ã¯è‡ªåˆ†ã®å­˜åœ¨ã‚’é€å‡ºã—ãªã„ã‚‰ã—ã„ï¼Ÿ(3GPP TS 37.340 7.1\tSystem information handling)\r\n- ã§ã‚‚å®Ÿéš›ã¯5GåŸºåœ°å±€ã®åœå†…ã«ã¯å…¥ã£ã¦ã„ãªã„ã€‚ã—ã‹ã—4Gï¼ˆã¨5Gã®åˆ¶å¾¡ä¿¡å·ï¼‰ã¯å±Šãã®ã§ã‚¢ãƒ³ãƒ†ãƒŠãƒ”ã‚¯ãƒˆã®éš£ã®ã‚¢ã‚¤ã‚³ãƒ³(RATè¡¨ç¤º)ãŒ5Gã«ãªã‚‹ã€‚\r\n    - 5Gåœå†…ã«ã„ã‚Œã°4Gã®åˆ¶å¾¡ä¿¡å·ã‚’ã‚‚ã¨ã«æ¥ç¶šã—ã¦ãã‚Œã‚‹æ¨¡æ§˜ï¼ˆè¦èª¿æŸ»ï¼‰\r\n\r\nè©³ã—ãçŸ¥ã‚ŠãŸã„å ´åˆã¯`EN-DC (E-UTRA-NR Dual Connectivity)`ã¨ã‹`ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰`ã¨ã‹`5G NR NSA Call Flow`ã§æ¤œç´¢ã—ã¦ä¸‹ã•ã„ã€‚\r\n\r\n3GPPã®è³‡æ–™ãŒè¦‹ãŸã„å ´åˆã¯ã“ã¡ã‚‰ã§ã™  \r\nTS 37.340\r\n\r\nhttps://portal.3gpp.org/desktopmodules/Specifications/SpecificationDetails.aspx?specificationId=3198\r\n\r\n`Versions`ã‚¿ãƒ–ã¸ç§»å‹•ã—ã¦`Version`ã®ã¨ã“ã‚ã®ãƒªãƒ³ã‚¯ã‚’æŠ¼ã™ã¨DLã§ãã¾ã™ã€‚  \r\nGoogleç¿»è¨³ã«ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ•ã’ã‚Œã°ç¿»è¨³ã—ã¦ãã‚Œã¾ã™ã€‚ï¼ˆãªãŠç†è§£ã§ãã‚‹ã¨ã¯è¨€ã£ã¦ã„ãªã„ï¼‰\r\n\r\n### ãã†ã„ã†ã“ã¨ãªã®ã§\r\n5Gå¯¾å¿œç«¯æœ«ã‚’SIMãƒ­ãƒƒã‚¯ãƒ•ãƒªãƒ¼ã§è²·ã†éš›ã¯ã€5Gã®å¯¾å¿œãƒãƒ³ãƒ‰ä»¥å¤–ã«ã‚‚4Gã®ãƒãƒ³ãƒ‰ã‚’ç¢ºèªã—ãªã„ã¨ã„ã‘ã¾ã›ã‚“ã€‚  \r\n`EN-DCçµ„ã¿åˆã‚ã›`ã¨ã‹ã§æ¤œç´¢ã™ã‚Œã°4Gã®ãƒãƒ³ãƒ‰ã¨5Gã®ãƒãƒ³ãƒ‰ã®çµ„ã¿åˆã‚ã›ãŒå‡ºã¦ãã‚‹ã®ã§ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n(ã©ã†ã§ã‚‚ã„ã„ã‚“ã ã‘ã©docomoã®5G Sub-6ã§ä½¿ã£ã¦ã‚‹`n79`ã£ã¦SIMãƒ•ãƒªãƒ¼ç«¯æœ«ã ã¨å…¨ç„¶å¯¾å¿œã—ã¦ãªããªã„ï¼Ÿ)\r\n\r\n## é©å½“ã«ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹\r\n\r\n### ä½¿ã†ãƒ¡ã‚½ãƒƒãƒ‰\r\n\r\n- `ConnectivityManager#registerDefaultNetworkCallback()`\r\n    - ã©ã†ã‚„ã‚‰ã“ã‚Œã§`å¾“é‡åˆ¶ or å®šé¡åˆ¶`ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®æ¤œå‡ºãŒã§ãã‚‹ã‚‰ã—ã„ï¼ˆç„¡ç†ã˜ã‚ƒã­ï¼Ÿï¼‰\r\n        - ä½¿ã„æ”¾é¡Œã‹ä¸Šé™ä»˜ãã®ãƒ—ãƒ©ãƒ³ã‹ã¿ãŸã„ãªï¼Ÿ\r\n- `TelephonyManager#listen()`ã¨`onDisplayInfoChanged()`\r\n    - ã“ã‚Œã§5GãŒ`Sub-6 or ãƒŸãƒªæ³¢`ã®ã©ã£ã¡ãªã®ã‹ãŒæ¤œå‡ºã§ãã‚‹ã¿ãŸã„ã€‚\r\n    - ã‚¢ãƒ³ãƒ†ãƒŠãƒ”ã‚¯ãƒˆğŸ“¶ã®éš£ã®`5G`ã€`4G+`ã¨åŒã˜ã®ãŒå–ã‚Œã‚‹ã£ã½ã„\r\n- `TelephonyManager#listen()`ã¨`onDisplayInfoChanged()`\r\n    - æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ãŒçŸ¥ã‚ŠãŸã„\r\n\r\n### app/build.gradle\r\n\r\n`Activity Result API`ã‚’ä½¿ã„ãŸã„ã®ã§Activityã¨Fragmentã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ã¾ã™ã€‚  \r\nã‚ã¨`ViewBinding`ã‚‚ä½¿ã„ãŸã„ã®ã§æœ‰åŠ¹ã«ã—ã¾ã™ã€‚\r\n\r\n```java\r\nplugins {\r\n    id 'com.android.application'\r\n    id 'kotlin-android'\r\n}\r\n\r\nandroid {\r\n    compileSdk 31\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.newradioapichecker\"\r\n        minSdk 30\r\n        targetSdk 31\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n    buildFeatures {\r\n        viewBinding true\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility JavaVersion.VERSION_1_8\r\n        targetCompatibility JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = '1.8'\r\n    }\r\n}\r\n\r\ndependencies {\r\n\r\n    implementation \"androidx.activity:activity:1.4.0\"\r\n    implementation \"androidx.fragment:fragment-ktx:1.4.0\"\r\n\r\n    implementation 'androidx.core:core-ktx:1.7.0'\r\n    implementation 'androidx.appcompat:appcompat:1.4.0'\r\n    implementation 'com.google.android.material:material:1.4.0'\r\n    implementation 'androidx.constraintlayout:constraintlayout:2.1.2'\r\n    testImplementation 'junit:junit:4.+'\r\n    androidTestImplementation 'androidx.test.ext:junit:1.1.3'\r\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'\r\n}\r\n```\r\n\r\n### AndroidManifest.xml\r\né›»æ³¢çŠ¶æ…‹ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã«ä½ç½®æƒ…å ±ã¨ã‹ç™ºä¿¡æ¨©é™ã¨ã‹ä½™è¨ˆãªã‚‚ã‚“ä»˜ã„ã¦ãã¾ã™ãŒä»•æ–¹ãªã„ã€‚\r\n\r\n```xml\r\n<uses-permission android:name=\"android.permission.ACCESS_NETWORK_STATE\" />\r\n<uses-permission android:name=\"android.permission.ACCESS_FINE_LOCATION\" />\r\n<uses-permission android:name=\"android.permission.READ_PHONE_STATE\" />\r\n```\r\n\r\n### activity_main.xml\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<LinearLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    android:orientation=\"vertical\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <TextView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:padding=\"10dp\"\r\n        android:text=\"å¾“é‡åˆ¶ãƒã‚§ãƒƒã‚¯\"\r\n        android:textSize=\"20sp\" />\r\n\r\n    <TextView\r\n        android:id=\"@+id/activity_main_metered_textview\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:gravity=\"end\"\r\n        android:padding=\"10dp\"\r\n        android:text=\"---\"\r\n        android:textSize=\"20sp\" />\r\n\r\n    <TextView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:padding=\"10dp\"\r\n        android:text=\"5Gã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\"\r\n        android:textSize=\"20sp\" />\r\n\r\n    <TextView\r\n        android:id=\"@+id/activity_main_new_radio_textview\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:gravity=\"end\"\r\n        android:padding=\"10dp\"\r\n        android:text=\"---\"\r\n        android:textSize=\"20sp\" />\r\n\r\n    <TextView\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:padding=\"10dp\"\r\n        android:text=\"æ¥ç¶šä¸­ãƒãƒ³ãƒ‰\"\r\n        android:textSize=\"20sp\" />\r\n\r\n    <TextView\r\n        android:id=\"@+id/activity_main_band_textview\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:gravity=\"end\"\r\n        android:padding=\"10dp\"\r\n        android:text=\"---\"\r\n        android:textSize=\"20sp\" />\r\n\r\n</LinearLayout>\r\n```\r\n\r\n### MainActivity.kt\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val connectivityManager by lazy { getSystemService(CONNECTIVITY_SERVICE) as ConnectivityManager }\r\n    private val telephonyManager by lazy { getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager }\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯è§£é™¤ç”¨\r\n    private var connectivityManagerCallback: ConnectivityManager.NetworkCallback? = null\r\n    private var phoneStateListener: PhoneStateListener? = null\r\n    private var telephonyCallback: TelephonyCallback? = null\r\n\r\n    private val permissionRequest = registerForActivityResult(ActivityResultContracts.RequestMultiplePermissions()) { result ->\r\n        if (result.all { it.value }) {\r\n            startListen()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        // æ¨©é™ç¢ºèª\r\n        if (isGranted()) {\r\n            // ã‚ã‚‹ã®ã§ç›£è¦–é–‹å§‹\r\n            startListen()\r\n        } else {\r\n            // ãªã„\r\n            permissionRequest.launch(arrayOf(Manifest.permission.ACCESS_FINE_LOCATION, Manifest.permission.READ_PHONE_STATE))\r\n        }\r\n    }\r\n\r\n    private fun startListen() {\r\n        listenUnlimitedNetwork {\r\n            viewBinding.activityMainMeteredTextview.text = if (it) \"ç„¡åˆ¶é™ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š\" else \"ä¸Šé™ã‚ã‚Šã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š\"\r\n        }\r\n        listenNewRadio(\r\n            onCellInfoCallback = {\r\n                viewBinding.activityMainBandTextview.text = when (it) {\r\n                    is CellInfoLte -> \"\"\"LTE\r\næ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${it.cellIdentity.bands.map { it.toString() }} (${it.cellIdentity.earfcn})\"\"\"\r\n                    is CellInfoNr -> \"\"\"5G\r\næ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${(it.cellIdentity as CellIdentityNr).bands.map { it.toString() }} (${(it.cellIdentity as CellIdentityNr).nrarfcn})\"\"\"\r\n                    else -> \"ãã‚Œä»¥å¤–\"\r\n                }\r\n            },\r\n            onDisplayInfoCallback = {\r\n                viewBinding.activityMainNewRadioTextview.text = when (it.overrideNetworkType) {\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_LTE_ADVANCED_PRO -> \"LTE Advanced Proï¼ˆ5Geï¼‰\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_LTE_CA -> \"LTE ã‚­ãƒ£ãƒªã‚¢ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA -> \"5G Sub-6 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA_MMWAVE -> \"5G ãƒŸãƒªæ³¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (éæ¨å¥¨)\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_ADVANCED -> \"5G ãƒŸãƒªæ³¢ (ã‚‚ã—ãã¯ãã‚ŒåŒç­‰ã®) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\"\r\n                    else -> \"ãã‚Œä»¥å¤–\"\r\n                }\r\n            }\r\n        )\r\n    }\r\n\r\n    private fun isGranted(): Boolean {\r\n        val fineLocation = ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION)\r\n        val readPhoneState = ContextCompat.checkSelfPermission(this, Manifest.permission.READ_PHONE_STATE)\r\n        return (fineLocation == PackageManager.PERMISSION_GRANTED) && (readPhoneState == PackageManager.PERMISSION_GRANTED)\r\n    }\r\n\r\n    private fun listenNewRadio(\r\n        onCellInfoCallback: (CellInfo) -> Unit,\r\n        onDisplayInfoCallback: (TelephonyDisplayInfo) -> Unit,\r\n    ) {\r\n        // Android 12ã‚ˆã‚Šæ›¸ãæ–¹ãŒå¤‰ã‚ã£ãŸ\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n            telephonyCallback = object : TelephonyCallback(), TelephonyCallback.DisplayInfoListener, TelephonyCallback.CellInfoListener {\r\n                /** å®Ÿéš›ã®çŠ¶æ…‹ */\r\n                override fun onCellInfoChanged(cellInfo: MutableList<CellInfo>) {\r\n                    onCellInfoCallback(cellInfo[0])\r\n                }\r\n\r\n                /** ã‚¢ãƒ³ãƒ†ãƒŠãƒ”ã‚¯ãƒˆã¨åŒã˜ã‚„ã¤ */\r\n                override fun onDisplayInfoChanged(telephonyDisplayInfo: TelephonyDisplayInfo) {\r\n                    onDisplayInfoCallback(telephonyDisplayInfo)\r\n                }\r\n            }\r\n            telephonyManager.registerTelephonyCallback(mainExecutor, telephonyCallback!!)\r\n        } else {\r\n            phoneStateListener = object : PhoneStateListener() {\r\n\r\n                @SuppressLint(\"MissingPermission\")\r\n                override fun onCellInfoChanged(cellInfo: MutableList<CellInfo>?) {\r\n                    super.onCellInfoChanged(cellInfo)\r\n                    cellInfo?.get(0)?.let { onCellInfoCallback(it) }\r\n                }\r\n\r\n                @SuppressLint(\"MissingPermission\")\r\n                override fun onDisplayInfoChanged(telephonyDisplayInfo: TelephonyDisplayInfo) {\r\n                    super.onDisplayInfoChanged(telephonyDisplayInfo)\r\n                    onDisplayInfoCallback(telephonyDisplayInfo)\r\n                }\r\n            }\r\n            telephonyManager.listen(phoneStateListener!!, PhoneStateListener.LISTEN_DISPLAY_INFO_CHANGED or PhoneStateListener.LISTEN_CELL_INFO)\r\n        }\r\n    }\r\n\r\n    private fun listenUnlimitedNetwork(onResult: (Boolean) -> Unit) {\r\n        connectivityManagerCallback = object : ConnectivityManager.NetworkCallback() {\r\n            override fun onCapabilitiesChanged(network: Network, networkCapabilities: NetworkCapabilities) {\r\n                super.onCapabilitiesChanged(network, networkCapabilities)\r\n                // ç„¡åˆ¶é™ãƒ—ãƒ©ãƒ³ã‚’å¥‘ç´„ã—ã¦ã„ã‚‹å ´åˆã¯true\r\n                val isUnlimited = networkCapabilities.hasCapability(NetworkCapabilities.NET_CAPABILITY_NOT_METERED) ||\r\n                        networkCapabilities.hasCapability(NetworkCapabilities.NET_CAPABILITY_TEMPORARILY_NOT_METERED)\r\n                onResult(isUnlimited)\r\n            }\r\n        }\r\n        connectivityManager.registerDefaultNetworkCallback(connectivityManagerCallback!!)\r\n    }\r\n\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        connectivityManagerCallback?.let { connectivityManager.unregisterNetworkCallback(it) }\r\n        phoneStateListener?.let { telephonyManager.listen(it, PhoneStateListener.LISTEN_NONE) }\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n            telephonyCallback?.let { telephonyManager.unregisterTelephonyCallback(it) }\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\n### çµæœ\r\n\r\nå¯’ã„ä¸­ãƒ‰ã‚³ãƒ¢ã‚·ãƒ§ãƒƒãƒ—ã®è¿‘ãã‚’ãƒ•ãƒ©ãƒ•ãƒ©ã—ã¦5Gã®é›»æ³¢ã‚’æ„Ÿã˜ã¦ãã¾ã—ãŸã€‚(ãƒ‰ã‚³ãƒ¢ã‚·ãƒ§ãƒƒãƒ—ã«ã¯è²´é‡ãª5GãƒŸãƒªæ³¢ã‚¢ãƒ³ãƒ†ãƒŠãŒã‚ã‚‹ã€‚ã™ã¹ã¦ã®åº—èˆ—ã«ã¯ç„¡ã„ã£ã½ã„ï¼Ÿ)\r\n\r\n<img width=\"200\" src=\"https://imgur.com/Mg1qpT3.png\">\r\n<img width=\"200\" src=\"https://imgur.com/J2BomtM.png\">\r\n<img width=\"200\" src=\"https://imgur.com/TcmirVd.png\">\r\n<img width=\"200\" src=\"https://imgur.com/PhYA35b.png\">\r\n\r\n- `ConnectivityManager#registerDefaultNetworkCallback()`\r\n    - ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿æ¥ç¶šä¸­ã¯å¸¸ã«å¾“é‡åˆ¶ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯åˆ¤å®šã ã£ãŸ\r\n        - ãªã‚“ã‹è¨­å®šãŒå¿…è¦ãªã®ï¼Ÿ\r\n- `TelephonyManager#listen()`ã¨`onDisplayInfoChanged()`\r\n    - `ãƒŸãƒªæ³¢`ã§ã‚‚å¤‰ã‚ã‚‰ãšã€`Sub-6`åˆ¤å®šã ã£ãŸã€‚\r\n    - `ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰åœå†…`ã®å ´åˆã§ã‚‚`Sub-6`åˆ¤å®šã ã£ãŸã€‚\r\n- `TelephonyManager#listen()`ã¨`onDisplayInfoChanged()`\r\n    - ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰æ™‚ã¯`CellInfoLte`ã€5G(Sub-6/NR)ã®å ´åˆã¯`CellIdentityNr`ãŒè²°ãˆã‚‹\r\n        - ã‚ˆã£ã¦`Sub-6`or`ãƒŸãƒªæ³¢`or`ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰`ã®æ¤œå‡ºã«ã¯ã“ã£ã¡ã‚’åˆ©ç”¨ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã£ã¦ã“ã¨ã§ã™ã­ï¼\r\n\r\n## Sub-6 ã‹ ãƒŸãƒªæ³¢ ã‹åˆ¤å®šã™ã‚‹æ–¹æ³•\r\n\r\n`NRARFCN`ã®æ•°å­—ãŒ`2054166`ä»¥ä¸Šã®å ´åˆã¯å¤šåˆ†ãƒŸãƒªæ³¢ã§ã™(5Gãƒãƒ³ãƒ‰`n257`ä»¥ä¸Š)\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€`startListen é–¢æ•°`ã‚’æ›¸ãæ›ãˆã‚Œã°5G ãƒŸãƒªæ³¢ã€5G Sub-6ã®æ¤œçŸ¥ã‚‚å‡ºæ¥ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\n```kotlin\r\n    private fun startListen() {\r\n        listenUnlimitedNetwork {\r\n            viewBinding.activityMainMeteredTextview.text = if (it) \"ç„¡åˆ¶é™ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š\" else \"ä¸Šé™ã‚ã‚Šã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š\"\r\n        }\r\n        listenNewRadio(\r\n            onCellInfoCallback = {\r\n                viewBinding.activityMainBandTextview.text = when (it) {\r\n                    is CellInfoLte -> \"\"\"LTE\r\næ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${it.cellIdentity.bands.map { it.toString() }} (${it.cellIdentity.earfcn})\"\"\"\r\n                    is CellInfoNr -> \"\"\"5G\r\næ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${(it.cellIdentity as CellIdentityNr).bands.map { it.toString() }} (${(it.cellIdentity as CellIdentityNr).nrarfcn})\r\n${if ((it.cellIdentity as CellIdentityNr).nrarfcn > 2054166) \"ãƒŸãƒªæ³¢ã«æ¥ç¶šä¸­\" else \"Sub-6ã«æ¥ç¶šä¸­\"}\r\n\"\"\"\r\n                    else -> \"ãã‚Œä»¥å¤–\"\r\n                }\r\n            },\r\n            onDisplayInfoCallback = {\r\n                viewBinding.activityMainNewRadioTextview.text = when (it.overrideNetworkType) {\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_LTE_ADVANCED_PRO -> \"LTE Advanced Proï¼ˆ5Geï¼‰\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_LTE_CA -> \"LTE ã‚­ãƒ£ãƒªã‚¢ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA -> \"5G Sub-6 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA_MMWAVE -> \"5G ãƒŸãƒªæ³¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (éæ¨å¥¨)\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_ADVANCED -> \"5G ãƒŸãƒªæ³¢ (ã‚‚ã—ãã¯ãã‚ŒåŒç­‰ã®) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\"\r\n                    else -> \"ãã‚Œä»¥å¤–\"\r\n                }\r\n            }\r\n        )\r\n    }\r\n```\r\n\r\n## ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ã‹ã©ã†ã‹ã‚’åˆ¤æ–­ã™ã‚‹æ–¹æ³•\r\n\r\n`CellInfo`ã¨`TelephonyDisplayInfo`ã‹ã‚‰åˆ¤æ–­ã§ãã¾ã™\r\n\r\n```kotlin\r\n    private fun listenNewRadio(\r\n        onCellInfoCallback: (CellInfo) -> Unit,\r\n        onDisplayInfoCallback: (TelephonyDisplayInfo) -> Unit,\r\n        onAnchorBandCallback: (Boolean) -> Unit,\r\n    ) {\r\n\r\n        // onCellInfoChanged onDisplayInfoChanged ã®çµæœã‚’ä¸€æ™‚çš„ã«æŒã£ã¦ãŠã\r\n        var tempCellInfo: CellInfo? = null\r\n        var tempTelephonyDisplayInfo: TelephonyDisplayInfo? = null\r\n\r\n        // ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ã‹ã©ã†ã‹ã‚’é€ã‚‹\r\n        fun checkAnchorBand() {\r\n            if (tempCellInfo == null && tempTelephonyDisplayInfo == null) return\r\n            // CellInfoãŒLTEã®ã‚‚ã®ã§ã€å®Ÿéš›ã«è¡¨ç¤ºã—ã¦ã„ã‚‹ã‚¢ã‚¤ã‚³ãƒ³ãŒ5Gã®å ´åˆã¯ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰\r\n            val isAnchorBand = tempCellInfo is CellInfoLte && tempTelephonyDisplayInfo?.overrideNetworkType == TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA\r\n            onAnchorBandCallback(isAnchorBand)\r\n        }\r\n\r\n        // Android 12ã‚ˆã‚Šæ›¸ãæ–¹ãŒå¤‰ã‚ã£ãŸ\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n            telephonyCallback = object : TelephonyCallback(), TelephonyCallback.DisplayInfoListener, TelephonyCallback.CellInfoListener {\r\n                /** å®Ÿéš›ã®çŠ¶æ…‹ */\r\n                override fun onCellInfoChanged(cellInfo: MutableList<CellInfo>) {\r\n                    onCellInfoCallback(cellInfo[0])\r\n                    tempCellInfo = cellInfo[0]\r\n                    checkAnchorBand()\r\n                }\r\n\r\n                /** ã‚¢ãƒ³ãƒ†ãƒŠãƒ”ã‚¯ãƒˆã¨åŒã˜ã‚„ã¤ */\r\n                override fun onDisplayInfoChanged(telephonyDisplayInfo: TelephonyDisplayInfo) {\r\n                    onDisplayInfoCallback(telephonyDisplayInfo)\r\n                    tempTelephonyDisplayInfo = telephonyDisplayInfo\r\n                    checkAnchorBand()\r\n                }\r\n            }\r\n            telephonyManager.registerTelephonyCallback(mainExecutor, telephonyCallback!!)\r\n        } else {\r\n            phoneStateListener = object : PhoneStateListener() {\r\n\r\n                @SuppressLint(\"MissingPermission\")\r\n                override fun onCellInfoChanged(cellInfo: MutableList<CellInfo>?) {\r\n                    super.onCellInfoChanged(cellInfo)\r\n                    cellInfo?.get(0)?.let { onCellInfoCallback(it) }\r\n                    tempCellInfo = cellInfo?.get(0)\r\n                    checkAnchorBand()\r\n                }\r\n\r\n                @SuppressLint(\"MissingPermission\")\r\n                override fun onDisplayInfoChanged(telephonyDisplayInfo: TelephonyDisplayInfo) {\r\n                    super.onDisplayInfoChanged(telephonyDisplayInfo)\r\n                    onDisplayInfoCallback(telephonyDisplayInfo)\r\n                    tempTelephonyDisplayInfo = telephonyDisplayInfo\r\n                    checkAnchorBand()\r\n                }\r\n            }\r\n            telephonyManager.listen(phoneStateListener!!, PhoneStateListener.LISTEN_DISPLAY_INFO_CHANGED or PhoneStateListener.LISTEN_CELL_INFO)\r\n        }\r\n    }\r\n```\r\n\r\né–¢æ•°ã‚’å‘¼ã¶å´ã¯ã“ã‚“ãªé¢¨ã«\r\n\r\n```kotlin\r\n    private fun startListen() {\r\n        listenUnlimitedNetwork {\r\n            viewBinding.activityMainMeteredTextview.text = if (it) \"ç„¡åˆ¶é™ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š\" else \"ä¸Šé™ã‚ã‚Šã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ¥ç¶š\"\r\n        }\r\n        listenNewRadio(\r\n            onCellInfoCallback = {\r\n                viewBinding.activityMainBandTextview.text = when (it) {\r\n                    is CellInfoLte -> \"\"\"LTE\r\næ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${it.cellIdentity.bands.map { it.toString() }} (${it.cellIdentity.earfcn})\"\"\"\r\n                    is CellInfoNr -> \"\"\"5G\r\næ¥ç¶šä¸­ãƒãƒ³ãƒ‰ï¼š${(it.cellIdentity as CellIdentityNr).bands.map { it.toString() }} (${(it.cellIdentity as CellIdentityNr).nrarfcn})\r\n${if ((it.cellIdentity as CellIdentityNr).nrarfcn > 2054166) \"ãƒŸãƒªæ³¢ã«æ¥ç¶šä¸­\" else \"Sub-6ã«æ¥ç¶šä¸­\"}\"\"\"\r\n                    else -> \"ãã‚Œä»¥å¤–\"\r\n                }\r\n            },\r\n            onDisplayInfoCallback = {\r\n                viewBinding.activityMainNewRadioTextview.text = when (it.overrideNetworkType) {\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_LTE_ADVANCED_PRO -> \"LTE Advanced Proï¼ˆ5Geï¼‰\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_LTE_CA -> \"LTE ã‚­ãƒ£ãƒªã‚¢ã‚¢ã‚°ãƒªã‚²ãƒ¼ã‚·ãƒ§ãƒ³\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA -> \"5G Sub-6 ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA_MMWAVE -> \"5G ãƒŸãƒªæ³¢ ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ (éæ¨å¥¨)\"\r\n                    TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_ADVANCED -> \"5G ãƒŸãƒªæ³¢ (ã‚‚ã—ãã¯ãã‚ŒåŒç­‰ã®) ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯\"\r\n                    else -> \"ãã‚Œä»¥å¤–\"\r\n                }\r\n            },\r\n            onAnchorBandCallback = {\r\n                // ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«TextViewè¿½åŠ ã—ã¦ãŠã„ã¦ï¼\r\n                viewBinding.activityMainAnchorBandTextview.text = if (it) \"ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰æ¥ç¶šä¸­\" else \"4Gæ¥ç¶šä¸­ã€ã‚‚ã—ãã¯ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚\"\r\n            }\r\n        )\r\n    }\r\n```\r\n\r\n## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nã©ã†ãï½\r\n\r\nhttps://github.com/takusan23/NewRadioAPIChecker\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ãƒã‚§ãƒƒã‚«ãƒ¼ä½œã‚Šã¾ã—ãŸã€‚ä½œã£ãŸã‚“ã ã‘ã©ãªã‚“ã‹docomoãªã®ã«`ãƒãƒ³ãƒ‰ï¼šn77`ã¨ã‹è¡¨ç¤ºã™ã‚‹ã—ãªã‚“ã‹å¼·åˆ¶çµ‚äº†ã™ã‚‹ã—ã¦é©å½“ã ã‘ã©ã©ã†ãã€‚\r\n\r\n(PlayStoreã£ã¦å¹´æœ«å¹´å§‹ã‚‚å¯©æŸ»ã—ã¦ã‚‹ã‚“ã‹ãƒ»ãƒ»ãƒ»ï¼ŸãŠç–²ã‚Œæ§˜ã§ã™)\r\n\r\n- PlayStore\r\n    - https://play.google.com/store/apps/details?id=io.github.takusan23.newradiosupporter\r\n    - Android 11 ä»¥é™\r\n- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\n    - https://github.com/takusan23/NewRadioSupporter\r\n\r\nãã†ã„ãˆã°docomoã‚‚ãªã‚“ã¡ã‚ƒã£ã¦5Gï¼ˆ4Gå‘¨æ³¢æ•°ã‚’è»¢ç”¨ï¼‰ã®å§¿å‹¢ã‚’è¦‹ã›ãŸã¿ãŸã„ã§ã™ã‚ˆã€‚docomoã¯ã‚„ã‚‰ãªã„é›°å›²æ°—ï¼ˆãªãœã‹å¤‰æ›ã§ããªã„ï¼‰å‡ºã—ã¦ãŸã®ã«ãƒ»ãƒ»ãƒ»"},{"title":"NewRadioSupporterãŒãƒ‡ãƒ¥ã‚¢ãƒ«SIMã«å¯¾å¿œã—ã¾ã—ãŸ","link":"/posts/android_new_radio_supporter_dual_sim_update/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\nã‚¸ãƒ¥ã‚¨ãƒªãƒ¼ãƒ»ãƒãƒ¼ãƒ„ãƒ»ã‚¢ã‚«ãƒ‡ãƒŸã‚¢ -We will wing wonder world- æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\n\r\n![Imgur](https://imgur.com/vR1AfMu.png)\r\n\r\nåºç›¤ã®é ƒãŒæ‡ã‹ã—ããªã‚‹ãã‚‰ã„ã«ã¯ãœã‚“ãœã‚“é•ã†æ–¹å‘ã«è©±ãŒé€²ã‚€ã®ã­ã€ã€è©•åˆ¤ãŒã‚ˆã•ãã†ã ã£ãŸã®ã§äºˆç´„ã—ã¦ãŸã‚“ã§ã™ãŒã‚ã¡ã‚ƒã‚ˆã‹ã£ãŸã§ã™ã€‚  \r\næ¬¡ã€…ã¨æ–°äº‹å®ŸãŒã€ã€ã€ï¼ä¼ç·šå›åã™ã”ã„ã€ã€è‰²ã‚“ãªæ–¹å‘ã«è©±ãŒé€²ã‚“ã§ã„ãã‘ã©æœ€å¾Œã¯ã¡ã‚ƒã‚“ã¨ã—ã¦ã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/trnJxyg.png)\r\n\r\næˆ¦é—˜ã‚·ãƒ¼ãƒ³ã¯æ¯å›ãƒ©ã‚¹ãƒœã‚¹ã‹ã‚ˆã£ã¦å‹¢ã„ãªã®ã§æ¯å›ãƒãƒ©ãƒãƒ©ã•ã›ã‚‰ã‚Œã‚‹ã€ã€ã€\r\n\r\n![Imgur](https://imgur.com/4gdKxtp.png)\r\n\r\nãƒ’ãƒ­ã‚¤ãƒ³ã¿ã‚“ãªã‚ã£ã¡ã‚ƒã‹ã‚ã„ã„ï¼ï¼ï¼ã€‚ãŠã™ã™ã‚ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/RbcdPR7.png)\r\n\r\n![Imgur](https://imgur.com/wR807Ro.png)\r\n\r\nâ†‘ã‚¢ãƒªã‚¢ãƒ³ãƒŠã¡ã‚ƒã‚“ãŒã‹ã‚ã„ã„ã®ã§ãœã²\r\n\r\næ›²ã‚‚ã‚ã£ã¡ã‚ƒã„ã„ï¼ã€‚ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°æ›²ãŒæ°—ã«å…¥ã‚Šã¾ã—ãŸã€‚ã‚ªãƒ¼ãƒ—ãƒ‹ãƒ³ã‚°æ›²ã®ã‚¤ãƒ³ãƒˆãƒ­ã‚‚ã™ã\r\n\r\n# æœ¬é¡Œ\r\n\r\n`NewRadioSupporter`ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚’ã—ã¾ã—ãŸã€‚  \r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚‚ã‚ã‚‹ã®ã§è‡ªä¿¡ãŒã‚ã‚‹æ–¹ã¯ãƒ“ãƒ«ãƒ‰æŒ‘æˆ¦ã—ã¦ã¿ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\r\n\r\n## ãƒ‡ãƒ¥ã‚¢ãƒ«SIMå¯¾å¿œ\r\nãƒ‡ãƒ¥ã‚¢ãƒ«SIMã«å¯¾å¿œã—ã¾ã—ãŸã€‚ãã‚“ãªã«é›£ã—ããªã‹ã£ãŸã€ã€ã€  \r\nå‹•ä½œç¢ºèªã®ãŸã‚ã«MNOã®ã‚ªãƒ³ãƒ©ã‚¤ãƒ³é™å®šãƒ—ãƒ©ãƒ³ã‚’å¥‘ç´„ã—ã¦ã¿ãŸã®ã§ã™ãŒMNOãªã®ã«ãšã„ã¶ã‚“å®‰ã„ã§ã™ã­ï¼ˆæ„Ÿè¦šéº»ç—ºï¼‰ã€‚  \r\n~~ã¨ã„ã†ã‹ãƒ†ã‚¶ãƒªãƒ³ã‚°ç„¡æ–™ãªã®ã­ã€docomo / æ¥½å¤© ä»¥å¤–ã¯é‡‘æ‰•ã‚ãªã„ã¨ä½¿ãˆãªã„ã®ã«ã‚ªãƒ³ãƒ©ã‚¤ãƒ³é™å®šãƒ—ãƒ©ãƒ³ã¯ã„ã„ã®ã‹ã€ã€ã€ï¼Ÿ~~ æœ€è¿‘ã®ãƒ—ãƒ©ãƒ³ã¯ãƒ†ã‚¶ãƒªãƒ³ã‚°ç„¡æ–™ã«ãªã£ãŸã®ï¼Ÿ\r\n\r\n`Xperia`ã§å‹•ã„ãŸã®ã¯ç¢ºèªã—ãŸã€‚`Pixel`ã§ã‚‚å¤šåˆ†å‹•ãã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/VZuEFBS.png)\r\n\r\n![Imgur](https://imgur.com/liyNL0w.png)\r\n\r\n## è»¢ç”¨5G ã®æ¤œå‡º\r\n`3.6GHz`æœªæº€ã®å‘¨æ³¢æ•°ã®å ´åˆã«è»¢ç”¨5Gã¨è¡¨ç¤ºã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  \r\n![Imgur](https://imgur.com/BHuAk07.png)\r\n\r\n## Snapdragon ç«¯æœ«ã§å‹•ãã‚ˆã†ã«\r\nã‚ã¨ã‚‚ã†ä¸€ã¤ã€ç§ã‚‚Xperiaã§ä½¿ã†ã¾ã§çŸ¥ã‚‰ãªã‹ã£ãŸã®ã§ã™ãŒ **Snapdragon æ­è¼‰ç«¯æœ«ã§å‹•ã„ã¦ã¾ã›ã‚“ã§ã—ãŸã€‚**  \r\nãŸã¾ãŸã¾`Google Pixel`ã§å‹•ã„ã¦ãŸã ã‘ã§ã—ãŸã€ã€ã€ã€\r\n\r\nã‚¢ãƒ—ãƒªã‚’å‡ºã—ã¦ã‹ã‚‰ä¸€å¹´ãã‚‰ã„çµŒã¡ã¾ã™ãŒæ°—ã¥ãã¾ã›ã‚“ã§ã—ãŸã”ã‚ã‚“ãªã•ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/rXrsd6A.png)\r\n\r\nä»Šå›ã¯ã“ã‚Œã‚‰ã®å®Ÿè£…æ–¹æ³•ã§ã‚‚ã¤ã‚‰ã¤ã‚‰ã¨\r\n\r\n# ãã®å‰ã«ã“ã®ã‚¢ãƒ—ãƒªä½•\r\né›»æ³¢ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚¢ãƒ³ãƒ†ãƒŠãƒ”ã‚¯ãƒˆï¼‰ã®éš£ã«ã‚ã‚‹ã€`5G`ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆ`RATè¡¨ç¤º`ï¼‰ãŒä½•ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã‹ã‚’åˆ¤å®šã™ã‚‹ã‚¢ãƒ—ãƒªã§ã™ã€‚  \r\nå®Ÿã¯ã“ã‚Œ`5G`ã«ã¤ãªãŒã£ã¦ç„¡ãã¦ã‚‚`5G`ã£ã¦è¡¨ç¤ºã™ã‚‹ã“ã¨ãŒã‚ã‚Šï¼ˆï¼ï¼Ÿï¼‰ã€æœ¬å½“ã«`5G`ã«æ¥ç¶šã—ã¦ã„ã‚‹ã®ã‹åˆ¤å®šã™ã‚‹ã‚¢ãƒ—ãƒªã«ãªã‚Šã¾ã™ã€‚  \r\nä»¥ä¸‹ã®åˆ¤å®šæ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n- ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰\r\n    - ç¾åœ¨æ™®åŠã—ã¦ã„ã‚‹`5G`ã¯`4G`åŸºåœ°å±€ãŒç„¡ã„ã¨å‹•ã‹ãªã„ã€‚é€£å‹•ã—ã¦ã„ã‚‹ï¼ˆãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³æ–¹å¼ï¼‰\r\n    - â†’ é€£å‹•ã—ã¦ã„ã‚‹`4G`åŸºåœ°å±€ã¨ã¤ãªãŒã£ãŸéš›ã«ã€`5G`åŸºåœ°å±€ã®å­˜åœ¨ãŒé€šçŸ¥ã•ã‚Œã‚‹\r\n    - â†’ é€šçŸ¥ã•ã‚Œã‚‹ãŒã€`5G`åŸºåœ°å±€ã®é›»æ³¢ã¯å±Šã‹ãš`4G`ã«ã®ã¿æ¥ç¶šã•ã‚Œã‚‹ã€‚\r\n    - â†’ ã—ã‹ã—ã€`4G`åŸºåœ°å±€ã‹ã‚‰`5G`ã®å­˜åœ¨ãŒé€šçŸ¥ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€**RATè¡¨ç¤ºãŒ5G**ã«ãªã‚‹ã€‚ï¼ˆå®Ÿéš›ã¯`4G`ã«ç¹‹ãŒã£ã¦ã„ã‚‹ã®ã«ï¼ï¼‰\r\n    - é›‘ãªçµµã§ã™\r\n        - ![Imgur](https://imgur.com/eCoXDPD.png)\r\n    - ãªã‚“ã§åˆ¤å®šãŒã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã§ã§ãã‚‹ã‚“ã ã£ã¦è©±ã§ã™ãŒã€ã©ã†ã‚„ã‚‰å†…éƒ¨ã§ã¯`4G`æ‰±ã„ã ãŒã€RATè¡¨ç¤ºã ã‘`5G`ã«ä¸Šæ›¸ãã™ã‚‹å‡¦ç†ã®ã‚ˆã†ã§ã™ã€‚\r\n- Sub-6\r\n    - 4Gã®å»¶é•·ç·šä¸Šã®å‘¨æ³¢æ•°ã‚’ä½¿ã†5Gã§ã™ã€‚\r\n    - è»¢ç”¨5Gã‚’é™¤ã‘ã°ã»ã¨ã‚“ã©ã“ã‚Œ\r\n- ãƒŸãƒªæ³¢\r\n    - Sub-6ã‚ˆã‚Šã‚‚ã•ã‚‰ã«æ—©ã„\r\n    - ã‚ã£ãŸã«é­é‡ã—ãªã„\r\n    - å¯¾å¿œæ©Ÿç¨®ã‚‚ã‚ã‚“ã¾ã‚Šãªã„ï¼ˆSIMãƒ•ãƒªãƒ¼ãªã‚‰ãªãŠã•ã‚‰ç„¡ã„ï¼‰\r\n- è»¢ç”¨5G\r\n    - 4GåŸºåœ°å±€ã‚’5Gã«ã—ãŸã‚‚ã®ã€‚åå‰ãã®ã¾ã¾\r\n    - é€Ÿåº¦ã¯4Gã®ã¾ã¾ã«ãªã‚‹\r\n    - ãªã‚“ã¡ã‚ƒã£ã¦5G / NRåŒ– ã¨ã‹å‘¼ã°ã‚Œã¦ã„ã‚‹\r\n- ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (NSA)\r\n    - ã„ã¾ã®5Gã¯ã“ã‚Œ\r\n    - 4GåŸºåœ°å±€ã¨é€£å‹•ã—ã¦å‹•ã5G\r\n        - 4GåŸºåœ°å±€ã‚’ ãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚»ãƒ«ã€ãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ ã¨ã‹å‘¼ã‚“ã§ã‚‹ï¼Ÿ\r\n        - 5GåŸºåœ°å±€ã‚’ ã‚»ã‚«ãƒ³ãƒ€ãƒªãƒ¼ã‚»ãƒ« ã¨ã‹å‘¼ã‚“ã§ã‚‹ï¼Ÿ\r\n    - Androidã®`TelephonyManager`ã®æŒ™å‹•ãŒã‚ˆãåˆ†ã‹ã‚‰ãªã„ã€ã€ã€`5G NSA`ã®å ´åˆã¯å†…éƒ¨çš„ã«`LTE`ã§æ‰±ã‚ã‚Œã¦ãã†ãªé›°å›²æ°—ãŒã‚ã‚‹\r\n        - è¨­å®šç”»é¢ã«ã‚ã‚‹ `SIM ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹`ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ï¼ˆãƒ‡ãƒã‚¤ã‚¹æƒ…å ±ã‹ã‚‰è¦‹ã‚Œã‚‹ï¼‰ ã®ã¨ã“ã‚ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’çœºã‚ã‚‹\r\n            - ãªã‚“ã‹ `LTE` ã ã‘ã© `5G NSA` ãªã‚‰ä¸Šæ›¸ãã™ã‚‹å‡¦ç†ãŒã‚ã‚‹\r\n            - https://cs.android.com/android/platform/superproject/+/master:packages/apps/Settings/src/com/android/settings/deviceinfo/simstatus/SimStatusDialogController.java;l=558\r\n- ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (SA)\r\n    - 5Gå˜ç‹¬ã§å‹•ã\r\n    - ä»Šã®ã¨ã“ã‚å€‹äººå‘ã‘ã«`5G SA`ã‚’æä¾›ã—ã¦ã‚‹ã®ã¯ãƒ‰ã‚³ãƒ¢ã ã‘ï¼Ÿï¼ˆã—ã‹ã‚‚ã‚¨ãƒªã‚¢ã‚‚å°‘ãªã„ï¼‰\r\n\r\n# ãƒ‡ãƒ¥ã‚¢ãƒ«SIM å¯¾å¿œ\r\n\r\n`SubscriptionManager`ã‚’ä½¿ã†ã“ã¨ã§ã€ç«¯æœ«ã«å…¥ã£ã¦ã‚‹`SIMã‚«ãƒ¼ãƒ‰`ã®æƒ…å ±ã¨ã‹å–ã‚Œã¾ã™ã€‚  \r\nãƒ‡ãƒ¼ã‚¿ç”¨ / é€šè©±ç”¨ ã®SIMã‚«ãƒ¼ãƒ‰ãŒã©ã‚Œã‹ã‚’å–å¾—ã§ããŸã‚Šã—ã¾ã™ã€‚\r\n\r\nã¾ãŸã€`SubscriptionInfo#getSimSlotIndex`ã§å–å¾—ã§ãã‚‹å€¤ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§`SIMã‚«ãƒ¼ãƒ‰`ã‚’æŒ‡å®šã—ãŸ`TelephonyManager`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒä½œæˆã§ãã¾ã™ã€‚  \r\nã“ã‚Œã§`SIMã‚«ãƒ¼ãƒ‰`åˆ¥ã®`EARFCN`ã¨ã‹ãŒå–å¾—ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n// ãƒ‡ãƒ¼ã‚¿ç”¨SIMã‚«ãƒ¼ãƒ‰\r\nval subscriptionManager = getSystemService(Context.TELEPHONY_SUBSCRIPTION_SERVICE) as SubscriptionManager\r\nval dataUseSimSubscriptionId = SubscriptionManager.getActiveDataSubscriptionId()\r\nval dataUseSim = subscriptionManager.getActiveSubscriptionInfo(dataUseSimSubscriptionId)\r\n\r\ntextView.text = \"ãƒ‡ãƒ¼ã‚¿é€šä¿¡ã«æŒ‡å®šã•ã‚ŒãŸSIMã‚«ãƒ¼ãƒ‰ã®ã‚­ãƒ£ãƒªã‚¢å = ${dataUseSim.carrierName}\"\r\n\r\n// SIMã‚«ãƒ¼ãƒ‰ã‚’æŒ‡å®šã—ãŸ TelephonyManager ã‚’ä½œæˆã™ã‚‹\r\nval dataUseTelephonyManager = (getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager).createForSubscriptionId(dataUseSim.subscriptionId)\r\ndataUseTelephonyManager.requestCellInfoUpdate(mainExecutor, object : TelephonyManager.CellInfoCallback() {\r\n    override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\r\n        // EARFCN ã®å–å¾—ãªã©...\r\n    }\r\n})\r\n```\r\n\r\nãªã‚“ã‹å–ã‚Œãªã„æ™‚ãŒã‚ã£ãŸã®ã§ã€ç¢ºå®Ÿã«å–å¾—ã—ãŸã„å ´åˆã¯`SubscriptionManager#addOnSubscriptionsChangedListener`ã§ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã‚’è³¼èª­ã™ã‚‹ã®ãŒã„ã„ã¨æ€ã„ã¾ã™ï¼ˆå¤šåˆ†ï¼Ÿï¼‰\r\n\r\n```kotlin\r\nval subscriptionInfoCallback = object : SubscriptionManager.OnSubscriptionsChangedListener() {\r\n    override fun onSubscriptionsChanged() {\r\n        super.onSubscriptionsChanged()\r\n        // æ›´æ–°ã•ã‚ŒãŸã‚‰å‘¼ã°ã‚Œã‚‹\r\n        subscriptionManager.activeSubscriptionInfoList\r\n    }\r\n}\r\nsubscriptionManager.addOnSubscriptionsChangedListener(context.mainExecutor, subscriptionInfoCallback)\r\n```\r\n\r\n# è»¢ç”¨5G ã®æ¤œå‡º\r\nç§ã‚‚æœ€åˆã¯`n20`ã¨ã‹ãŒè»¢ç”¨5Gã§ã€`n77`ä»¥ä¸Šã‚’æ–°å‘¨æ³¢æ•°ã®5Gã ã‚ï½ï½—ï½—ã¨ã‹æ€ã£ã¦ãŸã®ã§ã™ãŒã€ã©ã†ã‚„ã‚‰é•ã†ã¿ãŸã„ã§è»¢ç”¨5Gã§ã‚‚ãƒãƒ³ãƒ‰ãŒ`n78`ã¨ã‹ã«ãªã‚‹ã¿ãŸã„ã§ã™ã€‚  \r\n`n78`ã®ç¯„å›²ã¯`3.3GHz ~ 3.8GHz`ã¾ã§ãªã®ã§ãƒãƒ³ãƒ‰ã‚’è¦‹ã‚‹ã ã‘ã§ã¯è»¢ç”¨5Gã®åˆ¤å®šãŒã§ããªã„ã€‚ï¼ˆ5Gå°‚ç”¨å‘¨æ³¢æ•°ãŒ`3.6GHz`ã‹ã‚‰ãªã®ã§ã€ã€ã€ï¼‰  \r\nå¤šåˆ†å‘¨æ³¢æ•°ãŒ`3.6GHz`æœªæº€ã®`5G`ã‚’`è»¢ç”¨5G`ã£ã¦è¨€ã†ã¨æ€ã†ã€ã€ã€ã®ã§ã€ã¾ãšå‘¨æ³¢æ•°ã‚’å–å¾—ã—ã¾ã™ã€‚(ã©ã†ã§ã‚‚ã„ã„ã‘ã©5Gå°‚ç”¨å‘¨æ³¢æ•°ï¼ˆæ–°å‘¨æ³¢æ•°ï¼‰ã‚’`3.7GHzå¸¯`ã¨ã‹è¨€ã†ã‚‰ã—ã„ã‚“ã ã‘ã©ã€å®Ÿéš›ã¯`3.6GHz`ã‹ã‚‰ã£ã½ã„ã§ã™ã€‚)  \r\n\r\nã‚‚ã—ã‹ã™ã‚‹ã¨ã“ã‚Œã¯æ—¥æœ¬ã ã‘ã‹ã‚‚ã—ã‚Œãªã„ã€‚  \r\nå‚è€ƒï¼šhttps://k-tai.watch.impress.co.jp/docs/column/keyword/1223471.html\r\n\r\nè©±ã‚’æˆ»ã—ã¦ã€å‘¨æ³¢æ•°ã‚’å–å¾—ã™ã‚‹æ–¹æ³•ã§ã™ãŒã€æ®‹å¿µãªãŒã‚‰ã“ã‚Œã‚‚ä¸€ç­‹ç¸„ã§ã¯è¡Œãã¾ã›ã‚“ï¼ˆ`getFrequency()`ã¿ãŸã„ãªãƒ¡ã‚½ãƒƒãƒ‰ã¯ãªã„ã€‚ï¼‰  \r\nã˜ã‚ƒã‚ã©ã†ã™ã‚‹ã‚“ã ã£ã¦è©±ã§ã™ãŒã€`NRARFCN`ã‹ã‚‰è¨ˆç®—ã‚’ã™ã‚‹ã“ã¨ã§ã€å‘¨æ³¢æ•°ï¼ˆ`3.6GHz`ï¼‰ã¿ãŸã„ãªå€¤ã‚’å‡ºã™ã“ã¨ãŒã§ãã¾ã™ï¼ï¼ï¼\r\n\r\nãã®è¨ˆç®—å¼ãŒã“ã“ã®è³‡æ–™ã«æ›¸ã„ã¦ã‚ã‚‹ï¼š3GPP TS 38.104 5.4.2.1  \r\n\r\n## NRARFCN ã‹ã‚‰ å‘¨æ³¢æ•°ã‚’è¨ˆç®—ã™ã‚‹\r\nã¯ã„ã€‚å˜ä½ã¯ MHz ã«ãªã‚Šã¾ã™ã€‚  \r\nå¿…è¦ãªå€¤ã¯`NRARFCN`ã®ã¿ã§ã€ã‚ã¨å¿…è¦ãªå€¤ã¯ä»¥ä¸‹ã®è¡¨ã‹ã‚‰æŒã£ã¦ãã¾ã™ã€‚\r\n\r\n```plaintext\r\nFREF = FREF-Offs + Î”FGlobal (NRARFCN â€“ NREF-Offs)\r\n```\r\n\r\n| NRARFCN ã®ç¯„å›²       | Î”FGlobal (MHz) | FREF-Offs (MHz) | NREF-Offs |\r\n|----------------------|----------------|-----------------|-----------|\r\n| 0 ã‹ã‚‰ 599999        | 0.005          | 0               | 0         |\r\n| 600000 ã‹ã‚‰ 2016666  | 0.015          | 3000            | 600000    |\r\n| 2016667 ã‹ã‚‰ 3279165 | 0.060          | 24250.08        | 2016667   |\r\n\r\nï¼ˆã‚½ãƒ¼ã‚¹ï¼š3GPP TS 38.104 Table 5.4.2.1-1: NR-ARFCN parameters for the global frequency rasterï¼‰\r\n\r\n### ä¾‹\r\n\r\nä¾‹ãˆã°`NRARFCN`ãŒ`643334`ã ã£ãŸå ´åˆã¯ã€  \r\nä¸Šã®è¡¨ã‚’ä½¿ã„ã€`NRARFCN ã®ç¯„å›²`ã‹ã‚‰`600000 ã‹ã‚‰ 2016666`ã«è©²å½“ã—ã¾ã™ã€‚ã‚ã¨ã¯æ¨ªã«ãªãã£ã¦`Î”FGlobal (MHz) = 0.015 / FREF-Offs (MHz) = 3000 / NREF-Offs = 600000`ãŒãã‚Œãã‚Œåˆ¤æ˜ã—ã¾ã™ã€‚  \r\nã‚ã¨ã¯å…¬å¼ã«å½“ã¦ã¯ã‚ã¾ã™ã€‚  \r\n\r\n```plaintext\r\nFREF = FREF-Offs + Î”FGlobal (NRARFCN â€“ NREF-Offs)\r\n```\r\n```plaintext\r\n3000 + 0.015 (643334 â€“ 600000) = 3650.01\r\n```\r\n\r\nã¨ã„ã†ã‚ã‘ã§å‘¨æ³¢æ•°ã¯`3650.01 MHz`ã€å¤šåˆ†æ–°å‘¨æ³¢æ•°ã®`5G`ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n### ä¾‹2\r\nåŒã˜`n78`ã§ã‚‚è»¢ç”¨5Gã®å¯èƒ½æ€§ãŒã‚ã‚‹`NRARFCN`ãŒ`635424`ã‚‚è¨ˆç®—ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\r\nã“ã¡ã‚‰ã‚‚åŒæ§˜ã€ä¸Šã®è¡¨ã‚’ä½¿ã„`NRARFCN ã®ç¯„å›²`ã‹ã‚‰`600000 ã‹ã‚‰ 2016666`ã«è©²å½“ã—ã€æ¨ªã«ãªãã£ã¦`Î”FGlobal (MHz) = 0.015 / FREF-Offs (MHz) = 3000 / NREF-Offs = 600000`ãŒåˆ¤æ˜ã—ã¦ã€\r\n\r\n```plaintext\r\nFREF = FREF-Offs + Î”FGlobal (NRARFCN â€“ NREF-Offs)\r\n```\r\n```plaintext\r\n3000 + 0.015 (635424 â€“ 600000) = 3531.36\r\n```\r\n\r\n`3531.36 MHz`ã«ãªã‚Šã¾ã—ãŸã€‚ã“ã‚Œã¯å¤šåˆ†è»¢ç”¨5Gã«ãªã‚Šã¾ã™ã€‚`au`ã®ã‚‚ã®ã§ã™ãŒã€`3.5GHz`ã¯4Gã¨åŒã˜æ—¨ãŒã‚¨ãƒªã‚¢ãƒãƒƒãƒ—ã®ã¨ã“ã‚ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§å¤šåˆ†æ­£è§£ã§ã—ã‚‡ã†ã€‚\r\n\r\n### Kotlin å®Ÿè£…ä¾‹\r\nKotlinã®æ©Ÿèƒ½ã‚’ä½¿ã£ã¦æ¥½ã‚’ã—ã¦ã„ã¾ã™ãŒã€ç‰¹ã«é›£ã—ã„ã“ã¨ã¯ã—ã¦ã„ãªã„ã®ã§ä»–ã®è¨€èªã§ã‚‚ç°¡å˜ã«ä½œã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * NRARFCN ã‹ã‚‰ å‘¨æ³¢æ•°ã‚’æ±‚ã‚ã‚‹ã€‚\r\n * è¨ˆç®—å¼ã¯ã€Œ3GPP TS 38.104 5.4.2.1ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚\r\n *\r\n * @return å‘¨æ³¢æ•°ã€‚å˜ä½ã¯ MHz ã€‚3600ã¨ã‹ã€‚\r\n */\r\nfun toFrequencyMHz(nrarfcn: Int): Float {\r\n    // è¨ˆç®—ã«å¿…è¦ãªã€ FREF-Offs / FGlobal / NREF-Offs ã‚’ NRARFCN ã‹ã‚‰å‡ºã™\r\n    // è³‡æ–™ã§ã¯ FGlobal ã¯ kHz ã ãŒã€ MHz ã«åˆã‚ã›ã‚‹ãŸã‚å¤‰æ›ã—ã¦ã„ã‚‹\r\n    val (FGlobal, FREFOffs, NREFOffs) = when (nrarfcn) {\r\n        // 3 GHz ä»¥ä¸‹\r\n        in 0..599999 -> Triple(0.005f, 0f, 0)\r\n        // 3 GHz ã‹ã‚‰ 24.25 GHz\r\n        in 600000..2016666 -> Triple(0.015f, 3000f, 600000)\r\n        // 24.25 GHz ä»¥ä¸Š\r\n        in 2016667..3279165 -> Triple(0.060f, 24250.08f, 2016667)\r\n        // ã‚ã‚Šãˆãªã„ã®ã§é©å½“ã«return\r\n        else -> return -1f\r\n    }\r\n    // FREFOffs + FGlobal( NRARFCN - NREFOffs ) ã®è¨ˆç®—ã‚’ã™ã‚‹\r\n    val frequencyMHz = FREFOffs + ((FGlobal * nrarfcn) - (FGlobal * NREFOffs))\r\n    // å°æ•°ç‚¹ç¬¬äºŒä½ã¾ã§ã«ã™ã‚‹\r\n    return \"%.2f\".format(frequencyMHz).toFloat()\r\n}\r\n```\r\n\r\n#### çµ„ã¿åˆã‚ã›ä¾‹\r\nã“ã‚“ãªæ„Ÿã˜ã«ä½¿ãˆã¾ã™\r\n\r\n```kotlin\r\n\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n\r\n    // çœç•¥...\r\n\r\n    val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\r\n    telephonyManager.requestCellInfoUpdate(mainExecutor, object : TelephonyManager.CellInfoCallback() {\r\n        override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\r\n            // 5G ã®ã¿\r\n            val info = cellInfo.filterIsInstance<CellInfoNr>().firstOrNull() ?: return\r\n            val cellIdentityNr = info.cellIdentity as CellIdentityNr\r\n            val frequency = toFrequencyMHz(cellIdentityNr.nrarfcn)\r\n            println(\"\"\"\r\n                NRARFCN = ${cellIdentityNr.nrarfcn}\r\n                å‘¨æ³¢æ•° = ${frequency}\r\n            \"\"\".trimIndent())\r\n        }\r\n    })\r\n    // I/System.out: NRARFCN = 635424\r\n    // I/System.out: å‘¨æ³¢æ•° = 3531.36\r\n}\r\n\r\n/**\r\n * NRARFCN ã‹ã‚‰ å‘¨æ³¢æ•°ã‚’æ±‚ã‚ã‚‹ã€‚\r\n * è¨ˆç®—å¼ã¯ã€Œ3GPP TS 38.104 5.4.2.1ã€ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚\r\n *\r\n * @return å‘¨æ³¢æ•°ã€‚å˜ä½ã¯ MHz ã€‚3600ã¨ã‹ã€‚\r\n */\r\nfun toFrequencyMHz(nrarfcn: Int): Float {\r\n    // è¨ˆç®—ã«å¿…è¦ãªã€ FREF-Offs / FGlobal / NREF-Offs ã‚’ NRARFCN ã‹ã‚‰å‡ºã™\r\n    // è³‡æ–™ã§ã¯ FGlobal ã¯ kHz ã ãŒã€ MHz ã«åˆã‚ã›ã‚‹ãŸã‚å¤‰æ›ã—ã¦ã„ã‚‹\r\n    val (FGlobal, FREFOffs, NREFOffs) = when (nrarfcn) {\r\n        // 3 GHz ä»¥ä¸‹\r\n        in 0..599999 -> Triple(0.005f, 0f, 0)\r\n        // 3 GHz ã‹ã‚‰ 24.25 GHz\r\n        in 600000..2016666 -> Triple(0.015f, 3000f, 600000)\r\n        // 24.25 GHz ä»¥ä¸Š\r\n        in 2016667..3279165 -> Triple(0.060f, 24250.08f, 2016667)\r\n        // ã‚ã‚Šãˆãªã„ã®ã§é©å½“ã«return\r\n        else -> return -1f\r\n    }\r\n    // FREFOffs + FGlobal( NRARFCN - NREFOffs ) ã®è¨ˆç®—ã‚’ã™ã‚‹\r\n    val frequencyMHz = FREFOffs + ((FGlobal * nrarfcn) - (FGlobal * NREFOffs))\r\n    // å°æ•°ç‚¹ç¬¬äºŒä½ã¾ã§ã«ã™ã‚‹\r\n    return \"%.2f\".format(frequencyMHz).toFloat()\r\n}\r\n```\r\n\r\n# Snapdragonç«¯æœ«ã§å‹•ãã‚ˆã†ã«ä¿®æ­£\r\nç°¡å˜ã«è¨€ã†ã¨`Google Tensor`ã¨`Qualcomm Snapdragon`ã§`TelephonyManager#getAllCellInfo`é–¢æ•°ã®è¿”ã‚Šå€¤ãŒé•ã†ï¼ˆã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ç‰ˆã‚‚ãã†ï¼‰ã®ãŒåŸå› ã§ã—ãŸã€ã€ã€  \r\n\r\n## ä½•ãŒé•ã†ã®ã‹\r\n5G ã® ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (NSA) æ–¹å¼ã®å ´åˆã«æŒ™å‹•ãŒé•ã†ã£ã½ã„\r\n\r\n`TelephonyManager#getAllCellInfo`ã®è¿”ã‚Šå€¤ãŒ\r\n\r\n- Google Tensor ç«¯æœ«ã®å ´åˆ\r\n    - CellInfoNr ãŒä¸€ã¤ã ã‘å…¥ã£ãŸé…åˆ—\r\n    - `[CellInfoNr]`\r\n- Qualcomm Snapdragon ç«¯æœ«ã®å ´åˆ\r\n    - NSA ã®å ´åˆã¯ CellInfoLte ã¨ CellInfoNr ãŒé…åˆ—ã«å…¥ã£ã¦ã‚‹\r\n    - å°‘ãªãã¨ã‚‚ CellInfoNr ã¯æœ€åˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã«ã¯ç„¡ã„ï¼Ÿ\r\n    - `[CellInfoLte, CellInfoNr...]`\r\n\r\nã§ã€ã“ã®ã‚¢ãƒ—ãƒªã¯`CellInfoNr`ãŒ**é…åˆ—ã®æœ€åˆ**ã«å…¥ã£ã¦ã‚‹å‰æã§å‹•ã„ã¦ãŸã®ã§ã€ã‚¹ãƒŠãƒ‰ãƒ©ç«¯æœ«ã®å ´åˆã§å…¨æ»…ã—ã¾ã™ã€‚ï¼ˆ`Google Pixel`ã§å‹•ã‘ã°ä»–ã§ã‚‚å‹•ãã‚„ã‚ã¨æ€ã£ã¦ãŸï¼‰  \r\nã©ã£ã¡ãŒæ­£è§£ãªã®ã‹ã¯åˆ†ã‹ã‚‰ãªã„ã®ã§ã™ãŒã€ã€ã€`5G ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³(NSA) æ–¹å¼`ã®å ´åˆã¯4Gã«ã‚‚æ¥ç¶šã—ã¦ã„ã‚‹ã¯ãšï¼Ÿãªã®ã§`CellInfoLte`ãŒé…åˆ—ã«å…¥ã£ã¦ãªã„ã¨ãŠã‹ã—ã„æ°—ãŒã—ã¾ã™ã€ã€ã€ã€‚  \r\nä¿®æ­£ã¨ã—ã¦ã¯ã€æœ€åˆã®è¦ç´ ã§ã¯ãªã`CellInfoNr`ã‚’é…åˆ—ã®ä¸­ã‹ã‚‰æ¢ã™ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã—ãŸã€‚\r\n\r\n```diff\r\n                     /** å®Ÿéš›ã®çŠ¶æ…‹ */\r\n                     override fun onCellInfoChanged(cellInfo: MutableList<CellInfo?>) {\r\n-                        // æ©Ÿå†…ãƒ¢ãƒ¼ãƒ‰ã‹ã‚‰å¾©å¸°æ™‚ãªã©ã«ã™ãé–‹ãã¨ãªã‚“ã‹è½ã¡ã‚‹ã®ã§\r\n-                        tempBandData = cellInfo.getOrNull(0)?.let { convertBandData(it) }\r\n+                        // CellInfoNrã‚’æ¢ã—ã¦ã€ã‚‚ã—ãªã„å ´åˆã¯ 4G ã«ã™ã‚‹\r\n+                        // Qualcomm Snapdragon ç«¯æœ« ã¨ Google Tensor ç«¯æœ« ã§æŒ™å‹•ãŒé•ã†\r\n+                        // Google Tensor ã®å ´åˆã¯é…åˆ—ã®æœ€åˆã« CellInfoNr ãŒã‚ã‚‹ã¿ãŸã„ã€‚\r\n+                        // Qualcomm Snapdragon ã®å ´åˆã€é…åˆ—ã®ã©ã£ã‹ã« CellInfoNr ãŒã‚ã‚‹ã¿ãŸã„ã€‚\r\n+                        // ã§ã€ Qualcomm Snapdragon ã®å ´åˆã§ CellInfoNr ãŒå–ã‚Œãªã„å ´åˆãŒã‚ã‚‹ï¼ˆ CellSignalStrengthNr ã ã‘å–ã‚Œã‚‹ã€‚ãƒãƒ³ãƒ‰ã¨ã‹ã¯å–ã‚Œãªã„ã‘ã©5Gã®é›»æ³¢å¼·åº¦ãŒå–ã‚Œã‚‹ï¼Ÿï¼‰\r\n+                        // ãªã„å ´åˆã¯ 4G ã‹ ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ï¼Ÿ\r\n+                        tempBandData = cellInfo.filterIsInstance<CellInfoNr>().firstOrNull()?.let { convertBandData(it) } ?: cellInfo.firstOrNull()?.let { convertBandData(it) }\r\n                         sendResult()\r\n                     }\r\n```\r\n\r\n### ãƒ¡ãƒ¢\r\næ‰‹æŒã¡ã«ç«¯æœ«ãŒãªã„ã®ã§ãªã‚“ã¨ã‚‚è¨€ãˆãªã„ã®ã§ã™ãŒã€`5G ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³(SA) æ–¹å¼`ã®å ´åˆã¯ã‚¹ãƒŠãƒ‰ãƒ©ç«¯æœ«ã§ã‚‚`CellInfoNr`ã—ã‹é…åˆ—ã«å…¥ã‚‰ãªã„ã¯ãšï¼Ÿï¼Ÿï¼Ÿãªã®ã§å‹•ã„ã¦ãŸã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚  \r\n~~5G NSAãŒç‰¹æ®Šã™ãã‚‹ã‚“ã‚„ã€ã€ã€~~\r\n\r\n# ã‚ˆã‚Šå¤šãã®ç«¯æœ«ã§5Gã‚’æ¤œå‡ºã™ã‚‹\r\n`Qualcomm Snapdragon`ã®ç«¯æœ«ã®å ´åˆã§ã‹ã¤å¤ã‚ã®ç«¯æœ«ï¼Ÿç†ç”±ã¯åˆ†ã‹ã‚‰ãªã„ã®ã§ã™ãŒã€`5G`ã«æ¥ç¶šã—ã¦ã„ã¦ã‚‚`CellInfoNr`ãŒå–å¾—ã§ããªã„ã“ã¨ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆã—ã‹ã—5Gã«ã¯æ¥ç¶šã§ãã¦ã„ã‚‹ã‚ˆã†ã§ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ã§ã¯ãªã•ãã†ã€ã‚‚ã¡ã‚ã‚“`RATè¡¨ç¤º`ã‚‚`5G`ã«ãªã£ã¦ã‚‹ï¼‰  \r\nã§ã€ã„ã‚ã„ã‚è¦‹ãŸçµæœ `CellInfoNr` ã¯å–å¾—ã§ããªã„ã‘ã©`5G`ã«æ¥ç¶šã§ãã¦ã„ã‚‹å ´åˆã€`CellSignalStrengthNr`ãŒå–å¾—ã§ãã‚‹ã‚‰ã—ã„ã§ã™ï¼ˆé›»æ³¢å¼·åº¦ã¨ã‹ãŒå…¥ã£ã¦ã‚‹ï¼‰  \r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€`CellInfoNr`ãŒå–ã‚Œãš`4G`ã®å ´åˆã§ã‚‚ã€`CellSignalStrengthNr`ãŒå–ã‚ŒãŸå ´åˆã¯`ã‚‚ã—ã‹ã—ã¦5G`ã®è¡¨ç¤ºã«ã—ã¦ã„ã¾ã™ã€‚  \r\né›»æ³¢å¼·åº¦ã ã‘å–å¾—ãªã®ã§ã€æ¥ç¶šä¸­ã®ãƒãƒ³ãƒ‰ã¨ã‹ã¯4Gã®ã¾ã¾ã«ãªã‚Šã¾ã™ã€‚ï¼ˆãƒã‚¹ã‚¿ãƒ¼ãƒãƒ¼ãƒ‰ï¼Ÿãƒ—ãƒ©ã‚¤ãƒãƒªãƒ¼ã‚»ãƒ«ï¼Ÿã®æƒ…å ±ï¼‰\r\n\r\nhttps://github.com/takusan23/NewRadioSupporter/blob/afca30269ce8e80cc4efea944560f00904c46473/app/src/main/java/io/github/takusan23/newradiosupporter/tool/NetworkCallbackTool.kt#L88\r\n\r\nã‚ˆã‚Šå¤šãã®ç«¯æœ«ã§5Gã‚’æ¤œå‡ºï¼ˆæ¤œå‡ºã ã‘ï¼ï¼‰ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹å ´åˆã¯`CellSignalStrengthNr`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå–å¾—ã§ãã‚‹ã‹ã©ã†ã‹ã‚’è¿½åŠ ã™ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ï¼ˆå¾Œè¿°ï¼‰\r\n\r\n## å®Ÿè£…ä¾‹\r\n\r\n`TelephonyManager#getAllCellInfo`ã§ã¯ãªãã€`TelephonyManager#getSignalStrength`ã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§`5G`ã‹ã©ã†ã‹ã‚’åˆ¤å®šã§ãã¾ã™ã€‚  \r\n`callbackFlow`ä¾¿åˆ©ã§ã™ã­ã€‚\r\n\r\n```kotlin\r\n/** å°‘ãªãã¨ã‚‚ 5G ã«æ¥ç¶šã—ã¦ã„ã‚‹å ´åˆã¯ true ã‚’è¿”ã™ (ã‚¢ãƒ³ã‚«ãƒ¼ãƒãƒ³ãƒ‰ / 4G ã¯ false) */\r\n@OptIn(ExperimentalCoroutinesApi::class)\r\nfun collectNrCheck() = callbackFlow {\r\n    var tempCellSignalStrength: CellSignalStrength? = null\r\n\r\n    fun sendResult() {\r\n        // Flow ã§è¿”ã™\r\n        trySend(tempCellSignalStrength != null)\r\n    }\r\n\r\n    val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\r\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.S) {\r\n        val telephonyCallback = object : TelephonyCallback(), TelephonyCallback.SignalStrengthsListener {\r\n            // 5G ã«æ¥ç¶šã—ã¦ã„ã‚‹ã®ã«ã‚‚ã‹ã‹ã‚ã‚‰ãšã€CellInfoNr ãŒå–å¾—ã§ããªã„ã“ã¨ãŒã‚ã‚‹ã€‚ãŒã€ãã®å ´åˆã§ã‚‚ CellSignalStrengthNr ãŒå–å¾—ã§ãã‚‹\r\n            override fun onSignalStrengthsChanged(signalStrength: SignalStrength) {\r\n                tempCellSignalStrength = signalStrength.getCellSignalStrengths(CellSignalStrengthNr::class.java).firstOrNull()\r\n                sendResult()\r\n            }\r\n        }\r\n        telephonyManager.registerTelephonyCallback(mainExecutor, telephonyCallback)\r\n        awaitClose { telephonyManager.unregisterTelephonyCallback(telephonyCallback) }\r\n    } else {\r\n        val phoneStateListener = object : PhoneStateListener() {\r\n            override fun onSignalStrengthsChanged(signalStrength: SignalStrength?) {\r\n                super.onSignalStrengthsChanged(signalStrength)\r\n                tempCellSignalStrength = signalStrength?.getCellSignalStrengths(CellSignalStrengthNr::class.java)?.firstOrNull()\r\n                sendResult()\r\n            }\r\n        }\r\n        telephonyManager.listen(phoneStateListener, PhoneStateListener.LISTEN_SIGNAL_STRENGTHS)\r\n        awaitClose { telephonyManager.listen(phoneStateListener, PhoneStateListener.LISTEN_NONE) }\r\n    }\r\n}\r\n```\r\n\r\nåˆ©ç”¨å´ã§ã“ã‚“ãªæ„Ÿã˜ã«ï¼ˆåˆ¥ã«`JetpackCompose`ã§ã‚ã‚‹å¿…è¦ã‚‚ãªã„ã§ã™ãŒï¼‰\r\n\r\n```kotlin\r\n// Flow ã§ 5G ã‹ã©ã†ã‹ã‚’ç›£è¦–ã™ã‚‹\r\nval isNewRadio by remember { collectNrCheck() }.collectAsState(initial = false)\r\n\r\nColumn(\r\n    horizontalAlignment = Alignment.CenterHorizontally,\r\n    verticalArrangement = Arrangement.Center\r\n) {\r\n    if (isNewRadio) {\r\n        Text(text = \"5Gã«æ¥ç¶šã—ã¦ã„ã¾ã™\")\r\n    } else {\r\n        Text(text = \"4Gã«æ¥ç¶šã—ã¦ã„ã¾ã™\")\r\n    }\r\n}\r\n```\r\n\r\nä¸€å¿œããƒ¼ã™ã“ãƒ¼ã©  \r\nhttps://github.com/takusan23/AndroidNrCheckerMoreDevice\r\n\r\n\r\n# ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (NSA) / ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ (SA) æ¤œå‡º\r\nã™ã§ã«å¯¾å¿œæ¸ˆã¿ã§ã™ãŒã€ç§ã¯è©¦ã›ã¦ãªã„ã®ã§æœ¬å½“ã«æ¤œå‡ºã§ãã¦ã‚‹ã‹ã¯åˆ†ã‹ã‚“ãªã„ã§ã™ã€ã€ã€ï¼ˆ`docomoã® 5G SA`ã£ã¦ã‚ã‚Œãƒ‰ã‚³ãƒ¢ç«¯æœ«ã ã‘ï¼Ÿï¼‰  \r\nAOSPã¨ã‹çœºã‚ã¦ã‚‹æ„Ÿã˜ï¼Ÿ`TelephonyManager#getDataNetworkType`ã§`NSA / SA`åˆ¤å®šãŒè¡Œãˆã‚‹ã¯ãšã§ã™ã€‚  \r\n\r\nã©ã†ã‚„ã‚‰`ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³ 5G`ã¯Androidå†…éƒ¨ã§ã¯`4G`åˆ¤å®šã‚‰ã—ãã€`5G`è¡¨ç¤ºã‚’ä¸Šæ›¸ãã™ã‚‹å‡¦ç†ã®ã‚ˆã†ã§ã™ã€‚  \r\n\r\n```kotlin\r\n/**\r\n * [TelephonyDisplayInfo]ã¨[TelephonyManager.getDataNetworkType]ã‚’è¦‹ã¦5GãŒ NSA/SA ã®ã©ã£ã¡ã§æ¥ç¶šã•ã‚Œã¦ã„ã‚‹ã‹åˆ¤åˆ¥ã™ã‚‹\r\n *\r\n * @param telephonyDisplayInfo [TelephonyCallback.DisplayInfoListener]ã§å–ã‚Œã‚‹ã‚„ã¤\r\n * @param dataNetworkType [TelephonyManager.getDataNetworkType]ã®å€¤\r\n * @return [NrStandAloneType]ã€‚5G ä»¥å¤–ã¯ [NrStandAloneType.ERROR]\r\n */\r\nfun convertStandAloneType(telephonyDisplayInfo: TelephonyDisplayInfo, dataNetworkType: Int) = when {\r\n    /**\r\n     * 5G ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³å½¢å¼ (SA)\r\n     * [TelephonyManager.getDataNetworkType]ãŒ[TelephonyManager.NETWORK_TYPE_NR]ã‚’è¿”ã™\r\n     */\r\n    dataNetworkType == TelephonyManager.NETWORK_TYPE_NR -> NrStandAloneType.STAND_ALONE\r\n    /**\r\n     * 5G ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³æ–¹å¼ (NSA)\r\n     * [TelephonyManager.getDataNetworkType]ãŒ[TelephonyManager.NETWORK_TYPE_LTE]ã‚’è¿”ã—ï¼ˆãªã‚“ã¨ï¼ï¼‰ã€\r\n     * [TelephonyDisplayInfo.getOverrideNetworkType]ãŒ NR ã‚’è¿”ã™\r\n     */\r\n    dataNetworkType == TelephonyManager.NETWORK_TYPE_LTE &&\r\n            (telephonyDisplayInfo.overrideNetworkType == TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_ADVANCED\r\n                    || telephonyDisplayInfo.overrideNetworkType == TelephonyDisplayInfo.OVERRIDE_NETWORK_TYPE_NR_NSA) -> NrStandAloneType.NON_STAND_ALONE\r\n    // 5Gã˜ã‚ƒãªã„\r\n    else -> NrStandAloneType.ERROR\r\n}\r\n\r\n/**\r\n * 5Gã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æ–¹å¼ã€å‹•ä½œæœªç¢ºèª\r\n * Non StandAlone / StandAlone / 5Gä»¥å¤–\r\n */\r\nenum class NrStandAloneType {\r\n    /** 5G ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³å½¢å¼ */\r\n    STAND_ALONE,\r\n\r\n    /** 5G ãƒãƒ³ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ¼ãƒ³å½¢å¼ */\r\n    NON_STAND_ALONE,\r\n\r\n    /** 5G ã˜ã‚ƒãªã„ */\r\n    ERROR\r\n}\r\n```\r\n\r\n# TelephonyCallback.CellInfoListenerã® @NonNull ã¯å˜˜\r\nãƒªãƒªãƒ¼ã‚¹å¾Œã€`Kotlin`ã§æ›¸ã„ã¦ã‚ã‚‹éƒ¨åˆ†ã§ãªãœã‹`ã¬ã‚‹ã½`ã§è½ã¡ã¦ã‚‹ã‚“ã§ã™ã‚ˆã­ã€  \r\nãã‚“ãª ã¬ã‚‹ã½ ã«ãªã‚‹å ´æ‰€ãªã‚“ã¦ã‚ã£ãŸã‹ãªã€ã€ã¨æ€ã„è¦‹ã¦ã¿ãŸã®ã§ã™ãŒã€ã©ã†ã‚„ã‚‰ã“ã‚Œ`Android`ãŒæ‚ªã„ã‚“ã§ã™ã‚ˆã­ã€‚\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«`@NonNull`ãŒæ›¸ã„ã¦ã‚ã‚‹ã®ã§`null`ãŒå…¥ã‚‰ãªã„ã¨**ç§ã‚‚Kotlin**ã‚‚æ€ã£ã¦ãŸã®ã§ã™ãŒã€ä¸€éƒ¨ã®æ¡ä»¶ã§`null`ã«ãªã‚‹ã‚“ã§ã™ã‚ˆã­ã€ã€  \r\nï¼ˆä¸€éƒ¨ã®æ¡ä»¶ï¼šå†èµ·å‹•ã—ãŸã‚ã¨ã™ãèµ·å‹•ã™ã‚‹ã¨`null`ã«ãªã‚‹ã€‚Issue ã«ã¡ã‚‡ã†ã©ã‚ã£ã¦å†ç¾ã‚‚ã—ãŸï¼šhttps://issuetracker.google.com/issues/237308373ï¼‰\r\n\r\n```java\r\npublic interface CellInfoListener {\r\n    @RequiresPermission(allOf = {\r\n            Manifest.permission.READ_PHONE_STATE,\r\n            Manifest.permission.ACCESS_FINE_LOCATION\r\n    })\r\n    void onCellInfoChanged(@NonNull List<CellInfo> cellInfo);\r\n}\r\n```\r\n\r\n`Javaï¼ˆAndroidã®NonNullï¼‰`ã®å ´åˆã€`@NonNull`ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«`null`ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ãã«è­¦å‘ŠãŒå‡ºã‚‹ç¨‹åº¦ãªã®ã§å®Ÿéš›ã«å®Ÿè¡Œä¸­ã«`null`ã«ãªã£ã¦ã‚‚ã€ç‰¹ã«ä½•ã‚‚ãªãå‹•ãã¾ã™ã€ã€ã€  \r\nä¸€æ–¹ã€`Kotlin`ã®å ´åˆã¯`Android ã® @NonNull ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³`ã‚‚`NonNull`ã¨ã—ã¦æ‰±ã†ä¸Šã€`NonNull`ã®å ´åˆå®Ÿè¡Œæ™‚ã‚‚`null`ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æŒ¿å…¥ã™ã‚‹ãŸã‚ã€`null`ã‚’æ¸¡ã—ã¦å‘¼ã³å‡ºã—ãŸå ´åˆã¯è½ã¡ã¦ã—ã¾ã„ã¾ã™ã€‚  \r\nè©³ã—ã„è©±â†’ http://takusan.negitoro.dev/posts/android_nonnull_annotation_kotlin/\r\n\r\n```kotlin\r\nval callback = object : TelephonyCallback(), TelephonyCallback.CellInfoListener {\r\n   \r\n    override fun onCellInfoChanged(cellInfo: MutableList<CellInfo>) {\r\n        // ãƒ“ãƒ«ãƒ‰æ™‚ã«ã“ã“ã« cellInfo ãŒ null ã§ã¯ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒä»¥ä¸‹ã®ã‚ˆã†ã«æŒ¿å…¥ã•ã‚Œã‚‹\r\n        // Intrinsics.checkNotNullExpressionValue(...)\r\n        // cellInfo\r\n    }\r\n\r\n}\r\n```\r\n\r\nå¯¾ç­–ã¨ã—ã¦ã¯ã€`Java`ã§ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã—ã€`TelephonyCallback.onCellInfoChanged`ã‚’ç¶™æ‰¿ã—ã¦ã€å¼•æ•°ã®éƒ¨åˆ†ã®`@NonNull`ã‚’`@Nullable`ã«ç½®ãæ›ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ã¨å‹•ãã¯ãšã§ã™ã€‚  \r\n\r\n```java\r\n/** NonNull ãŒä»˜ã„ã¦ã„ã‚‹ãŒã€onCellInfoChanged ã‚’ null ã§å‘¼ã³å‡ºã™äº‹ãŒã‚ã‚‹ãŸã‚ã€Nullable ã«ã—ãŸã‚‚ã® */\r\n@RequiresApi(api = Build.VERSION_CODES.S)\r\npublic interface NullableCellInfoListener extends TelephonyCallback.CellInfoListener {\r\n\r\n    @Override\r\n    void onCellInfoChanged(@Nullable List<CellInfo> cellInfo);\r\n}\r\n```\r\n\r\n```kotlin\r\nval callback = object : TelephonyCallback(), NullableCellInfoListener {\r\n    override fun onCellInfoChanged(cellInfo: MutableList<CellInfo>?) {\r\n        // nullable ã«ãªã£ãŸ\r\n    }\r\n}\r\n```\r\n\r\n# é›»æ³¢é–¢é€£ã®Issue\r\n- https://issuetracker.google.com/issues/145308680\r\n    - `NSA`ã®å ´åˆ`CellInfo`ãŒè¿”ã£ã¦ãã‚‹ã‹ã¯ãƒ¡ãƒ¼ã‚«ãƒ¼æ¬¡ç¬¬\r\n    - `CellInfoNr`ãŒå–ã‚Œãªãã¦ã‚‚`SignalStrengthNr`ãŒå–ã‚Œã‚‹å ´åˆãŒã‚ã‚‹\r\n- https://issuetracker.google.com/issues/190423022\r\n    - `Exynos`ã§æŒ™å‹•ãŒé•ã†ã‚‰ã—ã„\r\n        - `Google Tensor`ã‚‚`Exynos`ã¨åŒã˜ãƒ¢ãƒ‡ãƒ ã‚’ä½¿ã£ã¦ãŸã¯ãšãªã®ã§åŒã˜å½±éŸ¿ã‚’å—ã‘ãã†æ„Ÿ\r\n\r\n# NewRadioSupporter ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/NewRadioSupporter\r\n\r\nå¯©æŸ»æå‡ºï¼  \r\n\r\n![Imgur](https://imgur.com/JY0Itt0.png)\r\n\r\n# ãŠã‚ã‚Šã«1\r\né›»æ¸¬APIã¯AOSPãŒã©ã†ã“ã†ã€ã‚ˆã‚Šã‚‚ãƒ¢ãƒ‡ãƒ ã®ãƒ™ãƒ³ãƒ€ãƒ¼æ¬¡ç¬¬ãªã¨ã“ã‚ãŒã‚ã‚‹ã®ã§ã€`Issue Tracker`ã«æ›¸ã„ã¦ã‚‚å¤šåˆ†ç„¡ç†ã£ã¦è¨€ã‚ã‚Œã‚‹ã ã‘ã ã¨æ€ã„ã¾ã™ï¼›ï¼›\r\n\r\n# ãŠã‚ã‚Šã«2\r\n`Xperia`ã£ã¦`SIMãƒ”ãƒ³`ãªãã¦ã‚‚SIMãƒˆãƒ¬ãƒ¼ã‚’å¼•ãå‡ºã›ã‚‹ã‚“ã§ã™ã‘ã©ã€ã“ã‚Œä¾¿åˆ©ã§ã™ã­ã€‚\r\n\r\n# ãŠã‚ã‚Šã«3\r\nau / Softbank ãŒè»¢ç”¨5Gã—ã¦ã‚‹ã›ã„ãªã®ã‹ã€ã¯ãŸã¾ãŸ Snapdragonæ­è¼‰ç«¯æœ« ã ã‹ã‚‰ãªã®ã‹ã¯çŸ¥ã‚‰ãªã„ã®ã§ã™ãŒã€5Gã®æ´ã¿ãŒã„ã„æ°—ãŒã—ã¾ã—ãŸã€‚ï¼ˆPixelã‚ˆã‚Šæ´ã‚€ã®ã‹ãªï¼Ÿï¼‰  \r\nè»¢ç”¨5Gã ã¨å°‘ã—æ­©ã‘ã°æ´ã‚€ã®ã§å‹•ä½œç¢ºèªãŒãšã„ã¶ã‚“æ¥½ã«ãªã‚Šã¾ã™ã­ï¼ˆãƒ‰ã‚³ãƒ¢ã‚·ãƒ§ãƒƒãƒ—ã«ã„ã‹ãªãã¦ã‚‚æ¸ˆã‚€ï¼‰\r\n\r\nãã—ã¦ãƒ‰ã‚³ãƒ¢ã‚‚è»¢ç”¨5Gã‚’å§‹ã‚ãŸã¿ãŸã„ï¼ˆå…¬å¼ç™ºè¡¨æ¸ˆã¿ã€é‹ç”¨ã‚‚å§‹ã¾ã£ã¦ã‚‹ã¨ã‹ãªã‚“ã¨ã‹ï¼Ÿï¼‰ãªã®ã§ã™ãŒã€ãªã‚“ã‹ãƒ‰ã‚³ãƒ¢ç«¯æœ«ä»¥å¤–ã¯æ¥ç¶šã§ããªã„ã‚‰ã—ã„ï¼Ÿï¼ˆç§ã¯æŒã£ã¦ãªã„ï¼‰ã€‚  \r\n**ã—ã‹ã—å™‚ã«ã‚ˆã‚‹ã¨è»¢ç”¨ã§ã‚‚`80MHz`ã‚’ä½¿ã†ã¨ã“ã‚ãŒã‚ã‚‹ã‚‰ã—ã„ã®ã§çµæ§‹é€Ÿãã†**ï¼ˆæ–°å‘¨æ³¢æ•°å¸¯ã®5GãŒ`100MHz ~`ãªã®ã§8å‰²ãã‚‰ã„ã¯å‡ºã‚‹ï¼Ÿï½—ï½‹ï½”ï½‹ï¼‰ã€‚\r\n\r\nè¡€ã‚’è¦‹ã‚‹ã¨åŠ›ãŒæŠœã‘ã¦ãã®ã£ã¦æ°—ã®ã›ã„ã‹ãª"},{"title":"Androidã§é‹è»¢å…è¨±è¨¼ã®ICã‚’èª­ã¿å–ã‚‹","link":"/posts/android_nfc_japan_driver_license_card_reader/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n\r\n`feng`ãŒãªã‚“ã¨ï¼ã‚µã‚¦ãƒ³ãƒ‰ãƒˆãƒ©ãƒƒã‚¯ã‚’ç™ºå£²ã™ã‚‹ã¿ãŸã„ã˜ã‚ƒãªã„ã§ã™ã‹ï¼ï¼ï¼ã€‚ã‚‚ã†æ‰‹ã«å…¥ã‚‰ãªã„ã¨æ€ã£ã¦ãŸã®ã«ã¾ã˜ï¼Ÿ   \r\nä¸€ç¬æœ¬å½“ã‹ç–‘ã£ãŸã‘ã©`fengã®ä¸Šæ§˜ãŒRTã—ã¦ãŸ`ã®ã¨`ã¡ã‚ƒã‚“ã¨äºˆç´„é–‹å§‹æ—¥ã«äºˆç´„ã§ããŸ`ã‚ãŸã‚Šãƒã‚¸ã ã¨æ€ã†ã€‚å€¤æ®µãŒå®‰ãè¦‹ãˆã‚‹è¬  \r\n\r\n![Imgur](https://imgur.com/r1OXk0z.png)\r\n\r\nhttp://fengva.com/\r\n\r\n# æœ¬é¡Œ\r\nã©ã†ã‚„ã‚‰é‹è»¢å…è¨±è¨¼ã«ã¯ICãŒåŸ‹ã‚è¾¼ã‚“ã§ã‚ã‚‹ã‚‰ã—ãã€NFC Type-Bã§ã‚„ã‚Šå–ã‚Šã§ãã‚‹ã‚‰ã—ã„ï¼Ÿ  \r\n\r\n# ä»•æ§˜\r\n\r\n## è­¦å¯Ÿå…¬å¼ã®é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸\r\nhttps://www.npa.go.jp/laws/notification/koutuu/menkyo/menkyo20210630_150.pdf\r\n\r\nURL4ã‚“ã§ãŸã‚‰ã€Œé‹è»¢å…è¨±è¨¼ã€€ä»•æ§˜ã€ã¨ã‹ã§æ¤œç´¢ã™ã‚Œã°PDFã§å‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\n`2021/06/30`ã«æ”¹å®šã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³`009`ãŒç¾åœ¨ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚‰ã—ã„ã€‚\r\n\r\nãªã‚“ã‹è­¦å¯ŸãŒå…¬å¼ã§å…¬é–‹ã—ã¦ã‚‹ã®ã£ã¦ãªã‚“ã‹æ„å¤–ã€‚~~ç„¡é™ã‚¢ãƒ©ãƒ¼ãƒˆäº‹ä»¶ã¨ã‹Coinhiveäº‹ä»¶ã¨ã‹ã‚„ã£ã¦ãŸãã›ã«ã€‚~~\r\n\r\n## Androidã§NFCã‚„ã‚Šå–ã‚Šãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ\r\nhttps://developer.android.com/guide/topics/connectivity/nfc/advanced-nfc?hl=ja\r\n\r\nä»Šå›ã¯`IsoDep`ã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ã¦ã„ãã¾ã™ï¼ˆå¾Œè¿°ï¼‰\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ | ã‚ãŸã„ |\r\n|--------|--------|\r\n| ç«¯æœ«    | Xperia 5 â…¡ |\r\n| Android | 11         |\r\n| è¨€èª    | Kotlin     |\r\n\r\n## å¿…è¦ãªã‚‚ã®ï¼Ÿ\r\n\r\n- Androidã§NFCæ­è¼‰ã®å®Ÿæ©Ÿ\r\n- é‹è»¢å…è¨±è¨¼\r\n    - 1ã¤ç›®ã®æš—è¨¼ç•ªå·ã‚’è¦šãˆã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\r\n    - æœ¬ç±ã®å–å¾—ã¯2ã¤ç›®ã®æš—è¨¼ç•ªå·ã‚‚å¿…è¦\r\n    - æš—è¨¼ç•ªå·ã‚’3å›é–“é•ãˆã‚‹ã¨ãƒ­ãƒƒã‚¯ï¼ˆä»•æ§˜æ›¸ã§ã¯é–‰å¡ã£ã¦è¡¨ç¾ï¼‰ã•ã‚Œã‚‹ã®ã§æ³¨æ„ã€‚ã‚‚ã£ã¨æ‰‹è»½ãªã‚‰ã„ã„ã®ã«ã­ã€‚\r\n- 2é€²æ•°ã€10é€²æ•°ã€16é€²æ•°ã®å¤‰æ›ãŒå‡ºæ¥ã‚‹é›»å“ã¿ãŸã„ãªã‚¢ãƒ—ãƒª\r\n    - `Windows 10`ã«æœ€åˆã‹ã‚‰å…¥ã£ã¦ã‚‹é›»å“ã®`ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰`ã«ã™ã‚Œã°ã„ã„ã§ã™ã€‚\r\n\r\n# é‹è»¢å…è¨±è¨¼ã®ICã«å…¥ã£ã¦ã„ã‚‹ä¸­èº«\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸ã®6ãƒšãƒ¼ã‚¸ç›®ã®å†…å®¹ã§ã™ã€‚ä»•æ§˜æ›¸ã§ã¯ãªã‚“ã‹ã‚¿ã‚³ğŸ™ã®è¶³ã¿ãŸã„ãªçµµãŒä¹—ã£ã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã‚Œã§ã™ã€‚ \r\n\r\n- MF\r\n    - DF1\r\n        - EF01 è¨˜è¼‰äº‹é …ï¼ˆæœ¬ç±ä»¥å¤–ã€‚åå‰ã¨ã‹ä½æ‰€ã¨ã‹ï¼‰\r\n        - EF02 è¨˜è¼‰äº‹é …ï¼ˆæœ¬ç±ï¼‰\r\n        - EF03 å¤–å­—\r\n        - EF04 è¨˜è¼‰äº‹é …å¤‰æ›´ç­‰\r\n        - EF05 è¨˜è¼‰äº‹é …å¤‰æ›´\r\n        - EF06 è¨˜è¼‰äº‹é …å¤‰æ›´\r\n        - EF07 é›»å­ç½²å\r\n    - EF01 PIN 1\r\n    - EF02 PIN 2\r\n    - DF2\r\n        - EF01 å†™çœŸ\r\n    - EF2 PINè¨­å®š\r\n    - EF01 å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ \r\n    - DF3\r\n        - EF01\r\n\r\nãƒ‘ã‚½ã‚³ãƒ³ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ ã¿ãŸã„ã§ã™ã­ã€‚\r\n\r\nä»Šå›ã¯ `DF1ã®EF01`ã«ã‚ã‚‹è¨˜è¼‰äº‹é …ï¼ˆæœ¬ç±ä»¥å¤–ï¼‰ã‚’å–å¾—ã™ã‚‹ã“ã¨ã‚’ç›®æ¨™ã«é ‘å¼µã£ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\r\n\r\n# é‹è»¢å…è¨±è¨¼ã¨é€šä¿¡ã—ãŸéš›ã«è¿”ã£ã¦ãã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸ã®8ãƒšãƒ¼ã‚¸ç›®ã®å†…å®¹ã§ã™ã€‚`åŸºæœ¬ç¬¦å·åŒ–TLV`ã¨ã‹è¨€ã‚ã‚Œã¦ã‚‹ãã†ãªã€‚  \r\n\r\nä»Šå›ã¯è¨˜è¼‰äº‹é …ã‚’å–å¾—ã™ã‚‹ã‚ã‘ã§ã™ãŒã€è¨˜è¼‰äº‹é …ã‚’å–å¾—ã™ã‚‹ã¨æ°åã€ä½æ‰€ã€ç”Ÿå¹´æœˆæ—¥ç­‰å…¨ã¦ã¾ã¨ã‚ãŸãƒã‚¤ãƒˆé…åˆ—ãŒè¿”ã£ã¦ãã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«ã€‚\r\n\r\n\r\n| ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | é•·ã•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | é•·ã•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ... |\r\n|----------------|----------------|--------------|----------------|----------------|-----|\r\n| 1ãƒã‚¤ãƒˆ        | 1ãƒã‚¤ãƒˆ        | é•·ã•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’10é€²æ•°ã«æˆ»ã—ãŸå€¤åˆ†ã®ãƒã‚¤ãƒˆ | 1ãƒã‚¤ãƒˆ        | 1ãƒã‚¤ãƒˆ        | ... |\r\n\r\n### é•·ã•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\r\né•·ã•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒ`0x0A`ãªã‚‰10é€²æ•°ã«æˆ»ã—ãŸ`10`ãƒã‚¤ãƒˆåˆ†ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚  \r\nå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒçµ‚ã‚ã£ãŸã‚‰æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã®ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒæ¥ã¦ã€ãã®æ¬¡ã®é•·ã•ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’è¦‹ã¦å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã‚’å–å¾—ã—ã¦...ã£ã¦ã‚„ã£ã¦ã„ãã¾ã™ã€‚\r\n\r\n### ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\r\n`é‹è»¢å…è¨±è¨¼ã®ICã«å…¥ã£ã¦ã„ã‚‹ä¸­èº«`ã‚’è¦‹ã¦ã‚‚ã‚‰ã†ã¨ã€ä½æ‰€ã¨ã‹åå‰ã¯ã™ã¹ã¦`DF1ã®EF01`ã«ã‚ã‚‹`è¨˜è¼‰äº‹é …ï¼ˆæœ¬ç±ä»¥å¤–ï¼‰`ã«ã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚  \r\nãã‚Œã ã¨å—ã‘å–ã£ãŸãƒã‚¤ãƒˆé…åˆ—ã®ã©ã“ã‹ã‚‰ãŒä½æ‰€ã®å€¤ã§ã€ã©ã“ã‹ã‚‰ãŒåå‰ãŒã‚ã‹ã‚‰ãªã„ãŸã‚ã€16é€²æ•°ã§å‡ºæ¥ãŸç›®å°ã®ã‚ˆã†ãªã‚‚ã®ã§ã™ã€‚  \r\n\r\nä½æ‰€ãŒãªã‚“ã®16é€²æ•°ã®ç›®å°ã«ãªã£ã¦ã„ã‚‹ã‹ã¯ä»•æ§˜æ›¸ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚  \r\nè¨˜è¼‰äº‹é …ã‚’ä¾‹ã«ã™ã‚‹ã¨ä½æ‰€ã¯`0x17`ã€åå‰ã¯`0x12`ã§ã™ã€‚\r\n\r\n### å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰\r\nå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸­èº«ãŒãƒ†ã‚­ã‚¹ãƒˆãªã®ã‹ãã‚Œã¨ã‚‚åˆ¥ã®ãªã«ã‹ãªã®ã‹ã‚’çŸ¥ã‚‹ã«ã¯ã€ä»•æ§˜æ›¸ã«æ›¸ã„ã¦ã‚ã‚‹`ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨`ã«`ç¬¦ å·`ã£ã¦ã‹ã„ã¦ã‚ã‚‹ã®ã§ãã“ã‚’è¦‹ã¾ã™ã€‚  \r\n`ãƒ‡ãƒ¼ã‚¿ã®å†…å®¹`ã‚‚ã“ã“ã‹ã‚‰ç¢ºèªã§ãã¾ã™ã€‚\r\n\r\nä¾‹ï¼šä½æ‰€ ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰`0x17`ã€ç¬¦å·ã¯`JIS X 0208`ã€‚Kotlinãªã‚‰`SJIS`ã‚’æ–‡å­—ã‚³ãƒ¼ãƒ‰ã«æŒ‡å®šã™ã‚Œã°ã„ã‘ã‚‹ã€‚  \r\n\r\n### ãƒ‡ãƒ¼ã‚¿ä¾‹\r\nè¨˜è¼‰äº‹é …ï¼ˆæœ¬ç±é™¤ãï¼‰ã®ãƒ‡ãƒ¼ã‚¿ä¾‹ã§ã™ã€‚  \r\nã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ã¯ä»•æ§˜æ›¸ã®11ãƒšãƒ¼ã‚¸ç›®ã‚’è¦‹ã¦ãã ã•ã„ã€‚\r\n\r\n```js\r\n0x11, 0x01, 0x78, 0x12, 0x0A, 0x00, 0x00 ...\r\n```\r\n\r\nã¾ãšã€`0x11`ã§ã™ãŒã€ã“ã‚Œã¯ä»•æ§˜æ›¸ã®ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ã¨ç…§ã‚‰ã—åˆã‚ã›ã‚‹ã¨ã€`JIS X 0208 åˆ¶å®šå¹´ç•ªå·`ã§æœ‰ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã­ã€‚  \r\nãã—ã¦ã€æ¬¡ã®ãƒã‚¤ãƒˆ`0x01`ãŒ`JIS X 0208 åˆ¶å®šå¹´ç•ªå·`ã®å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¤§ãã•ã‚’16é€²æ•°ã§è¡¨ã—ã¦ã„ã¾ã™ã€‚`0x01`ã‚’10é€²æ•°ã«å¤‰æ›ã™ã‚‹ã¨`1`ã§ã™ã®ã§ã€ã“ã®æ¬¡`1`ãƒã‚¤ãƒˆåˆ†ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚  \r\nå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒçµ‚ã‚ã£ãŸæ¬¡ã®ãƒã‚¤ãƒˆ`0x12`ã¯ã€ä»•æ§˜æ›¸ã®ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®è¡¨ã‚’è¦‹ã‚‹ã¨`æ°å`ã§ã‚ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚  \r\nãã—ã¦ã€ãã®æ¬¡ã®`0x0A`ãŒ`æ°åã®å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰`ã®é•·ã•ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚`0x0A`ã¯10é€²æ•°ã«å¤‰æ›ã™ã‚‹ã¨`10`ã§ã™ã®ã§ã€ã“ã®æ¬¡ã‹ã‚‰`10`ãƒã‚¤ãƒˆåˆ†ã¯æ°åã®å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚ã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«èª­ã‚“ã§ã„ãã¾ã™ã€‚\r\n\r\n# é‹è»¢å…è¨±è¨¼ã¨é€šä¿¡ã™ã‚‹éš›ã«é€ã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸ã®20ãƒšãƒ¼ã‚¸ç›®ã®å†…å®¹ã§ã™ã€‚  \r\n`APDU`ã£ã¦å½¢å¼ã§é€ã‚‹ã‚‰ã—ã„ã€‚  \r\n\r\næœ€åˆã®ãƒã‚¤ãƒˆ(CLA)ã¯`0x00`ã§å›ºå®šã€‚ãã“ã‹ã‚‰å…ˆã¯ä»¥ä¸‹ã®`ã‚³ãƒãƒ³ãƒ‰`ã§å¤‰ã‚ã£ã¦ãã‚‹ã€‚\r\n\r\n## SELECT FILE ã‚³ãƒãƒ³ãƒ‰\r\nã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®šã™ã‚‹ã¨ãã«ä½¿ã†ã€‚`cd`ã‚³ãƒãƒ³ãƒ‰ã¿ãŸã„ãªæ„Ÿã˜ï¼Ÿ  \r\n2ãƒã‚¤ãƒˆç›®(INS)ãŒ`0xA4`ã«ãªã‚Šã¾ã™ã€‚  \r\n3ãƒã‚¤ãƒˆç›®(P1)ä»¥é™ã¯ä½¿ã†ã¨ãã«ãªã£ãŸã‚‰ã¾ãŸèª¬æ˜å…¥ã‚Œã¾ã™ã€‚\r\n\r\n## VERIFY ã‚³ãƒãƒ³ãƒ‰\r\nã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯æš—è¨¼ç•ªå·ã‚’ç…§åˆã™ã‚‹ã¨ãã€ã¾ãŸã¯æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ã‚’ç¢ºèªã™ã‚‹éš›ã«ã‚‚åˆ©ç”¨ã™ã‚‹ã€‚  \r\n2ãƒã‚¤ãƒˆç›®(INS)ãŒ`0x20`ã«ãªã‚‹ã€‚  \r\n3ãƒã‚¤ãƒˆç›®(P1)ã¯`0x00`å›ºå®šã§ã™ã€‚  \r\n4ãƒã‚¤ãƒˆç›®(P2)ä»¥é™ã¯ä½¿ã†ã¨ãã«ãªã£ãŸã‚‰ã¾ãŸèª¬æ˜å…¥ã‚Œã¾ã™ã€‚\r\n\r\n## READ BINARY ã‚³ãƒãƒ³ãƒ‰\r\nã“ã®ã‚³ãƒãƒ³ãƒ‰ã¯ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã™ã¨ãã«ä½¿ã†ã€‚  \r\n2ãƒã‚¤ãƒˆç›®(INS)ãŒ`0xB0`ã«ãªã‚‹ã€‚  \r\n3ãƒã‚¤ãƒˆç›®(P1)ä»¥é™ã¯ä½¿ã†ã¨ãã«ãªã£ãŸã‚‰ã¾ãŸèª¬æ˜å…¥ã‚Œã¾ã™ã€‚\r\n\r\n# JIS X 0208\r\nä½æ‰€ã€æ°åç­‰ã®æ–‡å­—ã¯`JIS X 0208`ã«æ²¿ã£ã¦ã€16é€²æ•°ã«å¤‰æ›ã•ã‚Œã€ä¿å­˜ã•ã‚Œã¾ã™ã€‚  \r\n\r\n## é•·ã„ã®ã‚„ã ã‹ã‚‰ä¸‰è¡Œã§\r\n- `JIS X 0208`ã‚’Androidã§èª­ã‚ã‚‹å½¢ã«å¤‰æ›ã™ã‚‹éš›ã«ä½¿ã†æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯`JISã‚³ãƒ¼ãƒ‰`ã§è¡Œã‘ã‚‹ã€‚\r\n- `JIS X 0208`ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã®å…ˆé ­ã«`0x1B, 0x24, 0x42`ã‚’å…¥ã‚Œã¦ã‹ã‚‰\r\n- `String`ã‚¯ãƒ©ã‚¹ã«çªã£è¾¼ã‚€ã€‚æ–‡å­—ã‚³ãƒ¼ãƒ‰ã¯`charset(\"jis\")`ã§\r\n\r\n## JIS X 0208 ã¯ ç¬¦å·åŒ–æ–‡å­—é›†åˆ\r\n`Shift_JIS`ã¨ã‹`UTF-8`ã¨ã‹ã®`æ–‡å­—ç¬¦å·åŒ–æ–¹å¼`ã®ãŠå‹é”ã§ã¯ãªã„ã§ã™ã€‚  \r\n\r\n`ç¬¦å·åŒ–æ–‡å­—é›†åˆ`ã£ã¦ã®ã¯æ–‡å­—ã²ã¨ã¤ã²ã¨ã¤ã«ç•ªå·ã‚’å‰²ã‚Šå½“ã¦ãŸã‚‚ã®ã§ã™ã€‚  \r\n`æ–‡å­—ç¬¦å·åŒ–æ–¹å¼`ã£ã¦ã®ã¯ä¸Šè¨˜ã®`ç¬¦å·åŒ–æ–‡å­—é›†åˆ`ã‚’ã©ã†ã‚„ã£ã¦ä¿å­˜å‡ºæ¥ã‚‹å½¢ï¼ˆãƒã‚¤ãƒˆé…åˆ—ï¼‰ã«ã™ã‚‹ã‹ã‚’æ±ºã‚ã¦ã‚‹ã‚‚ã®ã§ã™ã€‚ã‚ã¨ã¯è¤‡æ•°ã®`ç¬¦å·åŒ–æ–‡å­—é›†åˆ`ã‚’çµ„ã¿åˆã‚ã›ãŸã‚‚ã®ã ã£ãŸã‚Šã—ã¾ã™ã€‚\r\n\r\n- `Shift-JIS`\r\n    - `JIS X 0201`ã¨`JIS X 0208`ã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã‚‹\r\n    - çµ„ã¿åˆã‚ã›ã‚‹éš›ã«æ–‡å­—ã®ç•ªå·ãŒè¢«ã‚‰ãªã„ã‚ˆã†ã€`Shift_JIS`ã§ã¯è¨ˆç®—ã‚’ã—ã¦ã„ã‚‹\r\n- `ISO-2022-JP / åˆ¥å JISã‚³ãƒ¼ãƒ‰`\r\n    - `JIS X 0211`ã€`JIS X 0201ã®ãƒ©ãƒ†ãƒ³æ–‡å­—é›†åˆ`ã€`ISO 646`ã€`JIS X 0208`ãªã©ã®ç¬¦å·åŒ–æ–‡å­—é›†åˆã‚’çµ„ã¿åˆã‚ã›ã¦ã„ã‚‹ã€‚\r\n    - ã“ã¡ã‚‰ã¯ã€ç‰¹å®šã®ãƒã‚¤ãƒˆé…åˆ—ï¼ˆã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ï¼‰ã‚’ä½¿ã†ã“ã¨ã§ç¬¦å·åŒ–æ–‡å­—é›†åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã€‚\r\n        - `JIS X 0208`ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¯`0x1B, 0x24, 0x42`\r\n    - å¤šåˆ†ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã§åˆ‡ã‚Šæ›¿ãˆãŸã‚‰å¤šåˆ†åˆ‡ã‚Šæ›¿ãˆã‚’æˆ»ã•ãªã„ã¨è¡Œã‘ãªã„æ°—ãŒã™ã‚‹ã‘ã©ã€æˆ»ã•ãªãã¦ã‚‚å‹•ã„ã¦ã‚‹ã®ã§ã„ã„ã‹â†ï¼Ÿ\r\n\r\nä»Šå›ã¯`Android`ã§ã‚‚ä½¿ãˆã¦ã€ãã®ã¾ã¾`JIS X 0208`ã®æ–‡å­—é›†åˆã®å€¤ã‚’å…¥ã‚Œã¦ä½¿ãˆã‚‹`JISã‚³ãƒ¼ãƒ‰`(`charset(\"jis\")`)ã‚’ä½¿ã„ã¾ã™ã€‚  \r\n\r\n```kotlin\r\nval encodedData = byteArrayOf(0x3c.toByte(), 0x56.toByte()) // \"è»Š\" ã‚’ JIS X 0208 ã«ã—ãŸã‚‚ã®\r\nval escapeSequence = byteArrayOf(0x1b.toByte(), 0x24.toByte(), 0x42.toByte()) // JIS X 0208ã«åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹\r\nval decodeString = String(escapeSequence + encodedData, charset(\"jis\")) // ISO-2022-JPï¼ˆJISã‚³ãƒ¼ãƒ‰ï¼‰ã§æˆ»ã™\r\nprintln(decodeString)\r\n```\r\n\r\n# æµã‚Œ\r\n\r\n- Androidç«¯æœ«ã¨NFCã§æ¥ç¶šã™ã‚‹ã€‚\r\n- `IsoDep#get()`ã§ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’å–å¾—ã€‚\r\n- `IsoDep#connect()`ã‚’å‘¼ã³å‡ºã—ã¦æ¥ç¶šã—ã¾ã™ã€‚\r\n- `SELECT FILE`ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã¦`MF`ã«ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®šã—ã¾ã™ã€‚\r\n- `VERIFY`ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã¦ç¬¬ä¸€æš—è¨¼ç•ªå·ã‚’èªè¨¼ã—ã¾ã™ã€‚\r\n- `SELECT FILE`ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã¦`DF1`ã«ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®šã—ã¾ã™ã€‚\r\n- `READ BINARY`ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã¦`EF01`ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å‡ºã—ã¾ã™ã€‚\r\n- ãƒã‚¤ãƒˆé…åˆ—ã‚’è§£æã—ã¾ã™ã€‚\r\n- `IsoDep#close()`ã‚’å‘¼ã³å‡ºã—ã¦çµ‚äº†ã€‚\r\n\r\nä»¥ä¸Šã«ãªã‚Šã¾ã™ã€‚  \r\nä»Šå›ã¯ã¤ã„ã§ã«æ®‹ã‚Šç…§åˆå›æ•°ã¨ã€å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã‚‚èª­ã¿å‡ºã—ã¦ã¿ã¾ã™ã€‚\r\n\r\n## NfcBã˜ã‚ƒãªã„ã®ï¼Ÿ\r\nADPUã®é€ä¿¡ã¯`IsoDep`ã˜ã‚ƒãªã„ã¨ã ã‚ã‚‰ã—ã„ã€‚\r\n\r\n# ã¨ã‚Šã‚ãˆãšé‹è»¢å…è¨±è¨¼ã¨é€šä¿¡ã™ã‚‹ã¾ã§\r\n\r\n## AndroidManifest.xml\r\n`NFC`ã®æ¨©é™ãŒå¿…è¦ã§ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    package=\"io.github.takusan23.jdcardreader\">\r\n\r\n    <uses-permission android:name=\"android.permission.NFC\" />\r\n```\r\n\r\n## activity_main.xml\r\n\r\n`TextView`ã‚’ç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <TextView\r\n        android:id=\"@+id/activity_main_text_view\"\r\n        android:layout_width=\"match_parent\"\r\n        android:layout_height=\"0dp\"\r\n        android:text=\"J(apan) D(river) Card Reader\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n## MainActivity.kt\r\nä»Šå›ã¯`Activity`ã«ç›´æ¥æ›¸ã„ã¡ã‚ƒã„ã¾ã™ã­ã€‚  \r\nä¸€å¿œActivityã‚’é›¢ã‚ŒãŸã‚‰NFCæ¤œå‡ºã‚’æ­¢ã‚ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚  \r\n\r\n`ByteArray.toHexString()`ã£ã¦é–¢æ•°ã¯`ByteArray`ã®æ‹¡å¼µé–¢æ•°ã«ãªã£ã¦ã¦ã€æ–‡å­—åˆ—ã®16é€²æ•°ã«å¤‰æ›ã—ã¦ãã‚Œã‚‹é–¢æ•°ã§ã™ã€‚\r\n\r\nã“ã‚“ãªé¢¨ã«â†’`println(byteArrayOf(0x63.toByte(), 0xC3.toByte()).toHexString()) // å‡ºåŠ› : 63, c3`\r\n\r\nã“ã‚Œä»¥é™ã¯`// ã“ã“ã«ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã‚‹`ã®æ¬¡ã‹ã‚‰ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã„ã¦ã„ãã¾ã™ã€‚\r\n\r\n```kotlin\r\npackage io.github.takusan23.jdcardreader\r\n\r\nimport android.nfc.NfcAdapter\r\nimport android.nfc.Tag\r\nimport android.nfc.tech.IsoDep\r\nimport androidx.appcompat.app.AppCompatActivity\r\nimport android.os.Bundle\r\nimport android.widget.TextView\r\n\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val textView by lazy { findViewById<TextView>(R.id.activity_main_text_view) }\r\n\r\n    /** NFCã‚’æ¤œå‡ºã™ã‚‹ã®ã«ä½¿ã† */\r\n    private val nfcAdapter by lazy { NfcAdapter.getDefaultAdapter(this) }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n\r\n    }\r\n\r\n    override fun onResume() {\r\n        super.onResume()\r\n        nfcAdapter.enableReaderMode(\r\n            this,\r\n            { tag ->\r\n\r\n                val isoDep = IsoDep.get(tag)\r\n                isoDep.connect()\r\n\r\n                // ã“ã“ã«ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã‚‹\r\n\r\n                isoDep.close()\r\n\r\n            },\r\n            NfcAdapter.FLAG_READER_NFC_B,\r\n            null\r\n        )\r\n    }\r\n\r\n    override fun onPause() {\r\n        super.onPause()\r\n        nfcAdapter.disableReaderMode(this)\r\n    }\r\n\r\n    /** 16é€²æ•°ã«å¤‰æ›ã™ã‚‹ã‚„ã¤ */\r\n    fun ByteArray.toHexString() = this.joinToString { \"%02x\".format(it) }\r\n\r\n}\r\n```\r\n\r\n## MFã¸ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’è¨­å®š\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸ã®20ãƒšãƒ¼ã‚¸ç›®ã®MFã®é¸æŠã£ã¦ã‚„ã¤ã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã™ã€‚  \r\n\r\né€ä¿¡ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰(ãƒã‚¤ãƒˆé…åˆ—)ã¯ã“ã‚Œã§ã™ã€‚  \r\n\r\n| CLA | INS | P1 | P2 |\r\n|-----|-----|----|----|\r\n| 0x00 | 0xA4 | 0x00 | 0x00 |\r\n\r\n```\r\n0x00, 0xA4, 0x00, 0x00\r\n```\r\n\r\nã‚“ã§ã‚‚ã£ã¦æˆåŠŸã—ãŸã¨ãã«å¸°ã£ã¦ãã‚‹ãƒã‚¤ãƒˆé…åˆ—ã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚  \r\n\r\n| SW1 | SW2 |\r\n|-----|-----|\r\n| 1ãƒã‚¤ãƒˆ    | 1ãƒã‚¤ãƒˆ    |\r\n| 90ãªã‚‰æˆåŠŸ | 00ãªã‚‰æˆåŠŸ |\r\n\r\nå¤±æ•—æ™‚ã®å€¤ã¯ä»•æ§˜æ›¸ã®23ãƒšãƒ¼ã‚¸ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§è¦‹ã¦ãã ã•ã„ã€‚\r\n\r\nKotlinã ã¨ã“ã†ã§ã™ã€‚\r\n\r\n```kotlin\r\n// ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’MFã«ã™ã‚‹\r\nval mfSelectCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0xA4.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte()\r\n)\r\nval mfSelectCommandResult = isoDep.transceive(mfSelectCommand)\r\nif (mfSelectCommandResult[0] == 0x90.toByte()) {\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        MFé¸æŠã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n        ${mfSelectCommandResult.toHexString()}\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n## å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã‚’èª­ã‚“ã§è¦‹ã‚‹\r\nè¨˜è¼‰äº‹é …ã¯æš—è¨¼ç•ªå·ãŒå¿…è¦ã§ã€å¤±æ•—ã—ãŸã‚‰ã¾ãšã„ã®ã§ã¨ã‚Šã‚ãˆãšèªè¨¼ä¸è¦ãªå…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã‚’èª­ã‚“ã§ã¿ã¾ã™ã€‚\r\n\r\n### ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã¸\r\n\r\né€ä¿¡ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã§ã™ã€‚  \r\n`P1 / P2`ã«é–¢ã—ã¦ã¯ã€é‹è»¢å…è¨±ICä»•æ§˜æ›¸ã®22ãƒšãƒ¼ã‚¸ç›®ã€`P1ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°`ã€`P2ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°`ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚  \r\nä»Šå›ã¯ã€`P1`ã¯`ã‚«ãƒ¬ãƒ³ãƒˆDFã®ç›´ä¸‹ã®EF`ã€`P2`ã¯`æœ€åˆåˆã¯å”¯ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ`ã‚’æŒ‡å®šã—ã¾ã—ãŸã€‚\r\n2é€²æ•°ã‚’16é€²æ•°ã«ã—ã¦æ¸¡ã™ã ã‘ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/vJKuTN2.png)\r\n\r\n`Le`ã¯ã€ã“ã®å¾Œç¶šããƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã§ã™ã€‚ä»Šå›ã¯`0x2F, 0x01`ã§2ãƒã‚¤ãƒˆãªã®ã§ã€2ã‚’16é€²æ•°ã«ã—ãŸ`0x02`(å…ˆé ­`0x`ã¤ã‘ã¦1æ¡ãªã‚‰`0`ã§åŸ‹ã‚ã‚‹)ã‚’æ¸¡ã—ã¾ã™ã€‚\r\n\r\n`MF/EF01`ã®å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã®`EFè­˜åˆ¥å­`ã¯`0x2F, 0x01`ãªã®ã§ã€`Le`ã®æ¬¡ã«å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```\r\n0x00, 0xA4, 0x02, 0x0C, 0x02, 0x2F, 0x01\r\n```\r\n\r\n| CLA | INS | P1 | P2 | Le | ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | ãƒ‡ãƒ¼ã‚¿ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ |\r\n|-----|-----|----|----|----|------------------|------------------|\r\n| 0x00 | 0xA4 | 0x02 | 0x0C | 0x02 | 0x2F             | 0x01             |\r\n\r\n\r\nä»¥ä¸‹ä¾‹ã§ã™ã€‚\r\n\r\n```kotlin\r\n// ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã«è¨­å®šã™ã‚‹\r\nval mfEf01SelectCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0xA4.toByte(),\r\n    0x02.toByte(),\r\n    0x0C.toByte(),\r\n    0x02.toByte(),\r\n    0x2F.toByte(),\r\n    0x01.toByte(),\r\n)\r\nval mfEf01SelectCommandResult = isoDep.transceive(mfEf01SelectCommand)\r\nif (mfEf01SelectCommandResult[0] == 0x90.toByte()) {\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        DF/EF01 å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´  é¸æŠã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n        ${mfEf01SelectCommandResult.toHexString()}\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n### å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã‚’èª­ã¿å–ã‚‹\r\n\r\né€ä¿¡ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã§ã™ã€‚  \r\n`P1 / P2`ã«é–¢ã—ã¦ã¯ã€ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®ä¸­èº«ã‚’è¦‹ã‚‹ã®ã§`0x00, 0x00`ã§ã„ã„ã§ã™ã€‚  \r\næœ€å¾Œã®`Le`ã§ã™ãŒã€å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã®é•·ã•ã¯17ãªã®ã§ã€16é€²æ•°ã«å¤‰æ›ã—ãŸ`0x11`ã‚’æ¸¡ã›ã°ã„ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/dXHZinj.png)\r\n\r\n```\r\n0x00, 0xB0, 0x00, 0x00, 0x11\r\n```\r\n\r\n| CLA | INS | P1 | P2 | Le |\r\n|-----|-----|----|----|----|\r\n| 0x00 | 0xA4 | 0x00 | 0x0C | 0x11 |\r\n\r\næˆåŠŸã—ãŸå ´åˆã¯ã€æœ€å¾Œã‹ã‚‰2ç•ªç›®ã®å€¤ãŒ`0x90`ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\n#### èª­ã¿å–ã£ãŸå…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã‚’è§£æ\r\né‹è»¢å…è¨±ICä»•æ§˜æ›¸9ãƒšãƒ¼ã‚¸ç›®å‚ç…§ã€‚\r\n\r\nèª­ã¿å–ã£ãŸãƒã‚¤ãƒˆé…åˆ—ã®æœ€å¾Œ2ã¤ã¯ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ï¼ˆæˆåŠŸã—ãŸã‹ã©ã†ã‹ï¼‰ãŒå…¥ã£ã¦ã„ã¾ã™ã€‚\r\n\r\næœ€åˆã®`0x45`ã¯`ã‚«ãƒ¼ãƒ‰ç™ºè¡Œè€…ãƒ‡ãƒ¼ã‚¿`ã§ã€ä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³(3ãƒã‚¤ãƒˆ)ã€äº¤ä»˜å¹´æœˆæ—¥(4ãƒã‚¤ãƒˆ)ã€æœ‰åŠ¹æœŸé™(4ãƒã‚¤ãƒˆ)ãŒé€£ç¶šã§å…¥ã£ã¦ã„ã‚‹ãã†ã§ã™ã€‚  \r\nãã®æ¬¡ã®`0x0B`ã¯`ã‚«ãƒ¼ãƒ‰ç™ºè¡Œè€…ãƒ‡ãƒ¼ã‚¿`ã®é•·ã•ãŒ16é€²æ•°ã§å…¥ã£ã¦ã„ã¾ã™ã€‚ã®ã§ã€10é€²æ•°ã«æˆ»ã™ã¨`11`ã€`11ãƒã‚¤ãƒˆåˆ†`ãŒã‚«ãƒ¼ãƒ‰ç™ºç‹‚è€…ãƒ‡ãƒ¼ã‚¿ã¿ãŸã„ã§ã™ã€‚  \r\nä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®3ãƒã‚¤ãƒˆåˆ†ã¯`SJIS`ã§å¤‰æ›ã—ã¾ã™ã€‚äº¤ä»˜å¹´æœˆæ—¥(4ãƒã‚¤ãƒˆã€‚`YYMMDD`)ã€æœ‰åŠ¹æœŸé™(4ãƒã‚¤ãƒˆã€‚`YYMMDD`)ã¯`æ–‡å­—åˆ—ã®16é€²æ•°`ã«ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nKotlinã ã¨ã“ã†ã§ã™ã€‚\r\n\r\n```kotlin\r\n// ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èª­ã¿å–ã‚‹\r\nval mfEf01ReadBinaryCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0xB0.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x11.toByte()\r\n)\r\nval mfEf01ReadBinaryCommandResult = isoDep.transceive(mfEf01ReadBinaryCommand)\r\n// æˆåŠŸã—ãŸå ´åˆã€æœ€å¾Œã‹ã‚‰2ç•ªç›®ã®16é€²æ•°ãŒ0x90\r\nif (mfEf01ReadBinaryCommandResult[mfEf01ReadBinaryCommandResult.size - 2] == 0x90.toByte()) {\r\n    // ã‚«ãƒ¼ãƒ‰ç™ºè¡Œè€…ãƒ‡ãƒ¼ã‚¿ã®é•·ã•ã‚’å–å¾—\r\n    val cardPublisherDataLength = mfEf01ReadBinaryCommandResult[1].toInt() // å¤šåˆ†11\r\n    // å…ˆé ­ã‹ã‚‰ cardPublisherDataLength åˆ†ã®ãƒã‚¤ãƒˆé…åˆ—å–å¾—\r\n    val cardPublisherDataBinary = mfEf01ReadBinaryCommandResult.copyOfRange(2, 2 + cardPublisherDataLength)\r\n    // æœ€åˆã®3ãƒã‚¤ãƒˆãŒä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆSJISå¤‰æ›å¾Œç¢ºèªå¯èƒ½ï¼‰ã€æ¬¡ã®4ãƒã‚¤ãƒˆãŒäº¤ä»˜å¹´æœˆæ—¥ã€æ¬¡ã®4ãƒã‚¤ãƒˆãŒæœ‰åŠ¹æœŸé™\r\n    val version = cardPublisherDataBinary.copyOfRange(0, 3).toString(charset(\"sjis\"))\r\n    val publishDate = cardPublisherDataBinary.copyOfRange(4, 7).joinToString(separator = \"\") { \"%02x\".format(it) }\r\n    val effectiveDate = cardPublisherDataBinary.copyOfRange(8, 11).joinToString(separator = \"\") { \"%02x\".format(it) }\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª èª­ã¿å–ã‚Šã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n        ${mfEf01ReadBinaryCommandResult.toHexString()}\r\n        ä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š$version\r\n        ç™ºè¡Œå¹´æœˆæ—¥ï¼š$publishDate\r\n        æœ‰åŠ¹æœŸé™ï¼š$effectiveDate\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n## æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°(æš—è¨¼ç•ªå·ãƒŸã‚¹ã£ãŸå›æ•°)ã‚’å–å¾—ã—ã¦ã¿ã‚‹\r\nå¾Œä½•å›æš—è¨¼ç•ªå·ã‚’é–“é•ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã®ã‹èª¿ã¹ã¦ã¿ã¾ã™ã€‚  \r\nã¡ãªã¿ã«3å›é–“é•ãˆã‚‹ã¨èª­ã¿å–ã‚Šã§ããªããªã‚Šã¾ã™ï¼ˆä»•æ§˜æ›¸æ›°ãï¼‰ã€‚ä»•æ§˜æ›¸ã§ã¯èª­ã¿å–ã‚Šã§ããªã„çŠ¶æ…‹ã®ã“ã¨ã‚’`é–‰å¡`ã£ã¦å‘¼ã‚“ã§ã„ã‚‹ã€‚  \r\n**ãªãŠé‹è»¢å…è¨±ICãŒèª­ã¿å–ã‚Šä¸å¯ã®çŠ¶æ…‹ã§ã‚‚é‹è»¢ã¯ã§ãã‚‹ã‚‰ã—ã„**\r\n\r\n### æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ã¸ç§»å‹•ã™ã‚‹\r\né‹è»¢å…è¨±ICä»•æ§˜æ›¸24ãƒšãƒ¼ã‚¸ç›®ã€`æ®‹ã‚Šã®ç…§åˆè¨±å®¹å›æ•°ã®å‡ºåŠ›æŒ‡å®š`ã‚’ãã®ã¾ã¾ä½¿ã„ã¾ã™ã€‚\r\n\r\nã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã§ã™ã€‚\r\n\r\n| CLA | INS | P1 | P2 |\r\n|-----|-----|----|----|\r\n| 0x00 | 0x20 | 0x00 | 0x81 |\r\n\r\n```\r\n0x00, 0x20, 0x00, 0x81\r\n```\r\n\r\n`P2`ã«é–¢ã—ã¦ã§ã™ãŒã€`0x81`ã‚’æŒ‡å®šã™ã‚‹ã“ã¨ã§ã€`MF/IEF01`(æš—è¨¼ç•ªå·1)ã®`EFè­˜åˆ¥å­`ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚  \r\nå¤šåˆ†`P2`ã‚’`0x80`(ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æŒ‡å®š)ã«ã—ã¦ã€ã“ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œå‰ã«`SELECT FILE ã‚³ãƒãƒ³ãƒ‰`ã§`MF/IEF01`ã¸ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç§»å‹•ã—ã‚‚ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n### æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ã‚’è§£æã™ã‚‹\r\n\r\nä»¥ä¸‹ã®2ãƒã‚¤ãƒˆãŒå¸°ã£ã¦ãã¾ã™ã€‚  \r\n```\r\n0x63, 0xC3\r\n```\r\n\r\næœ€åˆã®ãƒã‚¤ãƒˆãŒ`0x63`ãªã‚‰æˆåŠŸã§ã™ã€‚  \r\nãã‚Œã§è¦‹ã¦ã»ã—ã„ã®ã¯`0xC3`ã®éƒ¨åˆ†ã§ã€æœ€å¾Œã®`3`ãŒæ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ã§ã™ã€‚  \r\næ®‹ã‚Š2å›ã®å ´åˆã¯`0xC2`ã«ãªã‚‹ã¨ã„ã†ã“ã¨ã§ã™ã€‚\r\n\r\nKotlinã§æ›¸ãã¨ã“ã†ã§ã™ã€‚\r\n\r\n```kotlin\r\n// æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ã‚’å–å¾—ã™ã‚‹\r\nval retryCountVerifyCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0x20.toByte(),\r\n    0x00.toByte(),\r\n    0x81.toByte()\r\n)\r\nval retryCountVerifyCommandResult = isoDep.transceive(retryCountVerifyCommand)\r\nprintln(retryCountVerifyCommandResult.toHexString())\r\nif (retryCountVerifyCommandResult[0] == 0x63.toByte()) {\r\n    val retryCountHex = retryCountVerifyCommandResult.last().toInt() - 0xC0 // 0xC0ã‚’å¼•ã‘ã°æœ€å¾ŒãŒæ®‹ã‚‹\r\n    val retryCount = \"%x\".format(retryCountHex).last() // ffffff03ã¿ãŸã„ãªæ„Ÿã˜ã«ãªã‚‹ã€ã®ã§æœ€å¾Œã ã‘å–å¾—\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•° èª­ã¿å–ã‚Šã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n        ${retryCountVerifyCommandResult.toHexString()}\r\n        æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ï¼š$retryCount\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n## æš—è¨¼ç•ªå·ã‚’ç…§åˆã™ã‚‹\r\né‹è»¢å…è¨±è¨¼ã®è¡¨é¢ã«æ›¸ã„ã¦ã‚ã‚‹æƒ…å ±ï¼ˆé¡”å†™çœŸä»¥å¤–ï¼‰`DF1ã®EF01`ã‚’èª­ã¿å–ã‚‹ã«ã¯èªè¨¼ã‚’é€šéã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nï¼ˆè¡¨é¢ã«æ›¸ã„ã¦ã‚ã‚‹ãªã‚‰æš—è¨¼ç•ªå·ã®å¿…è¦æ€§... #ã¨ã¯ï¼‰\r\n\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸24ãƒšãƒ¼ã‚¸ç›®ã€`ç…§åˆ(Case 3)`ã‚’ä½¿ã£ã¦èªè¨¼ã—ã¾ã™ã€‚  \r\næš—è¨¼ç•ªå·ã®ç…§åˆã«ã¯`VERIFY`ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã—ã¾ã™ã€‚  \r\n\r\n### æš—è¨¼ç•ªå·ã‚’JIS X 0201ã«å¤‰æ›ã™ã‚‹\r\næš—è¨¼ç•ªå·ã‚’`JIS X 0201`ã¸å¤‰æ›ã—ã¾ã™ã€‚  \r\n\r\n`JIS X 0201`ã¨æ•°å€¤ã®ç›¸å¯¾è¡¨ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚\r\n\r\n| JIS X 0201 | æ•°å€¤ |\r\n|------------|------|\r\n|0x30|0|\r\n|0x31|1|\r\n|0x32|2|\r\n|0x33|3|\r\n|0x34|4|\r\n|0x35|5|\r\n|0x36|6|\r\n|0x37|7|\r\n|0x38|8|\r\n|0x39|9|\r\n\r\nä¾‹ãˆã°æš—è¨¼ç•ªå·ãŒã€Œ2525ã€ãªã‚‰ã€`0x32, 0x35, 0x32, 0x35`ã«ãªã‚Šã¾ã™ã€‚\r\n\r\nä»Šå›ã¯å¤‰æ›ç”¨ã®é–¢æ•°ã§ã‚‚ç”¨æ„ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚\r\n\r\n```kotlin\r\nfun toJIS(c: Char): Byte {\r\n    return when (c) {\r\n        '0' -> 0x30\r\n        '1' -> 0x31\r\n        '2' -> 0x32\r\n        '3' -> 0x33\r\n        '4' -> 0x34\r\n        '5' -> 0x35\r\n        '6' -> 0x36\r\n        '7' -> 0x37\r\n        '8' -> 0x38\r\n        '9' -> 0x39\r\n        else -> 0x00\r\n    }.toByte()\r\n}\r\n```\r\n\r\n### ãã‚Œã‚’è¸ã¾ãˆã¦æš—è¨¼ç•ªå·ã‚’ç…§åˆã™ã‚‹ã‚³ãƒãƒ³ãƒ‰\r\nã“ã‚Œã§ã™ã€‚  \r\n`INS`ã¯`VERIFYã‚³ãƒãƒ³ãƒ‰`ãªã®ã§`0x20`ã€  \r\n`P1`ã¯å›ºå®š`0x00`ã§ã™ã€‚  \r\n`P2`ã¯`é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸24ãƒšãƒ¼ã‚¸ç›®`ã®`P2ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°`ã§ã€`çŸ­ç¸®EFè­˜åˆ¥å­æŒ‡å®š`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚æš—è¨¼ç•ªå·1ã¯`IEF01`ã§ã€`EFè­˜åˆ¥å­`ãŒ`0001`ãªã®ã§ã€  \r\n`P2ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°`ã«ç…§ã‚‰ã—åˆã‚ã›ã‚‹ã¨ã€`10000001`ã«ãªã‚Šã¾ã™(100ã¯å›ºå®š)ã€‚ã“ã‚Œã‚’16é€²æ•°ã«å¤‰æ›ã—ãŸå€¤ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\n`Lc`ã¯æš—è¨¼ç•ªå·ã®é•·ã•ã§ã™ã€‚4ãƒã‚¤ãƒˆãªã®ã§`0x04`ã§ã™ã€‚  \r\nãã®å¾Œã¯å¤‰æ›ã—ãŸæš—è¨¼ç•ªå·ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n| CLA | INS | P1 | P2 | Lc | å¤‰æ›ã—ãŸæš—è¨¼ç•ªå·1æ¡ç›® | å¤‰æ›ã—ãŸæš—è¨¼ç•ªå·2æ¡ç›® | å¤‰æ›ã—ãŸæš—è¨¼ç•ªå·3æ¡ç›® | å¤‰æ›ã—ãŸæš—è¨¼ç•ªå·4æ¡ç›® |\r\n|-----|-----|----|----|----|-----------------------|-----------------------|-----------------------|-----------------------|\r\n| 0x00 | 0x20 | 0x00 | 0x81 | 0x04 |å„è‡ª|å„è‡ª|å„è‡ª|å„è‡ª|\r\n\r\n```\r\n0x00, 0x20, 0x00, 0x81, 0x04, <æš—è¨¼ç•ªå·ã‚’JIS X 0201ã§å¤‰æ›ã—ãŸ4ãƒã‚¤ãƒˆ>\r\n```\r\n\r\næš—è¨¼ç•ªå·ãŒã€Œ2525ã€ã®å ´åˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n```\r\n0x00, 0x20, 0x00, 0x81, 0x04, 0x32, 0x35, 0x32, 0x35\r\n```\r\n\r\næˆåŠŸã—ãŸå ´åˆã¯æœ€åˆã®å€¤ãŒ`0x90`ã«ãªã‚Šã¾ã™ã€‚\r\n\r\nãã‚Œã‚’Kotlinã§ã‚„ã‚‹ã¨ã“ã†ãªã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n// æš—è¨¼ç•ªå·1ã‚’ç…§åˆã™ã‚‹\r\nval pinCode1CharList = listOf(0, 0, 0, 0) // å„è‡ªæš—è¨¼ç•ªå·ã‚’å…¥åŠ›\r\nval pinCode1EncodedList = pinCode1CharList.map { toJIS(it.toString()[0]) }\r\nval pinCode1VerifyCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0x20.toByte(),\r\n    0x00.toByte(),\r\n    0x81.toByte(),\r\n    0x04.toByte(),\r\n) + pinCode1EncodedList\r\nval pinCode1VerifyCommandResult = isoDep.transceive(pinCode1VerifyCommand)\r\nif (pinCode1VerifyCommandResult[pinCode1VerifyCommandResult.size - 2] == 0x90.toByte()) {\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        ç¬¬ä¸€æš—è¨¼ç•ªå·ã®ç…§åˆ æˆåŠŸ\r\n        ${pinCode1VerifyCommandResult.toHexString()}\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n### ã¡ãªã¿ã«é–‰å¡çŠ¶æ…‹ã«ãªã‚‹ã¨\r\n\r\n```\r\n0x69, 0x84\r\n```\r\n\r\nãŒå¸°ã£ã¦ãã¾ã™ã€‚ï¼ˆæš—è¨¼ç•ªå·é–“é•ãˆãŸã¾ã¾èª­ã¿å–ã£ã¦é–‰å¡ã—ãŸï¼‰\r\n\r\n### é–‰å¡çŠ¶æ…‹ã‚’è§£é™¤ã—ã¦ã‚‚ã‚‰ã£ãŸè©±\r\nè­¦å¯Ÿç½² ã‹ é‹è»¢å…è¨±è©¦é¨“å ´ ã§è§£é™¤ã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã€‚\r\n\r\nè©¦é¨“å ´ã®å ´åˆã¯**ã¿ã©ã‚Šã®çª“å£**è¡Œã£ã¦ã€å—ä»˜ç•ªå·ç™ºåˆ¸ã—ã¦å‘¼ã°ã‚Œã‚‹ã¾ã§å¾…ã£ã¦ã€å‘¼ã°ã‚ŒãŸã‚‰ã€Œæš—è¨¼ç•ªå·é–“é•ãˆã¦ICã‚«ãƒ¼ãƒ‰ãƒ­ãƒƒã‚¯ã•ã‚ŒãŸã®ã§è§£é™¤ã—ã¦ãã ã•ã„ã€‚ã€çš„ãªã“ã¨ã‚’ä¼ãˆã¦ã€é‹è»¢å…è¨±è¨¼ã‚’æ¸¡ã›ã°æ•°åç§’å¾Œã«è§£é™¤ã•ã‚ŒãŸé‹è»¢å…è¨±è¨¼ãŒå¸°ã£ã¦ãã¾ã™ã€‚  \r\nç§ã¯æš—è¨¼ç•ªå·è¦šãˆã¦ã‚‹ã£ã¦ä¼ãˆãŸã‹ã‚‰æ•°åç§’ã§çµ‚ã‚ã£ãŸã‘ã©ã€æš—è¨¼ç•ªå·å¿˜ã‚Œã¦ã‚‹å ´åˆã¯ã‚‚ã£ã¨æ›ã‹ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ï¼Ÿ\r\n\r\nè­¦å¯Ÿç½²ã®å ´åˆã¯ã—ã‚‰ã‚“ã€‚\r\n\r\n## è¨˜è¼‰äº‹é …ï¼ˆDF1/EF01ï¼‰ã‚’èª­ã¿å‡ºã™\r\næš—è¨¼ç•ªå·ã®ç…§åˆã‚’çµ‚ãˆãŸã®ã§ã‚„ã£ã¨èª­ã¿å‡ºã›ã¾ã™ã€‚  \r\nã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`DF1`ã«ã—ã¦ã€`READ BINARY`ã§`EF01`ã‚’èª­ã¿å‡ºã™ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n\r\n### ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’DF1ã«è¨­å®šã™ã‚‹\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸22ãƒšãƒ¼ã‚¸ç›®å‚ç…§ã€‚\r\n\r\nã‚³ãƒãƒ³ãƒ‰ã¯ã“ã†ã§ã™ã€‚`SELECT FILE`ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚\r\n\r\n`P1`ã¯ã€`P1ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã®è¡¨`ã‹ã‚‰`DFåã«ã‚ˆã‚‹ç›´æ¥é¸æŠ`ã‚’åˆ©ç”¨ã—ãŸã„ã®ã§ã€2é€²æ•°`100`ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’16é€²æ•°ã«ã—ãŸ`0x04`ã‚’æ¸¡ã—ã¾ã™ã€‚  \r\n`P2`ã¯ã€`P2ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°`ã®è¡¨ã‹ã‚‰ã€`æœ€åˆã¾ãŸã¯å”¯ä¸€ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ`ã‚’åˆ©ç”¨ã—ãŸã„ã®ã§ã€2é€²æ•°`1100`ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚ã“ã‚Œã‚’16é€²æ•°ã«ã—ãŸ`0x0C`ã‚’æ¸¡ã—ã¾ã™ã€‚  \r\n`LC`ã¯ã€`DFå`ã®é•·ã•ã‚’ã„ã‚Œã¾ã™ã€‚å¾Œè¿°ã—ã¾ã™ãŒã€`DF1`ã®é¸æŠã«ã¯16ãƒã‚¤ãƒˆå¿…è¦ãªã®ã§ã€10é€²æ•°`16`ã‚’16é€²æ•°ã«ã—ãŸ`0x10`ã‚’æ¸¡ã—ã¾ã™ã€‚  \r\n`DF1ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­(AID)`ãªã‚“ã§ã™ãŒã€ä»¥ä¸‹ã§ã™ã€‚é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸7ãƒšãƒ¼ã‚¸ç›®`DF1ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­(AID)`å‚ç…§ã€‚  \r\n\r\n```\r\n0xA0, 0x00, 0x00, 0x02, 0x31, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\r\n```\r\n\r\n| CLA | INS | P1 | P2 | Lc | DF1ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è­˜åˆ¥å­(AID) |\r\n|-----|-----|----|----|----|----------------------------------|\r\n| 0x00 | 0xA4 | 0x04 | 0x0C | 0x10 |å¾Œè¿°|\r\n\r\n```\r\n0x00, 0xA4, 0x04, 0x0C, 0x10, 0xA0, 0x00, 0x00, 0x02, 0x31, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00\r\n```\r\n\r\næˆåŠŸã™ã‚‹ã¨ã€æœ€åˆã®å€¤ãŒ`0x90`ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\nã“ã‚Œã‚’`Kotlin`ã§æ›¸ãã¨ã“ã†\r\n\r\n```kotlin\r\n// ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’DF1ã¸\r\nval df1SelectCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0xA4.toByte(),\r\n    0x04.toByte(),\r\n    0x0C.toByte(),\r\n    0x10.toByte(),\r\n    0xA0.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x02.toByte(),\r\n    0x31.toByte(),\r\n    0x01.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n)\r\nval df1SelectCommandResult = isoDep.transceive(df1SelectCommand)\r\nif (df1SelectCommandResult[0] == 0x90.toByte()) {\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        DF1é¸æŠ æˆåŠŸ\r\n        ${df1SelectCommandResult.toHexString()}\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n### DF1ã®EF01ï¼ˆè¨˜è¼‰äº‹é …ï¼‰ã‚’èª­ã¿å‡ºã™ã‚³ãƒãƒ³ãƒ‰\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸26ãƒšãƒ¼ã‚¸ç›®å‚ç…§ã€‚\r\n\r\né•·ã‹ã£ãŸã€‚ã„ã‚„ã¾ã ãƒã‚¤ãƒˆé…åˆ—ã‚’è§£æã™ã‚‹ä»•äº‹ãŒæ®‹ã£ã¦ã‚‹ã‚“ã§ã™ãŒã€‚ \r\n\r\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚`READ BINARY`ã®`P1/P2`ã§`EF01`ã‚’æŒ‡å®šã™ã‚‹ã®ã§ã€`SELECT FILE`ã§äºˆã‚ç§»å‹•ã—ã¦ãŠãå¿…è¦ã¯ãªã„ã§ã™ã€‚  \r\n`P1`ã€`P2`ã¯`é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸26ãƒšãƒ¼ã‚¸ç›®ã®P1-P2ã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°(ç›¸å¯¾ã‚¢ãƒ‰ãƒ¬ã‚¹ï¼˜ãƒ“ãƒƒãƒˆæŒ‡å®š)`ã®è¡¨ã‹ã‚‰ã€`P1`ã§`EF01`ã‚’`çŸ­ç¸®EFè­˜åˆ¥å­`ã§æŒ‡å®šã™ã‚‹ãŸã‚(EF01ã®çŸ­ç¸®EFè­˜åˆ¥å­ã¯`0001`)ã€`10000001`ã€`P2`ãŒ`00000000`ã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚  \r\n`Lc`ã§ã™ãŒã€`é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸7ãƒšãƒ¼ã‚¸ç›®ã®ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ`ã‹ã‚‰ã€è¨˜è¼‰äº‹é …ã®ãƒ•ã‚¡ã‚¤ãƒ«å®¹é‡ãŒ`880`ãƒã‚¤ãƒˆã§ã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚‹ã®ã§ã€10é€²æ•°`880`ã‚’16é€²æ•°ã«ã—ãŸ`0x370`ã‚’ãƒã‚¤ãƒˆé…åˆ—ã«ã—ãŸ`0x03, 0x80`ã‚’æ¸¡ã™ã‚“ã§ã™ãŒã€  \r\n`é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸26ãƒšãƒ¼ã‚¸ç›®ã®ã‚³ãƒãƒ³ãƒ‰APDU`ã‚’è¦‹ã‚‹ã¨ã€`Lc`ã¯`1ãƒã‚¤ãƒˆã‹3ãƒã‚¤ãƒˆ`ã®ã©ã£ã¡ã‹ãªã®ã§ã€å…ˆé ­ã«`0x00`ã‚’ã„ã‚Œã¦3ãƒã‚¤ãƒˆã«ã—ãŸ`0x00, 0x03, 0x80`ã‚’æ¸¡ã—ã¾ã™ã€‚\r\n\r\n| CLA | INS | P1 | P2 | Lc | Lc | Lc |\r\n|-----|-----|----|----|----|----|----|\r\n| 0x00 | 0xB0 | 0x81 | 0x00 |0x00|0x03|0x70|\r\n\r\n```\r\n0x00, 0xB0, 0x81, 0x00, 0x00, 0x03, 0x70\r\n```\r\n\r\næˆåŠŸã—ãŸå ´åˆã¯ã€ãƒã‚¤ãƒˆé…åˆ—ã®æœ€å¾Œã‹ã‚‰äºŒç•ªç›®ãŒ`0x90`ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\nã“ã‚Œã‚’Kotlinã§æ›¸ãã¨ã“ã†ã€‚\r\n\r\n```kotlin\r\n// è¨˜è¼‰äº‹é …(DF1/EF01)ã‚’èª­ã¿å‡ºã™\r\nval df1Ef01ReadBinaryCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0xB0.toByte(),\r\n    0x81.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x03.toByte(),\r\n    0x70.toByte(),\r\n)\r\nval df1Ef01ReadBinaryCommandResult = isoDep.transceive(df1Ef01ReadBinaryCommand)\r\nif (df1Ef01ReadBinaryCommandResult[df1Ef01ReadBinaryCommandResult.size - 2] == 0x90.toByte()) {\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        DF1/EF01èª­ã¿å‡ºã—ã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n        ${df1Ef01ReadBinaryCommandResult.toHexString()}\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n}\r\n```\r\n\r\n### DF1ã®EF01ã®ãƒã‚¤ãƒˆé…åˆ—ã‚’èª­ã‚ã‚‹å½¢ã«å¤‰æ›ã™ã‚‹\r\né‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸11ãƒšãƒ¼ã‚¸ç›®å‚ç…§ã€‚  \r\n[é‹è»¢å…è¨±è¨¼ã¨é€šä¿¡ã—ãŸéš›ã«è¿”ã£ã¦ãã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦](/posts/android_nfc_japan_driver_license_card_reader/#é‹è»¢å…è¨±è¨¼ã¨é€šä¿¡ã—ãŸéš›ã«è¿”ã£ã¦ãã‚‹ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦)ã®èª¬æ˜ãŒå½¹ã«ç«‹ã¤ã‚ã‘ã§ã™ã­ï¼ˆããåˆ†ã‹ã‚Šã«ãã„ï¼‰  \r\n  \r\næ°åã€ä½æ‰€ãŒã©ã®é †ç•ªã§å…¥ã£ã¦ã„ã‚‹ã‹ã¯`é‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸ã®11ãƒšãƒ¼ã‚¸ç›®`ã®è¡¨ã«æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚\r\n\r\nKotlinã®ã‚³ãƒ¼ãƒ‰ã¯ã€`ã•ã£ãæ›¸ã„ãŸif`ã®ä¸­ã«æ›¸ã„ã¦ã„ã£ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ã®`// ã“ã£ã‹ã‚‰`ã£ã¦ã¨ã“ã‚ã‹ã‚‰\r\n\r\n```kotlin\r\nif (df1Ef01ReadBinaryCommandResult[df1Ef01ReadBinaryCommandResult.size - 2] == 0x90.toByte()) {\r\n    val text = \"\"\"\r\n        \r\n        ---\r\n        DF1/EF01èª­ã¿å‡ºã—ã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n        ${df1Ef01ReadBinaryCommandResult.toHexString()}\r\n    \"\"\".trimIndent()\r\n    textView.append(text)\r\n    println(text)\r\n\r\n    // ã“ã£ã‹ã‚‰\r\n\r\n}\r\n```\r\n\r\n#### JIS X 0208 åˆ¶å®šå¹´ç•ªå·\r\næœ€åˆã®ãƒ‡ãƒ¼ã‚¿ã¯`JIS X 0208 åˆ¶å®šå¹´ç•ªå·`ã£ã¦ã®ãŒå…¥ã£ã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã€‚ä»¥ä¸‹ä¾‹\r\n```\r\n0x11, 0x01, 0x78\r\n```\r\n\r\n`0x11`ã¯`JIS X 0208 åˆ¶å®šå¹´ç•ªå·`ã®ã‚¿ã‚°ã§ã™ã€‚  \r\n`0x01`ã¯ãã®æ¬¡ã«æ¥ã‚‹å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã§ã™ã€‚ä»Šå›ã¯`0x01`ã‚’10é€²æ•°ã«ã—ãŸ`1`ãƒã‚¤ãƒˆåˆ†ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã§ã™ã€‚  \r\n`0x78`ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸­èº«ã§ã™ãŒã€`78`ã®å ´åˆã¯1978å¹´ã«åˆ¶å®šã•ã‚ŒãŸ`JIS C 6226`ã§ç¬¦å·åŒ–ã•ã‚ŒãŸã¨ã„ã†ã‚ã‘ã‚‰ã—ã„ã®ã§ã™ãŒã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ã€‚  \r\n~~é¢ç™½ããªã„ã®ã§é£›ã°ã—ã¾ã™ã€‚~~\r\n\r\n```kotlin\r\n// JIS X 0208\r\nval jisX0208Data = df1Ef01ReadBinaryCommandResult.copyOfRange(0, 3)\r\nval jisX0208 = \"%02x\".format(jisX0208Data.last())\r\n```\r\n\r\n#### æ°å\r\næ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã¯æ°åã§ã™ã€‚æ°åã¯å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ãŒå¯å¤‰é•·ãªã®ã§ï¼ˆå½“ãŸã‚Šå‰ï¼‰æ³¨æ„ã—ã¦ãã ã•ã„ã€‚ä»¥ä¸‹ä¾‹  \r\n```\r\n0x12, 0x0A, <JIS X 0208ã§å¤‰æ›ã—ãŸãƒ‡ãƒ¼ã‚¿>\r\n```\r\n\r\n`0x12`ã¯`æ°å`ã®ã‚¿ã‚°ã§ã™ã€‚  \r\n`0x0A`ãŒã€ã“ã®å¾Œã®å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã‚’16é€²æ•°ã§è¡¨ã—ãŸã‚‚ã®ã§ã™ã€‚10é€²æ•°ã«æˆ»ã—ãŸå€¤ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã«ãªã‚Šã¾ã™ã€‚  \r\nå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã¯`JIS X 0208`ã§å¤‰æ›ã—ã¦ã„ã‚‹ã®ã§ã€ã‚ã¨ã§æˆ»ã—ã¾ã™ã€‚\r\n\r\n#### JIS X 0208 ã‚’èª­ã‚ã‚‹å½¢ã«æˆ»ã™\r\nä¸Šã®æ–¹ã§ã‚‚æ›¸ãã¾ã—ãŸãŒã€æˆ»ã™ã«ã¯ã€`JIS X 0208`ã®ãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­ã«ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã¨ã—ã¦`0x1B, 0x24, 0x42`ã‚’ä»˜ã‘ã¦ã€`JISã‚³ãƒ¼ãƒ‰`ã¨ã—ã¦å¤‰æ›ã—ã¦ã‚ã’ã‚Œã°ã„ã„ã§ã™ã€‚\r\n\r\nKotlinã§æ›¸ãã¨ã“ã†ã§ã™ã€‚(JIS X 0208 åˆ¶å®šå¹´ç•ªå·ã«æ›¸ãè¶³ã™æ„Ÿã˜ã§ï¼‰\r\n\r\n```kotlin\r\n// ãƒ‡ãƒ¼ã‚¿ã‚’è§£æã™ã‚‹\r\n// ç¾åœ¨ã®ãƒã‚¤ãƒˆé…åˆ—ã®ä½ç½®ï¼Ÿ\r\nvar length = 0\r\n\r\n// JIS X 0208\r\nlength = 3\r\nval jisX0208Data = df1Ef01ReadBinaryCommandResult.copyOfRange(0, length)\r\nval jisX0208 = \"%02x\".format(jisX0208Data.last())\r\n\r\n// åå‰\r\nval nameLength = df1Ef01ReadBinaryCommandResult[length + 1]\r\nval nameData = df1Ef01ReadBinaryCommandResult.copyOfRange(length + 2, length + 2 + nameLength.toInt())\r\nval escapeSequence = byteArrayOf(0x1b.toByte(), 0x24.toByte(), 0x42.toByte())\r\nval name = String(escapeSequence + nameData, charset(\"jis\"))\r\nlength += 2 + nameLength.toInt()\r\n\r\nval dfEf01FormattedText = \"\"\"\r\n    \r\n    ---\r\n    JIS X 0208 åˆ¶å®šå¹´ç•ªå·ï¼š$jisX0208\r\n    åå‰ï¼š$name\r\n\"\"\".trimIndent()\r\ntextView.append(dfEf01FormattedText)\r\nprintln(dfEf01FormattedText)\r\n```\r\n\r\næ°åãŒå‡ºåŠ›ã•ã‚ŒãŸã‚‰æˆåŠŸã§ã™ã€‚ãŠã‚  \r\næ°ã¨åã®é–“ã«ã¯ã‚¹ãƒšãƒ¼ã‚¹ãŒå…¥ã£ã¦ã¾ã™ãŒä»•æ§˜ã§ã™ã€‚\r\n\r\n#### è¦‹ãšã‚‰ã„ã®ã§é–¢æ•°ã«ã¾ã¨ã‚ã‚‹\r\næœ¬å½“ã¯ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‹ã‚‰å€¤ã‚’å–å¾—ã™ã‚‹é–¢æ•°ã‚’ä½œã‚Œã‚Œã°ã„ã„ã‚“ã§ã™ãŒã€  \r\nã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§åˆ©ç”¨ã—ã¦ã„ã‚‹16é€²æ•°ã€ã“ã‚Œå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã‚‚æ™®é€šã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã®ã§å¤šåˆ†indexOfã¨ã‹ã§æ¤œç´¢ã‹ã‘ã¦ã‚‚ã†ã¾ãã„ãã¾ã›ã‚“ã€‚  \r\n\r\nãªã‚“ã§ã€ä½æ‰€ã ã‘ãŒæ¬²ã—ã„å ´åˆã§ã‚‚é †ç•ªã«å–å¾—ã—ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã‚Œã¯é¢å€’ãªã®ã§é–¢æ•°ã‚’æ›¸ã„ã¦å°‘ã—ã ã‘ã§ã‚‚æ¥½ã«ãªã‚Šã¾ã—ã‚‡ã†ã€‚\r\n\r\n```kotlin\r\n/**\r\n * æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹\r\n * @param currentPos ä»Šã®ä½ç½®ã€‚åˆå›æ™‚ã¯0ï¼Ÿ\r\n * @return Intã¯ã€ä»Šã®ä½ç½®ã‚’è¿”ã—ã¾ã™ã€‚ï¼’å›ç›®ä»¥é™ã“ã®é–¢æ•°ã‚’å‘¼ã¶éš›ã«ä½¿ã£ã¦ãã ã•ã„ã€ByteArrayã¯å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™\r\n * */\r\nprivate fun ByteArray.getValueField(currentPos: Int): Pair<Int, ByteArray> {\r\n    // é•·ã•ã‚’èª­ã¿å–ã‚‹\r\n    val length = this[currentPos + 1]\r\n    return currentPos + 2 + length to copyOfRange(currentPos + 2, currentPos + 2 + length)\r\n}\r\n\r\n/** JIS X 0208ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’æˆ»ã™ */\r\nprivate fun ByteArray.toJISX0208(): String {\r\n    // å¤‰æ›ã™ã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã§å¤‰æ›ã§ãã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã‚ˆã‚Šã€æ–‡å­—é›†åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹\r\n    val escapeSequence = byteArrayOf(0x1B.toByte(), 0x24.toByte(), 0x42.toByte()) // JIS X 0208\r\n    return String(escapeSequence + this, charset(\"jis\"))\r\n}\r\n\r\n/** JIS X 0201ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’æˆ»ã™ */\r\nprivate fun ByteArray.toJISX0201(): String {\r\n    // å¤‰æ›ã™ã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã§å¤‰æ›ã§ãã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã‚ˆã‚Šã€æ–‡å­—é›†åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹\r\n    val escapeSequence = byteArrayOf(0x1B.toByte(), 0x28.toByte(), 0x42.toByte()) // ASCII\r\n    return String(escapeSequence + this, charset(\"jis\"))\r\n}\r\n\r\n/** JIS X 0201ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’æˆ»ã—ã¦ã€æ—¥ä»˜å½¢å¼ã«ã™ã‚‹ */\r\nprivate fun ByteArray.toJISX0201DateString(): String {\r\n    // ã¨ã‚Šã‚ãˆãšJIS X 0201ã®å¤‰æ›å¾Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\r\n    val valueField = this.toJISX0201()\r\n    val gengo = when (valueField.first()) {\r\n        '1' -> \"æ˜æ²»\"\r\n        '2' -> \"å¤§æ­£\"\r\n        '3' -> \"æ˜­å’Œ\"\r\n        '4' -> \"å¹³æˆ\"\r\n        else -> \"ä»¤å’Œ\"\r\n    }\r\n    val year = valueField.substring(1, 3)\r\n    val month = valueField.substring(3, 5)\r\n    val date = valueField.substring(5, 7)\r\n    return \"$gengo ${year}å¹´ ${month}æœˆ ${date}æ—¥\"\r\n}\r\n```\r\n\r\nä¸Šè¨˜ã®æ‹¡å¼µé–¢æ•°ã‚’åˆ©ç”¨ã—ã¦ã€åˆ¶å®šå¹´ç•ªå·ã€æ°åã‚’å–å¾—ã™ã‚‹éƒ¨åˆ†ã‚’æ›¸ãæ›ãˆã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã€‚\r\n\r\n```kotlin\r\nvar currentPos = 0\r\n// è¨˜è¼‰äº‹é …ã‚’ä¸Šã‹ã‚‰é †ç•ªã«å–å¾—ã—ã¦ã„ã\r\nval byteArrayList = mutableListOf<ByteArray>()\r\nrepeat(17) {\r\n    val (pos, data) = df1Ef01ReadBinaryCommandResult.getValueField(currentPos)\r\n    byteArrayList.add(data)\r\n    currentPos = pos\r\n}\r\n\r\n// JIS X 0208 åˆ¶å®šå¹´ç•ªå·\r\nval jisX0208 = \"%02x\".format(byteArrayList[0].last())\r\n// åå‰\r\nval name = byteArrayList[1].toJISX0208()\r\n// èª­ã¿\r\nval yomi =  byteArrayList[2].toJISX0208()\r\n// é€šç§°å\r\nval tuusyoumei = byteArrayList[3].toJISX0208()\r\n// çµ±ä¸€æ°å\r\nval touitusimei = byteArrayList[4].toJISX0208()\r\n// ç”Ÿå¹´æœˆæ—¥\r\nval birthday = byteArrayList[5].toJISX0201DateString()\r\n// ä½æ‰€\r\nval location = byteArrayList[6].toJISX0208()\r\n// äº¤ä»˜å¹´æœˆæ—¥\r\nval registeredAt =  byteArrayList[7].toJISX0201DateString()\r\n// ç…§ä¼šç•ªå·\r\nval syoukaiNum = byteArrayList[8].toJISX0201()\r\n// å…è¨±è¨¼ã®è‰²åŒºåˆ†\r\nval color = byteArrayList[9].toJISX0208()\r\n// æœ‰åŠ¹æœŸé™\r\nval endTimeAt =byteArrayList[10].toJISX0201DateString()\r\n// é‹è»¢å…è¨±ã®æ¡ä»¶ã€‚ãƒ¡ã‚¬ãƒãªã©\r\nval requirement1 = byteArrayList[11].toJISX0208()\r\nval requirement2 = byteArrayList[12].toJISX0208()\r\nval requirement3 = byteArrayList[13].toJISX0208()\r\nval requirement4 = byteArrayList[14].toJISX0208()\r\n// å…¬å®‰å§”å“¡ä¼šå\r\nval publicSafetyCommissionName = byteArrayList[15].toJISX0208()\r\n// é‹è»¢å…è¨±è¨¼ã®ç•ªå·\r\nval cardNumber = byteArrayList[16].toJISX0201()\r\n\r\nval dfEf01FormattedText = \"\"\"\r\n    \r\n    ---\r\n    JIS X 0208 åˆ¶å®šå¹´ç•ªå·ï¼š$jisX0208\r\n    åå‰ï¼š$name\r\n    èª­ã¿ï¼š$yomi\r\n    é€šç§°åï¼š$tuusyoumei\r\n    çµ±ä¸€æ°åï¼š$touitusimei\r\n    ä½æ‰€ï¼š$location\r\n    ç”Ÿå¹´æœˆæ—¥ï¼š$birthday\r\n    äº¤ä»˜å¹´æœˆæ—¥ï¼š$registeredAt\r\n    æœ‰åŠ¹æœŸé™ï¼š$endTimeAt\r\n    ç…§ä¼šç•ªå·ï¼š$syoukaiNum\r\n    è‰²åŒºåˆ†ï¼š$color\r\n    é‹è»¢å…è¨±ã®æ¡ä»¶ï¼‘ï¼š$requirement1\r\n    é‹è»¢å…è¨±ã®æ¡ä»¶ï¼’ï¼š$requirement2\r\n    é‹è»¢å…è¨±ã®æ¡ä»¶ï¼“ï¼š$requirement3\r\n    é‹è»¢å…è¨±ã®æ¡ä»¶ï¼”ï¼š$requirement4\r\n    å…¬å®‰å§”å“¡ä¼šåï¼š$publicSafetyCommissionName\r\n    é‹è»¢å…è¨±è¨¼ã®ç•ªå·ï¼š$cardNumber\r\n\"\"\".trimIndent()\r\ntextView.append(dfEf01FormattedText)\r\nprintln(dfEf01FormattedText)\r\n```\r\n\r\n#### ç”Ÿå¹´æœˆæ—¥ã€äº¤ä»˜å¹´æœˆæ—¥ç­‰ã®æ—¥ä»˜ã®ãƒ‡ãƒ¼ã‚¿ã«ã¤ã„ã¦\r\nç”Ÿå¹´æœˆæ—¥ã€äº¤ä»˜å¹´æœˆæ—¥ç­‰ã®æ—¥ä»˜ã«é–¢ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã¯`JIS X 0201`ã§ä¿å­˜ã•ã‚Œã¦ãŠã‚Šã€  \r\nå¤‰æ›å¾Œã®å…ˆé ­ã®æ•°å­—ã¯å…ƒå·ã‚’è¡¨ã—ã¦ãŠã‚Šã€`æ˜æ²»=1, å¤§æ­£=2, æ˜­å’Œ=3, å¹³æˆ=4, ä»¤å’Œ=5`ã«ãªã‚Šã¾ã™ã€‚ï¼ˆé‹è»¢å…è¨±è¨¼ICä»•æ§˜æ›¸11ãƒšãƒ¼ã‚¸ç›® æ³¨6ï¼‰  \r\nãã®æ¬¡ã®äºŒæ–‡å­—ã¯ã€å’Œæš¦ã®å¹´ã‚’è¡¨ã—ã¦ã„ã¾ã™ã€‚  \r\nãã®æ¬¡ã®äºŒæ–‡å­—ã¯æœˆã€ãã®æ¬¡ã®äºŒæ–‡å­—ãŒæ—¥ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\nä¾‹(ä»Šæ›´ã ã‘ã©16é€²æ•°ãªã®ã§`0x`ã‚’ã¤ã‘ã¾ã—ãŸ)ï¼š\r\n\r\n```\r\n0x16, 0x07, 0x34, 0x31, 0x34, 0x30, 0x39, 0x31, 0x33\r\n```\r\n\r\n`0x16`ãŒç”Ÿå¹´æœˆæ—¥ã§æœ‰ã‚‹ã“ã¨ã‚’è¡¨ã™ã‚¿ã‚°ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã€  \r\n`0x07`ãŒã“ã®å¾Œç¶šãå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã§ã™ã€‚10é€²æ•°ã«ã—ãŸ7ãƒã‚¤ãƒˆåˆ†ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®é•·ã•ã«ãªã‚Šã¾ã™ã€‚  \r\n`0x34`ã‹ã‚‰`0x33`ã¾ã§ãŒå€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®ä¸­èº«ã§ã™ã€‚`JIS X 0201`ã§å¤‰æ›ã§ãã¾ã™ã€‚\r\n\r\nä¸Šè¨˜ã®ãƒã‚¤ãƒˆé…åˆ—ã‚’å¤‰æ›ã—ãŸçµæœã§ã™ã€‚\r\n\r\n```\r\n4140913\r\n```\r\n\r\nå…ˆé ­ã®æ•°å­—ãŒå…ƒå·ã‚’è¡¨ã—ã¦ãŠã‚Šã€`4`ã®å ´åˆã¯`å¹³æˆ`ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\nã‚ˆã£ã¦ã€ä¸Šè¨˜ã®ãƒã‚¤ãƒˆé…åˆ—ã®å€¤ã¯`å¹³æˆ14å¹´ 09æœˆ 13æ—¥`ã¨è¡¨ã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚  \r\n\r\n#### çµ‚ã‚ã‚Šã«\r\nå…¨éƒ¨ãã£ã¤ã‘ãŸã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚\r\n\r\n<span style=\"color:red;font-size:20px\">// æš—è¨¼ç•ªå·1ã‚’ç…§åˆã™ã‚‹</span>ã®éƒ¨åˆ†ã¯å„è‡ªè‡ªåˆ†ã®æš—è¨¼ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val textView by lazy { findViewById<TextView>(R.id.activity_main_text_view) }\r\n\r\n    /** NFCã‚’æ¤œå‡ºã™ã‚‹ã®ã«ä½¿ã† */\r\n    private val nfcAdapter by lazy { NfcAdapter.getDefaultAdapter(this) }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n    }\r\n\r\n    override fun onResume() {\r\n        super.onResume()\r\n        nfcAdapter.enableReaderMode(\r\n            this,\r\n            { tag ->\r\n\r\n                val isoDep = IsoDep.get(tag)\r\n                isoDep.connect()\r\n\r\n                // ã“ã“ã«ã‚³ãƒãƒ³ãƒ‰ã‚’é€ä¿¡ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’å…¥ã‚Œã‚‹\r\n\r\n                // ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’MFã«ã™ã‚‹\r\n                val mfSelectCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0xA4.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte()\r\n                )\r\n                val mfSelectCommandResult = isoDep.transceive(mfSelectCommand)\r\n                if (mfSelectCommandResult[0] == 0x90.toByte()) {\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        MFé¸æŠã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n                        ${mfSelectCommandResult.toHexString()}\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(text)\r\n                }\r\n\r\n                // ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´ ã«è¨­å®šã™ã‚‹\r\n                val mfEf01SelectCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0xA4.toByte(),\r\n                    0x02.toByte(),\r\n                    0x0C.toByte(),\r\n                    0x02.toByte(),\r\n                    0x2F.toByte(),\r\n                    0x01.toByte(),\r\n                )\r\n                val mfEf01SelectCommandResult = isoDep.transceive(mfEf01SelectCommand)\r\n                if (mfEf01SelectCommandResult[0] == 0x90.toByte()) {\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        DF/EF01 å…±é€šãƒ‡ãƒ¼ã‚¿è¦ç´  é¸æŠã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n                        ${mfEf01SelectCommandResult.toHexString()}\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(text)\r\n                }\r\n\r\n                // ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’èª­ã¿å–ã‚‹\r\n                val mfEf01ReadBinaryCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0xB0.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x11.toByte()\r\n                )\r\n                val mfEf01ReadBinaryCommandResult = isoDep.transceive(mfEf01ReadBinaryCommand)\r\n                // æˆåŠŸã—ãŸå ´åˆã€æœ€å¾Œã‹ã‚‰2ç•ªç›®ã®16é€²æ•°ãŒ0x90\r\n                if (mfEf01ReadBinaryCommandResult[mfEf01ReadBinaryCommandResult.size - 2] == 0x90.toByte()) {\r\n                    // ã‚«ãƒ¼ãƒ‰ç™ºè¡Œè€…ãƒ‡ãƒ¼ã‚¿ã®é•·ã•ã‚’å–å¾—\r\n                    val cardPublisherDataLength = mfEf01ReadBinaryCommandResult[1].toInt() // å¤šåˆ†11\r\n                    // å…ˆé ­ã‹ã‚‰ cardPublisherDataLength åˆ†ã®ãƒã‚¤ãƒˆé…åˆ—å–å¾—\r\n                    val cardPublisherDataBinary = mfEf01ReadBinaryCommandResult.copyOfRange(2, 2 + cardPublisherDataLength)\r\n                    // ã‚«ãƒ¼ãƒ‰ç™ºç‹‚è€…ãƒ‡ãƒ¼ã‚¿ã€æœ€åˆã®3ãƒã‚¤ãƒˆãŒä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼ˆSJISå¤‰æ›å¾Œç¢ºèªå¯èƒ½ï¼‰ã€æ¬¡ã®4ãƒã‚¤ãƒˆãŒäº¤ä»˜å¹´æœˆæ—¥ã€æ¬¡ã®4ãƒã‚¤ãƒˆãŒæœ‰åŠ¹æœŸé™\r\n                    val version = cardPublisherDataBinary.copyOfRange(0, 3).toString(charset(\"sjis\"))\r\n                    val publishDate = cardPublisherDataBinary.copyOfRange(4, 7).joinToString(separator = \"\") { \"%02x\".format(it) }\r\n                    val effectiveDate = cardPublisherDataBinary.copyOfRange(8, 11).joinToString(separator = \"\") { \"%02x\".format(it) }\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª èª­ã¿å–ã‚Šã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n                        ${mfEf01ReadBinaryCommandResult.toHexString()}\r\n                        ä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼š$version\r\n                        ç™ºè¡Œå¹´æœˆæ—¥ï¼š$publishDate\r\n                        æœ‰åŠ¹æœŸé™ï¼š$effectiveDate\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(text)\r\n                }\r\n\r\n                // æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ã‚’å–å¾—ã™ã‚‹\r\n                val retryCountVerifyCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0x20.toByte(),\r\n                    0x00.toByte(),\r\n                    0x81.toByte()\r\n                )\r\n                val retryCountVerifyCommandResult = isoDep.transceive(retryCountVerifyCommand)\r\n                println(retryCountVerifyCommandResult.toHexString())\r\n                if (retryCountVerifyCommandResult[0] == 0x63.toByte()) {\r\n                    val retryCountHex = retryCountVerifyCommandResult.last().toInt() - 0xC0 // 0xC0ã‚’å¼•ã‘ã°æœ€å¾ŒãŒæ®‹ã‚‹\r\n                    val retryCount = \"%x\".format(retryCountHex).last() // ffffff03ã¿ãŸã„ãªæ„Ÿã˜ã«ãªã‚‹ã€ã®ã§æœ€å¾Œã ã‘å–å¾—\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•° èª­ã¿å–ã‚Šã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n                        ${retryCountVerifyCommandResult.toHexString()}\r\n                        æ®‹ã‚Šç…§åˆå¯èƒ½å›æ•°ï¼š$retryCount\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(text)\r\n                }\r\n\r\n                // æš—è¨¼ç•ªå·1ã‚’ç…§åˆã™ã‚‹\r\n                val pinCode1CharList = listOf(0, 0, 0, 0) // å„è‡ªæš—è¨¼ç•ªå·ã‚’å…¥åŠ›\r\n                val pinCode1EncodedList = pinCode1CharList.map { toJIS(it.toString()[0]) }\r\n                val pinCode1VerifyCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0x20.toByte(),\r\n                    0x00.toByte(),\r\n                    0x81.toByte(),\r\n                    0x04.toByte(),\r\n                ) + pinCode1EncodedList\r\n                val pinCode1VerifyCommandResult = isoDep.transceive(pinCode1VerifyCommand)\r\n                println(pinCode1VerifyCommandResult.toHexString())\r\n                if (pinCode1VerifyCommandResult[pinCode1VerifyCommandResult.size - 2] == 0x90.toByte()) {\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        ç¬¬ä¸€æš—è¨¼ç•ªå·ã®ç…§åˆ æˆåŠŸ\r\n                        ${pinCode1VerifyCommandResult.toHexString()}\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(text)\r\n                }\r\n\r\n                // ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’DF1ã¸\r\n                val df1SelectCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0xA4.toByte(),\r\n                    0x04.toByte(),\r\n                    0x0C.toByte(),\r\n                    0x10.toByte(),\r\n                    0xA0.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x02.toByte(),\r\n                    0x31.toByte(),\r\n                    0x01.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                )\r\n                val df1SelectCommandResult = isoDep.transceive(df1SelectCommand)\r\n                if (df1SelectCommandResult[0] == 0x90.toByte()) {\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        DF1é¸æŠ æˆåŠŸ\r\n                        ${df1SelectCommandResult.toHexString()}\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(text)\r\n                }\r\n\r\n                // è¨˜è¼‰äº‹é …(DF1/EF01)ã‚’èª­ã¿å‡ºã™\r\n                val df1Ef01ReadBinaryCommand = byteArrayOf(\r\n                    0x00.toByte(),\r\n                    0xB0.toByte(),\r\n                    0x81.toByte(),\r\n                    0x00.toByte(),\r\n                    0x00.toByte(),\r\n                    0x03.toByte(),\r\n                    0x70.toByte(),\r\n                )\r\n                val df1Ef01ReadBinaryCommandResult = isoDep.transceive(df1Ef01ReadBinaryCommand)\r\n                if (df1Ef01ReadBinaryCommandResult[df1Ef01ReadBinaryCommandResult.size - 2] == 0x90.toByte()) {\r\n                    val text = \"\"\"\r\n                        \r\n                        ---\r\n                        DF1/EF01èª­ã¿å‡ºã—ã‚³ãƒãƒ³ãƒ‰ æˆåŠŸ\r\n                        ãƒ‡ãƒ¼ã‚¿ã®é•·ã•ï¼š${df1Ef01ReadBinaryCommandResult.size}\r\n                    \"\"\".trimIndent()\r\n                    textView.append(text)\r\n                    println(df1Ef01ReadBinaryCommandResult.toHexString())\r\n                    println(text)\r\n\r\n                    var currentPos = 0\r\n                    // è¨˜è¼‰äº‹é …ã‚’ä¸Šã‹ã‚‰é †ç•ªã«å–å¾—ã—ã¦ã„ã\r\n                    val byteArrayList = mutableListOf<ByteArray>()\r\n                    repeat(35) {\r\n                        val (pos, data) = df1Ef01ReadBinaryCommandResult.getValueField(currentPos)\r\n                        byteArrayList.add(data)\r\n                        currentPos = pos\r\n                    }\r\n\r\n                    // JIS X 0208 åˆ¶å®šå¹´ç•ªå·\r\n                    val jisX0208 = \"%02x\".format(byteArrayList[0].last())\r\n                    // åå‰\r\n                    val name = byteArrayList[1].toJISX0208()\r\n                    // èª­ã¿\r\n                    val yomi = byteArrayList[2].toJISX0208()\r\n                    // é€šç§°å\r\n                    val tuusyoumei = byteArrayList[3].toJISX0208()\r\n                    // çµ±ä¸€æ°å\r\n                    val touitusimei = byteArrayList[4].toJISX0208()\r\n                    // ç”Ÿå¹´æœˆæ—¥\r\n                    val birthday = byteArrayList[5].toJISX0201DateString()\r\n                    // ä½æ‰€\r\n                    val location = byteArrayList[6].toJISX0208()\r\n                    // äº¤ä»˜å¹´æœˆæ—¥\r\n                    val registeredAt = byteArrayList[7].toJISX0201DateString()\r\n                    // ç…§ä¼šç•ªå·\r\n                    val syoukaiNum = byteArrayList[8].toJISX0201()\r\n                    // å…è¨±è¨¼ã®è‰²åŒºåˆ†\r\n                    val color = byteArrayList[9].toJISX0208()\r\n                    // æœ‰åŠ¹æœŸé™\r\n                    val endTimeAt = byteArrayList[10].toJISX0201DateString()\r\n                    // é‹è»¢å…è¨±ã®æ¡ä»¶ã€‚ãƒ¡ã‚¬ãƒãªã©\r\n                    val requirement1 = byteArrayList[11].toJISX0208()\r\n                    val requirement2 = byteArrayList[12].toJISX0208()\r\n                    val requirement3 = byteArrayList[13].toJISX0208()\r\n                    val requirement4 = byteArrayList[14].toJISX0208()\r\n                    // å…¬å®‰å§”å“¡ä¼šå\r\n                    val publicSafetyCommissionName = byteArrayList[15].toJISX0208()\r\n                    // é‹è»¢å…è¨±è¨¼ã®ç•ªå·\r\n                    val cardNumber = byteArrayList[16].toJISX0201()\r\n                    // ä»–ã®å…è¨±\r\n                    val nirin = byteArrayList[17].toJISX0201DateString()\r\n                    val hoka = byteArrayList[18].toJISX0201DateString()\r\n                    val nisyu = byteArrayList[19].toJISX0201DateString()\r\n                    val oogata = byteArrayList[20].toJISX0201DateString()\r\n                    val hutuu = byteArrayList[21].toJISX0201DateString()\r\n                    val oogatatokusyu = byteArrayList[22].toJISX0201DateString()\r\n                    val oogatazidounirin = byteArrayList[23].toJISX0201DateString()\r\n                    val hutuuzidounirin = byteArrayList[24].toJISX0201DateString()\r\n                    val kogatatokusyu = byteArrayList[25].toJISX0201DateString()\r\n                    val gentuki = byteArrayList[26].toJISX0201DateString()\r\n                    val kanninn = byteArrayList[27].toJISX0201DateString()\r\n                    val oogatanisyu = byteArrayList[28].toJISX0201DateString()\r\n                    val hutuunisyu = byteArrayList[29].toJISX0201DateString()\r\n                    val oogataokusyunisyu = byteArrayList[30].toJISX0201DateString()\r\n                    val kenninnnisyu = byteArrayList[31].toJISX0201DateString()\r\n                    val tyuugata = byteArrayList[32].toJISX0201DateString()\r\n                    val tyuugatanisyu = byteArrayList[33].toJISX0201DateString()\r\n                    val zyuntyuugata = byteArrayList[34].toJISX0201DateString()\r\n\r\n                    val dfEf01FormattedText = \"\"\"\r\n                        \r\n                        ---\r\n                        JIS X 0208 åˆ¶å®šå¹´ç•ªå·ï¼š$jisX0208\r\n                        åå‰ï¼š$name\r\n                        èª­ã¿ï¼š$yomi\r\n                        é€šç§°åï¼š$tuusyoumei\r\n                        çµ±ä¸€æ°åï¼š$touitusimei\r\n                        ä½æ‰€ï¼š$location\r\n                        ç”Ÿå¹´æœˆæ—¥ï¼š$birthday\r\n                        äº¤ä»˜å¹´æœˆæ—¥ï¼š$registeredAt\r\n                        æœ‰åŠ¹æœŸé™ï¼š$endTimeAt\r\n                        ç…§ä¼šç•ªå·ï¼š$syoukaiNum\r\n                        è‰²åŒºåˆ†ï¼š$color\r\n                        é‹è»¢å…è¨±ã®æ¡ä»¶ï¼‘ï¼š$requirement1\r\n                        é‹è»¢å…è¨±ã®æ¡ä»¶ï¼’ï¼š$requirement2\r\n                        é‹è»¢å…è¨±ã®æ¡ä»¶ï¼“ï¼š$requirement3\r\n                        é‹è»¢å…è¨±ã®æ¡ä»¶ï¼”ï¼š$requirement4\r\n                        å…¬å®‰å§”å“¡ä¼šåï¼š$publicSafetyCommissionName\r\n                        é‹è»¢å…è¨±è¨¼ã®ç•ªå·ï¼š$cardNumber\r\n                        å…è¨±ã®å¹´æœˆæ—¥(äºŒãƒ»å°ãƒ»åŸ)ï¼š${nirin ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(ä»–)ï¼š${hoka ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(äºŒç¨®)ï¼š${nisyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(å¤§å‹)ï¼š${oogata ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(æ™®é€š)ï¼š${hutuu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(å¤§ç‰¹)ï¼š${oogatatokusyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(å¤§è‡ªäºŒ)ï¼š${oogatazidounirin ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(æ™®è‡ªäºŒ)ï¼š${hutuuzidounirin ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(å°ç‰¹)ï¼š${kogatatokusyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(åŸä»˜)ï¼š${gentuki ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(ã‘å¼•)ï¼š${kanninn ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(å¤§äºŒ)ï¼š${oogatanisyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(æ™®äºŒ)ï¼š${hutuunisyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(å¤§ç‰¹äºŒ)ï¼š${oogataokusyunisyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(ã‘å¼•äºŒ)ï¼š${kenninnnisyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(ä¸­å‹)ï¼š${tyuugata ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(ä¸­äºŒ)ï¼š${tyuugatanisyu ?: \"æœªå–å¾—\"}\r\n                        å…è¨±ã®å¹´æœˆæ—¥(æº–ä¸­å‹)ï¼š${zyuntyuugata ?: \"æœªå–å¾—\"}\r\n                    \"\"\".trimIndent()\r\n                    textView.append(dfEf01FormattedText)\r\n                    println(dfEf01FormattedText)\r\n\r\n                }\r\n\r\n\r\n                isoDep.close()\r\n\r\n            },\r\n            NfcAdapter.FLAG_READER_NFC_B,\r\n            null\r\n        )\r\n    }\r\n\r\n    override fun onPause() {\r\n        super.onPause()\r\n        nfcAdapter.disableReaderMode(this)\r\n    }\r\n\r\n    /** 16é€²æ•°ã«å¤‰æ›ã™ã‚‹ã‚„ã¤ */\r\n    private fun ByteArray.toHexString() = this.joinToString { \"%02x\".format(it) }\r\n\r\n    /**\r\n     * æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹\r\n     * @param currentPos ä»Šã®ä½ç½®ã€‚åˆå›æ™‚ã¯0ï¼Ÿ\r\n     * @return Intã¯ã€ä»Šã®ä½ç½®ã‚’è¿”ã—ã¾ã™ã€‚ï¼’å›ç›®ä»¥é™ã“ã®é–¢æ•°ã‚’å‘¼ã¶éš›ã«ä½¿ã£ã¦ãã ã•ã„ã€ByteArrayã¯å€¤ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã™\r\n     * */\r\n    private fun ByteArray.getValueField(currentPos: Int): Pair<Int, ByteArray> {\r\n        // é•·ã•ã‚’èª­ã¿å–ã‚‹\r\n        val length = this[currentPos + 1]\r\n        return currentPos + 2 + length to copyOfRange(currentPos + 2, currentPos + 2 + length)\r\n    }\r\n\r\n    /** JIS X 0208ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’æˆ»ã™ */\r\n    private fun ByteArray.toJISX0208(): String {\r\n        // å¤‰æ›ã™ã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã§å¤‰æ›ã§ãã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã‚ˆã‚Šã€æ–‡å­—é›†åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹\r\n        val escapeSequence = byteArrayOf(0x1B.toByte(), 0x24.toByte(), 0x42.toByte()) // JIS X 0208\r\n        return String(escapeSequence + this, charset(\"jis\"))\r\n    }\r\n\r\n    /** JIS X 0201ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’æˆ»ã™ */\r\n    private fun ByteArray.toJISX0201(): String {\r\n        // å¤‰æ›ã™ã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã§å¤‰æ›ã§ãã‚‹ã€‚JISã‚³ãƒ¼ãƒ‰ã¯ã‚¨ã‚¹ã‚±ãƒ¼ãƒ—ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã«ã‚ˆã‚Šã€æ–‡å­—é›†åˆã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒã§ãã‚‹\r\n        val escapeSequence = byteArrayOf(0x1B.toByte(), 0x28.toByte(), 0x42.toByte()) // ASCII\r\n        return String(escapeSequence + this, charset(\"jis\"))\r\n    }\r\n\r\n    /**\r\n     * JIS X 0201ã§å¤‰æ›ã•ã‚ŒãŸãƒã‚¤ãƒˆé…åˆ—ã‚’æˆ»ã—ã¦ã€æ—¥ä»˜å½¢å¼ã«ã™ã‚‹\r\n     * @return nullã®å ´åˆã¯ä¸æ­£ãªå€¤ã®å ´åˆï¼ˆä¾‹ãˆã°æ™®é€šå…è¨±ä»¥å¤–æŒã£ã¦ã„ãªã„å ´åˆã¯00000ãªã®ã§ãã®ã¨ãã¯nullã‚’è¿”ã—ã¾ã™ã€‚ï¼‰\r\n     * */\r\n    private fun ByteArray.toJISX0201DateString(): String? {\r\n        // ã¨ã‚Šã‚ãˆãšJIS X 0201ã®å¤‰æ›å¾Œãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—\r\n        val valueField = this.toJISX0201()\r\n        // æŒã£ã¦ãªã„å…è¨±ã®å ´åˆã¯ (å…ƒå·)000000 ãªã®ã§\r\n        if (valueField.contains(\"000000\")) return null\r\n        val gengo = when (valueField.first()) {\r\n            '1' -> \"æ˜æ²»\"\r\n            '2' -> \"å¤§æ­£\"\r\n            '3' -> \"æ˜­å’Œ\"\r\n            '4' -> \"å¹³æˆ\"\r\n            else -> \"ä»¤å’Œ\"\r\n        }\r\n        val year = valueField.substring(1, 3)\r\n        val month = valueField.substring(3, 5)\r\n        val date = valueField.substring(5, 7)\r\n        return \"$gengo ${year}å¹´ ${month}æœˆ ${date}æ—¥\"\r\n    }\r\n\r\n    /** æ•°å€¤æ–‡å­—ã‚’JIS X 0201ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ */\r\n    private fun toJIS(c: Char): Byte {\r\n        return when (c) {\r\n            '0' -> 0x30\r\n            '1' -> 0x31\r\n            '2' -> 0x32\r\n            '3' -> 0x33\r\n            '4' -> 0x34\r\n            '5' -> 0x35\r\n            '6' -> 0x36\r\n            '7' -> 0x37\r\n            '8' -> 0x38\r\n            '9' -> 0x39\r\n            else -> 0x00\r\n        }.toByte()\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ç•ªå¤–ç·¨ æœ¬ç±ã‚’èª­ã¿å‡ºã™\r\næœ¬ç±ã‚’èª­ã¿å‡ºã™ã«ã¯ã€æš—è¨¼ç•ªå·2ã®ç…§åˆã‚’é€šéã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n// MFã‚’é¸æŠã™ã‚‹\r\nval pin2MfSelectCommandResult = isoDep.transceive(mfSelectCommand)\r\n\r\n// IEF02(æš—è¨¼ç•ªå·ï¼’)ã‚’æŒ‡å®šã—ãŸVERIFYã‚³ãƒãƒ³ãƒ‰ã‚’é€ã‚‹\r\nval pinCode2CharList = \"0000\".toCharArray() // å„è‡ªæš—è¨¼ç•ªå·ã‚’å…¥åŠ›\r\nval pinCode2EncodedList = pinCode2CharList.map { toJIS(it.toString()[0]) }\r\nval pinCode2VerifyCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0x20.toByte(),\r\n    0x00.toByte(),\r\n    0x82.toByte(), // IEF02é¸æŠ\r\n    0x04.toByte(),\r\n) + pinCode2EncodedList\r\nval pinCode2VerifyCommandResult = isoDep.transceive(pinCode2VerifyCommand)\r\n\r\n// æœ¬ç±ã‚’èª­ã¿å‡ºã™ãŸã‚ã«DF1ã¸ç§»å‹•\r\nval pin2Df1SelectCommandResult = isoDep.transceive(df1SelectCommand)\r\n\r\n// æœ¬ç±ï¼ˆDF1/EF02ï¼‰ã‚’èª­ã¿å‡ºã™\r\nval df1Ef02ReadBinaryCommand = byteArrayOf(\r\n    0x00.toByte(),\r\n    0xB0.toByte(),\r\n    0x82.toByte(),\r\n    0x00.toByte(),\r\n    0x00.toByte(),\r\n    0x03.toByte(),\r\n    0x70.toByte(),\r\n)\r\nval df1Ef02ReadBinaryCommandResult = isoDep.transceive(df1Ef02ReadBinaryCommand)\r\nif (df1Ef02ReadBinaryCommandResult[df1Ef02ReadBinaryCommandResult.size - 2] == 0x90.toByte()) {\r\n    val honsekiLength = df1Ef02ReadBinaryCommandResult[1]\r\n    val honsekiData = df1Ef02ReadBinaryCommandResult.copyOfRange(2, 2 + honsekiLength)\r\n    honseki = honsekiData.toJISX0208()\r\n}\r\n```\r\n\r\n# é¢å€’ãªã®ã§\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªæ›¸ãã¾ã—ãŸã€‚å¤šåˆ†ç°¡å˜ã«ä½¿ãˆã¾ã™ã€‚\r\n\r\nhttps://github.com/takusan23/JDCardReaderCore\r\n\r\nä½¿ã„æ–¹ã¯README https://github.com/takusan23/JDCardReaderCore/blob/master/README.md èª­ã‚“ã§ãã ã•ã„ã€‚\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™\r\n\r\nhttps://qiita.com/treastrain/items/f95ee3f99c6b6111e999  \r\nhttps://qiita.com/ikazayim/items/2e9b8bdca96db6bf34cb  \r\nhttps://www.npa.go.jp/laws/notification/koutuu/menkyo/menkyo20210630_150.pdf\r\n\r\n# çµ‚ã‚ã‚Šã«\r\né¸æŠä¸å¯ã®PDFã‚‚Firefoxãªã‚‰é¸æŠå‡ºæ¥ã¾ã™ã€‚\r\n\r\n8æœˆä¸€ç¬ã§çµ‚ã‚ã£ãŸæ°—ãŒã™ã‚‹ã‚“ã ã‘ã©ãªã«ï¼Ÿ"},{"title":"Androidã®NonNullã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯nullã‚’è¿”ã™å ´åˆãŒã‚ã‚Šã€Kotlinã§å•é¡Œã«ãªã‚‹è©±","link":"/posts/android_nonnull_annotation_kotlin/","markdown":"\r\n# Android ã€Œã“ã®å€¤ã¯ @NonNull ã‚„ã§ã€â†’ Kotlin ã€Œã»ãªå³å¯†ãªnullãƒã‚§ãƒƒã‚¯ã™ã‚‹ã§ã€â†’ Android ã€Œå®Ÿè¡Œæ™‚ã«ã‚„ã£ã± null è¿”ã™ã‚ï¼ã€â†’ NullPointerException\r\nã†ãã¤ããª\r\n\r\n# æœ¬é¡Œ\r\n`Android`ã®`@NonNull`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã¯ãŸã¾ã«ã‚ˆã`null`ã‚’æ¸¡ã™ã€‚ã“ã‚ŒãŒ`Java`ãªã‚‰å•é¡Œãªã‹ã£ãŸã‘ã©ã€`Kotlin`ã ã¨ä¾‹å¤–ã§è½ã¡ã¦ã—ã¾ã†ã£ã¦è©±ã€‚\r\n\r\n## ãŠã“ã¨ã‚ã‚Š\r\næœ¬è¨˜äº‹ã§è¨€ã†`@NonNull`ã¯`android.annotation`ã€`androidx.annotation`ã®ã“ã¨ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/jbCinCs.png)\r\n\r\n# ä¿®æ­£ã™ã‚‹\r\nå¤šåˆ†2ãƒ‘ã‚¿ãƒ¼ãƒ³å­˜åœ¨ã—ã¾ã™ã€‚\r\n\r\n## Javaãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã€@NonNullãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç¶™æ‰¿ã—ã€@NonNullã‚’å…¨éƒ¨@Nullableã«ã™ã‚‹\r\n`.java`ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€ãªã‚“ã‹è² ã‘ãŸæ°—åˆ†ã«ãªã‚Šã¾ã™ï¼ˆãŒã€`Android`ãŒ`@NonNull`å®ˆã‚‰ãªã„ã®ãŒæ‚ªã„ã®ã§ä»•æ–¹ãªã„ã€ã€ã€ï¼‰\r\n\r\nä¾‹ãˆã°ã€ã“ã‚“ãªæ„Ÿã˜ã«Javaã§æ›¸ã‹ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã«`@NonNull`ãŒã¤ã„ã¦ã„ã‚‹å ´åˆ  \r\nï¼ˆä»¥ä¸‹ã¯`Android`ã®`OnGestureListener`ã§ã™ï¼‰  \r\n```java\r\npublic interface OnGestureListener {\r\n    boolean onDown(@NonNull MotionEvent e);\r\n\r\n    void onShowPress(@NonNull MotionEvent e);\r\n\r\n    boolean onSingleTapUp(@NonNull MotionEvent e);\r\n\r\n    boolean onScroll(@NonNull MotionEvent e1, @NonNull MotionEvent e2, float distanceX, float distanceY);\r\n\r\n    void onLongPress(@NonNull MotionEvent e);\r\n\r\n    boolean onFling(@NonNull MotionEvent e1, @NonNull MotionEvent e2, float velocityX, float velocityY);\r\n}\r\n```\r\n\r\nè‡ªå‰ã§ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ç¶™æ‰¿ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½œæˆã—ã€`@NonNull`ã‚’`@Nullable`ã«ç½®ãæ›ãˆã¾ã™ã€‚  \r\nã“ã®ã¨ã**Java**ã§ä½œæˆã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```java\r\nimport android.view.GestureDetector;\r\nimport android.view.MotionEvent;\r\n\r\nimport androidx.annotation.Nullable;\r\n\r\n/** OnGestureListener ã‚’ Nullable ã«ã—ãŸã‚‚ã® */\r\npublic interface NullableOnGestureListener extends GestureDetector.OnGestureListener {\r\n\r\n    @Override\r\n    boolean onDown(@Nullable MotionEvent e);\r\n\r\n    @Override\r\n    void onShowPress(@Nullable MotionEvent e);\r\n\r\n    @Override\r\n    boolean onSingleTapUp(@Nullable MotionEvent e);\r\n\r\n    @Override\r\n    boolean onScroll(@Nullable MotionEvent e1, @Nullable MotionEvent e2, float distanceX, float distanceY);\r\n\r\n    @Override\r\n    void onLongPress(@Nullable MotionEvent e);\r\n\r\n    @Override\r\n    boolean onFling(@Nullable MotionEvent e1, @Nullable MotionEvent e2, float velocityX, float velocityY);\r\n}\r\n```\r\n\r\nã“ã‚Œã§ã€`Kotlin`ã§ã‚‚`Nullable`ã¨ã—ã¦æ‰±ã£ã¦ãã‚Œã‚‹ã®ã§ã€`null`ãŒå…¥ã£ã¦ããŸå ´åˆã§ã‚‚è½ã¡ãªããªã‚Šã¾ã™ã€‚  \r\n`MotionEvent`ãŒå…¨éƒ¨`Nullable`ã«ãªã‚Šã¾ã—ãŸã€‚ã‚„ã£ãŸã­\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity(), NullableOnGestureListener {\r\n\r\n    override fun onDown(e: MotionEvent?): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    override fun onShowPress(e: MotionEvent?) {\r\n        // TODO\r\n    }\r\n\r\n    override fun onSingleTapUp(e: MotionEvent?): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    override fun onScroll(e1: MotionEvent?, e2: MotionEvent?, distanceX: Float, distanceY: Float): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    override fun onLongPress(e: MotionEvent?) {\r\n        // TODO\r\n    }\r\n\r\n    override fun onFling(e1: MotionEvent?, e2: MotionEvent?, velocityX: Float, velocityY: Float): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    // çœç•¥...\r\n}\r\n```\r\n\r\n## ã‚‚ã†ä¸€ã¤\r\nã“ã‚Œã¯ã‚„ã£ã¦ã„ã„ã®ã‹ã‚ã‹ã‚‰ãªã„ã®ã§ã™ãŒã€ã©ã†ã—ã¦ã‚‚`Kotlin`ã§å®Œçµã•ã›ãŸã„å ´åˆã¯ä½¿ãˆã¾ã™ã€‚  \r\n`Suppress`ã§é»™ã‚‰ã›ã‚‹ã‚„ã¤ã§ã™ã­ã€‚å¼•æ•°ãŒ`NonNull`ã‹ã‚‰`Nullable`ã«ãªã‚‹ã ã‘ï¼ˆå¼•æ•°ãŒå¢—ãˆã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªã„ï¼‰ãªã®ã§ã€ãŠãã‚‰ãå®Ÿè¡Œæ™‚ã«è½ã¡ã‚‹ã“ã¨ã¯ãªã„ã¨æ€ã„ã¾ã™ãŒã€ã€ã€\r\n\r\n```kotlin\r\n@Suppress(\"NOTHING_TO_OVERRIDE\", \"ACCIDENTAL_OVERRIDE\", \"ABSTRACT_MEMBER_NOT_IMPLEMENTED\")\r\nclass MainActivity : ComponentActivity(), GestureDetector.OnGestureListener {\r\n\r\n    override fun onDown(e: MotionEvent?): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    override fun onShowPress(e: MotionEvent?) {\r\n        // TODO\r\n    }\r\n\r\n    override fun onSingleTapUp(e: MotionEvent?): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    override fun onScroll(e1: MotionEvent?, e2: MotionEvent?, distanceX: Float, distanceY: Float): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    override fun onLongPress(e: MotionEvent?) {\r\n        // TODO\r\n    }\r\n\r\n    override fun onFling(e1: MotionEvent?, e2: MotionEvent?, velocityX: Float, velocityY: Float): Boolean {\r\n        // TODO\r\n    }\r\n\r\n    // çœç•¥....\r\n}\r\n```\r\n\r\n# äº‹ã®ç™ºç«¯\r\n\r\n```plaintext\r\njava.lang.NullPointerException: Parameter specified as non-null is null: method kotlin.jvm.internal.Intrinsics.checkNotNullParameter, parameter cellInfo\r\n\tat io.github.takusan23.newradiosupporter.tool.NetworkCallbackTool$listenNetworkStatus$1$callback$1.onCellInfoChanged(Unknown Source:2)\r\n\tat android.telephony.TelephonyCallback$IPhoneStateListenerStub.lambda$onCellInfoChanged$18(TelephonyCallback.java:1504)\r\n\tat android.telephony.TelephonyCallback$IPhoneStateListenerStub$$ExternalSyntheticLambda41.run(Unknown Source:4)\r\n\tat android.os.Handler.handleCallback(Handler.java:938)\r\n\tat android.os.Handler.dispatchMessage(Handler.java:99)\r\n\tat android.os.Looper.loopOnce(Looper.java:346)\r\n\tat android.os.Looper.loop(Looper.java:475)\r\n\tat android.app.ActivityThread.main(ActivityThread.java:7889)\r\n\tat java.lang.reflect.Method.invoke(Native Method)\r\n\tat com.android.internal.os.RuntimeInit$MethodAndArgsCaller.run(RuntimeInit.java:548)\r\n\tat com.android.internal.os.ZygoteInit.main(ZygoteInit.java:1009)\r\n```\r\n\r\n`onCellInfoChanged`ã§`NullPointerException`ã«ãªã£ã¦ã—ã¾ã†ã€‚  \r\nåŸå› ã¯`onCellInfoChanged`ã‚’`Android`ãŒå‘¼ã³å‡ºã™éš›ã«`cellInfo`ã‚’`null`ã§æ¸¡ã—ã¦ã„ã‚‹ãŸã‚ã€ã€ã€\r\n\r\n```java\r\n/**\r\n * Interface for cell info listener.\r\n */\r\npublic interface CellInfoListener {\r\n    /**\r\n     * Callback invoked when a observed cell info has changed or new cells have been added\r\n     * or removed on the registered subscription.\r\n     * Note, the registration subscription ID s from {@link TelephonyManager} object\r\n     * which registers TelephonyCallback by\r\n     * {@link TelephonyManager#registerTelephonyCallback(Executor, TelephonyCallback)}.\r\n     * If this TelephonyManager object was created with\r\n     * {@link TelephonyManager#createForSubscriptionId(int)}, then the callback applies to the\r\n     * subscription ID. Otherwise, this callback applies to\r\n     * {@link SubscriptionManager#getDefaultSubscriptionId()}.\r\n     *\r\n     * @param cellInfo is the list of currently visible cells.\r\n     */\r\n    @RequiresPermission(allOf = {\r\n            Manifest.permission.READ_PHONE_STATE,\r\n            Manifest.permission.ACCESS_FINE_LOCATION\r\n    })\r\n    void onCellInfoChanged(@NonNull List<CellInfo> cellInfo);\r\n}\r\n```\r\n\r\n## Androidã®@NonNullã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³\r\nã“ã‚Œå˜ç´”ã«**ãƒ“ãƒ«ãƒ‰æ™‚**ã«`null`ã®å¯èƒ½æ€§ãŒã‚ã‚‹ã¨ãã«è­¦å‘Šã‚’å‡ºã™ã‚‚ã®ãªã®ã§ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã¨ã‹ã¯æ„è­˜ã™ã‚‹ã¨ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ãŒã€ãã‚Œä»¥å¤–ãªã‚‰ã¶ã£ã¡ã‚ƒã‘ç„¡ãã¦ã‚‚ã¾ã‚ã€ã€ã€\r\n\r\n```java\r\npublic class NonNullCheck {\r\n\r\n    NonNullCheck() {\r\n        methodA(\"ã¯ã„\");\r\n        // è­¦å‘ŠãŒå‡ºã‚‹ã ã‘ã§ãƒ“ãƒ«ãƒ‰ã¯é€šã£ã¦ã—ã¾ã†\r\n        methodA(null);\r\n    }\r\n\r\n    private void methodA(@NonNull String argA) {\r\n        // NonNull ã§ã‚‚ null å…¥ã‚‹ã¨ãã¯å…¥ã‚‹ã®ã§\r\n        if (argA == null) {\r\n            return;\r\n        }\r\n        System.out.println(argA);\r\n    }\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/wPkCSwj.png)\r\n\r\n## ä¸€æ–¹ Kotlin ã® NonNull\r\n`Kotlin`ã¯`Null`ã‚’å³æ ¼ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ãŸã‚ã€`?`ãŒã¤ã„ã¦ã„ãªã„å¼•æ•°ã¯ãƒ“ãƒ«ãƒ‰ã‚‚é€šã‚‰ãªã„ã—ã€å®Ÿè¡Œæ™‚ã‚‚è½ã¡ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚  \r\n\r\n```kotlin\r\nclass NonNullCheckKt {\r\n\r\n    init {\r\n        methodA(\"ã¯ã„\")\r\n        // ãƒ“ãƒ«ãƒ‰ã¯é€šã‚‰ãªã„\r\n        methodA(null)\r\n    }\r\n\r\n    fun methodA(argA: String) {\r\n        // argA ã¯ null ã«ã¯ãªã‚‰ãªã„\r\n    }\r\n\r\n}\r\n```\r\n\r\nã¾ãŸå®Ÿè¡Œæ™‚ã«ã‚‚`NonNull`ã¯æ©Ÿèƒ½ã—ã€é–¢æ•°å†…ã«å¼•æ•°ãŒ`null`ã§ã¯ãªã„ã“ã¨ã‚’ç¢ºèªã™ã‚‹å‡¦ç†ãŒè‡ªå‹•ã§æŒ¿å…¥ã•ã‚Œã¦ã„ã¾ã™ã€‚  \r\nï¼ˆå…¨ç„¶Androidã¨ã¯é–¢ä¿‚ãªã„`Kotlin`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã ã‘ã©å¤‰ã‚ã‚‰ãªã„ã¯ãšï¼‰\r\n\r\n```kotlin\r\n/**\r\n * ãƒ‰ãƒ­ãƒƒãƒ—æ•°ã‚’è¿”ã™ã€‚å¤±æ•—ã—ãŸã‚‰1\r\n *\r\n * @param itemStack ã‚¢ã‚¤ãƒ†ãƒ \r\n * */\r\nprivate fun getDropSize(itemStack: ItemStack): Int {\r\n    return itemStack.name.string.toIntOrNull() ?: 1\r\n}\r\n```\r\n\r\né€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã¨`nullãƒã‚§ãƒƒã‚¯`ã™ã‚‹é–¢æ•°ãŒæŒ¿å…¥ã•ã‚Œã¦ã„ã‚‹\r\n```java\r\nprivate final int getDropSize(class_1799 itemStack) {\r\n  Intrinsics.checkNotNullExpressionValue(itemStack.method_7964().getString(), \"itemStack.name.string\");\r\n  StringsKt.toIntOrNull(itemStack.method_7964().getString());\r\n  return (StringsKt.toIntOrNull(itemStack.method_7964().getString()) != null) ? StringsKt.toIntOrNull(itemStack.method_7964().getString()).intValue() : 1;\r\n}\r\n```\r\n\r\n## Javaã§æ›¸ã„ãŸ@NonNullã¯Kotlinã ã¨ï¼Ÿ\r\nã•ã¦ã€`@NonNull`ã§ã‚‚å®Ÿè¡Œæ™‚ã¯`null`ã‚’æ¸¡ã™å¯èƒ½æ€§ãŒã‚ã‚‹è©±ã‚’ã—ã¾ã—ãŸãŒã€ã€ã€ã„ã‹ãŒã€‚  \r\n\r\nã¾ãäºˆæƒ³é€šã‚Š`Kotlin`ã§ã‚‚ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å°Šé‡ã—ã¦`NonNull`ã¨ã—ã¦æ‰±ã‚ã‚Œã¾ã™ã€‚  \r\nhttps://kotlinlang.org/docs/java-interop.html#nullability-annotations\r\n\r\nä»Šå›ã€`@NonNull`ãŒ`Java`ã®å ´åˆã«è½ã¡ãªã„ã‘ã©ã€`Kotlin`ã®å ´åˆã«ã„ããªã‚Šè½ã¡ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã¯ã“ã®å½±éŸ¿ã§ã™ã€‚\r\n\r\n\r\n```java\r\npublic interface NonNullInterface {\r\n    void onCallback(@NonNull String string);\r\n}\r\n```\r\n\r\n```kotlin\r\nclass NonNullCheckKt : NonNullInterface {\r\n    override fun onCallback(string: String) {\r\n\r\n    }\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\n\r\n# ãŠã‚ã‚Šã«\r\n`targetSdk = 33`ã‹ã‚‰ã€`MotionEvent`ãŒ`NonNull`ã«ãªã£ãŸå½±éŸ¿ã§ã‚ã‚Šã¨`Issue`ãŒã¡ã‚‰ã»ã‚‰ï¼ˆå…¨ç„¶è‰¯ããªã„ï¼›ï¼›ï¼‰\r\n\r\n- https://issuetracker.google.com/issues/243267018\r\n    - NonNull ç„¡è¦–ã—ã¦ null å…¥ã‚Œã¦ã‚‹\r\n- https://youtrack.jetbrains.com/issue/KT-53963\r\n    - å¼·åˆ¶çš„ã«Nullableã™ã‚‹æ©Ÿèƒ½ã«ã¤ã„ã¦Kotlinå´ã¯æ‹’å¦ã—ãŸæ¨¡æ§˜ï¼ˆã ã£ã¦AndroidãŒ100æ‚ªã„ã‚‚ã‚“ã­ï¼‰\r\n\r\nã¡ãªã¿ã«ç§ãŒå¼•ã£ã‹ã‹ã£ãŸ`onCellInfoChanged`ã«é–¢ã—ã¦ã‚‚`null`ã‚’è¿”ã•ãªã„ã‚ˆã†ä¿®æ­£ã•ã‚ŒãŸãã†ã§ã™ãŒã€å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã¯æ®‹ã‚Šç¶šã‘ã‚‹ã§ã—ã‚‡ã†ã­ã€ã€ã€  \r\nhttps://issuetracker.google.com/issues/237308373"},{"title":"Androidã§æ¥½å¤©å›ç·šã‚’åˆ¤æ–­ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’æ›¸ã","link":"/posts/android_rakuten_kaisen/","markdown":"ã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚\r\n\r\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">æ¥½å¤©ã®è‡ªç¤¾å›ç·šæ‹¾ãˆãš <a href=\"https://t.co/74fWoB3ENK\">pic.twitter.com/74fWoB3ENK</a></p>&mdash; ãŸãã•ã‚“ (@takusan__23) <a href=\"https://twitter.com/takusan__23/status/1378719149954752514?ref_src=twsrc%5Etfw\">April 4, 2021</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\r\n\r\nå®¶ã§ã¯Band 26ã—ã‹æ´ã¿ã¾ã›ã‚“ã€‚  \r\nã‚¨ãƒªã‚¢ãƒãƒƒãƒ—ã§ã¯å¯¾å¿œã—ã¦ã‚‹ã£ã½ã„ã®ã§ã€æã‚‰ãauå›ç·šã®ã»ã†ãŒå®‰å®šã—ã¦ã‚‹ã‹ã‚‰auã®æ–¹ã«ç¹‹ãŒã£ã¡ã‚ƒã†ã¨ã‹ãã†ã„ã†äº‹ãªã®ã‹ãªã€‚\r\n\r\n# æœ¬é¡Œ\r\næ¥½å¤©å›ç·šã‹åˆ¤æ–­ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ                    | ã‚ãŸã„                                                               |\r\n|---------------------------|----------------------------------------------------------------------|\r\n| Android                   | 11                                                                   |\r\n| ç«¯æœ«                      | Sony Xperia 5 mk 2 ï¼ˆå¿µé¡˜ã®é«˜ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãƒ¬ãƒ¼ãƒˆ + SDã‚«ãƒ¼ãƒ‰å¯¾å¿œç«¯æœ«ï¼‰ |\r\n| è¨€èª                      | Kotlin                                                               |\r\n| æœ€ä½Android SDKãƒãƒ¼ã‚¸ãƒ§ãƒ³ | 28 (Android 9 ä»¥é™)                                                |\r\n\r\n# ä½œã‚Šæ–¹\r\n\r\n## app/build.gradle\r\n\r\nViewBindingã‚’æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```\r\nandroid {\r\n    compileSdkVersion 30\r\n    buildToolsVersion \"30.0.3\"\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.whereisrakutenarea\"\r\n        minSdkVersion 28\r\n        targetSdkVersion 30\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    // ã“ã‚Œ\r\n    buildFeatures {\r\n        viewBinding true\r\n    }\r\n}\r\n```\r\n\r\nã‚ã¨ã€`Activity Result API`ã‚’ä½¿ã„ãŸã„ã®ã§ä»¥ä¸‹ã®ã‚ˆã†ã«\r\n\r\n```\r\ndependencies {\r\n\r\n    // Activity Result API\r\n    implementation 'androidx.activity:activity-ktx:1.3.0-alpha06'\r\n    implementation 'androidx.fragment:fragment-ktx:1.3.2'\r\n\r\n    // ä»¥ä¸‹çœç•¥\r\n}\r\n```\r\n\r\n## activity_main.xml\r\nã¾ã‚TextViewã¨å–å¾—ç”¨Buttonã‚’ç½®ã„ã¦ãŠãã¾ã—ã‚‡ã†\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <TextView\r\n        android:id=\"@+id/textView\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦å›ç·šç¢ºèª\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintLeft_toLeftOf=\"parent\"\r\n        app:layout_constraintRight_toRightOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/button\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginTop=\"16dp\"\r\n        android:text=\"å›ç·šç¢ºèª\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/textView\" />\r\n\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n## MainActivity.kt\r\n### æ¨©é™ã®ç¢ºèª\r\n\r\n`Activity Result API`ãŒä¾¿åˆ©ã™ãã‚‹ã€‚æ¨©é™ã‚’ä½¿ã„ãŸã„ã®ã§ä»˜ä¸ã‚’ãŠé¡˜ã„ã—ã¾ã™çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‡ºã—ãŸã»ã†ãŒè¦ªåˆ‡ã ã¨æ€ã†ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\r\n        if (isGranted) {\r\n            // æ¨©é™ç¢ºä¿\r\n            checkRakutenNetwork()\r\n        }\r\n    }\r\n\r\n    /** ViewBinding */\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        start()\r\n\r\n        // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã\r\n        viewBinding.button.setOnClickListener {\r\n            start()\r\n        }\r\n\r\n    }\r\n\r\n    /** æ¨©é™ãŒã‚ã‚Œã°å›ç·šãƒã‚§ãƒƒã‚¯ã‚’è¡Œã† */\r\n    private fun start() {\r\n        // æ¨©é™ã®ç¢ºèª\r\n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\r\n            // æ¨©é™ãŒã‚ã‚‹\r\n            checkRakutenNetwork()\r\n        } else {\r\n            // ç„¡ã„\r\n            Toast.makeText(this, \"æ¥ç¶šçŠ¶æ…‹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«æ¨©é™ãŒå¿…è¦ã§ã™ã®ã§ä»˜ä¸ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\", Toast.LENGTH_SHORT).show()\r\n            permissionCallBack.launch(Manifest.permission.ACCESS_FINE_LOCATION)\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## æ¥½å¤©å›ç·šã‹ç¢ºèªã™ã‚‹é–¢æ•°\r\n\r\né–¢æ•°å†…ã«é–¢æ•°ãŒã‚ã‚‹ã‘ã©æ°—ã«ã—ãªã„ã§\r\n\r\n```kotlin\r\n/** æ¥½å¤©ã®è‡ªç¤¾å›ç·šã«ç¹‹ãŒã£ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹é–¢æ•° */\r\nprivate fun checkRakutenNetwork() {\r\n    /** é–¢æ•°å†…ã«é–¢æ•°ã‚’æ›¸ãã€‚TextViewã«å›ç·šåã‚’å…¥ã‚Œã‚‹ */\r\n    fun setTextViewOperatorName(cellInfo: CellInfo) {\r\n        viewBinding.textView.text = when (cellInfo) {\r\n            // 3G\r\n            is CellInfoWcdma -> {\r\n                cellInfo.cellIdentity.operatorAlphaLong\r\n            }\r\n            // LTE\r\n            is CellInfoLte -> {\r\n                cellInfo.cellIdentity.earfcn\r\n                cellInfo.cellIdentity.operatorAlphaShort\r\n            }\r\n            // 5G (NR)\r\n            is CellInfoNr -> {\r\n                cellInfo.cellIdentity.operatorAlphaShort\r\n            }\r\n            else -> \"ä¸æ˜\"\r\n        }\r\n    }\r\n    val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\r\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {\r\n        if (ActivityCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\r\n            // Android 10ä»¥é™ã¯å‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„å›ã™ä»•æ§˜ã®ãŸã‚ã€æ–°ã—ãå–ã£ã¦ãã¦ã‚‚ã‚‰ã†ãŸã‚ã«åˆ†å²\r\n            telephonyManager.requestCellInfoUpdate(mainExecutor, object : TelephonyManager.CellInfoCallback() {\r\n                override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\r\n                    setTextViewOperatorName(cellInfo[0])\r\n                }\r\n            })\r\n        }\r\n    } else {\r\n        val cellInfoList = telephonyManager.allCellInfo\r\n        setTextViewOperatorName(cellInfoList[0])\r\n    }\r\n}\r\n```\r\n\r\n## å…¨ä½“\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** æ¨©é™ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val permissionCallBack = registerForActivityResult(ActivityResultContracts.RequestPermission()) { isGranted ->\r\n        if (isGranted) {\r\n            // æ¨©é™ç¢ºä¿\r\n            checkRakutenNetwork()\r\n        }\r\n    }\r\n\r\n    /** ViewBinding */\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        start()\r\n\r\n        // ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã\r\n        viewBinding.button.setOnClickListener {\r\n            start()\r\n        }\r\n\r\n    }\r\n\r\n    /** æ¨©é™ãŒã‚ã‚Œã°å›ç·šãƒã‚§ãƒƒã‚¯ã‚’è¡Œã† */\r\n    private fun start() {\r\n        // æ¨©é™ã®ç¢ºèª\r\n        if (ContextCompat.checkSelfPermission(this, Manifest.permission.ACCESS_FINE_LOCATION) == PackageManager.PERMISSION_GRANTED) {\r\n            // æ¨©é™ãŒã‚ã‚‹\r\n            checkRakutenNetwork()\r\n        } else {\r\n            // ç„¡ã„\r\n            Toast.makeText(this, \"æ¥ç¶šçŠ¶æ…‹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã«æ¨©é™ãŒå¿…è¦ã§ã™ã®ã§ä»˜ä¸ã‚’ãŠé¡˜ã„ã—ã¾ã™ã€‚\", Toast.LENGTH_SHORT).show()\r\n            permissionCallBack.launch(Manifest.permission.ACCESS_FINE_LOCATION)\r\n        }\r\n    }\r\n\r\n    /** æ¥½å¤©ã®è‡ªç¤¾å›ç·šã«ç¹‹ãŒã£ã¦ã„ã‚‹ã‹ç¢ºèªã™ã‚‹é–¢æ•° */\r\n    private fun checkRakutenNetwork() {\r\n\r\n        /** é–¢æ•°å†…ã«é–¢æ•°ã‚’æ›¸ãã€‚TextViewã«å›ç·šåã‚’å…¥ã‚Œã‚‹ */\r\n        fun setTextViewOperatorName(cellInfo: CellInfo) {\r\n            viewBinding.textView.text = when (cellInfo) {\r\n                // 3G\r\n                is CellInfoWcdma -> {\r\n                    cellInfo.cellIdentity.operatorAlphaLong\r\n                }\r\n                // LTE\r\n                is CellInfoLte -> {\r\n                    cellInfo.cellIdentity.operatorAlphaShort\r\n                }\r\n                // 5G (NR)\r\n                is CellInfoNr -> {\r\n                    cellInfo.cellIdentity.operatorAlphaShort\r\n                }\r\n                else -> \"ä¸æ˜\"\r\n            }\r\n        }\r\n\r\n        val telephonyManager = getSystemService(Context.TELEPHONY_SERVICE) as TelephonyManager\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) {\r\n            if (ActivityCompat.checkSelfPermission(\r\n                    this,\r\n                    Manifest.permission.ACCESS_FINE_LOCATION\r\n                ) == PackageManager.PERMISSION_GRANTED\r\n            ) {\r\n                // Android 10ä»¥é™ã¯å‰å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä½¿ã„å›ã™ä»•æ§˜ã®ãŸã‚ã€æ–°ã—ãå–ã£ã¦ãã¦ã‚‚ã‚‰ã†ãŸã‚ã«åˆ†å²\r\n                telephonyManager.requestCellInfoUpdate(\r\n                    mainExecutor,\r\n                    object : TelephonyManager.CellInfoCallback() {\r\n                        override fun onCellInfo(cellInfo: MutableList<CellInfo>) {\r\n                            setTextViewOperatorName(cellInfo[0])\r\n                        }\r\n                    })\r\n            }\r\n        } else {\r\n            val cellInfoList = telephonyManager.allCellInfo\r\n            setTextViewOperatorName(cellInfoList[0])\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nå®Ÿè¡Œã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜\r\n\r\n![Imgur](https://imgur.com/cE33GZT.png)\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™\r\n\r\nhttps://github.com/takusan23/WhereIsRakutenArea\r\n\r\n# ãŠã‚ã‚Šã«\r\næ–°ã—ã‚ã®Androidã§ã—ã‹ã“ã®æ–¹æ³•ãŒä½¿ãˆãªã„ã€‚  \r\nAndroid 7ä»¥é™ã¯`EARFCN`ã‚’å–å¾—ã™ã‚‹APIãŒä½¿ãˆã‚‹ã®ã§ã€  \r\n**EARFCNå–å¾—â†’ãƒãƒ³ãƒ‰/EARFCNã®è¡¨ã¨ç…§åˆâ†’æ¥ç¶šä¸­ãƒãƒ³ãƒ‰ã‚’å–å¾—â†’ãƒãƒ³ãƒ‰3ãªã‚‰æ¥½å¤©å›ç·šï¼**  \r\nã¿ãŸã„ãªæ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ï¼ˆãã®ã†ã¡æ›¸ããŸã„ï¼‰ã€‚\r\n\r\nä»¥ä¸Šã§ã™ã€‚ä»Šæ—¥ã¯å¤œå‹¤"},{"title":"Roomã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚ŠãŸã„","link":"/posts/android_room_backup/","markdown":"å®¶ã®å›ç·šèª¿å­ã‚ã‚‹ã„\r\n\r\n# æœ¬é¡Œ\r\nAndroidã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€Roomã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚ŠãŸã„  \r\nä»–ã®ã‚¹ãƒãƒ›ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ç§»ã—ãŸã„\r\n\r\n## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã€€ã©ã“ï¼Ÿ\r\n`data/data/${packageName}/databases`ã«ã‚ã‚‹ã€‚  \r\nãªãŠã“ã‚“ãªé¢å€’ãªã“ã¨ã—ãªãã¦ã‚‚ã€`Context#databaseList()`ã‚’ä½¿ã†ã¨ã“ã®ãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã£ã¦ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®åå‰ã‚’é…åˆ—ã§è¿”ã—ã¦ãã‚Œã‚‹ã—ã€  \r\nã“ã‚Œã‚’ä½¿ã£ã¦`Context#getDatabasePath()`ã‚’ä½¿ãˆã°ãƒ‘ã‚¹ãŒå–ã‚Œã‚‹ã€‚\r\n\r\nãªãŠã€`data/data`ã¯`root`æ¨©é™ãŒãªã„ã¨è¦‹ã‚Œãªã„ãŒã€é–‹ç™ºä¸­ã®ã‚¢ãƒ—ãƒªã¯Android Studioã®`Device File Explorer`ã‹ã‚‰è¦‹ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚\r\n\r\n## ã©ã‚ŒãŒãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼Ÿ\r\n`.db`ã¨`.db-shm`ã¨`.db-wal`ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚Œã°å¤šåˆ†è¦‹ã‚Œã‚‹ã€‚  \r\n`.db`ãƒ•ã‚¡ã‚¤ãƒ«ä¸€å€‹ã ã‘ã«ã—ãŸã„å ´åˆã¯ã€`Room.databaseBuilder`ã®ã¨ãã«`setJournalMode(RoomDatabase.JournalMode.TRUNCATE)`ã‚’å‘¼ã¹ã°ã‚‚ã—ã‹ã™ã‚‹ã¨`.db`ä¸€å€‹ã ã‘ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\n```kotlin\r\nnicoHistoryDB = Room.databaseBuilder(context, NicoHistoryDB::class.java, \"NicoHistory.db\")\r\n    .setJournalMode(RoomDatabase.JournalMode.TRUNCATE) // ã“ã‚Œ\r\n    .build()\r\n```\r\n\r\n# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—\r\nä»Šå›ã¯`Context#getExternalFileDir()`ã®å ´æ‰€ã«ä¿å­˜ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚  \r\nãªãŠ`Android 10`ã¾ã§ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§è¦‹ã‚‹ã“ã¨ãŒã§ãã¾ã™ãŒã€`Android 11`ã§ã¯ã‚µãƒ¼ãƒ‰ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§ã¯è¦‹ã‚Œã¾ã›ã‚“ã€‚  \r\nAndroidæ¨™æº–ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ï¼ˆ`com.google.android.documentui`ï¼‰ã‚’é–‹ã‘ã‚Œã°è¦‹ã‚Œã‚‹ã¨æ€ã„ã¾ã™ï¼ˆPixelä»¥å¤–ã¯ã—ã‚‰ã‚“ï¼‰\r\n\r\n```kotlin\r\n// ã‚¢ãƒ—ãƒªå›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«é€ƒãŒã™\r\ncontext.databaseList()\r\n    .map { name -> context.getDatabasePath(name) }\r\n    .forEach { dbFile ->\r\n        // ã‚¢ãƒ—ãƒªå›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆå¤–éƒ¨ï¼‰ã«ä¿å­˜ã™ã‚‹\r\n        File(context.getExternalFilesDir(null), dbFile.name).let { file ->\r\n            // ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ\r\n            file.createNewFile()\r\n            // ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿\r\n            file.writeBytes(dbFile.readBytes())\r\n        }\r\n    }\r\n```\r\n\r\n`sdcard/Android/data/ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å/files`ã«ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\nãªã‚“ã‹æ€ã£ãŸã‚ˆã‚Šãã‚Œã„ã«æ›¸ãã“ã¨ãŒã§ããŸ\r\n\r\n# ãƒªã‚¹ãƒˆã‚¢\r\nã‚³ãƒ”ãƒ¼ã®ã¨ãã¨åŒã˜ã‚ˆã†ã«ã€`Context#getExternalFilesDir()`ã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‡ãƒ¼ã‚¿ãŒæœ‰ã‚‹ã¨ã—ã¦ã€  \r\nãã„ã¤ã‚‰ã‚’`data/data/ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸å/databases`ã«ç§»ã›ã°ãŠï½‹\r\n\r\n```kotlin\r\n// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ‘ã‚¹ã€‚Context#getDataDir()ã¯Android 7ä»¥é™ã®ã¿ãªã®ã§Compatã‚’ä½¿ã†\r\nval dbFolder = File(ContextCompat.getDataDir(context), \"databases\")\r\n// ã‚¢ãƒ—ãƒªå›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ï¼ˆå¤–éƒ¨ï¼‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–ã‚Šå‡ºã™\r\ncontext.getExternalFilesDir(null)?.listFiles()?.forEach { dbFile ->\r\n    File(dbFolder, dbFile.name).let { file ->\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ\r\n        file.createNewFile()\r\n        // ãƒ‡ãƒ¼ã‚¿æ›¸ãè¾¼ã¿\r\n        file.writeBytes(dbFile.readBytes())\r\n    }\r\n}\r\n```\r\n\r\n# ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã§é¸ã°ã›ãŸã»ã†ãŒã„ã„ã‚ˆã­\r\n`Storage Access Framework`ã§ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã°ã›ã‚‹ï¼ˆä½œæˆã€å¾©å…ƒï¼‰ã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚    \r\nãŸã è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶æ©Ÿèƒ½ã¯`SAF`ã«ã¯(å¤šåˆ†)ç„¡ã„ã®ã§ã€ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`zip`ãƒ•ã‚¡ã‚¤ãƒ«ã«ã¾ã¨ã‚ã¦æ‰±ã†ã“ã¨ã«ãªã‚Šãã†ï¼ˆä»–ã«ã‚‚ã‚ã‚‹ã‹ã‚‚ï¼‰  \r\n\r\nã¨ã„ã†ã‚ã‘ã§ä¾‹ã§ã™ï¼š\r\n\r\n`Activity Result API`ã‚’ä½¿ã†ã®ã§ã€`app/build.gradle`ã«æ•°è¡Œè¶³ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    // Activity Result APIã§onActivityResultã‚’é§†é€ã™ã‚‹ã€‚\r\n    implementation 'androidx.activity:activity-ktx:1.3.0-alpha02'\r\n    implementation 'androidx.fragment:fragment-ktx:1.3.0'\r\n\r\n}\r\n```\r\n\r\n## ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹\r\n\r\n```kotlin\r\n/** ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã™ã‚‹ */\r\nclass BackupActivity : AppCompatActivity() {\r\n\r\n    /** Activity Result API ã‚’ä½¿ã†ã€‚[AppCompatActivity.onActivityResult]ã®å¾Œç¶™ */\r\n    private val callback = registerForActivityResult(ActivityResultContracts.CreateDocument()) { uri ->\r\n        if (uri != null) {\r\n            // ZIPä½œæˆã€‚\r\n            val outputStream = contentResolver.openOutputStream(uri)\r\n            ZipOutputStream(outputStream).let { zip ->\r\n                /**\r\n                 * ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ã™ã¹ã¦Zipã«å…¥ã‚Œã‚‹\r\n                 * */\r\n                databaseList()\r\n                    .map { name -> getDatabasePath(name) }\r\n                    // ã‚ˆãã‚ã‹ã‚‰ã‚“ãƒ•ã‚¡ã‚¤ãƒ«ã¯æŒã£ã¦ã“ãªã„ã€‚\r\n                    .filter { file -> !file.name.contains(\"com.google.android.datatransport\") }\r\n                    .forEach { file ->\r\n                        val inputStream = file.inputStream() // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿å‡ºã—\r\n                        val entry = ZipEntry(file.name) // ãƒ•ã‚¡ã‚¤ãƒ«å\r\n                        zip.putNextEntry(entry)\r\n                        zip.write(inputStream.readBytes()) // æ›¸ãè¾¼ã‚€ã€‚Kotlinã‹ã‚“ãŸã‚“ã™ãã„\r\n                        inputStream.close()\r\n                        zip.closeEntry()\r\n                    }\r\n                // ãŠã—ã¾ã„\r\n                zip.close()\r\n                // çµ‚äº†\r\n                Toast.makeText(this, \"ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã§ããŸ\", Toast.LENGTH_SHORT).show()\r\n            }\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_backup)\r\n\r\n        // Storage Access Frameworké–‹å§‹\r\n        callback.launch(\"backup.zip\")\r\n\r\n    }\r\n}\r\n```\r\n\r\n## ãƒªã‚¹ãƒˆã‚¢ã™ã‚‹\r\n\r\n```kotlin\r\n/** ãƒªã‚¹ãƒˆã‚¢ã™ã‚‹Activity */\r\nclass RestoreActivity : AppCompatActivity() {\r\n\r\n    /** Activity Result API ã‚’ä½¿ã†ã€‚[AppCompatActivity.onActivityResult]ã®å¾Œç¶™ */\r\n    private val callback = registerForActivityResult(ActivityResultContracts.OpenDocument()) { uri ->\r\n        if (uri != null) {\r\n            // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹ã€‚ContextCompatã§å¾Œæ–¹äº’æ›æ€§ã‚‚ã¯ã„ã°ã£ã¡ã‚Šï¼\r\n            val databaseFolder = File(ContextCompat.getDataDir(this), \"databases\")\r\n            // ä¸€å¿œå‰ã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™\r\n            databaseFolder.listFiles()?.forEach { file -> file.delete() }\r\n            // Zipå±•é–‹\r\n            val inputStream = contentResolver.openInputStream(uri)\r\n            ZipInputStream(inputStream).let { zip ->\r\n                var zipEntry: ZipEntry?\r\n                // Zipå†…ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãªããªã‚‹ã¾ã§ç¹°ã‚Šè¿”ã™\r\n                while (zip.nextEntry.also { zipEntry = it } != null) {\r\n                    if (zipEntry != null) {\r\n                        // ã‚³ãƒ”ãƒ¼å…ˆãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ\r\n                        val dbFile = File(databaseFolder, zipEntry!!.name)\r\n                        dbFile.createNewFile()\r\n                        // ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€\r\n                        dbFile.writeBytes(zip.readBytes())\r\n                    }\r\n                }\r\n            }\r\n            // ãŠã‚ã£ãŸ\r\n            Toast.makeText(this, \"ãƒªã‚¹ãƒˆã‚¢ãŠã‚ã£ãŸ\", Toast.LENGTH_SHORT).show()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_restore)\r\n\r\n        // Storage Access Framework\r\n        callback.launch(arrayOf(\"*/*\")) // application/zip å‹•ã‹ãªã„ã®ã‹ãª\r\n\r\n    }\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# ãŠã‚ã‚Šã«\r\n```\r\nCaused by: java.lang.IllegalArgumentException: Can only use lower 16 bits for requestCode\r\n```\r\n\r\nã“ã‚Œã¯ã€`app/build.gradle`ã«`implementation 'androidx.fragment:fragment-ktx:1.3.0'`ã‚’ä»˜ã‘è¶³ã™ã¨ç›´ã‚Šã¾ã™ï¼Ÿ  \r\n`Activity`ã—ã‹ä½¿ã‚ã‚“ã—ã£ã¦æ€ã£ãŸã‚“ã§ã™ã‘ã©ã ã‚ã£ã½ã„ã§ã™ã€‚"},{"title":"SQLiteã®æ€ã„å‡ºã‚’Roomã¸ãŠå¼•è¶Šã—ã™ã‚‹","link":"/posts/android_sqlite_to_room/","markdown":"\r\né€²è·¯ã©ãƒ¼ã™ã£ã‹ãª\r\n\r\n# æœ¬é¡Œ\r\næ—¢å­˜ã®Androidã‚¢ãƒ—ãƒªã«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’è¿½åŠ ã—ãŸã„ã‚ã‘ã§ã™ãŒã€ã“ã‚Œã‹ã‚‰ä½œã‚‹ãªã‚‰Roomã‚’ã‚„ã£ã±ä½¿ã„ãŸã„ã‚ã‘ã§ã™ã‚ˆã€‚  \r\nã§ã‚‚Roomã¨SQLiteï¼ˆæ—§å¼ï¼‰ãŒå…±å­˜ã—ã¦ã‚‹ã®ãªã‚“ã‹æ°—æŒã¡æ‚ªã„ã®ã§**ã‚ã£ã¡ã‚ƒé¢å€’ãã•ãã†ã ã‘ã©**Roomã¸ç§»è¡Œã—ã‚ˆã†ã¨ã„ã†ã‚ã‘ã§ã™ã€‚\r\n\r\n# ç’°å¢ƒ\r\n| ãªã¾ãˆ  | ã‚ãŸã„    |\r\n|---------|-----------|\r\n| Android | 11 Beta 2 |\r\n| è¨€èª    | Kotlin    |\r\n\r\n# ã‚„ã‚‹ã“ã¨\r\nSQLite -> Room\r\n\r\n# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹\r\n## build.gradleã‚’é–‹ã„ã¦\r\nä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã‚’è¶³ã—ã¾ã™ã€‚  \r\nãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸€ç•ªä¸Šã«`apply plugin: 'kotlin-kapt'`ã‚’æ›¸ã‹ãªã„ã¨ã‚¨ãƒ©ãƒ¼å‡ºã¾ã™ã€‚  \r\nã‚ã¨ã¤ã„ã§ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚‚å…¥ã‚Œã¾ã—ã‚‡ã†ã€‚ç„¡ãã¦ã‚‚`thread {}`ä½¿ã£ã¦åˆ¥ã‚¹ãƒ¬ãƒƒãƒ‰ã§æ‰±ãˆã°ä½¿ãˆã¾ã™ãŒã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„ã«ãªã‚‹ã®ã§ã‚„ã‚ã¨ã“ã†\r\n\r\n```gradle\r\napply plugin: 'kotlin-kapt' // ä¸€ç•ªä¸Šã«\r\n\r\ndependencies {\r\n\r\n    // Room\r\n    def room_version = \"2.2.5\"\r\n    implementation \"androidx.room:room-runtime:$room_version\"\r\n    implementation \"androidx.room:room-ktx:$room_version\"\r\n    kapt \"androidx.room:room-compiler:$room_version\"\r\n    \r\n    // Coroutines\r\n    implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-android:1.3.4\"\r\n    implementation \"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.3.4\"\r\n   \r\n    // çœç•¥...\r\n\r\n}\r\n```\r\n\r\n# ãªã‚“ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³\r\n\r\n**Roomã¯UIã‚¹ãƒ¬ãƒƒãƒ‰ã§ã¯ä½¿ãˆã¾ã›ã‚“ã€‚**  \r\nã ã‹ã‚‰ã‚³ãƒ«ãƒ¼ãƒãƒ³ãŒå¿…è¦ã ã£ãŸã®ã§ã™ã­ã€‚\r\n\r\n# Roomã®æ§‹æˆ\r\nRoomã•ã‚“ã¯3ã¤ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æˆã‚Šç«‹ã£ã¦ã¾ã™ã€‚\r\n\r\n- RoomDatabase\r\n    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸­å¿ƒçš„ãªå½¹å‰²\r\n    - èª¬æ˜ãŒã‚ã‚“ã©ã„ã—ä½•ã™ã‚‹ã®ã‹ã‚ˆãã‚ã‹ã£ã¦ã„ãªã„ã€‚\r\n    - DAOã«ã¯ã“ã„ã¤ãŒå¿…è¦\r\n- Entity\r\n    - ãƒ†ãƒ¼ãƒ–ãƒ«ã€‚Excelã ã¨ä¸€ç•ªä¸Šã®è¡Œã€‚\r\n    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ä¸­èº«ã‚’å®šç¾©ã™ã‚‹ï¼ˆä¸»ã‚­ãƒ¼ã¨ã‹ï¼‰\r\n- DAO\r\n    - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«ä½¿ã†é–¢æ•°ã‚’å®šç¾©ã™ã‚‹\r\n    - ã‚¯ã‚¨ãƒªã‚‚å…¥åŠ›è£œåŠ©ãŒä»˜ã„ãŸã®ã§é–“é•ã„ãŒæ¸›ã£ãŸï¼ˆï¼‹å®Ÿè¡Œå‰ã«é–“é•ã„ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã‚‹ï¼‰\r\n\r\n# ç§»è¡Œã™ã‚‹\r\næµçŸ³ã«ã¡ã‚‡ã£ã¨æ€–ãã­ï¼Ÿ\r\n\r\n## Entityã‚’ä½œæˆã™ã‚‹\r\nä»Šå›ã¯ãƒ•ã‚¡ã‚¤ãƒ«åã‚’`CommentCollectionEntity.kt`ã¨ã—ã¾ã™ã€‚  \r\n\r\n### ä¾‹\r\n\r\nSQLiteHelperãŒã“ã†ãªã£ã¦ã„ã‚‹ã¨ã—ã¦\r\n\r\n```kotlin\r\n// ãƒ‡ãƒ¼ã‚¿ãƒ¼ãƒ™ãƒ¼ã‚¹å\r\nprivate val DATABASE_NAME = \"CommentCollection.db\"\r\nprivate val TABLE_NAME = \"comment_collection_db\"\r\nprivate val DESCRIPTION = \"description\"\r\nprivate val YOMI = \"yomi\"\r\nprivate val COMMENT = \"comment\"\r\nprivate val _ID = \"_id\"\r\n// , ã‚’ä»˜ã‘å¿˜ã‚Œã‚‹ã¨ã‚¨ãƒ©ãƒ¼\r\nprivate val SQL_CREATE_ENTRIES = \"CREATE TABLE \" + TABLE_NAME + \" (\" +\r\n        _ID + \" INTEGER PRIMARY KEY,\" +\r\n        COMMENT + \" TEXT ,\" +\r\n        YOMI + \" TEXT ,\" +\r\n        DESCRIPTION + \" TEXT\" +\r\n        \")\"\r\n```\r\n\r\nEntityã¯ã“ã†ãªã‚Šã¾ã™ï¼ˆä¾‹ãŒã‚¯ã‚½ã‚ã‹ã‚Šã«ãã„ã€‚**ã¾ã‚‹ã§æ•™ç§‘æ›¸ã®ä¾‹é¡Œã®è§£ãæ–¹ãŒå‚è€ƒã«ãªã‚‰ãªã„å•é¡Œã¿ãŸã„**ï¼‰\r\n\r\n```kotlin\r\n@Entity(tableName = \"comment_collection_db\")\r\ndata class CommentCollectionEntity(\r\n    @ColumnInfo(name = \"_id\") @PrimaryKey(autoGenerate = true) val id: Int = 0,\r\n    @ColumnInfo(name = \"comment\") val comment: String,\r\n    @ColumnInfo(name = \"yomi\") val yomi: String,\r\n    @ColumnInfo(name = \"description\") val description: String\r\n)\r\n```\r\n\r\n#### Entityæ›¸ãã¨ãã«æ³¨æ„ã—ãªã„ã¨ã„ã‘ãªã„ã“ã¨\r\n- `@Entity(tableName = \"\")`ã‚’æ›¸ã‹ãªã„ã¨ã ã‚ã€‚\r\n    - `CREATE TABLE {ã“ã“} `ã®å€¤ã§ã™ã­ã€‚å¿˜ã‚Œãã†\r\n- ã‚«ãƒ©ãƒ ã¨å¤‰æ•°åãŒåŒã˜ã˜ã‚ƒãªã„å ´åˆã¯`@ColumnInfo`ã‚’ä½¿ã†\r\n- **å®Ÿã¯nullã‚’è¨±å®¹ã™ã‚‹ã‚ˆã†ã«æ›¸ãã¨ç§»è¡Œã®ã¨ãã ã‘æ¥½ã«ãªã‚‹**\r\n    - `Migrationã‚’æ›¸ã`ã®å·¥ç¨‹ãŒã»ã¼ãªããªã‚Šæ¥½ã«ãªã‚Šã¾ã™ãŒã€ä½¿ã†ã¨ãã«æ¯å›nullã®å¯èƒ½æ€§ãŒã‚ã‚‹å€¤ã‚’ä½¿ã†ç¾½ç›®ã«ãªã‚‹ã®ã§ä»Šå›ã¯**nullçµ¶å¯¾è¨±ã•ã‚“**æ–¹é‡ã§è¡Œãã¾ã™ã€‚\r\n    - nullã‚’è¨±å®¹ã™ã‚‹å ´åˆã¯`String?`ã‚„`Int?`ã®ã‚ˆã†ã«æœ€å¾Œã«`?`ã‚’ã¤ã‘ã‚Œã°ã„ã„ã§ã™ãŒ**ä»Šå›ã¯ã¤ã‘ã¾ã›ã‚“**ã€‚\r\n\r\n### DAOã‚’æ›¸ã\r\nãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã™ã‚‹éš›ã«ä½¿ã†é–¢æ•°ã‚’å®šç¾©ã—ã¾ã™ã€‚  \r\nã‚¯ã‚¨ãƒªã‚‚ã“ã“ã«æ›¸ãã¾ã™ã€‚  \r\nã“ã“ã§ã¯ä¸€èˆ¬çš„ã«ä½¿ã„ãã†ãªå‹•ä½œã‚’ä¾‹ã¨ã—ã¦ç½®ã„ã¨ãã®ã§ã€å„è‡ªEntityã‚¯ãƒ©ã‚¹åç­‰ã‚’æ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚\r\n\r\nãƒ•ã‚¡ã‚¤ãƒ«åã¯`CommentCollectionDAO.kt`ã§\r\n\r\n```kotlin\r\n/**\r\n * ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ãã«ä½¿ã†é–¢æ•°ã‚’å®šç¾©ã™ã‚‹\r\n * */\r\n@Dao\r\ninterface CommentCollectionDAO {\r\n    /** å…¨ãƒ‡ãƒ¼ã‚¿å–å¾— */\r\n    @Query(\"SELECT * FROM comment_collection_db\")\r\n    fun getAll(): List<CommentCollectionEntity>\r\n\r\n    /** ãƒ‡ãƒ¼ã‚¿æ›´æ–° */\r\n    @Update\r\n    fun update(commentCollectionEntity: CommentCollectionEntity)\r\n\r\n    /** ãƒ‡ãƒ¼ã‚¿è¿½åŠ  */\r\n    @Insert\r\n    fun insert(commentCollectionEntity: CommentCollectionEntity)\r\n\r\n    /** ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ */\r\n    @Delete\r\n    fun delete(commentCollectionEntity: CommentCollectionEntity)\r\n\r\n    /** ãƒ‡ãƒ¼ã‚¿ã‚’IDã‚’ä½¿ã£ã¦æ¤œç´¢ */\r\n    @Query(\"SELECT * FROM comment_collection_db WHERE _id = :id\")\r\n    fun findById(id: Int): CommentCollectionEntity\r\n}\r\n```\r\n\r\nã“ã‚Œã‚’æ›¸ãéš›ã‚‚å…¥åŠ›è£œåŠ©ãŒèãã®ã§é–“é•ã„ãŒæ¸›ã‚Šã¾ã™ï¼ˆã“ã®è¨˜äº‹äºŒå›ç›®ã®ç™ºè¨€ï¼‰\r\n\r\n#### æ³¨æ„ç‚¹\r\nãªããªã„ï¼Ÿ\r\n\r\n### Database\r\nä¸­å¿ƒçš„ãªå½¹å‰²ã‚’æŒã¡ã¾ã™ã€‚  \r\nãƒ•ã‚¡ã‚¤ãƒ«åã¯`CommentCollectionDB.kt`ã§\r\n\r\n```kotlin\r\n/**\r\n * ã‚³ãƒ¡ãƒ³ãƒˆã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€‚\r\n * SQLiteã‹ã‚‰ç§»è¡Œã™ã‚‹å ´åˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹å¿…è¦ãŒã‚ã‚‹\r\n * */\r\n@Database(entities = [CommentCollectionEntity::class], version = 2)\r\nabstract class CommentCollectionDB : RoomDatabase() {\r\n    abstract fun commentCollectionDAO(): CommentCollectionDAO\r\n}\r\n```\r\n\r\n#### æ³¨æ„ç‚¹\r\n- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ãªã„ã¨ã„ã‘ãªã„ãã†ã§ã™ã€‚\r\n\r\n## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ã‚¢ã‚¯ã‚»ã‚¹\r\nãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½¿ã†ã¨ãã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä¸Šã’ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚  \r\n\r\n```kotlin\r\n// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–\r\nval commentCollectionDB = Room.databaseBuilder(this, CommentCollectionDB::class.java, \"CommentCollection.db\")\r\n    .addMigrations(object : Migration(1, 2) {\r\n        override fun migrate(database: SupportSQLiteDatabase) {\r\n        }\r\n    })\r\n    .build()\r\nGlobalScope.launch(Dispatchers.Main) {\r\n    // ã‚³ãƒ«ãƒ¼ãƒãƒ³\r\n    withContext(Dispatchers.IO) {\r\n        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å€¤ã‚’å–ã‚‹\r\n        commentCollectionDB.commentCollectionDAO().getAll().forEach { data ->\r\n            println(data.comment)\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã¾ã‚ã“ã‚Œã˜ã‚ƒå‹•ã‹ãªã„ã‚“ã§ã™ã‘ã©ã­ã€‚  \r\nãã®ãŸã‚ã® **addMigrations** ãŒã‚ã‚‹ã®ã§ä½¿ã£ã¦ã„ãã¾ã™ã€‚\r\n\r\n### ãªã‚“ã§ï¼Ÿå‹•ã‹ãªã„ã®ï¼Ÿ\r\nå®Ÿã¯Entityã§nullã‚’è¨±å®¹ã™ã‚Œã°ã“ã®å•é¡Œã¯æ¶ˆãˆã¾ã™ã€‚  \r\n```kotlin\r\n@ColumnInfo(name = \"comment\") val comment: String? // null ok!\r\n```\r\nã—ã‹ã—nullã‚’è¨±å®¹ã™ã‚‹ã¨ä½¿ã†ã¨ãã«é¢å€’ãã•ããªã‚Šã¾ã™ï¼ˆã“ã®ä¾‹ã ã¨`comment?.length`ã¿ãŸã„ã«?ä»˜ã‘ãªã„ã¨ã„ã‘ãªããªã‚‹ï¼‰\r\n\r\nã“ã®å•é¡Œã¯SQLiteã¨Roomã¨ã§nullã‚’è¨±ã™ã‹ã©ã†ã‹ã§å•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚\r\n- **SQLiteãã‚“**\r\n    - nullï¼Ÿè‰¯ã„ã‚“ã˜ã‚ƒã­ï¼Ÿ\r\n- **Roomãã‚“**\r\n    - `Entity`ãŒnullã‚’è¨±ã—ã¦ãã‚Œãªã„ï¼›ï¼›\r\n    - ã‚ˆã—è½ã¨ã™ã‹â†ã„ã¾ã“ã“\r\n\r\nã¡ãªã¿ã«å‡ºåŠ›ã•ã‚ŒãŸã‚¨ãƒ©ãƒ¼ã¯ã“ã¡ã‚‰ã€‚\r\n```js\r\nExpected:\r\n    TableInfo{name='comment_collection_db', columns={description=Column{name='description', type='TEXT', affinity='2', notNull=true, primaryKeyPosition=0, defaultValue='null'}, comment=Column{name='comment', type='TEXT', affinity='2', notNull=true, primaryKeyPosition=0, defaultValue='null'}, yomi=Column{name='yomi', type='TEXT', affinity='2', notNull=true, primaryKeyPosition=0, defaultValue='null'}, _id=Column{name='_id', type='INTEGER', affinity='3', notNull=true, primaryKeyPosition=1, defaultValue='null'}}, foreignKeys=[], indices=[]}\r\nFound:\r\n    TableInfo{name='comment_collection_db', columns={description=Column{name='description', type='TEXT', affinity='2', notNull=false, primaryKeyPosition=0, defaultValue='null'}, comment=Column{name='comment', type='TEXT', affinity='2', notNull=false, primaryKeyPosition=0, defaultValue='null'}, yomi=Column{name='yomi', type='TEXT', affinity='2', notNull=false, primaryKeyPosition=0, defaultValue='null'}, _id=Column{name='_id', type='INTEGER', affinity='3', notNull=false, primaryKeyPosition=1, defaultValue='null'}}, foreignKeys=[], indices=[]}\r\n```\r\n\r\nã‚ˆãè¦‹ã‚‹ã¨ä¸Šã®`Expected`ã®æ–¹ã®`notNull`ã¯`true(nullè‰¯ã„ã‚ˆ)`ã§ã™ãŒã€  \r\n`Found(ä»Šå›ä½œã£ãŸEntity)`ã¯`notNull`ãŒ`false(nullã ã‚ã ã‚ˆ)`ã£ã¦ã“ã¨ã§ä¸­èº«ãŒå™›ã¿åˆã‚ãšä¾‹å¤–ãŒç™ºç”Ÿã—ã¦ã„ã¾ã™ã€‚\r\n\r\n## Migration\r\nnullã‚’è¨±å®¹ ã‹ã‚‰ nullã‚’è¨±ã•ã‚“ ã«å¤‰æ›´ã—ãŸã„ã®ã§ã™ãŒã€æ®‹å¿µãªãŒã‚‰å¤‰æ›´ã™ã‚‹ã«ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œã‚Šç›´ã™å¿…è¦ãŒã‚ã‚‹ãã†ã§ã™ã€‚  \r\n\r\nã¾ã‚ã¾ã‚é¢å€’ãã•ã„ã€‚ã‚„ã‚‹ã“ã¨ã¯ä»¥ä¸‹ã®4ã¤\r\n- æ–°ã—ããƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹\r\n    - ä»Šã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã«ã‚ã£ãŸã‚«ãƒ©ãƒ ã‚’å…¨éƒ¨æ›¸ã\r\n- æ–°ã—ãä½œã£ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ãƒ‡ãƒ¼ã‚¿ã‚’ç§»ã™\r\n- å¤ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¶ˆã™\r\n- æ–°ã—ãä½œã£ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åå‰ã‚’å¤ã„ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åå‰ã«å¤‰æ›´ã™ã‚‹\r\n\r\nã“ã‚Œã‚’Kotlinã§æ›¸ãã¨ã“ã†ãªã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\noverride fun migrate(database: SupportSQLiteDatabase) {\r\n    // SQLiteç§»è¡Œã€‚ç§»è¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚ã‚«ãƒ©ãƒ ã¯ç§»è¡Œå‰ã¨åŒã˜\r\n    database.execSQL(\r\n        \"\"\"\r\n        CREATE TABLE comment_collection_db_tmp (\r\n          _id INTEGER NOT NULL PRIMARY KEY, \r\n          comment TEXT NOT NULL,\r\n          yomi TEXT NOT NULL,\r\n          description TEXT NOT NULL\r\n        )\r\n        \"\"\"\r\n    )\r\n    // ç§»è¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ãƒ‡ãƒ¼ã‚¿ã‚’ç§»ã™\r\n    database.execSQL(\r\n        \"\"\"\r\n        INSERT INTO comment_collection_db_tmp (_id, comment, yomi, description)\r\n        SELECT _id, comment, yomi, description FROM comment_collection_db\r\n        \"\"\"\r\n    )\r\n    // å‰ã‚ã£ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¶ˆã™\r\n    database.execSQL(\"DROP TABLE comment_collection_db\")\r\n    // ç§»è¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åå‰ã‚’ç§»è¡Œå‰ã¨åŒã˜ã«ã—ã¦ç§»è¡Œå®Œäº†\r\n    database.execSQL(\"ALTER TABLE comment_collection_db_tmp RENAME TO comment_collection_db\")\r\n}\r\n```\r\n\r\nå…¨éƒ¨ãã£ã¤ã‘ã‚‹ã¨ã“ã†\r\n\r\n```kotlin\r\n// ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆæœŸåŒ–\r\nval commentCollectionDB = Room.databaseBuilder(this, CommentCollectionDB::class.java, \"CommentCollection.db\")\r\n    .addMigrations(object : Migration(1, 2) {\r\n        override fun migrate(database: SupportSQLiteDatabase) {\r\n            // SQLiteç§»è¡Œã€‚ç§»è¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ä½œæˆã™ã‚‹ã€‚ã‚«ãƒ©ãƒ ã¯ç§»è¡Œå‰ã¨åŒã˜\r\n            database.execSQL(\r\n                \"\"\"\r\n                CREATE TABLE comment_collection_db_tmp (\r\n                  _id INTEGER NOT NULL PRIMARY KEY, \r\n                  comment TEXT NOT NULL,\r\n                  yomi TEXT NOT NULL,\r\n                  description TEXT NOT NULL\r\n                )\r\n                \"\"\"\r\n            )\r\n            // ç§»è¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¸ãƒ‡ãƒ¼ã‚¿ã‚’ç§»ã™\r\n            database.execSQL(\r\n                \"\"\"\r\n                INSERT INTO comment_collection_db_tmp (_id, comment, yomi, description)\r\n                SELECT _id, comment, yomi, description FROM comment_collection_db\r\n                \"\"\"\r\n            )\r\n            // å‰ã‚ã£ãŸãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æ¶ˆã™\r\n            database.execSQL(\"DROP TABLE comment_collection_db\")\r\n            // ç§»è¡Œå¾Œã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®åå‰ã‚’ç§»è¡Œå‰ã¨åŒã˜ã«ã—ã¦ç§»è¡Œå®Œäº†\r\n            database.execSQL(\"ALTER TABLE comment_collection_db_tmp RENAME TO comment_collection_db\")\r\n        }\r\n    })\r\n    .build()\r\nGlobalScope.launch(Dispatchers.Main) {\r\n    // ã‚³ãƒ«ãƒ¼ãƒãƒ³\r\n    withContext(Dispatchers.IO) {\r\n        // ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‹ã‚‰å€¤ã‚’å–ã‚‹\r\n        commentCollectionDB.commentCollectionDAO().getAll().forEach { data ->\r\n            println(data.comment)\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\n\r\n# è¿½åŠ ã™ã‚‹æ–¹æ³•\r\nSQLiteæ™‚ä»£ã®`ContentValues`ã‚ˆã‚Šãšã£ã¨ã‚ã‹ã‚Šã‚„ã™ã„ã€‚\r\n```kotlin\r\nGlobalScope.launch(Dispatchers.Main) { \r\n    withContext(Dispatchers.IO){\r\n        val commentCollectionEntity = CommentCollectionEntity(comment = \"comment\", yomi = \"yomi\", description = \"\")\r\n        commentCollectionDB.commentCollectionDAO().insert(commentCollectionEntity)\r\n    }\r\n}\r\n```\r\n\r\n# ã“ã‚Œä»Šã¾ã§é€šã‚ŠSQLiteOpenHelperçµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã¨ã©ã†ãªã‚‹ã®ï¼Ÿ\r\n\r\n```terminal\r\nandroid.database.sqlite.SQLiteException: Can't downgrade database from version 2 to 1\r\n```\r\n\r\nãƒãƒ¼ã‚¸ãƒ§ãƒ³ä¸‹ã’ã‚“ãªã£ã¦æ€’ã‚‰ã‚ŒãŸã€‚\r\n\r\n# ãŠã‚ã‚Šã«\r\nã‚«ãƒ©ãƒ ãŒç¸¦ã‹æ¨ªã‹ã‚ã‹ã‚‰ã‚“æ™‚ãŒã‚ˆãã‚ã‚‹ã®ã§ãã®æ™‚ã¯**TweetDeckãŒãƒãƒ«ãƒã‚«ãƒ©ãƒ **ã ã£ã¦ã“ã¨ã‚’æ€ã„å‡ºã—ã¦ã‚ï½æ¨ªä¸¦ã³ã®ã“ã¨ã‹ï½ã£ã¦æ€ã„å‡ºã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚\r\n\r\nä½œã‚‰ãªã„ã¨è¡Œã‘ãªã„ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤šãã¦åˆè¦‹ã•ã‚“ã¯å¤§å¤‰ãã†ã ã¨æ€ã£ãŸï¼ˆã“ãªã¿ï¼‰\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://developer.android.com/training/data-storage/room/migrating-db-versions  \r\nhttps://medium.com/@manuelvicnt/android-room-upgrading-alpha-versions-needs-a-migration-with-kotlin-or-nonnull-7a2d140f05b9  \r\nhttps://stackoverflow.com/questions/47562157/android-room-migration-null-error  \r\nhttps://qiita.com/arara_tepi/items/7267418ca4b6bd65d744#notnull%E3%82%92%E5%90%88%E3%82%8F%E3%81%9B%E3%82%8B"},{"title":"Androidå˜ä½“ã§WebMã¨MPEG-DASHã‚’ä½¿ã£ãŸãƒ©ã‚¤ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°","link":"/posts/android_standalone_webm_livestreaming/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚  \r\nä¿å¥å®¤ã®ã‚»ãƒ³ã‚»ãƒ¼ã¨å°æ‚ªé­”ãªä¼šé•· æ”»ç•¥ã—ã¾ã—ãŸã€‚\r\n\r\né­…åŠ›çš„ãªç”Ÿå¾’ã‹ã„ã¡ã‚‡ãƒ¼ã•ã‚“ã‚’æ”»ç•¥ã§ãã‚‹ç¥ã‚²ãƒ¼ã§ã™ã€‚å‰ä½œã¨é•ã„å­¦åœ’ç”Ÿæ´»ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ã—ã¦ã¾ã™ã€‚  \r\nå£°ãŒãƒ’ãƒ­ã‚¤ãƒ³ã«ã‚ã£ã¡ã‚ƒåˆã£ã¦ã¦ã„ã„ï¼\r\n\r\n![Imgur](https://imgur.com/TDO2IL4.png)\r\n\r\nï¼›ï¼›\r\n\r\n![Imgur](https://imgur.com/ru8COek.png)\r\n\r\nâ†“ã®å±•é–‹å‰ä½œã¨å¤‰ã‚ã£ã¦ã‚‹ã®ã‹ã‚ã„ã„\r\n\r\n![Imgur](https://imgur.com/kKdmoCP.png)\r\n\r\n![Imgur](https://imgur.com/WZPAADx.png)\r\n\r\n~~ä¸€ç·’ã«ãŠé¢¨å‘‚ã«å…¥ã‚‹ã‚·ãƒ¼ãƒ³ãŒã‚ã£ã¡ã‚ƒã„ã„ï¼ï¼ï¼ã‹ã‚ã„ã„ï¼~~\r\n\r\n# æœ¬é¡Œ\r\n[å‰å›ã®è¨˜äº‹](/posts/android_zero_mirror/) ã§`Android`ã®ç”»é¢ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã¸ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã™ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚  \r\nãŒã€ã“ã‚Œå•é¡ŒãŒã‚ã£ã¦ã€éŒ²ç”»ã—ãŸæ˜ åƒã‚’ç´°åˆ‡ã‚Œã«ã—ã¦`WebSocket`ã§é€ä¿¡ã—ã¦å†ç”Ÿã™ã‚‹ä»•çµ„ã¿ãªã®ã§ã€ã©ã†ã—ã¦ã‚‚å‹•ç”»ã‚’å…¥ã‚Œæ›¿ãˆã‚‹éš›ã«ä¸€ç¬é»’ããªã£ã¦ã—ã¾ã†ã‚“ã§ã™ã‚ˆã­ã€‚ã“ã‚Œã‚’ç›´ã›ãªã„ã‹èª¿æŸ»ã—ã¾ã—ãŸã€‚\r\n\r\n## ãƒ©ã‚¤ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã™ã‚‹ã«ã¯\r\nä¸–ã®ä¸­ã®ãƒ©ã‚¤ãƒ–é…ä¿¡ã®ä»•çµ„ã¿ã‚’èª¿æŸ»ã€‚\r\n\r\n`HLS`ã®å ´åˆã¯ã€ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«`MPEG2-TS`ã€`Fragmented mp4`ã‚’è¦æ±‚ã—ã¾ã™ã€‚  \r\n`MPEG-DASH`ã®å ´åˆã¯åŒæ§˜ã«ã€`MPEG2-TS`ã€`Fragmented mp4`ã‚’è¦æ±‚ã—ã¾ã™ã€ã€ã€ãŒï¼ï¼  \r\n`WebM`ã§ã‚‚åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã€ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ãã‚Œãã‚Œç”¨æ„ã§ãã‚‹å ´åˆã¯`MPEG-DASH`ã§é…ä¿¡ã§ãã‚‹ã¿ãŸã„ã§ã™ï¼ç¬¬ä¸‰ã®é¸æŠè‚¢ï¼ï¼Ÿ\r\n\r\n# MPEG-DASH ã¨ã¯\r\nHLSã¿ãŸã„ã«å‹•ç”»ã‚’ç´°åˆ‡ã‚Œã«ã—ã¦é…ä¿¡ã™ã‚‹ã‚„ã¤ã€‚  \r\n`HLS`ã®`m3u8`ã«å½“ãŸã‚‹ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆï¼Ÿã¯ã€`MPEG-DASH`ã§ã¯`xml`ã§è¨˜è¿°ã•ã‚Œã¦ãŠã‚Šï¼ˆãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¨ã‹è¨€ã‚ã‚Œã¦ã‚‹ï¼Ÿï¼‰ã€è‹¥å¹²é›£ã—ã„ã€‚(HLSã‚ˆã‚Šã¯è¤‡é›‘ã«ãªã£ã¦ã‚‹)  \r\nã¡ãªã¿ã«`iPhone`ã®`Safari`ã§ã¯ä½¿ãˆãªã„ã®ã§(å¾Œè¿°)ã€iPhoneã‚’å¯¾è±¡ã«ã—ãŸã„å ´åˆã¯`HLS`ä¸€æŠã«ãªã‚‹ã€‚ï¼›ï¼›  \r\nã‚‚ã£ã¨çŸ¥ã‚ŠãŸã„å ´åˆã¯ `ISO/IEC 23009-1:2022` ã¨ã‹ã§ã‚‚èª¿ã¹ã¦ãã ã•ã„ã€‚(ãã‚Œã£ã½ã„PDFãŒæ‰‹ã«å…¥ã‚‹)\r\n\r\n## MPEG-DASHã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ\r\nã“ã„ã†ã‚„ã¤ã‚’ã€`MPEG-DASH`ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«æ¸¡ã™ã¨æ˜ åƒã‚’å–å¾—ã—ã¦å†ç”Ÿã—ã¦ãã‚Œã¾ã™ã€‚  \r\n`HLS`ã¨é•ã£ã¦è¤‡æ•°è§£åƒåº¦ã‚’ä¸€åº¦ã«è¨˜è¿°å‡ºæ¥ãŸã‚Šã€  \r\nãƒ©ã‚¤ãƒ–é…ä¿¡ã®éš›ã‚‚ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨ç„¡ãï¼ï¼ˆå¾Œè¿°ï¼‰  \r\nã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆæ˜ åƒãƒ‡ãƒ¼ã‚¿ï¼‰ã‚’é€£ç•ªã§å–å¾—å‡ºæ¥ãŸã‚Šã€  \r\nï¼ˆãƒ©ã‚¤ãƒ–é…ä¿¡ã®ã¿ï¼Ÿï¼‰æ˜ åƒãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹æ™‚é–“ã¾ã§ã‚‚å®šç¾©å‡ºæ¥ã‚‹ã®ã§ã‚ˆãåˆ†ã‹ã‚‰ã‚“ï¼ï¼ï¼\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<MPD xmlns=\"urn:mpeg:dash:schema:mpd:2011\" availabilityStartTime=\"2022-09-09T01:45:50+09:00\" maxSegmentDuration=\"PT3S\" minBufferTime=\"PT3S\" type=\"dynamic\" profiles=\"urn:mpeg:dash:profile:isoff-live:2011,http://dashif.org/guidelines/dash-if-simple\">\r\n  <BaseURL>/</BaseURL>\r\n  <Period start=\"PT0S\">\r\n    <AdaptationSet mimeType=\"video/webm\">\r\n      <Role schemeIdUri=\"urn:mpeg:dash:role:2011\" value=\"main\" />\r\n      <!-- duration ãŒæ›´æ–°é »åº¦ã£ã½ã„ -->\r\n      <SegmentTemplate duration=\"3\" initialization=\"/init.webm\" media=\"/segment$Number$.webm\" startNumber=\"0\"/>\r\n      <!-- éŸ³å£°å…¥ã‚Œã‚‹å ´åˆã¯ codecs=\"vp9,opus\" -->\r\n      <Representation id=\"default\" codecs=\"vp9,opus\"/>\r\n    </AdaptationSet>\r\n  </Period>\r\n</MPD>\r\n```\r\n\r\nã‚ˆãåˆ†ã‹ã‚‰ã‚“...ã€ç„¡é§„ãªäº‹ã—ã¦ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã€‚  \r\nèª°ã‹è§£èª¬ã‚ˆã‚...\r\n\r\n- type=\"dynamic\"\r\n    - MPEG-DASHãŒãƒ©ã‚¤ãƒ–é…ä¿¡ãƒ¢ãƒ¼ãƒ‰ã«ãªã‚‹ã¯ãš\r\n- availabilityStartTime\r\n    - æ˜ åƒãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹æ™‚é–“ã§ã™\r\n    - ISO 8601 ã§è¨˜è¿°ã™ã‚‹\r\n    - ãƒ©ã‚¤ãƒ–é…ä¿¡ãƒ¢ãƒ¼ãƒ‰ã®ã¿åˆ©ç”¨å‡ºæ¥ã‚‹\r\n- maxSegmentDuration / minBufferTime\r\n    - ã‚ã‹ã‚‰ã‚“...\r\n- mimeType\r\n    - `Fragmented MP4`ã ã£ãŸã‚‰`video/mp4`ã¨ã‹ã ã¨æ€ã„ã¾ã™\r\n- duration\r\n    - å¤šåˆ†æ˜ åƒãƒ‡ãƒ¼ã‚¿ã®é•·ã•ã§ã™\r\n- initialization\r\n    - åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§ã™ï¼ˆWebMã®éƒ¨åˆ†ã§è©±ã™ï¼‰\r\n    - ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹ãŸã‚ã®å€¤ãŒå…¥ã£ã¦ã¾ã™\r\n- media\r\n    - ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã§ã™ï¼ˆWebMã®éƒ¨åˆ†ã§è©±ã™ï¼‰\r\n    - æ˜ åƒãƒ‡ãƒ¼ã‚¿ãŒå…¥ã£ã¦ã¾ã™\r\n- startNumber\r\n    - å¾Œè¿°\r\n- codecs\r\n    - æ˜ åƒã¨éŸ³å£°ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’æŒ‡å®šã—ã¾ã™\r\n    - éŸ³å£°ãŒãªã„å ´åˆã¯æ˜ åƒã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã ã‘æŒ‡å®šã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™\r\n\r\n## media=\"/segment$Number$.webm\" â† $Number$ ã£ã¦ä½•ï¼Ÿ\r\nãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆæ§‹æ–‡ã¿ãŸã„ãªã‚„ã¤ã€‚ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®éš›ã¯`/segment1.webm`ã€`/segment2.webm`ã¿ãŸã„ãªæ„Ÿã˜ã«å±•é–‹ã•ã‚Œã‚‹ã€‚  \r\n`Number`ãŒãƒªã‚¯ã‚¨ã‚¹ãƒˆã®åº¦ã«ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã•ã‚Œã‚‹ã®ã§ã€ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’æ›´æ–°ã™ã‚‹ã“ã¨ç„¡ããƒ©ã‚¤ãƒ–é…ä¿¡ã‚’æä¾›ã§ãã¾ã™ï¼ï¼ˆHLSã®å ´åˆã¯å®šæœŸçš„ã«ãƒ—ãƒ¬ã‚¤ãƒªã‚¹ãƒˆã‚’æ›´æ–°ã—ã«è¡Œã£ã¦ã‚‹ã¨æ€ã†...ï¼Ÿï¼‰\r\n\r\nä»–ã«ã‚‚`$RepresentationID$`ã¨ã‹`$Bandwidth$`ã¨ã‹ã®å¤‰æ•°ã‚‚ã‚ã‚Šã¾ã™ã€‚\r\n\r\n# WebM ã¨ã¯\r\næ˜ åƒã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®`VP8`/`VP9`ã€éŸ³å£°ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®`Opus`ãªã©ã‚’ä¿å­˜ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€‚  \r\nWebMã¯`Matroska`ã®ã‚µãƒ–ã‚»ãƒƒãƒˆãªã®ã§`Matroska`ã‚’èª¿ã¹ã‚ˆã†  \r\n\r\nã‚¨ãƒ©ãƒ¼è€æ€§ãŒã‚ã‚‹ã¨ã‹ãªã‚“ã¨ã‹ã£ã¦æ›¸ã„ã¦ã‚ã£ãŸã‘ã©ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’`Cluster`å˜ä½ã§ä¿å­˜ã—ã¦ã‚‹ã‹ã‚‰ãªã‚“ã§ã—ã‚‡ã†ã‹ã­ï¼Ÿ\r\n\r\n### ç•ªå¤–ç·¨ ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ / ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\n`mp4`ã¯å®Ÿã¯ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä¸€ã¤ãªã®ã§ã™ã€‚  \r\nã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰(åœ§ç¸®)ã•ã‚ŒãŸæ˜ åƒã¨éŸ³å£°ã‚’ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã™ã‚‹ãŸã‚ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®ç¨®é¡ã§ã¯ãªã„ã®ã§ã™ã­ã€‚  \r\n(ã‚³ãƒ³ãƒ†ãƒŠã«ä¿å­˜ã™ã‚‹ã“ã¨ã‚’ãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µã¨ã‹è¨€ã£ãŸã‚Šã™ã‚‹ã£ã½ã„)  \r\n`mp4`ã€`MPEG2-TS`ã€`WebM`ã€`mkv`ãªã©ãŒä»²é–“ã§ã™ã€‚\r\n\r\nã˜ã‚ƒã‚ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¯ä½•ã ã¨è¨€ã†è©±ã§ã™ãŒã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼ˆåœ§ç¸®ï¼‰ã®ç¨®é¡ã§ã™ã€‚æ˜ åƒãªã‚‰`H.264 (AVC)`ã€éŸ³å£°ãªã‚‰`AAC`ãŒä¸»ã«ä½¿ã‚ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\n`H.265 (HEVC)`ã€`VP8`ã€`VP9`ã€`ProRes`ï¼ˆï¼Ÿï¼‰ã€`Opus`ã€`Vorbis`ãªã©ãŒä»²é–“ã§ã™ã€‚\r\n\r\nè¤‡é›‘ã§ã™ã­ã€ã€ã€ã§ã‚‚ãªãœã‹`ffmpeg`ã§ã¯åˆ©ç”¨è€…ã®éœ€è¦ã‚’å®Œå…¨ã«ç†è§£ã—ã¦å¤‰æ›ã—ã¦ãã‚Œã¾ã™ã€‚ä¸æ€è­°\r\n\r\nã‚ã‹ã‚Šã‚„ã™ã„è¨˜äº‹ãŒã‚ã‚Šã¾ã—ãŸï¼š\r\nhttps://aviutl.info/ko-dekku-konntena/\r\n\r\n## WebM ã‚’ MPEG-DASH ã§é…ä¿¡ã™ã‚‹ãŸã‚ã«ã¯\r\n\r\nå‚è€ƒã«ãªã‚Šã¾ã—ãŸã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼ï¼ï¼\r\n- https://www.slideshare.net/mganeko/media-recorder-and-webm\r\n- https://qiita.com/tomoyukilabs/items/57ba8a982ab372611669\r\n\r\nä¸€ã¤ã«ãªã£ãŸ`WebM`ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€`åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ`ã¨`ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ`ã‚’åˆ†é›¢ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\nWebMã®æœ€åˆã®æ–¹ã«å…¥ã£ã¦ã„ã‚‹ãƒ‡ãƒ¼ã‚¿ãŒ**åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ**ã«ãªã‚Šã¾ã™ã€‚  \r\nå¤šåˆ†ã“ã‚Œã¯ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ãŒèµ·å‹•ã™ã‚‹ãŸã‚ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ï¼ˆå‹•ç”»ã®å¹…ã¨ã‹ï¼‰ã§ã€ä¸€åº¦ã ã‘å¿…è¦ã§ã™ã€‚  \r\n\r\n**ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ**ã¯ãã®ã¾ã¾ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæ ¼ç´ã•ã‚Œã¦ã„ã¾ã™ã€‚  \r\nï¼ˆå®Ÿéš›ã«ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒéŸ³å£°ãªã®ã‹æ˜ åƒãªã®ã‹ã‚’åˆ¤åˆ¥ã™ã‚‹ãŸã‚ã®å€¤ãªã‚“ã‹ã‚‚å…¥ã£ã¦ã¾ã™ï¼‰\r\n\r\nã¡ãªã¿ã«`WebM`çš„ã«è¨€ã†ã¨ã€åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¯`Header`ã‹ã‚‰`Tracks`ã¾ã§ï¼Ÿã€‚ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¯`Cluster`ã¨ã‹è¨€ã‚ã‚Œã¦ã‚‹éƒ¨åˆ†ã§ã™ï¼Ÿ  \r\n\r\nå®Ÿéš›ã«`WebM`ã‚’ãƒã‚¤ãƒŠãƒªã‚¨ãƒ‡ã‚£ã‚¿ã§é–‹ã„ã¦ã©ã“ã¾ã§ã‚’æŒ‡ã—ã¦ã„ã‚‹ã®ã‹ã¨ã„ã†ã¨ã€æœ€åˆã®`Cluster`ãŒå§‹ã¾ã‚‹å‰ã¾ã§ãŒåˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã«ãªã‚‹ã¯ãšã§ã™ã€‚ï¼ˆé›‘ï¼‰  \r\n\r\n![Imgur](https://imgur.com/ICMxT2U.png)\r\n\r\n`Cluster`ã®é–‹å§‹ã‚¿ã‚°ãŒ`0x1F 0x43 0xB6 0x75`ãªã®ã§ã€å¤šåˆ†ã“ã‚“ãªæ„Ÿã˜ã«åˆ†é›¢ã§ãã‚‹ã¨æ€ã†ã€‚å¤šåˆ†ã‚‚ã£ã¨ã„ã„å®Ÿè£…æ–¹æ³•ãŒã‚ã‚‹ã ã‚ã†ã‘ã©...\r\n\r\n```kotlin\r\nval readRecordFile = recordFile.readBytes()\r\n// åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç¯„å›²ã‚’æ¢ã™\r\n// ãã‚Œã„ãªå®Ÿè£…ã˜ã‚ƒãªã„...\r\nvar initSegmentLength = -1\r\nfor (i in readRecordFile.indices) {\r\n    if (\r\n        readRecordFile[i] == 0x1F.toByte()\r\n        && readRecordFile[i + 1] == 0x43.toByte()\r\n        && readRecordFile[i + 2] == 0xB6.toByte()\r\n        && readRecordFile[i + 3] == 0x75.toByte()\r\n    ) {\r\n        initSegmentLength = i\r\n        break\r\n    }\r\n}\r\nif (initSegmentLength == -1) {\r\n    return\r\n}\r\n// åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ\r\nval initSegmentBytes = readRecordFile.copyOfRange(0, initSegmentLength)\r\n```\r\n\r\n# Androidã§å®Ÿç¾å¯èƒ½ãªã®ã‹\r\n- WebM\r\n    - `MediaMuxer`ã¯å¯¾å¿œã—ã¦ã‚‹ï¼\r\n        - ãŸã å®šæœŸçš„ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹æ©Ÿèƒ½ã¯æµçŸ³ã«ãªã„ã®ã§ã€æ›¸ãè¾¼ã¿ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ç´°åˆ‡ã‚Œã«ã—ã¦ã„ãã—ã‹ãªã•ãã†ï¼Ÿ \r\n        - `JavaScript`ã«ã‚ã‚‹`MediaRecorder#start`ã¿ãŸã„ãªé–“éš”ã§ç”Ÿæˆã™ã‚‹æ©Ÿèƒ½ã¯ãªã„ï¼ˆãã®ã†ã¡JavaScriptã§ç”»é¢éŒ²ç”»ã—ã¦ã¿ãŸè¨˜äº‹ã‚’æ›¸ãã¨æ€ã†ï¼‰\r\n    - ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚‚å¯¾å¿œã—ã¦ã‚‹ï¼\r\n        - Opus â† ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚ã‚‹\r\n        - VP8 / VP9 â† ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚ã‚‹\r\n\r\nã„ã‘ãã†ï¼\r\n\r\n# å®Ÿéš›ã«ä½œã£ã¦ã¿ã‚‹\r\nã“ã“ã‹ã‚‰æœ¬é¡Œã§ã™ã€‚ \r\nç«¯æŠ˜ã‚ŠãªãŒã‚‰ä½œã£ã¦ã„ãã¾ã™ã€‚  \r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„                              |\r\n|---------|-------------------------------------|\r\n| Android | 12                                  |\r\n| å®Ÿæ©Ÿ    | Pixel 3 XL                          |\r\n| è¨€èª    | Kotlin (ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚‚ä½¿ã£ã¦ã„ãã¾ã™) |\r\n\r\n### ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\nä½¿ã†ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé›†\r\n\r\n| ãªã¾ãˆ             | ãªãœ                                                                                                                    |\r\n|--------------------|-------------------------------------------------------------------------------------------------------------------------|\r\n| Ktor               | ãƒ©ã‚¤ãƒ–é…ä¿¡ç”»é¢ï¼ˆindex.htmlï¼‰ã¨ã€ãƒ©ã‚¤ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã«å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãŸã‚ã«ä½¿ã„ã¾ã™ã€‚Androidã§ã‚‚å‹•ãï¼ |\r\n| androidx.lifecycle | ã‚³ãƒ«ãƒ¼ãƒãƒ³ä½¿ã„ãŸã„ã®ã§                                                                                                  |\r\n\r\n## AndroidManifest.xml\r\nä»Šå›ã¯ã‚«ãƒ¡ãƒ©æ˜ åƒã¨ãƒã‚¤ã‚¯ã‚’ãƒ©ã‚¤ãƒ–é…ä¿¡ã«ä½¿ã†ã®ã§æ¨©é™ã‚’æ›¸ãã¾ã™ã€‚  \r\nå¿˜ã‚ŒãŒã¡ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¨©é™ã‚‚\r\n\r\n```xml\r\n<uses-permission android:name=\"android.permission.INTERNET\" />\r\n<uses-permission android:name=\"android.permission.CAMERA\" />\r\n<uses-permission android:name=\"android.permission.RECORD_AUDIO\" />\r\n```\r\n\r\n## build.gradle\r\n`Ktor (Webã‚µãƒ¼ãƒãƒ¼)`ã¨`lifecycle-runtime-ktx`ã‚’è¿½åŠ ã—ã¾ã™ã€‚  \r\nã‚ã¨`Ktor`ã‚’å…¥ã‚ŒãŸã›ã„ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã®ã§æ²»ã™ã®ã¨ã€`ViewBinding`ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚  \r\n\r\nå¾Œè¿°ã—ã¾ã™ãŒã€`CameraX` ã¯ä½¿ã„ã¾ã›ã‚“ï¼›ï¼›ï¼ˆæ­£ç›´ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼Viewä½¿ã„ãŸã‹ã£ãŸï¼‰  \r\nã‚ˆãåˆ†ã‹ã‚‰ã‚“ã‘ã©ä»Šå›ã®ã‚ˆã†ãªã“ã¨ã‚’ã™ã‚‹å ´åˆ `Camera 2` ã‚ˆã‚Šå¤šåˆ†é›£ã—ããªã‚‹ã€‚\r\n\r\n```gradle\r\nplugins {\r\n    id 'com.android.application'\r\n    id 'org.jetbrains.kotlin.android'\r\n}\r\n\r\nandroid {\r\n    compileSdk 33\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.testwebmlivepublish\"\r\n        minSdk 21\r\n        targetSdk 33\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n        testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n    buildFeatures {\r\n        viewBinding true\r\n    }\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n    compileOptions {\r\n        sourceCompatibility JavaVersion.VERSION_1_8\r\n        targetCompatibility JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = '1.8'\r\n    }\r\n    packagingOptions {\r\n        resources {\r\n            excludes += \"/META-INF/{AL2.0,LGPL2.1}\"\r\n            // Ktorã®ã›ã„ã§ã‚¨ãƒ©ãƒ¼å‡ºã‚‹ã®ã§\r\n            excludes += \"META-INF/INDEX.LIST\"\r\n            excludes += \"META-INF/io.netty.versions.properties\"\r\n        }\r\n    }\r\n}\r\n\r\ndependencies {\r\n\r\n    // Ktor Webã‚µãƒ¼ãƒãƒ¼\r\n    implementation(\"io.ktor:ktor-server-core:2.0.0\")\r\n    implementation(\"io.ktor:ktor-server-netty:2.0.0\")\r\n\r\n    implementation \"androidx.lifecycle:lifecycle-runtime-ktx:2.4.0\"\r\n\r\n    implementation 'androidx.core:core-ktx:1.7.0'\r\n    implementation 'androidx.appcompat:appcompat:1.5.0'\r\n    implementation 'com.google.android.material:material:1.6.1'\r\n    implementation 'androidx.constraintlayout:constraintlayout:2.1.4'\r\n    testImplementation 'junit:junit:4.13.2'\r\n    androidTestImplementation 'androidx.test.ext:junit:1.1.3'\r\n    androidTestImplementation 'androidx.test.espresso:espresso-core:3.4.0'\r\n}\r\n```\r\n\r\n# activity_main.xml\r\næ˜ åƒã‚’ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã™ã‚‹`SurfaceView`ã¨é…ä¿¡é–‹å§‹ã€åœæ­¢ãƒœã‚¿ãƒ³ã‚’ç½®ãã¾ã—ãŸã€‚  \r\n`SurfaceView`ã®ä»£ã‚ã‚Šã«`TextureView`ã§ã‚‚ã„ã„ã¨ã¯æ€ã„ã¾ã™ãŒã€é›»åŠ›æ¶ˆè²»ã¨ã‹ã®é¢ã‹ã‚‰`SurfaceView`ã‚’æ¨å¥¨ã—ã¦ã‚‹ãã†ãªã€‚  \r\n(ExoPlayerã§ã™ãŒ)ï¼šhttps://exoplayer.dev/battery-consumption.html#video-playback\r\n\r\nï¼ˆViewã‚’å¤‰å½¢ã•ã›ãŸã„å ´åˆã¯`TextureView`ä¸€æŠã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€OpenGLã¨ã‹ã§ãã‚Œã°è©±ã¯åˆ¥ã‹ã‚‚ï¼‰\r\n\r\n![Imgur](https://imgur.com/0d1xt3w.png)\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <SurfaceView\r\n        android:id=\"@+id/preview_surface_view\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"0dp\"\r\n        app:layout_constraintBottom_toTopOf=\"@+id/start_button\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/start_button\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"é…ä¿¡é–‹å§‹\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\" />\r\n\r\n    <Button\r\n        android:id=\"@+id/stop_button\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"é…ä¿¡åœæ­¢\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\" />\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n# MainActivity.kt\r\n\r\n## æ¨©é™ã‚’è²°ã†å‡¦ç†\r\n`Activity Result API`ã§ã‚¹ãƒƒã‚­ãƒªã‹ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** æ¨©é™ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ */\r\n    private val permissionRequester = registerForActivityResult(ActivityResultContracts.RequestMultiplePermissions()) { result ->\r\n        if (result.all { it.value }) {\r\n            setupAll()\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(R.layout.activity_main)\r\n\r\n        // ã‚«ãƒ¡ãƒ©ã¨ãƒã‚¤ã‚¯æ¨©é™ãŒã‚ã‚‹å ´åˆã¯æº–å‚™ã™ã‚‹\r\n        if (ActivityCompat.checkSelfPermission(this, android.Manifest.permission.CAMERA) == PackageManager.PERMISSION_GRANTED\r\n            && ActivityCompat.checkSelfPermission(this, android.Manifest.permission.RECORD_AUDIO) == PackageManager.PERMISSION_GRANTED\r\n        ) {\r\n            setupAll()\r\n        } else {\r\n            // æ¨©é™ã‚’æ±‚ã‚ã‚‹\r\n            permissionRequester.launch(arrayOf(android.Manifest.permission.CAMERA, android.Manifest.permission.RECORD_AUDIO))\r\n        }\r\n    }\r\n\r\n    /** ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã† */\r\n    private fun setupAll() {\r\n        // ã‚«ãƒ¡ãƒ©ã®ç”¨æ„ãªã©\r\n    }\r\n\r\n}\r\n```\r\n\r\n## å®šæ•°\r\nã¯ã„\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    // çœç•¥\r\n\r\n    companion object {\r\n\r\n        /** ç”Ÿæˆé–“éš” */\r\n        private const val SEGMENT_INTERVAL_MS = 3_000L\r\n\r\n        /** åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®åå‰ */\r\n        private const val INIT_SEGMENT_FILENAME = \"init.webm\"\r\n\r\n        /** ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ */\r\n        private const val SEGMENT_FILENAME_PREFIX = \"segment\"\r\n\r\n        /** ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ */\r\n        private const val SAMPLE_RATE = 48_000\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ã‚«ãƒ¡ãƒ©ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œã‚‹\r\nã“ã“ã¯`Camera 2 API`ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã‚’ãã®ã¾ã¾ä½¿ãˆã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nã‚ˆãã‚ã‹ã‚‰ã‚“ã€ã€ã€`Surface`äºŒå›ã‚‚æŒ‡å®šã—ãªã„ã¨ã ã‚ãªã®ï¼Ÿ\r\n\r\n### ViewBinding ã¨ ã‚«ãƒ¡ãƒ©\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** ViewBinding */\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    /** ã‚«ãƒ¡ãƒ© */\r\n    private val cameraManager by lazy { getSystemService(Context.CAMERA_SERVICE) as CameraManager }\r\n    private var cameraDevice: CameraDevice? = null\r\n    private val cameraExecutor by lazy { Executors.newSingleThreadExecutor() }\r\n\r\n    // çœç•¥\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root) // ã“ã“å¤‰ãˆã‚‹ã®å¿˜ã‚Œãšã«\r\n\r\n    // çœç•¥\r\n```\r\n\r\n### ã‚«ãƒ¡ãƒ©ã®ç”¨æ„ã€‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å‡ºæ¥ã‚‹ã¾ã§\r\nã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„ã«ãªã‚‹ã‚“ã§ã™ãŒã€ã‚³ãƒ«ãƒ¼ãƒãƒ³ã®ãŠã‹ã’ã§ã¡ã‚‡ã£ã¨æ¥½ã«ãªã‚Šã¾ã™ã€‚  \r\nã“ã‚Œã§ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã•ã‚Œã‚‹ã¯ãšã€**ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ãŒãŠã‹ã—ã„ã®ã§ã™ãŒ**å¤šåˆ†ã“ã‚Œã‚’ç›´ã™ãŸã‚ã«ã¯ã‹ãªã‚Šã®åŠªåŠ›ãŒå¿…è¦ãªã®ã§ã‚„ã‚Šã¾ã›ã‚“ã€‚ï¼ˆï¼ï¼Ÿï¼‰  \r\n`Surface`ã‚’äºŒå›ã‚‚æŒ‡å®šã—ãªã„ã¨ã„ã‘ãªã„ã‚“ã§ã™ã­ã€‚`Camera 2 API`å¤§å¤‰ã€‚\r\n\r\nã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚‚ã¤ã„ã§ã«ç”¨æ„ã—ãŸã„ã®ã§ã™ãŒã€å¤§å¤‰ãªã®ã§å¾Œå›ã—ã«ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã† */\r\n    private fun setupAll() {\r\n        // ã‚«ãƒ¡ãƒ©ã®ç”¨æ„ãªã©\r\n        setupCameraAndEncoder()\r\n    }\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ */\r\n    private fun setupCameraAndEncoder() {\r\n        // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’æ´»ç”¨ã—ã¦ã„ã\r\n        lifecycleScope.launch {\r\n            val holder = viewBinding.previewSurfaceView.holder\r\n            val cameraDevice = suspendOpenCamera()\r\n            this@MainActivity.cameraDevice = cameraDevice\r\n\r\n            // TODO ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹\r\n\r\n            // å‡ºåŠ›å…ˆSurface\r\n            val outputSurfaceList = listOf(holder.surface)\r\n            // ã‚«ãƒ¡ãƒ©ã®è¨­å®šã‚’ã™ã‚‹\r\n            val captureRequest = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_RECORD).apply {\r\n                outputSurfaceList.forEach {\r\n                    addTarget(it)\r\n                }\r\n            }.build()\r\n\r\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\r\n                val outputList = buildList {\r\n                    outputSurfaceList.forEach {\r\n                        add(OutputConfiguration(it))\r\n                    }\r\n                }\r\n                SessionConfiguration(SessionConfiguration.SESSION_REGULAR, outputList, cameraExecutor, object : CameraCaptureSession.StateCallback() {\r\n                    override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                        captureSession.setRepeatingRequest(captureRequest, null, null)\r\n                    }\r\n                    override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n\r\n                    }\r\n                }).apply { cameraDevice.createCaptureSession(this) }\r\n            } else {\r\n                cameraDevice.createCaptureSession(outputSurfaceList, object : CameraCaptureSession.StateCallback() {\r\n                    override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                        captureSession.setRepeatingRequest(captureRequest, null, null)\r\n                    }\r\n                    override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n\r\n                    }\r\n                }, null)\r\n            }\r\n        }\r\n    }\r\n\r\n    /** ã‚«ãƒ¡ãƒ©ã‚’å–å¾—ã™ã‚‹ã€ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ãŒå‘¼ã°ã‚Œã‚‹ã¾ã§ä¸€æ™‚åœæ­¢ã™ã‚‹ */\r\n    @SuppressLint(\"MissingPermission\")\r\n    private suspend fun suspendOpenCamera() = suspendCoroutine<CameraDevice> {\r\n        // å¤šåˆ†å¤–ã‚«ãƒ¡ãƒ©\r\n        val cameraId = cameraManager.cameraIdList[0]\r\n        cameraManager.openCamera(cameraId, object : CameraDevice.StateCallback() {\r\n            override fun onOpened(camera: CameraDevice) {\r\n                it.resume(camera)\r\n            }\r\n            override fun onDisconnected(camera: CameraDevice) {\r\n\r\n            }\r\n            override fun onError(camera: CameraDevice, p1: Int) {\r\n\r\n            }\r\n        }, null)\r\n    }\r\n```\r\n\r\n### ãƒã‚¤ã‚¯ã®ç”¨æ„\r\nã“ã‚Œã‚‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼é¢å€’ãªã®ã§ãã‚Œä»¥å¤–ã‚’å…ˆã«æ›¸ãã¾ã™ã€‚  \r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** ãƒã‚¤ã‚¯ */\r\n    private lateinit var audioRecord: AudioRecord\r\n\r\n    // çœç•¥\r\n\r\n    /** ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã† */\r\n    private fun setupAll() {\r\n        // ã‚«ãƒ¡ãƒ©ã®ç”¨æ„ãªã©\r\n        setupCameraAndEncoder()\r\n        setupMicAndEncoder()\r\n    }\r\n\r\n    /** ãƒã‚¤ã‚¯ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„ */\r\n    @SuppressLint(\"MissingPermission\")\r\n    private fun setupMicAndEncoder() {\r\n        // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’æ´»ç”¨ã—ã¦ã„ã\r\n        lifecycleScope.launch {\r\n\r\n            // TODO ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„\r\n\r\n            // éŸ³å£°ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼èµ·å‹•\r\n            val bufferSizeInBytes = AudioRecord.getMinBufferSize(SAMPLE_RATE, AudioFormat.CHANNEL_IN_STEREO, AudioFormat.ENCODING_PCM_16BIT)\r\n            val audioFormat = AudioFormat.Builder().apply {\r\n                setEncoding(AudioFormat.ENCODING_PCM_16BIT)\r\n                setSampleRate(SAMPLE_RATE)\r\n                setChannelMask(AudioFormat.CHANNEL_IN_STEREO)\r\n            }.build()\r\n            audioRecord = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n                AudioRecord.Builder().apply {\r\n                    setAudioFormat(audioFormat)\r\n                    setAudioSource(MediaRecorder.AudioSource.MIC)\r\n                    setBufferSizeInBytes(bufferSizeInBytes)\r\n                }.build()\r\n            } else {\r\n                AudioRecord(MediaRecorder.AudioSource.MIC, SAMPLE_RATE, AudioFormat.CHANNEL_IN_STEREO, AudioFormat.ENCODING_PCM_16BIT, bufferSizeInBytes)\r\n            }.apply { startRecording() }\r\n\r\n            // TODO ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•\r\n        }\r\n    }\r\n```\r\n\r\n# ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®å‡¦ç†ã‚’æ›¸ã ( MediaCodec )\r\néŸ³å£°ã¨æ˜ åƒã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ï¼ˆMediaCodecã‚’ä½¿ã„ã‚„ã™ãã—ãŸã ã‘ï¼‰ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€**ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ï¼ï¼ï¼**  \r\nã¡ãªã¿ã«`ãœã‚ã¿ã‚‰ãƒ¼`ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ããŸã‚‚ã®ã§ã™ã€‚  \r\nhttps://github.com/takusan23/ZeroMirror/tree/master/app/src/main/java/io/github/takusan23/zeromirror/media\r\n\r\n## éŸ³å£°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\néŸ³å£°ãŒé«˜ããªã‚‹ã®ã¯ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆãŒ`AudioRecord`ã¨`MediaCodec`ã§ä¸€è‡´ã—ã¦ãªã„ã‹ã‚‰ã§ã—ãŸï¼Ÿ  \r\néŸ³å£°ã®å ´åˆã¯ãƒãƒƒãƒ•ã‚¡ãƒ¼ã‚’ãã®ã¾ã¾ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã¸æ¸¡ã™ã“ã¨ã§ã€ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒãƒƒãƒ•ã‚¡ãƒ¼ã‚’è¿”ã—ã¦ãã‚Œã¾ã™ã€‚\r\n\r\nè©³ã—ã„å‹•ä½œã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\n/**\r\n * éŸ³å£°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n * MediaCodecã‚’ä½¿ã„ã‚„ã™ãã—ãŸã ã‘\r\n */\r\nclass AudioEncoder {\r\n\r\n    /** MediaCodec ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ */\r\n    private var mediaCodec: MediaCodec? = null\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n     *\r\n     * @param sampleRate ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ\r\n     * @param channelCount ãƒãƒ£ãƒ³ãƒãƒ«æ•°\r\n     * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ\r\n     */\r\n    fun prepareEncoder(\r\n        sampleRate: Int = 48_000,\r\n        channelCount: Int = 2,\r\n        bitRate: Int = 192_000,\r\n    ) {\r\n        val audioEncodeFormat = MediaFormat.createAudioFormat(MediaFormat.MIMETYPE_AUDIO_OPUS, sampleRate, channelCount).apply {\r\n            setInteger(MediaFormat.KEY_AAC_PROFILE, MediaCodecInfo.CodecProfileLevel.AACObjectLC)\r\n            setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n        }\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ç”¨æ„\r\n        mediaCodec = MediaCodec.createEncoderByType(MediaFormat.MIMETYPE_AUDIO_OPUS).apply {\r\n            configure(audioEncodeFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’é–‹å§‹ã™ã‚‹ã€‚åŒæœŸãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã®ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’ä½¿ã„ã¾ã™ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚è‰¯ã„ã‘ã©ï¼‰\r\n     *\r\n     * @param onRecordInput ByteArrayã‚’æ¸¡ã™ã®ã§ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã€ã‚µã‚¤ã‚ºã‚’è¿”ã—ã¦ãã ã•ã„\r\n     * @param onOutputBufferAvailable ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæµã‚Œã¦ãã¾ã™\r\n     * @param onOutputFormatAvailable ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®MediaFormatãŒå…¥æ‰‹ã§ãã‚‹\r\n     */\r\n    suspend fun startAudioEncode(\r\n        onRecordInput: (ByteArray) -> Int,\r\n        onOutputBufferAvailable: (ByteBuffer, MediaCodec.BufferInfo) -> Unit,\r\n        onOutputFormatAvailable: (MediaFormat) -> Unit,\r\n    ) = withContext(Dispatchers.Default) {\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n        mediaCodec!!.start()\r\n\r\n        try {\r\n            while (isActive) {\r\n                // ã‚‚ã— -1 ãŒè¿”ã£ã¦ãã‚Œã° configure() ãŒé–“é•ã£ã¦ã‚‹\r\n                val inputBufferId = mediaCodec!!.dequeueInputBuffer(TIMEOUT_US)\r\n                if (inputBufferId >= 0) {\r\n                    // AudioRecodeã®ãƒ‡ãƒ¼ã‚¿ã‚’ã“ã®ä¸­ã«å…¥ã‚Œã‚‹\r\n                    val inputBuffer = mediaCodec!!.getInputBuffer(inputBufferId)!!\r\n                    val capacity = inputBuffer.capacity()\r\n                    // ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ä½œæˆ\r\n                    val byteArray = ByteArray(capacity)\r\n                    // byteArrayã¸ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã‚‚ã‚‰ã†\r\n                    val readByteSize = onRecordInput(byteArray)\r\n                    if (readByteSize > 0) {\r\n                        // æ›¸ãè¾¼ã‚€ã€‚æ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã¯[onOutputBufferAvailable]ã§å—ã‘å–ã‚Œã‚‹\r\n                        inputBuffer.put(byteArray, 0, readByteSize)\r\n                        // å¤šåˆ† Surfaceã§æ˜ åƒã‚’å…¥åŠ›ã—ãŸå ´åˆã€presentationTimeUs ã¯ nanoTime ã‚’ 1000 ã§å‰²ã£ãŸå€¤ã£ã½ã„\r\n                        mediaCodec!!.queueInputBuffer(inputBufferId, 0, readByteSize, System.nanoTime() / 1000, 0)\r\n                    }\r\n                }\r\n                // å‡ºåŠ›\r\n                val outputBufferId = mediaCodec!!.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (outputBufferId >= 0) {\r\n                    val outputBuffer = mediaCodec!!.getOutputBuffer(outputBufferId)!!\r\n                    if (bufferInfo.size > 1) {\r\n                        if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_CODEC_CONFIG == 0) {\r\n                            // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€...\r\n                            onOutputBufferAvailable(outputBuffer, bufferInfo)\r\n                        }\r\n                    }\r\n                    // è¿”å´\r\n                    mediaCodec!!.releaseOutputBuffer(outputBufferId, false)\r\n                } else if (outputBufferId == MediaCodec.INFO_OUTPUT_FORMAT_CHANGED) {\r\n                    // MediaFormatã€MediaMuxerã«å…¥ã‚Œã‚‹ã¨ãã«ä½¿ã†ã‚„ã¤\r\n                    // ãŸã¶ã‚“ã“ã£ã¡ã®ã»ã†ãŒå…ˆã«å‘¼ã°ã‚Œã‚‹\r\n                    onOutputFormatAvailable(mediaCodec!!.outputFormat)\r\n                }\r\n            }\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        }\r\n    }\r\n\r\n    /** ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹æ”¾ã™ã‚‹ */\r\n    fun release() {\r\n        try {\r\n            mediaCodec?.stop()\r\n            mediaCodec?.release()\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** MediaCodec ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n        private const val TIMEOUT_US = 10_000L\r\n\r\n    }\r\n}\r\n```\r\n## æ˜ åƒã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\næ˜ åƒã®å ´åˆã¯ã€`Surface`ã‚’çµŒç”±ã—ã¦æ˜ åƒã‚’æ¸¡ã—ã¾ã™ã€‚  \r\n`Camera X`ã‚’ä½¿ã‚ãªã„ç†ç”±ãŒã“ã“ã«ã‚ã‚Šã¾ã™ã€‚`MediaCodec`ã¸`Surface`çµŒç”±ã§æ˜ åƒã‚’æ¸¡ã—ãŸã‹ã£ãŸã‹ã‚‰ã§ã™ã€‚  \r\nãªã‚“ã‹`Camera X`ã ã¨`Surface`ã§æ˜ åƒãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã§ããªã„ã£ã½ã„ã€‚`Camera X`ã«ã¯ä»£ã‚ã‚Šã«ç”»åƒã‚’å–å¾—ã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã¿ãŸã„ã€‚  \r\nç”»åƒã®å ´åˆã ã¨`Bitmap`ã‚’`MediaCodec`ã®ãƒãƒƒãƒ•ã‚¡ãƒ¼ã¸å…¥ã‚Œã‚‹ã‹ï¼ˆã‚„ã£ãŸã“ã¨ç„¡ã„ã‘ã©å‡ºæ¥ãªãã‚‚ãªã„ã‚‰ã—ã„ï¼Ÿï¼‰ã€  \r\n`MediaCodec`ã®`Surface`ã¸`Bitmap`ã‚’æç”»ã™ã‚‹ï¼Ÿ  \r\nï¼ˆãŸã ã—`MediaCodec#createInputSurface()`ã¯`SurfaceView`ã¨é•ã£ã¦å¤šåˆ†`Surface#lockCanvas()`ãŒä½¿ãˆãªã„ãŸã‚ã€`OpenGL ES`ã‚’ä½¿ã†å¿…è¦ãŒã‚ã‚Šã“ã‚Œã‚‚ãã£ã£ãé¢å€’ï¼‰\r\n\r\nãªã®ã§æ˜ åƒãƒ‡ãƒ¼ã‚¿ã‚’`Surface`çµŒç”±ã§è²°ãˆã‚‹ã€`Camera 2 API`ã‚’ä½¿ã†å¿…è¦ãŒã‚ã£ãŸã®ã§ã™ã­ã€‚  \r\nã“ã¡ã‚‰ã‚‚è©³ã—ã„å‹•ä½œã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¦‹ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\n/**\r\n * å‹•ç”»ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n * MediaCodecã‚’ä½¿ã„ã‚„ã™ãã—ãŸã ã‘\r\n *\r\n * VP9ã®å ´åˆã¯ç”»é¢è§£åƒåº¦ãŒå³ã—ã„ï¼Ÿ\r\n * 1920x1080 1280x720 ã¨ã‹ãªã‚‰å•é¡Œãªã„ã‘ã©ã€ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®ç”»é¢è§£åƒåº¦ã‚’å…¥ã‚Œã‚‹ã¨ä¾‹å¤–ã‚’åãï¼Ÿ\r\n */\r\nclass VideoEncoder {\r\n\r\n    /** MediaCodec ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ */\r\n    private var mediaCodec: MediaCodec? = null\r\n\r\n    /** MediaCodecã®å…¥åŠ›Surface */\r\n    private var inputSurface: Surface? = null\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n     *\r\n     * @param videoWidth å‹•ç”»ã®å¹…\r\n     * @param videoHeight å‹•ç”»ã®é«˜ã•\r\n     * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ\r\n     * @param frameRate ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¬ãƒ¼ãƒˆ\r\n     * @param iFrameInterval Iãƒ•ãƒ¬ãƒ¼ãƒ \r\n     */\r\n    fun prepareEncoder(\r\n        videoWidth: Int,\r\n        videoHeight: Int,\r\n        bitRate: Int,\r\n        frameRate: Int,\r\n        iFrameInterval: Int = 1,\r\n    ) {\r\n        // ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®é¸æŠ\r\n        // ã‚‚ã—é‡ããªã‚‹ã‚ˆã†ãªã‚‰ã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ VP8 ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„\r\n        // ãã®å ´åˆã€MPEG-DASHã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§ã‚‚ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ vp8 ã«ã™ã‚‹å¿…è¦ã‚ã‚Š\r\n        val videoEncodeFormat = MediaFormat.createVideoFormat(MediaFormat.MIMETYPE_VIDEO_VP9, videoWidth, videoHeight).apply {\r\n            setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n            setInteger(MediaFormat.KEY_FRAME_RATE, frameRate)\r\n            setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, iFrameInterval)\r\n            setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface)\r\n        }\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ç”¨æ„\r\n        mediaCodec = MediaCodec.createEncoderByType(MediaFormat.MIMETYPE_VIDEO_VP9).apply {\r\n            configure(videoEncodeFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * å…¥åŠ›ã§ä½¿ã†Surfaceã‚’ç”¨æ„ã™ã‚‹ã€‚\r\n     * [prepareEncoder]ã®å¾Œã«å‘¼ã°ãªã„ã¨ã ã‚ã€‚\r\n     *\r\n     * @return å…¥åŠ›ã§ä½¿ã†Surface\r\n     */\r\n    fun createInputSurface() = mediaCodec!!.createInputSurface().apply {\r\n        inputSurface = this\r\n    }\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’é–‹å§‹ã™ã‚‹ã€‚åŒæœŸãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã®ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’ä½¿ã„ã¾ã™ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚è‰¯ã„ã‘ã©ï¼‰\r\n     *\r\n     * @param onOutputBufferAvailable ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæµã‚Œã¦ãã¾ã™\r\n     * @param onOutputFormatAvailable ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®MediaFormatãŒå…¥æ‰‹ã§ãã‚‹\r\n     */\r\n    suspend fun startVideoEncode(\r\n        onOutputBufferAvailable: (ByteBuffer, MediaCodec.BufferInfo) -> Unit,\r\n        onOutputFormatAvailable: (MediaFormat) -> Unit,\r\n    ) = withContext(Dispatchers.Default) {\r\n        // å¤šåˆ†ä½¿ã„å›ã™\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n        mediaCodec?.start()\r\n\r\n        try {\r\n            while (isActive) {\r\n                // ã‚‚ã— -1 ãŒè¿”ã£ã¦ãã‚Œã° configure() ãŒé–“é•ã£ã¦ã‚‹\r\n                val outputBufferId = mediaCodec!!.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (outputBufferId >= 0) {\r\n                    val outputBuffer = mediaCodec!!.getOutputBuffer(outputBufferId)!!\r\n                    if (bufferInfo.size > 1) {\r\n                        if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_CODEC_CONFIG == 0) {\r\n                            // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€...\r\n                            onOutputBufferAvailable(outputBuffer, bufferInfo)\r\n                        }\r\n                    }\r\n                    // è¿”å´\r\n                    mediaCodec!!.releaseOutputBuffer(outputBufferId, false)\r\n                } else if (outputBufferId == MediaCodec.INFO_OUTPUT_FORMAT_CHANGED) {\r\n                    // å¤šåˆ†æ˜ åƒãƒ‡ãƒ¼ã‚¿ã‚ˆã‚Šå…ˆã«å‘¼ã°ã‚Œã‚‹\r\n                    // MediaMuxerã¸æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹ã®ã¯ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§è¡Œã†\r\n                    // ã“ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§ã‚„ã‚‹ã¨å›ºæœ‰ã®ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼ãŒã‚»ãƒƒãƒˆã•ã‚ŒãŸMediaFormatãŒæ‰‹ã«å…¥ã‚‹(csd-0 ã¨ã‹)\r\n                    // æ˜ åƒãŒã¶ã£å£Šã‚Œã¦ã„ã‚‹å ´åˆï¼ˆç·‘ã§å¡—ã‚Šã¤ã¶ã•ã‚Œã¦ã‚‹ã¨ã‹ï¼‰ã¯å¤šåˆ†ã“ã®ã‚ãŸã‚ŠãŒæ€ªã—ã„\r\n                    onOutputFormatAvailable(mediaCodec!!.outputFormat)\r\n                }\r\n            }\r\n        } catch (e: Exception) {\r\n            // ãªãœã‹ä¾‹å¤–ã‚’åãã®ã§\r\n            // java.lang.IllegalStateException\r\n            // at android.media.MediaCodec.native_dequeueOutputBuffer(Native Method)\r\n            e.printStackTrace()\r\n        }\r\n    }\r\n\r\n    /** ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹æ”¾ã™ã‚‹ */\r\n    fun release() {\r\n        try {\r\n            inputSurface?.release()\r\n            mediaCodec?.stop()\r\n            mediaCodec?.release()\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** MediaCodec ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n        private const val TIMEOUT_US = 10_000L\r\n\r\n    }\r\n}\r\n```\r\n\r\n## ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’çµ„ã¿è¾¼ã‚€\r\n`MainActivity.kt`ã«æ›¸ã„ãŸã‚«ãƒ¡ãƒ©ã¨ãƒã‚¤ã‚¯ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®éƒ¨åˆ†ã‚’åŸ‹ã‚ã¾ã™\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** å‹•ç”»ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ */\r\n    private val videoEncoder = VideoEncoder()\r\n\r\n    /** éŸ³å£°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ */\r\n    private val audioEncoder = AudioEncoder()\r\n\r\n    // çœç•¥\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ */\r\n    private fun setupCameraAndEncoder() {\r\n        // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’æ´»ç”¨ã—ã¦ã„ã\r\n        lifecycleScope.launch {\r\n            val holder = viewBinding.previewSurfaceView.holder\r\n            val cameraDevice = suspendOpenCamera()\r\n            this@MainActivity.cameraDevice = cameraDevice\r\n\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n            videoEncoder.prepareEncoder(\r\n                videoWidth = 1280,\r\n                videoHeight = 720,\r\n                bitRate = 1_000_000,\r\n                frameRate = 30,\r\n            )\r\n            // Camera2 API ã‹ã‚‰ MediaCodec ã¸æ˜ åƒã‚’æ¸¡ã™ãŸã‚ã® Surface\r\n            val inputSurface = videoEncoder.createInputSurface()\r\n            \r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã€å‹•ä½œä¸­ã¯ä¸€æ™‚åœæ­¢ã™ã‚‹ã®ã§åˆ¥ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’èµ·å‹•\r\n            launch {\r\n                videoEncoder.startVideoEncode(\r\n                    onOutputBufferAvailable = { byteBuffer, bufferInfo ->\r\n                        // TODO WebMä¿å­˜å‡¦ç†\r\n                    },\r\n                    onOutputFormatAvailable = { mediaFormat ->\r\n                        // TODO WebMä¿å­˜å‡¦ç†\r\n                    }\r\n                )\r\n            }\r\n\r\n            // å‡ºåŠ›å…ˆSurfaceã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n            val outputSurfaceList = listOf(holder.surface, inputSurface)\r\n            // ã‚«ãƒ¡ãƒ©ã®è¨­å®šã‚’ã™ã‚‹\r\n            val captureRequest = cameraDevice.createCaptureRequest(CameraDevice.TEMPLATE_RECORD).apply {\r\n                outputSurfaceList.forEach {\r\n                    addTarget(it)\r\n                }\r\n            }.build()\r\n\r\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.P) {\r\n                val outputList = buildList {\r\n                    outputSurfaceList.forEach {\r\n                        add(OutputConfiguration(it))\r\n                    }\r\n                }\r\n                SessionConfiguration(SessionConfiguration.SESSION_REGULAR, outputList, cameraExecutor, object : CameraCaptureSession.StateCallback() {\r\n                    override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                        captureSession.setRepeatingRequest(captureRequest, null, null)\r\n                    }\r\n\r\n                    override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n\r\n                    }\r\n                }).apply { cameraDevice.createCaptureSession(this) }\r\n            } else {\r\n                cameraDevice.createCaptureSession(outputSurfaceList, object : CameraCaptureSession.StateCallback() {\r\n                    override fun onConfigured(captureSession: CameraCaptureSession) {\r\n                        captureSession.setRepeatingRequest(captureRequest, null, null)\r\n                    }\r\n\r\n                    override fun onConfigureFailed(p0: CameraCaptureSession) {\r\n\r\n                    }\r\n                }, null)\r\n            }\r\n        }\r\n    }\r\n\r\n    /** ãƒã‚¤ã‚¯ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„ */\r\n    @SuppressLint(\"MissingPermission\")\r\n    private fun setupMicAndEncoder() {\r\n        // ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã‚’å›é¿ã™ã‚‹ãŸã‚ã«ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’æ´»ç”¨ã—ã¦ã„ã\r\n        lifecycleScope.launch {\r\n\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n            audioEncoder.prepareEncoder(\r\n                sampleRate = SAMPLE_RATE,\r\n                channelCount = 2,\r\n                bitRate = 192_000,\r\n            )\r\n\r\n            // éŸ³å£°ãƒ¬ã‚³ãƒ¼ãƒ€ãƒ¼èµ·å‹•\r\n            val bufferSizeInBytes = AudioRecord.getMinBufferSize(SAMPLE_RATE, AudioFormat.CHANNEL_IN_STEREO, AudioFormat.ENCODING_PCM_16BIT)\r\n            val audioFormat = AudioFormat.Builder().apply {\r\n                setEncoding(AudioFormat.ENCODING_PCM_16BIT)\r\n                setSampleRate(SAMPLE_RATE)\r\n                setChannelMask(AudioFormat.CHANNEL_IN_STEREO)\r\n            }.build()\r\n            audioRecord = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n                AudioRecord.Builder().apply {\r\n                    setAudioFormat(audioFormat)\r\n                    setAudioSource(MediaRecorder.AudioSource.MIC)\r\n                    setBufferSizeInBytes(bufferSizeInBytes)\r\n                }.build()\r\n            } else {\r\n                AudioRecord(MediaRecorder.AudioSource.MIC, SAMPLE_RATE, AudioFormat.CHANNEL_IN_STEREO, AudioFormat.ENCODING_PCM_16BIT, bufferSizeInBytes)\r\n            }.apply { startRecording() }\r\n\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã€å‹•ä½œä¸­ã¯ä¸€æ™‚åœæ­¢ã™ã‚‹ã®ã§åˆ¥ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’èµ·å‹•\r\n            launch {\r\n                // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n                audioEncoder.startAudioEncode(\r\n                    onRecordInput = { bytes ->\r\n                        // PCMéŸ³å£°ã‚’å–ã‚Šå‡ºã—ã‚¨ãƒ³ã‚³ã™ã‚‹\r\n                        audioRecord.read(bytes, 0, bytes.size)\r\n                    },\r\n                    onOutputBufferAvailable = { byteBuffer, bufferInfo ->\r\n                        // TODO WebMä¿å­˜å‡¦ç†\r\n                    },\r\n                    onOutputFormatAvailable = { mediaFormat ->\r\n                        // TODO WebMä¿å­˜å‡¦ç†\r\n                    }\r\n                )\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n# WebMã«ä¿å­˜ã—ã¤ã¤ã€MPEG-DASHã§é…ä¿¡å¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹\r\n`MediaMuxer`ã«ä¿å­˜ã—ã¤ã¤ã€`MPEG-DASH`ã§é…ä¿¡ã§ãã‚‹`webm`ã‚‚ä½œã£ã¦ã„ãã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n## MediaMuxerã«ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ†å‰²ã™ã‚‹æ©Ÿèƒ½ã¯ãªã„ã®ã§...\r\n`MediaMuxer`ã§æ›¸ãè¾¼ã¿ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¾ã™ï¼ï¼ˆå¤šåˆ†ã‚ˆããªã„ï¼‰  \r\n`WebM`ã‚’ä½œã‚‹å‡¦ç†ï¼ˆãƒãƒ«ãƒãƒ—ãƒ¬ã‚¯ã‚µï¼‰ã¨ã‹çµ¶å¯¾å¤§å¤‰ã ã¨æ€ã†....\r\n\r\n```kotlin\r\n// ãŸã¨ãˆã°...\r\nval tempFile = File(\"ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹\")\r\nval mediaMuxer = MediaMuxer(tempFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_WEBM)\r\nval inputStream = tempFile.inputStream()\r\n\r\n// ã‚ˆã—ãªã«ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\nval segmentFile = File(\"segment.webm\")\r\n// å‰å›ã¾ã§ã®ç¯„å›²ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦åˆ‡ã‚Šå‡ºã™\r\ninputStream.also { stream ->\r\n    val byteArray = ByteArray(stream.available())\r\n    stream.read(byteArray)\r\n    segmentFile.writeBytes(byteArray)\r\n}\r\n```\r\n\r\næ›¸ãè¾¼ã¿ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰æ›´ã«å®šæœŸçš„ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ä¿å­˜ã™ã‚‹ãŸã‚ã€äºŒå€ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã„ã¾ã™ã€‚  \r\nã©ã†ã«ã‹ã—ãŸã„\r\n\r\n\r\n## é€£ç•ªãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ãã‚Œã‚‹ã‚¯ãƒ©ã‚¹\r\n`segment1.webm`ã€`segment2.webm`.... ã¿ãŸã„ã«é€£ç•ªã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ãã‚Œã‚‹ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã¾ã™ã€‚  \r\nãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã€ãªã‚“ã¨ãªã`suspendé–¢æ•°`ã«ã—ã¦ã„ã‚‹ã€‚  \r\n`++`æ¼”ç®—å­ã€`swift`ã ã¨ç„¡ã„ã‚‰ã—ã„ã§ã™ã­ï¼Ÿ\r\n\r\n```kotlin\r\n/**\r\n * MPEG-DASH ç”¨ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¯ãƒ©ã‚¹\r\n *\r\n * - [parentFolder]\r\n *  - public\r\n *      - ç”Ÿæˆã—ãŸå‹•ç”»ã‚’å…¥ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ã—ã¦ã‚‹å‹•ç”»ã§ã™\r\n *  - temp\r\n *      - ä¸€æ™‚çš„ã«ä¿å­˜ã™ã‚‹å¿…è¦ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«\r\n *\r\n * @param parentFolder ä¿å­˜å…ˆ\r\n * @param prefixName ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ã¤ã‘ã‚‹æ–‡å­—åˆ—\r\n */\r\nclass DashContentManager(\r\n    private val parentFolder: File,\r\n    private val prefixName: String,\r\n) {\r\n    /** ä½œã‚‹ãŸã³ã«ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆã™ã‚‹ */\r\n    private var count = 0\r\n\r\n    /** ä¸€æ™‚ä½œæ¥­ç”¨ãƒ•ã‚©ãƒ«ãƒ€ */\r\n    private val tempFolder = File(parentFolder, TEMP_FOLDER_NAME).apply { mkdir() }\r\n\r\n    /** å®Œæˆå“ã‚’å…¬é–‹ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ */\r\n    val outputFolder = File(parentFolder, OUTPUT_VIDEO_FOLDER_NAME).apply { mkdir() }\r\n\r\n    /**\r\n     * é€£ç•ªãªãƒ•ã‚¡ã‚¤ãƒ«åã«ãªã£ãŸ[File]ã‚’ä½œæˆã™ã‚‹\r\n     *\r\n     * @return [File]\r\n     */\r\n    suspend fun createIncrementFile() = withContext(Dispatchers.IO) {\r\n        File(outputFolder, \"$prefixName${count++}.$WEBM_EXTENSION\").apply {\r\n            createNewFile()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°ã€‚\r\n     * ãƒ•ã‚¡ã‚¤ãƒ«åå¤‰æ›´ãŒå‡ºæ¥ã‚‹ä»¥å¤–ã¯ [createIncrementFile] ã¨åŒã˜ã€‚\r\n     *\r\n     * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     * @return [File]\r\n     */\r\n    suspend fun createFile(fileName: String) = withContext(Dispatchers.IO) {\r\n        File(outputFolder, fileName).apply {\r\n            createNewFile()\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°\r\n     *\r\n     * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     * @return [File]\r\n     */\r\n    suspend fun createTempFile(fileName: String) = withContext(Dispatchers.IO) {\r\n        File(tempFolder, fileName).apply {\r\n            createNewFile()\r\n        }\r\n    }\r\n\r\n    /** ç”Ÿæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã™ã‚‹ */\r\n    suspend fun deleteGenerateFile() = withContext(Dispatchers.IO) {\r\n        tempFolder.listFiles()?.forEach { it.delete() }\r\n        outputFolder.listFiles()?.forEach { it.delete() }\r\n    }\r\n\r\n    companion object {\r\n        /** æ‹¡å¼µå­ */\r\n        private const val WEBM_EXTENSION = \"webm\"\r\n\r\n        /** å®Œæˆå“ã®å‹•ç”»ãŒå…¥ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã®åå‰ */\r\n        private const val OUTPUT_VIDEO_FOLDER_NAME = \"dist\"\r\n\r\n        /** ä¸€æ™‚ä½œæ¥­ç”¨ãƒ•ã‚©ãƒ«ãƒ€ */\r\n        private const val TEMP_FOLDER_NAME = \"temp\"\r\n    }\r\n\r\n}\r\n```\r\n\r\n## ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚¯ãƒ©ã‚¹\r\n`WebM`ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸ`VP9`ã€`Opus`ã‚’æ›¸ãè¾¼ã¿ã¤ã¤ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã§ãã‚‹ã‚¯ãƒ©ã‚¹ã‚’æ›¸ãã¾ã™ã€‚  \r\n`MediaMuxer`ã«æ›¸ãè¾¼ã‚“ã§ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰éƒ¨åˆ†çš„ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã“ã¨ã§ã€`MPEG-DASH`ã§å†ç”Ÿã™ã‚‹ãŸã‚ã®ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚  \r\n\r\n```kotlin\r\n/**\r\n * MPEG-DASHã§é…ä¿¡ã™ã‚‹ WebM ã‚’ä½œæˆã™ã‚‹ã€‚\r\n * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚³ãƒ³ãƒ†ãƒŠï¼‰ã«æ›¸ãè¾¼ã‚€ã€‚\r\n *\r\n * @param tempFile ä¸€æ™‚ãƒ•ã‚¡ã‚¤ãƒ«ã€‚\r\n */\r\nclass DashContainerWriter(private val tempFile: File) {\r\n\r\n    /** ã‚³ãƒ³ãƒ†ãƒŠã¸æ›¸ãè¾¼ã‚€ã‚„ã¤ */\r\n    private var mediaMuxer: MediaMuxer? = null\r\n\r\n    /** ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªãƒˆãƒ©ãƒƒã‚¯ã®ç•ªå· */\r\n    private var audioTrackIndex = INVALID_INDEX_NUMBER\r\n\r\n    /** æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã®ç•ªå· */\r\n    private var videoTrackIndex = INVALID_INDEX_NUMBER\r\n\r\n    /** ã‚ªãƒ¼ãƒ‡ã‚£ã‚ªã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ */\r\n    private var audioFormat: MediaFormat? = null\r\n\r\n    /** æ˜ åƒã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ */\r\n    private var videoFormat: MediaFormat? = null\r\n\r\n    /** æ›¸ãè¾¼ã¿å¯èƒ½ã‹ã©ã†ã‹ */\r\n    private var isWritable = true\r\n\r\n    /** MediaMuxerã§æ›¸ãè¾¼ã‚“ã§ã„ã‚‹å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã® [InputStream]ã€ãã®éƒ½åº¦é–‹ãã‚ˆã‚Šè‰¯ã•ãã† */\r\n    private var inputStream: InputStream? = null\r\n\r\n    /** MediaMuxer èµ·å‹•ä¸­ã®å ´åˆã¯true */\r\n    var isRunning = false\r\n        private set\r\n\r\n    /** åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ä½œæˆã—ãŸã‹ */\r\n    var isGeneratedInitSegment = false\r\n        private set\r\n\r\n    /** ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ / MediaMuxer ã‚’ç”Ÿæˆã™ã‚‹ */\r\n    suspend fun createContainerFile() = withContext(Dispatchers.IO) {\r\n        tempFile.delete()\r\n        isGeneratedInitSegment = false\r\n        mediaMuxer = MediaMuxer(tempFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_WEBM)\r\n        inputStream = tempFile.inputStream()\r\n        // å†ç”Ÿæˆã™ã‚‹å ´åˆã¯ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼æŒã£ã¦ã„ã‚‹ã®ã§å…¥ã‚Œã¦ãŠã\r\n        videoFormat?.also { setVideoTrack(it) }\r\n        audioFormat?.also { setAudioTrack(it) }\r\n    }\r\n\r\n    /**\r\n     * MediaMuxerã§æ›¸ãè¾¼ã¿ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€WebMã®åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®éƒ¨åˆ†ã‚’åˆ‡ã‚Šå‡ºã™ã€‚\r\n     * åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ä½ç½®ã¯ Clusterã‚¿ã‚° ãŒå§‹ã¾ã‚‹å‰ã¾ã§\r\n     *\r\n     * @param filePath æ›¸ãè¾¼ã¿å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹\r\n     * @return ãƒ•ã‚¡ã‚¤ãƒ«\r\n     */\r\n    suspend fun sliceInitSegmentFile(filePath: String) = withContext(Dispatchers.IO) {\r\n        File(filePath).also { file ->\r\n            // æ›¸ãè¾¼ã¾ã‚Œãªã„ã‚ˆã†ã«ã—ã¦ãŠã\r\n            isWritable = false\r\n            val readRecordFile = tempFile.readBytes()\r\n            // åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ç¯„å›²ã‚’æ¢ã™\r\n            // ãã‚Œã„ãªå®Ÿè£…ã˜ã‚ƒãªã„...\r\n            var initSegmentLength = -1\r\n            for (i in readRecordFile.indices) {\r\n                if (\r\n                    readRecordFile[i] == 0x1F.toByte()\r\n                    && readRecordFile[i + 1] == 0x43.toByte()\r\n                    && readRecordFile[i + 2] == 0xB6.toByte()\r\n                    && readRecordFile[i + 3] == 0x75.toByte()\r\n                ) {\r\n                    initSegmentLength = i\r\n                    break\r\n                }\r\n            }\r\n            if (initSegmentLength == -1) {\r\n                return@withContext\r\n            }\r\n            // åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’æ›¸ãè¾¼ã‚€\r\n            file.writeBytes(readRecordFile.copyOfRange(0, initSegmentLength))\r\n            // èª­ã¿å‡ºã—ãŸä½ç½®åˆ†ã‚¹ã‚­ãƒƒãƒ—\r\n            inputStream?.skip(initSegmentLength.toLong())\r\n            // æ›¸ãè¾¼ã¿å¯ã«ã™ã‚‹\r\n            isWritable = true\r\n            isGeneratedInitSegment = true\r\n        }\r\n    }\r\n\r\n    /**\r\n     * MediaMuxerã§æ›¸ãè¾¼ã¿ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€å‰å›åˆ‡ã‚Šå‡ºã—ãŸç¯„å›²ã‹ã‚‰ä»Šæ›¸ãè¾¼ã¿ä¸­ã®ç¯„å›²ã¾ã§ã‚’åˆ‡ã‚Šå‡ºã™ã€‚\r\n     * å‰å›åˆ‡ã‚Šå‡ºã—ãŸç¯„å›²ã¯[sliceInitSegmentFile]ã‚‚å¯¾è±¡ã€‚\r\n     *\r\n     * @param filePath æ›¸ãè¾¼ã¿å…ˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹\r\n     * @return ãƒ•ã‚¡ã‚¤ãƒ«\r\n     */\r\n    suspend fun sliceSegmentFile(filePath: String) = withContext(Dispatchers.IO) {\r\n        File(filePath).also { file ->\r\n            // æ›¸ãè¾¼ã¾ã‚Œãªã„ã‚ˆã†ã«ã—ã¦ãŠã\r\n            isWritable = false\r\n            // å‰å›ã¾ã§ã®ç¯„å›²ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¦åˆ‡ã‚Šå‡ºã™\r\n            inputStream?.also { stream ->\r\n                val byteArray = ByteArray(stream.available())\r\n                stream.read(byteArray)\r\n                file.writeBytes(byteArray)\r\n            }\r\n            // æ›¸ãè¾¼ã¿å¯ã«ã™ã‚‹\r\n            isWritable = true\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹\r\n     *\r\n     * @param mediaFormat æ˜ åƒãƒˆãƒ©ãƒƒã‚¯ã®æƒ…å ±\r\n     */\r\n    fun setVideoTrack(mediaFormat: MediaFormat) {\r\n        // MediaMuxer é–‹å§‹å‰ã®ã¿è¿½åŠ ã§ãã‚‹ã®ã§\r\n        if (!isRunning) {\r\n            videoTrackIndex = mediaMuxer!!.addTrack(mediaFormat)\r\n        }\r\n        videoFormat = mediaFormat\r\n    }\r\n\r\n    /**\r\n     * éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹\r\n     *\r\n     * @param mediaFormat éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã®æƒ…å ±\r\n     */\r\n    fun setAudioTrack(mediaFormat: MediaFormat) {\r\n        // MediaMuxer é–‹å§‹å‰ã®ã¿è¿½åŠ ã§ãã‚‹ã®ã§\r\n        if (!isRunning) {\r\n            audioTrackIndex = mediaMuxer!!.addTrack(mediaFormat)\r\n        }\r\n        audioFormat = mediaFormat\r\n    }\r\n\r\n    /**\r\n     * æ›¸ãè¾¼ã¿ã‚’é–‹å§‹ã•ã›ã‚‹ã€‚\r\n     * ã“ã‚Œä»¥é™ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆç™»éŒ²ã‚’å—ã‘ä»˜ã‘ãªã„ã®ã§ã€ãƒ•ã‚¡ã‚¤ãƒ«å†ç”Ÿæˆã¾ã§ç™»éŒ²ã•ã‚Œã¾ã›ã‚“ [createContainerFile]\r\n     */\r\n    fun start() {\r\n        if (!isRunning) {\r\n            mediaMuxer?.start()\r\n            isRunning = true\r\n        }\r\n    }\r\n\r\n    /**\r\n     * æ˜ åƒãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€\r\n     *\r\n     * @param byteBuf MediaCodec ã‹ã‚‰ã‚‚ã‚‰ãˆã‚‹ã‚„ã¤\r\n     * @param bufferInfo MediaCodec ã‹ã‚‰ã‚‚ã‚‰ãˆã‚‹ã‚„ã¤\r\n     */\r\n    fun writeVideo(byteBuffer: ByteBuffer, bufferInfo: MediaCodec.BufferInfo) {\r\n        if (isRunning && videoTrackIndex != INVALID_INDEX_NUMBER && isWritable) {\r\n            mediaMuxer?.writeSampleData(videoTrackIndex, byteBuffer, bufferInfo)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€\r\n     *\r\n     * @param byteBuf MediaCodec ã‹ã‚‰ã‚‚ã‚‰ãˆã‚‹ã‚„ã¤\r\n     * @param bufferInfo MediaCodec ã‹ã‚‰ã‚‚ã‚‰ãˆã‚‹ã‚„ã¤\r\n     */\r\n    fun writeAudio(byteBuffer: ByteBuffer, bufferInfo: MediaCodec.BufferInfo) {\r\n        if (isRunning && audioTrackIndex != INVALID_INDEX_NUMBER && isWritable) {\r\n            mediaMuxer?.writeSampleData(audioTrackIndex, byteBuffer, bufferInfo)\r\n        }\r\n    }\r\n\r\n    /** ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾ */\r\n    fun release() {\r\n        // èµ·å‹•ã—ã¦ã„ãªã‘ã‚Œã°çµ‚äº†ã‚‚ã•ã›ãªã„\r\n        if (isRunning) {\r\n            mediaMuxer?.stop()\r\n            mediaMuxer?.release()\r\n        }\r\n        isRunning = false\r\n        inputStream?.close()\r\n    }\r\n\r\n    companion object {\r\n        /** ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ç•ªå·åˆæœŸå€¤ã€ç„¡åŠ¹ãªå€¤ */\r\n        private const val INVALID_INDEX_NUMBER = -1\r\n    }\r\n\r\n}\r\n```\r\n\r\n## MainActivity.kt ã§ä½¿ã†\r\né€£ç•ªãƒ•ã‚¡ã‚¤ãƒ«ç”Ÿæˆã‚¯ãƒ©ã‚¹ã¨ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆã‚¯ãƒ©ã‚¹ã‚’`MainActivity`ã«æ›¸ã„ã¦ã‚‹ã‚«ãƒ¡ãƒ©ã€ãƒã‚¤ã‚¯ã®éƒ¨åˆ†ã¸çµ„ã¿è¾¼ã¿ã¾ã™ã€‚  \r\næ›¸ãè¾¼ã¿ã‚’å§‹ã‚ã‚‹ã®ã¯é–‹å§‹ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‹ã‚‰ã§ã™ã€‚  \r\n(ActivityãŒãƒ‡ã‚«ããªã£ã¦ã„ã...ã¾ã‚ã„ã£ã‹ï¼)  \r\n\r\nã“ã‚Œã§å®šæœŸçš„ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã¯ãš...\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** å‹•ç”»ã‚³ãƒ³ãƒ†ãƒŠç®¡ç†ã‚¯ãƒ©ã‚¹ */\r\n    private lateinit var dashContainer: DashContainerWriter\r\n\r\n    /** ç”Ÿæˆã—ãŸå‹•ç”»ã‚’ã¾ã¨ã‚ã‚‹ã‚¯ãƒ©ã‚¹ */\r\n    private lateinit var contentManager: DashContentManager\r\n\r\n    /** ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚’è¡Œã† */\r\n    private fun setupAll() {\r\n        lifecycleScope.launch {\r\n            // ã‚«ãƒ¡ãƒ©ã®ç”¨æ„ãªã©\r\n            setupCommon()\r\n            setupCameraAndEncoder()\r\n            setupMicAndEncoder()\r\n        }\r\n    }\r\n\r\n    /** å…±é€šéƒ¨åˆ†ã®åˆæœŸåŒ– */\r\n    private suspend fun setupCommon() {\r\n        // é–‹å§‹ãƒœã‚¿ãƒ³ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆã¨ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹\r\n        viewBinding.startButton.setOnClickListener {\r\n            // TODO Webã‚µãƒ¼ãƒãƒ¼é–‹å§‹\r\n            dashContainer.start()\r\n        }\r\n        // çµ‚äº†ãƒœã‚¿ãƒ³\r\n        viewBinding.stopButton.setOnClickListener {\r\n            // TODO ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾\r\n        }\r\n\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¯ãƒ©ã‚¹\r\n        contentManager = DashContentManager(getExternalFilesDir(null)!!, SEGMENT_FILENAME_PREFIX).apply {\r\n            deleteCreateFile()\r\n        }\r\n        // ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ›¸ãè¾¼ã‚€ã‚¯ãƒ©ã‚¹\r\n        dashContainer = DashContainerWriter(contentManager.createTempFile(\"temp\")).apply {\r\n            createContainerFile()\r\n        }\r\n        \r\n        // TODO Webã‚µãƒ¼ãƒãƒ¼\r\n        \r\n        // WebM ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã€‚MediaMuxerãŒæ›¸ãè¾¼ã‚“ã§ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦åˆ‡ã‚Šå‡ºã—ã¦ä¿å­˜ã™ã‚‹\r\n        lifecycleScope.launch(Dispatchers.Default) {\r\n            while (isActive) {\r\n                if (dashContainer.isRunning) {\r\n                    try {\r\n                        // SEGMENT_INTERVAL_MS å¾…æ©Ÿã—ãŸã‚‰æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«ã«ã™ã‚‹\r\n                        delay(SEGMENT_INTERVAL_MS)\r\n                        // åˆå›æ™‚ã ã‘åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã‚’ä½œã‚‹\r\n                        if (!dashContainer.isGeneratedInitSegment) {\r\n                            contentManager.createFile(INIT_SEGMENT_FILENAME).also { initSegment ->\r\n                                dashContainer.sliceInitSegmentFile(initSegment.path)\r\n                            }\r\n                        }\r\n                        // MediaMuxerã§æ›¸ãè¾¼ã¿ä¸­ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰å®šæœŸçš„ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ï¼ˆã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºæ¥ã‚‹ï¼‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã§å†ç”Ÿã™ã‚‹\r\n                        // ã“ã®æ–¹æ³•ã ã¨ã€MediaMuxerã¨MediaMuxerã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ãŸãƒ‡ãƒ¼ã‚¿ã§äºŒé‡ã«å®¹é‡ã‚’ä½¿ã†ã‘ã©å¾Œã§è€ƒãˆã‚‹\r\n                        contentManager.createIncrementFile().also { segment ->\r\n                            dashContainer.sliceSegmentFile(segment.path)\r\n                        }\r\n                    } catch (e: Exception) {\r\n                        e.printStackTrace()\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ */\r\n    private fun setupCameraAndEncoder() {\r\n\r\n            // çœç•¥\r\n\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã€å‹•ä½œä¸­ã¯ä¸€æ™‚åœæ­¢ã™ã‚‹ã®ã§åˆ¥ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’èµ·å‹•\r\n            launch {\r\n                videoEncoder.startVideoEncode(\r\n                    onOutputBufferAvailable = { byteBuffer, bufferInfo ->\r\n                        dashContainer.writeVideo(byteBuffer, bufferInfo)\r\n                    },\r\n                    onOutputFormatAvailable = { mediaFormat ->\r\n                        dashContainer.setVideoTrack(mediaFormat)\r\n                    }\r\n                )\r\n            }\r\n\r\n            // çœç•¥\r\n    }\r\n\r\n    /** ãƒã‚¤ã‚¯ã¨ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’ç”¨æ„ */\r\n    @SuppressLint(\"MissingPermission\")\r\n    private fun setupMicAndEncoder() {\r\n\r\n            // çœç•¥\r\n\r\n            // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã€å‹•ä½œä¸­ã¯ä¸€æ™‚åœæ­¢ã™ã‚‹ã®ã§åˆ¥ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’èµ·å‹•\r\n            launch {\r\n                // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n                audioEncoder.startAudioEncode(\r\n                    onRecordInput = { bytes ->\r\n                        // PCMéŸ³å£°ã‚’å–ã‚Šå‡ºã—ã‚¨ãƒ³ã‚³ã™ã‚‹\r\n                        audioRecord.read(bytes, 0, bytes.size)\r\n                    },\r\n                    onOutputBufferAvailable = { byteBuffer, bufferInfo ->\r\n                        dashContainer.writeAudio(byteBuffer, bufferInfo)\r\n                    },\r\n                    onOutputFormatAvailable = { mediaFormat ->\r\n                        dashContainer.setAudioTrack(mediaFormat)\r\n                    }\r\n                )\r\n            }\r\n    }\r\n```\r\n\r\n# Webã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã‚‹\r\n`Ktor`ã£ã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§å»ºã¦ã‚‰ã‚Œã¾ã™ã€‚ãªã‚“ã¨`Android`ã§ã‚‚å‹•ãã¾ã™ï¼ˆAndroid 5ä»¥ä¸Šï¼‰  \r\n**`Kotlin DSL`ã‚’ã‚´ãƒªã‚´ãƒªä½¿ã†ã‚¹ã‚¿ã‚¤ãƒ«ãªã®ã§ç•°ä¸–ç•Œã«é£›ã°ã•ã‚ŒãŸæ„ŸãŒã™ã”ã„**\r\n\r\n## Webã‚µãƒ¼ãƒãƒ¼\r\n`ISO 8601`ã®éƒ¨åˆ†ã€å¤ã„Androidãƒãƒ¼ã‚¸ãƒ§ãƒ³ã ã¨ä½¿ãˆãªã„ã¿ãŸã„ãªã®ã§ãªã‚“ã‹ã—ãªã„ã¨ã ã‚ã§ã™ï¼ˆ`XXX`ãŒ`+09:00`ã¨ã‹ã«ãªã‚‹ã‚“ã ã‘ã©å¯¾å¿œã—ã¦ãªã„ã£ã½ã„ï¼‰  \r\nè¦‹ã¦ã®é€šã‚Šã€`index.html`ã€`manifest.mpd`ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’é™çš„é…ä¿¡ã™ã‚‹ãŸã‚ã®ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆé›‘ï¼‰  \r\nãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã¯`MPEG-DASH`ã‚’å†ç”Ÿã™ã‚‹ãŸã‚ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã€`dash.js`ã‚’ä½¿ã„ã¾ã™ã€‚  \r\nå¾Œè¿°ã—ã¾ã™ãŒã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®`VP9`ãŒé‡ã„å ´åˆã¯`VP8`ã‚’ä½¿ã†ã“ã¨ã‚‚å‡ºæ¥ã‚‹ã®ã§ã™ãŒå¤‰ãˆãŸå ´åˆã¯ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®`codecs`ã‚‚å¤‰ãˆã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * index.htmlã¨ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã¨ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹\r\n *\r\n * @param portNumber ãƒãƒ¼ãƒˆç•ªå·\r\n * @param segmentIntervalSec ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆé–“éš”\r\n * @param segmentFileNamePrefix ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹\r\n * @param staticHostingFolder ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€\r\n */\r\nclass DashServer(\r\n    private val portNumber: Int,\r\n    private val segmentIntervalSec: Int,\r\n    private val segmentFileNamePrefix: String,\r\n    private val staticHostingFolder: File,\r\n) {\r\n\r\n    /**\r\n     * ISO 8601 ã§æ˜ åƒãƒ‡ãƒ¼ã‚¿ã®åˆ©ç”¨å¯èƒ½æ™‚é–“ã‚’æŒ‡å®šã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚\r\n     * MPEG-DASHã®å ´åˆã¯æŒ‡å®šæ™‚é–“ã«ãªã‚‹ã¾ã§å†ç”Ÿã‚’é–‹å§‹ã—ãªã„æ©Ÿèƒ½ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚\r\n     */\r\n    @SuppressLint(\"NewApi\")\r\n    private val isoDateFormat = SimpleDateFormat(\"yyyy-MM-dd'T'HH:mm:ssXXX\", Locale.JAPAN)\r\n\r\n    /** ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆ */\r\n    private var manifest: String? = null\r\n\r\n    /** ã‚µãƒ¼ãƒãƒ¼ */\r\n    private val server = embeddedServer(Netty, port = portNumber) {\r\n        routing {\r\n            // WebSocketã¨å‹•ç”»ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã‚’æŒã£ãŸç°¡å˜ãªHTMLã‚’è¿”ã™\r\n            get(\"/\") {\r\n                call.respondText(INDEX_HTML, ContentType.parse(\"text/html\"))\r\n            }\r\n            // MPEG-DASHã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’è¿”ã™\r\n            get(\"manifest.mpd\") {\r\n                call.respondText(manifest!!, ContentType.parse(\"text/html\"))\r\n            }\r\n            // é™çš„ãƒ•ã‚©ãƒ«ãƒ€å…¬é–‹ã™ã‚‹ã‚ˆã†ã«ã€‚\r\n            // å‹•ç”»ã‚’é…ä¿¡ã™ã‚‹\r\n            static {\r\n                staticRootFolder = staticHostingFolder\r\n                files(staticHostingFolder)\r\n            }\r\n        }\r\n    }\r\n\r\n    /** ã‚µãƒ¼ãƒãƒ¼ã‚’é–‹å§‹ã™ã‚‹ */\r\n    fun startServer() {\r\n        manifest = createManifest()\r\n        server.start()\r\n    }\r\n\r\n    /** ã‚µãƒ¼ãƒãƒ¼ã‚’çµ‚äº†ã™ã‚‹ */\r\n    fun stopServer() {\r\n        server.stop()\r\n    }\r\n\r\n    /** ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½œã£ã¦è¿”ã™ */\r\n    private fun createManifest(): String {\r\n        val availableTime = isoDateFormat.format(System.currentTimeMillis())\r\n        return \"\"\"\r\n            <?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n            <MPD xmlns=\"urn:mpeg:dash:schema:mpd:2011\" availabilityStartTime=\"$availableTime\" maxSegmentDuration=\"PT${segmentIntervalSec}S\" minBufferTime=\"PT${segmentIntervalSec}S\" type=\"dynamic\" profiles=\"urn:mpeg:dash:profile:isoff-live:2011,http://dashif.org/guidelines/dash-if-simple\">\r\n              <BaseURL>/</BaseURL>\r\n              <Period start=\"PT0S\">\r\n                <AdaptationSet mimeType=\"video/webm\">\r\n                  <Role schemeIdUri=\"urn:mpeg:dash:role:2011\" value=\"main\" />\r\n                  <!-- duration ãŒæ›´æ–°é »åº¦ã£ã½ã„ -->\r\n                  <SegmentTemplate duration=\"$segmentIntervalSec\" initialization=\"/init.webm\" media=\"/${segmentFileNamePrefix}${\"$\"}Number${'$'}.webm\" startNumber=\"0\"/>\r\n                    <!-- éŸ³å£°å…¥ã‚Œã‚‹å ´åˆã¯ codecs=\"vp9,opus\" -->\r\n                  <Representation id=\"default\" codecs=\"vp9,opus\"/>\r\n                </AdaptationSet>\r\n              </Period>\r\n            </MPD>\r\n        \"\"\".trimIndent()\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** index.html */\r\n        private const val INDEX_HTML = \"\"\"\r\n<!doctype html>\r\n<html>\r\n<head>\r\n    <title>Androidã‹ã‚‰MPEG-DASHé…ä¿¡</title>\r\n    <style>\r\n        video {\r\n            width: 640px;\r\n            height: 360px;\r\n        }\r\n    </style>\r\n</head>\r\n<body>\r\n    <div>\r\n        <video id=\"videoPlayer\" controls muted autoplay></video>\r\n    </div>\r\n    <script src=\"https://cdn.dashjs.org/latest/dash.all.debug.js\"></script>\r\n    <script>\r\n        (function () {\r\n            var url = \"manifest.mpd\";\r\n            var player = dashjs.MediaPlayer().create();\r\n            player.initialize(document.querySelector(\"#videoPlayer\"), url, true);\r\n        })();\r\n    </script>\r\n</body>\r\n</html>\r\n\"\"\"\r\n    }\r\n}\r\n```\r\n\r\n## MainActivity.kt ã¸çµ„ã¿è¾¼ã‚€\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** Webã‚µãƒ¼ãƒãƒ¼ */\r\n    private lateinit var dashServer: DashServer\r\n\r\n\r\n    /** å…±é€šéƒ¨åˆ†ã®åˆæœŸåŒ– */\r\n    private suspend fun setupCommon() {\r\n        // é–‹å§‹ãƒœã‚¿ãƒ³ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆã¨ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹\r\n        viewBinding.startButton.setOnClickListener {\r\n            dashServer.startServer()\r\n            dashContainer.start()\r\n        }\r\n\r\n        // çµ‚äº†ãƒœã‚¿ãƒ³\r\n        viewBinding.stopButton.setOnClickListener {\r\n            // TODO ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾\r\n        }\r\n\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã‚¯ãƒ©ã‚¹\r\n        contentManager = DashContentManager(getExternalFilesDir(null)!!, SEGMENT_FILENAME_PREFIX).apply {\r\n            deleteCreateFile()\r\n        }\r\n        // ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«æ›¸ãè¾¼ã‚€ã‚¯ãƒ©ã‚¹\r\n        dashContainer = DashContainerWriter(contentManager.createTempFile(\"temp\")).apply {\r\n            createContainerFile()\r\n        }\r\n\r\n        // Webã‚µãƒ¼ãƒãƒ¼\r\n        dashServer = DashServer(\r\n            portNumber = 8080,\r\n            segmentIntervalSec = (SEGMENT_INTERVAL_MS / 1000).toInt(),\r\n            segmentFileNamePrefix = SEGMENT_FILENAME_PREFIX,\r\n            staticHostingFolder = contentManager.outputFolder\r\n        )\r\n\r\n        // çœç•¥\r\n```\r\n\r\n# ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾\r\nçµ‚äº†æ™‚ã«ãã‚Œãã‚Œã®ã‚¯ãƒ©ã‚¹ã«æ›¸ã„ãŸçµ‚äº†å‡¦ç†ã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚  \r\n**ã“ã‚Œã§ä¸€é€šã‚Šå®Œæˆã—ãŸã¯ãšï¼**\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    /** å…±é€šéƒ¨åˆ†ã®åˆæœŸåŒ– */\r\n    private suspend fun setupCommon() {\r\n        // é–‹å§‹ãƒœã‚¿ãƒ³ã€ã‚»ã‚°ãƒ¡ãƒ³ãƒˆç”Ÿæˆã¨ã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹\r\n        viewBinding.startButton.setOnClickListener {\r\n            dashServer.startServer()\r\n            dashContainer.start()\r\n        }\r\n        // çµ‚äº†ãƒœã‚¿ãƒ³\r\n        viewBinding.stopButton.setOnClickListener {\r\n            release()\r\n        }\r\n\r\n        // çœç•¥\r\n    }\r\n\r\n    override fun onDestroy() {\r\n        super.onDestroy()\r\n        release()\r\n    }\r\n\r\n    /** çµ‚äº†å‡¦ç† */\r\n    private fun release() {\r\n        dashServer.stopServer()\r\n        dashContainer.release()\r\n        cameraDevice?.close()\r\n        videoEncoder.release()\r\n        audioEncoder.release()\r\n        lifecycleScope.cancel()\r\n    }\r\n```\r\n\r\n# å‹•ã‹ã—ãŸ\r\n`SEGMENT_INTERVAL_MS`ã‚’1000ã«ã—ã¾ã—ãŸã€‚(1000ms = 1sec)  \r\nã‚„ã£ã±ã‚Šé…å»¶ãŒå‡ºã¡ã‚ƒã†ã‘ã©ã€`WebSocket`ã§å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å—ã‘å–ã£ã¦åˆ‡ã‚Šæ›¿ãˆã‚‹ã‚ˆã‚Šã¯å¿«é©ã ã£ãŸã€‚  \r\n**Androidå˜ä½“ã§ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒå‡ºæ¥ã¦æº€è¶³ã§ã™ã€‚**\r\n\r\n![Imgur](https://imgur.com/4Fn5tRq.gif)\r\n\r\n4MBãã‚‰ã„ã®GIFã§ã™ã€ãƒ¢ãƒã‚¤ãƒ«ãƒ‡ãƒ¼ã‚¿ã®æ–¹ã¯ã™ã„ã¾ã›ã‚“ï¼›ï¼›\r\n\r\nã¡ãªã¿ã« iOS ã ã¨HLSã§ã€ã—ã‹ã‚‚ä»Šå›ã®ã‚ˆã†ãªç„¡ç†ã‚„ã‚Šãªæ–¹æ³•ã§ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹ã“ã¨ç„¡ãé…ä¿¡ã§ãã‚‹ã¿ãŸã„ã§ã™ã€‚  \r\nãƒãƒ«ãƒãƒ¡ãƒ‡ã‚£ã‚¢é–¢ä¿‚ã¯ã‚„ã£ã±ã‚ŠAppleãŒå¼·ãã†ï¼ˆï¼Ÿï¼‰\r\n\r\n- https://qiita.com/rb-de0/items/779235007752452b2bdc\r\n- https://qiita.com/fuziki/items/675f88058bdf11d7a48b\r\n\r\n# ããƒ¼ã™ã“ãƒ¼ã©\r\n\r\nhttps://github.com/takusan23/AndroidWebMDashLive\r\n\r\n# Q & A\r\n\r\n## ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å«ã‚ã¦ãªã‚“ã‹é‡ã„ï¼\r\n`VP9`ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã ã¨è² è·ãŒé«˜ã™ãã®å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ï¼ˆ`Pixel 3 XL (SDM 845 / RAM 4GB)`ã ã¨ã‚„ã£ã±é‡ã„ï¼‰ã€‚  \r\n`MediaCodec`ã®`MediaFormat.MIMETYPE_VIDEO_VP9`ã‚’`MediaFormat.MIMETYPE_VIDEO_VP8`ã«ã™ã‚Œã°è»½ããªã‚Šãã†ã€‚  \r\nå¤‰ãˆãŸå ´åˆã¯`MPEG-DASH`ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚‚å¤‰ãˆã¦ãã ã•ã„\r\n\r\n```kotlin\r\n// VideoEncoder.kt\r\n\r\nfun prepareEncoder(\r\n    videoWidth: Int,\r\n    videoHeight: Int,\r\n    bitRate: Int,\r\n    frameRate: Int,\r\n    iFrameInterval: Int = 1,\r\n) {\r\n    // ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®é¸æŠ\r\n    // ã‚‚ã—é‡ããªã‚‹ã‚ˆã†ãªã‚‰ã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ VP8 ã«ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰ã—ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„\r\n    // ãã®å ´åˆã€MPEG-DASHã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§ã‚‚ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã‚’ vp8 ã«ã™ã‚‹å¿…è¦ã‚ã‚Š\r\n    val videoEncodeFormat = MediaFormat.createVideoFormat(MediaFormat.MIMETYPE_VIDEO_VP8, videoWidth, videoHeight).apply {\r\n        setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n        setInteger(MediaFormat.KEY_FRAME_RATE, frameRate)\r\n        setInteger(MediaFormat.KEY_I_FRAME_INTERVAL, iFrameInterval)\r\n        setInteger(MediaFormat.KEY_COLOR_FORMAT, MediaCodecInfo.CodecCapabilities.COLOR_FormatSurface)\r\n    }\r\n    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ç”¨æ„\r\n    mediaCodec = MediaCodec.createEncoderByType(MediaFormat.MIMETYPE_VIDEO_VP8).apply {\r\n        configure(videoEncodeFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n    }\r\n}\r\n```\r\n\r\n```kotlin\r\n// DashServer.kt\r\n\r\n/** ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’ä½œã£ã¦è¿”ã™ */\r\nprivate fun createManifest(): String {\r\n    val availableTime = isoDateFormat.format(System.currentTimeMillis())\r\n    return \"\"\"\r\n        <?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n        <MPD xmlns=\"urn:mpeg:dash:schema:mpd:2011\" availabilityStartTime=\"$availableTime\" maxSegmentDuration=\"PT${segmentIntervalSec}S\" minBufferTime=\"PT${segmentIntervalSec}S\" type=\"dynamic\" profiles=\"urn:mpeg:dash:profile:isoff-live:2011,http://dashif.org/guidelines/dash-if-simple\">\r\n          <BaseURL>/</BaseURL>\r\n          <Period start=\"PT0S\">\r\n            <AdaptationSet mimeType=\"video/webm\">\r\n              <Role schemeIdUri=\"urn:mpeg:dash:role:2011\" value=\"main\" />\r\n              <!-- duration ãŒæ›´æ–°é »åº¦ã£ã½ã„ -->\r\n              <SegmentTemplate duration=\"$segmentIntervalSec\" initialization=\"/init.webm\" media=\"/${segmentFileNamePrefix}${\"$\"}Number${'$'}.webm\" startNumber=\"0\"/>\r\n              <!-- vp8 ã«ã—ãŸã‚‰â†“ã“ã“ã‚‚ vp8 ã«ã™ã‚‹ -->\r\n              <Representation id=\"default\" codecs=\"vp8,opus\"/>\r\n            </AdaptationSet>\r\n          </Period>\r\n        </MPD>\r\n    \"\"\".trimIndent()\r\n}\r\n```\r\n\r\n## iOS ã¨ iPad OS ã§å†ç”Ÿã§ãã¾ã™ã‹ï¼Ÿ\r\n`iPad OS`ã ã¨å‹•ãã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n- dash.js (ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§MPEG-DASHã‚’å†ç”Ÿã™ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª) ãŒå‹•ã‹ãªã„\r\n    - ã‚‚ã£ã¨è©³ã—ãè¨€ã†ã¨ã€`Media Source Extensions`ã¨ã„ã†APIãŒå­˜åœ¨ã™ã‚‹ã®ã§ã™ãŒ`iOS`ã§ã¯ä½¿ãˆã¾ã›ã‚“\r\n        - ã—ã‹ã—ä½•æ•…ã‹`iPad OS`ã§ã¯ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹æ¨¡æ§˜ã€ãµã«ã‚ƒï¼Ÿ\r\n        - https://caniuse.com/mediasource\r\n\r\n`Safari`ã—ã‹è¨±ã—ã¦ãªã„`Apple`ãŒæ‚ªã„ã®ã‚‚åˆ†ã‹ã‚‹ã‚“ã§ã™ãŒã€`WebKit`ãŒç„¡ããªã‚‹ã¨æœ¬å½“ã«`Google`ã®å¥½ããªã‚ˆã†ã«Webã‚’æ”¯é…å‡ºæ¥ã¦ã—ã¾ã†ã®ã§ã‚„ã£ã±ã“ã®ã¾ã¾ã§ï¼ï¼ˆãƒ•ãƒ­ãƒ³ãƒˆä½•ã‚‚åˆ†ã‹ã‚‰ã‚“ãƒãƒ³ï¼‰  \r\n`HLS`ã®ä¾‹ãŒå¤šã„ã®ã‚‚ã‚„ã£ã±`iOS`ã§ã‚µãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã‚‰ãªã®ã§ã—ã‚‡ã†ã‹\r\n\r\n## ã‚¹ãƒãƒ›ã®ãƒ­ãƒ¼ã‚«ãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒã‚ã‹ã‚‰ã‚“\r\nWi-Fiè¨­å®šã®æ¥ç¶šä¸­ã‚¢ã‚¯ã‚»ã‚¹ãƒã‚¤ãƒ³ãƒˆã‚’é¸ã¹ã°è¡¨ç¤ºã§ããŸã¯ãšã€‚  \r\nã‚‚ã¡ã‚ã‚“ã‚¢ãƒ—ãƒªã§å–å¾—ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n[Androidã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å–å¾—ã™ã‚‹](/posts/android_12_wifi_local_ip_address)\r\n\r\n## Surfaceã‹ã‚‰æµã‚Œã¦ãã‚‹æ˜ åƒã®ãƒ—ãƒ¬ã‚¼ãƒ³ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã‚¿ã‚¤ãƒ ãŒã‚ã‹ã‚‰ãªã„ãŸã‚ã€éŸ³å£°ã¨ãšã‚Œã‚‹\r\n`Surface`çµŒç”±ã§`MediaCodec`ã¸æ¸¡ã™å ´åˆã€`queueInputBuffer`ã‚’å‘¼ã³å‡ºã™ã“ã¨ãŒãªã„ã®ã§æ™‚é–“(`presentationTimeUs`)ãŒå‹æ‰‹ã«æŒ‡å®šã•ã‚Œã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \r\nå¤šåˆ†`System.nanoTime() / 1000`ãŒæŒ‡å®šã•ã‚Œã¦ã„ã‚‹ã¨æ€ã„ã¾ã™....ï¼ˆ`dequeueOutputBuffer`ã§è²°ãˆã‚‹`BufferInfo`ã®æ™‚é–“ã‚’è¦‹ã‚‹ã¨å¤šåˆ†ãã†ï¼‰  \r\n\r\n```kotlin\r\n// å¤šåˆ† Surfaceã§æ˜ åƒã‚’å…¥åŠ›ã—ãŸå ´åˆã€presentationTimeUs ã¯ nanoTime ã‚’ 1000 ã§å‰²ã£ãŸå€¤ã£ã½ã„\r\nmediaCodec.queueInputBuffer(inputBufferId, 0, readByteSize, System.nanoTime() / 1000, 0)\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸ 888888888888888888\r\n\r\n# ãŠã‚ã‚Šã«\r\néœ€è¦ãŒã‚ã‚Œã°ã‚¹ãƒˆã‚¢ã«å‡ºã—ãŸã„ã‘ã©ã€ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã ã£ãŸã‚Šã§è‰²ã€…ç›´ã™ã¨ã“ã‚ãŒã‚ã£ã¦å¤§å¤‰ãã†ã€‚\r\n\r\nã‚ã¨ã“ã‚Œä½¿ã£ã¦ã‚‹ã¨ãã“ãã“ç™ºç†±ã—ã¾ã™ã€ã¯ã‚ˆå†¬æ¥ã„"},{"title":"Android Studio Bumblebee ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸã‚‰ ADB ãŒèµ·å‹•ã—ãªã„ï¼ˆãšã£ã¨ Loading Devices... ï¼‰","link":"/posts/android_studio_bumblebee_not_start_adb/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n\r\né«˜ã‹ã£ãŸã‘ã©ã•ãã‚‰ã‚“ã¼ã‚­ãƒƒã‚¹ãŒåéŒ²ã•ã‚Œã¦ã‚‹ã‚¢ãƒ«ãƒãƒ è²·ã£ã¡ã‚ƒã£ãŸ\r\n\r\n![Imgur](https://imgur.com/VFf1oEs.png)\r\n\r\n\r\n# æœ¬é¡Œ\r\n`Android Studio Bumblebee`ã«æ›´æ–°ã—ãŸã‚‰`ADB`ãŒèµ·å‹•ã—ãªã„ã€‚  \r\n**æœ¬æ¥ãƒ‡ãƒã‚¤ã‚¹åãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã¨ã“ã‚**ãŒ`Loading Devices...`ã®ã¾ã¾ä¸€å‘ã«å‹•ã‹ãªã„ã€‚  \r\n\r\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ã‚³ãƒãƒ³ãƒ‰æ‰“ã¡è¾¼ã‚“ã§ã‚‚ãªã‚“ã‹å—ã‘ä»˜ã‘ãªã„\r\n\r\n![Imgur](https://imgur.com/lcOrjgc.png)\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ                     | ã‚ãŸã„                    |\r\n|----------------------------|---------------------------|\r\n| Android Studio             | Android Studio Bumblebee  |\r\n| Windows                    | 10 Pro                    |\r\n| Android SDK Platform-Tools | 32.0.0 (è¨˜è¿°æ™‚æ™‚ç‚¹æœ€æ–°ç‰ˆ) |\r\n\r\n# è§£æ±ºç­–\r\n\r\n## Enable adb mDNS for wireless debugging ã‚’ OFF ã«ã™ã‚‹\r\n\r\nIssueTrackerã®äººThx!!!  \r\nhttps://issuetracker.google.com/issues/159562232\r\n\r\nAndroidStudioã®å·¦ä¸Šã®`File`ã‹ã‚‰`Settings...`ã¸é€²ã¿ã€`Build, Execution, Deployment > Debugger`ã¸é€²ã¿ã€  \r\n`Android Debug Bridge (adb)`ã®é …ç›®ã®`Enable adb mDNS for wireless debugging`ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã¦ã€  \r\n`Apply`ã‚’æŠ¼ã—ã¦`OK`ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/ajgSTI2.png)\r\n\r\næœ€å¾Œã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãç›´ã™ã‹ã€AndroidStudioã‚’å†èµ·å‹•ã™ã‚‹ã¨ç›´ã‚Šã¾ã—ãŸï¼ï¼ï¼\r\n\r\n**OFFã§ã‚‚QRã‚³ãƒ¼ãƒ‰ã‚’èª­ã¿è¾¼ã‚“ã§ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ãƒ‡ãƒãƒƒã‚°ã™ã‚‹ã“ã¨ãŒã§ãã‚‹ã¿ãŸã„**\r\n\r\n(é›»æºæœªæ¥ç¶šæ™‚ã®æŒ™å‹•ã¨ã‹ã€ACå……é›»å™¨ã§é«˜é€Ÿã«å……é›»ã—ãªãŒã‚‰å®Ÿæ©Ÿã§ç¢ºèªã—ãŸã„éš›ã«ä¾¿åˆ©ãã†ã ã‚ˆã­ã“ã‚Œ)\r\n\r\n![Imgur](https://imgur.com/kQ3WcoW.png)\r\n\r\n## ã‚‚ã†ä¸€åº¦ADBã‚³ãƒãƒ³ãƒ‰ã‚’å©ã\r\n\r\nã‚‚ã†ä¸€å›é©å½“ãªADBã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨èµ·å‹•ã—ã¾ã—ãŸã€‚ç§ã®ç’°å¢ƒã ã‘ã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\n`adb devices`ã¨ã‹å…¥åŠ›ã—ã¦å©ã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/nIlXTWO.png)\r\n\r\n**ã¡ãªã¿ã«åˆ¥ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ãã¨ã¾ãŸADBãŒèµ·å‹•ã—ãªããªã‚Šã¾ã™ (ï¼Ÿï¼Ÿï¼Ÿ)**\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\nAndroid Studio ã® `Device Manager`ãã‚“ã€ã“ã‚Œæ—¢ã«é–‹ã„ã¦ã‚‹ã¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰æŠ¼ã—ã¦ã‚‚èµ·å‹•ã—ãªã„ã®ã§\r\nDockã«ç•™ã‚ã¦ç½®ã‘ã‚‹ã®ã¯ã„ã„ã­ã€‚  \r\n(æ—¢ã«é–‹ã„ã¦ã‚‹ã›ã„ã§ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‹ã‚‰é …ç›®é¸ã‚“ã§ã‚‚ç„¡åå¿œã§å›°æƒ‘ã™ã‚‹ã“ã¨ãŒãŸã¾ã«ã‚ã‚‹)"},{"title":"Check your module classpath for missing or conflicting dependencies ã‚’ç›´ã™","link":"/posts/android_studio_cannnot_access_class/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚\r\n\r\n# æœ¬é¡Œ\r\n\r\n```\r\nCannot access class 'okhttp3.ResponseBody'. Check your module classpath for missing or conflicting dependencies\r\n```\r\n\r\n# ç›´ã—æ–¹\r\n\r\nå·¦ä¸Šã®`File`ã‹ã‚‰ã€`Invalidate Caches / Restart...`ã‚’æŠ¼ã›ã°ç›´ã£ãŸ\r\n\r\n![Imgur](https://imgur.com/jYKBHg3.png)\r\n\r\nï¼ˆé–¢ä¿‚ãªã„è©±ï¼‰ã‚ã¨ã©ã†ã§ã‚‚ã„ã„ã‚“ã§ã™ã‘ã©ã€ã“ã®ã‚µã‚¤ãƒˆ200ã‚’è¿”ã—ã¦ã‚‹ã—ä¸­èº«ã‚‚ã‚ã‚‹ã®ã« `ã‚½ãƒ•ãƒˆ404` åˆ¤å®šã‚’é£Ÿã‚‰ã£ã¦ã¾ã™ã€‚ã¯ãï½"},{"title":"Android Studio ã§å°æ–‡å­—å¤§æ–‡å­—ã‹ã‹ã‚ã‚‰ãšè£œå……ã®äºˆæ¸¬ã‚’è¡¨ç¤ºã—ã¦ã‚‚ã‚‰ã†","link":"/posts/android_studio_completion/","markdown":"\r\n`Shift`ã‚’æŠ¼ã™æŒ‡ã®è² æ‹…ã‚’æ¸›ã‚‰ãã†\r\n\r\n## è¨­å®šã‚’é–‹ã„ã¦\r\nEditor > General > Code Completion ã¸é€²ã¿ã¾ã™ã€‚  \r\n\r\né–‹ã„ãŸã‚‰ã€ä¸€ç•ªä¸Šã«ã‚ã‚‹`Match case:`ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã¾ã™ã€‚\r\n\r\n<input type=\"checkbox\" checked>Match case:</input>\r\n\r\nâ†“\r\n\r\n<input type=\"checkbox\">Match case:</input>\r\n\r\nã“ã‚Œã§å°æ–‡å­—ã‹ã‚‰å…¥åŠ›ã‚’å§‹ã‚ã¦ã‚‚ã€å¤§æ–‡å­—ã‹ã‚‰å§‹ã¾ã‚‹å˜èªã‚’äºˆæ¸¬ã«å‡ºã—ã¦ãã‚Œã¾ã™ã€‚\r\n"},{"title":"Jetpack Compose ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç”»é¢ã§å‹•ä½œç¢ºèªã™ã‚‹","link":"/posts/android_studio_interactive_preview_enable/","markdown":"\r\næ˜”ã‚ã£ãŸã®ã«ã„ã¤ã®é–“ã«ã‹æ¶ˆæ»…ã—ã¦ãŸã®ã§å¾©æ´»ã•ã›ã¾ã—ãŸã€‚\r\n\r\nğŸ‘†æŒ‡ã®ãƒãƒ¼ã‚¯ã®ãƒœã‚¿ãƒ³ã€ã“ã‚ŒæŠ¼ã™ã¨Android Studioã§è¦‹ãŸç›®ã ã‘ã˜ã‚ƒãªãã¦ã¡ã‚ƒã‚“ã¨`Modifier#clickable { }`ã®å‹•ä½œç¢ºèªãŒã§ãã‚‹ã€‚\r\n\r\n![Imgur](https://imgur.com/8zMF08P.png)\r\n\r\nã¡ãªã¿ã«ã€Œã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ– ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€ã£ã¦è¨€ã†ãã†ã§ã™ã‚ˆï¼Ÿ\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                    |\r\n|----------------|---------------------------|\r\n| Android Studio | Android Studio Arctic Fox |\r\n\r\n# æœ‰åŠ¹åŒ–\r\nå·¦ä¸Šã®`File`ã‹ã‚‰`Settings...`ã‚’é¸ã‚“ã§ã€`Experimental`ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\næŠ¼ã—ãŸã‚‰`Enable interactive and animation preview tools`ã‚’æœ‰åŠ¹åŒ–ã—ã¾ã™ã€‚ä»¥ä¸Šã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/a6q0PPY.png)\r\n\r\n# å‚è€ƒ\r\nhttps://stackoverflow.com/questions/68002376/how-to-enable-interactive-preview-button-for-jetpack-compose-ui-in-android-studi\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã©ã†ã§ã‚‚ã„ã„ã‚“ã ã‘ã©`Setting`ã¨`Preference`ã¨`Config`ã£ã¦ä½•ãŒé•ã†ã‚“ï¼Ÿ ~~å…¨éƒ¨è¨­å®šã§ã¯ã€‚~~"},{"title":"Android Studio (IDEA) ã§è¡Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è²¼ã‚Šä»˜ã‘ã‚‹ã¨ä¸Šã®è¡Œã«è²¼ã‚Šä»˜ã‘ã‚‰ã‚Œã‚‹","link":"/posts/android_studio_paste_setting/","markdown":"\r\nãƒ¡ãƒ¢\r\n\r\n# ãªã«ã“ã‚Œ\r\n\r\nè¡Œã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ï¼ˆä½•ã‚‚é¸æŠã—ã¦ã„ãªã„çŠ¶æ…‹ã§`Ctrl + C`ã™ã‚‹ã¨è¡Œã®ã‚³ãƒ”ãƒ¼ãŒã§ãã‚‹ï¼‰\r\n\r\n![Imgur](https://imgur.com/qn3CNlV.png)\r\n\r\nä»Šã®ä½ç½®ã«è²¼ã‚Šä»˜ã‘ã‚‹ãŸã‚ã«`Ctrl + V`ã™ã‚‹ã‘ã©...\r\n\r\n![Imgur](https://imgur.com/BgbC7HF.png)\r\n\r\nä½•æ•…ã‹ã‚«ãƒ¼ã‚½ãƒ«ï¼ˆã‚­ãƒ£ãƒ¬ãƒƒãƒˆï¼‰ã®ä½ç½®ã‚ˆã‚Šä¸Šã®è¡Œã§è²¼ã‚Šä»˜ã‘ã•ã‚Œã¦ã—ã¾ã†...\r\n\r\n![Imgur](https://imgur.com/DmuNeP3.png)  \r\n\r\nâ†‘ã‚«ãƒƒã‚³ã®ä¸­ã§è²¼ã‚Šä»˜ã‘ã¦ã»ã—ãã¦ã‚«ãƒ¼ã‚½ãƒ«ï¼ˆã‚­ãƒ£ãƒ¬ãƒƒãƒˆï¼‰ç§»å‹•ã•ã›ãŸã®ã«...\r\n\r\n# ç›´ã—æ–¹\r\n`File`â†’`Settings...`ã§è¨­å®šç”»é¢ã‚’é–‹ãã€  \r\n`Advanced Settings`ã®ä¸­ã«ã‚ã‚‹ã€`When pasting a line copied with no selection`ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’`Paste at the caret position`ã«ã™ã‚‹ã“ã¨ã§ã€ä¸Šã®è¡Œã§ã¯ãªãã€ç¾åœ¨ã®è¡Œã«è²¼ã‚Šä»˜ã‘ã‚’ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/mqCPfJa.png)\r\n\r\nãªãŠã£ãŸï¼ï¼\r\n\r\n![Imgur](https://imgur.com/QcIkkrB.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\n`Ctrl + C` â† `Copy` ã® `C` ã‚„ã‚ãªã  \r\n`Ctrl + F` â† `Find` ã® `F` ã‚„ã‚ãªã  \r\n`Ctrl + V` â† `V`...ã£ã¦ãªã«ï¼Ÿ  \r\n\r\nã£ã¦æ€ã„èª¿ã¹ã¦ã¿ã¾ã—ãŸãŒã€`P`ã¯å°åˆ·ç”¨ã§äºˆç´„æ¸ˆã¿ã ã‹ã‚‰èª¬ã€`C`ã‚­ãƒ¼ã®éš£ã ã‹ã‚‰èª¬ãªã‚“ã‹ãŒã‚ã‚‹ã‚‰ã—ã„ã€‚ã¯ãˆï½"},{"title":"Androidã®MediaStoreã§ã¯ æ–°ã—ã„ãƒ•ã‚¡ã‚¤ãƒ«(31) ä»¥ä¸Šã¯è‡ªå‹•ã§ä½œã‚Œãªã„ã‚‰ã—ã„","link":"/posts/android_unique_file/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n**åŒã˜åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‰ãªã‘ã‚Œã°ã„ã„ã ã‘ã®è©±ã§ã™ã€‚**\r\n\r\n## æœ¬é¡Œ\r\n\r\n```\r\njava.lang.IllegalStateException: Failed to build unique file:\r\n```\r\n\r\n`MediaStore`ã¸ç™»éŒ²ã—ã‚ˆã†ã¨ã—ãŸã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«åãŒè¢«ã£ã¦ä½œã‚Œãªã‹ã£ãŸã‚¨ãƒ©ãƒ¼\r\n\r\n### æœ¬æ¥ãªã‚‰\r\n\r\nåŒã˜åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²ã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€è‡ªå‹•çš„ã«ãƒ•ã‚¡ã‚¤ãƒ«åãŒã‹ã¶ã‚‰ãªã„ã‚ˆã†ã«`(1)`ã¨ã‹ã‚’ã„ã„æ„Ÿã˜ã«ä»˜ã‘ã¦ãã‚Œã‚‹\r\n\r\n**ãŸã ã€`(31)`ã‚’è¶…ãˆã‚‹ã¨ä½œã‚Œãšã«ä¾‹å¤–ã‚’åã**\r\n\r\n### ãªãœ\r\n\r\n`FileUtils.java`ã®`buildUniqueNameIterator`ãŒå¤šåˆ†ãã†ã€‚  \r\nã“ã“ã®`hasNext()`ãŒ32ã¾ã§ã—ã‹ç”¨æ„ã•ã‚Œã¦ãªã„ã‹ã‚‰ï¼Ÿ\r\n\r\nhttps://cs.android.com/android/platform/superproject/+/master:packages/providers/MediaProvider/src/com/android/providers/media/util/FileUtils.java;drc=master;l=636\r\n\r\n```java\r\n// Generate names like \"foo (2)\"\r\nreturn new Iterator<String>() {\r\n    int i = 0;\r\n    @Override\r\n    public String next() {\r\n        final String res = (i == 0) ? name : name + \" (\" + i + \")\";\r\n        i++;\r\n        return res;\r\n    }\r\n    @Override\r\n    public boolean hasNext() {\r\n        return i < 32;\r\n    }\r\n};\r\n```"},{"title":"Wear OS ã®ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚ŠãŸã„","link":"/posts/android_wear_os_complication/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚ã¾ã ã‚²ãƒ¼ãƒ ãŒçµ‚ã‚ã£ã¦ãªã„ã®ã§ä»Šå›ã¯æ„Ÿæƒ³ç„¡ã—ã§ã™ã€‚  \r\nPixel Watchã€äºˆæƒ³ã‚ˆã‚Š**ã‹ãªã‚Šã€ã‚ã£ã¡ã‚ƒã„ã„ã§ã™ã­**ã€‚USB Type-C ã®å……é›»å™¨æŒã£ã¦ç„¡ã„ã®ã§PCã®Type-Cã«æŒ¿ã—ã¦ã¾ã™ã€‚  \r\n\r\næ„å¤–ã«å°ã•ã‚ã€‚ä»–ã®WearOSãªãƒ‡ãƒã‚¤ã‚¹ã¯ç€ã‘ã‚‰ã‚Œã¦ã‚‹æ„ŸãŒã™ã”ã‹ã£ãŸã®ã§...  \r\nã‚»ãƒ«ãƒ©ãƒ¼é€šä¿¡ã€è©¦ã—ã¦ã¿ãŸã‹ã£ãŸãªï¼›ï¼›ï¼ˆdocomoãªã®ã§\r\n\r\n30å„„ã®ãƒ‡ãƒã‚¤ã‚¹ã§å‹•ãJavaã™ã”ã„  \r\n\r\n# æœ¬é¡Œ\r\nã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚ŠãŸã„ï¼ï¼ï¼  \r\nã¨ã„ã†ã‹ ãƒ‡ã‚¸ã‚¿ãƒ«ã‚¯ãƒ©ã‚¦ãƒ³ï¼Ÿã‚Šã‚…ã†ãšï¼Ÿ ã‚ã®æ¨ªã®å›ã›ã‚‹ã‚„ã¤ã‚’æŠ¼ã•ãšã«ã€ã‚¿ãƒƒãƒã ã‘ã§ã‚¢ãƒ—ãƒªä¸€è¦§ç”»é¢ã‚’é–‹ããŸã„ï¼ï¼ï¼  \r\nï¼ˆç‰©ç†ãƒœã‚¿ãƒ³ã‚ã‚“ã¾ã‚ŠæŠ¼ã—ãŸããªã„...æŠ¼ã—ãŸããªã„ï¼Ÿï¼‰\r\n\r\n![Imgur](https://imgur.com/tk1nwae.png)\r\n\r\næŠ¼ã—ãŸã‚‰ã‚¢ãƒ—ãƒªä¸€è¦§ç”»é¢ã«è¡Œãã‚ˆã†ãªã‚¢ãƒ—ãƒªã‚’ä½œã‚ŠãŸã„\r\n\r\n## ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã£ã¦ãªã«\r\n\r\nå¤©æ°—ã¨ã‹ã€æ›œæ—¥ã¨ã‹é›»æ± ãƒãƒ¼ã‚¯ãŒæ›¸ã„ã¦ã‚ã‚‹éƒ¨åˆ†ã€‚  \r\n\r\n![Imgur](https://imgur.com/4MemA9U.png)\r\n\r\n\r\nå…¬å¼ã§ã‚‚ä½œã‚Šæ–¹æ›¸ã„ã¦ã‚ã‚‹ã‘ã©ã€ãªã‚“ã‹éæ¨å¥¨ã«ãªã£ã¦ãŸ...  \r\nã“ã“ãŒå‚è€ƒã«ãªã‚‹â†’ https://github.com/android/wear-os-samples\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                        |\r\n|----------------|-------------------------------|\r\n| Android Studio | Android Studio Dolphin        |\r\n| å®Ÿæ©Ÿ           | Pixel Watch ( Wear OS 3.5 )   |\r\n| è¨€èª           | Kotlin ( ã‚„ã£ã±ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚ˆ ) |\r\n\r\n## å…¬å¼ã®ä¾‹ã‚’å‡ºã›\r\nå…¬å¼ã®ã¯ãªã‚“ã‹éæ¨å¥¨ãªã®ã§ã€ã‚³ãƒ¼ãƒ‰ã¨ã«ã‚‰ã‚ã£ã“ã—ãŸã»ã†ãŒã„ã„ã®ã‹ãª\r\n\r\nhttps://github.com/android/wear-os-samples/blob/main/WearComplicationDataSourcesTestSuite\r\n\r\n# ãã®å‰ã« Wear OS ã¨ã©ã†ã‚„ã£ã¦ ADB æ¥ç¶šã™ã‚‹ã‚“ï¼Ÿ\r\nAndroid 11 ã‹ã‚‰è¿½åŠ ã•ã‚ŒãŸã€`ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ ãƒ‡ãƒãƒƒã‚°`ãŒä½¿ãˆã¾ã™ã€‚  \r\nPixel Watchã‚’Wi-Fiã«æ¥ç¶šã—ã¦ã€é–‹ç™ºè€…å‘ã‘ã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼ˆæœ‰åŠ¹åŒ–æ–¹æ³•ã¯Androidã‚¹ãƒãƒ›ã¨åŒã˜ï¼‰å†…ã®`ãƒ¯ã‚¤ãƒ¤ãƒ¬ã‚¹ ãƒ‡ãƒãƒƒã‚°`ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\næœ‰åŠ¹ã«ã—ã¦ã€ãƒšã‚¢è¨­å®šã‚’æŠ¼ã—ã¾ã™ã€‚ãªã‚“ã‹ã‚³ãƒ¼ãƒ‰ã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¨æ€ã†ã®ã§ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ ãªã©ï¼‰ã‚’é–‹ã„ã¦ã€\r\n\r\n```\r\nadb pair {è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆ}\r\n```\r\n\r\n```\r\n# ä¾‹\r\n# adb pair 192.168.0.0:00000\r\n```\r\n\r\nã‚’å©ãã¾ã™ã€‚ãªã‚“ã‹å…¥åŠ›ã—ã‚ã¨è¨€ã‚ã‚Œã‚‹ã®ã§ã€\r\n\r\n```\r\n{Wi-Fi ãƒšã‚¢è¨­å®šã‚³ãƒ¼ãƒ‰}\r\n```\r\n\r\nã‚’å…¥ã‚Œã¾ã™ã€‚å®Œäº†ã—ãŸã‚‰ã€ç”»é¢ãŒæˆ»ã‚‹ï¼Ÿã®ã§`IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆ`ã®ã¨ã“ã‚ã«æ›¸ã„ã¦ã‚ã‚‹IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆç•ªå·ã‚’ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å…¥ã‚Œã¾ã™\r\n\r\n```\r\nadb connect IPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ãƒãƒ¼ãƒˆç•ªå·\r\n```\r\n\r\n```\r\n# ä¾‹\r\n# adb connect 192.168.0.0:00000\r\n```\r\n\r\n`connected to 192.168.0.0:0000`ãŒã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«è¡¨ç¤ºã•ã‚Œã‚Œã°å®Œäº†ã§ã™ï¼\r\n\r\n![Imgur](https://imgur.com/87nqO8x.png)\r\n\r\n# é©å½“ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ä¸‹ã•ã„\r\n`Wear OS`ã®`No Activity`ã§è‰¯ã„ã‚“ã˜ã‚ƒãªã„ã€‚ã‚¢ãƒ—ãƒªã®ç”»é¢ã„ã‚‰ãªã„ã—ã€‚\r\n\r\n![Imgur](https://imgur.com/rL3xV01.png)\r\n\r\nåå‰ã¯é©å½“ã«ã€SDKãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯å¾Œã§`build.gradle`æ›¸ãæ›ãˆã‚‹ã®ã§ãªã‚“ã§ã‚‚ã„ã„ã§ã™\r\n\r\n![Imgur](https://imgur.com/Qwg7oXC.png)\r\n\r\n## app/build.gradle\r\n`app`ãƒ•ã‚©ãƒ«ãƒ€ã«æœ‰ã‚‹`build.gradle`ã‚’é–‹ã„ã¦ã€ç›´ã—ã¾ã™  \r\n`compileSdk`ã€`minSdk`ã€`targetSdk`ã‚’ç›´ã—ã¾ã™ã€‚  \r\nã‚ã¨ã¯`dependencies`ã«ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\nplugins {\r\n    id 'com.android.application'\r\n    id 'org.jetbrains.kotlin.android'\r\n}\r\n\r\nandroid {\r\n    namespace 'io.github.takusan23.batteryapplaunchercomplication'\r\n    compileSdk 33\r\n\r\n    defaultConfig {\r\n        applicationId \"io.github.takusan23.batteryapplaunchercomplication\"\r\n        // Wear OS 3.x ãŒ SDK 30 ã¿ãŸã„\r\n        // Wear OS 2.x ã‚’ã‚µãƒãƒ¼ãƒˆã—ãŸã„å ´åˆã¯ SDK 26 ã«ã™ã‚‹ï¼Ÿ\r\n        minSdk 30\r\n        targetSdk 33\r\n        versionCode 1\r\n        versionName \"1.0\"\r\n\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            minifyEnabled false\r\n            proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'\r\n        }\r\n    }\r\n}\r\n\r\ndependencies {\r\n\r\n    // ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\n    implementation \"androidx.wear.watchface:watchface-complications-data-source:1.2.0-alpha03\"\r\n    implementation \"androidx.wear.watchface:watchface-complications-data-source-ktx:1.2.0-alpha03\"\r\n\r\n    implementation 'androidx.core:core-ktx:1.7.0'\r\n    implementation 'com.google.android.gms:play-services-wearable:18.0.0'\r\n    implementation 'androidx.percentlayout:percentlayout:1.0.0'\r\n    implementation 'androidx.legacy:legacy-support-v4:1.0.0'\r\n    implementation 'androidx.recyclerview:recyclerview:1.2.1'\r\n}\r\n```\r\n\r\n## SuspendingComplicationDataSourceService ã‚’ç¶™æ‰¿ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œã‚‹\r\né©å½“ã«ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã€`SuspendingComplicationDataSourceService`ã‚’ç¶™æ‰¿ã—ã¾ã™ã€‚  \r\n`ComplicationDataSourceService`ã®`kotlinx.coroutines`å¯¾å¿œç‰ˆã§ã™ï¼ï¼ï¼ä¾¿åˆ©ï¼ï¼ï¼\r\n\r\n```kotlin\r\n/** é›»æ± æ®‹é‡ã‚’è¡¨ç¤ºã—ã¦ã€æŠ¼ã—ãŸã‚‰ã‚¢ãƒ—ãƒªä¸€è¦§ã‚’é–‹ã ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ */\r\nclass BatteryAppLauncherComplication : SuspendingComplicationDataSourceService() {\r\n    override fun getPreviewData(type: ComplicationType): ComplicationData? {\r\n        \r\n    }\r\n\r\n    override suspend fun onComplicationRequest(request: ComplicationRequest): ComplicationData? {\r\n\r\n    }\r\n}\r\n```\r\n\r\n### getPreviewData\r\nã“ã‚Œã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®éš›ã«å‘¼ã³å‡ºã•ã‚Œã¾ã™ã€‚  \r\nä»Šå›ã¯é›»æ± æ®‹é‡ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨åŒã˜`RangedValueComplicationData`ã«ã—ã¾ã—ãŸã€‚ä»–ã«ã‚‚`ShortTextComplicationData`ã¨ã‹ã‚ã‚Šã¾ã™ã€‚  \r\nãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãªã®ã§å€¤ã¯æ±ºã‚æ‰“ã¡ã§ã„ã„ã§ã—ã‚‡ã†ã€‚\r\n\r\n```\r\nclass BatteryAppLauncherComplication : SuspendingComplicationDataSourceService() {\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®éš›ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ */\r\n    override fun getPreviewData(type: ComplicationType): ComplicationData {\r\n        // RangedValueComplicationData ã¯ ä¸¸ã„ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¿ãŸã„ãªã‚„ã¤\r\n        return RangedValueComplicationData.Builder(\r\n            value = 75f,\r\n            min = 0f,\r\n            max = 100f,\r\n            contentDescription = createPlainTextComplication(\"é›»æ± æ®‹é‡ã¨ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼\")\r\n        ).also { build ->\r\n            build.setText(createPlainTextComplication(\"75%\"))\r\n            build.setMonochromaticImage(createMonochromeIcon(R.drawable.icon_battery_4_bar))\r\n        }.build()\r\n    }\r\n\r\n    /** å®Ÿéš›ã®ã‚¦ã‚©ãƒƒãƒãƒ•ã‚§ã‚¤ã‚¹ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ */\r\n    override suspend fun onComplicationRequest(request: ComplicationRequest): ComplicationData {\r\n        // TODO ã“ã®å¾Œã™ãï¼\r\n    }\r\n\r\n    /** [String]ã‹ã‚‰[PlainComplicationText]ã‚’ä½œã‚‹ */\r\n    private fun createPlainTextComplication(string: String) = PlainComplicationText.Builder(string).build()\r\n\r\n    /** ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹IDã‹ã‚‰[MonochromaticImage]ã‚’ä½œã‚‹ */\r\n    private fun createMonochromeIcon(iconRes: Int) = MonochromaticImage.Builder(\r\n        image = Icon.createWithResource(this, iconRes)\r\n    ).build()\r\n\r\n}\r\n```\r\n\r\nã‚¢ã‚¤ã‚³ãƒ³ã¯ã“ã®è¾ºã‹ã‚‰æ‹å€Ÿã—ã¾ã—ãŸã€‚ã‚¢ã‚¦ãƒˆãƒ©ã‚¤ãƒ³ã®ã‚¢ã‚¤ã‚³ãƒ³ã™ã\r\n\r\n![Imgur](https://imgur.com/zesuYSM.png)\r\n\r\n## onComplicationRequest\r\nã“ã‚Œã¯å®Ÿéš›ã®å€¤ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n/** é›»æ± æ®‹é‡ã‚’è¡¨ç¤ºã—ã¦ã€æŠ¼ã—ãŸã‚‰ã‚¢ãƒ—ãƒªä¸€è¦§ã‚’é–‹ã ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ */\r\nclass BatteryAppLauncherComplication : SuspendingComplicationDataSourceService() {\r\n\r\n    /** ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã®éš›ã«å‘¼ã³å‡ºã•ã‚Œã‚‹ */\r\n    override fun getPreviewData(type: ComplicationType): ComplicationData {\r\n        // RangedValueComplicationData ã¯ ä¸¸ã„ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¿ãŸã„ãªã‚„ã¤\r\n        return RangedValueComplicationData.Builder(\r\n            value = 75f,\r\n            min = 0f,\r\n            max = 100f,\r\n            contentDescription = createPlainTextComplication(\"é›»æ± æ®‹é‡ã¨ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼\")\r\n        ).also { build ->\r\n            build.setText(createPlainTextComplication(\"75%\"))\r\n            build.setMonochromaticImage(createMonochromeIcon(R.drawable.icon_battery_4_bar))\r\n        }.build()\r\n    }\r\n\r\n    /** å®Ÿéš›ã®ã‚¦ã‚©ãƒƒãƒãƒ•ã‚§ã‚¤ã‚¹ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ */\r\n    override suspend fun onComplicationRequest(request: ComplicationRequest): ComplicationData {\r\n        request.complicationType\r\n        // å®Ÿéš›ã®é›»æ± æ®‹é‡ã‚’å–å¾—ã™ã‚‹\r\n        val batteryLevel = getBatteryLevel().toFloat()\r\n        return RangedValueComplicationData.Builder(\r\n            value = batteryLevel, // ç¾åœ¨ã®å€¤\r\n            min = 0f, // æœ€ä½å€¤\r\n            max = 100f, // æœ€å¤§å€¤\r\n            contentDescription = createPlainTextComplication(\"é›»æ± æ®‹é‡ã¨ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼\")\r\n        ).also { build ->\r\n            build.setText(createPlainTextComplication(\"${batteryLevel.toInt()}%\"))\r\n            build.setMonochromaticImage(createMonochromeIcon(R.drawable.icon_battery_4_bar))\r\n        }.build()\r\n    }\r\n\r\n    /** [String]ã‹ã‚‰[PlainComplicationText]ã‚’ä½œã‚‹ */\r\n    private fun createPlainTextComplication(string: String) = PlainComplicationText.Builder(string).build()\r\n\r\n    /** ã‚¢ã‚¤ã‚³ãƒ³ã®ãƒªã‚½ãƒ¼ã‚¹IDã‹ã‚‰[MonochromaticImage]ã‚’ä½œã‚‹ */\r\n    private fun createMonochromeIcon(iconRes: Int) = MonochromaticImage.Builder(\r\n        image = Icon.createWithResource(this, iconRes)\r\n    ).build()\r\n\r\n    /** é›»æ± æ®‹é‡ã‚’å–å¾— */\r\n    private fun getBatteryLevel(): Int {\r\n        val powerManager = getSystemService(Context.BATTERY_SERVICE) as BatteryManager\r\n        return powerManager.getIntProperty(BatteryManager.BATTERY_PROPERTY_CAPACITY)\r\n    }\r\n\r\n}\r\n```\r\n\r\n## AndroidManifest.xml\r\næœ€å¾Œã«ã‚µãƒ¼ãƒ“ã‚¹ã‚’`Manifest`ã«è¿½åŠ ã—ã¾ã™ã€‚  \r\n`intent-filter`ã¯çµ¶å¯¾å¿…è¦ã§ã™ã€‚  \r\n\r\n```xml\r\n<service\r\n    android:name=\".BatteryAppLauncherComplication\"\r\n    android:exported=\"true\"\r\n    android:icon=\"@drawable/icon_battery_4_bar\"\r\n    android:label=\"é›»æ± æ®‹é‡ã¨ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼\"\r\n    android:permission=\"com.google.android.wearable.permission.BIND_COMPLICATION_PROVIDER\">\r\n    <intent-filter>\r\n        <action android:name=\"android.support.wearable.complications.ACTION_COMPLICATION_UPDATE_REQUEST\" />\r\n    </intent-filter>\r\n\r\n    <meta-data\r\n        android:name=\"android.support.wearable.complications.SUPPORTED_TYPES\"\r\n        android:value=\"RANGED_VALUE\" />\r\n    <meta-data\r\n        android:name=\"android.support.wearable.complications.UPDATE_PERIOD_SECONDS\"\r\n        android:value=\"300\" />\r\n</service>\r\n```\r\n\r\n`android.support.wearable.complications.SUPPORTED_TYPES`ã¯ã€ä»Šå›ã¯`RangedValueComplicationData`ã‚’è¿”ã™ã®ã§`RANGED_VALUE`ã§ã™ã€‚  \r\nã‚¯ãƒ©ã‚¹ã¨å€¤ã®å¯¾å¿œè¡¨ãªã©ã¯ã¡ã‚‡ã£ã¨è¦‹ã¤ã‘ã‚‰ã‚Œãªã‹ã£ãŸã®ã§ã™ãŒã€  \r\nä»¥ä¸‹ã®åˆ—æŒ™å‹ã‹ã‚‰åå‰ãŒåŒã˜(`RangedValueComplicationData`ã ã‹ã‚‰`TYPE_RANGED_VALUE`ï¼Ÿ)ã€`TYPE_`ã‚’é™¤ã„ãŸã®ã‚’è¨­å®šã™ã‚Œã°ã„ã„ãã†ã§ã™ã€‚  \r\n\r\n```kotlin\r\n    NO_DATA(WireComplicationData.TYPE_NO_DATA),\r\n    EMPTY(WireComplicationData.TYPE_EMPTY),\r\n    NOT_CONFIGURED(WireComplicationData.TYPE_NOT_CONFIGURED),\r\n    SHORT_TEXT(WireComplicationData.TYPE_SHORT_TEXT),\r\n    LONG_TEXT(WireComplicationData.TYPE_LONG_TEXT),\r\n    RANGED_VALUE(WireComplicationData.TYPE_RANGED_VALUE),\r\n    MONOCHROMATIC_IMAGE(WireComplicationData.TYPE_ICON),\r\n    SMALL_IMAGE(WireComplicationData.TYPE_SMALL_IMAGE),\r\n    PHOTO_IMAGE(WireComplicationData.TYPE_LARGE_IMAGE),\r\n    NO_PERMISSION(WireComplicationData.TYPE_NO_PERMISSION),\r\n```\r\n\r\n`ShortTextComplicationData`ãªã‚‰`SHORT_TEXT`ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\nã¡ãªã¿ã«ã€ã‚³ãƒ³ãƒåŒºåˆ‡ã‚Šã§è¤‡æ•°æŒ‡å®šã§ãã¾ã™ã€‚è¤‡æ•°æŒ‡å®šã—ãŸå ´åˆã¯`onComplicationRequest`ã®ç¬¬ä¸€å¼•æ•°ã®`ComplicationRequest#complicationType`ã§åˆ¤æ–­ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```xml\r\n<meta-data android:name=\"android.support.wearable.complications.SUPPORTED_TYPES\"\r\nandroid:value=\"RANGED_VALUE,SHORT_TEXT,ICON\"/>\r\n```\r\n\r\n\r\nè¤‡æ•°é¸æŠæ™‚ã¯ã“ã‚“ãªæ„Ÿã˜ã§åˆ†å²ã§ãã‚‹ã¯ãšï¼Ÿ\r\n\r\n```kotlin\r\nwhen(request.complicationType){\r\n    ComplicationType.SHORT_TEXT -> TODO()\r\n    ComplicationType.LONG_TEXT -> TODO()\r\n    ComplicationType.RANGED_VALUE -> TODO()\r\n    ComplicationType.MONOCHROMATIC_IMAGE -> TODO()\r\n    ComplicationType.SMALL_IMAGE -> TODO()\r\n    ComplicationType.PHOTO_IMAGE -> TODO()\r\n}\r\n```\r\n\r\n`android.support.wearable.complications.UPDATE_PERIOD_SECONDS`ã¯æœ€ä½æ›´æ–°é–“éš”ã§ã™ã€‚å¤šåˆ†æ›¸ã„ãŸã©ãŠã‚Šã«å®Ÿè¡Œã•ã‚Œãªã„ã¨æ€ã„ã¾ã™ãŒã€‚  \r\næœ€ä½é–“éš”ã¯300ç§’ã‚‰ã—ã„ã§ã™ï¼šhttps://developer.android.com/training/wearables/watch-faces/exposing-data-complications?hl=ja#meta-data\r\n\r\n```xml\r\n<meta-data\r\n    android:name=\"android.support.wearable.complications.UPDATE_PERIOD_SECONDS\"\r\n    android:value=\"300\" />\r\n```\r\n\r\n# å‹•ã‹ã™\r\n\r\n`Activity`ãŒç„¡ã„ã¨å®Ÿè¡Œãƒœã‚¿ãƒ³ã™ã‚‰è¡¨ç¤ºã•ã‚Œãªã„ã®ã­ã€  \r\n`Add Configuration...`ã‚’æŠ¼ã—ã¦ã€`+`ã‚’ãŠã—ã¦`Android App`ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/vajZiez.png)\r\n\r\n`Activity`ãªã„ã®ã§ã€`Launch`ã¯`Nothing`ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\n`Module`ã¯å¤šåˆ†ä¸€å€‹ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ã¨æ€ã†ã®ã§ãã‚Œã‚’é¸ã¹ã°ãŠï½‹ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/2oq3Vkw.png)\r\n\r\nå®Ÿè¡Œã™ã‚‹ã¨ã€ãªã‚“ã‹èµ¤ã„æ–‡å­—ã§æ€–ã„ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã¾ã™ãŒã€ã‚¢ãƒ—ãƒªãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã¦ã‚‹ã®ã§OKã§ã™ã€‚  \r\n\r\n```\r\n10/17 02:22:22: Launching 'Unnamed' on Google Google Pixel Watch.\r\nInstall successfully finished in 2 s 700 ms.\r\nCould not identify launch activity: Default Activity not found\r\nError while Launching activity\r\nFailed to launch an application on all devices\r\n```\r\n\r\n# ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’è¿½åŠ ã™ã‚‹\r\næ–‡å­—ç›¤ã®å¤‰æ›´ã¨ã‹ã¯ã“ã®è¾ºè¦‹ã¦ä¸‹ã•ã„ã€‚  \r\nhttps://support.google.com/wearos/answer/6140435?hl=ja\r\n\r\nãŠãŠï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/0iH51lM.png)\r\n\r\n\r\nå‹•ã„ã¦ã¾ï¼ã™ï¼ï¼ˆæœ€åˆã‹ã‚‰å…¥ã£ã¦ã‚‹ã‚„ã¤ã¨ã»ã¼ä¸€ç·’ã ã‹ã‚‰å‡ºæ¥ã¦ã‚‹ã®ã‹åˆ†ã‹ã‚‰ã‚“ã­ï¼‰\r\n\r\n![Imgur](https://imgur.com/RbXEIkI.png)\r\n\r\n# æŠ¼ã—ãŸã¨ãã«ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚’é–‹ã„ã¦ã»ã—ã„ï¼ï¼\r\nå¤šåˆ†ãƒ©ãƒ³ãƒãƒ£ãƒ¼ã®`Activity`ã‚’ç›´æ¥`Intent`ã§æŒ‡å®šã—ã¦`startActivity`ã—ã¦ã‚‚ç„¡ç†ã ã¨æ€ã†ã®ã§ã€åˆ¥ã®æ–¹æ³•ã‚’å–ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nã§ã€è‰²ã€…ã‚„ã£ã¦ãŸã‚‰**æ–‡å­—ç›¤ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹ã¨ãã«ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼ãŒé–‹ã**ã“ã¨ãŒã‚ã‹ã‚Šã¾ã—ãŸã€‚  \r\n(ã”ã‚ã‚“ Pixel Watch ã ã‘ã‹ã‚‚ã—ã‚Œãªã„)\r\n\r\n```\r\nC:\\Users\\takusan23>adb shell input keyevent KEYCODE_HOME\r\n```\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€ã‚¢ãƒ—ãƒªå´ã‹ã‚‰ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°ã€ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼ã‚’é–‹ãã“ã¨ãŒã§ããã†ã§ã™ï¼\r\n\r\n## ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã«ã¯ï¼Ÿ\r\n\r\nä¸Šè¨˜ã®`adb shell input`ãŒä½¿ãˆã‚Œã°ã„ã„ã®ã§ã™ãŒã€ã‚¢ãƒ—ãƒªã§ã“ã‚Œã‚’å®Ÿè¡Œã—ã¦ã‚‚å‹•ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n```\r\nRuntime.getRuntime().exec(\"adb shell input keyevent KEYCODE_HOME\")\r\n```\r\n\r\nè©°ã‚“ã ã‹...ã¨æ€ã„ãã‚„ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œã‚‹ã“ã¨ã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä»£ã‚ã£ã¦ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ï½‹ï½”ï½‹ï½’\r\n\r\n## ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚µãƒ¼ãƒ“ã‚¹ã‚’ã‚µã‚¯ã‚µã‚¯ã£ã¨ä½œã‚‹\r\n\r\n`performGlobalAction`ã‚’ä½¿ã„ãŸã„ã ã‘ãªã®ã§ã€ãã‚Œä»¥å¤–ã¯ä½œã‚Šã¾ã›ã‚“ã€‚  \r\nãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’ã‚»ãƒƒãƒˆã—ã¦ã€ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ¼ã—ãŸéš›ã«ã“ã“ã®ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã«é£›ã°ã™ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/** ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚µãƒ¼ãƒ“ã‚¹ */\r\nclass HomeButtonAccessibilityService : AccessibilityService() {\r\n\r\n    /** ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã»ã—ã„ã“ã¨ã‚’å—ã‘å–ã‚‹ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ */\r\n    private val broadcastReceiver = object : BroadcastReceiver() {\r\n        override fun onReceive(context: Context?, intent: Intent?) {\r\n            when (intent?.action) {\r\n                // ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\r\n                DOWN_HOME_BUTTON -> performGlobalAction(GLOBAL_ACTION_HOME)\r\n            }\r\n        }\r\n    }\r\n\r\n    override fun onServiceConnected() {\r\n        super.onServiceConnected()\r\n        registerReceiver(broadcastReceiver, IntentFilter().apply {\r\n            addAction(DOWN_HOME_BUTTON)\r\n        })\r\n    }\r\n\r\n    override fun onAccessibilityEvent(event: AccessibilityEvent?) {\r\n        // do nothing\r\n    }\r\n\r\n    override fun onInterrupt() {\r\n        // do nothing\r\n    }\r\n\r\n    override fun onUnbind(intent: Intent?): Boolean {\r\n        unregisterReceiver(broadcastReceiver)\r\n        return super.onUnbind(intent)\r\n    }\r\n\r\n    companion object {\r\n        /** ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã®Intentã®Action */\r\n        const val DOWN_HOME_BUTTON = \"io.github.takusan23.batteryapplaunchercomplication.DOWN_HOME_BUTTON\"\r\n    }\r\n}\r\n```\r\n\r\n### accessibility_service_config.xml ã‚’æ›¸ã\r\n`res/xml`å†…ã«`accessibility_service_config.xml`ã‚’è¿½åŠ ã—ã¦ä»¥ä¸‹ã‚³ãƒ”ãƒš  \r\nã¡ãªã¿ã« Codelab ãã®ã¾ã¾ã§ã™ï¼šhttps://codelabs.developers.google.com/codelabs/developing-android-a11y-service/?hl=ja#2\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<accessibility-service xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:accessibilityFeedbackType=\"feedbackGeneric\" android:accessibilityFlags=\"flagDefault\"\r\n    android:canPerformGestures=\"true\" android:canRetrieveWindowContent=\"true\" />\r\n```\r\n\r\n### AndroidManifest.xml ã‚’æ›¸ã\r\nã¯ã„ã€‚\r\n\r\n```xml\r\n<service\r\n    android:name=\".HomeButtonAccessibilityService\"\r\n    android:exported=\"true\"\r\n    android:label=\"ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚µãƒ¼ãƒ“ã‚¹\"\r\n    android:permission=\"android.permission.BIND_ACCESSIBILITY_SERVICE\">\r\n\r\n    <intent-filter>\r\n        <action android:name=\"android.accessibilityservice.AccessibilityService\" />\r\n    </intent-filter>\r\n\r\n    <meta-data\r\n        android:name=\"android.accessibilityservice\"\r\n        android:resource=\"@xml/accessibility_service_config\" />\r\n</service>\r\n```\r\n\r\n### ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã«ã€ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚µãƒ¼ãƒ“ã‚¹ã¸ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’é€ã‚‹\r\n`setTapAction`ã¸`PendingIntent`ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã¨æŠ¼ã—ãŸã¨ãã«`Intent`ãŒç™ºè¡Œã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\n/** å®Ÿéš›ã®ã‚¦ã‚©ãƒƒãƒãƒ•ã‚§ã‚¤ã‚¹ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ */\r\noverride suspend fun onComplicationRequest(request: ComplicationRequest): ComplicationData {\r\n    request.complicationType\r\n    // å®Ÿéš›ã®é›»æ± æ®‹é‡ã‚’å–å¾—ã™ã‚‹\r\n    val batteryLevel = getBatteryLevel().toFloat()\r\n    return RangedValueComplicationData.Builder(\r\n        value = batteryLevel,\r\n        min = 0f,\r\n        max = 100f,\r\n        contentDescription = createPlainTextComplication(\"é›»æ± æ®‹é‡ã¨ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼\")\r\n    ).also { build ->\r\n        build.setText(createPlainTextComplication(\"${batteryLevel.toInt()}%\"))\r\n        build.setMonochromaticImage(createMonochromeIcon(R.drawable.icon_battery_4_bar))\r\n        // ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã® PendingIntent ã€‚ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã ã‘ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚µãƒ¼ãƒ“ã‚¹ã¸ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’é€ä¿¡ã—ã¦ã„ã‚‹\r\n        build.setTapAction(PendingIntent.getBroadcast(this, 4545, Intent(HomeButtonAccessibilityService.DOWN_HOME_BUTTON), PendingIntent.FLAG_IMMUTABLE))\r\n    }.build()\r\n}\r\n```\r\n\r\n# å®Ÿè¡Œã—ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã‚’æœ‰åŠ¹ã«ã™ã‚‹\r\n\r\nè¨­å®šã‚’é–‹ã„ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼è£œåŠ©ã®é …ç›®ã¸è¡Œãã€ã•ã£ãä½œã£ãŸã‚„ã¤ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/K8fEKlQ.png)\r\n\r\n![Imgur](https://imgur.com/DegI7dB.png)\r\n\r\nã‚ã¨æœ€å¾Œã«ã€ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å†åº¦ç½®ãç›´ã™å¿…è¦ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚  \r\nã“ã‚Œã§ã€ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ã‚¢ãƒ—ãƒªãƒ©ãƒ³ãƒãƒ£ãƒ¼ãŒé–‹ãã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ã‚„ã£ãŸãœï¼ï¼ï¼\r\n\r\nãªã‚“ã‹`Android Studio`ã§éŒ²ç”»ã—ãŸã›ã„ã‹é‡ã„...\r\n\r\n![Imgur](https://imgur.com/16BAh1s.gif)\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/BatteryAppLauncherComplication\r\n\r\n# ãŠã‚ã‚Šã«\r\nã‚¬ã‚¸ã‚§ãƒƒãƒˆè²·ã†ã‚ˆã‚Šã‚ˆã‚Šãƒ¡ã‚¤ãƒ³æ©Ÿã®SSDå¢—è¨­ã™ã‚‹ã®ãŒå…ˆã‹ã‚‚ã—ã‚Œãªã„...  \r\nã„ã‚„ã§ã‚‚ã‚¬ãƒã®ã¾ã˜ã§å††å®‰ã§æ™‚æœŸãŒæ‚ªã„ã‚„ã‚...  \r\n\r\n![Imgur](https://imgur.com/KgFDjOf.png)\r\n\r\n![Imgur](https://imgur.com/fD3nP9Z.png)\r\n\r\nãã‚“ãªå††å®‰ã®ä¸­ãŠè²¡å¸ƒã«å„ªã—ã„ãƒ¬ãƒ¼ãƒˆã§å£²ã£ã¦ãã‚Œã‚‹ã‚ãŸã‚ŠGoogleã‚¬ãƒãªã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚  \r\n349ãƒ‰ãƒ«ã‚’39,800å††ã§è²©å£²ã—ãŸã‚‰å¤§èµ¤å­—ãªã®ã§ã¯\r\n\r\n![Imgur](https://imgur.com/47Ydxq6.png)\r\n\r\n# ãŠã¾ã‘ Wear OS ã§ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã®å–ã‚Šæ–¹\r\n`Android Studio`ãŒèµ·å‹•ä¸­ã®å ´åˆã¯ã€`Wear OS ãƒ‡ãƒã‚¤ã‚¹`ã¨ADBã§æ¥ç¶šã—ãŸå¾Œã€`Logcat`ã‚’é–‹ã„ã¦ã€ã‚«ãƒ¡ãƒ©ãƒãƒ¼ã‚¯ã‚’æŠ¼ã™ã“ã¨ã§æ’®ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/9QCpkia.png)\r\n\r\nã‚‚ã—æ‰‹å…ƒã«PCãŒãªã‘ã‚Œã°ã€`Pixel Watch`ã‚¢ãƒ—ãƒªã‹ã‚‰æ’®ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚  \r\nï¼ˆã‚‚ã—ã‹ã—ãŸã‚‰ WearOS ã§é–‹ç™ºè€…å‘ã‘ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹ã«ã—ãªã„ã¨å‡ºæ¥ãªã„ã‹ã‚‚ï¼‰\r\n\r\n![Imgur](https://imgur.com/cr6Ddg7.png)\r\n\r\n# è¿½è¨˜ 2022/10/23\r\nã‚‚ã—ã‹ã—ãŸã‚‰ã€ã“ã‚Œæœ‰åŠ¹ã«ã™ã‚‹ã¨ `ã‚Šã‚…ã†ãš` å›ã—ãŸã¨ãã®æ„Ÿè§¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ãŒç„¡åŠ¹ã«ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚  \r\nåŸå› ã¯`accessibility_service_config.xml`ã§`canPerformGestures`ã‚’`true`ã«ã—ãŸã›ã„ã ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nå¯¾ç­–ã¨ã—ã¦ã¯ã€`canPerformGestures`ã‚’ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’å—ä¿¡ã—ãŸéš›ã«å‹•çš„ã«æœ‰åŠ¹ã«ã™ã‚‹ã“ã¨ã§åˆ©ç”¨ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n`accessibility_service_config.xml`ã®`canPerformGestures`ã‚’`false`ã«ã—ã¦\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<accessibility-service xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    android:accessibilityFeedbackType=\"feedbackGeneric\" android:accessibilityFlags=\"flagDefault\"\r\n    android:canPerformGestures=\"false\" />\r\n```\r\n\r\nãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆã‚’å—ä¿¡ã—ãŸéš›ã«`canPerformGestures`ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰å†åº¦`canPerformGestures`ã‚’å‘ã“ã†ã«ã—ã¾ã™ã€‚  \r\nã§ã€å‹•çš„ã«æœ‰åŠ¹ã«ã™ã‚‹ãŸã‚ã®é–¢æ•°ãŒ`@UnsupportedAppUsage`ã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§éš ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€æ™®é€šã«ã¯å‘¼ã³å‡ºã›ã¾ã›ã‚“ã€‚  \r\nãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§å‘¼ã³å‡ºã™ã—ã‹ç„¡ã„ã¨æ€ã„ã¾ã™ã€‚(ã»ã‚“ã¨ã‹ï¼Ÿ)\r\n\r\n(AccessibilityService_canRetrieveWindowContent ãŒ å‹•çš„ã«å¤‰æ›´ã¯ã§ããªã„(xmlã§æŒ‡å®šã—ã‚)ã£ã¦æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã€é€†ã«å‹•çš„ã«å¤‰æ›´ã™ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ãŒã‚ã‚‹ã®ã‹ã¨æœŸå¾…ã—ã¦ãŸã®ã§ã™ãŒã‚¢ãƒãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã§éš ã•ã‚Œã¦ã¾ã—ãŸã€‚)\r\n\r\n```kotlin\r\n/** ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã»ã—ã„ã“ã¨ã‚’å—ã‘å–ã‚‹ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆ */\r\nprivate val broadcastReceiver = object : BroadcastReceiver() {\r\n    override fun onReceive(context: Context?, intent: Intent?) {\r\n        when (intent?.action) {\r\n            // ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\r\n            DOWN_HOME_BUTTON -> {\r\n                // xml ã§ android:canPerformGestures ã‚’æŒ‡å®šã™ã‚‹ã¨ã€\r\n                // ã‚Šã‚…ã†ãš ã‚’å›ã—ãŸã¨ãã®æ„Ÿè§¦ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ ãŒè²°ãˆãªããªã‚‹ãŸã‚ã€\r\n                // å®Ÿè¡Œæ™‚ã« canPerformGestures ã‚’æŒ‡å®šã™ã‚‹\r\n                // ãŸã ã€â†‘ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒéš ã•ã‚Œã¦ã„ã‚‹ãŸã‚ãƒªãƒ•ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³ã§å‘¼ã³å‡ºã™\r\n                val setCapabilities = AccessibilityServiceInfo::class.java\r\n                    .methods\r\n                    .first { it.name == \"setCapabilities\" }\r\n                setCapabilities.invoke(serviceInfo, AccessibilityServiceInfo.CAPABILITY_CAN_PERFORM_GESTURES)\r\n                // å†ã‚»ãƒƒãƒˆã™ã‚‹\r\n                serviceInfo = serviceInfo\r\n                // ãƒ›ãƒ¼ãƒ ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\r\n                performGlobalAction(GLOBAL_ACTION_HOME)\r\n                // ãã—ã¦æœ€å¾Œã«æˆ»ã™\r\n                setCapabilities.invoke(serviceInfo, 0)\r\n                serviceInfo = serviceInfo\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nå¯¾å¿œã‚³ãƒŸãƒƒãƒˆã§ã™  \r\n\r\nhttps://github.com/takusan23/BatteryAppLauncherComplication/commit/75d83f584322d268bbcbae2d14aa0fcdbc61b5e1"},{"title":"Wear OS ã‹ã‚‰ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã","link":"/posts/android_wear_os_open_smartphone_browser/","markdown":"\r\nã“ã®å ´åˆã¯ã‚¹ãƒãƒ›å´ã®ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹å¿…è¦ã¯ãªã„ã§ã™ã€‚\r\n\r\n# æœ¬é¡Œ\r\nWear OS ã‹ã‚‰ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ããŸã„å ´åˆã¯ã€ã‚¹ãƒãƒ›å´ã®ã‚¢ãƒ—ãƒªã‚’ä½œã‚‹å¿…è¦ã¯ãªã„ã‚ˆã£ã¦è©±\r\n\r\n# ã¤ãã‚‹\r\n\r\n## build.gradle\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã¾ã™\r\n\r\n```gradle\r\nimplementation(\"androidx.wear:wear-remote-interactions:1.0.0\")\r\n```\r\n\r\n## ã¦ãã¨ã†ã«\r\n\r\n`RemoteActivityHelper(context).startRemoteActivity`ã§ãƒ–ãƒ©ã‚¦ã‚¶ã«å‘ã‘ãŸ`Intent`ã‚’é£›ã°ã™ã“ã¨ã§é–‹ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚  \r\nåˆ¥ã«`Jetpack Compose`ã§ã‚ã‚‹å¿…è¦ã‚‚ãªã„ã§ã™ã€‚\r\n\r\n```kotlin\r\nBox(\r\n    modifier = Modifier.fillMaxSize(),\r\n    contentAlignment = Alignment.Center\r\n) {\r\n    val context = LocalContext.current\r\n    Chip(\r\n        label = { Text(text = \"ã‚¹ãƒãƒ›ã§é–‹ã\") },\r\n        secondaryLabel = { Text(text = \"ãƒ–ãƒ©ã‚¦ã‚¶ãŒé–‹ãã¾ã™\") },\r\n        onClick = {\r\n            // ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã\r\n            RemoteActivityHelper(context).startRemoteActivity(\r\n                Intent(Intent.ACTION_VIEW, \"https://takusan.negitoro.dev/\".toUri()).apply {\r\n                    // å¤šåˆ†ã„ã‚‹\r\n                    addCategory(Intent.CATEGORY_BROWSABLE)\r\n                },\r\n            )\r\n        },\r\n    )\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/5xMHMlr.png)\r\n\r\n## åˆ©ç”¨ä¾‹\r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«é£›ã°ã™ãªã©\r\n\r\n![Imgur](https://imgur.com/pOVWDbG.png)\r\n\r\nä»¥ä¸Šã§ã™ã€ãŠç–²ã‚Œæ§˜ã§ã—ãŸ 8888"},{"title":"ãƒ–ãƒ©ã‚¦ã‚¶ã¸Androidã®ç”»é¢ã‚’ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã§ãã‚‹ã‚¢ãƒ—ãƒªã€ãœã‚ã¿ã‚‰ãƒ¼ã‚’ä½œã£ãŸ","link":"/posts/android_zero_mirror/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€ï¼ˆãŠä¹…ã—ã¶ã‚Šã§ã™ï¼‰  \r\nD.C.4 Sweet Harmony ï½ãƒ€ãƒ»ã‚«ãƒ¼ãƒ4ï½ ã‚¹ã‚¤ãƒ¼ãƒˆãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\nã‚ã£ã¡ã‚ƒã„ã„ã§ã™ã­ã€ãƒ’ãƒ­ã‚¤ãƒ³ã¿ã‚“ãªã‹ã‚ã„ã„ï¼\r\n\r\nã“ã“ã®è©±ã»ã‚“ã¨ã‹ã‚ã„ã„  \r\n\r\n![Imgur](https://imgur.com/iBWxbJI.png)\r\n\r\nã“ã“ã»ã‚“ã¨ã™ã  \r\n\r\n![Imgur](https://imgur.com/7IlRZEE.png)\r\n\r\nã‚ããã  \r\n\r\n![Imgur](https://imgur.com/B36lbxb.png)\r\n\r\næœ¬ç·¨ã§ã¯ç„¦ç‚¹ãŒã‚ã¾ã‚Šå½“ã¦ã‚‰ã‚Œãªã‹ã£ãŸãƒ’ãƒ­ã‚¤ãƒ³ãŸã¡ã®ã‚¹ãƒˆãƒ¼ãƒªãƒ¼ãŒæœ¬ä½œã§ã¡ã‚ƒã‚“ã¨ã—ã¦ã¦ã„ã„ï¼  \r\n\r\n![Imgur](https://imgur.com/RKCEJn9.png)\r\n\r\n~~å®Ÿç”¨æ€§ã‚‚ã‚ã‚‹ã¨ãŠã‚‚ã†~~\r\n\r\n# æœ¬é¡Œ\r\nãœã‚ã¿ã‚‰ãƒ¼ã‚’ä½œã‚Šã¾ã—ãŸã€‚ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã‚¢ãƒ—ãƒªã§ã™ã€‚  \r\nã¨ã‚Šã‚ãˆãšãƒªãƒªãƒ¼ã‚¹ã—ã¾ã—ãŸãŒã€å¤šåˆ†å‹•ãç«¯æœ«ã®ã»ã†ãŒå°‘ãªã„ã¨æ€ã†â†ï¼ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/FwtzpvV.png)\r\n\r\nãƒ‹ã‚³ç”Ÿã®ã‚³ãƒŸãƒ¥ã®åå‰ã«ã‚ã‚Šãã†ã§ã™ãŒé–¢ä¿‚ãªã„ã§ã™ã€‚  \r\n\r\n# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\r\n- PlayStore\r\n    - https://play.google.com/store/apps/details?id=io.github.takusan23.zeromirror\r\n- GitHub\r\n    - https://github.com/takusan23/ZeroMirror\r\n- ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒãƒªã‚·ãƒ¼\r\n    - https://github.com/takusan23/ZeroMirror/blob/master/PRIVACY_POLICY.md\r\n\r\n# æ©Ÿèƒ½\r\n- ãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚ã‚Œã°è¦‹ã‚Œã‚‹ã€åŒã˜Wi-Fi (åŒã˜LAN) ã«æ¥ç¶šã—ã¦ã„ã‚‹ç«¯æœ«ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰è¦‹ã‚Œã¾ã™\r\n- è¨­å®šã¯ã»ã¼ãªã„\r\n- ç”»é¢ã ã‘ã˜ã‚ƒãªãã¦ã€ç«¯æœ«å†…éŸ³å£°ã‚‚å…±æœ‰ã•ã‚Œã‚‹ï¼ˆAndroid 10 ä»¥ä¸Šã€ãŒã‚“ã°ã£ãŸï¼‰\r\n- ä¸€å¿œãŠã¾ã‘æ©Ÿèƒ½ã¨ã—ã¦ã€`VP9`ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹æ©Ÿèƒ½ã‚‚ã‚ã‚Šã¾ã™ã€‚`H.264`ã¨æ¯”ã¹ã¦åŒã˜ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã ã¨å¤šåˆ†ãã‚Œã„ãªæ°—ãŒã™ã‚‹...\r\n- ãƒ–ãƒ©ã‚¦ã‚¶å´ã¯ç°¡å˜ãªHTMLã¨JavaScriptãŒæ›¸ã„ã¦ã‚ã‚‹ã ã‘\r\n    - WebSocketã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€å‹•ç”»å†ç”Ÿæ©Ÿèƒ½ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¥ç¶š ãŒã‚ã‚Œã°ãƒ–ãƒ©ã‚¦ã‚¶ä»¥å¤–ã§ã‚‚è¦–è´å´ã¯ç§»æ¤ã§ãã‚‹ã‹ã‚‚\r\n\r\nãƒ–ãƒ©ã‚¦ã‚¶ãŒã‚ã‚Œã°ä½¿ãˆã‚‹ â†’ ã»ã¼è¨­å®šãŒãªã„ â†’ Zero ( Config ) Mirroring â†’ ãœã‚ã¿ã‚‰ãƒ¼  \r\nçµæ§‹ç„¡ç†ã‚„ã‚Šãªã®ã§è² è·ãŒã‚„ã°ã„ã‹ã‚‚  \r\nã‚ã¨å‹•ç”»ã‚’ç´°åˆ‡ã‚Œã«ã—ã¦ã„ã‚‹ä»¥ä¸Šã€åˆ‡ã‚Šæ›¿ãˆã§ä¸€ç¬ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã¡ã‚ƒã„ã¾ã™...\r\n\r\n# ã–ã£ãã‚Šä»•çµ„ã¿\r\nç«¯æœ«ã®ç”»é¢éŒ²ç”»ã¨(ã‚ã‚Œã°)ç«¯æœ«å†…éŸ³å£°ã‚’é›†ã‚ã¦ã€å‹•ç”»ã‚’ç´°åˆ‡ã‚Œã«ã—ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã¸WebSocketã§é€ä¿¡ã—ã¦ã¾ã™ã€‚  \r\nã‚‚ã£ã¨ã„ã„æ–¹æ³•ãŒã‚ã£ãŸã‹ã‚‚ã—ã‚Œãªã„...\r\n\r\n![Imgur](https://imgur.com/czpAHGx.png)\r\n\r\n## çœŸé¢ç›®ã«ä»•çµ„ã¿\r\nAndroidã®ç”»é¢éŒ²ç”»ã€ç«¯æœ«å†…éŸ³å£°ã®å†…å®¹ã‚’`MediaProjection`ã§å—ã‘å–ã‚Šã¾ã™ã€‚  \r\nï¼ˆç”»é¢éŒ²ç”»ã¯`Surface`ã€ç«¯æœ«å†…éŸ³å£°ã¯`PCM`ï¼‰  \r\n\r\nå—ã‘å–ã£ãŸã‚‰`MediaCodec`ã§`H.264`ã‹ï¼ˆè¨­å®šã—ãŸã‚‰ï¼‰`VP9`ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¾ã™ã€‚  \r\nã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸã‚‰`MediaMuxer`ã‚’ä½¿ã„`mp4`ã‹`webm`ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¾ã™ã€ä¸€å®šæœŸé–“çµŒã£ãŸã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã¾ãŸä¿å­˜ã—ã¾ã™ã€‚  \r\nã§ããŸå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`WebSocket`ã‚’ä½¿ã£ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã¸é€šçŸ¥ã—ã¦ï¼ˆå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ï¼‰ã€ãƒ–ãƒ©ã‚¦ã‚¶ã®`<video> ã‚¿ã‚°`ã§å†ç”Ÿã—ã¾ã™ã€‚\r\n\r\nå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´°åˆ‡ã‚Œã§ä½œã£ã¦ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§å†ç”Ÿã—ã¦ã„ã‚‹ã ã‘ã§ã™ã€‚ã¯ã„\r\n\r\n## ã‚‚ã£ã¨ã„ã„æ–¹æ³•ãªã„ã®\r\n\r\n### HLS / MPEG-DASH\r\nãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é…ä¿¡ã¨ã„ãˆã°ã“ã‚Œï¼Ÿ  \r\n\r\n`HLS`ã¯`MediaMuxer`ãŒ`MPEG2-TS`ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¯¾å¿œã—ã¦ã„ãªã„ã®ã§ç„¡ç†ã§ã™ï¼(ã“ã‚Œã¯å¾Œè¿°)  \r\n`MPEG-DASH`ã‚‚`MediaMuxer`ãŒ`Fragmented MP4`ã‚’ä½œã‚Œãªã„ã®ã§å¤šåˆ†ç„¡ç†ã§ã™ã€‚  \r\n\r\nãƒ–ãƒ©ã‚¦ã‚¶ã§è¦‹ãŸã‹ã£ãŸã®ã§ï¼ˆè¿½åŠ ã®ã‚¢ãƒ—ãƒªãŒå¿…è¦ã¨ã‹ã¯æ•·å±…ãŒé«˜ã„ï¼ï¼‰ä»Šå›ã¯å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç´°åˆ‡ã‚Œã«ã—ã¦é€ã‚‹ã“ã¨ã«ã—ãŸã€‚  \r\n`iOS`ã ã¨å‡ºæ¥ã‚‹ã¿ãŸã„ãªã®ã§ã™ãŒæ®‹å¿µã§ã™ã­...\r\n\r\nï¼ˆffmpegï¼Ÿ ãƒã‚¤ãƒŠãƒªãŒå¤§ãããªã‚‹ä¸Šã«ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ãŒã­...ï¼‰\r\n\r\n# å¤§å¤‰ã ã£ãŸã“ã¨\r\n\r\n## MediaMuxer\r\n`MediaMuxer#addTrack`ãŒã‚¹ã‚¿ãƒ¼ãƒˆå‰ã˜ã‚ƒãªã„ã¨å‘¼ã¹ãªã„ãŸã‚ã€ä½¿ã„ã«ãã„ï¼  \r\nãã‚Œã¨ã¯åˆ¥ãªã®ã§ã™ãŒã€é«˜ãƒ¬ãƒ™ãƒ«APIã®`MediaRecorder`ã«ã¯`MPEG2-TS`ã®ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«å¯¾å¿œã—ã¦ã„ã‚‹ã®ã§ã™ã‚ˆã­ã€‚  \r\nä¸€æ–¹ä»Šå›ä½¿ã£ãŸä½ãƒ¬ãƒ™ãƒ«APIã®`MediaMuxer`ã«ã¯`MPEG2-TS`ã®ã‚µãƒãƒ¼ãƒˆã¯ã‚ã‚Šã¾ã›ã‚“ï¼ãˆé€†ã§ã¯\r\n\r\nãªã‚‰`MediaMuxer / MediaCodec`ã¨ã‹ã‚’ä½¿ã‚ãšã«ã€`MediaRecorder`ã‚’ä½¿ãˆã°`HLS`ã§é…ä¿¡å‡ºæ¥ãŸã®ï¼ï¼Ÿã£ã¦è©±ã«ãªã‚‹ã‚“ã§ã™ãŒã€  \r\nãªã‚‰ãªã„ã§ã™ã€‚å†…éƒ¨éŸ³å£°ã‚’åéŒ²ã—ã¦ä¸€ç·’ã®å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ãŸã‹ã£ãŸã®ã§ã€‚æ®‹å¿µã€‚  \r\nãã‚Œã«åŠ ãˆã¦ã€ã‚‚ã—å†…éƒ¨éŸ³å£°ãŒãªã‹ã£ãŸå ´åˆã§ã‚‚å‹•ç”»ã‚’çŸ­ã„é–“éš”ã§ä½œã‚Šç›´ã™ã®ã¯`MediaRecorder`ã§ã¯å¤šåˆ†é›£ã—ã„ã‚ˆã†ãªæ°—ãŒã—ã¾ã™ã€‚é…å»¶ãŒå¤§ãããªã‚Šãã†ã€‚\r\n\r\n## MediaCodec\r\n`MediaMuxer`ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œã‚Šç›´ã—ãŸå ´åˆã¯ã€`MediaCodec.BufferInfo`ã®`presentationTimeUs`ã‚’`0`ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚  \r\nhttps://github.com/takusan23/ZeroMirror/commit/3718678180bea6037c0e23d2686b2265b2d4e58f\r\n\r\nã‚ã¨`VP9`ã®å ´åˆã¯è§£åƒåº¦ãŒå³ã—ã„ã§ã™ï¼ˆ1920x1080ã€1280x720 ãªã‚‰å‹•ãï¼‰ã€ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã®ç”»é¢è§£åƒåº¦ã‚’ãã®ã¾ã¾å…¥ã‚ŒãŸã‚‰è½ã¡ã¦ã—ã¾ã†ã€‚\r\n\r\n## MP4ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡ºæ¥ãªã„\r\nmp4ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ãã‚‹ã‚ˆã†ã«ï¼ˆãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãªãŒã‚‰å†ç”Ÿï¼‰ã™ã‚‹ã«ã¯ã€`mp4`ãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«`moovãƒ–ãƒ­ãƒƒã‚¯`ã‚’ç½®ãå¿…è¦ãŒã‚ã‚‹ã‚‰ã—ã„ï¼ˆï¼Ÿï¼‰ã®ã§ã™ãŒã€  \r\n`MediaMuxer`ã®å ´åˆã¯æœ€å¾Œã«`moovãƒ–ãƒ­ãƒƒã‚¯`ã‚’ç½®ããŸã‚ã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å‡ºæ¥ã¾ã›ã‚“ï¼ˆå…¨éƒ¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã‹ã‚‰å†ç”Ÿã—ã¦ã—ã¾ã†ï¼‰\r\n`ffmpeg`ãŒå…¥ã£ã¦ã‚‹å ´åˆã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã“ã¨ã§ã€`moovãƒ–ãƒ­ãƒƒã‚¯`ã®ä½ç½®ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚\r\n\r\n```\r\nffmpeg -v trace -i ãƒ•ã‚¡ã‚¤ãƒ«.mp4 2>&1 | grep -e type:\\'mdat\\' -e type:\\'moov\\'\r\n```\r\n\r\nå¤šåˆ†ã“ã†ãªã£ã¦ã„ã‚Œã°æ­£è§£ãªã®ã§ã™ãŒ\r\n\r\n```sh\r\n$ ffmpeg -v trace -i  publish74.mp4  2>&1 | grep -e type:\\'mdat\\' -e type:\\'moov\\'\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 00000133f22a9a40] type:'moov' parent:'root' sz: 3844 32 1896645\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 00000133f22a9a40] type:'mdat' parent:'root' sz: 1889577 7076 1896645\r\n```\r\n\r\n`MediaMuxer`ã§å‡ºæ¥ãŸãƒ•ã‚¡ã‚¤ãƒ«ã¯`moovãƒ–ãƒ­ãƒƒã‚¯`ãŒä¸€ç•ªä¸‹ãªã®ã§ã™ã‚ˆã­...\r\n\r\n```sh\r\n$ ffmpeg -v trace -i  publish29.mp4  2>&1 | grep -e type:\\'mdat\\' -e type:\\'moov\\'\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 000002461b249a40] type:'mdat' parent:'root' sz: 1420893 3232 1427957\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 000002461b249a40] type:'moov' parent:'root' sz: 3840 1424125 1427957\r\n```\r\n\r\nã“ã®å•é¡Œã¯ã™ã§ã«å…ˆé§†ã‘è€…ã•ã‚“ãŒå¯¾å¿œã—ã¦ãã‚Œã¦ã„ã¾ã™ï¼  \r\nã™ã”ã„ï¼\r\n\r\n- https://qiita.com/yuya_presto/items/d48e29c89109b746d000\r\n- https://github.com/ypresto/qtfaststart-java\r\n\r\nä¸Šè¨˜ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãŠå€Ÿã‚Šã™ã‚‹ã“ã¨ã§ã€`moovãƒ–ãƒ­ãƒƒã‚¯`ã‚’å…ˆé ­ã«ç§»å‹•ã§ãã¾ã—ãŸã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼\r\n\r\n```sh\r\n$ ffmpeg -v trace -i  publish74.mp4  2>&1 | grep -e type:\\'mdat\\' -e type:\\'moov\\'\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 00000133f22a9a40] type:'moov' parent:'root' sz: 3844 32 1896645\r\n[mov,mp4,m4a,3gp,3g2,mj2 @ 00000133f22a9a40] type:'mdat' parent:'root' sz: 1889577 7076 1896645\r\n```\r\n\r\nã¡ãªã¿ã«ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å†ç”Ÿãªã®ã§ãƒãƒƒãƒ•ã‚¡ãƒªãƒ³ã‚°ã®è¡¨ç¤ºãŒã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/JnQyJg9.png)\r\n\r\nãªãŠ`WebM`ã®å ´åˆã¯ç‰¹ã«ä½•ã‚‚ã›ãšã¨ã‚‚ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯èƒ½ãªãƒ•ã‚¡ã‚¤ãƒ«ã«ã—ã¦ãã‚Œã‚‹ã¿ãŸã„\r\n\r\n![Imgur](https://imgur.com/9sI9oHv.png)\r\n\r\n# ã‚ˆãã‚ã‹ã‚‰ãªã„\r\n\r\n## ç«¯æœ«ã®å·®ãŒã‚ã‚‹\r\næ–°ã—ã‚ã®ç«¯æœ«ã˜ã‚ƒãªã„ã¨å‹•ã‹ãªã„ã£ã½ã„ï¼Ÿ  \r\nå‹•ã‹ãªã„ç†ç”±ã‚‚ã‚ˆãã‚ã‹ã‚‰ã‚“ï¼ˆ`MediaCodec`ã®ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ­ã‚°ãŒä¸è¦ªåˆ‡ï¼‰\r\n\r\n## Opusã ã¨éŸ³ãŒé«˜ã„ï¼Ÿ\r\nã“ã‚Œã¯ã¾ã˜ã§è¬ã§ã™ã€‚  \r\nãªã‚“ã‹ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã®è¨­å®šé–“é•ãˆãŸã®ã‹ãªã€‚\r\n\r\nè¿½è¨˜ï¼šã™ã„ã¾ã›ã‚“ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆé–“é•ã£ã¦ãŸã ã‘ã§ã—ãŸã€‚\r\n\r\n## VP9ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸå‹•ç”»ãŒãªã‚“ã‹Firefoxã ã‘å†ç”Ÿã§ãã‚‹\r\nã‚ã‹ã‚Šã¾ã›ã‚“ã€Chromeã ã¨å†ç”Ÿã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nPixel 6 Pro ã®ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¡ã‚‡ã£ã¨ã ã‘ç”»é¢å‚·å…¥ã£ã¡ã‚ƒã£ã¦æ‚²ã—ã„ã€‚\r\n\r\nD.C.5 ï¼ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/7d4KIrc.png)"},{"title":"CloudFront ãŒä½¿ãˆãªã„ã®ã§ AWS ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã«ãŠé¡˜ã„ã—ã¦ããŸ","link":"/posts/aws_support_center/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯  \r\n\r\n`AWS`ã®`CloudFront`ï¼ˆã¨ `CloudShell`ï¼‰ãŒä½¿ãˆãªã„ãŸã‚ã€ã‚µãƒãƒ¼ãƒˆã‚»ãƒ³ã‚¿ãƒ¼ã«å•ã„åˆã‚ã›ã¦ã¿ãŸãƒ¡ãƒ¢ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/nEYlRmL.png)\r\n\r\n```plaintext\r\nYour account must be verified before you can add new CloudFront resources. To verify your account, please contact AWS Support (https://console.aws.amazon.com/support/home#/ ) and include this error message.\r\n```\r\n\r\n\r\n![Imgur](https://imgur.com/t6oJtaq.png)\r\n\r\n# ã‚µãƒãƒ¼ãƒˆã‚±ãƒ¼ã‚¹ã‚’ã‚ªãƒ¼ãƒ—ãƒ³ã™ã‚‹\r\nã“ã“ã‹ã‚‰ã€‚ç„¡æ–™ã ã¨ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨æ”¯æ‰•ã„ãã‚‰ã„ã—ã‹å•ã„åˆã‚ã›ã§ããªã„ãƒ»ãƒ»ãƒ»\r\n\r\n![Imgur](https://imgur.com/NifY8ya.png)\r\n\r\nå†…å®¹ã‚’æ›¸ãã¾ã™\r\n\r\n![Imgur](https://imgur.com/Sh82E1t.png)\r\n\r\nãŠã¾ã˜ãªã„ç¨‹åº¦ã«ã‚¹ã‚¯ã‚·ãƒ§ã‚‚è²¼ã£ã¦ã¿ã‚‹\r\n\r\n![Imgur](https://imgur.com/B4AbKTw.png)\r\n\r\nã‚ã¨ã¯é€ä¿¡ã—ã¦å¾…ã¤\r\n\r\n![Imgur](https://imgur.com/UmaJoDS.png)\r\n\r\n# è¿”ä¿¡ãŒæ¥ã‚‹\r\nã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®åˆ©ç”¨çŠ¶æ³ã‹ã‚‰åˆ©ç”¨ä¸Šé™ã‚’å®šã‚ã¦ã„ã‚‹ã¨ã®ã“ã¨ã€‚  \r\nã¾ãŸã€`CloudShell`ã®åˆ©ç”¨äºˆå®šã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã‚‚èã‹ã‚ŒãŸã€‚\r\n\r\n# ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸ\r\nFreeãƒ—ãƒ©ãƒ³ã ã£ãŸã®ã§æ•°æ—¥ã‹ã‹ã‚Šã¾ã—ãŸãŒã€ç„¡äº‹åˆ©ç”¨åˆ¶é™ãŒè§£é™¤ã•ã‚Œã¾ã—ãŸã€‚è‰¯ã‹ã£ãŸè‰¯ã‹ã£ãŸ\r\n\r\n![Imgur](https://imgur.com/NSgTiV7.png)\r\n\r\n`CloudFront`ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼ï¼ï¼  \r\n\r\n![Imgur](https://imgur.com/APyhK5U.png)\r\n\r\n`CloudShell`ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  \r\n`cal`ã‚³ãƒãƒ³ãƒ‰ã§ã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã‚’é–‹ã„ã¦ã¿ã¾ã—ãŸã€‚  \r\n\r\nã‚‚ã—æ‰‹å…ƒã«`cal ã‚³ãƒãƒ³ãƒ‰`å©ã‘ã‚‹ç’°å¢ƒãŒã‚ã‚Œã°ã€`cal 9 1752`ã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å…¥åŠ›ã—ã¦è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚  \r\nå¤šåˆ†ä¸€é€±é–“ä»¥ä¸Šæ¬ ã‘ãŸã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ãŒå‡ºã¦ãã‚‹ã¯ãšã€‚\r\n\r\n![Imgur](https://imgur.com/vNgsSQA.png)\r\n\r\nè©³ã—ãã¯ï¼š https://ja.wikipedia.org/wiki/Cal_(UNIX)#ä»•æ§˜\r\n\r\nä»¥ä¸Šã§ã™ã€‚"},{"title":"è¨˜äº‹ä¸€è¦§ã«ã¡ã‚‡ã£ã¨ã ã‘æœ¬æ–‡ã‚’ä¹—ã›ã‚‹ã‚ˆã†ã«ã—ãŸ","link":"/posts/blog_tiramise/","markdown":"\nã§ãã‚‹é™ã‚ŠMarkdownã«å¤‰æ›´ã‚’åŠ ãˆãšã«ã‚„ã‚ŠãŸã„ã€‚\n\n# æœ¬é¡Œ\nã‚¿ã‚¤ãƒˆãƒ«é€šã‚Šã€‚ä»–ã®ãƒ–ãƒ­ã‚°ã«ã‚‚æœ‰ã‚‹ã‚ˆã­ã€‚ã‚ã‚Œã¤ã‘ãŸã„ã€‚\n\n### å…¬å¼ãƒ–ãƒ­ã‚°ã¯ã©ã†ã‚„ã£ã¦å®Ÿç¾ã—ã¦ã‚‹ã‹èª¿ã¹ã¦ã¿ãŸ\n- https://ja.nuxtjs.org/blog\n    - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã«`description`ã‚’è¿½åŠ ã—ã¦ã€æ–‡ç« ã®æœ€åˆã‚‰ã¸ã‚“ã‚’å…¥ã‚Œã¦ã‚‹ã€‚\n        - æ–°è¦ãªã‚‰ã„ã„ã‘ã©ã™ã§ã«ã‚ã‚‹Markdownã‚’æ›¸ãæ›ãˆã‚‹ã®ã¯ãªã‚\n\n# è©¦ã—ãŸã“ã¨\n## è¨˜äº‹ã‚’è¡¨ç¤ºã™ã‚‹è¦é ˜ã§ä½œã‚Œã°ãˆãˆã‚„ã‚“ï¼Ÿ\n`<nuxt-content>`ã«CSSã§é«˜ã•ã‚’æ±ºã‚ã‚Œã°ã„ã„ã®ã§ã¯ã£ã¦æ€ã£ã¦ã‚„ã£ãŸã‘ã©ã€ãªã‚“ã‹å´©ã‚Œã¡ã‚ƒã£ãŸã€‚\n\n# Markdownãã®ã¾ã¾ã®ãŒã»ã—ã„ã‚“ã ãŒï¼Ÿ\n`body`ã‚„`createAt`å¤‰æ•°ã¯ã‚ã‚‹ã‘ã©ã€MarkdownãŒãã®ã¾ã¾å…¥ã£ã¦ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã¯ç„¡ã„ã€‚  \n\nä»¥ä¸‹ä¸€ä¾‹ã€‚\n\n```js\n{\n  slug: 'blog_tiramise',\n  title: 'è¨˜äº‹ä¸€è¦§ã«ã¡ã‚‡ã£ã¨ã ã‘æœ¬æ–‡ã‚’ä¹—ã›ã‚‹ã‚ˆã†ã«ã—ãŸ',\n  created_at: '2020-11-16T00:00:00.000Z',\n  tags: [ 'è‡ªä½œãƒ–ãƒ­ã‚°', 'JavaScript' ],\n  toc: [\n    {\n      id: 'å…¬å¼ãƒ–ãƒ­ã‚°ã¯ã©ã†ã‚„ã£ã¦å®Ÿç¾ã—ã¦ã‚‹ã‹èª¿ã¹ã¦ã¿ãŸ',\n      depth: 3,\n      text: 'å…¬å¼ãƒ–ãƒ­ã‚°ã¯ã©ã†ã‚„ã£ã¦å®Ÿç¾ã—ã¦ã‚‹ã‹èª¿ã¹ã¦ã¿ãŸ'\n    },\n    { id: 'è¨˜äº‹ã‚’è¡¨ç¤ºã™ã‚‹è¦é ˜ã§ä½œã‚Œã°ãˆãˆã‚„ã‚“ï¼Ÿ', depth: 2, text: 'è¨˜äº‹ã‚’è¡¨ç¤ºã™ã‚‹è¦é ˜ã§ä½œã‚Œã°ãˆãˆã‚„ã‚“ï¼Ÿ' }\n  ],\n  body: {\n    type: 'root',\n    children: [\n      [Object], [Object], [Object],\n      [Object], [Object], [Object],\n      [Object], [Object], [Object],\n      [Object], [Object], [Object],\n      [Object], [Object], [Object],\n      [Object], [Object], [Object],\n      [Object], [Object], [Object]\n    ]\n  },\n  dir: '/posts',\n  path: '/posts/blog_tiramise',\n  extension: '.md',\n  createdAt: '2020-11-15T15:55:08.945Z',\n  updatedAt: '2020-11-15T16:12:29.217Z'\n}\n```\n\nã¡ãªã¿ã«`body.children`ã«æœ¬æ–‡ãŒå…¥ã£ã¦ã‚‹ã€‚ãŸã ã—è¤‡é›‘ã™ãã¦æ‰±ãˆãŸã‚ˆã†ãªã‚‚ã®ã§ã¯ãªã„æ¨¡æ§˜ã€‚\n\n# ç™ºå±•çš„ãªæ©Ÿèƒ½\nã«`content:file:beforeInsert`ã£ã¦ã®ãŒã‚ã‚‹ã§ã™ã‘ã©ã€ã“ã“ã§MarkdownãŒãã®ã¾ã¾å–å¾—ã§ãã‚‹ãã†ã§ã™ã‚ˆï¼ï¼Ÿ  \nã•ã‚‰ã«documentã¸ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¿½åŠ ã§ããŸã‚Šã§ãã¾ã™ã‚ˆ\n\n`nuxt.config.js`\n```js\nhooks: {\n  /**\n   * æœ¬æ–‡ã‚’æ›¸ã„ãŸéš›ã«å‘¼ã°ã‚Œã‚‹ã€‚ä»Šå›ã¯ã“ã“ã§æ–‡å­—æ•°ã‚’æ•°ãˆã¦ã„ã‚‹\n   */\n  'content:file:beforeInsert': (document) => {\n    if (document.extension === '.md') {\n        const text = document.text // Markdownã¨ã‚Œã‚‹ï¼\n    }\n  }\n}\n```\n\n## æœ¬æ–‡ã‚’ãƒãƒ©è¦‹ã›ã™ã‚‹ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£(ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿)ã‚’è¿½åŠ ã™ã‚‹\nã¤ã„ã§ã«æ–‡å­—æ•°ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¶³ã—ã¾ã—ã‚‡ã†ã€‚ãƒãƒ©è¦‹ã›ã¯100æ–‡å­—ã¾ã§è¦‹ã›ã‚‹ã£ã¦ã“ã¨ã§ã€‚\n\n```js\nexport default {\n  // çœç•¥\n  hooks: {\n    /**\n     * æœ¬æ–‡ã‚’æ›¸ã„ãŸéš›ã«å‘¼ã°ã‚Œã‚‹ã€‚ä»Šå›ã¯ã“ã“ã§æ–‡å­—æ•°ã‚’æ•°ãˆã¦ã„ã‚‹\n     */\n    'content:file:beforeInsert': (document) => {\n      if (document.extension === '.md') {\n        // æ–‡å­—æ•°ã‚’ç™»éŒ²ã™ã‚‹\n        const textCount = document.text.length\n        document.text_count = textCount\n        // ä¸€è¦§ã§å°‘ã—ã ã‘è¨˜äº‹ã‚’è¡¨ç¤ºã—ãŸã„ã®ã§ãã®ãŸã‚ã®\n        const description = document.text.substring(0, 100)\n        document.description = description\n      }\n    }\n  }\n}\n```\n\nã“ã‚Œãªã«ã—ã¦ã‚‹ã‹ã£ã¦è¨€ã†ã¨ã€Markdownã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å‹•çš„ã«è¶³ã—ã¦ã‚‹(å®Ÿéš›ã«ã¯è¶³ã—ã¦ãªã„ã‘ã©ã€JavaScriptã§æ‰±ã†ã¨ãã«ã¯è¿½åŠ ã•ã‚Œã¦ã‚‹)\n\n\nã‚ã¨ã¯Vueã§è¡¨ç¤ºã™ã‚‹ã ã‘ã§ã™ã€‚\n\n```vue\n<template>\n  <div>\n    <v-card\n      class=\"ma-2 pa-5\"\n      v-for=\"item in blogItems\"\n      outlined\n      :key=\"item.title\"\n    >\n      <nuxt-link :to=\"`/posts/${item.slug}`\">\n        <div class=\"headline mb-1 titleHover\">{{ item.title }}</div>\n      </nuxt-link>\n      <!-- æœ¬æ–‡ãƒãƒ©è¦‹ã› -->\n      <div>{{ item.description }} ...</div>\n      <v-divider></v-divider>\n      <div class=\"post-meta pa-2\">\n        <v-icon>mdi-file-upload-outline</v-icon>\n        <time>{{ new Date(item.created_at).toLocaleDateString() }} æŠ•ç¨¿</time>\n        <!-- ã‚¿ã‚° -->\n        <TagGroup :tags=\"item.tags\"></TagGroup>\n      </div>\n    </v-card>\n  </div>\n</template>\n```\n\nä»¥ä¸Šã§ã™ã€‚8888\n\n# ãŠã¾ã‘\n`nuxt/content`ã®ã‚³ãƒ³ãƒ†ãƒ³ãƒ„å–å¾—ã§`where()`ãƒ¡ã‚½ãƒƒãƒ‰ã§å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ãŸã„å ´åˆã¯ã“ã†ã§ã™\n\nè©³ã—ãã¯ï¼šhttps://docs.mongodb.com/manual/reference/operator/query/regex\n\n```js\n// ãƒ‡ãƒ¼ã‚¿å–å¾—\nasync asyncData({ $content, params }) {\n  const findItem = await $content(\"posts\")\n    // æ­£è¦è¡¨ç¾ã§å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã™ã‚‹ã€‚$optionsã£ã¦ã®ã§iã‚’å…¥ã‚Œã‚‹ã¨\n    // https://docs.mongodb.com/manual/reference/operator/query/regex\n    .where({ tags: { $regex: params.id, $options: \"i\" } }) // ã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã©ã†ã‹ã€‚\n    .sortBy(\"created_at\", \"desc\") // æŠ•ç¨¿æ—¥æ™‚é †ã«ä¸¦ã³æ›¿ãˆã‚‹\n    .fetch();\n  return { findItem };\n},\n```\n\nä»Šå›ã¯ã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã§ã™ãŒã€`title`ã§ã‚‚å‹•ãã¨æ€ã„ã¾ã™ã€‚  \n`$options:'i'`ã§å¤§æ–‡å­—å°æ–‡å­—ã‚’ç„¡è¦–ã—ã¦ãã‚Œã‚‹æ¨¡æ§˜ã€‚"},{"title":"Cloudflare Pages ã¨ Next.jsï¼ˆé™çš„æ›¸ãå‡ºã—ï¼‰","link":"/posts/cloudflare_pages_next_js/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nç›®æ¬¡ã®ã¨ã“ã‚ã®è¦‹ãŸç›®ã‚’è‹¥å¹²å¤‰ãˆã¦ã¿ã¾ã—ãŸï¼ˆè‰²å¤‰ãˆãŸã ã‘ï¼‰\r\n\r\n# æœ¬é¡Œ\r\nã©ã†ã‚„ã‚‰`Netlify`ã¨é•ã£ã¦ã€æ—¥æœ¬ã«`CDN`ãŒã‚ã‚‹ã‚‰ã—ãã€ï¼ˆæ—¥æœ¬ã‹ã‚‰ã‚‚ï¼‰èª­ã¿è¾¼ã¿ãŒæ—©ã„ã‚‰ã—ã„ã€‚  \r\nã“ã®ãƒ–ãƒ­ã‚°ã¯`Netlify`ã«ã‚ã‚‹ã‚ã‘ã§ã™ãŒï¼ˆè¨˜è¿°æ™‚æ™‚ç‚¹ï¼‰ã€ã‚‚ã—è‰¯ã•ãã†ãªã‚‰ç§»è¡Œã—ã¦ã‚‚è‰¯ã„ã‹ã‚‚ï¼Ÿ\r\n\r\n# é©å½“ã« Next.js ã§ã‚µã‚¤ãƒˆã‚’ä½œã‚‹\r\nä½œã‚Šã¾ã—ãŸã€‚  \r\nã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ã®RGBã‚’ãã‚Œãã‚Œå–ã‚Šå‡ºã—ã¦ã€æ˜ã‚‹ã•ã‚’æ›ã‘ç®—(0.0~1.0)ã™ã‚‹ã“ã¨ã§ç°¡æ˜“çš„ã«ã¡ã‚‡ã£ã¨æš—ã„è‰²ã¨æ˜ã‚‹ã„è‰²ã‚’å‡ºã™ã“ã¨ãŒã§ãã‚‹ã‚µã‚¤ãƒˆã§ã™ã€‚  \r\nã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ æ˜ã‚‹ã• ã¨ã‹ã§èª¿ã¹ãŸã‚‰ã“ã‚ŒãŒä¸€ç•ªæ—©ãã†ã ã£ãŸã®ã§...  \r\n\r\nhttps://github.com/takusan23/color-code-brightness\r\n\r\n![Imgur](https://imgur.com/ye0JoqI.png)\r\n\r\n# ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹\r\n\r\nã¯ã„ã€‚è¨€èªè¨­å®šã‹ã‚‰æ—¥æœ¬èªãŒé¸ã¹ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/byJ4gRk.png)\r\n\r\nã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹ã¨ã™ãã«ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¿ãŸã„ãªç”»é¢ãŒé–‹ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/oRe7you.png)\r\n\r\n# Pages ã‚’æŠ¼ã™\r\n\r\næ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŠ¼ã™ã¨ã“ã‚“ãªã®ãŒå‡ºã‚‹\r\n\r\n![Imgur](https://imgur.com/dzKHIwM.png)\r\n\r\nä»Šå›ã¯`GitHub`ã«ã‚ã‚‹`Next.js`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\nä»–ã«ã‚‚ãƒ­ãƒ¼ã‚«ãƒ«ã§é–‹ç™ºã—ãŸ`index.html / index.css / index.js`ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¦å…¬é–‹ã™ã‚‹æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚ãŠæ‰‹è»½ã§ã™ã­  \r\n\r\n![Imgur](https://imgur.com/NcfzvRF.png)\r\n\r\n`Next.js`ã‚’é¸ã‚“ã ã‚‰ã„ã„æ„Ÿã˜ã«ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã¨ã‹ãŒåŸ‹ã¾ã‚Šã¾ã—ãŸã€‚æ¥½ã ã­\r\n\r\n![Imgur](https://imgur.com/KsTCiKf.png)\r\n\r\nãƒ“ãƒ«ãƒ‰ãŒå§‹ã¾ã‚Šã¾ã—ãŸï¼ã“ã‚“ãªæ„Ÿã˜  \r\n\r\n![Imgur](https://imgur.com/SUvq8G1.png)\r\n\r\nãã—ãŸã‚‰ãªã‚“ã‹ã‚³ã‚±ãŸ\r\n\r\n## SyntaxError: Unexpected token '?'\r\n`Node.js`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒè¶³ã‚Šãªã„ï¼Ÿåˆã£ã¦ãªã„ã‚‰ã—ã„ã®ã§ã€åˆã‚ã›ã¾ã™ã€‚  \r\n\r\nhttps://developers.cloudflare.com/pages/platform/language-support-and-tools/\r\n\r\nç’°å¢ƒå¤‰æ•°ã«å…¥ã‚Œã‚‹æ–¹æ³•ã¨ã€`.nvmrc`ã‚’ãƒªãƒã‚¸ãƒˆãƒªã«ç½®ãæ–¹æ³•ï¼ˆ`package.json`ã¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã‚Œã‚‹ï¼‰ãŒã‚ã‚Šã¾ã™ãŒã€ã¨ã‚Šã‚ãˆãšå¾Œè€…ã§ã„ãã¾ã™ã€‚  \r\n\r\næ‰‹å…ƒã®é–‹ç™ºç’°å¢ƒã§`node -v`ã—ãŸã‚‰`v18.13.0`ã ã£ãŸã®ã§ãã†ã—ã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/AZriRlV.png)\r\n\r\nã“ã‚Œã§ã‚³ãƒŸãƒƒãƒˆã—ã¦ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¨è‡ªå‹•ã§ãƒ“ãƒ«ãƒ‰ãŒè©¦è¡Œã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚ç„¡äº‹ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã«æˆåŠŸã—ã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/EOn6lS1.png)\r\n\r\n# ç¢ºã‹ã«æ—©ã„æ°—ãŒã™ã‚‹\r\n`Netlify`ã§ã‚‚åŒã˜ã‚µã‚¤ãƒˆã‚’ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã¿ãŸã‘ã©ã€ã¡ã‚‡ã£ã¨ã ã‘`Cloudflare Pages`ã®ã»ã†ãŒèª­ã¿è¾¼ã¿æ—©ã„æ°—ãŒã™ã‚‹ã€‚  \r\nè‰¯ã•ãã†ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/233hxD5.png)\r\n\r\n`PageSpeed Insights`ï¼ˆä½•ä½¿ãˆã°ã„ã„ã‹çŸ¥ã‚‰ãªã„ã®ã§ã¨ã‚Šã‚ãˆãšï¼‰ã§æ¸¬ã£ã¦ã¿ã¾ã—ãŸãŒã€ã‚„ã£ã±`Cloudflare`ã®ã»ã†ãŒ`Speed Index`ã®æ•°å€¤ãŒè‰¯ã„ã§ã™ã­ã€‚  \r\n\r\n![Imgur](https://imgur.com/N1q0Cnz.png)\r\n\r\n# GitHub Actions ã‹ã‚‰ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ãã‚‹ã‹ç¢ºèª\r\nåˆ¥ã«`Cloudflare Pages`ã®ãƒ“ãƒ«ãƒ‰æ©Ÿèƒ½ã§ååˆ†ãªã®ã§ã™ãŒã€`GitHub Actions`ã‚’ä½¿ã£ã¦ãŸã®ã‚’è¾ã‚ã‚‹ã®ã¯å¯‚ã—ã„ã®ã§ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰ï¼ˆãªã‚“ã‹å‹•ã„ã¦ãŸã»ã†ãŒãŠã‚‚ã‚ã„â†ï¼Ÿï¼Ÿï¼Ÿï¼‰  \r\n\r\nhttps://developers.cloudflare.com/pages/how-to/use-direct-upload-with-continuous-integration/#use-github-actions\r\n\r\n## ã¡ã‚‡ã†ã©ã„ã„ action ãŒã‚ã£ãŸ\r\n\r\nã“ã¡ã‚‰ã‚’ä½¿ã‚ã›ã¦ã‚‚ã‚‰ã„ã¾ã—ã‚‡ã†ã€‚thx!\r\n\r\nhttps://github.com/cloudflare/pages-action\r\n\r\n## å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã‚’ç”¨æ„ã™ã‚‹\r\nGitHub Actions ã§ä½¿ã†æ©Ÿå¯†æƒ…å ±ã‚’ä½œã‚Šã«è¡Œãã¾ã™ã€‚  \r\nå¤šåˆ†2ã¤ã„ã‚‹\r\n\r\n### CLOUDFLARE_API_TOKEN\r\nã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒšãƒ¼ã‚¸ï¼Ÿã‚’é–‹ã„ãŸå¾Œã€APIãƒˆãƒ¼ã‚¯ãƒ³ã‹ã‚‰ä½œæˆã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/WLLj5k1.png)\r\n\r\nå¤šåˆ†ã“ã‚Œã§è‰¯ã„ã¯ãšã€‚ãƒˆãƒ¼ã‚¯ãƒ³ã¯ä¸€åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„ã®ã§ãƒ¡ãƒ¢å¸³ã¨ã‹ã«ã™ãã«ãƒ¡ãƒ¢ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/Ysdgaec.png)\r\n\r\n### CLOUDFLARE_ACCOUNT_ID\r\nãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã¨ãã®ã€ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰å¾Œã®URLã«ã¤ã„ã¦ã„ã‚‹(`dash.cloudflare.com/` ã‹ã‚‰)å€¤ã®ã“ã¨ã‚‰ã—ã„ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¿ã‚‹ã¨ãªã‚“ã‹è¤‡é›‘ãªã“ã¨æ›¸ã„ã¦ã‚ã‚‹ã‘ã©  \r\nï¼ˆâ†“ã¡ã‚‡ã†ã©å¡—ã‚Šã¤ã¶ã—ãŸã¨ã“ã‚ï¼‰\r\n\r\n![Imgur](https://imgur.com/RPXxh9i.png)\r\n\r\n### GitHub ã«ç™»éŒ²\r\nã“ã“ã‹ã‚‰ã§ãã¾ã™ã€‚  \r\n`New repositroy secret`ã§è¿½åŠ ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/B6bR67y.png)\r\n\r\n## GitHub Actions ã‚’ä½œã‚‹\r\n\r\nãã®ã¾ãˆã«ã€è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’æ­¢ã‚ã¦ãŠãã¾ã™\r\n\r\n![Imgur](https://imgur.com/2VjGfKF.png)\r\n\r\nãã—ãŸã‚‰ä»¥ä¸‹ã®ã‚ˆã†ãª`yaml`ã‚’æ›¸ãã¾ã™ã€‚  \r\n`projectName`ï¼ˆCloudflare Pages ä¸Šã§ã®åå‰ï¼‰ã¨`directory`ï¼ˆå‡ºåŠ›å…ˆã®ãƒ‘ã‚¹ï¼‰ã¯çš†ã•ã‚“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã”ã¨ã«åˆã‚ã›ã¦ç›´ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```yaml\r\n# GitHub Actions ã‹ã‚‰ Cloudflare Pages ã¸å…¬é–‹\r\n\r\n# åå‰\r\nname: Publish Cloudflare Pages\r\n\r\n# èµ·å‹•æ¡ä»¶ã€‚pushã¨æ‰‹å‹•èµ·å‹•\r\non:\r\n  push:\r\n  workflow_dispatch:\r\n\r\n# ã‚„ã‚‰ã›ã‚‹ã“ã¨\r\njobs:\r\n  build:\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - uses: actions/checkout@v2\r\n      \r\n      # Node.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\r\n      - name: Install Node.js\r\n        uses: actions/setup-node@v3\r\n        with:\r\n          node-version: 18.13.0\r\n\r\n      # ä¾å­˜é–¢ä¿‚\r\n      - name: Package install\r\n        run: npm i\r\n      \r\n      # æ›¸ãå‡ºã—\r\n      - name: Build page\r\n        run: npx next build && npx next export \r\n\r\n      # å…¬é–‹\r\n      - name: Publish to Cloudflare Pages\r\n        uses: cloudflare/pages-action@v1\r\n        with:\r\n          apiToken: ${{ secrets.CLOUDFLARE_API_TOKEN }}\r\n          accountId: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}\r\n          projectName: color-code-brightness\r\n          directory: out\r\n```\r\n\r\nã‚ã¨ã¯ push ã™ã‚Œã°å‹•ãã¯ãšã§ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«\r\n\r\n![Imgur](https://imgur.com/gwuOamY.png)\r\n\r\n# ãƒ‰ãƒ¡ã‚¤ãƒ³\r\n`Apexãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ä»¥å¤–ï¼‰`ã‚’ä½¿ã†å ´åˆã¯`Cloudflare DNS ???`ã¨ã‹è¨€ã†ã‚„ã¤ã«ç™»éŒ²ã—ãªã„ã¨ã„ã‘ãªã„ã‚‰ã—ã„ã€‚  \r\nãƒ¬ã‚¸ã‚¹ãƒˆãƒ©ã§ã¯ãªãã€ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ãŒå¤‰ã‚ã‚‹ã ã‘ãªã®ã§ãã“ã¾ã§å¤§å¤‰ã˜ã‚ƒãªã•ãã†ãªæ°—ã¯ã™ã‚‹ã€‚ï¼ˆä½•ã‚‚ã‚ã‹ã‚‰ãªã„ï¼‰  \r\n\r\nä»Šå›ã¯ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã¿ã¾ã™ã€‚ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®å ´åˆã¯ãƒãƒ¼ãƒ ã‚µãƒ¼ãƒãƒ¼ã®å¤‰æ›´ã¯å¿…è¦ãªã„ã‚‰ã—ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/t1ERNHe.png)\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥åŠ›ã—ã¦\r\n\r\n![Imgur](https://imgur.com/2pmxydu.png)\r\n\r\nè‡ªåˆ†ã® DNS ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼ ã‚’é¸ã¹ã°è‰¯ã•ãã†ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/UMYADH0.png)\r\n\r\nç§ã¯ `Google Domains` ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ DNS ã®è¨­å®šã‚’é–‹ãã€`Cloudflare Pages`ã®æŒ‡ç¤ºé€šã‚Šã«å…¥åŠ›ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Tcur1YT.png)\r\n\r\nãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã€å¤šåˆ†ã“ã‚Œã§å¾…ã£ã¦ã‚Œã°å®Œäº†ã™ã‚‹ã¯ãšã€‚æ¥½ã§ã™ã­\r\n\r\n![Imgur](https://imgur.com/ClLG1Fx.png)\r\n\r\næ­¯ç£¨ãã‹ã‚‰æˆ»ã£ã¦ããŸã‚‰é–‹ã‘ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¾ã—ãŸï¼ã¡ã‚ƒã‚“ã¨ https ã§ã™ï¼\r\n\r\n![Imgur](https://imgur.com/cqhSn0D.png)\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã‚ˆã•ãã†ï¼ï¼ï¼  \r\nå…¨ç„¶é–¢ä¿‚ãªã„ã‘ã© `GitHub Actions` å¤±æ•—ã—ãŸã‚‰ãƒ¡ãƒ¼ãƒ«ã§æ•™ãˆã¦ãã‚Œã‚‹ã®ã­ã€‚"},{"title":"CSSã§<code>ã®ä¸€è¡Œç›®ã ã‘ç©ºç™½ãŒã‚ã‚‹","link":"/posts/css_code_tag_padding_margin/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\né‡ã„è…°ã‚’ä¸Šã’ã¦èª¿æŸ»ã—ãŸã€‚\r\n\r\n# æœ¬é¡Œ\r\nãªã‚“ã‹ä¸€è¡Œç›®ã ã‘ç©ºç™½ãŒã‚ã‚‹\r\n\r\n![Imgur](https://imgur.com/4aTmscW.png)\r\n\r\n# ãªãŠã™\r\n`padding`ã€`margin`ã‚’`0px`ã«ã—ãŸã‚‰ç›´ã£ãŸã®ã§ãƒ¡ãƒ¢  \r\n`Vuetify`å°å…¥ä¸‹ã®CSSãŒä»¥ä¸‹ã®ä¾‹ãªã®ã§ã€`.v-application`ã¯ã„ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„\r\n\r\n```css\r\n.v-application code {\r\n    /* codeã‚¿ã‚°ã«ã¯paddingã¨marginã‚’ã‹ã‘ãªã„ã»ã†ãŒã„ã„ï¼Ÿ */\r\n    padding: 0px !important;\r\n    margin: 0px !important;\r\n    font-weight: initial !important;\r\n    border-radius: 5px !important;\r\n    font-family: 'Koruri Regular';\r\n    font-size: initial !important;\r\n}\r\n```"},{"title":"curl ã§ 200 è¿”ã£ã¦ãã‚‹ã®ã«ã€Node.js ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã¨ 403 ãŒè¿”ã£ã¦ãã‚‹ä»¶ã®èª¿æŸ»","link":"/posts/curl_successful_httpclient_error/","markdown":"\r\nã‚¿ã‚¤ãƒˆãƒ«é€šã‚Šã§ã€`curl`ã ã¨`200`ã§æˆåŠŸã™ã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒã€é©å½“ãªè¨€èªï¼ˆä»Šå›ã¯`Node.js`ï¼‰ã®`HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ`ã‚’ä½¿ã£ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€ãªãœã‹`403`ã§ã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ä»¶ã®èª¿æŸ»ã‚’ã—ã¾ã—ãŸã€‚\r\n\r\n# çµæœã¯...\r\n`Node.js`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã‹ã£ãŸ...  \r\n`Node.js 16`ã ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å¤±æ•—ã—ã¾ã™ãŒã€`18`ã«ã—ãŸã‚‰æ²»ã‚Šã¾ã—ãŸã€‚ãªãœ...\r\n\r\n# ã“ã®ä»¶ã®çµŒç·¯\r\n\r\n- ãŠä¸€äººæ§˜`Misskey`ã‚’å»ºã¦ãŸ\r\n- ãŠä¸€äººæ§˜`Misskey`ã‹ã‚‰ä¸€éƒ¨ã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¤œç´¢ã§ããªã„äº‹ãŒã‚ã‹ã£ãŸ\r\n    - ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨`403`ã‚¨ãƒ©ãƒ¼ã«ãªã£ã¦ã„ã‚‹\r\n    - `VPS`ã®`curl`ã§ã‚‚å¤±æ•—ã—ã¦ã„ã‚‹\r\n- æ‰‹å…ƒã®`Windows`ãƒã‚·ãƒ³ã§ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæˆåŠŸã™ã‚‹\r\n    - æ‰‹å…ƒã§ã‚‚å¤±æ•—ã‹ï½ã¨æ€ã„ãã‚„`ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ`ä»˜ã‘ãŸã‚‰å‹•ã„ãŸ\r\n        - `curl -H 'User-Agent: @takusan_23' https://example.com`\r\n- `VPS`ã®`IPã‚¢ãƒ‰ãƒ¬ã‚¹`ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆå…¥ã‚Šã—ã¦ã‚‹ã¨è€ƒãˆã‚‹\r\n- å¤§ä½“`Misskey`ã‚µãƒ¼ãƒãƒ¼ã¯`Cloudflare`ã§ãƒ—ãƒ­ã‚­ã‚·ã—ã¦ã„ã‚‹ã¯ãš...\r\n    - `Cloudflare`ã‚’ç–‘ã†\r\n- ã—ã‹ã—`misskey.io`ãªã©ã€`Cloudflare`ã‚’ä½¿ã£ã¦ã„ã‚‹ï¼ˆã§ã‚ã‚ã†ï¼‰ã‚µãƒ¼ãƒãƒ¼ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ãƒ•ã‚©ãƒ­ãƒ¼ã§ãã¦ã„ã‚‹\r\n    - ä»Šåº¦ã¯ç¹‹ãŒã‚‰ãªã„ã‚µãƒ¼ãƒãƒ¼ã‚’ç–‘ã†\r\n        - æ„å›³çš„ã«å¼¾ã„ã¦ã„ã‚‹ã¨ã‹ã¯è€ƒãˆã«ãã„ãŒ\r\n- ã¨æ€ã£ãŸãŒã€ä»–ã«ã‚‚ãŠä¸€äººæ§˜ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ç¹‹ãŒã‚‰ãªã„ã‚µãƒ¼ãƒãƒ¼ãŒå‡ºã¦ãã‚‹\r\n    - çŸ¥ã£ã¦ã‚‹é™ã‚ŠäºŒä»¶ãã‚‰ã„ã‚ã‚‹\r\n    - æµçŸ³ã«è¤‡æ•°ã®ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç‹™ã„æ’ƒã¡ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã¨ã¯è€ƒãˆã«ãã„\r\n        - ã˜ã‚ƒã‚`Cloudflare`ã‹ï¼Ÿ\r\n            - ã§ã‚‚ç¹‹ãŒã‚‹ã‚µãƒ¼ãƒãƒ¼ã‚ã‚‹ã‚“ã ã‚ˆãª\r\n- `ã‚°ãƒ­ãƒ¼ãƒãƒ«IPã‚¢ãƒ‰ãƒ¬ã‚¹`ã‚’å¤‰æ›´ã—ã¦ã¿ã‚‹\r\n    - `AWS Lightsail`ãªã‚‰`é™çš„IP`ã®ãƒ‡ã‚¿ãƒƒãƒã—ã¦ã‚¢ã‚¿ãƒƒãƒã™ã‚‹ã¨æ–°ã—ã„ã®ãŒé™ã£ã¦ãã‚‹\r\n        - ã—ã‹ã—ãƒ€ãƒ¡\r\n        - ã“ã“ã§`AWS`ãŒç‹™ã„æ’ƒã¡ã•ã‚Œã¦ã„ã‚‹ã®ã§ã¯ã¨è€ƒãˆã‚‹\r\n\r\n--- æŒ«æŠ˜ ---\r\n\r\n- ãµã¨ã€`AWS CloudShell`ã¨ã„ã†ã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚‹ã“ã¨ã«æ°—ä»˜ã\r\n    - ã™ãã«ä½¿ãˆã‚‹`Linux`ãƒã‚·ãƒ³ã¿ãŸã„ãªã‚„ã¤\r\n        - `Linux`ã—ã‹ç”¨æ„ã•ã‚Œã¦ãªã„ã‚¢ãƒ—ãƒªã¨ã‹ã‚’å…¥ã‚Œã¦ãŠãã¨è‰¯ã•ãã†\r\n            - `Windows`ã ã¨ä½¿ãˆãªã„ã‹ã‚‰ï½`EC2 / Lightsail`å»ºã¦ã¦ä½¿ã„ãŸã„`Linux`ã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã‚‹ï¼ã¿ãŸã„ãªã“ã¨ãŒå›é¿ã§ãã‚‹\r\n    - `curl`ã¨ã‹æ¤œè¨¼ç”¨ã®ãƒ„ãƒ¼ãƒ«ã‚’å…¥ã‚Œã¦ãŠãã¨è‰¯ã„ã®ã‹ãª\r\n- `AWS CloudShell`ã§`curl`ã—ã¦ã¿ã‚‹\r\n    - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€šã‚‹ï¼ï¼ï¼\r\n    - ã‚„ã£ã±`AWS Lightsail`ãŒç‹™ã„æ’ƒã¡ã•ã‚Œã¦ã„ã‚‹ã®ã§ã¯ã¨è€ƒãˆã‚‹\r\n\r\nä»–ã«æ¡ˆãŒãªã„ãŸã‚ä¸€æ—¦ã‚ãã‚‰ã‚ã‚‹\r\n\r\n- `Cloudflare` ãŒ `.dev` ã®ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ã‚µãƒãƒ¼ãƒˆã™ã‚‹\r\n- ç§ã®ãŠä¸€äººæ§˜ã‚‚`Cloudflare`ã§ãƒ—ãƒ­ã‚­ã‚·ï¼ˆ`Cloudflare DNS`ã‚’ä½¿ã†ï¼‰ã™ã‚Œã°`IPã‚¢ãƒ‰ãƒ¬ã‚¹`ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆå…¥ã‚Šã•ã‚Œã¦ã‚‹ã®ã‚‚æ²»ã‚‹ã®ã§ã¯ã¨äºˆæ¸¬\r\n    - å¤±æ•—\r\n    - ã¾ããã‚Œã¯ãã†ã€‚é–¢ä¿‚ãªã„ã‚ˆãª\r\n\r\næŒ«æŠ˜ã€‚ãã¬ã¬\r\n\r\n- ãµã¨ã€`EC2`ã§å»ºã¦ãŸã‚‰ã©ã†ãªã‚‹ã®ã‹è©¦ã—ãŸããªã‚‹\r\n    - ä»–ã«ã‚‚`AWS`ã§å‹•ã‹ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ãŒã‚ã£ã¦ã‚‚ãŠã‹ã—ããªã„ã¯ãš\r\n- ã¡ã‚‡ã†ã©ç„¡æ–™æ ãŒã‚ã‚‹\r\n    - `VPC`ã¨ã‹`ã‚µãƒ–ãƒãƒƒãƒˆãƒã‚¹ã‚¯`ã¨ã‹`CIDR`ã¨ã‹æ„å‘³ã‚ã‹ã‚“ãªã„ã‹ã‚‰é¿ã‘ã¦ãŸ\r\n        - ãŒã€`ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ VPC`ãŒã‚ã‚‹ã®ã§ãã‚Œã«`EC2`ã‚’è¿½åŠ ã™ã‚Œã°è‰¯ã„ã“ã¨ãŒåˆ¤æ˜\r\n        - ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’ä½¿ã†ã®ã¯ã‚ã‚“ã¾ã‚Šè‰¯ããªã„ã‚‰ã—ã„\r\n            - `ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—`ã§å¿…è¦æœ€ä½é™ã®ãƒãƒ¼ãƒˆã ã‘é–‹ã‘ã‚‹ã‚ˆã†ã«ã™ã‚‹ ãªã©\r\n- `Ubuntu 20.04`ã§å€Ÿã‚Šã¦ã¿ã‚‹\r\n    - `Amazon Linux`ã¯`CentOS`ç³»åˆ—ï¼Ÿã‚‰ã—ããƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼ãŒ`apt`ã˜ã‚ƒãªã„ã‚‰ã—ã„ã€‚ã®ã§é¸ã°ãªã‹ã£ãŸ\r\n- çµæœã¨ã—ã¦ã¯å¤±æ•—ã ã£ãŸã€‚\r\n    - åŒã˜ã‚¨ãƒ©ãƒ¼ãŒå¸°ã£ã¦ããŸ\r\n        - ã‚„ã£ã±ã‚Š`AWS`ãŒç‹™ã„æ’ƒã¡ã•ã‚Œã¦ã„ã‚‹ã®ã§ã¯ã¨ã¾ãŸè€ƒãˆã‚‹\r\n- ã“ã“ã§ã€åˆ¥ã®`Linux ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³`ã‚’é¸ã¶ã¨ã©ã†ãªã‚‹ã‹è¦‹ã¦ã¿ã‚‹\r\n    - `Linux ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³`ãŒ`Ubuntu`ã ã¨ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„`IPã‚¢ãƒ‰ãƒ¬ã‚¹`ãŒæ‰•ã„å‡ºã•ã‚Œã‚‹ã®ã§ã¯ã¨è€ƒãˆãŸ\r\n    - ã¨ã„ã†ã‚ã‘ã§`Amazon Linux`ã«ã—ã¦ã¿ã¾ã—ãŸã€‚æœ€æ–°ç‰ˆã§\r\n- `Amazon Linux æœ€æ–°ç‰ˆ`ã ã¨`curl`ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ãŒåˆ¤æ˜\r\n    - ï¼ï¼ï¼\r\n    - ï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\r\n    - æµçŸ³ã«`OS`ã®é•ã„ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æˆåŠŸã«å½±éŸ¿ã™ã‚‹ã®ã‹...ï¼Ÿã¨è€ƒãˆã‚‹\r\n- `Ubuntu 22.04 ï¼ˆè¨˜è¿°æ™‚æ™‚ç‚¹æœ€æ–°ç‰ˆï¼‰`ã§è©¦ã™\r\n    - `curl`ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€šã‚‹\r\n    - ã“ã®ç’°å¢ƒã«`Node.js 16`ã‚’å…¥ã‚Œã¦ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’è©¦ã—ã¦ã¿ã‚‹\r\n        - é€šã‚‰ãªã„...ï¼ï¼\r\n- **ã“ã“ã§ curl ã ã¨ 200 ãªã®ã« HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ã ã¨ 403 ã«ãªã‚‹è©±ãŒå§‹ã¾ã‚‹**\r\n    - ã¤ã¾ã‚Šã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®æˆåŠŸã«`IP ã‚¢ãƒ‰ãƒ¬ã‚¹`ã¯é–¢ä¿‚ãªã„ã€‚äº‹ãŒåˆ¤æ˜\r\n        - `AWS`ã ã‹ã‚‰ãƒ€ãƒ¡ã§ã¯ãªã„\r\n- `curl`ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¨åŒã˜ã‚ˆã†ã«`HTTP ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ`ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’æ›¸ã„ãŸ\r\n    - `curl`ã«`-v`ã‚’ã¤ã‘ã‚‹ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®è©³ç´°ãŒè¦‹ãˆã¾ã™\r\n        - `IP ã‚¢ãƒ‰ãƒ¬ã‚¹`ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ãªã„ã“ã¨ãŒã‚ã‹ã£ãŸãŸã‚ã€ä»Šåº¦ã¯ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ãŒæ‚ªã„ã®ã§ã¯ã¨\r\n            - ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ãƒ¼ã‚’`curl`ãŒä»˜ã‘ã¦ã„ã‚‹ã‚‚ã®ã¨åŒã˜ã«ã—ã¦ã¿ã‚‹\r\n- ãŒã€ã€ã ã‚\r\n    - ä»Šåº¦ã¯`Node.js`ã®`HTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒæ‚ªã„ã®ã§ã¯ã¨ç–‘ã„å§‹ã‚ã‚‹\r\n        - `axios`ã€`node-fetch`ã€`got`ã€`Node.js ã«æœ€åˆã‹ã‚‰ã‚ã‚‹ã‚„ã¤`ã‚’è©¦ã™ã‚‚`403`ã«ãªã‚‹\r\n            - `request`ã£ã¦ã‚‚ã†éæ¨å¥¨ã ã£ãŸã‚“ã§ã™ã­... ï¼›ï¼›\r\n        - `curl`ã§ã¯é€šã£ã¦ã‚‹ã®ã«...ï¼\r\n\r\n--- æŒ«æŠ˜ ---  \r\nã„ã‚„ã€æµçŸ³ã«ã“ã‚“ãªäº‹ã‚ã‚‹ã‹ï¼Ÿã§ã‚‚`Mastodon / Misskey`ã®`Issue`ã‚‚è¦‹ãŸã‘ã©ãªã„ã‚“ã ã‚ˆãªã€‚ï¼ˆ`webfinger`ã¨ã‹ã„ã†ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¢ã™ãƒ—ãƒ­ãƒˆã‚³ãƒ«ãŒã‚ã‚‹ã‚‰ã—ã„ï¼‰  \r\n`Cloudflare`ãŒã©ã†ã‚„ã‚‰å¼¾ã„ã¦ã‚‹ã‚‰ã—ã„ï¼Ÿã®ã§`Mastodon / Misskey`ã¯é–¢ä¿‚ãªã„ã‚„ã‚ã¨æ€ã£ãŸã‘ã©ãªã‚“ã‹1ä»¶ãã‚‰ã„ãƒ’ãƒƒãƒˆã—ã¦ã‚‚ãŠã‹ã—ããªã„ã¨æ€ã†ã‚“ã ã‘ã©ãª...\r\n\r\n- ãµã¨ã€`Node.js`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç–‘ã„å§‹ã‚ã‚‹\r\n    - ãã£ã‹ã‘ã¯`Misskey`ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã®è¨˜äº‹ï¼ˆå¿˜ã‚ŒãŸ...ï¼‰\r\n    - `Ubuntu 20 -> 22`ã«ã—ãŸã‚‰`curl`ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒé€šã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã¯ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¿ãƒƒã‚¯å‘¨ã‚Šã§æ›´æ–°ãŒã‚ã£ãŸã®ã§ã¯ã¨è€ƒãˆã‚‹\r\n    - `Node.js`ã‚‚æ›´æ–°ã™ã‚Œã°å†…éƒ¨ã®ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¹ã‚¿ãƒƒã‚¯ãŒæ›´æ–°ã•ã‚Œé€šã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§ã¯ã¨ã„ã†äºˆæ¸¬\r\n        - ã¨ã„ã†ã‹ã“ã‚Œã—ã‹ãªã„\r\n            - ä¼¼ãŸã‚ˆã†ãª`Issue`ãŒãªã„ã®ã€ç§ã®ãŠä¸€äººæ§˜ã¯`Ubuntu 20 / Node.js 16`ã§å¤ã„ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ã£ã¦ã‚‹èª¬ãŒã‚ã‚‹\r\n- **Node.js ã‚’ 18 ã«ã—ãŸã‚‰é€šã‚‹ã‚ˆã†ã«ãªã£ãŸï¼**\r\n    - ![Imgur](https://imgur.com/tuetWqI.png)\r\n    - `IP ã‚¢ãƒ‰ãƒ¬ã‚¹`ãŒç‹™ã„æ’ƒã¡ã•ã‚Œã¦ã‚‹ã¨ã‹`AWS`ã ã‹ã‚‰ãƒ€ãƒ¡ã¨ã‹`Cloudflare`ã«å«Œã‚ã‚Œã¦ã„ã‚‹ã¨ã‹ã§ã¯ãªãã€**å˜ã«ç§ã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒå¤ã„ã‹ã‚‰**ï¼ˆ`Ubuntu 20 / Node.js 16`ï¼‰ä¸€éƒ¨ã®ã‚µãƒ¼ãƒãƒ¼ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒ`403`ã«ãªã‚‹ã¿ãŸã„ã§ã—ãŸã€‚\r\n        - ã”ã‚ã‚“ãªã•ã„\r\n\r\n# ãŠã‚ã‚Šã«\r\nãªãŠã£ã¦ã‚ˆã‹ã£ãŸ"},{"title":"Google Domainsã§ãƒ‰ãƒ¡ã‚¤ãƒ³è²·ã£ãŸã‹ã‚‰Netlifyã§ä½¿ã†","link":"/posts/domain_katta/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nãƒ‹ã‚³ç”Ÿã§æ¡œTrickä¸€æŒ™è¦‹ã¾ã—ãŸã€‚ã«ã‚„ã«ã‚„æ­¢ã¾ã‚‰ã‚“ã‹ã£ãŸã€‚ä¸€è©±ã‹ã‚‰å‹¢ã„ã™ã”ã‹ã£ãŸã€‚\r\n\r\n# æœ¬é¡Œ\r\nãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è²·ã„ã¾ã—ãŸã€‚  \r\nä¸‰æ—¥å‰ãã‚‰ã„ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³åã©ã†ã™ã‚‹ã‹è€ƒãˆã¦ãŸã®ã§ã™ãŒã€ç‰¹ã«æ€ã„ã¤ã‹ãªã‹ã£ãŸã®ã§å¥½ããªãŠå¯¿å¸ã®åå‰(ã­ãã¨ã‚)ã«ã—ã¾ã—ãŸã€‚\r\n\r\n# ãƒ‰ãƒ¡ã‚¤ãƒ³å–å¾—\r\n[Google Domains](https://domains.google/intl/ja_jp/)ã§ã™ã€‚  \r\n`.dev`ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆã‹ã£ã“ã„ã„ã£ã¦ç†ç”±ï¼‰ã‚’å–ã‚Šã¾ã—ãŸã€‚ç¶­æŒã«ä¸€å¹´1400å††ã‹ã‹ã‚‹ãã†ã§ã™ã€‚  \r\nä¸€ç¬é«˜ãè¦‹ãˆã¾ã—ãŸãŒã€ãƒ‹ã‚³å‹•ã®ãƒ—ãƒ¬å¢ã¯ä¸€ãƒ¶æœˆ550å††ãªã®ã§ãã‚“ãªã“ã¨ãªã‹ã£ãŸã€‚  \r\n\r\n**Kyashã§æ‰•ãˆã¾ã—ãŸã€‚** ä¸‰äº•ä½å‹éŠ€è¡Œã‚¢ãƒ—ãƒªUSBãƒ‡ãƒãƒƒã‚°æœ‰åŠ¹ã ã¨èµ·å‹•ã—ãªã„ã‹ã‚‰å±¥æ­´è¦‹ã‚‹ã®ã‚ã‚“ã©ã„ã‚“ã ã‚ã€‚[^1]\r\n\r\n## è²·ã„æ–¹ï¼ˆã„ã‚‹ï¼Ÿï¼‰\r\n1:ã»ã—ã„ã®é¸ã¶ã€‚  \r\n![Imgur](https://imgur.com/SkLuylR.png)\r\n\r\nã‚¹ã‚¤ãƒƒãƒã¨ã‹ã¯ãã®ã¾ã¾ã«ã—ã¦æ¬¡ã¸\r\n\r\n2:è‡ªåˆ†ã®æƒ…å ±å…¥ã‚Œã‚‹ã€‚  \r\n![Imgur](https://imgur.com/TLrH5Gb.png)\r\n\r\nWhoisã£ã¦è¨€ã†ãƒ‰ãƒ¡ã‚¤ãƒ³æ‰€æœ‰è€…ã‚’æ¤œç´¢ã§ãã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ãã†ã§ã™ãŒã€ã“ã“ã«å…¥åŠ›ã—ãŸæƒ…å ±ã¯è¡¨ç¤ºã•ã‚Œãªã„ãã†ã§ã™ã€‚ã¦ã‹ãã†ã˜ã‚ƒãªã„ã¨å›°ã‚‹\r\n\r\n3:æ”¯æ‰•ã„  \r\n![Imgur](https://imgur.com/r18xLqi.png)\r\n\r\n~~æ¶ˆè²»ç¨æ€–ã„~~\r\n\r\n## Whoisã©ã†ãªã£ã¦ã‚“ã®ï¼Ÿ\r\næœãŸã—ã¦ç§ã®æƒ…å ±ã¯ã©ã®æ§˜ã«ä¿è­·ã•ã‚ŒãŸã®ã‹ã€‚  \r\n\r\nGoogle Domainsã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã«ã‚ã‚‹ã€**ç™»éŒ²ã®è¨­å®š**æŠ¼ã—ã¦ã€**å…¬é–‹é€£çµ¡å…ˆæƒ…å ±**ã«ã‚ã‚‹ã€**é€£çµ¡å…ˆæƒ…å ±**ã«æƒ…å ±ãŒæ›¸ã„ã¦ã‚ã‚‹ãã†ã§ã™ã€‚  \r\n\r\né–‹ãã¨ã€ã“ã‚“ãªæ„Ÿã˜ã«ï¼ˆã©ã“ã¾ã§å†™ã—ã¦è‰¯ã„ã®ã‹ã‚ã‹ã‚‰ã‚“ã‹ã‚‰é©å½“ã«æŠœç²‹ï¼‰ãªã£ã¦ã¾ã—ãŸã€‚\r\n\r\n```console\r\nRegistrar: Google LLC\r\nRegistry Registrant ID: REDACTED FOR PRIVACY\r\nRegistrant Name: Contact Privacy Inc. ãªã‚“ã¨ã‹ï½\r\nRegistry Admin ID: REDACTED FOR PRIVACY\r\nRegistry Tech ID: REDACTED FOR PRIVACY\r\n```\r\n\r\nå¤šåˆ†å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™\r\n\r\n# Netlifyã§ä½¿ã†\r\n\r\nã¾ãšNetlifyã§ç®¡ç†ç”»é¢ï¼Ÿã‚’é–‹ã„ã¦ã€ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’è¨­å®šã™ã‚‹ç”»é¢ã‚’é–‹ãã¾ã™ï¼ˆã‚¹ã‚¯ã‚·ãƒ§ã—ãã“ã­ãŸï¼‰\r\n\r\nãã—ãŸã‚‰ã“ã‚“ãªæ„Ÿã˜ã«è²·ã£ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å…¥ã‚Œã¦ï¼ˆä»Šå›ã¯ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã—ãŸï¼‰  \r\n\r\n![Imgur](https://imgur.com/xqMeXJO.png)\r\n\r\nDNSãŒãªã‚“ã¨ã‹ã£ã¦å‡ºã‚‹ã®ã§æŠ¼ã™ã¨ã€ã“ã®ç”»é¢ãŒå‡ºã‚‹ã¨æ€ã„ã¾ã™ã€‚  \r\nã“ã®å€¤ã¯ä½¿ã†ã®ã§ChromeäºŒçª“ã—ã¾ã—ã‚‡ã†ã€‚  \r\n![Imgur](https://imgur.com/Whn3UvK.png)\r\n\r\nãã—ãŸã‚‰ã€**Google Domains**ã®ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã«ã‚ã‚‹**DNS**ã‚’æŠ¼ã—ã¦ã€ä¸€ç•ªä¸‹ã«æœ‰ã‚‹ï¼ˆç·¨é›†æ™‚ç¾åœ¨ï¼‰**ã‚«ã‚¹ã‚¿ãƒ  ãƒªã‚½ãƒ¼ã‚¹ãƒ¬ã‚³ãƒ¼ãƒ‰**ã«ã‚¹ã‚¯ã‚·ãƒ§ã®ã‚ˆã†ã«æƒ…å ±ã‚’å…¥ã‚Œã¾ã™ï¼ˆå…¥åŠ›ã™ã‚‹å†…å®¹ã¯äººãã‚Œãã‚Œé•ã„ã¾ã™ã‹ã‚‰ã­ï¼ï¼‰ã€‚\r\n\r\n![Imgur](https://imgur.com/mg8hT6S.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚å¾Œã¯å¾…ã¤ã ã‘ã§ã™ã€‚ç§ã¯ä¸€æ™‚é–“ã—ãªã„é–“ä½ã«è²·ã£ãŸãƒ‰ãƒ¡ã‚¤ãƒ³ã§Netlifyã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã‚ãƒ¼ã„\r\n\r\nã¡ãªã¿ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã²ã‚‰ã‘ã‚‹ã‚ˆã†ã«ãªã£ãŸé ƒã«ã¯SSLã®è¨­å®šï¼ˆLet's Encryptï¼Ÿï¼‰ã‚‚è‡ªå‹•ã§ã‚„ã£ã¦ãã‚Œã¾ã—ãŸã€‚ã‚ã–ã™\r\n\r\n# Google Analytics ç›´ã™\r\nã‚’é–‹ã„ã¦ã€**ç®¡ç†**ã‚’æŠ¼ã—ã¦ã€**ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£è¨­å®š**é¸ã‚“ã§ã€**ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®URL**ã‚’ç›´ã—ã¦ã‚ã’ã¾ã™ã€‚`https://`ã¯ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«ã™ã§ã«ã‚ã‚‹ã®ã§ã€`https://`æŠœã„ãŸURLã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/ILmGn11.png)\r\n\r\n~~ã¾ã‚Analyticsç½®ã„ãŸã¨ã“ã‚ã§æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³ã«ä¹—ã‚‰ãªã„(ãªã‚“ã§ï¼Ÿ)ã®ã§æ„å‘³ãªã„~~\r\n\r\n# ãŠã‚ã‚Šã«\r\nGoogle Domainsã§è³¼å…¥ã™ã‚‹éš›ã«`å–¶åˆ©ç›®çš„ã‚‚ã—ãã¯å•†ç”¨åˆ©ç”¨ã§åˆ©ç”¨ã™ã‚‹å ´åˆã®ã¿åˆ©ç”¨ã§ãã‚‹`ã¿ãŸã„ãªã“ã¨ãŒæ›¸ã„ã¦ã‚ã£ãŸã‚“ã ã‘ã©å¤§ä¸ˆå¤«ã‹ãªï¼ˆï¼Ÿï¼‰  \r\n![Imgur](https://imgur.com/RtQKKEj.png)\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™\r\n\r\nhttps://hardworkers.dev/blog/google-domains-setting-netlify/\r\n\r\nhttps://blog.a-1.dev/post/2019-04-05-migrate-domain/\r\n\r\n[^1]:Logcatã«è¦‹ã‚‰ã‚ŒãŸã‚‰å›°ã‚‹å†…å®¹æµã—ã¦ã‚‹ã‚“ã‹ï¼Ÿ"},{"title":".NET Frameworkã‚’.Net Coreã¸ç§»è¡Œã™ã‚‹","link":"/posts/dotnet_framework_to_dotnet_core/","markdown":"\r\nãƒãƒŠãƒ¤ãƒã‚¿ä¸€æŒ™æ”¾é€ãƒ‹ã‚³ç”Ÿã§ã¿ã¾ã—ãŸï¼ˆãŠãã„ï¼‰ã€‚EDã®å…¥ã‚Šã™ã  \r\n\r\n# æœ¬é¡Œ\r\n.NET FrameworkãªWPFã‚¢ãƒ—ãƒªã‚’.NET Coreã¸ãŠå¼•è¶Šã—ã™ã‚‹\r\n\r\n# ãªã‚“ã§ï¼Ÿ\r\n[.NET Coreã§WPFã‚¢ãƒ—ãƒªä½œã‚‹ã](dotnet_wpf)ã§æ›¸ã„ãŸã‘ã©ã€\r\n\r\n- è‡ªå·±å®Œçµãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã§ãã‚‹\r\n    - åˆ©ç”¨è€…ãŒDotNET Frameworkã‚„DotNET Coreã‚’å…¥ã‚Œãªãã¦ã‚‚ã€å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«å…¨éƒ¨è©°ã‚ãŸ`exe`ã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹æ©Ÿèƒ½ã€‚\r\n        - ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚ŠãŒã¡\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã™ã€‚\r\n\r\n# ç§»è¡Œæ–¹æ³•\r\nhttps://docs.microsoft.com/ja-jp/dotnet/core/porting/#overview-of-the-porting-process\r\n\r\n.NET Portability Analyzer ç­‰ã¯ã‚ã‚“ã©ã„ã®ã§ä½¿ã‚ãªã„æ–¹å‘ã§ï¼ˆã‚ˆããªã„ï¼‰\r\n\r\nã‚ã¨ dotnet try-convert ãªã‚“ã¦è¨€ã†ç§»è¡Œãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ãŒãã‚Œã‚‚ä½¿ã‚ãªã„æ–¹é‡ã§\r\n\r\n# ç’°å¢ƒ\r\n\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|--|---|\r\n|ä»Šå›ä½¿ã†ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰|https://github.com/takusan23/RunCat_for_windows_nicomoba_ver|\r\n|Visual Studio|2019 Community|\r\n\r\n\r\n# ç§»è¡Œæ–¹æ³•ã‚’ç¢ºèªã™ã‚‹\r\n## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«(csproj)ã‚’é–‹ãã€ç°¡å˜ã«ç§»è¡Œã§ãã‚‹ã‹åˆ¤æ–­ã™ã‚‹\r\n[å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ](https://docs.microsoft.com/ja-jp/nuget/resources/check-project-format)ã€€â†ã“ã“ã‚‚è¦‹ã¦ã­\r\n\r\n.NET Coreã§ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«(.csproj)ã®ä¸­èº«ãŒç°¡ç´ åŒ–ã•ã‚Œã¦ã„ã¦ã€å…¨ç„¶åˆ¥ã®ã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚‹æ¨¡æ§˜ã€‚ç§ã‚‚ä½•ã«ä½¿ã£ã¦ã‚‹ã®ã‹ã‚ã‹ã‚‰ã‚“ã€‚    \r\n\r\nã¾ãš`ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼`ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã®ã¨ã“ã‚ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã‚¢ãƒ³ãƒ­ãƒ¼ãƒ‰`ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\n![Imgur](https://imgur.com/m90BD8l.png)\r\n\r\nãã—ãŸã‚‰ã‚‚ã†ä¸€å›ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã®ã¨ã“ã‚ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ç·¨é›† ãªã‚“ã¨ã‹.csproj`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/nrumkVX.png)\r\n\r\næŠ¼ã™ã¨è¬ã®XMLãƒ•ã‚¡ã‚¤ãƒ«ã¿ãŸã„ãªã®ãŒé–‹ãã®ã§ã€`project`è¦ç´ ï¼ˆ`<Project ToolsVersion ãªã‚“ã¨ã‹ï½`ã®ã¨ã“ã‚ï¼‰ã«ã€`Sdk`å±æ€§ï¼ˆ`Sdk=\"ãªã‚“ã¨ã‹\"`ï¼‰ãŒã‚ã‚Œã°ç°¡å˜ã«ç§»è¡Œã§ãã¾ã™ã€‚\r\n\r\nä»¥ä¸‹ã¯`Sdkå±æ€§`ãŒç„¡ã„ä¾‹ã§ã™ã€‚ã‚ˆã£ã¦ä»¥é™ã¯ã‚ã‚“ã©ã„ã§ã™\r\n\r\n![Imgur](https://imgur.com/F1fR6hP.png)\r\n\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<Project ToolsVersion=\"15.0\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">\r\n```\r\n\r\nã¾ã‚æ˜ã‚‰ã‹ã«è¡Œæ•°ãŒå¤šã‘ã‚Œã°ç–‘ã£ãŸã»ã†ãŒã„ã„ã§ã™ã€‚\r\n\r\n### ã‚‚ã— Sdkå±æ€§ ãŒå­˜åœ¨ã—ãŸå ´åˆã¯ï¼Ÿ\r\nãã®å ´åˆã¯ **æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«(.csproj)** ã£ã¦ã“ã¨ã§ä»¥ä¸‹ã®æ–¹æ³•ãŒä½¿ãˆã¾ã™ã€‚\r\n\r\nã•ã£ãé–‹ã„ãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­ã‹ã‚‰`<TargetFramework>`ã§å›²ã¾ã‚Œã¦ã„ã‚‹éƒ¨åˆ†ã‚’æ¢ã—ã¦ã€ãã®ä¸­ã‚’`netcoreapp3.1`ã«ã™ã‚Œã°ã‚‚ã†`.NET Core`ã¨ã—ã¦æ‰±ã£ã¦ãã‚Œã‚‹ãã†ã§ã™ã€‚  \r\n\r\n`Sdkå±æ€§`ãŒãªã„å ´åˆã¯`<TargetFramework>`ã‚‚ç„¡ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n## .NET Coreã¸\r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤ã„ã“ã¨ãŒåˆ¤æ˜ã—ãŸã®ã§ã€ãŠãã‚‰ã\r\n\r\n- æ–°ã—ã`.NET Core`ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¦ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ãƒªã‚½ãƒ¼ã‚¹ã‚’ç§»å‹•ã•ã›ã‚‹\r\n    - ä»Šå›ã¯ã“ã¡ã‚‰ã‚’å–ã‚Šã¾ã™\r\n- [dotnet try-convert](https://github.com/dotnet/try-convert)ã‚’ä½¿ã†ï¼ˆå°è¦æ¨¡ãªã‚‰æœ‰åŠ›å€™è£œï¼‰\r\n\r\n## ç©ºã®`.NET Core`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ\r\nä»Šå›ã¯`WinForm`ã£ã¦ã“ã¨ã§`Windows Forms App (.NET Core)`ã‚’é¸ã³ã¾ã—ãŸã€‚  \r\n\r\nåˆ¤åˆ¥æ–¹æ³•ã¯ã€ã¾ã‚`Program.cs`ã®`using`ã«`Forms`ã£ã¦æ–‡å­—ãŒã‚ã£ãŸã‹ã‚‰ã§ã™ã€‚ä»–ã«æ­£è¦ãƒ«ãƒ¼ãƒˆãŒã‚ã‚Šãã†ã€‚  \r\n`WPF`ã¨`Form`ã®åˆ¤åˆ¥ã£ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ã©ã“è¦‹ã‚Œã°ã‚ã‹ã‚‹ã‚“ã§ã™ã‹ã­ï¼ˆãˆï¼Ÿï¼‰ã€‚\r\n\r\nWPFã®å ´åˆã¯ **WPF App(.NET Core)** ã‚’é¸ã¹ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n### ã‚„ã‚‰ãªãã¦ã‚‚ã„ã„ã‘ã©\r\n.NET Coreã§ä½œã£ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†`ã‚’ãŠã™ã¨ã€ã™ã”ã„ç°¡ç´ åŒ–ã•ã‚ŒãŸ`csproj`ãŒè¦‹ã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚ã“ã‚“ãªã®\r\n\r\n```xml\r\n<Project Sdk=\"Microsoft.NET.Sdk.WindowsDesktop\">\r\n\r\n  <PropertyGroup>\r\n    <OutputType>WinExe</OutputType>\r\n    <TargetFramework>netcoreapp3.1</TargetFramework>\r\n    <UseWindowsForms>true</UseWindowsForms>\r\n  </PropertyGroup>\r\n\r\n</Project>\r\n```\r\n\r\n## ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã€ãƒªã‚½ãƒ¼ã‚¹ã®ç§»å‹•\r\nã¨ã„ã£ã¦ã‚‚`Program.cs`ã‚’åˆ‡ã‚Šè²¼ã‚Šã—ã¦ç§»è¡Œå‰(`.NET Framework`)ã¨åŒã˜ã‚ˆã†ã«ã™ã‚‹ã ã‘ã§ã™ã­ã€‚\r\n\r\n## Resource\r\nãƒªã‚½ãƒ¼ã‚¹ï¼ˆç”»åƒã¨ã‹ï¼‰ã‚’å…¥ã‚Œã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã¯ã€ä½•ã‚‚ã—ãªã„çŠ¶æ…‹ã ã¨ç”Ÿæˆã•ã‚Œãªã„ã®ã§ã€\r\n\r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå(`.NET Core`ã§ä½œæˆã—ãŸæ–¹)ã®éƒ¨åˆ†ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/uADCQCe.png)\r\n\r\nãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒé–‹ã‘ãŸã‚‰ã€`ãƒªã‚½ãƒ¼ã‚¹`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/6ZUL6Cd.png)\r\n\r\nã™ã‚‹ã¨ã“ã‚“ãªç”»é¢ã«ãªã‚‹ã®ã§ã€`ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯æ—¢å®šã®ãƒªã‚½ãƒ¼ã‚¹ï½`ã£ã¦æ›¸ã„ã¦ã‚ã‚‹éƒ¨åˆ†ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\nã‚ã¨ã¯ã“ã®ç”»é¢ã«ä½¿ã†ç”»åƒã‚’ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚‹ã¨ç”»åƒãŒç™»éŒ²ã•ã‚Œã¾ã™ã€‚  \r\nResourcesãƒ•ã‚©ãƒ«ãƒ€ã‚‚ç”Ÿæˆã•ã‚Œã¦ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/9qy2cK3.png)\r\n\r\nã‚ã¨ã¯C#ã®æ–¹ã§usingã‚’è¿½åŠ ã—ãŸã‚‰è§¦ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/BLkZMVJ.png)\r\n\r\n## ãƒ–ãƒ©ã‚¦ã‚¶èµ·å‹•ã§ããªã„\r\nã“ã†ã™ã‚Œã°ã„ã„ã§ã™ã€‚`.NET Core`ã®å•é¡Œã£ã½ã„ï¼Ÿ\r\n\r\n```cs\r\nProcessStartInfo psi = new ProcessStartInfo\r\n{\r\n    FileName = \"https://github.com/takusan23/RunCat_for_windows_nicomoba_chan_ver\",\r\n    UseShellExecute = true\r\n};\r\nProcess.Start(psi);\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\n[è‡ªå·±å®Œçµexeã®ä½œã‚Šæ–¹ã¯ã“ã“](dotnet_wpf)ã€‚ã“ã‚Œã‚’èª­ã‚ã°exeã‚’ç”Ÿæˆã—ã¦ã°ã‚‰ã¾ãäº‹ãŒã§ãã¾ã™ã€‚\r\n\r\nãƒ‹ã‚³ãƒ¢ãƒã¡ã‚ƒã‚“ã‹ã‚ã„ã„[^1]  \r\n![Imgur](https://imgur.com/ghhYzL3.png)\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ç½®ã„ã¨ãã¾ã™ã­ã€‚  \r\nhttps://github.com/takusan23/RunCat_for_windows_nicomoba_chan_ver/releases/tag/NicomobaChanVar_1.0\r\n\r\nã“ã®ã‚¢ãƒ—ãƒªã¯ã“ã®ã‚¢ãƒ—ãƒªã‚’ãƒ•ã‚©ãƒ¼ã‚¯ã—ã¦ä½œã£ãŸã€‚RunCatã‹ã‚ã„ã„ã€‚  \r\nhttps://qiita.com/Kyome/items/47aac4979933dac12263\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™\r\n\r\nhttps://codezine.jp/article/detail/11955?p=4\r\n\r\nhttps://qiita.com/tfukumori/items/37fe740ca0b81293c03f#5-%E7%A7%BB%E6%A4%8Dporting\r\n\r\nhttps://docs.microsoft.com/ja-jp/dotnet/core/porting/#overview-of-the-porting-process\r\n\r\nhttps://docs.microsoft.com/ja-jp/nuget/resources/check-project-format\r\n\r\n\r\n[^1] æ˜”ï¼ˆé…ä¿¡ã‚¢ãƒ—ãƒªãŒåˆ¥ã ã£ãŸé ƒã€‚nicocasã¨ã‹ç„¡ã‹ã£ãŸé ƒï¼‰ã‚¹ãƒãƒ›é…ä¿¡ã§éŸ³ã®ã¿ã«ãªã£ãŸã¨ãã«ã€Œãƒ‹ã‚³ãƒ¢ãƒã€ã£ã¦ã‚³ãƒ¡ãƒ³ãƒˆã™ã‚‹ã¨ãƒ‹ã‚³ãƒ¢ãƒã¡ã‚ƒã‚“ãŒèµ°ã£ã¦ãã‚ŒãŸã€‚"},{"title":".NET Coreã§WPFã‚¢ãƒ—ãƒªä½œã‚‹ã","link":"/posts/dotnet_wpf/","markdown":"\r\n.NET Coreã£ã¦ãªã«\r\n\r\n# ã»ã‚“ã ã„\r\nWPFãªã‚“ã¦ã‚ã£ãŸã«è§¦ã‚‰ã‚“ã‹ã‚‰æœªæ¥ã®ç§ãŒWPFã‚„ã‚‹æ™‚ã«è¦‹ã«æ¥ã‚‹è¨˜äº‹ã€‚  \r\n[WPFã‚¢ãƒ—ãƒªä½œã£ãŸã®ã§](../../posts/mousecursor_wpf/)ãã®æ™‚ã«èº“ã„ãŸã“\r\n\r\n# ç’°å¢ƒ\r\n|ãªã¾ãˆ|ã‚ãŸã„|\r\n|---|---|\r\n|OS|Windows 10 Pro 2004|\r\n|Visual Studio|Community 2019|\r\n\r\n# .NET Coreã£ã¦ãªã«\r\nã—ã‚‰ãªã„ã€‚ãªã‚“ã‹ã‚ˆãã‚ã‹ã‚‰ã‚“ã‘ã©ä½¿ã†ã€‚  \r\n.NET Coreã¯ã‚¯ãƒ­ã‚¹ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã£ã¦è¨€ã‚ã‚Œã¦ã‚‹ã‘ã©ã€WPFã«é–¢ã—ã¦ã¯Windowsã«ä¾å­˜ã—ã¦ã‚‹ã‹ã‚‰é–¢ä¿‚ãªã„ã‚ˆ\r\n\r\n[ã‚½ãƒ¼ã‚¹](https://docs.microsoft.com/ja-jp/windows/apps/desktop/modernize/modernize-wpf-tutorial)\r\n\r\n# Visual Studio 2019 å…¥ã‚Œã‚‹\r\næœ€æ–°ç‰ˆå…¥ã‚Œã¾ã—ã‚‡ã†ã€‚æœ€æ–°ç‰ˆã˜ã‚ƒãªã„ã¨`WPF App (.NET Core)`ãŒé¸ã¹ãªã„ã¨æ€ã„ã¾ã™ã€‚  \r\nã¡ãªã¿ã«ç§ã¯æœ€æ–°ç‰ˆã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹éš›ã€ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒ3GBã‚’è¶…ãˆã¦ã¾ã—ãŸã€‚ã‚¯ã‚½é•·ã‹ã£ãŸã‚ã€‚\r\n\r\n# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\r\næ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«`wpf`ã£ã¦å…¥ã‚Œã‚Œã°å‡ºã¾ã™ã€‚  \r\n`.NET Framework`ã˜ã‚ƒãªã„ã»ã†ã‚’é¸ã³ã¾ã—ã‚‡ã†ã­ã€‚\r\n![Imgur](https://imgur.com/BHxIloY.png)\r\n\r\n\r\nãã®å¾Œã®`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå`ã¨ã‹ã¯å„è‡ªæ±ºã‚ã¦ã­ã€‚\r\n\r\n# ã·ã‚ˆãã‚‰ã¿ã‚“ã\r\nä¹…ã€…ã®C#ãã‚“ã§ã™ã€‚  \r\nï¼ˆå¤šåˆ†ï¼‰Androidã¨åŒã˜æ„Ÿã˜ã§ã€xamlã§ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆæ±ºã‚ã¦ã€C#ã§ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã„ã¦ã„ãæ„Ÿã˜ã§ã™ãŒã€ã¡ã‚‡ã£ã¨é•ã†ã®ã­ã€‚\r\n\r\n- Androidã®`findViewById`\r\n    - C#ã§ã¯ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«`Name`ä»˜ã‘ã¨ã‘ã°C#ã‹ã‚‰æ‰±ãˆã‚‹ã€‚\r\n    - Kotlinã§findViewByIdãŒçœç•¥ã§ãã‚‹ã¿ãŸã„ãªæ„Ÿã˜ã§æ›¸ã‘ã‚‹ã€‚\r\n\r\n## ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ\r\n**MainWindow.xaml**\r\n\r\n```xml\r\n<Window x:Class=\"DotNetCoreWPF.MainWindow\"\r\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\r\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\r\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\r\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\r\n        xmlns:local=\"clr-namespace:DotNetCoreWPF\"\r\n        mc:Ignorable=\"d\"\r\n        Title=\"MainWindow\" Height=\"450\" Width=\"800\">\r\n    <Grid>\r\n        <TextBox FontSize=\"20\" HorizontalAlignment=\"Center\" Name=\"TimeTextBox\" Text=\"\" TextWrapping=\"Wrap\" TextAlignment=\"Center\" VerticalAlignment=\"Center\" Height=\"30\" Width=\"228\"/>\r\n\r\n    </Grid>\r\n</Window>\r\n```\r\n\r\nçœŸã‚“ä¸­ã«ãƒ†ã‚­ã‚¹ãƒˆã‚’è¡¨ç¤ºã™ã‚‹`TextBox`ã‚’ç½®ã„ãŸã ã‘ã§ã™ã€‚  \r\n\r\n## C#\r\n**MainWindow.cs**\r\nä¸Šã®`using`ã¯çœç•¥ã—ã¦ã‚‹ã®ã§æ°—ã‚’ã¤ã‘ã¦\r\n```cs\r\nnamespace DotNetCoreWPF\r\n{\r\n    /// <summary>\r\n    /// Interaction logic for MainWindow.xaml\r\n    /// </summary>\r\n    public partial class MainWindow : Window\r\n    {\r\n        public MainWindow()\r\n        {\r\n            InitializeComponent();\r\n\r\n            // ã‚¿ã‚¤ãƒãƒ¼åˆæœŸåŒ–\r\n            var dispatcherTimer = new DispatcherTimer();\r\n            dispatcherTimer.Tick += new EventHandler(dispatcherTimer_Tick);\r\n            dispatcherTimer.Interval = new TimeSpan(0, 0, 1);\r\n            dispatcherTimer.Start();\r\n\r\n        }\r\n\r\n        // ã‚¿ã‚¤ãƒãƒ¼ã§æ¯ç§’ã“ã“å‘¼ã°ã‚Œã‚‹ã€‚\r\n        private void dispatcherTimer_Tick(object sender, EventArgs e)\r\n        {\r\n            // æ™‚é–“ã‚’è¡¨ç¤º\r\n            TimeTextBox.Text = DateTime.Now.ToString();\r\n        }\r\n\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§ãƒ‡ã‚¸ã‚¿ãƒ«æ™‚è¨ˆã®å®Œæˆã§ã™ã€‚ã¯ã£ã£ã‚„\r\n\r\n![Imgur](https://imgur.com/ZmZzxBb.png)\r\n\r\n# exeã«ã™ã‚‹\r\n`.NET Framework`æ™‚ä»£ã§ã¯ã©ã†ã‚„ã£ã¦exeã‚’é…å¸ƒã—ã¦ãŸã®ã‹ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€  \r\n`.NET Core`ã§ã¯**è‡ªå·±å®Œçµå‹**ãŒä½¿ãˆã‚‹ãã†ã§ã™ã€‚ï¼ˆ.NET Frameworkã˜ã‚ƒã§ããªã„ï¼Ÿï¼‰  \r\n## è‡ªå·±å®Œçµå‹ #ã¨ã¯\r\nå¿…è¦ãªã‚‚ã®å…¨éƒ¨ã‚’ä¸€ã¤ã®`exeãƒ•ã‚¡ã‚¤ãƒ«`ã«ã§ãã‚‹æ©Ÿèƒ½ã€‚  \r\nã¡ã‚‡ã£ã¨å‰ã ã¨Windowsã®ãƒ•ãƒªãƒ¼ã‚½ãƒ•ãƒˆã‚’å…¥ã‚Œã‚‹éš›ã«ã€**.NET Framework ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã‚“ã¨ã‹ä»¥ä¸ŠãŒå¿…è¦**ã¿ãŸã„ãªã‚„ã¤ãŒã‚ˆãã‚ã‚Šã¾ã—ãŸãŒã€  \r\n`.NET Coreï¼ˆæ­£ç¢ºã«ã¯3.0ã‹ã‚‰ï¼‰`ã§ã¯.NET Coreï¼ˆ.NET Frameworkã®å¾Œç¶™ï¼‰ãŒå…¥ã£ã¦ã„ãªã„PCã§ã‚‚å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã€.NET Coreã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚„ã‚‰ãªã‚“ã‚„ã‚‰ã‚’ä¸€ã¤ã®exeã«ã„ã‚Œã¦ç’°å¢ƒã«é–¢ä¿‚ãªãå‹•ãã‚ˆã†ã«ãªã‚‹ã‚‰ã—ã„ã€‚  \r\nå¤‰ã‚ã‚Šã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãããªã‚‹ã‘ã©ã€‚  \r\n\r\nä»Šå›ã¯`.NET Core ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å…¥ã‚Šï¼ˆ.NET Coreå…¥ã£ã¦ãªã„PCã§ã‚‚å‹•ãã‚„ã¤ï¼‰`ã¨`.NET Coreã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç„¡ã—`ã®ä¸¡æ–¹ã‚’ã‚„ã‚ã†ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n## ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼é–‹ã„ã¦\r\nåå‰ã®ã¨ã“ã‚ã‚’æŠ¼ã—ã¦**ç™ºè¡Œ**ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/xjXxEdu.png)\r\n\r\n**ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼**ã‚’é¸ã‚“ã§æ¬¡ã¸\r\n\r\n![Imgur](https://imgur.com/WBZdhUB.png)\r\n\r\nãã®ã¾ã¾**å®Œäº†**æŠ¼ã—ã¦è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/gZPdL5D.png)\r\n\r\nãã—ãŸã‚‰å¾Œã‚ã®VS 2019ã®å†…å®¹ãŒç”»åƒã®ã‚ˆã†ã«å¤‰ã‚ã‚‹ã®ã§ã€**æ§‹æˆ**ã®ã¨ã“ã‚ã®é‰›ç­†ãƒãƒ¼ã‚¯ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/dGv9U3Z.png)\r\n\r\nãã—ã¦ã“ã®å…ˆã¯ä½œã‚ŠãŸã„exeãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ˆã£ã¦æ“ä½œãŒå¤‰ã‚ã‚Šã¾ã™ã€‚\r\n\r\n# .NET Core ãƒ©ãƒ³ã‚¿ã‚¤ãƒ å…¥ã‚Šã®exeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹\r\n\r\nãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šã§ã€**é…ç½®ãƒ¢ãƒ¼ãƒ‰**ã‚’**è‡ªå·±å®Œçµ**ã«ã—ã¾ã™ã€‚  \r\nãã‚Œã‹ã‚‰ã€ä¸‹ã®**ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¬é–‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ã‚’æŠ¼ã—ã¦ã€**å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ARUKDNH.png)\r\n\r\nãã—ãŸã‚‰ä¿å­˜ã—ã¦ã€**ç™ºè¡Œ**ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°ä½œæˆã•ã‚Œã¾ã™ã€‚\r\nä½œæˆã•ã‚ŒãŸ`exeãƒ•ã‚¡ã‚¤ãƒ«`ã¯`bin/Release/netcoreapp3.1/publish`ã®ä¸­ã«ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nå®Ÿéš›ã«èµ·å‹•ã—ã¦ã¿ãŸã®å›³ã€‚ã“ã‚Œã ã‘ãªã®ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã§ã‘ãˆã€‚\r\n![Imgur](https://imgur.com/hN2DDg4.png)\r\n\r\n# .NET Core ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ç„¡ã—ã®exeãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹\r\n\r\nãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«è¨­å®šã§ã€**é…ç½®ãƒ¢ãƒ¼ãƒ‰**ã‚’**ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¾å­˜**ã«ã—ã¾ã™ã€‚  \r\nãã‚Œã‹ã‚‰ã€ä¸‹ã®**ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¬é–‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³**ã‚’æŠ¼ã—ã¦ã€**å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ**ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/sRKKtZN.png)\r\n\r\nãã—ãŸã‚‰ä¿å­˜ã—ã¦ã€**ç™ºè¡Œ**ãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°ä½œæˆã•ã‚Œã¾ã™ã€‚\r\nä½œæˆã•ã‚ŒãŸ`exeãƒ•ã‚¡ã‚¤ãƒ«`ã¯`bin/Release/netcoreapp3.1/publish`ã®ä¸­ã«ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n\r\nå®Ÿéš›ã«èµ·å‹•ã—ã¦ã¿ãŸã®å›³ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯å°ã•ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/byF4X4v.png)\r\n\r\n\r\n# ãŠã‚ã‚Šã«\r\nã“ã‚Œã§æ­£è§£ãªã®ã‹ã¯ã‚ˆãåˆ†ã‹ã£ã¦ã„ãªã„ã€‚ \r\n\r\nã¨ã„ã†ã‹ãªã‚“ã§`TextBox`ä½¿ã£ãŸã®ï¼Ÿ`TextBlock`ã§è‰¯ã‹ã£ãŸã˜ã‚ƒã‚“ã€‚\r\n\r\nä¸€å¿œã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¨ãã¾ã™ã­â†’ https://github.com/takusan23/DotNetCoreWPF\r\n\r\nã‚ã¨å°‘ã—ãšã‚Œã‚‹ã‚“ã ã‘ã©ã€ç”»åƒã‚’å…¥ã‚Œã¦ã‚‚ä½•æ•…ã‹ã‚³ã‚±ã‚‹å•é¡Œã€‚ç”»åƒã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£é¸ã‚“ã§ã€ãƒ“ãƒ«ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚½ãƒ¼ã‚¹ã«ã™ã‚Œã°ã„ã„ã®ã­ã€‚æ™‚é–“å¥ªã‚ã‚ŒãŸã€‚\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™\r\n\r\n\r\nhttps://www.telerik.com/blogs/creating-a-single-exe-application-with-net-core\r\n\r\nhttps://techinfoofmicrosofttech.osscons.jp/index.php?.NET%20Core%E3%81%AE%E3%83%87%E3%83%97%E3%83%AD%E3%82%A4\r\n\r\nhttps://rksoftware.hatenablog.com/entry/2019/02/17/194701"},{"title":"é‹è»¢å…è¨±è¨¼ã‚’æ›´æ–°ã—ã¦ããŸ","link":"/posts/driver_license_kousin_syokai/","markdown":"\r\nã¡ã‚‡ã£ã¨å‰ã®è©±\r\n\r\n# ã‚„ã‚‹ã“ã¨\r\n\r\n## è©¦é¨“å ´ã«è¡Œã\r\nä¼‘æ—¥ã¯æ··ã‚“ã§ã‚‹ã‚‰ã—ã„  \r\n\r\n## å—ä»˜\r\nå—ä»˜ã§ä½æ‰€ã¨ã‹æ›¸ãç´™ã‚’ã‚‚ã‚‰ã„æ›¸ãã¾ã™ã€‚\r\n\r\n## æ”¯æ‰•ã„\r\nãƒã‚¬ã‚­ã«æ›¸ã„ã¦ã‚ã‚‹æ–™é‡‘ã‚’æ‰•ã„ã¾ã™ã€‚  \r\nã‚«ãƒ¼ãƒ‰ã‚‚ä½¿ãˆãã†ãªé›°å›²æ°—ã‚ã£ãŸã‘ã©è¨€ã„å‡ºã—ã¥ã‚‰ã„ã‹ã‚‰ç¾é‡‘ã«ã—ã¾ã—ãŸã€‚\r\n\r\n## è¦–åŠ›æ¤œæŸ»\r\nãã®ã¾ã‚“ã¾\r\n\r\n## IC ã‚«ãƒ¼ãƒ‰ã®æš—è¨¼ç•ªå·ã‚’æ±ºã‚ã‚‹\r\nå››æ¡ã®æ•°å­—ã‚’2ã¤ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆPIN 1 / PIN 2ï¼‰  \r\né‹è»¢å…è¨±è¨¼ IC ä»•æ§˜æ›¸ã«ã‚ˆã‚‹ã¨ã€`PIN 1 / PIN 2`ã¯åŒã˜æ•°å­—ã§ã‚‚å•é¡Œãªã„ã‚‰ã—ã„ã§ã™ã€‚  \r\n\r\n`é‹è»¢å…è¨±è¨¼åŠã³é‹è»¢å…è¨±è¨¼ä½œæˆã‚·ã‚¹ãƒ†ãƒ ç­‰ä»•æ§˜æ›¸ï¼ˆä»•æ§˜æ›¸ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ï¼š009)`ã‚ˆã‚Š  \r\n`2-5` å‚ç…§\r\nhttps://www.npa.go.jp/laws/notification/koutuu/menkyo/menkyo20220830_187.pdf\r\n\r\n## ä½•ã‚„ã£ãŸã‹å¿˜ã‚ŒãŸ\r\nãªã‚“ã ã£ã‘ã€ä»ŠæŒã£ã¦ã‚‹å…è¨±è¨¼ã«ç©´é–‹ã‘ã¦ãŸã€‚  \r\nç©´ç©ºã„ãŸã®ã§å¤šåˆ†ã‚‚ã† NFC ã¯åå¿œã—ãªã„ã€‚\r\n\r\n## é¡”å†™çœŸã®æ’®å½±\r\nãã®å‰ã«ãªã‚“ã‹ã‚„ã£ãŸæ°—ãŒã™ã‚‹ã‘ã©...  \r\nåº§ã£ã¦ã™ãæ’®å½±ã ã£ãŸ  \r\nçµ‚ã‚ã£ãŸã‚‰ã™ãæ¬¡ã®å ´æ‰€ã¸\r\n\r\n## è¬›ç¿’ã‚’èã\r\nå¹³æ—¥ã«è¡Œã£ãŸã‚“ã§ã™ã‘ã©ã€åŠåˆ†ãã‚‰ã„éƒ¨å±‹ãŒåŸ‹ã¾ã£ã¦ã¾ã—ãŸã­ã€ã€ã€  \r\nä¼‘æ—¥æ¥ãŸã‚‰ã©ã†ãªã£ã¦ãŸã‚“ã ã‚ã†ã“ã‚Œï¼ˆæ™®é€šã«å…¥ã‚Œãªã„ã¨æ€ã†ã‚“ã ã‘ã©ã€ã€ã€éƒ¨å±‹ãŒå¢—ãˆã‚‹ã‚“ã§ã—ã‚‡ã†ã‹ï¼‰\r\n\r\nåˆå›ã¯äºŒæ™‚é–“ã‚³ãƒ¼ã‚¹  \r\nãªã‚“ã‹è‡ªå·±è¨ºæ–­ã‚„ã£ãŸã‹ã‚‰ç­†è¨˜ç”¨å…·ãŒå¿…è¦ãã†  \r\n\r\nãªã‚“ã‹é•åã®è©±ã¨ã‹äº‹æ•…ã®è©±ã¨ã‹ä¿é™ºã®è©±ã¨ã‹ã‚’ã™ã‚‹ã€‚æœ€å¾Œã«DVDè¦‹ã¦çµ‚äº†ã€‚  \r\n\r\nãƒ¢ãƒã‚¤ãƒ«ãƒãƒ¼ãƒˆãƒ‘ã‚½ã‚³ãƒ³ãã‚‰ã„ã®å¤§ãã•ã®ç´™è¢‹ã‚’æŒã¡å¸°ã‚‹ã®ã§ã‚«ãƒãƒ³ã¨ã‹æŒã£ã¦ãŸã»ã†ãŒè‰¯ã•ãã†\r\n\r\n## æ–°ã—ã„å…è¨±è¨¼ã‚’ã‚‚ã‚‰ã†\r\nã‚ã¨ã¯æ–°ã—ã„å…è¨±è¨¼ã‚’ã‚‚ã‚‰ã£ã¦ã€  \r\nICã‚«ãƒ¼ãƒ‰ã®è¨˜è¼‰åˆã£ã¦ã‚‹ã‹è¦‹ã¦çµ‚ã‚ã‚Šã€‚\r\n\r\n# ä»¥ä¸Šã§ã™\r\nã¯ã„"},{"title":"Fanzaã§ã‚¨ãƒ­ã‚²ã‚’è²·ã†","link":"/posts/eroge/","markdown":"<img src=\"https://imgur.com/aAhcJek.png\" width=\"400\">  \r\n\r\nã‹ã‚ã„ã„\r\n\r\n## æœ¬é¡Œ\r\nã‚»ã‚¤ã‚¤ã‚­ã‚·ãƒªãƒ¼ã‚ºä¸‰ä½œç›®ãŒã‚»ãƒ¼ãƒ«ä¸­ã ã£ãŸã®ã§è²·ã£ã¦ã¿ã‚‹\r\n\r\n### ãƒ­ã‚°ã‚¤ãƒ³ã‚’ã™ã‚‹\r\nç„¡ã„å ´åˆã¯ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n### ã‚²ãƒ¼ãƒ ã‚’é¸ã¶\r\nä»Šå›ã¯ä»Šã™ãè³¼å…¥ã‚’ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/2W67sS5.png)\r\n\r\n### æ±ºæ¸ˆç”»é¢\r\nã“ã‚“ãªæ„Ÿã˜  \r\n![Imgur](https://imgur.com/xqp8v92.png)\r\n\r\n### ã‚²ãƒ¼ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\næ±ºæ¸ˆãŒçµ‚ã‚ã‚‹ã¨è³¼å…¥æ¸ˆã¿å•†å“ä¸€è¦§ç”»é¢ã«ãªã‚‹ã®ã§ã€è²·ã£ãŸã‚²ãƒ¼ãƒ ã‚’é¸ã‚“ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ã‚‡ã†ã€‚  \r\n![Imgur](https://imgur.com/nncOhcN.png)\r\n\r\nã‚ã¨ã‚½ãƒ•ãƒˆé›»æ± ãŒå¿…è¦ã£ã¦è¨€ã‚ã‚Œã¦ã¾ã™ãŒã€åˆå›èµ·å‹•æ™‚ã«ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã®ã§ã¾ã‚é£›ã°ã—ã¾ã™ã€‚\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã‚‰è§£å‡ã‚’ã—ã¾ã™ã€‚ãã†ã„ãˆã°çš†ã•ã‚“ã¯**è§£å‡**æ´¾ï¼Ÿãã‚Œã¨ã‚‚**å±•é–‹**æ´¾ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/w6wu3TO.png)\r\n\r\n#### è¤‡æ•°ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«åˆ†ã‹ã‚Œã¦ã„ã‚‹å ´åˆã¯\r\nï¼ˆæ°—ã«ãªã‚‹ã‹ã‚‰è²·ã£ã¦ã¿ãŸï¼‰  \r\nçµåˆãƒ•ã‚¡ã‚¤ãƒ«ã¨ã€åˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãã‚Œãã‚Œãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ãƒ•ã‚¡ã‚¤ãƒ«ã¯å…¨éƒ¨åŒã˜ãƒ•ã‚©ãƒ«ãƒ€ã«ä¿å­˜ã—ãªã„ã¨é§„ç›®ã ã¨æ€ã†ã€‚  \r\nã‚ã¨`WinRAR`ãŒå¿…è¦ãªé›°å›²æ°—ï¼ˆãªãœã‹å¤‰æ›ã§ããªã„ï¼ˆã§ãã¦ã‚‹ï¼‰ï¼‰ã‚’å‡ºã—ã¦ã¾ã™ãŒã€  \r\nåˆ¥ã«å¿…è¦ãªã„ã§ã™ã€‚ï¼ˆã“ã®å ´åˆã¯å¤šåˆ†å±•é–‹ã‚½ãƒ•ãƒˆã™ã‚‰ã„ã‚‰ãªã„ï¼‰\r\n\r\n![Imgur](https://imgur.com/aahdbxW.png)\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒçµ‚ã‚ã£ãŸã‚‰ã€çµåˆãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`exe`ã®ã»ã†ï¼‰ã‚’èµ·å‹•ã—ã¾ã™ã€‚  \r\nå°‘ã—å¾…ã¤ã¨`Windows Defender`ãŒè­¦å‘Šã‚’å‡ºã—ã¾ã™ãŒãã®ã¾ã¾å®Ÿè¡Œ\r\n\r\n![Imgur](https://imgur.com/h8FHq48.png)\r\n\r\nãã—ãŸã‚‰ãªã‚“ã‹è‹±èªã«ãªã£ã¦ã„ã¾ã™ãŒã€`Extract`ã‚’ãŠã—ã¦è§£å‡ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚è§£å‡å…ˆã‚’å¤‰ãˆãŸã„å ´åˆã¯`Browse`ã‚’æŠ¼ã›ã°ã„ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/pxjE53W.png)\r\n\r\n### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’èµ·å‹•\r\nä»Šå›è²·ã£ãŸã‚²ãƒ¼ãƒ ã¯`setup.exe`ã‚’å®Ÿè¡Œã™ã‚‹ã“ã¨ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒã§ãã¾ã™ï¼ˆä»–ã®ã‚²ãƒ¼ãƒ ã¯çŸ¥ã‚‰ãªã„ï¼‰  \r\nä¿å­˜å…ˆç­‰ã¯ãŠå¥½ã¿ã§\r\n\r\n### èªè¨¼\r\næœ€å¾Œã«ã€èªè¨¼ã‚’æ¸ˆã¾ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¿å­˜å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€ã¸ç§»å‹•ã—ã¦ã€ä¸€åº¦ã‚²ãƒ¼ãƒ ã‚’é–‹ãã¾ã™ã€‚  \r\nç§ã®å ´åˆã¯äºŒå›ç›®ãªã®ã§ã™ã§ã«ã‚½ãƒ•ãƒˆé›»æ± ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/lK6nfN0.png)\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã‚½ãƒ•ãƒˆé›»æ± ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nãƒªãƒ³ã‚¯ï¼šhttp://www.soft-denchi.jp/comdocs/dlguide/index.htm\r\n\r\n![Imgur](https://imgur.com/1QTXaf1.png)\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‚‰ã‚‚ã†ä¸€åº¦ã‚²ãƒ¼ãƒ ã‚’èµ·å‹•ã•ã›ã¦ã¿ã¾ã™ã€‚ã™ã‚‹ã¨èªè¨¼ç”»é¢ãŒå‡ºã‚‹ã®ã§ã€  \r\nè³¼å…¥æ™‚ã«ä½¿ã£ãŸDMMã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ¡ã‚¢ãƒ‰ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦`é€ä¿¡ã™ã‚‹`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/FDQ6r6x.png)\r\n\r\næˆåŠŸã™ã‚Œã°ã‚²ãƒ¼ãƒ ãŒèµ·å‹•ã—ã¾ã™ã€‚ã‚„ã£ãŸã­\r\n"},{"title":"Nuxt.jsã¨processmdã§ãƒ–ãƒ­ã‚°ä½œã‚ŠãŸã„ã€‚","link":"/posts/first/","markdown":"**Nuxt.js+processmd**ã§ãƒ–ãƒ­ã‚°ä½œã‚‹ã‚ˆ\r\n\r\n# ç’°å¢ƒ\r\n| ãªã¾ãˆ | ã‚ãŸã„         |\r\n|--------|----------------|\r\n| OS     | Windows 10 Pro |\r\n| Node   | 12.14.1        |\r\n\r\n# Nuxt.jsãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆ\r\n\r\n```console\r\nnpx create-nuxt-app nuxtblog\r\n```\r\n\r\nã‚ã¨ã¯å¥½ããªæ–¹ã‚’é¸ã‚“ã§ã„ãã¾ã™\r\n- programming language\r\n    - TypeScriptã«ã—ã¨ã„ãŸï¼ˆã‘ã©TSæ›¸ãæ–¹åˆ†ã‹ã‚“ãªãã¦é€”ä¸­ã‹ã‚‰JSã«ãªã£ã¦ã‚‹ã€‚ã‚¯ã‚½å‚è€ƒã«ãªã‚‰ã­ãˆã˜ã‚ƒã‚“ï¼‰\r\n- UI framework\r\n    - VuetifyãŒãƒãƒ†ãƒªã‚¢ãƒ«ãƒ‡ã‚¶ã‚¤ãƒ³ï¼ˆä»Šå›ã¯Elementä½¿ã£ã¦ã¿ã‚‹ï¼‰\r\n- ã‚ã¨ã¯é©å½“ã«ï¼ˆPWAå…¥ã‚Œã¨ã„ãŸï¼‰\r\n\r\n```console\r\nâœ¨  Generating Nuxt.js project in nuxtblog\r\n? Project name nuxtblog\r\n? Project description My cool Nuxt.js project\r\n? Author name takusan23\r\n? Choose programming language TypeScript     \r\n? Choose the package manager Npm      \r\n? Choose UI framework Element\r\n? Choose custom server framework None (Recommended) \r\n? Choose the runtime for TypeScript Default\r\n? Choose Nuxt.js modules Progressive Web App (PWA) Support\r\n? Choose linting tools (Press <space> to select, <a> to toggle all, <i> to invert selection)\r\n? Choose test framework None\r\n? Choose rendering mode Single Page App\r\n? Choose development tools (Press <space> to select, <a> to toggle all, <i> to invert selection)\r\n```\r\n\r\nãã—ãŸã‚‰ç§»å‹•ã—ã¦ã€ã‚µãƒ¼ãƒãƒ¼èµ·å‹•ã•ã›ã¾ã™\r\n\r\n```console\r\ncd nuxt blog\r\nnpm run dev\r\n```\r\n\r\n![Imgur](https://i.imgur.com/fsdnyw3.png)\r\n\r\n# Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®ä¿å­˜å ´æ‰€ã‚’ä½œã‚‹\r\n\r\nnuxtblogãƒ•ã‚©ãƒ«ãƒ€(componentsã¨ã‹assetsã¨ã‹node_moduleãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€)ã«  \r\n**contentsãƒ•ã‚©ãƒ«ãƒ€**ã‚’ä½œã‚Šã€ãã®ä¸­ã«  \r\n**postsãƒ•ã‚©ãƒ«ãƒ€**ã‚’ä½œã‚Šã€ãã®ä¸­ã«  \r\n**markdownãƒ•ã‚©ãƒ«ãƒ€**ã‚’ä½œæˆã—ã¾ã™ã€‚\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«\r\n\r\n![Imgur](https://i.imgur.com/9MkedEP.png)\r\n\r\nå¾Œã¯**Markdownãƒ•ã‚©ãƒ«ãƒ€**ã«Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ã„ãã¾ã™ã€‚  \r\n\r\nä»Šå›ã¯é©å½“ã«ã“ã‚“ãªMarkdownãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåå‰ï¼šfirst.mdï¼‰ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```markdown\r\n---\r\ntitle: Nuxt.jsã®ç·´ç¿’\r\ncreated_at: 2020-05-31\r\ntags:\r\n- JavaScript\r\n---\r\n# Hello World\r\n\r\n```\r\n\r\n# Markdownãƒ•ã‚¡ã‚¤ãƒ«ã®æƒ…å ±ã‚’JSONã«å¤‰æ›ã™ã‚‹processmd\r\n\r\n## processmdå…¥ã‚Œã¾ã™\r\n\r\n\r\n```console\r\nnpm install --save-dev processmd\r\n```\r\n\r\n## ã‚³ãƒãƒ³ãƒ‰é•·ã„ã®ã§package.jsonã«æ›¸ãè¶³ã—ã¾ã™\r\n\r\n```json\r\n{\r\n  \"name\": \"nuxtblog\",\r\n  \"version\": \"1.0.0\",\r\n  \"description\": \"My cool Nuxt.js project\",\r\n  \"author\": \"takusan23\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"nuxt\",\r\n    \"build\": \"nuxt build\",\r\n    \"start\": \"nuxt start\",\r\n    \"generate\": \"nuxt generate\",\r\n    \"md\": \"processmd contents/posts/**/*.md --stdout --outputDir contents/posts/json > contents/posts/summary.json\"\r\n  },\r\n  \"dependencies\": {\r\n    \"nuxt\": \"^2.0.0\",\r\n    \"element-ui\": \"^2.4.11\",\r\n    \"@nuxtjs/pwa\": \"^3.0.0-0\"\r\n  },\r\n  \"devDependencies\": {\r\n    \"@nuxt/typescript-build\": \"^0.6.0\",\r\n    \"processmd\": \"^4.5.0\"\r\n  }\r\n}\r\n```\r\n\r\nscriptsã®ä¸­ã«mdã®ä¸€è¡Œæ›¸ãè¶³ã›ã°ãŠï½‹\r\n```json\r\n\"md\": \"processmd contents/posts/**/*.md --stdout --outputDir contents/posts/json > contents/posts/summary.json\"\r\n```\r\n\r\nã‚ã¨ã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹å©ãã¾ã™ã€‚  \r\nã“ã®ä½œæ¥­ã¯è¨˜äº‹ã‚’è¿½åŠ ã—ãŸã‚‰æ¯å›å©ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n```console\r\nnpm run md\r\n```\r\n\r\nå©ãã¨contents/postsã«jsonã£ã¦ãƒ•ã‚©ãƒ«ãƒ€ãŒå‡ºæ¥ã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã‚ã¨summary.jsonã‚‚\r\n\r\n# Nuxt.jsã§è¨˜äº‹ä¸€è¦§ç”¨æ„ã™ã‚‹\r\n\r\nã“ã£ã‹ã‚‰ã¯ã‚³ãƒ”ãƒšã§ã™ã€‚ã„ãããŠãŠãŠãŠãŠ  \r\n**pages/index.vue**ã‚’é–‹ã„ã¦ä»¥ä¸‹ã®JSã‚’ã©ãƒ¼ã‚“\r\n```vue\r\n<template>\r\n  <div class=\"container\">\r\n    <div>\r\n      <el-card class=\"box-card\" v-for=\"item in blogItems\" :key=\"item\">\r\n        <nuxt-link class=\"text item\" :to=\"`posts/${item.fileName}`\">{{ item.title }}</nuxt-link>\r\n      </el-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script lang=\"js\">\r\nimport Vue from 'vue'\r\nimport { fileMap } from \"../contents/posts/summary.json\";\r\n\r\nexport default {\r\n  data: () => {\r\n    return {\r\n      blogItems: []\r\n    };\r\n  },\r\n  created() {\r\n    // ã‚­ãƒ¼ã‚’å–ã‚Šå‡ºã™\r\n    Object.keys(fileMap).forEach(title => {\r\n      // è¨˜äº‹ä¸€å€‹ãšã¤å–ã‚‹\r\n      const blog = fileMap[title];\r\n      // åå‰\r\n      const name = blog.sourceBase.replace(\".md\", \"\");\r\n      blog.fileName = name;\r\n      this.blogItems.push(blog);\r\n    });\r\n  }\r\n};\r\n</script>\r\n```\r\n\r\nã“ã“ã§ã¯ã‚¿ã‚¤ãƒˆãƒ«ã—ã‹å‡ºã¦ã¾ã›ã‚“ãŒã€æ—¥ä»˜ã¨ã‹ã‚¿ã‚°ã¨ã‹ã‚‚å‡ºã›ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/LJF3l5H.png)\r\n\r\n> localhost:4545ã¯åˆ¥ã«æ°—ã«ã—ãªã„ã§ã„ã„ã§ã™ã€‚ã ãŸèª¿å­ãŒæ‚ªã‹ã£ãŸã®ã§ãƒãƒ¼ãƒˆç•ªå·ã‚’å¤‰ãˆãŸã ã‘ã§ã™ã€‚ï¼ˆnuxt --port 4545ã§å¤‰ãˆã‚‰ã‚Œã‚‹ï¼‰\r\n\r\n# è¨˜äº‹ä¸€è¦§ãƒšãƒ¼ã‚¸ã‚’ä½œã‚‹\r\n\r\n## å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° # ã¨ã¯\r\nã‚ˆãã‚ã‹ã‚‰ã‚“ã‘ã©é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã«å¿…è¦ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§**nuxt.config.js**é–‹ã„ã¦ã­\r\n\r\nå‚è€ƒï¼šhttps://jmblog.jp/posts/2018-01-18/build-a-blog-with-nuxtjs-and-markdown-2/\r\nå‚è€ƒï¼šhttps://isoppp.com/note/2018-05-16/3-nuxt-firebase-blog-markdown/\r\n\r\né–‹ã„ãŸã‚‰JSæ›¸ãè¶³ã—ã¦ã„ãã¾ã™ã€‚\r\n\r\n```js\r\nconst { sourceFileArray } = require('./contents/posts/summary.json');\r\n\r\n/** ãƒ‘ã‚¹ç”Ÿæˆ */\r\nconst sourceFileNameToUrl = filepath => {\r\n  const name = filepath.replace('contents/posts/markdown/', '').replace('.md', '')\r\n  return `/posts/${name}`\r\n}\r\n\r\nconst generateDynamicRoutes = callback => {\r\n  const routes = sourceFileArray.map(sourceFileName => {\r\n    return sourceFileNameToUrl(sourceFileName);\r\n  });\r\n  callback(null, routes);\r\n};\r\n\r\nexport default {\r\n// çœç•¥\r\n  generate: {\r\n    routes: generateDynamicRoutes\r\n  },\r\n}\r\n```\r\n\r\nsourceFileNameToUrl()é–¢æ•°ã¯`posts/${ãƒ•ã‚¡ã‚¤ãƒ«å}`ã®æ–‡å­—åˆ—ã‚’è¿”ã™é–¢æ•°ã§ã™ã€‚\r\n\r\nã“ã†ã™ã‚‹ã“ã¨ã§URLãŒ`posts/{ã‚¿ã‚¤ãƒˆãƒ«}`ã«ãªã‚‹ã¯ãšã§ã™ã€‚  \r\nã§ã™ãŒã“ã‚Œã ã‘ã§ã¯ã¾ã ç”Ÿæˆã§ãã¾ã›ã‚“ã€‚\r\n\r\nç”Ÿæˆã™ã‚‹ã«ã¯ã€  \r\n**pagesãƒ•ã‚©ãƒ«ãƒ€**ã«**posts**ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã—ã¦ã€  \r\nãã®ä¸­ã« **_slug.vue** ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/DSJ9WSc.png)\r\n\r\n## _slug.vueã®ä¸­èº«\r\n**_slug.vue**ã¯è¨˜äº‹ã®è¡¨ç¤ºã«ä½¿ã„ã¾ã™ã€‚  \r\n\r\n```vue\r\n<template>\r\n  <div class=\"container\">\r\n    <div>\r\n      <el-card class=\"box-card\">\r\n        <div>{{(new Date(created_at).toLocaleDateString())}} æŠ•ç¨¿</div>\r\n        <div v-html=\"bodyHtml\"></div>\r\n      </el-card>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport { sourceFileArray } from \"../../contents/posts/summary.json\";\r\n\r\nexport default {\r\n  // è¨˜äº‹ãŒã‚ã‚‹ã‹ã©ã†ã‹ã€‚JSONã®sourceFileArrayã®é…åˆ—ã«å«ã¾ã‚Œã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã„ã‚‹ã€‚\r\n  validate({ params }) {\r\n    return sourceFileArray.includes(\r\n      `contents/posts/markdown/${params.slug}.md`\r\n    );\r\n  },\r\n  // å„è¨˜äº‹ã®JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’èª­ã¿è¾¼ã‚“ã§ã‚‹ã€‚\r\n  asyncData({ params }) {\r\n    return Object.assign(\r\n      {},\r\n      require(`~/contents/posts/json/${params.slug}.json`),\r\n      { params }\r\n    );\r\n  },\r\n  mounted() {\r\n    // DOMç”Ÿæˆå¾Œ\r\n  },\r\n  // ã•ã‚ï¼Ÿ\r\n  head() {\r\n    const title = `${this.title}`;\r\n    const url = `posts/${this.params.slug}/`;\r\n    return {\r\n      title: title,\r\n      meta: [\r\n        { hid: \"og:url\", property: \"og:url\", content: url },\r\n        { hid: \"og:title\", property: \"og:title\", content: title }\r\n      ],\r\n      link: [{ rel: \"canonical\", href: url }]\r\n    };\r\n  }\r\n};\r\n</script>\r\n```\r\n\r\nè¨˜äº‹ä¸€è¦§ã‹ã‚‰é¸ã‚“ã æ™‚ã«ã¡ã‚ƒã‚“ã¨Markdownã®ä¸­èº«ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°å‹•ã„ã¦ã¾ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/qbUf0P4.png)\r\n\r\n# ãŠã¾ã‘ é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã—ã¦ã¿ã‚‹\r\n\r\nä»¥ä¸‹ã®ä¸€è¡Œã‚’ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«å…¥ã‚Œã¾ã™\r\n\r\n```console\r\nnpm run generate\r\n```\r\n\r\nã“ã‚Œã§é™çš„ã‚µã‚¤ãƒˆãŒç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚å¾Œã¯ã“ã‚Œã‚’GitHubPagesã«ä¸Šã’ã‚‹ãªã‚Šã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nä»Šå›ã¯**Web Server for Chrome**ãŒå…¥ã£ã¦ãŸã®ã§ãã‚Œä½¿ã£ã¦è¦‹ã¦ã¿ã¾ã™ã€‚  \r\n\r\n`npm run generate`ã®å‡ºåŠ›å…ˆã¯**dist**ã«ãªã£ã¦ã‚‹ã®ã§ãã‚Œã‚’æŒ‡å®šã—ã¦Webé¯–ç«‹ã¦ã¾ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/O6uBFod.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\nä¸€å¿œ/posts/first/ã«ã‚¢ã‚¯ã‚»ã‚¹ã—ãŸå¾Œã«F5ï¼ˆå†èª­ã¿è¾¼ã¿ï¼‰ã‚’ã‹ã‘ã¦ã‚‚404ã«ãªã‚‰ãªã„ã“ã¨ã‚’ç¢ºèªã§ããŸã¨ã“ã‚ã§çµ‚ã‚ã‚ã†ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://i.imgur.com/74quEU3.png)\r\n\r\nPWAã‚‚å…¥ã‚Œã¦ã‚ã‚‹ã®ã§è©¦ã›ã‚‹ã€‚\r\n\r\n# ãŠã¾ã‘\r\nGitHub Pagesä½¿ã†å ´åˆã¯ã€nuxt.config.jsã‚’ã“ã‚“ãªæ„Ÿã˜ã«ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```js\r\nexport default {\r\n// çœç•¥\r\n  router: {\r\n    base: '/ãƒªãƒã‚¸ãƒˆãƒªå/'\r\n  },\r\n  generate: {\r\n    routes: generateDynamicRoutes,\r\n    dir: 'docs',\r\n  },\r\n}\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\n**nuxt.config.js**ã®`mode: 'spa'`ã£ã¦SPAã§ã‚ã£ã¦ã‚‹ã®ï¼Ÿ\r\né™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã®æ™‚ã¯æ›¸ã„ã¦ãªã‹ã£ãŸã‚“ã ã‘ã©ï¼Ÿ\r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼šhttps://github.com/takusan23/NuxtBlog"},{"title":"åˆã‚ã¦ã® GitHub Actions å®šæœŸå®Ÿè¡Œç·¨","link":"/posts/github_actions/","markdown":"\n(å¤šåˆ†æœ€å¾Œã®)å¤ä¼‘ã¿ãŒçµ‚ã‚ã‚Šã¾ã™ã­  \n\n\n# æœ¬é¡Œ\nã‚³ãƒ­ãƒŠã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ã§ãã¾ã—ãŸã€‚  \n\n<a href=\"https://tokyo-covid19-calendar.netlify.app/\">![Imgur](https://imgur.com/hm8jXlf.png)\n</a>\n\n\nURLã§ã™ï¼šhttps://tokyo-covid19-calendar.netlify.app/  \n\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ï¼šhttps://github.com/takusan23/tokyo_covid19_calendar\n\nã§ã‚‚ã“ã‚Œã€ãƒ‡ãƒ¼ã‚¿ï¼ˆæ±äº¬éƒ½ æ–°å‹ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹é™½æ€§æ‚£è€…ç™ºè¡¨è©³ç´°ï¼‰ã®æ›´æ–°ãŒã‚ã£ãŸéš›ã«ã„ã¡ã„ã¡\n\n- GitHubã¸ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ or æ‰‹å‹•ã§Netlifyã®ãƒ‡ãƒ—ãƒ­ã‚¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\n    - Netlifyã«è¨­å®šã—ãŸãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ãŒèµ°ã‚‹ã€‚ä»¥ä¸‹\n        - 1: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\n            - æ±äº¬éƒ½ æ–°å‹ã‚³ãƒ­ãƒŠã‚¦ã‚¤ãƒ«ã‚¹é™½æ€§æ‚£è€…ç™ºè¡¨è©³ç´°\n            - https://stopcovid19.metro.tokyo.lg.jp/data/130001_tokyo_covid19_patients.csv\n        - 2: CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’JSONå½¢å¼ã¸å¤‰æ›ã™ã‚‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å‹•ã‹ã™\n            - https://github.com/takusan23/tokyo_covid19_calendar/blob/master/download/main.js\n        - 3: ãƒ‡ãƒ¼ã‚¿ãŒæƒã£ãŸã¨ã“ã‚ã§Nuxtã®é™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã—ã‚’é–‹å§‹\n\nã‚µã‚¤ãƒˆã®ä¸­èº«ã‚’æ›´æ–°ã™ã‚‹ã«ã¯ã€ä¸€æ—¥ä¸€å›ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã‹ã€æ‰‹å‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã•ãªã„ã¨è¡Œã‘ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚ï¼ˆãã‚‚ãã‚‚æ‰‹å‹•ã§ãƒ‡ãƒ—ãƒ­ã‚¤ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ãªã‚“ã¦ã‚ã£ãŸã£ã‘ï¼‰  \nå®šæœŸçš„ã«å‹•ã‹ã™ã«ã—ã¦ã‚‚ãšã£ã¨ãƒ‘ã‚½ã‚³ãƒ³ä»˜ã‘ã¨ãã‚ã‘ã«ã‚‚è¡Œã‹ãªã„ã—ã€‚  \nã¨ã„ã†ã‚ã‘ã§ä»Šå›ã¯**GitHub Actions**ã‚’ä½¿ã£ã¦ã¿ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚\n\n# GitHub Actions #ã¨ã¯\nCI/CDã‚µãƒ¼ãƒ“ã‚¹ ã¯ï¼Ÿ  \nGitHubã‹ã‚‰ç›´æ¥ã‚³ãƒ¼ãƒ‰ã‚’ãƒ“ãƒ«ãƒ‰ã€ãƒ†ã‚¹ãƒˆã€ãƒ‡ãƒ—ãƒ­ã‚¤ã§ãã‚‹ã‚‰ã—ã„\n\n## CI/CDã‚µãƒ¼ãƒ“ã‚¹ #ã¨ã¯\nè‡ªå‹•ã§ãƒ“ãƒ«ãƒ‰ã—ãŸã‚Šã™ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã‚‰ã—ã„ã€‚  \nãƒ‡ãƒ—ãƒ­ã‚¤ã‚‚è‡ªåˆ†ã§ã‚„ã‚‰ãšã«ä»»ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã£ã¦ã“ã¨ã‹ãªã€‚  \nä»Šå›ã¯å®šæœŸå®Ÿè¡Œã•ã›ã‚‹ã‘ã©ã€pushãŒã‚ã£ãŸæ™‚ã«ãƒ‡ãƒ—ãƒ­ã‚¤ä½œæ¥­(`npm run generate`ã¨ã‹)ã‚’ã•ã›ã‚‹ã¿ãŸã„ãªã“ã¨ãŒã‚„ã‚ŠãŸã„å ´åˆã¯ã“ã‚Œã‚’ä½¿ã†ã‚‰ã—ã„ï¼Ÿ\n\nã¾ã‚ã™ã”ã„é›‘ã«è¨€ã†ã¨ **GitHubã®æŒã£ã¦ã‚‹ã™ã”ã„ãƒ‘ã‚½ã‚³ãƒ³ã‚’ä½¿ã£ã¦è‡ªå‹•ã§ä½œæ¥­ã‚’ã‚„ã‚‰ã›ã‚‹ã“ã¨ãŒã§ãã‚‹** ã£ã¦ã“ã¨ã ã¨æ€ã„ã¾ã™ã€‚\n\n~~ã¨ã„ã†ã‚ã‘ã§ã€å®šæœŸå®Ÿè¡Œã§ä½•ã‹æˆæœã‚’ã ã—ã¦ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚Œã°è‡ªå‹•è‰ç”Ÿã‚„ã—æ©Ÿã«ã‚‚ãªã‚Œã¾ã™ã€‚ãƒãƒ¼ãƒˆã ã­ã€‚~~\n\n# ã¯ã˜ã‚ã‚‹\n\nNetlifyã«ã©ã†ã‚„ã£ã¦**ãƒ“ãƒ«ãƒ‰ã—ã¦ãã‚Œ**ã£ã¦é ¼ã‚€ã‹ã£ã¦è¨€ã†ã¨**WebHook**ã£ã¦ã®ã‚’é€šã˜ã¦è¡Œã„ã¾ã™ã€‚  \n\n**ã‚ã¨GitHub ActionsãŒã‚³ã‚±ã‚‹ã¨æ¯å›ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ã—ã¦ãã‚‹ã®ã§æ°—ã‚’ã¤ã‘ã¦ã­ã€‚**\n\n## GitHubã®ãƒªãƒã‚¸ãƒˆãƒªã®ãƒšãƒ¼ã‚¸ã‚’é–‹ã„ã¦\n\n**Actions**ã‚’è¦‹ã¤ã‘ã¦ãã ã•ã„ã€‚\n\n![Imgur](https://imgur.com/jif7sE3.png)\n\né–‹ã„ãŸã‚‰ã€`Set up this workflow`ã‚’æŠ¼ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  \n\n![Imgur](https://imgur.com/8JrO3j1.png)\n\nã‚‚ã—ãªã„å ´åˆã¯ `set up a workflow yourself` ã‚’æŠ¼ã›ã°ã„ã„ã¨æ€ã„ã¾ã™\n\n![Imgur](https://imgur.com/jMFb5o8.png)\n\nã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã®ã‚¨ãƒ‡ã‚£ã‚¿ãŒé–‹ãã¾ã™ã€‚  \nã“ã“ã«ã‚³ãƒãƒ³ãƒ‰ã‚’æ›¸ã„ãŸã‚Šã™ã‚‹ã‚ã‘ã§ã™ã­ã€‚  \n\n![Imgur](https://imgur.com/LXLmyZi.png)\n\n# å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’ä»˜ã‘ã‚‹\nä»Šç¾åœ¨ï¼ˆ2020/08/24ï¼‰ã€åˆæœŸçŠ¶æ…‹ã§ã¯GitHub Actionsã‚’å®Ÿè¡Œã™ã‚‹ãƒœã‚¿ãƒ³ã¯æœ‰ã‚Šã¾ã›ã‚“ã€‚  \nåˆæœŸçŠ¶æ…‹ã®ã¾ã¾ã ã¨ã€ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹ã¾ã§å‹•ãã‹ã©ã†ã‹ã‚ã‹ã‚‰ã‚“ã®ã§ã™ã€‚\n\nã¨ã„ã†ã‚ã‘ã§å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ã‚‡ã†ã€‚  \n\nãƒ†ã‚­ã‚¹ãƒˆã®ä¸­ã‹ã‚‰ã€`on:`ã£ã¦ã¨ã“ã‚ã‚’æ¢ã—ã¾ã™ã€‚\n\n```yml\non:\n    push:\n      branches: [ master ]\n    pull_request:\n      branches: [ master ]\n```\n\nã“ã“ã‚‰ã¸ã‚“ã§ã™ã­ã€‚\n\nãã—ãŸã‚‰ä¸€è¡Œ`on:`ã®ä¸‹ã«`workflow_dispatch:`ã‚’æ›¸ãè¶³ã—ã¾ã™ã€‚ã“ã‚“ãªæ„Ÿã˜ã«\n```yml\non:\n    workflow_dispatch:\n    push:\n      branches: [ master ]\n    pull_request:\n      branches: [ master ]\n```\n\nã“ã‚Œã§æ‰‹å‹•å®Ÿè¡ŒãŒåˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚**ã¨ã„ã†ã‹åˆã‚ã‹ã‚‰ä»˜ã‘ã¨ã‘**\n\n# åå‰å¤‰æ›´\nä»Šã®ã¾ã¾ã ã¨`blank.yml`ã£ã¦ãªã£ã¦ã‚‹ã®ã§ã€ä½•ã‚’ã™ã‚‹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãªã®ã‹åå‰ã‚’å¤‰ãˆã¦ã‚ã’ã¾ã—ã‚‡ã†ã€‚  \nä»Šå›ã¯`interval_netlify_webhook.yml`ã¨ã‹ã«ã—ã¦ãŠãã¾ã™ã‹\n\n![Imgur](https://imgur.com/kiWSwTB.png)\n\nãã‚Œã¨ã¯åˆ¥ã«ã€ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã®åå‰ã£ã¦ã®ãŒã‚ã‚Šã¾ã™ã€‚  \nã“ã‚Œã¯GitHub Actionsã®æ–¹ã§ä½¿ã‚ã‚Œã‚‹åå‰ã«ãªã‚Šã¾ã™ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«åã¨ã¯åˆ¥ã«ãªã£ã¦ã‚‹ï¼‰ã€‚  \n\nåˆæœŸçŠ¶æ…‹ã§ã¯`CI`ã£ã¦ãªã£ã¦ã¾ã™ã­ã€‚ã“ã®åå‰ã¯GitHub Actionsã®ä¸€è¦§ç­‰ã§ä½¿ã‚ã‚Œã¦ã¾ã™ã€‚  \nã“ã¡ã‚‰ã‚‚å¤‰ãˆã¦ãŠãã¾ã—ã‚‡ã†\n```yml\n# This is a basic workflow to help you get started with Actions\n\nname: IntervalNetlifyWebHook\n```\n\nã“ã†ã„ã†ã¨ã“ã‚ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ã€‚ã¾ã‚è§¦ã£ã¦ã¿ã‚‹ã®ãŒä¸€ç•ªæ—©ã„  \n![Imgur](https://imgur.com/xqivVgN.png)\n\n# æ›¸ã„ã¦ã„ã\n## `on` (ãƒˆãƒªã‚¬ãƒ¼)\nã“ã‚Œã‹ã‚‰ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’èµ·å‹•ã™ã‚‹æ¡ä»¶ï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  \nãã‚Œã§å®šæœŸå®Ÿè¡Œï¼ˆã¨æ‰‹å‹•å®Ÿè¡Œï¼‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ã‘ã°ã„ã„ã§ã™ã€‚\n\n```yml\non:\n    workflow_dispatch:\n    schedule:\n      - cron: '0 0 * * *' # æ—¥æœ¬æ™‚é–“æœã®9æ™‚ã«æ¯æ—¥å®Ÿè¡Œ\n```\n\n0 0 ã£ã¦æ›¸ã„ã¦ã‚‹ã®ã«ãªã‚“ã§9æ™‚ãŒå‡ºã¦ãã‚“ã ã‚ˆã£ã¦è©±ã§ã™ãŒã€ã“ã‚Œã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³ãŒUTCã«ãªã£ã¦ã‚‹ã‹ã‚‰ã§ã™ã­ã€‚UTCã§0æ™‚ã¯æ—¥æœ¬(JST)ã§ã¯9æ™‚ã«ãªã‚Šã¾ã™ã€‚  \n\nã‚‚ã—åˆå‰ä¹æ™‚ã˜ã‚ƒã‚„ã ï¼ã£ã¦å ´åˆã¯ã“ã‚“ãªãƒ„ãƒ¼ãƒ«ãŒã‚ã‚Šã¾ã™ï¼šhttps://crontab.guru/\n\nã“ã‚“ã‹ã„ã¯ã“ã®ã¾ã¾è¡Œãã¾ã™ã€‚\n\n## `build`\n`build:`ã®ä¸‹ã«ã‚ã‚‹`runs-on`ã¯ç’°å¢ƒã§ã™ã®ã§å¤šåˆ†ãã®ã¾ã¾ã§ã„ã„ã¨æ€ã„ã¾ã™(Windowsã˜ã‚ƒãªãã‚ƒãƒ€ãƒ¡ã¿ãŸã„ãªã‚‰èª¿ã¹ã¦)\n\nãªã®ã§`steps:`ã‹ã‚‰æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\n\n## `steps` (ä¸­èº«)\nã“ã“ã«ã¯ä»•äº‹å†…å®¹ã‚’æ›¸ãã¾ã™ã€‚Node.jsãªã‚‰`npm install`ã¨ã‹ã§ã™ã‹ã­ã€‚  \nä»Šå›ã‚„ã‚ŠãŸã„ã“ã¨ã¯Netlifyã«ãƒ“ãƒ«ãƒ‰ã—ã¦ãã‚Œã£ã¦é ¼ã‚€ã“ã¨ã§ã™ã­ã€‚WebHookã‚’ä½¿ã„ã¾ã™ã€‚  \nãªã®ã§`on:`ã¨`steps:`ä»¥å¤–ã¯ã‚ã‚“ã¾è§¦ã‚‰ãªã„ã®ã‹ãªã€‚\n\n### WebHookã®URLã‚’ç”Ÿæˆã™ã‚‹\nNetlifyã®ã‚µã‚¤ãƒˆã®è¨­å®šç”»é¢ã¸å…¥ã£ã¦ã€  \n`Build & Deploy`ã‚’æŠ¼ã—ã€`Build hooks`ã¾ã§é€²ã¿ã¾ã™ã€‚\n![Imgur](https://imgur.com/eSQp9Bu.png)\n\nãã—ãŸã‚‰`Add build hook`ã‚’ãŠã—ã¦ã€é©å½“ãªåå‰ã‚’ã¤ã‘ã¦ã€URLã‚’ç”Ÿæˆã—ã¦ã‚‚ã‚‰ã„ã¾ã—ã‚‡ã†ã€‚\n\nã§ããŸã‚‰ã“ã†ã§ã™ï¼\n\n```yml\n# Netlifyã®WebHook\n  - name: Netlify WebHook\n    uses: wei/curl@v1.1.1\n    with:\n      args: -X POST -d {} ${{ secrets.WEBHOOK_URL }}\n```\n\n## WebHook URLã®ä¿å­˜å ´æ‰€\nprivateãªãƒªãƒã‚¸ãƒˆãƒªã˜ã‚ƒãªã„å ´åˆã¯GitHub Actionsã®ä¸­èº«ã‚‚è¦‹ã‚Œã¦ã—ã¾ã†ã®ã§(WebHook URLè¦‹ã‚‰ã‚Œã‚‹ã¨ã‚„ã°ã„)ã€WebHookã®URLã‚’åˆ¥ã®å ´æ‰€ã«éš ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚  \nãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®šç”»é¢ã¸é€²ã‚“ã§ã€`Secrets`ã‚’é¸ã³ã€`New Secrets`ã‚’æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚  \n![Imgur](https://imgur.com/WZeVJAN.png)\n\nnameã«`WEBHOOK_URL`ã€valueã«Netlifyã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸWebHook URLã‚’å…¥ã‚Œã¾ã™ã€‚\n\n# ã™ã¹ã¦ãã£ã¤ã‘ãŸã‚³ãƒ¼ãƒ‰\n\n```yml\n# GitHub Actions ä¸Šã§ã®åå‰\n\nname: IntervalNetlifyWebHook\n\n# èµ·å‹•æ¡ä»¶\non:\n  workflow_dispatch:\n  schedule:\n    - cron: '0 0 * * *' # æ—¥æœ¬æ™‚é–“åˆå‰ä¹æ™‚ã«æ¯æ—¥å®Ÿè¡Œ\n\n# A workflow run is made up of one or more jobs that can run sequentially or in parallel\njobs:\n  # This workflow contains a single job called \"build\"\n  build:\n    # The type of runner that the job will run on\n    runs-on: ubuntu-latest\n\n    # ã“ã£ã‹ã‚‰æ›¸ã„ã¦ã„ã\n    steps:\n      \n    # Netlifyã®WebHook\n      - name: Netlify WebHook\n        uses: wei/curl@v1.1.1\n        with:\n          args: -X POST -d {} ${{ secrets.WEBHOOK_URL }}\n```\n\n# æ—©é€Ÿå‹•ã‹ã—ã¦ã¿ã‚‹\n`Start Commit`ã‚’æŠ¼ã—ã¦ä¿å­˜ã—ã¾ã—ã‚‡ã†ã€‚  \n\n![Imgur](https://imgur.com/OrYpuL3.png)\n\nã§ããŸã‚‰ã¾ãŸ`Actions`ã‚’é–‹ã„ã¦ãã ã•ã„ã€‚åå‰ãŒå¢—ãˆã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚\n\nåå‰ã‚’æŠ¼ã—ã¦`Run workflow`ã‚’ãŠã—ã¦<span style=\"border: solid 2px green;background-color:green;color:#fff;padding:2px;border-radius:5px\"> Run workflow </span>ã‚’æŠ¼ã—ã¾ã—ã‚‡ã†\n\n![Imgur](https://imgur.com/oY70nww.png)\n\n# å‹•ã„ãŸã‹\nå†èª­ã¿è¾¼ã¿ï¼Ÿã™ã‚‹ã¨æ–°ã—ããªã‚“ã‹ã§ãã‚‹ã®ã§æŠ¼ã—ã¾ã™ã€‚  \n![Imgur](https://imgur.com/4HK9rXd.png)\n\nãã—ãŸã‚‰æ¨ªã®`build`ã‚’é¸ã³ã¾ã™ã€‚  \n![Imgur](https://imgur.com/Q254eH2.png)\n\nã¡ã‚ƒã‚“ã¨ã§ãã¦ã‚‹ã¿ãŸã„ã§ã™ã­ï¼\n\nãã—ã¦Netlifyã®æ–¹ã§ã‚‚ãƒ“ãƒ«ãƒ‰ãŒèµ°ã£ã¦ã‚‹ã“ã¨ãŒç¢ºèªã§ãã¾ã—ãŸã€‚\n\n![Imgur](https://imgur.com/433LX6W.png)\n\nã“ã‚Œã§è‡ªå‹•ã§æŒ‡å®šã—ãŸæ™‚é–“ã«Netlifyã®ãƒ“ãƒ«ãƒ‰ã‚’ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã—ãŸã€‚ã‚„ã£ãŸãœ  \nã‚³ãƒ¼ãƒ‰ã¯ã“ã“ã§ã™ï¼š[ã™ã¹ã¦ãã£ã¤ã‘ãŸã‚³ãƒ¼ãƒ‰](#ã™ã¹ã¦ãã£ã¤ã‘ãŸã‚³ãƒ¼ãƒ‰)\n\n# ç•ªå¤–ç·¨ è‡ªå‹•è‰ç”Ÿã‚„ã—æ©Ÿ\nGitHub Actionsã‹ã‚‰ã‚³ãƒŸãƒƒãƒˆ+ãƒ—ãƒƒã‚·ãƒ¥ã—ãŸã„å ´åˆã¯å‚è€ƒã«ã—ã¦ãã ã•ã„ã€‚\n\n```yml\n# GitHub Actions ä¸Šã§ã®åå‰\n\nname: AutoGrass\n\n# èµ·å‹•æ¡ä»¶\non:\n  workflow_dispatch:\n  schedule:\n    - cron: '0 0 * * *' # æ—¥æœ¬æ™‚é–“åˆå‰ä¹æ™‚ã«æ¯æ—¥å®Ÿè¡Œ\n\n# A workflow run is made up of one or more jobs that can run sequentially or in parallel\njobs:\n  # This workflow contains a single job called \"build\"\n  build:\n    # The type of runner that the job will run on\n    runs-on: ubuntu-latest\n\n    # ã“ã£ã‹ã‚‰æ›¸ã„ã¦ã„ã\n    steps:\n      # ãƒªãƒã‚¸ãƒˆãƒªã«è§¦ã‚Œã‚‹ã‚ˆã†ã«\n      - uses: actions/checkout@v2\n      \n      # é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã‚‹\n      - name: Update File\n        run: node main.js\n   \n      # Gitã®è¨­å®šã™ã‚‹\n      - name: Git Setting\n        run: |\n          git config --global user.email \"${{ secrets.MAIL }}\"\n          git config --global user.name \"${{ secrets.USER_NAME }}\"\n                  \n      # Commitã¨Pushã™ã‚‹\n      - name: Commit and Push\n        run: |\n           git commit -m \"[GitHub Actions] File Update\" -a\n           git pull\n           git push origin master\n```\n\nGitHub Actionsã§å‹•ã‹ã™`main.js`ã¯ä»¥ä¸‹\n```js\n/** é©å½“ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹ã ã‘ã®Node.jsãƒ—ãƒ­ã‚°ãƒ©ãƒ  */\n\nconst fs = require('fs')\n// æ›¸ãè¾¼ã‚€ãƒ†ã‚­ã‚¹ãƒˆ\nconst text = new Date().toLocaleString()\n// ä¿å­˜\nfs.writeFile(\"text.txt\", text, (err) => {\n    if (err) {\n        console.log(\"ãˆã‚‰ãƒ¼\")\n    }\n})\n```\n\nGitHubã®ãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®š > Secrets > New secret ã§2ã¤è¿½åŠ ã—ã¦ãã ã•ã„ã€‚\n\n- MAIL\n    - GitHubã®ãƒ¡ã‚¢ãƒ‰\n- USER_NAME\n    - GitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å\n\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼ˆschedule:ã¨ãã®ä¸‹ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚Œã¦ã¾ã™ã®ã§æ°—ã‚’ã¤ã‘ã¦ï¼‰ï¼šhttps://github.com/takusan23/AutoGrassAction\n\n# ãŠã‚ã‚Šã«\nGitHub Actionsã®ymlãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã—ã‹å¤‰æ›´ã§ããªã„ï¼ŸVSCodeã§å¤‰æ›´ã—ã¦Pushã™ã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹ã—\n\nã‚ã¨å®šæœŸå®Ÿè¡Œã§ãã¦ã‚‹ã‹ã©ã†ã‹ã¯æœä¹æ™‚ã«ãªã‚‹ã¾ã§ã‚ã‹ã‚‰ã‚“ã€‚ãã‚Œã¾ã§ã®ãŠæ¥½ã—ã¿\n\näºŒå­¦æœŸã‹ãã€‚æ—©èµ·ãã™ã‚‹ã®ã¤ã‚‰ã„"},{"title":"GitHub Actions ã§ Androidã®ãƒªãƒªãƒ¼ã‚¹APKä½œæˆ","link":"/posts/github_actions_android_release_apk/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nå‰µä½œå½¼å¥³ã®æ‹æ„›å…¬å¼ æ”»ç•¥ã—ã¾ã—ãŸã€‚\r\n\r\nã‚†ã‚ã¿ã¡ã‚ƒã‚“ãŒå¯æ„›ã‹ã£ãŸã§ã™ã€‚ã‚¢ãƒšãƒ³ãƒ‰é…ä¿¡ã¾ã ã§ã™ã‹ï¼ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/cDsSfhl.png)\r\n\r\nè¡¨æƒ…ã„ã£ã±ã„ã‚ã‚‹ã®ã‹ã‚ã„ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/1uoWiaU.png)\r\n\r\n![Imgur](https://imgur.com/VaS7aQw.png)\r\n\r\nå…±é€šãŒé•·ã„ã®ãŒå¥½ããªæ–¹ã¯ã©ã†ãã€ã‚ãŸã—çš„ã«ã¯å€‹åˆ¥é•·ã„ã»ã†ãŒè‰¯ã„ã‹ãª\r\n\r\n![Imgur](https://imgur.com/PBlokGv.png)\r\n\r\n\r\n(ãˆï¼Ÿã‚°ãƒ©ãƒ³ãƒ‰ã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ï¼Ÿ...ã‚¢ãƒšãƒ³ãƒ‰é…ä¿¡ã«æœŸå¾…)\r\n\r\n# æœ¬é¡Œ\r\nGitHub Actionsã§Androidã®ãƒªãƒªãƒ¼ã‚¹APKã‚’ä½œæˆã—ãŸã„ï¼  \r\nreleaseãƒ–ãƒ©ãƒ³ãƒã¸pushã—ãŸã‚‰å‹æ‰‹ã«APKä½œã£ã¦ãã‚Œã‚‹ã‚ˆã†ã«ã—ãŸã„ï¼\r\n\r\n## GitHub Actions\r\nã“ã®ãƒ–ãƒ­ã‚°ã§ã‚‚ä½•å›ã‹ç™»å ´ã—ã¦ã‚‹ã‚„ã¤ã€‚  \r\nãƒ“ãƒ«ãƒ‰ä½œæ¥­ã¨ã‹ã‚’è‡ªåˆ†ã®PCã˜ã‚ƒãªãã¦GitHubã®ãƒã‚·ãƒ³ã§ã‚„ã‚‰ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ã€‚  \r\nã—ã‹ã‚‚ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªãªã‚‰ç„¡æ–™ï¼ã€‚  \r\n\r\nä»Šå›ã¯ã“ã‚Œã‚’ä½¿ã£ã¦ãã“ãã“æ™‚é–“ã®ã‹ã‹ã‚‹APKä½œæˆã‚’GitHub Actionsï¼ˆ**ä»–ã®äººã®PC**ï¼‰ã«ã‚„ã‚‰ã›ã¾ã™ï¼\r\n\r\n## build.gradle.kts\r\nä»Šå›ã¯`kts`ã¸ç§»è¡Œã—ãŸ`build.gradle.kts`ã‚’åˆ©ç”¨ã—ã¾ã™ã€‚  \r\n`build.gradle`ã®å ´åˆã¯ã‚³ãƒ”ãƒšã§å‹•ã‹ãªã„ã¨æ€ã„ã¾ã™ï¼›ï¼›\r\n\r\n# æµã‚Œ\r\n- (APKç”Ÿæˆæ™‚ã®ã‚³ãƒ¼ãƒ‰ã‚’ç®¡ç†ã—ã¦ãŠã)releaseãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ\r\n- `build.gradle.kts`ã‚’ç·¨é›†ã—ã¦ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰APKã‚’ä½œæˆã—ã¦ç½²åã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\r\n- ç½²åãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«ã™ã‚‹\r\n- `GitHub Actions`ã‚’çµ„ã‚€\r\n- releaseãƒ–ãƒ©ãƒ³ãƒã‚’pushã™ã‚‹\r\n\r\n# ã¤ãã‚‹\r\n\r\n## releaseãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆ\r\nä»Šå›ã¯`release`ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã¦ã€ã“ã®ãƒ–ãƒ©ãƒ³ãƒã«å¯¾ã—ã¦pushãŒã‚ã£ãŸéš›ã«è‡ªå‹•ã§APKã‚’ä½œæˆã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\nAPKã‚’ä½œæˆã—ãŸã„å ´åˆã¯ã“ã®ãƒ–ãƒ©ãƒ³ãƒã¸masterã®ä¸­èº«ã‚’ãƒãƒ¼ã‚¸ã—ã¦pushã™ã‚Œã°è‰¯ã„ã‚ã‘ãªã‚“ã§ã™ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/fcuuYib.png)\r\n\r\n(ã‚‚ã—æœ€åˆã‹ã‚‰ã‚ã‚‹masterãƒ–ãƒ©ãƒ³ãƒã‚’pushã™ã‚‹ãŸã³ã«apkã‚’ä½œã‚ŠãŸã„å ´åˆã¯ã“ã‚Œã®ä½œæ¥­ã¯ã„ã‚‰ãªã„)\r\n\r\n## build.gradle.ktsã¸ç½²åé–¢ä¿‚ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’è¨­å®š\r\nappãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹`build.gradle.kts`ã‚’é–‹ãã¾ã™ã€‚  \r\n`build.gradle`ã‚’ãŠä½¿ã„ã®æ–¹ã¯ã™ã„ã¾ã›ã‚“ã‚ã‹ã‚‰ãªã„ã§ã™(Kotlinã—ã‹åˆ†ã‹ã‚‰ã‚“ã—Kotlinã‚‚åˆ†ã‹ã‚‰ã‚“)\r\n\r\nãã—ã¦ã‚³ãƒ”ãƒšã—ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nimport java.util.*\r\n\r\n\r\nandroid {\r\n\r\n    // çœç•¥\r\n    \r\n    // APKä½œæˆã¨ç½²åã®è¨­å®š\r\n    signingConfigs {\r\n        // ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–ã‚Šã«è¡Œã\r\n        create(\"release_signing_config\") {\r\n            // å­˜åœ¨ã—ãªã„å ´åˆã¯ã¨ã‚Šã‚ãˆãšã‚¹ãƒ«ãƒ¼ã™ã‚‹\r\n            if (System.getenv(\"ENV_SIGN_KEYSTORE_BASE64\") != null) {\r\n                // GitHubActionsã®ç’°å¢ƒå¤‰æ•°ã«å…¥ã‚Œã¦ãŠã„ãŸç½²åãƒ•ã‚¡ã‚¤ãƒ«ãŒBase64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§æˆ»ã™\r\n                System.getenv(\"ENV_SIGN_KEYSTORE_BASE64\").let { base64 ->\r\n                    val decoder = Base64.getDecoder()\r\n                    // ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ä½œæˆã™ã‚‹\r\n                    File(\"keystore.jks\").also { file ->\r\n                        file.createNewFile()\r\n                        file.writeBytes(decoder.decode(base64))\r\n                    }\r\n                }\r\n                // ã©ã†ã‚„ã‚‰ appãƒ•ã‚©ãƒ«ãƒ€ ã®ä¸­ã‚’è¦‹ã«è¡Œã£ã¦ã‚‹ã¿ãŸã„ãªã®ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã™ã‚‹\r\n                storeFile = File(rootProject.projectDir, \"keystore.jks\")\r\n                keyAlias = System.getenv(\"ENV_SIGN_KEY_ALIAS\")\r\n                keyPassword = System.getenv(\"ENV_SIGN_KEY_PASSWORD\")\r\n                storePassword = System.getenv(\"ENV_SIGN_STORE_PASSWORD\")\r\n            }\r\n        }\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            // ç½²åã®è¨­å®šã‚’é©ç”¨ã™ã‚‹\r\n            signingConfig = signingConfigs.getByName(\"release_signing_config\")\r\n            isMinifyEnabled = false\r\n            proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"proguard-rules.pro\")\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nä¸€ç•ªä¸Šã®`import java.util.*`ã¯Base64ã®ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’è¡Œã†ãŸã‚ã«å¿…è¦ã§ã™ã€‚  \r\n\r\n### é›‘ãªè§£èª¬çš„ãª\r\n\r\nç½²åã«ä½¿ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã‹ã¯ç’°å¢ƒå¤‰æ•°ã‹ã‚‰å–å¾—ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚  \r\n`build.gradle.kts`ã¸ç›´æ¥æ›¸ãã¨ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒèª°ã§ã‚‚è¦‹ã‚Œã¦ã—ã¾ã†ã®ã§å¤§å•é¡Œã§ã™ã€‚  \r\nã˜ã‚ƒã‚ã©ã“ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’ä¿å­˜ã—ã¦ãŠãã‹ã¨ã„ã†è©±ã§ã™ãŒã€GitHubã®Secretæ©Ÿèƒ½ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãªã‚“ã‹ã®æ©Ÿå¯†æƒ…å ±ã‚’ç™»éŒ²ã—ã¦ãŠãã¾ã™ã€‚  \r\nãã—ã¦GitHub Actionsã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚»ãƒƒãƒˆã™ã‚‹éš›ã«Secretã®å€¤ã‚’ä½¿ã†ã“ã¨ã§ã€å®‰å…¨ã«ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¸¡ã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\nã§ã‚‚ç½²åãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã©ã†ã‚„ã£ã¦æ¸¡ã™ã®ã‹ã¨ã„ã†ã®ãŒå•é¡Œã«ãªã‚Šã¾ã™ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¯æ–‡å­—åˆ—ã§ã—ãŸãŒä»Šå›ã¯ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚  \r\nã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã®ãŒ`Base64`ã§ã™ã€‚ã“ã‚Œã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚ˆãåˆ†ã‹ã‚‰ã‚“æ–‡å­—åˆ—ã«å¤‰æ›ã—ã¦ãã‚Œã¾ã™ï¼ˆãã®é€†ã‚‚å¯ï¼‰ã€‚æ–‡å­—åˆ—ã«ãªã£ãŸã‚‰ã“ã£ã¡ã®ã‚‚ã®ã§ã™ã€‚   \r\nãªã®ã§Secretã¸æ–‡å­—åˆ—ã«ãªã£ãŸç½²åãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç™»éŒ²ã—ã¦ãŠã„ã¦ã€  \r\nãƒ“ãƒ«ãƒ‰æ™‚ã«æ–‡å­—åˆ—ã‹ã‚‰ç½²åãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹ã“ã¨ã§å®‰å…¨ã«ç½²åãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ç®¡ç†ã§ãã¾ã—ãŸã€‚\r\n\r\nä»–ã®ä¾‹ã ã¨ã€Base64ã¸ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰/ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã«ã‚„ã‚‰ã›ã¦ã‚‹ä¾‹ãŒã‚ã‚Šã¾ã™ãŒã€ãªã‚“ã‹`build.gradle.kts`ã®ä¸­ã§ã„ã„æ„Ÿã˜ã«å¤‰æ›ã§ããŸã®ã§ã“ã‚Œã§è¡Œãã¾ã™ã€‚\r\n\r\n## ç½²åãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«ã™ã‚‹\r\nAndroidã‚¢ãƒ—ãƒªã®ç½²åã§ä½¿ã£ã¦ã‚‹`keystore.jks`ã¿ãŸã„ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’Base64ã«å¤‰æ›ã—ã¾ã™ã€‚  \r\nWindowsã®æ¨™æº–æ©Ÿèƒ½ã§Base64ã«å¤‰æ›ã§ãã‚‹ã¿ãŸã„ãªã®ã§ã‚„ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\r\n\r\né©å½“ãªãƒ•ã‚©ãƒ«ãƒ€ã§PowerShellã¨ã‹ã‚’é–‹ã„ã¦ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\r\n\r\n![Imgur](https://imgur.com/EOXhnXm.png)\r\n\r\n```\r\ncertutil -encode {ç½²åãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹} encode.txt\r\n```\r\n\r\nã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨`encode.txt`ãŒå‡ºæ¥ã¦ã‚‹ã¨æ€ã†ã®ã§é–‹ã„ã¦ã€  \r\n`-----BEGIN CERTIFICATE-----`ã€`-----END CERTIFICATE-----`ã‚’æ¶ˆã—ã¦  \r\næ”¹è¡Œã‚‚æ¶ˆã—ã¾ã™ã€‚\r\n\r\næ¶ˆã›ãŸã‚‰ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\r\n\r\n## GitHub ã® Secret ã¸ç™»éŒ²\r\nãƒªãƒã‚¸ãƒˆãƒªã® Secrets > Actions ã¸é€²ã¿ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Z9Ok9ar.png)\r\n\r\nãã—ã¦ã“ã®ä¸­ã«ç½²åã§ä½¿ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç­‰ã‚’ä¿å­˜ã—ã¦ã„ãã‚ã‘ã§ã™ãŒã€  \r\nã•ã£ãã®`build.gradle.kts`ã‚’ãƒ‘ã‚¯ã£ãŸå ´åˆã®åå‰ã¨å€¤ã®å¯¾å¿œè¡¨ã§ã™â†“  \r\nåå‰å¤‰ãˆãŸå ´åˆã¯ãã‚Œãã‚Œå¤‰ãˆã¦...\r\n\r\n**New repository secret**ã‹ã‚‰è¿½åŠ ã§ãã¾ã™ã€‚\r\n\r\n| åå‰                     | å…¥ã‚Œã‚‹ä¸­èº«               |\r\n|--------------------------|--------------------------|\r\n| ENV_SIGN_KEYSTORE_BASE64 | Base64ã«ã—ãŸç½²åãƒ•ã‚¡ã‚¤ãƒ« |\r\n| ENV_SIGN_KEY_ALIAS       | Key alias                |\r\n| ENV_SIGN_KEY_PASSWORD    | Key password             |\r\n| ENV_SIGN_STORE_PASSWORD  | Key store password       |\r\n\r\nã‚‚ã—ãƒ‘ã‚¯ã£ãŸå ´åˆã¯Secretã¯ã“ã†ãªã‚Šã¾ã™\r\n\r\n![Imgur](https://imgur.com/guaG8dc.png)\r\n\r\n## GitHub Actions ã‚’ä½œæˆã™ã‚‹\r\n\r\nGitHubã®ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹`Actions`ã‹ã‚‰æ–°ã—ã„ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nãƒ†ãƒ³ãƒ—ãƒ¬ç½®ã„ã¦ãŠãã®ã§çš†ã•ã‚“ã¯ Simple workflow ã‚’é¸ã‚“ã§ã„ã„ã§ã™ã‚ˆã€‚\r\n\r\n![Imgur](https://imgur.com/DmOATvW.png)\r\n\r\nãã—ã¦APKã‚’ä½œæˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã¯ã“ã¡ã‚‰ã§ã™ï¼ï¼ï¼\r\n\r\n```yml\r\nname: Generate Release APK\r\n\r\non:\r\n  # releaseãƒ–ãƒ©ãƒ³ãƒæ›´æ–°æ™‚ã«èµ·å‹•ã™ã‚‹\r\n  push:\r\n    branches: [ release ]\r\n  # æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³\r\n  workflow_dispatch:\r\n    \r\njobs:\r\n  build:\r\n\r\n    runs-on: ubuntu-latest\r\n\r\n    steps:\r\n    \r\n    # releaseãƒ–ãƒ©ãƒ³ãƒã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ\r\n    - uses: actions/checkout@v2\r\n      with:\r\n        ref: 'release'\r\n\r\n    # JDKå°å…¥\r\n    - name: set up JDK 11\r\n      uses: actions/setup-java@v2\r\n      with:\r\n        java-version: '11'\r\n        distribution: 'temurin'\r\n        cache: gradle\r\n    \r\n    # æ¨©é™ã‚’ä¸ãˆã‚‹\r\n    - name: Grant permission gradlew\r\n      run: chmod +x gradlew\r\n      \r\n    # ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³ã‹ã‚‰APKã®ä½œæˆã€‚å®Ÿè¡Œå‰ã«ç’°å¢ƒå¤‰æ•°ã‚’GitHubActionsã®Secretã‹ã‚‰å–å¾—\r\n    - name: Building APK\r\n      env:\r\n        ENV_SIGN_KEYSTORE_BASE64: ${{secrets.ENV_SIGN_KEYSTORE_BASE64}}\r\n        ENV_SIGN_KEY_ALIAS: ${{secrets.ENV_SIGN_KEY_ALIAS}}\r\n        ENV_SIGN_KEY_PASSWORD: ${{secrets.ENV_SIGN_KEY_PASSWORD}}\r\n        ENV_SIGN_STORE_PASSWORD: ${{secrets.ENV_SIGN_STORE_PASSWORD}}\r\n      run: ./gradlew assembleRelease\r\n\r\n    # ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã¨ã—ã¦ä¿å­˜\r\n    - name: Upload artifact\r\n      uses: actions/upload-artifact@v2\r\n      with:\r\n        name: app-release.apk\r\n        path: app/build/outputs/apk/release/app-release.apk\r\n```\r\n\r\nã‚‚ã—ãƒ–ãƒ©ãƒ³ãƒåãŒé•ã†å ´åˆã¯ `branches: [ release ]` ã¨ `ref: 'release'` ã®`release`ã®éƒ¨åˆ†ã‚’å„è‡ªæ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚(`master`ã¨ã‹ï¼Ÿ)  \r\nGitHubã®Secretã¯å‹æ‰‹ã«ç’°å¢ƒå¤‰æ•°ã«ã¯ãªã‚‰ãªã„ã®ã§ã€`env`ã§å®šç¾©ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\nå‡ºæ¥ãŸã‚‰ã‚³ãƒŸãƒƒãƒˆ+ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/DTux7Rj.png)\r\n\r\n## release ãƒ–ãƒ©ãƒ³ãƒã‚’ push ã—ã¦ã¿ã‚‹\r\n(releaseãƒ–ãƒ©ãƒ³ãƒã‚’GitHub Actionsã®ãƒˆãƒªã‚¬ãƒ¼ã«ã—ã¦ã„ãŸå ´åˆ)\r\n\r\nreleaseãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆã¦ã€pushã—ã¦ã¿ã¾ã™ã€‚  \r\nã“ã‚Œã§å‹•ãå§‹ã‚ã‚‹ã¯ãšã€‚Actionsã‚¿ãƒ–ã¸ç§»å‹•ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/YBBHkun.png)\r\n\r\n## æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’ä½¿ã†\r\npushã›ãšã«å‹•ã‹ã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ã“ã“ã‚’ãƒãƒãƒƒã¨\r\n\r\n![Imgur](https://imgur.com/7Wy1SaZ.png)\r\n\r\nAPKã‚‚ã¡ã‚ƒã‚“ã¨ã‚¢ãƒ¼ãƒ†ã‚£ãƒ•ã‚¡ã‚¯ãƒˆã®æ¬„ã«ã‚ã‚Šã¾ã™ã­ã€‚  \r\nã“ã‚Œã§è‡ªåˆ†ã®PCã¸è² è·ã‚’ã‹ã‘ãšã«APKã‚’ä½œã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã—ãŸã€‚ã‚„ã£ãŸãƒ¼\r\n\r\n![Imgur](https://imgur.com/IwyCZpc.png)\r\n\r\n### ãŠã¾ã‘ è‡ªåˆ†ã®PCã§ç¢ºèªã™ã‚‹ç·¨\r\n**Windowsä»¥å¤–ã¯çŸ¥ã‚Šã¾ã›ã‚“**\r\n\r\nAndroid Studioã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/4knLAkM.png)\r\n\r\nç’°å¢ƒå¤‰æ•°ã®è¨­å®šã‚’ã—ã¾ã™ã€‚`{}`ã®éƒ¨åˆ†ã¯å„è‡ªé•ã†ã¨æ€ã†ã®ã§ãã‚Œãã‚Œå…¥ã‚Œã¦ãã ã•ã„\r\n\r\n```bash\r\nset ENV_SIGN_KEYSTORE_BASE64 = {Base64ã«ã—ãŸç½²åãƒ•ã‚¡ã‚¤ãƒ«}\r\nset ENV_SIGN_KEY_ALIAS = {Key alias}\r\nset ENV_SIGN_KEY_PASSWORD = {Key password}\r\nset ENV_SIGN_STORE_PASSWORD = {Key store password}\r\n```\r\n\r\nç¢ºèªã®ãŸã‚ã«`set`ã‚’å©ãã¨ç’°å¢ƒå¤‰æ•°ä¸€è¦§ã‚’è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™\r\n\r\n```\r\nset\r\n```\r\n\r\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã¨ã‹ã«é–“é•ã„ãŒãªã‘ã‚Œã°ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã—ã¾ã™\r\n\r\n```\r\ngradlew assembleRelease\r\n```\r\n\r\nçµ‚ã‚ã‚‹ã¨ `app/build/outputs/apk/release` ã®ä¸­ã«APKãŒå‡ºæ¥ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\n\r\næœ€ä½é™ã® build.gradle.kts ç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\n```kotlin\r\n// ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ« (appãƒ•ã‚©ãƒ«ãƒ€ã˜ã‚ƒãªã„) build.gradle.kts\r\n\r\n// Top-level build file where you can add configuration options common to all sub-projects/modules.\r\nplugins {\r\n    id(\"com.android.application\").version(\"7.1.0\").apply(false)\r\n    id(\"com.android.library\").version(\"7.1.0\").apply(false)\r\n    id(\"org.jetbrains.kotlin.android\").version(\"1.6.10\").apply(false)\r\n}\r\n\r\ntasks.register(\"clean\") {\r\n    doFirst {\r\n        delete(rootProject.buildDir)\r\n    }\r\n}\r\n```\r\n\r\n```kotlin\r\n// appãƒ•ã‚©ãƒ«ãƒ€å†… build.gradle.kts\r\n\r\nimport java.util.*\r\n\r\nplugins {\r\n    id(\"com.android.application\")\r\n    id(\"kotlin-android\")\r\n    id(\"kotlin-kapt\")\r\n}\r\n\r\nandroid {\r\n    compileSdk = 31\r\n\r\n    defaultConfig {\r\n        applicationId = \"io.github.takusan23.chocodroid\"\r\n        minSdk = 21\r\n        targetSdk = 31\r\n        versionCode = 1\r\n        versionName = \"1.0.0\"\r\n\r\n        testInstrumentationRunner = \"androidx.test.runner.AndroidJUnitRunner\"\r\n    }\r\n\r\n    compileOptions {\r\n        sourceCompatibility = JavaVersion.VERSION_1_8\r\n        targetCompatibility = JavaVersion.VERSION_1_8\r\n    }\r\n    kotlinOptions {\r\n        jvmTarget = \"1.8\"\r\n    }\r\n    buildFeatures {\r\n        viewBinding = true\r\n    }\r\n\r\n    // APKä½œæˆã¨ç½²åã®è¨­å®š\r\n    signingConfigs {\r\n        /**\r\n         * äºˆã‚ GitHubActions ã®ç’°å¢ƒå¤‰æ•°ã«å…¥ã‚Œã¦ãŠã\r\n         *\r\n         * ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§è¡Œã†å ´åˆ (Windows cmd.exe)\r\n         *\r\n         * set ENV_SIGN_KEYSTORE_BASE64 = Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸç½²åãƒ•ã‚¡ã‚¤ãƒ«\r\n         * set ENV_SIGN_KEY_ALIAS = KeyAlias\r\n         * set ENV_SIGN_KEY_PASSWORD = KeyPassword\r\n         * set ENV_SIGN_STORE_PASSWORD = StorePassword\r\n         * */\r\n        create(\"release_signing_config\") {\r\n            // å­˜åœ¨ã—ãªã„å ´åˆã¯ã¨ã‚Šã‚ãˆãšã‚¹ãƒ«ãƒ¼ã™ã‚‹\r\n            if (System.getenv(\"ENV_SIGN_KEYSTORE_BASE64\") != null) {\r\n                // GitHubActionsã®ç’°å¢ƒå¤‰æ•°ã«å…¥ã‚Œã¦ãŠã„ãŸç½²åãƒ•ã‚¡ã‚¤ãƒ«ãŒBase64ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã®ã§æˆ»ã™\r\n                System.getenv(\"ENV_SIGN_KEYSTORE_BASE64\").let { base64 ->\r\n                    val decoder = Base64.getDecoder()\r\n                    // ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã«ä½œæˆã™ã‚‹\r\n                    File(\"keystore.jks\").also { file ->\r\n                        file.createNewFile()\r\n                        file.writeBytes(decoder.decode(base64))\r\n                    }\r\n                }\r\n                // ã©ã†ã‚„ã‚‰ appãƒ•ã‚©ãƒ«ãƒ€ ã®ä¸­ã‚’è¦‹ã«è¡Œã£ã¦ã‚‹ã¿ãŸã„ãªã®ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã™ã‚‹\r\n                storeFile = File(rootProject.projectDir, \"keystore.jks\")\r\n                keyAlias = System.getenv(\"ENV_SIGN_KEY_ALIAS\")\r\n                keyPassword = System.getenv(\"ENV_SIGN_KEY_PASSWORD\")\r\n                storePassword = System.getenv(\"ENV_SIGN_STORE_PASSWORD\")\r\n            }\r\n        }\r\n    }\r\n\r\n    buildTypes {\r\n        release {\r\n            // ç½²åã®è¨­å®šã‚’é©ç”¨ã™ã‚‹\r\n            signingConfig = signingConfigs.getByName(\"release_signing_config\")\r\n            isMinifyEnabled = false\r\n            proguardFiles(getDefaultProguardFile(\"proguard-android-optimize.txt\"), \"proguard-rules.pro\")\r\n        }\r\n    }\r\n\r\n}\r\n\r\ndependencies {\r\n  implementation(\"androidx.core:core-ktx:1.7.0\")\r\n  implementation(\"androidx.appcompat:appcompat:1.4.0\")\r\n  implementation(\"com.google.android.material:material:1.4.0\")\r\n  implementation(\"androidx.constraintlayout:constraintlayout:2.1.1\")\r\n  testImplementation(\"junit:junit:4.13.2\")\r\n  androidTestImplementation(\"androidx.test.ext:junit:1.1.3\")\r\n  androidTestImplementation(\"androidx.test.espresso:espresso-core:3.4.0\")\r\n}\r\n```"},{"title":"GitHub Actions ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ Netlify ã§å…¬é–‹ã™ã‚‹","link":"/posts/github_actions_netlify/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚æˆäººãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚  \r\næˆäººå¼ã¯ä¸­å­¦æ ¡æ¥½ã—ããªã‹ã£ãŸã®ã§è¡Œãã¾ã›ã‚“ã§ã—ãŸã€‚\r\n\r\n# æœ¬é¡Œ\r\n`Netlify`ã§ã©ã†ã‚„ã£ã¦ã‚‚ãƒ“ãƒ«ãƒ‰ãŒé€šã‚‰ãªããªã£ã¦ã—ã¾ã£ãŸã€ã€\r\n\r\n# ç’°å¢ƒ\r\n| ãªã¾ãˆ  | ã‚ãŸã„                       |\r\n|---------|------------------------------|\r\n| Next.js | 13.1.1                       |\r\n| React   | 18.2.0                       |\r\n| Node.js | v18.13.0  (14ç³»ã‹ã‚‰æ›´æ–°ã—ãŸ) |\r\n\r\n# ã©ã†ã‚„ã£ã¦ã‚‚ Netlify ã§ãƒ“ãƒ«ãƒ‰ã§ããªããªã£ã¦ã—ã¾ã£ãŸã€ã€ã€\r\nç›®æ¬¡æ©Ÿèƒ½ã‚’è¿½åŠ ã—ãŸã‚‰`Netlify`ã®ç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰ã§ããªããªã‚Šã¾ã—ãŸã€‚  \r\næ‰‹å…ƒã§ã¯ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã®ã«ã€ã€  \r\n\r\nç›®æ¬¡ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«`jsdom`ã§HTMLã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã‚‹ã®ãŒæ‚ªã„ã‚“ã‹ï¼Ÿè‹¥å¹²ãƒ¡ãƒ¢ãƒªå¤šãä½¿ã†ï¼‹å‡¦ç†æ™‚é–“ã‚‚é•·ããªã‚‹ã‘ã©...ä¸è¶³ã™ã‚‹ã»ã©ã§ã¯ãªã„ã¯ãšã€ãªãœï¼Ÿ\r\n\r\n```plaintext\r\n1:47:29 AM: info  - Compiled successfully\r\n1:47:29 AM: info  - Collecting page data...\r\n1:47:43 AM: info  - Generating static pages (0/236)\r\n1:47:59 AM: info  - Generating static pages (59/236)\r\n1:48:04 AM: info  - Generating static pages (118/236)\r\n1:48:44 AM: Killed\r\n1:48:46 AM: â€‹\r\n1:48:46 AM:   \"build.command\" failed                                        \r\n1:48:46 AM: â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€\r\n1:48:46 AM: â€‹\r\n1:48:46 AM:   Error message\r\n1:48:46 AM:   Command failed with exit code 137: npm run deploy (https://ntl.fyi/exit-code-137)\r\n1:48:46 AM: â€‹\r\n1:48:46 AM:   Error location\r\n1:48:46 AM:   In Build command from Netlify app:\r\n1:48:46 AM:   npm run deploy\r\n```\r\n\r\nèª¿ã¹ã¦ã‚‚å‡ºã¦ã“ãªã„ã€ã€ã®ã§è‰¯ã„æ©Ÿä¼šã ã¨æ€ã„`GitHub Actions`ã«ç§»è¡Œã—ã‚ˆã†ã‹ã¨æ€ã„ã¾ã™ã€‚  \r\n`GitHub Actions -> Netlify`ãªã‚“ã¦ä½•ç•ªç…ã˜ã‹ã‚ˆã£ã¦è©±ã§ã™ãŒä¸€å¿œæ®‹ã—ã¦ãŠãã¾ã™ã€‚\r\n\r\n## ï¼ˆã¡ãªã¿ã«ï¼‰ã‚„ã£ãŸã“ã¨\r\næ‰‹å…ƒã§ã¯ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã®ã§ã€‚`Netlify`ã£ã¦ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¦‹ã›ã¦ãã‚Œã‚‹ã®ã‹ãª\r\n\r\n- `package-lock.json`ã®å‰Šé™¤\r\n- `Node.js`ã‚’`14.x`ã‹ã‚‰`18.x`ã¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ\r\n\r\nä»¥ä¸Šè©¦ã—ã¾ã—ãŸãŒãƒ€ãƒ¡ã§ã—ãŸã€‚\r\n\r\n# GitHub Actions #ã¨ã¯\r\nã»ã‹ã¿ã¦\r\n\r\n[ã‚¿ã‚°å GitHub Actions](/posts/tag/GitHub%20Actions/)\r\n\r\n# Netlifyå´ã®ãƒ“ãƒ«ãƒ‰ã‚’æ­¢ã‚ã‚‹\r\nã“ã‚Œã¯ã‚µã‚¤ãƒˆã®è©³ç´°ãƒšãƒ¼ã‚¸ã¸é€²ã¿ã€`Site settings`ã‚’æŠ¼ã—ã¦ã€`Build & deploy`ã‚’æŠ¼ã—ã€`Stopped builds`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/H67TVrn.png)\r\n\r\n# å¿…è¦ãªå€¤ã‚’é›†ã‚ã‚‹\r\nGitHub Actions ã§åˆ©ç”¨ã™ã‚‹ç’°å¢ƒå¤‰æ•°ï¼ˆã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã¿ãŸã„ãªã‚„ã¤ï¼‰ã‚’ç”¨æ„ã—ã¾ã™ã€‚\r\n\r\n## NETLIFY_AUTH_TOKEN\r\nã‚¢ã‚«ã‚¦ãƒ³ãƒˆãƒšãƒ¼ã‚¸ã®`Applications`ã¸é€²ã¿ã€`New access token`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/fFKKdKT.png)\r\n\r\nã‚³ãƒ”ãƒšã—ã¦é©å½“ãªå ´æ‰€ã«æ§ãˆã¦ãŠãã¾ã™ã€‚ï¼ˆãƒ¡ãƒ¢å¸³ã¨ã‹ï¼‰\r\n\r\n## NETLIFY_SITE_ID\r\nã“ã‚Œã¯ã‚µã‚¤ãƒˆã®è©³ç´°ãƒšãƒ¼ã‚¸ã¸é€²ã¿ã€`Site settings`ã‚’æŠ¼ã—ã¦ã€`Site ID:`ã®å€¤ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚ã¡ã‚‡ã†ã©ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³ãŒå‡ºã¦ã¾ã™ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/QrOEe6z.png)\r\n\r\n## GitHub Actions ã‹ã‚‰å‚ç…§ã§ãã‚‹ã‚ˆã†ã« ç’°å¢ƒå¤‰æ•° ã«è¿½åŠ ã™ã‚‹\r\n**Secrets**ã®ä¸­ã«ã‚ã‚‹**Actions**ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/FLHXe3c.png)\r\n\r\nãã—ãŸã‚‰ã€ä»¥ä¸‹ã®åå‰ã§ç’°å¢ƒå¤‰æ•°ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\n<span style=\"border: solid 2px green;background-color:green;color:#fff;padding:2px;border-radius:5px\"> New repository secret </span>ã‚’æŠ¼ã™ã“ã¨ã§ç’°å¢ƒå¤‰æ•°ã®è¿½åŠ ãŒã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/oDkdXDx.png)\r\n\r\n| ãªã¾ãˆ             | ã‚ãŸã„                  |\r\n|--------------------|-------------------------|\r\n| NETLIFY_AUTH_TOKEN | `New access token` ã®å€¤ |\r\n| NETLIFY_SITE_ID    | `Site ID:` ã®å€¤         |\r\n\r\n# GitHub Actions ã‚’çµ„ã‚€\r\nã“ã“ã‹ã‚‰ç©ºã®`yaml`ãƒ•ã‚¡ã‚¤ãƒ«ãŒä½œæˆã§ãã‚‹ã®ã§\r\n\r\n![Imgur](https://imgur.com/nb1dvD4.png)\r\n\r\nã‚ã¨ã¯ä»¥ä¸‹ã‚’å‚è€ƒã«ä½œã£ã¦ãã ã•ã„ã€‚  \r\nä»¥ä¸‹ã®å€¤ã¯ç’°å¢ƒã«ã‚ˆã£ã¦ã¯é•ã†ã®ã§ã€`yaml`èª¿æ•´ã—ã¦ãã ã•ã„ï¼\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„         |\r\n|----------------|----------------|\r\n| ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ | npm run deploy |\r\n| æˆæœç‰©ä¿å­˜å…ˆ   | ./out          |\r\n\r\nãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã€æˆæœç‰©ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€åã¨ã‹ã¯å„è‡ªé•ã†ã¨æ€ã†ã®ã§\r\n\r\n```yml\r\n# Netlify ã§ãƒ“ãƒ«ãƒ‰ã§ããªããªã£ã¦ã—ã¾ã£ãŸã®ã§ GitHub Actions ã«ã‚„ã‚‰ã›ã¾ã™\r\n\r\n# åå‰\r\nname: Netlify Deploy\r\n\r\n# èµ·å‹•æ¡ä»¶ã€‚pushã¨æ‰‹å‹•èµ·å‹•\r\non:\r\n  push:\r\n  workflow_dispatch:\r\n\r\n# ã‚„ã‚‰ã›ã‚‹ã“ã¨\r\njobs:\r\n  build:\r\n    # OS\r\n    runs-on: ubuntu-latest\r\n    steps:\r\n      - uses: actions/checkout@v2\r\n      \r\n      # Node.js ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\r\n      - name: Install Node.js\r\n        uses: actions/setup-node@v3\r\n        with:\r\n          node-version: 18.13.0\r\n      \r\n      # ä¾å­˜é–¢ä¿‚\r\n      - name: Package install\r\n        run: npm i\r\n      \r\n      # æ›¸ãå‡ºã—\r\n      - name: Build page\r\n        run: npm run deploy\r\n        \r\n      # Netlify ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰\r\n      - name: Upload page\r\n        uses: netlify/actions/cli@master\r\n        with:\r\n          args: deploy --dir=./out --prod\r\n        env:\r\n          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}\r\n          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}\r\n```\r\n\r\n# ã‚³ãƒŸãƒƒãƒˆã—ã¦å®Ÿè¡Œã™ã‚‹\r\nã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã€‚`push`ãŒãƒˆãƒªã‚¬ãƒ¼ï¼Ÿã•ã‚Œã‚‹ã®ã§`GitHub Actions`ã‚‚å‹•ãã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/kWVSwcB.png)\r\n\r\næˆåŠŸã—ã¾ã—ãŸã€‚ã‚„ã£ãŸãœï½ï½ï½  \r\nãã‚Œã«ã—ã¦ã‚‚é•·ã„ãªã€ã€ã€ã©ã†ã—ã‚ˆã†ã“ã‚Œ\r\n\r\n![Imgur](https://imgur.com/vCeXSpb.png)\r\n\r\n# ãŠã¾ã‘\r\n\r\n## æ‰‹å‹•å®Ÿè¡Œãƒœã‚¿ãƒ³\r\nã“ã“\r\n\r\n![Imgur](https://imgur.com/S52InIw.png)\r\n\r\n## Markdownã«è²¼ã‚Šä»˜ã‘ã‚‹ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒƒã‚¸ï¼Ÿãƒãƒƒãƒ‚ï¼Ÿ\r\n`Create status badge`ã‹ã‚‰`Markdown`ã‚’ã‚³ãƒ”ãƒ¼ã§ãã¾ã™\r\n\r\n![Imgur](https://imgur.com/3oL1BLX.png)\r\n\r\n# ãŠã‚ã‚Šã«1\r\nã‚‚ã—ã‹ã—ãŸã‚‰è¨˜äº‹ãŒå¤šã™ããŸã›ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚å°‘ãªã„å ´åˆã¯ä»¥å‰é€šã‚Š`Netlify`ã§ãƒ“ãƒ«ãƒ‰ã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚\r\n\r\n# ãŠã‚ã‚Šã«2\r\n\r\n```ts\r\nimport { JSDOM } from \"jsdom\"\r\n\r\nstatic parseToc(html: string): TocData[] {\r\n    // HTML ãƒ‘ãƒ¼ã‚µãƒ¼ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¦ h1 , h2 ... ã‚’å–å¾—ã™ã‚‹\r\n    // ã“ã®é–¢æ•°ã¯ ãƒ–ãƒ©ã‚¦ã‚¶ ã§ã¯ãªã Node.js ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€document ã¯ä½¿ãˆãªã„ã€‚\r\n    const window = (new JSDOM(html)).window\r\n    const document = window.document\r\n    const tocElementList = document.querySelectorAll('h1, h2, h3, h4, h5, h6')\r\n    // ç›®æ¬¡ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã—ã¦è¿”ã™\r\n    const tocDataList: TocData[] = Array.from(tocElementList).map((element) => ({\r\n        label: element.textContent,\r\n        level: Number(element.tagName.charAt(1)), // h1 ã® 1 ã ã‘å–ã‚Šå‡ºã—æ•°å€¤å‹ã¸\r\n        hashTag: `#${element.getAttribute('id')}` // idå±æ€§ ã‚’å–ã‚Šå‡ºã—ã€å…ˆé ­ã«#ã‚’ã¤ã‘ã‚‹\r\n    }))\r\n    window.close()\r\n    return tocDataList\r\n}\r\n```\r\n\r\nç›®æ¬¡æ©Ÿèƒ½ã®ãŸã‚ã«ç”Ÿæˆã—ãŸHTMLã‹ã‚‰h1,h2...ã‚’å–å¾—ã™ã‚‹ãŸã‚ã«ã€HTMLãƒ‘ãƒ¼ã‚µãƒ¼ã«ã‹ã‘ã¦ã‚‹ã‚“ã§ã™ã‘ã©ã€ã“ã‚Œã®ã›ã„ã§å¤šåˆ†ãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒä¼¸ã³ã¦ã—ã¾ã£ãŸã€ã€ã€  \r\nï¼ˆ10åˆ†ä»¥ä¸Šã‹ã‹ã‚‹ã€‚`GitHub Actions`ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ãƒªãƒã‚¸ãƒˆãƒªã®å ´åˆã¯ç„¡æ–™ã ã‘ã©é•·ã„ã®ã¯ã¡ã‚‡ã£ã¨ã€ã€ï¼‰  \r\n`jsdom`ã˜ã‚ƒãªãã¦`Unified`ã§ã„ã„æ„Ÿã˜ã«å‡¦ç†ã™ã‚‹ã¹ããªã®ã‹ãªã€‚  \r\nï¼ˆæœ€åˆã¯`Unified`ãŒåãå‡ºã™æ§‹æ–‡æœ¨ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ãŸã‘ã©ã€ã‚ã¨ã‚ã¨ãƒ¡ãƒ³ãƒ†ã™ã‚‹ã“ã¨ã‚’è€ƒãˆã‚‹ã¨`JS ã® Document`ã¿ãŸã„ãªæ„Ÿã˜ã®APIãŒä½¿ã„ã‚„ã™ã„ã‹ãªã¨æ€ã„åˆ‡ã‚Šæ›¿ãˆãŸã‚“ã§ã™ã‚ˆã­ã€ã€ã€ï¼‰\r\n\r\nä»¥ä¸Šã§ã™ã€‚æ•°å€¤å‹ã¸ã®å¤‰æ›ã¯`parseInt`ã‚ˆã‚Š`Number`ãŒè‰¯ã„ã£ã¦è¨€ã£ã¦ã¾ã—ãŸã€‚"},{"title":"GitHubã®ãƒªãƒ¢ãƒ¼ãƒˆãƒ–ãƒ©ãƒ³ãƒã‚’å‰Šé™¤ã™ã‚‹","link":"/posts/github_remote_branch_delete/","markdown":"\r\nãƒ–ãƒ©ã‚¦ã‚¶ã‹ã‚‰ã§ãã¾ã™ã€‚\r\n\r\n## ãƒªãƒã‚¸ãƒˆãƒªã‚’é–‹ã\r\nã¯ã„\r\n\r\n![Imgur](https://imgur.com/1dZQe8v.png)\r\n\r\n## branches ã‚’æŠ¼ã™\r\nã“ã“\r\n\r\n![Imgur](https://imgur.com/KuOq8yr.png)\r\n\r\n## ã‚´ãƒŸç®±ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™\r\n`Your branches`ã¨`Active branches`ã®2ã¤ã«è¡¨ç¤ºã•ã‚Œã¦ã¦ã‚‚ã€ã©ã¡ã‚‰ã‹ç‰‡æ–¹ã‚’æŠ¼ã›ã°ä¸¡æ–¹æ¶ˆãˆã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/gKlbMoa.png)\r\n\r\nãŠã—ã¾ã„"},{"title":"Gitã§ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã—çµ‚ã‚ã£ãŸã‚ã¨ã«é–“é•ã„ã«æ°—ä»˜ã„ã¦ã‚³ãƒŸãƒƒãƒˆã‚’ã‚„ã‚Šç›´ã—ãŸã„å ´åˆã¯","link":"/posts/git_commit_and_push_kaizan/","markdown":"\næ­´å²æ”¹ã–ã‚“ã§ã™ã€‚\n\n# æœ¬é¡Œ\n\n- 1.ã‚³ãƒŸãƒƒãƒˆã‚’ã™ã‚‹\n- 2.ãƒ—ãƒƒã‚·ãƒ¥ã‚’ã™ã‚‹\n- 3.è‰ã‚’ç”Ÿã‚„ã™\n- 4.æ¶ˆã—å¿˜ã‚Œã¦ãŸé–¢æ•°ãŒã‚ã‚‹ã“ã¨ã«æ°—ä»˜ã\n    - ã„ã¾ã“ã“\n    - 1ã‹ã‚‰ã‚„ã‚Šç›´ã—ãŸã„ï¼ï¼ï¼\n\n# ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\nä»Šå›ã¯`Git Bash`ã‚’ä½¿ã„ã¾ã™ã€‚  \n~~ç›®ã«å„ªã—ããªã„~~`PowerShell`ã ã¨æ—¥æœ¬èªãŒåŒ–ã‘ã¡ã‚ƒã£ãŸã€‚\n\nã¨ã„ã†ã‚ã‘ã§`.git`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã§å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`Git Bash Here`ã‚’é¸ã³èµ·å‹•ã—ã¾ã—ã‚‡ã†ã€‚\n\n## (ã¡ãªã¿ã«)ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‘ã‚’å¤‰æ›´ã™ã‚‹ã ã‘ãªã‚‰\nãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®å¤‰æ›´ãªã—ã§ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã ã‘ã‚’å¤‰ãˆã‚‹å ´åˆã¯ä»¥ä¸‹ã‚’å©ãã¾ã™ã€‚`--amend`ã£ã¦ã®ãŒé‡è¦ï¼Ÿ\n\n```\ngit commit --amend -m ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\n```\n\nãƒªãƒ¢ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¸ãƒ—ãƒƒã‚·ãƒ¥ã‚’ã™ã‚‹éš›ã¯ä»¥ä¸‹ã‚’å©ãã¾ã™ã€‚\n\n```\ngit push -f origin HEAD\n```\n\nå‹•ãã‹ã©ã†ã‹ã¯æ€ªã—ã„\n\n# ç¾çŠ¶ã®ã‚³ãƒŸãƒƒãƒˆ\nã¾ãšã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’è¦‹ã¾ã—ã‚‡ã†ã€‚\n```\ngit log\n```\nå©ãã¨ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚\n\n```terminal\ncommit b1469aa3cf2cdddb9cfd4877a52018ff17756849 (HEAD -> master)\nAuthor: ãƒ¡ã‚¢ãƒ‰ã¯éš ã•ã›ã¦ã‚‚ã‚‰ã£ãŸã‚ˆ\nDate:   Sun Sep 27 02:57:26 2020 +0900\n\n    å–ã‚Šæ¶ˆã—äºˆå®š\n\ncommit 30eac0d8e356bc9e28d92f34edd8727bc45ff749\nAuthor: ãƒ¡ã‚¢ãƒ‰ã¯éš ã•ã›ã¦ã‚‚ã‚‰ã£ãŸã‚ˆ\nDate:   Sun Sep 27 02:47:00 2020 +0900\n\n    ã‚³ãƒŸãƒƒãƒˆç·´ç¿’\n\ncommit ae1c9930cfb302dc7680cd6ce94c7aaa6dbe5e84\nAuthor: ãƒ¡ã‚¢ãƒ‰ã¯éš ã•ã›ã¦ã‚‚ã‚‰ã£ãŸã‚ˆ\nDate:   Sun Sep 27 02:46:30 2020 +0900\n\n    ãƒ¡ãƒ¢è¿½åŠ \n\n```\n\n(ãƒ¡ã‚¢ãƒ‰ã¯éš ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã—ãŸ)ã€‚\n\nã“ã®ã‚³ãƒŸãƒƒãƒˆã®ä¸­ã‹ã‚‰ã€ä»Šå›ã¯ä¸€ç•ªä¸Šã®`å–ã‚Šæ¶ˆã—äºˆå®š`ã£ã¦ã‚³ãƒŸãƒƒãƒˆã‚’æ¶ˆãã†ã¨æ€ã„ã¾ã™ã€‚\n\n**ãã‚Œã¨ã€å±¥æ­´è¡¨ç¤ºã‚’çµ‚äº†ã•ã›ã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã‚‹å ´åˆã¯ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®`q`ã‚’æŠ¼ã—ã¾ã™**\n\n# ç›´å‰ã®ã‚³ãƒŸãƒƒãƒˆã‚’å–ã‚Šæ¶ˆã™\nã‚³ãƒŸãƒƒãƒˆã‚’å–ã‚Šæ¶ˆã™ã‚“ã§ã™ãŒã€æ³¨æ„ã—ãŸã„ã“ã¨ãŒ\n\n## `git reset --hard` vs `git reset --soft`\nå¤‰æ›´ç‚¹ã‚’ãã®ã¾ã¾ã«ã™ã‚‹ã‹ã©ã†ã‹ã§ã™ã€‚\n- hard\n    - å¤‰æ›´ã‚‚ã™ã¹ã¦æˆ»ã™\n    - ã›ã£ã‹ãæ›¸ã„ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæ°´ã®æ³¡ã«ãªã‚‹\n- soft\n    - ã‚³ãƒŸãƒƒãƒˆã ã‘å–ã‚Šæ¶ˆã—ã¦ã€å¤‰æ›´ã¯ãã®ã¾ã¾ã«ã™ã‚‹\n    - **ã‚³ãƒŸãƒƒãƒˆã‚’ã‚„ã‚Šç›´ã™å ´åˆã¯ã“ã£ã¡ã‚’é¸ã¶**\n\nã“ã‚Œã‚’è¸ã¾ãˆã¦ã€ä»Šå›ã¯å¤‰æ›´ç‚¹ã¯ãã®ã¾ã¾ã‚³ãƒŸãƒƒãƒˆã®ã¿ãªã‹ã£ãŸã“ã¨ã«ã—ã¾ã™ã€‚\n\n```terminal\ngit reset --soft HEAD^\n```\n\nå¤‰æ›´ç‚¹ã¯ãã®ã¾ã¾ã€ã‚³ãƒŸãƒƒãƒˆã ã‘ãŒå–ã‚Šæ¶ˆã•ã‚Œã¦ã‚‹ã¯ãšã§ã™ã€‚\n\n# ã‚³ãƒŸãƒƒãƒˆå±¥æ­´ã‚’ç¢ºèªã—ã¦ã¿ã‚‹\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\n\n```terminal\ngit log\n```\n\nã™ã‚‹ã¨ã€`ãƒ¡ãƒ¢ã ã‚ˆ`ã®ã‚³ãƒŸãƒƒãƒˆãŒç„¡ã„ã“ã¨ã«ãªã£ã¦ã„ã¾ã™ã­ï¼æ­´å²æ”¹ã–ã‚“ï½‹ï½”ï½‹ï½’\n\n```terminal\ncommit 30eac0d8e356bc9e28d92f34edd8727bc45ff749 (HEAD -> master)\nAuthor: ãƒ¡ã‚¢ãƒ‰éš ã—\nDate:   Sun Sep 27 02:47:00 2020 +0900\n\n    ã‚³ãƒŸãƒƒãƒˆç·´ç¿’\n\ncommit ae1c9930cfb302dc7680cd6ce94c7aaa6dbe5e84\nAuthor: ãƒ¡ã‚¢ãƒ‰éš ã—\nDate:   Sun Sep 27 02:46:30 2020 +0900\n\n    ãƒ¡ãƒ¢è¿½åŠ \n\n```\n\n(ãƒ¡ã‚¢ãƒ‰ã¯éš ã•ã›ã¦ã‚‚ã‚‰ã£ãŸã‚ˆ)\n\n\n# ãƒ—ãƒƒã‚·ãƒ¥ã™ã‚‹\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\n\n```terminal\ngit push -f origin HEAD\n```\n\n`-f`ã‚’ã¤ã‘ã‚‹ã“ã¨ã§**æ­´å²æ”¹ã–ã‚“ã‚’æŠ¼ã—é€šã™**äº‹ãŒã§ãã¾ã™ã€‚\n\n# ãŠã¾ã‘\n\n# git reflog ãŒé•·ã™ãã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã‚Œãªã„\nã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®`q`ã‚’æŠ¼ã›ã°ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã¸æˆ»ã‚Œã¾ã™ã€‚\n\n# é–“é•ãˆã¦ git reset --hard ã—ã¦ã—ã¾ã£ãŸ\nã¤ã¾ã‚Šã“ã‚Œã‚„ã£ãŸã£ã¦ã“ã¨ã§ã™ã­ã€‚\n```\ngit reset --hard HEAD^\n```\n\nè½ã¡ç€ã„ã¦ãã ã•ã„ï¼ã©ã†ã«ã‹ãªã‚Šã¾ã™\n\n## git reflog ã¯è¦‹ã¦ã„ã‚‹\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\n```\ngit reflog\n```\n\nã™ã‚‹ã¨`git log`ã‚ˆã‚Šã‚‚è©³ç´°ãªå±¥æ­´ãŒè¦‹ã‚Œã‚‹ã¯ãšã§ã™\n\n```\n30eac0d (HEAD -> master) HEAD@{0}: reset: moving to HEAD^\nb621189 HEAD@{1}: commit: å–ã‚Šæ¶ˆã—äºˆå®š\n30eac0d (HEAD -> master) HEAD@{2}: reset: moving to HEAD^\nb1469aa HEAD@{3}: commit: å–ã‚Šæ¶ˆã—äºˆå®š\n30eac0d (HEAD -> master) HEAD@{4}: reset: moving to HEAD^\n8cd8de9 HEAD@{5}: commit: å–ã‚Šæ¶ˆã™ã‚³ãƒŸãƒƒãƒˆ\n30eac0d (HEAD -> master) HEAD@{6}: reset: moving to HEAD@{1}\n8780022 HEAD@{7}: commit: ãƒ¡ãƒ¢ã ã‚ˆ\n30eac0d (HEAD -> master) HEAD@{8}: commit: ã‚³ãƒŸãƒƒãƒˆç·´ç¿’\nae1c993 HEAD@{9}: commit (initial): ãƒ¡ãƒ¢è¿½åŠ \n```\n\n## ç›®çš„ã®ã‚³ãƒŸãƒƒãƒˆã¾ã§æˆ»ã‚‹\næˆ»ã‚ŠãŸã„ã‚³ãƒŸãƒƒãƒˆã‚’æ¢ã—ï¼ˆä»Šå›ã¯ï¼š`b621189 HEAD@{1}: commit: å–ã‚Šæ¶ˆã—äºˆå®š`ï¼‰ã€`HEAD@{1}`ã®éƒ¨åˆ†ã‚’æ§ãˆã¾ã™ã€‚\n\nãã—ã¦ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™ã€‚\n```\ngit reset --hard HEAD@{1}\n```\n\n`--hard`ã˜ã‚ƒãªã„ã¨ãƒ€ãƒ¡ã¿ãŸã„ã§ã™\n\nã“ã‚Œã§ç„¡äº‹ã«æˆ»ã£ã¦ã“ã‚Œã‚‹ã¯ãšã§ã™ã€‚\n\nGité›£ã—ã„ã­\n\n# å‚è€ƒã«ã—ã¾ã—ãŸ\nhttps://qiita.com/ritukiii/items/74ee3274c3f218511a0c\n\nhttps://reasonable-code.com/git-push-cancel/#git_reset"},{"title":"Gitã§ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã—ãŸã‹ã‚‰ç›´ã™ï¼ˆAndroid Studioï¼‰","link":"/posts/git_conflict/","markdown":"\r\nã‚¹ãƒ¼ãƒ„é«˜ã„ã­\r\n\r\n# æœ¬é¡Œ\r\n- ã—ã‚Œã£ã¨ä»•æ§˜å¤‰æ›´ãŒå…¥ã‚‹  \r\n- ã‚¢ãƒ—ãƒªãŒå‹•ã‹ãªããªã‚‹\r\n- ã„ã£ãŸã‚“ãƒªãƒªãƒ¼ã‚¹ç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆã‚‹\r\n    - é–‹ç™ºä¸­ã¯ã¾ã ãƒªãƒªãƒ¼ã‚¹ã§ããªã„ã®ã§ãƒªãƒªãƒ¼ã‚¹æ™‚ã¾ã§ã„ã£ãŸã‚“ã‚¿ã‚¤ãƒ ã‚¹ãƒªãƒƒãƒ—\r\n- ä¿®æ­£ã™ã‚‹\r\n- ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹\r\n- é–‹ç™ºç”¨ãƒ–ãƒ©ãƒ³ãƒã«ãƒªãƒªãƒ¼ã‚¹ç”¨ãƒ–ãƒ©ãƒ³ãƒã®å†…å®¹ã‚’åæ˜ ã•ã›ã‚‹\r\n    - (masterãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã‚Šæ›¿ãˆã¦) git merge release\r\n- ç«¶åˆï¼ˆã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆï¼‰ã‚’èµ·ã“ã™\r\n- <p style=\"color:red\">â†‘ä»Šã“ã“</p>\r\n\r\n# Android Studio ã§ç›´ã™\r\n`git merge release`ï¼ˆreleaseã¯ãƒ–ãƒ©ãƒ³ãƒåï¼‰ã‚’å®Ÿè¡Œã—ã¦ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã‚’èµ·ã“ã™ã¨ã“ã†ãªã‚Šã¾ã™\r\n\r\n```\r\nAuto-merging app/src/main/res/values/strings.xml\r\nCONFLICT (content): Merge conflict in app/src/main/res/values/strings.xml\r\nAuto-merging app/src/main/res/values-ja/strings.xml\r\nCONFLICT (content): Merge conflict in app/src/main/res/values-ja/strings.xml\r\n```\r\n\r\n*åæ˜ ã—ã‚ˆã†ã¨æ€ã£ãŸã‚‰åŒã˜ã¨ã“ã‚ãŒç·¨é›†ã•ã‚Œã¦ã„ã¦å‹•ã‘ãªããªã£ã¦ã‚‹Gitã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸*\r\n\r\nã“ã®ã¾ã¾ã§ã¯å®Ÿè¡Œã§ããªã„ã®ã§ç›´ã—ã«è¡Œãã¾ã™ã€‚\r\n\r\nã¡ãªã¿ã«Android Studioã§ã¯èµ¤ãè¡¨ç¤ºã•ã‚Œã¾ã™\r\n\r\n![Imgur](https://imgur.com/5rx8pRF.png)\r\n\r\nè©²å½“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ï¼ˆã‚‚ã—ã‹ã—ãŸã‚‰ä½•ã§ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ï¼‰ã€å³ã‚¯ãƒªãƒƒã‚¯â†’Gitâ†’`Resolve Conflicts...`ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/IRe64dn.png)\r\n\r\nãã—ãŸã‚‰ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã®ã§ã€ã©ã£ã¡ã‚’å–ã‚‹ã‹ã€ã‚‚ã—ãã¯ãƒãƒ¼ã‚¸ã™ã‚‹ã‹é¸ã³ã¾ã™ã€‚  \r\nä»Šå›ã¯ä¸¡æ–¹å–ã‚‹ãƒãƒ¼ã‚¸ã‚’æŠ¼ã—ã¾ã™ãŒã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ã‚ˆã£ã¦ã¯`}`ã¨ã‹çµ‚äº†ã‚¿ã‚°ãŒè¶³ã‚Šãªããªã£ãŸã‚Šã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§æ°—ã‚’ã¤ã‘ã¦ã€‚\r\n\r\n![Imgur](https://imgur.com/R7N8v0k.png)\r\n\r\nã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã€‚çœŸã‚“ä¸­ãŒãƒãƒ¼ã‚¸çµæœã€‚å·¦ãŒä»Šã®ãƒ–ãƒ©ãƒ³ãƒã€å³ãŒå–ã‚Šè¾¼ã‚“ã ãƒ–ãƒ©ãƒ³ãƒã«ãªã£ã¦ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/qYE2nLl.png)\r\n\r\nã¾ãšã¯ä»Šã®ãƒ–ãƒ©ãƒ³ãƒã®å†…å®¹ã‚’çµæœã¸å–ã‚Šè¾¼ã¿ã¾ã™ã€‚`>>`ã£ã¦ã¨ã“ã‚ã‚’æŠ¼ã›ã°å–ã‚Šè¾¼ã‚ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ras2mpG.png)\r\n\r\nã“ã‚Œã§çµæœã¸å–ã‚Šè¾¼ã‚ã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/XXUHBAc.png)\r\n\r\næ¬¡ã¯ã€å–ã‚Šè¾¼ã‚“ã ãƒ–ãƒ©ãƒ³ãƒå…ˆã®å¤‰æ›´ã‚‚å–ã‚Šè¾¼ã¿ã¾ã™ã€‚  \r\nå³å´ã®ã¨ã“ã‚ã«ã‚ã‚‹`â””â””`ã¿ãŸã„ãªã¨ã“ã‚ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Nd9wqFn.png)\r\n\r\nã“ã‚Œã§ä¸¡æ–¹ã‚’å–ã‚Šè¾¼ã‚€äº‹ãŒã§ãã¾ã—ãŸã€‚  \r\n`Apply`ã‚’æŠ¼ã—ã¦é–‰ã˜ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/LICxKod.png)\r\n\r\nä»–ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚åŒã˜æ‰‹é †ã§ç›´ã—ã¦è¡Œãã¾ã—ã‚‡ã†ã€‚ï¼ˆç›´ã›ã‚Œã°ï¼‰\r\n"},{"title":"ideaãƒ•ã‚©ãƒ«ãƒ€ã‚’ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†å¯¾è±¡å¤–ã«ã™ã‚‹","link":"/posts/git_idea_dir_ignore/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \nGitã‚ˆãã‚ã‹ã‚‰ã‚“ã‹ã‚‰ã‚„ã‚‰ã‹ã™ã¨ã¾ã˜ã§ç„¦ã‚‹\n\n# æœ¬é¡Œ\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆã™ã‚‹ã¨å‡ºæ¥ã‚‹`.ideaãƒ•ã‚©ãƒ«ãƒ€`ã‚’è¿½è·¡å¯¾è±¡å¤–ã«ã—ãŸã„\n\n# .gitignore ã«æ›¸ãè¶³ã™\n`.gitignore`ã‚’é–‹ãã€`/.idea/`ã‚’è¶³ã—ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/NlexAey.png)\n\n# ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã—ã¾ã™\nã“ã“ã§**ã©ãƒ¼ã›ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãªã‚“ã ã—å…¨éƒ¨æ¶ˆã—ã¦ã—ã¾ãˆï½—**ã£ã¦ã‚„ã£ã¦æ¶ˆã™ã¨å¾Œã§ã€  \n`git add .`ã‚’å©ãã“ã¨ã«ãªã‚‹ã‚“ã§ã™ãŒã€ã“ã‚Œ`.gitignore`ã«è¨˜è¿°ã—ã¦ã„ãªã„ãƒ•ã‚¡ã‚¤ãƒ«å…¨éƒ¨ãŒå¯¾è±¡ã«ãªã£ã¦ã—ã¾ã†ã®ã§ã‚„ã‚ã¨ã‘ã€‚  \n(ã¾ã`git add`ã§è¿½åŠ ã•ã‚ŒãŸããªã„â†’`ã‚ã–ã¨ git add ã—ãªã„`ã‚“ã˜ã‚ƒãªãã¦`.gitignoreæ›¸ã‘`ã£ã¦è©±ãªã‚“ã§ã—ã‚‡ã†ãŒ)\n\nãƒ•ã‚¡ã‚¤ãƒ«åã‚’æŒ‡å®šã—ã¦ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã™ã“ã¨ãŒã§ãã‚‹ã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\n\n```\ngit rm -r --cached .idea\n```\n\n# ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥\n\nãã—ãŸã‚‰ã‚³ãƒŸãƒƒãƒˆã¨ãƒ—ãƒƒã‚·ãƒ¥ã—ã¾ã™ã€‚ãŠã—ã¾ã„\n\n# çµ‚ã‚ã‚Šã«\nã¦ã‹åˆã‚ã‹ã‚‰`.idea`å¯¾è±¡å¤–ã«ã—ã¦ã»ã—ããªã„ï¼Ÿ  \nä»–ã®ãƒ‘ã‚½ã‚³ãƒ³ã§ç§ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’ã‚¯ãƒ­ãƒ¼ãƒ³ã—ã¦å®Ÿè¡Œã—ã‚ˆã†ã¨ã™ã‚‹ã¨ã€`.idea`ã®ã›ã„ã§`JDKã®ãƒ‘ã‚¹ãŒé–“é•ã£ã¦ã¾ãƒ¼ã™`ã£ã¦è¨€ã‚ã‚Œã‚‹ã“ã¨ã‚ã‚‹ã—ãªã‚ã€‚  \nã¡ãªã¿ã«`.idea`æ¶ˆã™ã¨æ•´å½¢ã®è¨­å®šã¨ã‹äºŒå›ç›®ä»¥é™é–‹ã„ãŸã‹ã©ã†ã‹ã¨ã‹ã®ãƒ­ãƒ¼ã‚«ãƒ«ã®è¨­å®šå†…å®¹ãŒé£›ã¶ã ã‘ãªã®ã§ãªã‚“ã‹æ˜¨æ—¥ã¨é•ã†ãªã£ã¦ã¨ãã¯æ¶ˆã—ã¦ã¿ã‚‹ã¨ã„ã„ã‹ã‚‚ï¼Ÿ"},{"title":"GitHubã¸SSHã§å…¥ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹","link":"/posts/git_ssh_setup/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nç‰¹ã«æ›¸ãã“ã¨ãŒãªã‹ã£ãŸã€‚\r\n\r\n# æœ¬é¡Œ\r\nGitHubã¸SSHã§å…¥ã‚‹ã¾ã§ã‚„ã‚Šã¾ã™ã€‚  \r\nã„ã¤ã®é–“ã«ã‹ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ä½¿ãˆãªããªã£ãŸã¿ãŸã„ãªã®ã§ã€‚\r\n\r\n## è¨­å®šã—ãŸã‚‰ä½•ãŒã§ãã‚‹ã®\r\nGitHubã¸`push`ã¨ã‹ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã®`clone`ã¨ã‹ã€‚  \r\nGitHubã«ãƒ­ã‚°ã‚¤ãƒ³ã—ãªã„ã¨ã„ã‘ãªã„ç³»ã®ã‚„ã¤ã€‚\r\n\r\n## Android Studio ã˜ã‚ƒèã‹ã‚Œãªã„å•é¡Œ\r\nã“ã®å„ªç§€IDEï¼ˆHDDæ¥ç¶šã®ç¨®é¡ã˜ã‚ƒãªã„ï¼‰ãŸã¡ã¯GitHubã®ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ä½¿ã£ã¦ã‚‹ã®ã§ã€‚\r\n\r\n# ç’°å¢ƒ\r\n| ãªã¾ãˆ     | ã‚ãŸã„         |\r\n|------------|----------------|\r\n| OS         | Windows 10 Pro |\r\n| ã‚¿ãƒ¼ãƒŸãƒŠãƒ« | Git Bash       |\r\n\r\n\r\n# å…¬å¼\r\n\r\nhttps://docs.github.com/ja/authentication/connecting-to-github-with-ssh/generating-a-new-ssh-key-and-adding-it-to-the-ssh-agent\r\n\r\nhttps://docs.github.com/ja/authentication/connecting-to-github-with-ssh/adding-a-new-ssh-key-to-your-github-account\r\n\r\n# SSHã®ã‚­ãƒ¼ã‚’ä½œæˆã™ã‚‹\r\n\r\n## ä¿å­˜ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œæˆã™ã‚‹\r\n\r\n`C:\\Users\\<ãƒ¦ãƒ¼ã‚¶ãƒ¼å>`ã«`.ssh`ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚Œã°ã„ã„ã®ã§ã™ãŒã€ãªã„å ´åˆã¯ä½œã‚Šã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/b6e2Gdl.png)\r\n\r\n`.ssh`ã‚’é–‹ã„ã¦ã€ãã®ä¸­ã§å³ã‚¯ãƒªãƒƒã‚¯ã‚’ã—ã¦ã€`Git Bash Here`ã‚’æŠ¼ã—ã¦é–‹ãã¾ã™ã€‚  \r\nã¡ãªã¿ã«ãªã‚“ã‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚ã‚Šã¾ã™ãŒæ°—ã«ã—ãªã„ã§ãã ã•ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/sd4iPRw.png)\r\n\r\n## SSHã‚­ãƒ¼ã‚’ä½œæˆ\r\n\r\nGit Bashã«ä»¥ä¸‹ã‚’æ‰“ã¡è¾¼ã¿ã¾ã™ã€‚  \r\n`ssh-keygen -t ed25519`ã ã‘ã§ã‚‚ã„ã„ã‚‰ã—ã„ã§ã™ãŒå…¬å¼ã¯GitHubã§ä½¿ã£ã¦ã‚‹ãƒ¡ã‚¢ãƒ‰ã‚’å…¥ã‚Œã¦ãŸã®ã§ç§ã‚‚å…¥ã‚ŒãŸ\r\n\r\n```terminal\r\nssh-keygen -t ed25519 -C \"GitHubã§ä½¿ã£ã¦ã‚‹ãƒ¡ã‚¢ãƒ‰\"\r\n```\r\n\r\nå…¥åŠ›ã—ã¦Enterã‚’å©ãã¨ã€3å›èã‹ã‚Œã¾ã™ã€‚  \r\n\r\n- Enter a file in which to save the key\r\n    - ä¿å­˜å…ˆã“ã“ãªã®ã§ãã®ã¾ã¾Enter\r\n- Enter passphrase\r\n    - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€‚ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥ã‚ŒãŸã»ã†ãŒã„ã„ã‚‰ã—ã„ã€‚ç©ºã§ã‚‚ã„ã„ã®ã§Enter\r\n- Enter same passphrase again\r\n    - ç©ºã«ã—ãŸã®ã§Enter\r\n\r\nã“ã‚Œã§ã•ã£ãã®ãƒ•ã‚©ãƒ«ãƒ€ã«2ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå‡ºæ¥ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚  \r\n`.pub`ã®æ–¹ã‚’GitHubã¸æ•™ãˆã¦ã‚ã’ã‚‹ã“ã¨ã§SSHã§å…¥ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/6bQnNan.png)\r\n\r\nGit Bashã¯ã¾ã ä½¿ã†ã®ã§é–‹ã„ã¦ãŠã„ã¦ãã ã•ã„ã€‚\r\n\r\n# GitHubã®è¨­å®šã‚’é–‹ã\r\n\r\nã“ã“ã§ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/Txpfhgu.png)\r\n\r\né–‹ã„ãŸã‚‰ã€æ¨ªã®ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®`SSH and GPG keys`ã‚’æŠ¼ã—ã¾ã™ã€‚æŠ¼ã—ãŸã‚‰SSH keysã®éš£ã‚Šã«ã‚ã‚‹ã€`New SSH key`ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/fLgHxK3.png)\r\n\r\nã“ã‚“ãªç”»é¢ã«ãªã‚‹ã¯ãšãªã®ã§ã€é …ç›®ã‚’åŸ‹ã‚ã¦ã„ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/atWouU8.png)\r\n\r\n- Title\r\n    - åå‰ã§ã™ã€‚ä»Šä½¿ã£ã¦ã‚‹ãƒ‘ã‚½ã‚³ãƒ³ã®åå‰ã¨ã‹å…¥ã‚Œã¦ãŠã‘ã°ã„ã„ã§ã—ã‚‡ã†ï¼ˆWindows ã¨ã‹ï¼‰\r\n- Key\r\n    - ã•ã£ãã®Git Bashã‚’ä½¿ã„ã¾ã™ã€‚æ¶ˆã—ã¡ã‚ƒã£ãŸå ´åˆã¯`.ssh`ãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã„ã¦ã¾ãŸGit Bashã§é–‹ã‘ã°ã„ã„ã§ã™ã€‚\r\n    - ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡ã¾ã™ã€‚\r\n        - `clip < ~/.ssh/id_ed25519.pub`\r\n\r\nã“ã‚Œã§ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã«å…¬é–‹éµã®ä¸­èº«ãŒã‚³ãƒ”ãƒ¼ã•ã‚Œã¾ã—ãŸã€‚  \r\nã‚ã¨ã¯ã“ã‚Œã‚’`GitHub`ã®`Key`ã«è²¼ã‚Šä»˜ã‘ã¦ã€`Add SSH key`ã‚’æŠ¼ã—ã¦ä¿å­˜ã—ã¾ã™ã€‚\r\n\r\n# ç–é€šç¢ºèª\r\n\r\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’Git Bashæ‰“ã¡ã¾ã™ã€‚  \r\nGitHub Enterprise ã®å ´åˆã¯`git@github.com`ã®éƒ¨åˆ†ã‚’å„è‡ªå¤‰ãˆã¦ãã ã•ã„ã€‚\r\n\r\n```\r\nssh -T git@github.com\r\n```\r\n\r\nGitHubã®ãƒ¦ãƒ¼ã‚¶ãƒ¼åä»¥å¤–ã¯åŒã˜æ–‡å­—åˆ—ãŒè¿”ã£ã¦ãã‚‹ã¯ãšã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚\r\n\r\n```\r\nHi takusan23! You've successfully authenticated, but GitHub does not provide shell access.\r\n```\r\n\r\nç§˜å¯†éµãªã‚“ã§ã™ãŒã€`.ssh`ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰ç§»å‹•ã›ãšã€åå‰ã‚‚å¤‰æ›´ã—ã¦ãªã„å ´åˆã¯è‡ªå‹•ã§æ¢ã—ã¦ãã‚Œã¾ã™ã€‚\r\n\r\nã“ã‚Œã§è‡ªåˆ†ã®ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãƒªãƒã‚¸ãƒˆãƒªã‚‚ã‚¯ãƒ­ãƒ¼ãƒ³ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãšï¼Ÿ\r\n\r\nä»¥ä¸Šã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚"},{"title":"èµ¤å¤–ç·šã®NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆèª¿æŸ»ã¾ã¨ã‚ï¼Ÿ","link":"/posts/ir_nec_format/","markdown":"\r\n[ã“ã®è¨˜äº‹](/posts/summer_vacation_android_ir/)ã®èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³è§£èª¬ç·¨ï¼Ÿ\r\n\r\n\r\n# å¤‰æ›ç”¨Webãƒšãƒ¼ã‚¸å‡ºæ¥ã¾ã—ãŸ\r\n\r\nå¤šåˆ†ä½¿ãˆã¾ã™ã€‚\r\n\r\nhttps://nec-ir-pattern-hex.netlify.app/\r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰(`Kotlin/JSè£½Webã‚¢ãƒ—ãƒª`)ï¼šhttps://github.com/takusan23/IRPatternHex\r\n\r\n![Imgur](https://imgur.com/cs6t3lv.png)\r\n\r\n## èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’16é€²æ•°ã«å¤‰æ›ã™ã‚‹\r\n\r\nã‚¹ã‚¿ãƒ¼ãƒˆã¯ã“ã‚Œ\r\n\r\n```js\r\n[8925, 4540, 514, 626, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 626, 514]\r\n```\r\n\r\nãã—ã¦ã‚´ãƒ¼ãƒ«ã¯ã“ã‚Œã§ã™ã€‚\r\n\r\n```\r\n0x41b67d82\r\n```\r\n\r\nèª¿ã¹ã¦ã„ã‚‹ã¨èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã¯ãªãã€`ãƒ‡ãƒ¼ã‚¿ã¯ 0x~ ã§ã™ï¼`ã¿ãŸã„ãªã®ã‚’è¦‹ã‹ã‘ãŸã®ã§èª¿æŸ»ã€‚\r\n\r\n**åˆã£ã¦ã„ã‚‹ã‹ã¯çŸ¥ã‚Šã¾ã›ã‚“ã€‚**\r\n\r\nå‚è€ƒã«ã—ã¾ã—ãŸï¼š\r\n\r\nhttp://shrkn65.nobody.jp/remocon/nec.html  \r\nhttp://elm-chan.org/docs/ir_format.html  \r\nhttps://qiita.com/katsumin/items/517cd9fbe66e26d72fa7  \r\nhttps://god-support.blogspot.com/2020/08/nec.html  \r\n\r\n### ã‚„ã£ã¦ã‚‹ã“ã¨\r\n\r\n- èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‹ã‚‰ã©ã“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚’èª¿ã¹ã‚‹ã€‚\r\n- ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»•æ§˜ã«æ²¿ã£ã¦ã€ãƒ‡ãƒ¼ã‚¿éƒ¨(å¾Œè¿°)ã‚’0ã¨1ã«å¤‰æ›\r\n- æœ€å¾Œã«16é€²æ•°ã«å¤‰æ›\r\n\r\nã„ãã¤ã‹ã‚ã‚‹ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆNEC / å®¶è£½å”(AEHA) / SONYï¼‰ã®ä¸­ã‹ã‚‰ä»Šå›ã¯NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®è§£èª¬ã‚’ã€‚\r\n\r\n### ãã‚‚ãã‚‚èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ•°å€¤ä½•ï¼Ÿ\r\n\r\nèµ¤å¤–ç·šLEDã‚’`8.925ãƒŸãƒªç§’`ONã«ã—ã¦ã€`4.540ãƒŸãƒªç§’`OFFã«ã—ã¦ã€`5.14ãƒŸãƒªç§’`ONã«ã™ã‚‹...ã£ã¦æ„å‘³ã§ã™ã€‚\r\n\r\n```json\r\n[8925, 4540, 514, 626, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 626, 514]\r\n```\r\n\r\n### ã“ã®å…ˆå‡ºã‚‹ T(å¤‰èª¿å˜ä½) ã«ã¤ã„ã¦\r\n\r\n`NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ`ã®å ´åˆã¯ãŠãŠã‚ˆã`562`ãŒä½¿ã‚ã‚Œã¦ã„ã¾ã™ã€‚ãƒªãƒ¢ã‚³ãƒ³ã«ã‚ˆã£ã¦ã°ã‚‰ã¤ããŒã‚ã‚‹ã¨æ€ã†ã€‚  \r\nã®ã§ã€`Tã®1å€`ã£ã¦æ›¸ã„ã¦ã‚ã£ãŸå ´åˆã¯ã€`T*1 = 562`ã€`Tã®3å€`ã£ã¦æ›¸ã„ã¦ã‚ã£ãŸå ´åˆã¯`T*3 = 1686`ã£ã¦ã“ã¨ã§ã™\r\n\r\n### èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ§‹é€ \r\n\r\n```\r\n+---------------------------------------------------------------------------------------------------\r\n| ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ 2bit | ãƒ‡ãƒ¼ã‚¿éƒ¨ 32bit         | ãƒˆãƒ¬ãƒ¼ãƒ©ãƒ¼éƒ¨ 1bit |\r\n+---------------------------------------------------------------------------------------------------\r\n```\r\n\r\nä¸Šè¨˜ã®ã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆã®ã‚ˆã†ã«ãªã£ã¦ã¾ã™ã€‚è‰¯ãã‚ã‹ã‚‰ã‚“ã¨æ€ã„ã¾ã™ã®ã§ã‚‚ã†å°‘ã—è§£èª¬ç¶šã‘ã¾ã™ã€‚\r\n\r\n### ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨\r\n\r\næœ€åˆã®ONã€OFFã®ãƒ‡ãƒ¼ã‚¿ãŒãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ã¨ãªã£ã¦ãŠã‚Šã¾ã™ã€‚  \r\nNECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®å ´åˆãŠãŠã‚ˆãã€ONã¯`9ãƒŸãƒªç§’(Tã®16å€)`ã€OFFã¯`4.5ãƒŸãƒªç§’(Tã®9å€)`ã«è¿‘ã„å€¤ã«ãªã‚‹ã¿ãŸã„ã§ã™ã€‚\r\n\r\nå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ï¼ˆçœç•¥ç‰ˆï¼‰ã‚’è¦‹ã¦ã‚‚NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã£ã½ã„ã§ã™ã€‚ï¼ˆNECã®ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆãªã®ã§ãã‚Œã¯ãã†ï¼‰  \r\n\r\n```js\r\n[\r\n    8925, 4540, // ã“ã“ãŒ 9000 , 4500 ãã‚‰ã„ãªã‚‰NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ\r\n    514, 626,\r\n    514,\r\n]\r\n```\r\n\r\n### ãƒ‡ãƒ¼ã‚¿éƒ¨\r\n\r\n3ç•ªç›®ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã«ãªã£ã¦ã„ã¾ã™ã€‚ã“ã“ã§è¦‹ã¦ã»ã—ã„ã®ã¯å³ã¨å·¦ã®ãƒšã‚¢ï¼ˆä¸‹ã®ã‚³ãƒ¼ãƒ‰ã§ã¯éš£åŒå£«ã«æ•´å½¢ã—ã¦ãŠã„ãŸï¼‰ã§ã™ã€‚    \r\nå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’è¦‹ã‚‹ã¨**ãªã‚“ã‹è¿‘ã„å€¤**ã¨**æ˜ã‚‰ã‹ã«2ã€3å€ã«ãªã£ã¦ã‚‹**æ•°å€¤ãŒè¦‹ãˆã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```js\r\n[\r\n    8925, 4540, // ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨åˆ¤æ˜\r\n    514, 626, // è¿‘ã„æ•°å€¤ã ãª...\r\n    514, 1730,  // 3å€ãã‚‰ã„ã«ãªã£ã¦ã‚‹ï¼ï¼Ÿ\r\n    514, 626,  // è¿‘ã„æ•°å€¤ã ãª...\r\n    514\r\n]\r\n```\r\n\r\nNECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»•æ§˜ã§ã¯ã€  \r\n\r\nONãŒ `Tã®1å€ -> Tã®1å€` ã®é †ç•ªã«ãªã£ã¦ã¦ã€ãƒ‡ãƒ¼ã‚¿ã¯`0`  \r\nOFFãŒ `Tã®1å€ -> Tã®3å€`ã®é †ç•ªã«ãªã£ã¦ã„ã¦ã€ãƒ‡ãƒ¼ã‚¿ã¯`1`ã«ãªã£ã¦ã„ã‚‹ã¿ãŸã„ã§ã™ã€‚ï¼Ÿ\r\n\r\nå®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã«ã‚³ãƒ¡ãƒ³ãƒˆã¨ã—ã¦æ›¸ãè¶³ã™ã¨\r\n\r\n```js\r\n[\r\n    8925, 4540, // ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ \r\n    514, 626, // ON ãƒ‡ãƒ¼ã‚¿0\r\n    514, 1730,  // OFF ãƒ‡ãƒ¼ã‚¿1\r\n    514, 626,  // ON ãƒ‡ãƒ¼ã‚¿0\r\n    514\r\n]\r\n```\r\n\r\nã£ã¦æ„Ÿã˜ã«ãªã£ã¦ã„ã¾ã™ã€‚`514`->`626`ã§æ­£ç¢ºã«1å€ã«ã¯ãªã£ã¦ã„ãªã„ã®ã§ã™ãŒå¤šåˆ†ãƒ‡ãƒ¼ã‚¿0ã§åˆã£ã¦ã¾ã™ã€‚  \r\nã“ã®`0`ã¨`1`ãŒNECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã§ã¯32å€‹ç¶šãã¾ã™ï¼ˆ`32bit`ï¼‰\r\n\r\n### 32bitã®ãƒ‡ãƒ¼ã‚¿ã®ä¸­èº«\r\n`16bit`ã§åŒºåˆ‡ã‚Šã¾ã™ã€‚  \r\nåŒºåˆ‡ã£ã¦ã€å‰ã®`16bit`ãŒã‚«ã‚¹ã‚¿ãƒãƒ¼ã‚³ãƒ¼ãƒ‰ã€å¾Œã‚ã®`16bit`ãŒãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚  \r\n\r\n```\r\n0100000110110110 0110010110011010\r\n```\r\n\r\nå¾Œã‚ã®`16bit`ã¯ã€ã•ã‚‰ã«`8bit`ã«åˆ†ã‘ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n```\r\n01100101 10011010\r\n```\r\n\r\nå‰ã®`8bit`ãŒãƒ‡ãƒ¼ã‚¿ã€å¾Œã‚ã®`8bit`ã¯å‰ã®`8bit`ã®åè»¢ã«ãªã£ã¦ã„ã¦ã€æ­£ã—ã„ãƒ‡ãƒ¼ã‚¿ã‹æ¤œè¨¼å‡ºæ¥ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã‚‹ãã†ã§ã™ã€‚(0ãªã‚‰1ã€1ãªã‚‰0)\r\n\r\n```js\r\n01100101 // å‰ã®8bit\r\n10011010 // å¾Œã‚ã®8bitã€‚å‰ã®8bitã¨æ¯”ã¹ã¦0ã¨1ãŒåè»¢ã—ã¦ã„ã‚‹ã€‚\r\n```\r\n\r\n### ãƒˆãƒ¬ãƒ¼ãƒ©ãƒ¼éƒ¨\r\n\r\nã‚ˆãã‚ã‹ã‚‰ã‚“ã€‚å–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®æœ€å¾Œã®`Tã®1å€`ã®å€¤ãŒãã†ã ã¨æ€ã†ã€‚  \r\n\r\n### ãƒ‡ãƒ¼ã‚¿éƒ¨ã‚’2é€²æ•°ã«å¤‰æ›ã™ã‚‹\r\nå–å¾—ã—ãŸãƒ‡ãƒ¼ã‚¿ã®ä¸­ã‹ã‚‰ã€ã¾ãšãƒªãƒ¼ãƒ€ãƒ¼éƒ¨(æœ€åˆã®2å€‹)ã¨ãƒˆãƒ¬ãƒ¼ãƒ©ãƒ¼éƒ¨(æœ€å¾Œã®1å€‹)ã‚’æ¶ˆã—ã¾ã™ã€‚\r\n\r\nè§£èª¬ç”¨ã«çŸ­ãã—ã¦ã„ã¾ã™ã€‚\r\n\r\n```js\r\n[8925, 4540, 514, 626, 514, 1730, 514, 626, 514]\r\n```\r\n\r\nã“ã‚“ãªæ„Ÿã˜ï¼Ÿ\r\n\r\n```js\r\n[514, 626, 514, 1730, 514, 626]\r\n```\r\n\r\næ¬¡ã«ã€`[1,2]`ã€`[3,4]`...ã®ã‚ˆã†ã«ã¾ã¨ã‚ã¦ã„ãã¾ã™\r\n\r\n```js\r\n[[514, 626], [514, 1730], [514, 626]]\r\n```\r\n\r\nãã®å¾Œã€ã¾ã¨ã‚ãŸæ•°å€¤ã‚’æ¯”è¼ƒã—ã¦ã€æœ€åˆã®å€¤ã‚’2å€ã—ã¦ã‚‚ã‚‚ã†ä¸€æ–¹ãŒå¤§ãã„å ´åˆã¯`1`ã€ãã†ã§ãªã„å ´åˆã¯`0`ã‚’å…¥ã‚Œã¦ã„ãã¾ã™  \r\nä»•æ§˜ã§ã¯`Tã®3å€`ã§ã™ã€‚ãŒã°ã‚‰ã¤ããŒã‚ã‚‹ã®ã§ã—ã‚ƒãƒ¼ãªã„ã€‚\r\n\r\n```js\r\n[\r\n    [514, 626],  // 2å€ä»¥ä¸Šã§ã¯ãªã„ => 0\r\n    [514, 1730],  // 2å€ä»¥ä¸Š => 1\r\n    [514, 626]  // 2å€ä»¥ä¸Šã§ã¯ãªã„ => 0\r\n]\r\n```\r\n\r\nã“ã‚“ãªé¢¨ã«\r\n\r\n```js\r\n[0, 1, 0]\r\n```\r\n\r\nãã—ãŸã‚‰ãã£ã¤ã‘ã¦å®Œæˆã§ã™ã€‚ãŠå¥½ã¿ã§16é€²æ•°ã«å¤‰æ›ã—ã¦ã‚‚ã„ã„ã¨æ€ã†ã€‚\r\n\r\n```js\r\nlet bin = \"010\";\r\n```\r\n\r\n### 16é€²æ•°(2é€²æ•°)ã‚’èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã«å¤‰æ›ã™ã‚‹\r\nã“ã®å ´åˆã¯ã€16é€²æ•°ï¼ˆã‚‚ã—ãã¯2é€²æ•°ï¼‰ã®èµ¤å¤–ç·šã®ãƒ‡ãƒ¼ã‚¿ãŒã©ã“ã®ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã‚‚ã®ãªã®ã‹ãŒã‚ã‹ã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n16é€²æ•°ã®ãƒ‡ãƒ¼ã‚¿ã«ã¯ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ãŒå«ã¾ã‚Œã¦ã„ãªã„ãŸã‚åˆ†ã‹ã‚Šã¾ã›ã‚“ã€‚\r\n\r\nä»Šå›ã¯`NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ`ã ã¨ã—ã¦ã€`T`ã¯`562`ã¨ã„ã†è¨­å®šã§è¡Œãã¾ã™ã€‚\r\n\r\nã¾ãšã€é…åˆ—ã‚’ç”¨æ„ã—ã¦ã€ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚\r\n\r\n```js\r\n[8992, 5058]\r\n```\r\n\r\nãã—ãŸã‚‰ã€16é€²æ•°ã®å ´åˆã¯2é€²æ•°ã«æˆ»ã—ã¾ã™ã€‚  \r\næˆ»ã—ãŸã‚‰ã€ãƒ‡ãƒ¼ã‚¿`1`ãŒ[`Tã®1å€`,`Tã®3å€`]ã€`0`ãŒ[`Tã®1å€`,`Tã®1å€`]ã§ã‚ã‚‹ã“ã¨ãŒNECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä»•æ§˜ã«æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã€ãã®ã¨ãŠã‚Šä½œã‚Šã¾ã™ã€‚\r\n\r\n```js\r\nlet bin = \"010\";\r\n[\r\n    8992, 5058, \r\n    562, 562, // 0\r\n    562, 1686, // 1\r\n    562, 562 // 0\r\n]\r\n```\r\n\r\næœ€å¾Œã«ã‚¹ãƒˆãƒƒãƒ—ãƒ“ãƒƒãƒˆã¨ã—ã¦é…åˆ—ã®æœ€å¾Œã«`Tã®1å€`ã‚’å…¥ã‚Œã‚Œã°çµ‚ã‚ã‚Šã€‚\r\n\r\n```js\r\n[8992, 5058, 562, 562, 562, 1686, 562, 562, 562]\r\n```\r\n\r\n### ä»¥ä¸‹å¤‰æ›ç”¨ã®ã‚³ãƒ¼ãƒ‰ã€‚Kotlinç‰ˆ\r\n\r\n```kotlin\r\n\r\nfun main() {\r\n    val pattern = listOf(\r\n        8925, 4540, 514, 626, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 626, 514\r\n    )\r\n    // ã‚°ãƒ«ãƒ¼ãƒ—åŒ–\r\n    val onOffGroupList = patternToOnOffPairList(pattern)\r\n    println(\"èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ ---\")\r\n    println(onOffGroupList)\r\n    // ãƒ‡ãƒ¼ã‚¿éƒ¨2é€²æ•°å¤‰æ›\r\n    val bin = patternToBinCode(pattern)\r\n    println(\"ãƒ‡ãƒ¼ã‚¿éƒ¨ 2é€²æ•° ---\")\r\n    println(bin)\r\n    // ãƒ‡ãƒ¼ã‚¿éƒ¨16é€²æ•°å¤‰æ›\r\n    val hex = binStringToHexString(bin)\r\n    println(\"ãƒ‡ãƒ¼ã‚¿éƒ¨ 16é€²æ•° ---\")\r\n    println(hex)\r\n}\r\n\r\n/**\r\n * [8955, 4510]ã‚’[Pair(8955, 4510)]ã«ã—ã¦ã„ãé–¢æ•°ã€‚æˆ»ã™éš›ã¯flatMapã‚’ä½¿ã£ã¦ãã ã•ã„ã€‚\r\n * */\r\nfun patternToOnOffPairList(patternList: List<Int>) =\r\n    patternList\r\n        .toMutableList()\r\n        .mapIndexed { index, _ ->\r\n            if ((index + 1) % 2 != 0) {\r\n                Pair(patternList[index], patternList.getOrNull(index + 1) ?: 0)\r\n            } else null\r\n        }\r\n        .filterNotNull()\r\n\r\n/**\r\n * [patternList]ã®ãƒ‡ãƒ¼ã‚¿éƒ¨ã‚’2é€²æ•°ã«ã—ã¦è¿”ã™ã€‚\r\n *\r\n * ONã¨OFFãŒ1:3ã®æ¯”ç‡ï¼ˆã ã„ãŸã„ï¼‰ã®å ´åˆã¯1ã€é•ã†å ´åˆã¯0ã«ãªã‚‹\r\n *\r\n * 32bit(32æ–‡å­—)ã«ãªã‚‹ã¯ãš\r\n *\r\n * ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ï¼ˆ9000,4500ï¼‰ï¼ˆã ã„ãŸã„ONãŒ9000ã€OFFãŒ4500ï¼‰ã®æ¬¡ã‹ã‚‰ãŒãƒ‡ãƒ¼ã‚¿éƒ¨ãªã®ã§\r\n *\r\n * ä¾‹\r\n *\r\n * (607, 520) =ï¼ˆON607ã€OFF520ï¼‰ ãªã‚‰ 0\r\n * (607, 1703) =ï¼ˆON607ã€OFF1703ï¼‰ãªã‚‰ 1\r\n *\r\n * å¤‰æ›ä¾‹\r\n * 010000 ...\r\n *\r\n * @param patternList ON/OFFãƒ‘ã‚¿ãƒ¼ãƒ³é…åˆ—\r\n * */\r\nfun patternToBinCode(patternList: List<Int>) =\r\n    patternToOnOffPairList(patternList)\r\n        .drop(1) // ãƒªãƒ¼ãƒ€ãƒ¼éƒ¨ã‚’æ¶ˆã™\r\n        .dropLast(1) // ã‚¹ãƒˆãƒƒãƒ—ãƒ“ãƒƒãƒˆéƒ¨ã‚‚æ¶ˆã™\r\n        .map { (on, off) -> if (off > on * 2) \"1\" else \"0\" } // ONã®2å€ä»¥ä¸Šã§ T*3 ã£ã¦ã“ã¨ã§\r\n        .joinToString(separator = \"\") { it }\r\n\r\n/**\r\n * ï¼’é€²æ•°ã‹ã‚‰ãƒ‘ã‚¿ãƒ¼ãƒ³ç”Ÿæˆã€‚å…ˆé ­ã«ãƒˆãƒ¬ãƒ¼ãƒ©ãƒ¼ã¤ã‘ã¦ã€æœ€å¾Œã«ã‚¹ãƒˆãƒƒãƒ—ãƒ“ãƒƒãƒˆã‚’å…¥ã‚Œã‚‹\r\n *\r\n * @param t å¤‰èª¿ã€‚NECãªã‚‰ 562 å‰å¾Œï¼Ÿ\r\n * @param binCode ï¼’é€²æ•°\r\n * */\r\nfun binCodeToPattern(t: Int, binCode: String) =\r\n    listOf(t * 16, t * 9) + binCode.toList().flatMap { if (it == '1') listOf(t * 1, t * 3) else listOf(t * 1, t * 1) } + listOf(t * 1) // 1ãªã‚‰[T*1,T*3]ã€0ãªã‚‰[T*1,T*1]ã‚’é…åˆ—ã«è¶³ã—ã¦ã„ã\r\n\r\n/**\r\n * 2é€²æ•°ã®æ–‡å­—åˆ—ã‚’16é€²æ•°ã®æ–‡å­—åˆ—ã«å¤‰æ›ã™ã‚‹\r\n *\r\n * \"1010\"ã‚’\"A\"ã«å¤‰æ›ã™ã‚‹\r\n *\r\n * @param binString å¤‰æ›å‰2é€²æ•°ã®æ–‡å­—åˆ—\r\n * */\r\nfun binStringToHexString(binString: String) = \"0x\" + binString.toInt(2).toString(16)\r\n```\r\n\r\nå‡ºåŠ›ä¾‹ã§ã™ã€‚\r\n\r\n```terminal\r\nèµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ ---\r\n[(8925, 4540), (514, 626), (514, 1730), (514, 626), (514, 626), (514, 626), (514, 626), (514, 626), (514, 1730), (514, 1730), (514, 626), (514, 1730), (514, 1730), (514, 626), (514, 1730), (514, 1730), (514, 626), (514, 626), (514, 1730), (514, 1730), (514, 1730), (514, 1730), (514, 1730), (514, 626), (514, 1730), (514, 1730), (514, 626), (514, 626), (514, 626), (514, 626), (514, 626), (514, 1730), (514, 626), (514, 0)]\r\nãƒ‡ãƒ¼ã‚¿éƒ¨ 2é€²æ•° ---\r\n01000001101101100111110110000010\r\nãƒ‡ãƒ¼ã‚¿éƒ¨ 16é€²æ•° ---\r\n0x41b67d82\r\n```\r\n\r\né•·ããªã‚‹ã®ã§GitHubã«ç½®ã„ã¦ãŠãã¾ã™ãŒã€ãƒ‡ãƒ¼ã‚¿éƒ¨ã¨ã‹ã‚‚è¦‹ã‚Œã‚‹å®Œå…¨ç‰ˆã‚‚ç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\nhttps://github.com/takusan23/IrPatternToBin"},{"title":"JavaScriptã§ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢éŒ²ç”»ã¨MPEG-DASHã§ãƒ©ã‚¤ãƒ–é…ä¿¡","link":"/posts/javascript_webm_livestreaming/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯  \r\nDreamin'Her -åƒ•ã¯ã€å½¼å¥³ã®å¤¢ã‚’è¦‹ã‚‹ã€‚- æ”»ç•¥ã—ã¾ã—ãŸã€‚(å…¨å¹´é½¢)  \r\n\r\nå£°å„ªã•ã‚“ãŒè‰¯ã‹ã£ãŸã§ã™ï¼ˆè©³ã—ããªã„ã®ã§åˆ†ã‹ã‚‰ãªã„ã§ã™ãŒï¼‰\r\n![Imgur](https://imgur.com/70hd72N.png)\r\n\r\nä¸­ç›¤ãŒã‘ã£ã“ã†ï¼Ÿé‡ã„ã®ã§ã™ãŒã‚¨ãƒ³ãƒ‡ã‚£ãƒ³ã‚°ã¯ã‚ˆãå‡ºæ¥ã¦ã¦ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã‚¿ã‚¤ãƒˆãƒ«é€šã‚Šã ...\r\n\r\n![Imgur](https://imgur.com/qFAMtAP.png)\r\n\r\n![Imgur](https://imgur.com/sPKP4BO.png)\r\n\r\n![Imgur](https://imgur.com/FYY4Cyy.png)\r\n\r\nã‚ã¨OPæ›²ãŒã‚ã£ã¡ã‚ƒã„ã„ã€‚  \r\nä½œå“ã¨ãƒªãƒ³ã‚¯ã—ã¦ã‚‹ï¼ï¼ï¼\r\n\r\n*ã›ã‚ã¦ ç§ã‚’ éå»ã«ã—ã¦ ä»Šç´¡ã”ã† æœªæ¥ã‚’ ...*  \r\n\r\nOPæ›²ã®`ãŠã‚„ã™ã¿ãƒ¢ãƒã‚¯ãƒ­ãƒ¼ãƒ `ã€ã‚ã£ã¡ã‚ƒã„ã„\r\n\r\nï¼ˆã‚²ãƒ¼ãƒ ã¯Steamã§è²·ãˆã¾ã™ã€‚ï¼‰\r\n\r\n# æœ¬é¡Œ\r\n\r\næœ€è¿‘ã®ãƒ–ãƒ©ã‚¦ã‚¶ã£ã¦æ•°è¡Œã‹ã‘ã°ç”»é¢ã®éŒ²ç”»ãŒå‡ºæ¥ã‚‹ã‚‰ã—ã„ã‚“ã§ã™ã‚ˆã­ã€è©¦ã—ã¦ã¿ã¾ã™ã€‚  \r\nå‰å›ã®è¨˜äº‹ã®å‰¯ç”£ç‰©ã«ãªã‚Šã¾ã™ [ã“ã‚Œ](/posts/android_standalone_webm_livestreaming/)\r\n\r\n# ãƒ–ãƒ©ã‚¦ã‚¶ã§éŒ²ç”»ã™ã‚‹ã¾ã§\r\n\r\n- `getDisplayMedia`ã§ç”»é¢éŒ²ç”»ã®`MediaStream`ã‚’å–å¾—\r\n- â†‘`MediaRecorder`ã®å…¥åŠ›ã«ã™ã‚‹\r\n- `webm`ãŒå‡ºæ¥ã‚‹\r\n\r\nãªã‚“ã‚„ã“ã‚Œ...Androidã§ã‚„ã‚‹ã‚ˆã‚Šç°¡å˜ï¼ ( https://takusan23.github.io/Bibouroku/2020/04/06/MediaProjection/ )ã€JSã™ã’ï½  \r\n\r\næµçŸ³ã«PCç‰ˆã«ã—ã‹å®Ÿè£…ã•ã‚Œã¦ã¾ã›ã‚“ã§ã—ãŸãŒã€ãã‚Šã‚ƒãã†ã‹â†’ https://caniuse.com/?search=getDisplayMedia\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„                                                                      |\r\n|---------|-----------------------------------------------------------------------------|\r\n| Windows | 10 Pro 21H2 (Win11ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ä½¿ã„ã«ãã„ã®ã©ã†ã«ã‹ãªã‚‰ãªã„ã®ï¼›ï¼›) |\r\n| Chrome  | 105                                                                         |\r\n\r\nå¤šåˆ†`localhost`ã¿ãŸã„ãªå†…éƒ¨ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ãªãã¦ã‚‚ã€`file`ã‚¹ã‚­ãƒ¼ãƒã§å‹•ã...ï¼Ÿ\r\n\r\n## ãƒ–ãƒ©ã‚¦ã‚¶ã§ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢ã‚’å–å¾—ã™ã‚‹ï¼ˆãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ï¼‰\r\n`<video>`ã§ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢ã‚’ãƒŸãƒ©ãƒ¼ã™ã‚‹ã ã‘ãªã‚‰ã“ã‚Œã ã‘ã§å‹•ãã¾ã™ã€ä½•ã‚„ã“ã‚Œä¸€ä½“...\r\n\r\n![Imgur](https://imgur.com/wrmpuFZ.png)\r\n\r\nã“ã‚Œã ã‘ï¼ˆPromiseãŒãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚ŒãŸå ´åˆãªã©ã¯è¦‹ã¦ãªã„ã§ã™ãŒï¼‰ã§ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢ãŒvideoè¦ç´ å†…ã§å†ç”Ÿã§ãã¦ã„ã¾ã™ï¼\r\n\r\n![Imgur](https://imgur.com/aCMWFR9.png)\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>getUserMedia</title>\r\n</head>\r\n\r\n<body>\r\n    <div class=\"parent\">\r\n        <button id=\"rec_button\">éŒ²ç”»é–‹å§‹</button>\r\n        <video id=\"video\" width=\"640\" height=\"320\" muted autoplay />\r\n    </div>\r\n</body>\r\n\r\n<style>\r\n    .parent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-start;\r\n    }\r\n</style>\r\n\r\n<script>\r\n    const recordButton = document.getElementById('rec_button')\r\n    const videoElement = document.getElementById('video')\r\n\r\n    // éŒ²ç”»ã‚’é–‹å§‹ã—ã¦ã€canvasã«æç”»ã™ã‚‹\r\n    const startRec = async () => {\r\n        // ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã—ã¦ãã‚Œã‚‹ã‚„ã¤\r\n        const displayMedia = await navigator.mediaDevices.getDisplayMedia({ audio: true, video: true })\r\n        // ã¨ã‚Šã‚ãˆãš videoè¦ç´  ã§å†ç”Ÿ\r\n        videoElement.srcObject = displayMedia\r\n    }\r\n\r\n    // éŒ²ç”»ãƒœã‚¿ãƒ³æŠ•ä¸‹æ™‚\r\n    recordButton.onclick = () => {\r\n        startRec()\r\n    }\r\n\r\n</script>\r\n\r\n</html>\r\n```\r\n\r\n## ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢ã‚’éŒ²ç”»ã™ã‚‹\r\n`MediaRecorder`ã«`getDisplayMedia()`ã®è¿”ã‚Šå€¤ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€éŒ²ç”»ã‚‚ã§ãã¾ã™ï¼  \r\n\r\nå‚è€ƒã«ãªã‚Šã¾ã—ãŸï¼  \r\nhttps://qiita.com/miyataku/items/6ed855a7fb7507ccc244\r\n\r\nã¡ã‚ƒã‚“ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹\r\n\r\n![Imgur](https://imgur.com/3wnkTpl.png)\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>getUserMedia</title>\r\n</head>\r\n\r\n<body>\r\n    <div class=\"parent\">\r\n        <button id=\"rec_button\">éŒ²ç”»é–‹å§‹</button>\r\n        <button id=\"stop_button\">éŒ²ç”»çµ‚äº†</button>\r\n        <video id=\"video\" width=\"640\" height=\"320\" muted autoplay />\r\n    </div>\r\n</body>\r\n\r\n<style>\r\n    .parent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-start;\r\n    }\r\n</style>\r\n\r\n<script>\r\n\r\n    // @ts-check\r\n\r\n    // ä»Šå›åˆ©ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\n    const MIME_TYPE = `video/webm; codecs=\"vp9,opus\"`\r\n    // éŒ²ç”»ã™ã‚‹ã‚„ã¤\r\n    let mediaRecorder\r\n    // WebMãƒ‡ãƒ¼ã‚¿ãŒç´°åˆ‡ã‚Œã«ãªã£ã¦æ¥ã‚‹ã®ã§ä¸€æ™‚çš„ã«ä¿å­˜ã™ã‚‹\r\n    let chunks = []\r\n\r\n    const recordButton = document.getElementById('rec_button')\r\n    const stopButton = document.getElementById('stop_button')\r\n    const videoElement = document.getElementById('video')\r\n\r\n    // éŒ²ç”»ã‚’é–‹å§‹ã—ã¦ã€canvasã«æç”»ã™ã‚‹\r\n    const startRec = async () => {\r\n        // ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã—ã¦ãã‚Œã‚‹ã‚„ã¤\r\n        const displayMedia = await navigator.mediaDevices.getDisplayMedia({ audio: true, video: true })\r\n        // ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢ã‚’æµã™\r\n        mediaRecorder = new MediaRecorder(displayMedia, { mimeType: MIME_TYPE })\r\n        // éŒ²ç”»ãƒ‡ãƒ¼ã‚¿ãŒç€ãŸã‚‰å‘¼ã°ã‚Œã‚‹\r\n        mediaRecorder.ondataavailable = (ev) => {\r\n            chunks.push(ev.data)\r\n        }\r\n        // éŒ²ç”»é–‹å§‹ã€‚100msã”ã¨ã« ondataavailable ãŒå‘¼ã°ã‚Œã¦ãƒ‡ãƒ¼ã‚¿ãŒè²°ãˆã‚‹ã‚ˆã†ã«ã€‚\r\n        mediaRecorder.start(100)\r\n        // ã¨ã‚Šã‚ãˆãš videoè¦ç´  ã§å†ç”Ÿ\r\n        videoElement.srcObject = displayMedia\r\n    }\r\n\r\n    // éŒ²ç”»ãƒœã‚¿ãƒ³æŠ•ä¸‹æ™‚\r\n    recordButton.onclick = () => {\r\n        startRec()\r\n    }\r\n\r\n    // çµ‚äº†ãƒœã‚¿ãƒ³æŠ•ä¸‹æ™‚\r\n    stopButton.onclick = () => {\r\n        // éŒ²ç”»ã‚’æ­¢ã‚ã‚‹\r\n        mediaRecorder.stop()\r\n        // BlobUrlã‚’ä½œæˆã—ã€aè¦ç´ ã§ãƒªãƒ³ã‚¯ã‚’ä½œã‚ŠJSã§æŠ¼ã™ã“ã¨ã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã›ã‚‹ï¼ˆDLå‡ºæ¥ã‚‹ã‚“ã ï¼\r\n        const blob = new Blob(chunks, { type: MIME_TYPE })\r\n        const blobUrl = URL.createObjectURL(blob)\r\n        const aElement = document.createElement('a')\r\n        aElement.style.display = 'none'\r\n        aElement.href = blobUrl\r\n        aElement.download = `record-${Date.now()}.webm`\r\n        document.body.appendChild(aElement)\r\n        aElement.click()\r\n        // TODO BlobUrlã®ãƒªã‚½ãƒ¼ã‚¹é–‹æ”¾\r\n    }\r\n\r\n</script>\r\n\r\n</html>\r\n```\r\n\r\nã¡ãªã¿ã«ã“ã‚Œã§ç”Ÿæˆã•ã‚Œã‚‹`webm`ã¯å†ç”Ÿæ™‚é–“ãŒãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ã«å…¥ã£ã¦ã„ãªã„ãŸã‚ã€ã‚·ãƒ¼ã‚¯ãŒé…ã„ã‚‰ã—ã„ã€‚  \r\nã“ã“ã¾ã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ãŠã„ã¦ãŠãã¾ã™\r\n\r\nhttps://github.com/takusan23/browser-screen-record  \r\n\r\n`index.html`ã‚’ã‚³ãƒ”ãƒšã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‘ã°ä½¿ãˆã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n## ã—ãã¿\r\n`MediaRecorder`ã®`ondataavailable`ã¯éŒ²ç”»ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒè²°ãˆã‚‹ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã«ãªã£ã¦ã¾ã™ã€‚  \r\n`MediaRecorder#start()`ã®å¼•æ•°ã«æ™‚é–“ã‚’ãƒŸãƒªç§’ã§å…¥ã‚Œã‚‹ã¨ï¼ˆä¸Šè¨˜ã ã¨100ãƒŸãƒªç§’ï¼ˆ0.1ç§’ï¼‰ï¼‰ã€ãã®æ™‚é–“ã®é–“éš”ã§`ondataavailable`ãŒå‘¼ã°ã‚Œã¾ã™ã€‚  \r\nã“ã‚Œã‚’é…åˆ—ã«é †æ¬¡ä¿å­˜ã—ã¦ã€æœ€å¾Œã«çµåˆã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã„ã¾ã™ã€‚\r\n\r\nã¤ã¾ã‚Šã€`ondataavailable`ã§è²°ãˆã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¨ã‹ã«ä½•ã‚‰ã‹ã®æ–¹æ³•ï¼ˆ`WebSocket`ã¨ã‹ï¼‰ã§é€ä¿¡ã§ãã‚Œã°ã€ãƒ­ãƒ¼ã‚«ãƒ«ãƒ©ã‚¤ãƒ–é…ä¿¡ã®å®Œæˆã«ãªã‚Šã¾ã™ã€‚ï¼ï¼ï¼\r\n\r\n**ã¡ãªã¿ã«ã€**`ondataavailable`ã¯ã‚ãã¾ã§ã‚‚ãƒ‡ãƒ¼ã‚¿ã‚’åˆ†å‰²ã—ã¦ã‚‹ã ã‘ãªã®ã§ã€å…¨éƒ¨æƒã‚ãªã„ã¨å‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ã¯æˆã‚Šç«‹ãŸãªã„ã§ã™ã€‚  \r\næœ€åˆã®å‹•ç”»ã¯å˜ç‹¬ã§å†ç”Ÿã§ãã¾ã™ãŒã€ï¼’å€‹ç›®ä»¥é™ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ï¼ŸãŒå…¥ã£ã¦ãªã„ã®ã§å†ç”Ÿã§ãã¾ã›ã‚“ã€‚  \r\nï¼ˆã‚‚ã—ã‹ã™ã‚‹ã¨æœ€åˆã®ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ãŒã‚ã‚Œã°ãªã‚“ã‹å†ç”Ÿã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™...ï¼‰\r\n\r\n# ã“ã‚ŒãŒã§ãã‚Œã° WebM ã§ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒå‡ºæ¥ã‚‹ã®ã§ã¯ï¼Ÿ\r\n[å‰å›ã®è¨˜äº‹](/posts/android_standalone_webm_livestreaming/) ã®Androidã¨é•ã„ã€ã‚µãƒ¼ãƒãƒ¼å´ãŒå¿…è¦ã§ã™ãŒä¼¼ãŸã‚ˆã†ãªã“ã¨ãŒã§ããã†ãªã®ã§ã‚„ã£ã¦ã¿ã¾ã™ã€‚\r\n\r\n## ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ         | ã‚ãŸã„                    |\r\n|----------------|---------------------------|\r\n| ã‚µãƒ¼ãƒãƒ¼å´è¨€èª | Kotlin (Ktorä½¿ã„ãŸã„...!) |\r\n| ã‚µãƒ¼ãƒãƒ¼å´æŠ€è¡“ | Ktor                      |\r\n| ãƒ•ãƒ­ãƒ³ãƒˆå´æŠ€è¡“ | dash.js                   |\r\n\r\n## WebM / MPEG-DASH ã§ãƒ©ã‚¤ãƒ–é…ä¿¡\r\n`MPEG-DASH`ã§å‡ºæ¥ã‚‹ã®ã§ã™ãŒã€ãŸã `WebM`ã‚’å…¬é–‹ã™ã‚Œã°ã„ã„ã¨ã„ã†**ã‚ã‘ã§ã¯ãªã**ã€`åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ`ã¨`ãƒ¡ãƒ‡ã‚£ã‚¢ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ`ã«åˆ†ã‘ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nãŒã€ä»Šå›ã¯é¢å€’ãªã®ã§æœ€åˆã«å‡ºã¦ããŸ`webm`ã‚’åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨ã—ã¦ä½¿ãŠã†ã‹ãªã¨  \r\nã¡ãªã¿ã«`åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆ`ã¯å¤šåˆ†`Clusterã®é–‹å§‹ã‚¿ã‚°`ï¼ˆ`0x1F 0x43 0xB6 0x75`ï¼‰ã®å‰ã¾ã§ã§ã™ã€‚ã¡ã‚ƒã‚“ã¨ã‚„ã‚‹ãªã‚‰ãã®ç¯„å›²ã ã‘ã®ãƒ•ã‚¡ã‚¤ãƒ«(`init.webm`)ã¿ãŸã„ãªã®ã‚’ä½œã‚‹ã¹ãã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nè©³ã—ãã¯ [å‰å›ã®è¨˜äº‹](/posts/android_standalone_webm_livestreaming/) ã§\r\n\r\n### ã¡ãªã¿ ã«æœ€åˆã«å‡ºã¦ããŸ`webm`ã‚’åˆæœŸåŒ–ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã¨ã—ã¦åˆ©ç”¨ã§ãã‚‹ç†ç”±\r\nå˜ç´”ã«`Clusterã®é–‹å§‹ã‚¿ã‚°`ã‚ˆã‚Šå‰ã®éƒ¨åˆ†ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ã‚‰ã€‚  \r\nãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã®èµ·å‹•ã«å¿…è¦ãªãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã®ãŒã€æœ€åˆã«å‘¼ã°ã‚Œã‚‹`ondataavailable`ã«ã¯ã‚ã‚‹ã€‚\r\n\r\n(ï¼’å€‹ç›®ä»¥é™ã«ã¯å«ã¾ã‚Œã¦ã„ãªã„ãŸã‚ã€ï¼’å€‹ç›®ä»¥é™ã®ãƒã‚¤ãƒŠãƒªã‚’æ¸¡ã—ãŸã¨ã“ã‚ã§å†ç”Ÿã§ããªã„ï¼›ï¼›)\r\n\r\n## Ktorã§é©å½“ã«APIã‚’ã¤ãã‚‹\r\nãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¯ä½•ã‚‚è©³ã—ããªã„ã®ã§...\r\n\r\n- `/api/upload`\r\n    - Webãƒ•ãƒ­ãƒ³ãƒˆã®`MediaRecorder`ã®`ondataavailable`ãŒå‘¼ã°ã‚ŒãŸã‚‰ãƒã‚¤ãƒŠãƒªã‚’é€ã‚‹APIã€‚POST\r\n    - ã‚ˆãçŸ¥ã‚‰ã‚“ã‘ã© `multipart-formdata` ã«ã™ã‚‹\r\n- `/`\r\n    - `index.html`ã‚’è¿”ã™ã€è¦–è´ãƒšãƒ¼ã‚¸ å…¼ éŒ²ç”»ãƒšãƒ¼ã‚¸\r\n- `manifest.mpd`\r\n    - `MPEG-DASH`ã®ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’è¿”ã—ã¾ã™ã€‚`dash.js`ã«æ¸¡ã™\r\n- `segment1.webm`ã€`segment2.webm`...\r\n    - `/api/upload`ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿å­˜ã—ã¦ã„ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’é™çš„é…ä¿¡ã™ã‚‹\r\n    - Ktorã®staticå…¬é–‹æ©Ÿèƒ½ã§\r\n\r\n# ã‚µã‚¯ã‚µã‚¯ã£ã¨ä½œã‚‹\r\n\r\né©å½“ã«`IDEA`ã§ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã¾ã™ã€‚  \r\n`Ktor`ã€ç°¡å˜ã«Webã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¦ã‚Œã¦ã„ã„æ„Ÿã˜ã€‚ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚ˆãåˆ†ã‹ã‚‰ã‚“ã‘ã©ï¼›ï¼›\r\n\r\n![Imgur](https://imgur.com/5PXwH3j.png)\r\n\r\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹\r\n`build.gradle.kts`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\ndependencies {\r\n\r\n    // Ktor\r\n    val ktorVersion = \"2.1.1\"\r\n    implementation(\"io.ktor:ktor-server-core:$ktorVersion\")\r\n    implementation(\"io.ktor:ktor-server-netty:$ktorVersion\")\r\n\r\n    testImplementation(kotlin(\"test\"))\r\n}\r\n```\r\n\r\n## Main.kt\r\nãªã‚“ã‹`Main.kt`ãŒãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã«å±…ãªã„ï¼ˆã¨è¨€ã†ã‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã™ã‚‰ç„¡ã„ï¼‰ã®ã§ä½œã£ã¦ç§»å‹•ã•ã›ã¾ã™ã€‚  \r\n`Kotlin`ã ã¨ã„ã‚‰ãªã„ã‚“ã§ã™ã‹ã­ï¼ˆãã‚“ãªäº‹ã‚ã‚‹ï¼Ÿï¼‰\r\n\r\n`ãƒ‰ãƒ¡ã‚¤ãƒ³å.ã‚¢ãƒ—ãƒªå`ã¿ãŸã„ãªæ„Ÿã˜ã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½œã£ã¦ç§»å‹•ã•ã›ã¾ã—ãŸã€‚`io.github.takusan23.browserdashmirroring`\r\n\r\n![Imgur](https://imgur.com/WasHxwe.png)\r\n\r\n\r\n```kotlin\r\npackage io.github.takusan23.browserdashmirroring\r\n\r\nimport io.ktor.http.*\r\nimport io.ktor.http.content.*\r\nimport io.ktor.server.application.*\r\nimport io.ktor.server.engine.*\r\nimport io.ktor.server.http.content.*\r\nimport io.ktor.server.netty.*\r\nimport io.ktor.server.request.*\r\nimport io.ktor.server.response.*\r\nimport io.ktor.server.routing.*\r\nimport java.io.File\r\n\r\nfun main(args: Array<String>) {\r\n\r\n    // æ˜ åƒã®ä¿å­˜å…ˆ\r\n    // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ•ã‚©ãƒ«ãƒ€ã«ä½œã‚‹\r\n    // Node.js ã® process.cwd() ã¿ãŸã„ãª\r\n    val projectFolder = System.getProperty(\"user.dir\")\r\n    val segmentSaveFolder = File(projectFolder, \"static\").apply {\r\n        listFiles()?.forEach { it.delete() }\r\n        mkdir()\r\n    }\r\n\r\n    // ã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹\r\n    var index = 0\r\n\r\n    println(\"http://localhost:8080\")\r\n\r\n    embeddedServer(Netty, port = 8080) {\r\n        routing {\r\n            // ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã® resources ãƒ•ã‚©ãƒ«ãƒ€ã‹ã‚‰å–å¾—\r\n            // index.html ã‚’è¿”ã™\r\n            resource(\"/\", \"index.html\")\r\n            // ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã‚’è¿”ã™\r\n            resource(\"/manifest.mpd\", \"manifest.mpd\")\r\n\r\n            // ãƒ•ãƒ­ãƒ³ãƒˆå´ã‹ã‚‰WebMã®ç´°åˆ‡ã‚ŒãŒé€ã‚‰ã‚Œã¦ãã‚‹ã®ã§ä¿å­˜ã—ã¦ã„ã\r\n            post(\"/api/upload\") {\r\n                // Multipart-FormDataã‚’å—ã‘å–ã‚‹\r\n                call.receiveMultipart().forEachPart { partData ->\r\n                    if (partData is PartData.FileItem) {\r\n                        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ä¿å­˜\r\n                        File(segmentSaveFolder, \"segment${index++}.webm\").apply {\r\n                            createNewFile()\r\n                            writeBytes(partData.streamProvider().readAllBytes())\r\n                        }\r\n                    }\r\n                }\r\n                call.respond(HttpStatusCode.OK, \"ä¿å­˜ã§ãã¾ã—ãŸ\")\r\n            }\r\n\r\n            // é™çš„ãƒ•ã‚¡ã‚¤ãƒ«å…¬é–‹ã™ã‚‹ã‚ˆã†ã«ã€‚å‹•ç”»ã‚’é…ä¿¡ã™ã‚‹\r\n            static {\r\n                staticRootFolder = segmentSaveFolder\r\n                files(segmentSaveFolder)\r\n            }\r\n        }\r\n    }.start(true)\r\n}\r\n```\r\n\r\nãƒ•ãƒ­ãƒ³ãƒˆãŒæŠ•ã’ã¦ããŸãƒ‡ãƒ¼ã‚¿ã¯ä¸Šè¨˜ã®ä¾‹ã ã¨ã“ã“ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/xlqra1d.png)\r\n\r\n## index.html\r\n`resources`ã«ç½®ãã¾ã™ã€‚ã“â†‘ã“â†“ã§ã™\r\n\r\n![Imgur](https://imgur.com/cHSV5Oi.png)\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>getUserMedia</title>\r\n    <!-- MPEG-DASH è¦–è´ç”¨ -->\r\n    <script src=\"https://cdn.dashjs.org/latest/dash.all.debug.js\"></script>\r\n</head>\r\n\r\n<body>\r\n    <div class=\"parent\">\r\n        <button id=\"live_button\">é…ä¿¡é–‹å§‹</button>\r\n        <button id=\"watch_button\">è¦–è´é–‹å§‹</button>\r\n        <video id=\"video\" width=\"640\" height=\"320\" muted autoplay />\r\n    </div>\r\n</body>\r\n\r\n<style>\r\n    .parent {\r\n        display: flex;\r\n        flex-direction: column;\r\n        align-items: flex-start;\r\n    }\r\n</style>\r\n\r\n<script>\r\n\r\n    // @ts-check\r\n\r\n    // ä»Šå›åˆ©ç”¨ã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯\r\n    const MIME_TYPE = `video/webm; codecs=\"vp9\"`\r\n    // éŒ²ç”»ã™ã‚‹ã‚„ã¤\r\n    let mediaRecorder\r\n    // WebMãƒ‡ãƒ¼ã‚¿ãŒç´°åˆ‡ã‚Œã«ãªã£ã¦æ¥ã‚‹ã®ã§ä¸€æ™‚çš„ã«ä¿å­˜ã™ã‚‹\r\n    let chunks = []\r\n    // æ˜ åƒã‚’é€ã‚‹é–“éš”\r\n    const SEND_INTERVAL_MS = 3_000\r\n\r\n    const recordButton = document.getElementById('live_button')\r\n    const watchButton = document.getElementById('watch_button')\r\n    const videoElement = document.getElementById('video')\r\n\r\n    // ã‚µãƒ¼ãƒãƒ¼ã«æ˜ åƒã‚’é€ã‚‹\r\n    const sendSegment = (segment) => {\r\n        const form = new FormData()\r\n        form.append('data', segment)\r\n        fetch('/api/upload', { method: 'POST', body: form })\r\n    }\r\n\r\n    // éŒ²ç”»ã‚’é–‹å§‹ã—ã¦ã€canvasã«æç”»ã™ã‚‹\r\n    const startRec = async () => {\r\n        // ç”»é¢ã‚’ã‚­ãƒ£ãƒ—ãƒãƒ£ãƒ¼ã—ã¦ãã‚Œã‚‹ã‚„ã¤\r\n        const displayMedia = await navigator.mediaDevices.getDisplayMedia({ audio: true, video: true })\r\n        // ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢ã‚’æµã™\r\n        mediaRecorder = new MediaRecorder(displayMedia, { mimeType: MIME_TYPE })\r\n        // éŒ²ç”»ãƒ‡ãƒ¼ã‚¿ãŒç€ãŸã‚‰å‘¼ã°ã‚Œã‚‹ã€‚ã‚µãƒ¼ãƒãƒ¼ã«é€ã‚‹\r\n        mediaRecorder.ondataavailable = (ev) => {\r\n            sendSegment(ev.data)\r\n        }\r\n        // éŒ²ç”»é–‹å§‹\r\n        mediaRecorder.start(SEND_INTERVAL_MS)\r\n        // ã¨ã‚Šã‚ãˆãš videoè¦ç´  ã§å†ç”Ÿ\r\n        videoElement.srcObject = displayMedia\r\n    }\r\n\r\n    // é…ä¿¡ãƒœã‚¿ãƒ³æŠ•ä¸‹æ™‚\r\n    recordButton.onclick = () => {\r\n        startRec()\r\n    }\r\n\r\n    // è¦–è´ãƒœã‚¿ãƒ³æŠ•ä¸‹æ™‚\r\n    // dash.js ã«ã‚ˆã‚‹ MPEG-DASH ã®å†ç”Ÿã‚’è©¦ã¿ã‚‹\r\n    watchButton.onclick = () => {\r\n        const url = \"/manifest.mpd\";\r\n        const player = dashjs.MediaPlayer().create();\r\n        player.initialize(videoElement, url, true);\r\n    }\r\n\r\n</script>\r\n\r\n</html>\r\n```\r\n\r\n## manifest.mpd\r\nã“ã‚Œã‚‚`resources`ã«ç½®ãã¾ã™ã€‚  \r\nã¨ã‚Šã‚ãˆãšå‹•ã„ãŸã®ã‚’æ›¸ã„ã¦ã‚‹ã®ã§ã€å¤šåˆ†ãªã‚“ã‹ç„¡é§„ãªã“ã¨ã—ã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<MPD xmlns=\"urn:mpeg:dash:schema:mpd:2011\" maxSegmentDuration=\"PT3S\" minBufferTime=\"PT3S\" type=\"dynamic\" profiles=\"urn:mpeg:dash:profile:isoff-live:2011,http://dashif.org/guidelines/dash-if-simple\">\r\n  <BaseURL>/</BaseURL>\r\n  <Period start=\"PT0S\">\r\n    <AdaptationSet mimeType=\"video/webm\">\r\n      <Role schemeIdUri=\"urn:mpeg:dash:role:2011\" value=\"main\" />\r\n      <SegmentTemplate duration=\"3\" initialization=\"/segment0.webm\" media=\"/segment$Number$.webm\" startNumber=\"1\"/>\r\n      <Representation id=\"default\" codecs=\"vp9\"/>\r\n    </AdaptationSet>\r\n  </Period>\r\n</MPD>\r\n```\r\n\r\n# èµ·å‹•\r\n\r\n`mainé–¢æ•°`ã®å†ç”Ÿãƒœã‚¿ãƒ³ã¿ãŸã„ãªã®ã‚’æŠ¼ã™ã¨èµ·å‹•ã§ãã¾ã™ã€‚  \r\n<span style=\"color:green\">â–¶</span> â†ã“ã‚Œ\r\n\r\n![Imgur](https://imgur.com/lalzp0P.png)\r\n\r\n`http://localhost:8080`ã‚’é–‹ãã€`é…ä¿¡é–‹å§‹`ã‚’æŠ¼ã—ã¾ã™ã€‚é…ä¿¡ã§ã‚‚ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒæµã‚Œã¾ã™ã€‚  \r\næ•°ç§’å¾Œã«ã‚‚ã†ä¸€ã¤ãƒ–ãƒ©ã‚¦ã‚¶ã§`http://localhost:8080`ã‚’é–‹ãã€ä»Šåº¦ã¯`è¦–è´é–‹å§‹`ã‚’æŠ¼ã—ã¾ã™ã€‚ã“ã‚Œã§é…ä¿¡å´ã®æ˜ åƒãŒæµã‚Œã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã‚¹ãƒãƒ›ã§ã‚‚è¦–è´ãªã‚‰å‡ºæ¥ã‚‹ã¯ãšã€‚\r\n\r\n![Imgur](https://imgur.com/dRvd2Rg.png)\r\n\r\n**ã™ã”ã„ï¼ï¼ã‚µãƒ¼ãƒãƒ¼å´ã¯ä»²ä»‹ã—ã‹ã—ã¦ç„¡ã„ã®ã«ãªã‚“ã¡ã‚ƒã£ã¦ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒå®Œæˆã—ã¾ã—ãŸï¼**\r\n\r\n# çœŸé¢ç›®ã«ä½œã‚‹ã«ã¯\r\nå‹•ã„ãŸã“ã¨ã«æº€è¶³ã—ãŸã®ã§ã™ãŒã€ã¾ã ç›´ã—ãŸã»ã†ãŒã„ã„ã¨ã“ã‚ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n- é…ä¿¡ã‚’ã‚„ã‚ã¦å†é…ä¿¡ã™ã‚‹å ´åˆ\r\n    - å†åº¦é…ä¿¡ã™ã‚‹ãŸã‚ã«ã¯ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã‚’æ¶ˆã™ã®ã¨ã€ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’0ã«æˆ»ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n    - ç¾çŠ¶ã¯ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•ã—ãªã„ã¨å†é…ä¿¡ã§ãã¾ã›ã‚“ã€‚\r\n- è¦–è´å´ãŒæœ€åˆã‹ã‚‰å†ç”Ÿã•ã‚Œã¦ã—ã¾ã†ï¼ˆã™ã§ã«ã‚»ã‚°ãƒ¡ãƒ³ãƒˆãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã®ã«ï¼‰\r\n    - ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¦è¦–è´ã‚’å†åº¦å§‹ã‚ã‚‹ã¨æœ€åˆã‹ã‚‰å§‹ã¾ã‚‹\r\n    - $Number$ ã‚’`0`ã‹ã‚‰é–‹å§‹ã—ãªã„ã‚ˆã†ã«ã™ã‚Œã°ã„ã„\r\n    - ãƒãƒ‹ãƒ•ã‚§ã‚¹ãƒˆã§`availabilityStartTime`ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã§ã€é€”ä¸­ã‹ã‚‰è¦–è´ã—ãŸå ´åˆã‚‚æœ€æ–°ã®ãŒå–å¾—ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚\r\n        - `availabilityStartTime`ã¯ãƒ©ã‚¤ãƒ–é…ä¿¡ãŒåˆ©ç”¨å¯èƒ½ã«ãªã‚‹æ™‚é–“ï¼ˆISO 8601ï¼‰\r\n        - `availabilityStartTime=\"2022-09-13T00:00:00+09:00\"`\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<MPD xmlns=\"urn:mpeg:dash:schema:mpd:2011\" availabilityStartTime=\"2022-09-13T00:00:00+09:00\" maxSegmentDuration=\"PT3S\" minBufferTime=\"PT3S\" type=\"dynamic\" profiles=\"urn:mpeg:dash:profile:isoff-live:2011,http://dashif.org/guidelines/dash-if-simple\">\r\n  <BaseURL>/</BaseURL>\r\n  <Period start=\"PT0S\">\r\n    <AdaptationSet mimeType=\"video/webm\">\r\n      <Role schemeIdUri=\"urn:mpeg:dash:role:2011\" value=\"main\" />\r\n      <SegmentTemplate duration=\"3\" initialization=\"/segment0.webm\" media=\"/segment$Number$.webm\" startNumber=\"1\"/>\r\n      <Representation id=\"default\" codecs=\"vp9\"/>\r\n    </AdaptationSet>\r\n  </Period>\r\n</MPD>\r\n```\r\n\r\n# Q&A\r\n\r\n## iOS ã¨ iPad OS ã§å†ç”Ÿã§ãã¾ã™ã‹\r\n\r\n- iPad OS ãªã‚‰å†ç”Ÿã§ãã‚‹ã¨æ€ã„ã¾ã™\r\n- iOS ã¯ `MediaSource Extensions API`ã«å¯¾å¿œã™ã‚Œã°å‹•ãã¨æ€ã„ã¾ã™ã€‚\r\n\r\nè©³ã—ãã¯ [å‰å›ã®è¨˜äº‹](/posts/android_standalone_webm_livestreaming/) ã§\r\n\r\n# å‚è€ƒã«ãªã‚Šã¾ã—ãŸ\r\nåŠ©ã‹ã‚Šã¾ã™ï¼ï¼ï¼\r\n\r\n- https://developer.mozilla.org/en-US/docs/Web/API/MediaStream_Recording_API\r\n- https://www.slideshare.net/mganeko/media-recorder-and-webm\r\n- https://qiita.com/tomoyukilabs/items/57ba8a982ab372611669\r\n\r\n# ãŠã‚ã‚Šã«\r\nãŠç–²ã‚Œæ§˜ã§ã—ãŸã€ï¾‰ï½¼ 888888\r\n\r\n## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™\r\nhttps://github.com/takusan23/BrowserDashMirroring\r\n"},{"title":"JitPackã§Androidãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¬é–‹ã™ã‚‹","link":"/posts/jitpack/","markdown":"\r\nè‡ªåˆ†ç”¨ãƒ¡ãƒ¢ï¼ˆè¨˜äº‹æ›´æ–°ï¼š2021/03/11ï¼‰\r\n\r\n# ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä½œæˆ\r\n## é©å½“ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚\r\nã“ã“ã§ä½œæˆã—ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯Exampleçš„ãªå½¹å‰²ã‚’ã™ã‚‹ã€‚\r\n\r\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½œæˆ\r\nä¸Šã®`File`ã‚’æŠ¼ã—ã¦ã€`New`ã‚’æŠ¼ã—ã¦ã€`New Module...`ã‚’é¸æŠã—ã¦ã€  \r\n`Android Library`ã‚’é¸æŠã—ã¦ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã‚’ã¤ã‘ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/tQF3cW2.png)\r\n\r\n## æœ€åˆã«ä½œã£ãŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\r\n`app`ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚ã‚‹`build.gradle`(`app/build.gradle`)ã‚’é–‹ãã€`dependencies { }`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    // ä½œã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\n    implementation project(':ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå')\r\n}\r\n```\r\n\r\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªåãŒã€`SearchPreferenceFragment`ã ã£ãŸå ´åˆã¯ã€\r\n\r\n```gradle\r\ndependencies {\r\n    // ä½œã£ãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\n    implementation project(':SearchPreferenceFragment')\r\n}\r\n```\r\n\r\nã¨ãªã‚Šã¾ã™ã€‚\r\n\r\n# JitPackã§å…¬é–‹ã™ã‚‹æµã‚Œ\r\n## library/build.gradle\r\n`ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå/build.gradle`ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã®ãƒ•ã‚©ãƒ«ãƒ€ã«æœ‰ã‚‹build.gradleï¼‰ã‚’é–‹ã„ã¦ã€ä¸Šã®éƒ¨åˆ†ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚\r\n\r\n```gradle\r\nplugins {\r\n    id 'com.android.library'\r\n    id 'kotlin-android'\r\n    id 'kotlin-android-extensions'\r\n    // JitPackã§å¿…è¦\r\n    id 'maven-publish'\r\n}\r\n\r\n// ã“ã‚Œã‚‚JitPackã§ä½¿ã†\r\ngroup = 'com.github.takusan23'\r\n```\r\n\r\n`takusan23`ã®éƒ¨åˆ†ã¯å„è‡ªé•ã†ã¨æ€ã†ã€‚\r\n\r\nãã‚Œã‹ã‚‰ã€ä¸€ç•ªä¸‹ã«è¡Œã£ã¦æ•°è¡Œæ›¸ãè¶³ã™å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã€‚\r\n\r\n```kotlin\r\nafterEvaluate {\r\n    publishing {\r\n        publications {\r\n            release(MavenPublication) {\r\n                from components.release\r\n                groupId = 'com.github.takusan23'\r\n                artifactId = 'ComposeOrigamiLayout'\r\n                version = '1.0'\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`groupId`ã¯`group`ã¨åŒã˜ã§ã„ã„ã¨æ€ã†ã€‚  \r\n`artifactId`ã«ã¯GitHubã®ãƒªãƒã‚¸ãƒˆãƒªåã‚’å…¥ã‚Œã¦ã­ã€‚\r\n \r\n## jitpack.yml\r\nã£ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚å ´æ‰€ã¯srcãƒ•ã‚©ãƒ«ãƒ€ã¨ã‹.ideaãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ã¨ã“ã‚ã§ã™ã€‚  \r\nãƒ•ã‚¡ã‚¤ãƒ«åã¯`jitpack.yml`ã§ã€‚  \r\n\r\nä¸­èº«ãªã‚“ã§ã™ã‘ã©ã€Javaã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚ãªã‚“ã‹Java11ãŒå¿…è¦ã«ãªã£ãŸã¿ãŸã„ã€‚\r\n\r\n```yml\r\njdk:\r\n  - openjdk11\r\n```\r\n\r\n# ä»–ã®äººã«ä½¿ã£ã¦ã‚‚ã‚‰ã†\r\n## build.gradle\r\nappãƒ•ã‚©ãƒ«ãƒ€ã§ã‚‚ãªã„ã€ãƒ©ã‚¤ãƒ–ãƒ©ãƒªåã®ã¤ã„ãŸãƒ•ã‚©ãƒ«ãƒ€ã§ã‚‚ãªã„ã€`build.gradle`ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ›¸ãè¶³ã—ã¾ã™\r\n\r\n```gradle\r\nallprojects {\r\n    repositories {\r\n        google()\r\n        jcenter()\r\n        maven { url 'https://jitpack.io' }\r\n    }\r\n}\r\n```\r\n\r\n`allprojects{ repositories{ } }`ãŒãªã„å ´åˆã¯ã€`settings.gradle`ã‚’é–‹ã„ã¦ã“ã†ã§ã™ã€‚  \r\n\r\n```gradle\r\ndependencyResolutionManagement {\r\n    repositoriesMode.set(RepositoriesMode.FAIL_ON_PROJECT_REPOS)\r\n    repositories {\r\n        google()\r\n        mavenCentral()\r\n        jcenter() // Warning: this repository is going to shut down soon\r\n        maven { url 'https://jitpack.io' } // ã“ã‚Œ\r\n    }\r\n}\r\n```\r\n\r\n## app/build.gradle\r\nã‚’é–‹ãã€`dependencies{ }`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    // æ¤œç´¢ã§ãã‚‹Preference\r\n    implementation 'com.github.takusan23:SearchPreferenceFragment:1.0.0'\r\n}\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚"},{"title":"Kotlin Coroutines ã® Flow ã§ collect ã—ãŸã‚‰åˆ¥ã® Flow ã‚’ collect ã—ãŸã„","link":"/posts/kotlin_coroutines_flow_latest/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\niPhone 15 ã®ç™ºè¡¨ä¼šãŒã‚ã£ãŸãã†ã§ã™ãŒæ™®é€šã«å¯ã¦ã¾ã—ãŸã€  \r\nã¿ã‚“ãª`USB Type-C`ã‚„ã‚‰`ãƒŸãƒªæ³¢ã‚¢ãƒ³ãƒ†ãƒŠéæ­è¼‰`ã°ã£ã‹ç›®ãŒè¡Œã£ã¦ã‚‹ã‘ã©ã€`Pro`ã®æ–¹ã ã¨`AV1ã®ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼`ãŒå…¥ã£ã¦ã‚‹ã‚‰ã—ã„ã˜ã‚ƒã‚“ï¼ï¼  \r\nã¾ã`AV1 ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯`ä½¿ã†æ©Ÿä¼šãŒæ¥ã‚‹ã®ã‹ã¯ã¾ãŸ...  \r\n\r\n# æœ¬é¡Œ\r\n`flow`ã§`collect`ã—ãŸå€¤ã‚’å…ƒã«ã€åˆ¥ã®`flow`ã‚’`collect`ã—ãŸã„ã€‚  \r\n\r\né©å½“ã«ä¾‹ã‚’æ›¸ã„ãŸã‘ã©ã€ã“ã‚“ãªæ„Ÿã˜ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è¿”ã™`Flow`ã®å€¤ã‚’ä½¿ã£ã¦ã€ä¸‹ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è¿”ã™`Flow`ã‚’åé›†ã—ãŸã„ã€‚\r\n\r\n```kotlin\r\nsuspend fun collectValue() {\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’ Flow ã§è¿”ã™\r\n    val userFlow: Flow<List<User>> = getRealtimeUserIdList()\r\n\r\n    // â†‘ã® flow ãŒæ–°ã—ã„å€¤ã§ç™ºè¡Œã•ã‚ŒãŸã‚‰ â†“ ã® flow ã«æ¸¡ã—ã¦ã€flow ã‚’è³¼èª­ã—ãŸã„ã€‚\r\n    // â†‘ã® flow ã‹ã‚‰æ–°ã—ã„å€¤ãŒæ¥ãŸã‚‰ã€æ—¢ã«å‹•ã„ã¦ã„ã‚‹ â†“ ã® flow ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã€ä½œã‚Šç›´ã—ã¦æ¬²ã—ã„\r\n\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æ¸¡ã™ã¨ã‚³ãƒ¡ãƒ³ãƒˆãŒ Flow ã§è¿”ã•ã‚Œã‚‹\r\n    val commentFlow: Flow<List<Message>> = getRealtimeUserComment(user = /* TODO */)\r\n}\r\n```\r\n\r\n# è§£æ±º\r\n\r\nhttps://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map-latest.html\r\n\r\n`mapLatest` ã‹ `collectLatest` ã‚’ä½¿ãˆã°è§£æ±º  \r\nå‰å›ã®åé›†ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã€å¸¸ã«æœ€æ–°ã®å€¤ã§åˆ¥ã®`Flow`ã‚’`collect`ã§ãã‚‹\r\n\r\n```kotlin\r\ngetRealtimeUserIdList()\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’è²°ã£ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆå–å¾— flow ã‚’ãã‚Œãã‚Œå‘¼ã³å‡ºã™\r\n    // Latest ã‚’ä½¿ã†ã¨ã€ä¸€å€‹å‰ã«å‘¼ã°ã‚ŒãŸã“ã®â†“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹\r\n    .collectLatest { userIdList ->\r\n        println(\"receive new user list\")\r\n        userIdList\r\n            // flow ã‚’ä½œã‚‹\r\n            .map { user -> getRealtimeUserComment(user) }\r\n            // è¤‡æ•°ã® flow ãªã®ã§ï¼ˆList<Flow>ï¼‰ã€ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹ï¼ˆå‹ãŒåŒã˜ãªã®ã§å•é¡Œãªã„ï¼‰\r\n            .merge()\r\n            // â†‘ã® Flow ã®åé›†ã‚’å§‹ã‚ã‚‹\r\n            // å…ˆè¿°ã®é€šã‚Šã€æ–°ã—ã„å€¤ï¼ˆã“ã®å ´åˆ getRealtimeUserIdList() ã‹ã‚‰æ–°ã—ã„å€¤ãŒæµã‚Œã¦ããŸå ´åˆï¼‰\r\n            // ã“ã“ã®åé›†ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€æ–°ã—ã„å€¤ã§å†åº¦å®Ÿè¡Œã•ã‚Œã‚‹\r\n            .collect {\r\n                println(it)\r\n            }\r\n    }\r\n```\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ã€`getRealtimeUserIdList()`ãŒæ–°ã—ã„å€¤ã‚’ç™ºè¡Œã—ãŸã‚‰ã€æ—¢ã«å‹•ã„ã¦ã„ã‚‹`getRealtimeUserComment()`ã®æ–¹ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€æ–°ã—ã`getRealtimeUserComment()`ã‚’ä½œã‚Šè³¼èª­ã™ã‚‹ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ï¼ã“ã‚ŒãŒã‚„ã‚ŠãŸã‹ã£ãŸã‚“ã ã‚ˆãªï½\r\n\r\n```plaintext\r\nreceive new user list\r\nMessage(user=User(id=0), message=[ã†ã£ã•, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, å»¶é•·ã—ã‚])\r\nMessage(user=User(id=1), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ã“ã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=0), message=[ã‚ã“ã¤, ã‚ã“ã¤, ã‚ã“ã¤, å»¶é•·ã—ã‚])\r\nMessage(user=User(id=1), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ã“ã¤, å»¶é•·ã—ã‚, å»¶é•·ã—ã‚])\r\nMessage(user=User(id=0), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, å»¶é•·ã—ã‚, å»¶é•·ã—ã‚, å»¶é•·ã—ã‚])\r\nMessage(user=User(id=1), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ã“ã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤])\r\nMessage(user=User(id=0), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ãŠã¤, ã‚ã“ã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=1), message=[ãŠã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ã“ã¤, ã†ã£ã•])\r\nreceive new user list\r\nMessage(user=User(id=2), message=[ã‚ã“ã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã†ã£ã•, ãŠã¤])\r\nMessage(user=User(id=3), message=[ã‚ã“ã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, å»¶é•·ã—ã‚, ã†ã£ã•])\r\nMessage(user=User(id=2), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã†ã£ã•, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ãŠã¤])\r\n```\r\n\r\n## transformLatest\r\nhttps://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/transform-latest.html\r\n\r\nã¾ãŸã€`Android`ã®`Jetpack Compose`ã¨ã‹ã§ä½¿ã„ãŸã„å ´åˆã¯ã€`Flow#collectAsState`ã—ãŸã„ã¨æ€ã†ã®ã§ã€  \r\nãã®å ´åˆã¯`collectLatest`ã§ã¯ãªãã€å¤‰æ›ã—ãŸ`Flow`ã‚’è¿”ã™`transformLatest`ã‚’é¸ã°ãªã„ã¨ãƒ€ãƒ¡ã§ã™ã­ã€‚  \r\n\r\n```kotlin\r\nval commentFlow: Flow<Message> = getRealtimeUserIdList()\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’è²°ã£ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆå–å¾— flow ã‚’ãã‚Œãã‚Œå‘¼ã³å‡ºã™\r\n    // Latest ã‚’ä½¿ã†ã¨ã€ä¸€å€‹å‰ã«å‘¼ã°ã‚ŒãŸã“ã®â†“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹\r\n    .transformLatest { userIdList ->\r\n        println(\"receive new user list\")\r\n        userIdList\r\n            // flow ã‚’ä½œã‚‹\r\n            .map { user -> getRealtimeUserComment(user) }\r\n            // è¤‡æ•°ã® flow ãªã®ã§ï¼ˆList<Flow>ï¼‰ã€ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹ï¼ˆå‹ãŒåŒã˜ãªã®ã§å•é¡Œãªã„ï¼‰\r\n            .merge()\r\n            // â†‘ã® Flow ã®åé›†ã‚’å§‹ã‚ã‚‹\r\n            // å…ˆè¿°ã®é€šã‚Šã€æ–°ã—ã„å€¤ï¼ˆã“ã®å ´åˆ getRealtimeUserIdList() ã‹ã‚‰æ–°ã—ã„å€¤ãŒæµã‚Œã¦ããŸå ´åˆï¼‰\r\n            // ã“ã“ã®åé›†ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã€æ–°ã—ã„å€¤ã§å†åº¦å®Ÿè¡Œã•ã‚Œã‚‹\r\n            .collect {\r\n                // åé›†ã—ãŸå€¤ã‚’ã€Flow ã®è¿”ã‚Šå€¤ã¨ã—ã¦ä½¿ã†\r\n                emit(it)\r\n            }\r\n    }\r\n```\r\n\r\n```\r\n// collect ã™ã‚‹ã‚‚ã‚ˆã—\r\ncommentFlow.collect {\r\n    println(it)\r\n}\r\n\r\n// Jetpack Compose ã® State ã¨ã—ã¦ä½¿ã†ã®ã‚‚ã‚ˆã—\r\ncommentFlow.collectAsState()\r\n```\r\n\r\nã»ã‹ã«ã‚‚ã€`List<User>`ã¿ãŸã„ã«é…åˆ—ã§æ¬²ã—ã„ï¼ˆ`Flow`ã®è¿”ã‚Šå€¤ã‚’`Flow<Message>`ã§ã¯ãªãã€`Flow<List<Message?>>`ã«ã—ãŸã„ï¼‰å ´åˆã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™ã‹ã­  \r\nã†ãƒ¼ãƒ¼ã‚“ã‚ã‚“ã¾ã‚Šãã‚Œã„ã«æ›¸ã‘ãªã‹ã£ãŸ...\r\n\r\n```kotlin\r\nval commentFlow: Flow<List<Message?>> = getRealtimeUserIdList()\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§ã‚’è²°ã£ãŸã‚‰ã€ã‚³ãƒ¡ãƒ³ãƒˆå–å¾— flow ã‚’ãã‚Œãã‚Œå‘¼ã³å‡ºã™\r\n    // Latest ã‚’ä½¿ã†ã¨ã€ä¸€å€‹å‰ã«å‘¼ã°ã‚ŒãŸã“ã®â†“ã®ãƒ–ãƒ­ãƒƒã‚¯ã¯ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã•ã‚Œã‚‹\r\n    .transformLatest { userIdList ->\r\n        println(\"receive new user list\")\r\n        // å…¥ã‚Œã¦ãŠãé…åˆ—\r\n        val commentArray = Array<Message?>(userIdList.size) { null }\r\n        userIdList\r\n            // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ•°ã ã‘ flow ã‚’ä½œã£ã¦\r\n            // onEach ã§å€¤ã‚’å—ã‘å–ã£ãŸéš›ã«ã€array ã«å…¥ã‚Œã‚‹ã‚ˆã†ã«ã™ã‚‹ã€ãã®å¾Œå€¤ã‚’ transformLatest ã¸è¿”ã—ã¦ã‚ã’ã‚‹ã¨ã€flow ã®è¿”ã‚Šå€¤ã«ãªã‚‹\r\n            .mapIndexed { index, user ->\r\n                getRealtimeUserComment(user)\r\n                    .onEach {\r\n                        commentArray[index] = it\r\n                        emit(commentArray.toList())\r\n                    }\r\n            }\r\n            // è¤‡æ•°ä»¶ã‚ã‚‹ã®ã§ãƒãƒ¼ã‚¸ã™ã‚‹\r\n            .merge()\r\n            // åé›†ã™ã‚‹\r\n            .collect()\r\n    }\r\n```\r\n\r\n```plaintext\r\nreceive new user list\r\n[Message(user=User(id=0), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, å»¶é•·ã—ã‚, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘]), null]\r\n[Message(user=User(id=0), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, å»¶é•·ã—ã‚, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘]), Message(user=User(id=1), message=[å»¶é•·ã—ã‚, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ãŠã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸])]\r\n[Message(user=User(id=0), message=[ã†ã£ã•, å»¶é•·ã—ã‚, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, å»¶é•·ã—ã‚]), Message(user=User(id=1), message=[å»¶é•·ã—ã‚, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ãŠã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸])]\r\n[Message(user=User(id=0), message=[ã†ã£ã•, å»¶é•·ã—ã‚, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, å»¶é•·ã—ã‚]), Message(user=User(id=1), message=[å»¶é•·ã—ã‚, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã†ã£ã•])]\r\n[Message(user=User(id=0), message=[ãŠã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤, ã†ã£ã•]), Message(user=User(id=1), message=[å»¶é•·ã—ã‚, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã†ã£ã•])]\r\n[Message(user=User(id=0), message=[ãŠã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤, ã†ã£ã•]), Message(user=User(id=1), message=[ã‚ã“ã¤, ã†ã£ã•, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤])]\r\n[Message(user=User(id=0), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤, ã†ã£ã•, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸]), Message(user=User(id=1), message=[ã‚ã“ã¤, ã†ã£ã•, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤])]\r\n[Message(user=User(id=0), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤, ã†ã£ã•, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸]), Message(user=User(id=1), message=[ã‚ã“ã¤, ãŠã¤, ã‚ã“ã¤, å»¶é•·ã—ã‚])]\r\nreceive new user list\r\n[Message(user=User(id=2), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, å»¶é•·ã—ã‚, ãŠã¤, ã†ã£ã•]), null]\r\n[Message(user=User(id=2), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, å»¶é•·ã—ã‚, ãŠã¤, ã†ã£ã•]), Message(user=User(id=3), message=[ã‚ã“ã¤, å»¶é•·ã—ã‚, å»¶é•·ã—ã‚, ã‚ã“ã¤])]\r\n```\r\n\r\n# ã¡ãªã¿ã«\r\n`Flow<List<User>>`ã§ã¯ãªãã€`Flow<User>`ã¿ãŸã„ã«ã€é…åˆ—ã§ã¯ãªã„å ´åˆã¯ã‚‚ã£ã¨ç°¡å˜ã«ã‹ã‘ã¾ã™ã€‚  \r\nã¾ãè¤‡æ•°ã‚ã£ãŸã¨ã—ã¦ã‚‚`Flow#merge`ã§ï¼‘ã¤ã®`Flow`ã«ã—ã¦ã—ã¾ãˆã°ãŠã£ã‘ãƒ¼ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```kotlin\r\n\r\nfun getRealtimeOneUserId(): Flow<User> = flow {\r\n    var index = 0\r\n    while (currentCoroutineContext().isActive) {\r\n        // ã„ã„æ„Ÿã˜ã®ãƒ€ã‚¤ãƒŠãƒ¢æ„Ÿè¦š\r\n        delay(5_000)\r\n        emit(User(index++))\r\n    }\r\n}\r\n\r\nval commentList: Flow<Message> = getRealtimeOneUserId()\r\n    .transformLatest { user ->\r\n        println(\"receive new user\")\r\n        getRealtimeUserComment(user)\r\n            .collect { message -> emit(message) }\r\n    }\r\ncommentList.collect { println(it) }\r\n```\r\n\r\n```plaintext\r\nreceive new user\r\nMessage(user=User(id=0), message=[å»¶é•·ã—ã‚, ã†ã£ã•, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ã“ã¤])\r\nMessage(user=User(id=0), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, å»¶é•·ã—ã‚, ãŠã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=0), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤, ã‚ã“ã¤, ãŠã¤])\r\nMessage(user=User(id=0), message=[ã‚ã“ã¤, å»¶é•·ã—ã‚, ã†ã£ã•, å»¶é•·ã—ã‚])\r\nreceive new user\r\nMessage(user=User(id=1), message=[ãŠã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ãŠã¤, ã†ã£ã•])\r\nMessage(user=User(id=1), message=[ã‚ã“ã¤, å»¶é•·ã—ã‚, å»¶é•·ã—ã‚, ãŠã¤])\r\n```\r\n\r\n## ã¡ãªã¿2\r\n`println(\"receive new user\")`ã‚„`println(\"receive new user list\")`ã¯åˆ†ã‹ã‚Šã‚„ã™ãã—ã¦ã„ã‚‹ã ã‘ãªã®ã§ã€ãªãã¦ã‚‚å‹•ãï¼ˆå½“ãŸã‚Šå‰ï¼‰\r\n\r\n# ã‚‚ã£ã¨è©³ã—ãè©±ã›\r\n\r\nã¾ãšå‰æã«ãªã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™  \r\né©å½“ã«ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¦ã€ãã‚Œãã‚Œå®šæœŸçš„ã«é©å½“ã«`Flow`ã‚’ç”¨æ„ã—ã¾ã—ãŸã€\r\n\r\n```kotlin\r\ndata class User(val id: Int)\r\ndata class Message(val user: User, val message: List<String>)\r\n\r\nfun getRealtimeUserIdList(): Flow<List<User>> = flow {\r\n    var index = 0\r\n    while (currentCoroutineContext().isActive) {\r\n        // ã„ã„æ„Ÿã˜ã®ãƒ€ã‚¤ãƒŠãƒ¢æ„Ÿè¦š\r\n        delay(5_000)\r\n        // é©å½“ãªæ•°ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ç”¨æ„ã—ã¦è¿”ã™\r\n        val randomUserList = (0 until 2).map { User(index++) }\r\n        emit(randomUserList)\r\n    }\r\n}\r\n\r\nfun getRealtimeUserComment(user: User): Flow<Message> = flow {\r\n    val commentList = listOf(\"ã‚ã“ã¤\", \"ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸\", \"å»¶é•·ã—ã‚\", \"ã†ã£ã•\", \"ãŠã¤\", \"ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘\")\r\n    while (currentCoroutineContext().isActive) {\r\n        delay(1_000)\r\n        // é©å½“ã«3ä»¶é¸ã‚“ã§è¿”ã™\r\n        val randomCommentList = (0..3).map { commentList.random() }\r\n        emit(\r\n            Message(\r\n                user = user,\r\n                message = randomCommentList\r\n            )\r\n        )\r\n    }\r\n}\r\n```\r\n\r\nãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’è³¼èª­ã—ã¦ï½ã‚³ãƒ¡ãƒ³ãƒˆã‚’è³¼èª­ã™ã‚‹ã¨ã™ã‚‹ã¨ã¾ãšã“ã†\r\n\r\n```kotlin\r\ngetRealtimeUserIdList().collect { userIdList ->\r\n    println(\"receive new user list\")\r\n\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ•°ã ã‘ flow ã‚’è³¼èª­\r\n    userIdList.map { user ->\r\n        // collect { } ã ã¨ collect ä¸­ã¯ä¸€æ™‚åœæ­¢ã«ãªã‚‹\r\n        // ã®ã§ã€onEach ã¨ launchIn ã«ã—ãŸ\r\n        getRealtimeUserComment(user).onEach { message ->\r\n            println(message)\r\n        }.launchIn(this)\r\n    }\r\n}\r\n```\r\n\r\nã—ã‹ã—ã€ã“ã‚Œã ã¨ã€`Flow`ã®æ›´æ–°ã®ãŸã³ã«`getRealtimeUserComment()`ã‚’å‘¼ã³å‡ºã—ã¦ã„ã¾ã™ã€‚  \r\n\r\n```plaintext\r\nreceive new user list\r\nMessage(user=User(id=8), message=[\r\nMessage(user=User(id=9), message=[\r\nMessage(user=User(id=6), message=[\r\nMessage(user=User(id=7), message=[\r\nMessage(user=User(id=4), message=[\r\nMessage(user=User(id=5), message=[\r\nMessage(user=User(id=2), message=[\r\nMessage(user=User(id=3), message=[\r\nMessage(user=User(id=0), message=[\r\nMessage(user=User(id=1), message=[\r\n```\r\n\r\nã“ã‚ŒãŒæœŸå¾…å€¤ã®å ´åˆã‚‚ã‚ã‚Šã¾ã™ãŒã€ä»Šå›ã¯å€¤ã‚’å—ã‘å–ã£ãŸã‚‰æ—¢ã«å‹•ã„ã¦ã„ã‚‹`flow`ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ã»ã—ã„  \r\nã¨æ€ã£ãŸæ™‚ã«æ›¸ãã‚„ã¤\r\n\r\n```kotlin\r\nval commentScope = CoroutineScope(Dispatchers.Default)\r\n\r\ngetRealtimeUserIdList().collect { userIdList ->\r\n    println(\"receive new user list\")\r\n    // æ–°ã—ã„å€¤ãŒæ¥ãŸã®ã§æ—¢ã«å‹•ã„ã¦ã‚‹ã‚„ã¤ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«\r\n    commentScope.coroutineContext.cancelChildren()\r\n\r\n    // ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æ•°ã ã‘ flow ã‚’è³¼èª­\r\n    userIdList.map { user ->\r\n        // collect { } ã ã¨ collect ä¸­ã¯ä¸€æ™‚åœæ­¢ã«ãªã‚‹\r\n        // ã®ã§ã€onEach ã¨ launchIn ã«ã—ãŸ\r\n        getRealtimeUserComment(user).onEach { message ->\r\n            println(message)\r\n        }.launchIn(commentScope)\r\n    }\r\n}\r\n```\r\n\r\nåˆ¥ã®ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚¹ã‚³ãƒ¼ãƒ—ã‚’ä½œã£ã¦ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ç”¨ã¨ã‚³ãƒ¡ãƒ³ãƒˆç”¨ã§åˆ†ã‘ã¦ã€ã‚³ãƒ¡ãƒ³ãƒˆç”¨ã¯æ›´æ–°ã®ãŸã³ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã™ã‚‹ã€‚  \r\nãŸã—ã‹ã«ã“ã‚Œã§ã‚‚å‹•ãã®ã§ã™ãŒã€ã€ã€ã‚‚ã£ã¨ãªã‚“ã‹ã„ã„æ–¹æ³•ãŒã‚ã‚‹ã¯ãšï¼\r\n\r\n```plaintext\r\nreceive new user list\r\nMessage(user=User(id=1), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, å»¶é•·ã—ã‚, ã†ã£ã•, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=0), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ã“ã¤, ã‚ã“ã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=0), message=[ãŠã¤, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ã“ã¤, å»¶é•·ã—ã‚])\r\nMessage(user=User(id=1), message=[å»¶é•·ã—ã‚, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ãŠã¤])\r\nMessage(user=User(id=0), message=[ã†ã£ã•, ãŠã¤, ã‚ã“ã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=1), message=[å»¶é•·ã—ã‚, ã‚ã“ã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘])\r\nMessage(user=User(id=0), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ã‚ã“ã¤, ã‚ã“ã¤, ã†ã£ã•])\r\nMessage(user=User(id=1), message=[ã†ã£ã•, ã†ã£ã•, å»¶é•·ã—ã‚, å»¶é•·ã—ã‚])\r\nreceive new user list\r\nMessage(user=User(id=2), message=[ãŠã¤, ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã†ã£ã•, ã‚ã“ã¤])\r\nMessage(user=User(id=3), message=[ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸, ãŠã¤, å»¶é•·ã—ã‚, ãŠã¤])\r\nMessage(user=User(id=2), message=[ã‚ ã§ã‚‚ ã„ ã§ã‚‚è‰¯ã„ã‹ã‚‰æ›¸ã‘, ã‚ã“ã¤, å»¶é•·ã—ã‚, ãƒŸãƒ¥ãƒ¼ãƒˆèŠ¸])\r\n```\r\n\r\nã¨ã„ã†ã‚ã‘ã§`collectLatest`/`mapLatest`/`transformLatest`ã®ç™»å ´ã€‚  \r\nå‰å›ã®ãƒ–ãƒ­ãƒƒã‚¯ã‚’ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦ãã‚Œã¾ã™ã€‚ä»¥ä¸Šã§ã™ã€‚\r\n\r\n# ã¤ã¾ã‚Š...\r\n\r\nhttps://kotlinlang.org/api/kotlinx.coroutines/kotlinx-coroutines-core/kotlinx.coroutines.flow/map-latest.html\r\n\r\n`collect { }`ã®ä¸­ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ä½¿ã„ãŸã„æ™‚ï¼ˆ`collect { }`ã—ãŸã„ç­‰ï¼‰ã¨ãã¯ã€`collectLatest { }`ã‚’è¦ªã«ã™ã‚‹ï¼Ÿã¨æ¬¡ã®å€¤ãŒæ¥ãŸæ™‚ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã—ã¦å†èµ·å‹•ã—ã¦ãã‚Œã‚‹ã€‚  \r\n\r\n# ã‚³ãƒ¼ãƒ‰ãŠã„ã¦ã„ãã¾ã™\r\n\r\nhttps://github.com/takusan23/FlowLatest\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\n`Latest`ç³»ã®ã‚ªãƒšãƒ¬ãƒ¼ã‚¿ãƒ¼ã¯ãªãœã‹`@OptIn`ã—ãªã„ã¨`Lint`ã§æ€’ã‚‰ã‚Œã¾ã™...  \r\næ—©ãå®‰å®šã«ãªã£ã¦æ¬²ã—ã„\r\n\r\n![Imgur](https://imgur.com/PQgRznT.png)"},{"title":"Kotlin/JSã§ã‚µã‚¤ãƒˆã‚’ä½œã£ã¦å…¬é–‹ã™ã‚‹","link":"/posts/kotlin_js_hosting/","markdown":"\r\nå¤œå‹¤æ˜ã‘ ~~(ã®ãªã‚“ã§ã‚‚å‡ºæ¥ãã†ãªæ°—åˆ†ã®ä¸­)~~ `Kotlin/JS`ã‚’åˆã‚ã¦è§¦ã£ãŸã‚‰é¢ç™½ã‹ã£ãŸã®ã§è¨˜äº‹ã«ã™ã‚‹ã€‚  \r\n\r\n# æœ¬é¡Œ\r\næ®‹ã‚Šã®æ—¥æ•°ã‚’æ•°ãˆã‚‹Webã‚µã‚¤ãƒˆã‚’`Kotlin/JS`ã§ä½œã‚Šã¾ã™ã€‚  \r\nã“ã‚Œãªã‚‰ç°¡å˜ã«ä½œã‚Œãã†ã€‚\r\n\r\n# Kotlin/JS #ã¨ã¯\r\nKotlinã‚³ãƒ¼ãƒ‰ã‚’JSã«ãƒˆãƒ©ãƒ³ã‚¹ãƒ‘ã‚¤ãƒ«ã™ã‚‹ã€‚  \r\nJSã¿ãŸã„ã«DOMæ“ä½œã¨ã‹ã‚‚å‡ºæ¥ã‚‹ã€‚\r\n\r\n# IDEAã‚’é–‹ãæ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™\r\n\r\n`Gradle`ã‚’æŠ¼ã—ã¦ã€`Kotlin DSL build script`ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã€`Kotlin/JS for browser`ã‚’é¸æŠã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/mjYwnR1.png)\r\n\r\nåå‰ã¨ã‹ã¯é©å½“ã«å…¥ã‚Œã¦ãã ã•ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/hg9WgLW.png)\r\n\r\nç”Ÿæˆå¾Œã—ã°ã‚‰ãå¾…ã¡ã¾ã™ã€‚\r\n\r\n# èµ·å‹•ã™ã‚‹\r\n\r\nIDEAå³ä¸‹ã®`Terminal`ã‚’ãŠã—ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```\r\n./gradlew run --continuous\r\n```\r\n\r\nã“ã‚Œã¯ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ä»˜ãã§é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚å‹æ‰‹ã«ãƒ–ãƒ©ã‚¦ã‚¶ãŒèµ·å‹•ã™ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\nåˆå›èµ·å‹•æ™‚ã¯ã€ãƒ•ã‚¡ã‚¤ã‚¢ã‚¦ã‚©ãƒ¼ãƒ«ãŒè¨±å¯ã™ã‚‹ã‹èã„ã¦ãã‚‹ã®ã§è¨±å¯ã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚\r\n\r\nç„¡äº‹ãƒ–ãƒ©ã‚¦ã‚¶ã«`Hello World`ãŒå‡ºã¦ã‚Œã°æˆåŠŸã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/EihsdkV.png)\r\n\r\n# index.html ã‚’æ›¸ãæ›ãˆã‚‹\r\n\r\n`src/main/resources/index.html`ãŒ`index.html`ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\n## `script`ã‚¿ã‚°ã‚’ç§»å‹•\r\n`<script>ã‚¿ã‚°`ã‚’`<body>`ã‚¿ã‚°ã®ä¸‹ã«ç§»å‹•ã•ã›ã¾ã™ã€‚  \r\nã“ã‚Œã‚’ã—ãªã„ã¨å¤šåˆ†`DOMæ“ä½œæ™‚ã«ã¬ã‚‹ã½åãã¾ã™ã€‚`\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"en\">\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <title>CountdownKotlinJS</title>\r\n</head>\r\n<body>\r\n\r\n</body>\r\n\r\n<script src=\"CountdownKotlinJS.js\"></script>\r\n\r\n</html>\r\n```\r\n\r\n## é©å½“ã«UIã‚’ä½œã‚‹\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <title>CountdownKotlinJS</title>\r\n</head>\r\n\r\n<style>\r\n    .title {\r\n        font-size: 30px;\r\n    }\r\n\r\n    .subtitle {\r\n        font-size: 20px;\r\n    }\r\n\r\n    .card {\r\n        width: 50%;\r\n        margin-left: auto;\r\n        margin-right: auto;\r\n        margin-bottom: 10px;\r\n        border-radius: 5px;\r\n        padding: 10px;\r\n        box-shadow: 0 2px 5px #ccc;\r\n    }\r\n\r\n    .divider {\r\n        border-top: 1px solid #ccc\r\n    }\r\n</style>\r\n\r\n<body>\r\n\r\n    <div class=\"card\">\r\n        <p class=\"title\">ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³</p>\r\n        <div class=\"divider\"></div>\r\n        <p class=\"subtitle\">æ—¥ä»˜ã®é¸æŠ</p>\r\n        <p align=\"center\">\r\n            <input type=\"date\" id=\"date_input\">\r\n            <input type=\"button\" id=\"calc_button\" value=\"æ®‹ã‚Šæ—¥æ•°è¨ˆç®—\">\r\n        </p>\r\n        <div class=\"divider\"></div>\r\n        <p class=\"subtitle\">æ®‹ã‚Š</p>\r\n        <p align=\"center\" class=\"title\" id=\"countdown_text\"></p>\r\n    </div>\r\n</body>\r\n\r\n<script src=\"CountdownKotlinJS.js\"></script>\r\n\r\n</html>\r\n```\r\n\r\n# Kotlin\r\n\r\nã¨ã‚Šã‚ãˆãšæ—¥ä»˜ã‚’å–å¾—ã™ã‚‹ã¾ã§\r\n\r\n```kotlin\r\nimport kotlinx.browser.document\r\nimport kotlinx.browser.window\r\nimport org.w3c.dom.HTMLInputElement\r\n\r\nfun main() {\r\n\r\n    // æ®‹ã‚Šæ—¥æ•°è¡¨ç¤ºè¦ç´ \r\n    val countdownTextElement = document.getElementById(\"countdown_text\")!!\r\n    // ãƒœã‚¿ãƒ³\r\n    val calcButton = document.getElementById(\"calc_button\")!!\r\n    // æ—¥ä»˜å…¥åŠ›è¦ç´ \r\n    val dateInputElement = document.getElementById(\"date_input\")!! as HTMLInputElement\r\n\r\n    // ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ã\r\n    calcButton.addEventListener(\"click\", {\r\n        // æ—¥ä»˜å–å¾—\r\n        val dateString = dateInputElement.value\r\n        window.alert(dateString)\r\n    })\r\n}\r\n```\r\n\r\næ—¥ä»˜ã‚’å…¥ã‚Œã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã‚‰ã‚¢ãƒ©ãƒ¼ãƒˆãŒå‡ºã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/GckVewI.png)\r\n\r\n## æ—¥ä»˜è¨ˆç®—ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\nåˆ¥ã«JSæ¨™æº–ã®`Date`ã‚’ä½¿ã†ã£ã¦æ‰‹ã‚‚ã‚ã‚‹ã€‚\r\n\r\nä»Šå›ã¯`dayjs`ã‚’å…¥ã‚Œã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\n`Kotlin/JS`ã§ã‚‚`npm`ã‹ã‚‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n`build.gradle.kts`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚  \r\næ—¥ä»˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¨ã„ãˆã°`moment.js`ã§ã™ãŒã€ä»Šå›ã¯`dayjs`ã‚’ä½¿ã„ã¾ã™ã€‚è»½ã„ã‚‰ã—ã„ï¼Ÿ\r\n\r\n```gradle\r\nplugins {\r\n    id(\"org.jetbrains.kotlin.js\") version \"1.5.10\"\r\n}\r\n\r\ngroup = \"io.github.takusan23\"\r\nversion = \"1.0.0\"\r\n\r\nrepositories {\r\n    mavenCentral()\r\n}\r\n\r\ndependencies {\r\n    implementation(kotlin(\"stdlib-js\"))\r\n\r\n    // æ—¥ä»˜è¨ˆç®—\r\n    implementation(npm(\"dayjs\", \"1.10.6\"))\r\n\r\n}\r\n```\r\n\r\n## JSã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’Kotlinã§ä½¿ã†\r\n`JS`ã¯å‹•çš„ã«å‹ã‚’ã¤ã‘ã¾ã™ãŒã€`Kotlin`ã§ã¯é™çš„ã«å‹ã‚’ã¤ã‘ã¾ã™ã€‚  \r\næ™®é€šã«è€ƒãˆã‚‹ã¨JSãƒ©ã‚¤ãƒ–ãƒ©ãƒªãŒä½¿ãˆãªã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€`Kotlin/JS`ã«ã¯`dynamic`å‹ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚\r\n\r\nã“ã‚Œã‚’ä½¿ã†ã¨`JS`ã¿ãŸã„ã«æ›¸ãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚ãªãŠã“ã‚Œã‚’ä½¿ã†ã¨`Kotlin`ã®`Nullå®‰å…¨`ç­‰ã®æ©æµãŒå—ã‘ã‚Œãªããªã‚‹ã®ã§`Kotlinã§æ›¸ãæ„å‘³ãƒ»ãƒ»ãƒ»ï¼Ÿ`\r\n\r\n```kotlin\r\n/** dayjsèª­ã¿è¾¼ã¿ */\r\n@JsModule(\"dayjs\")\r\n@JsNonModule\r\nexternal fun dayjs(): dynamic\r\n```\r\n\r\n## æ®‹ã‚Šæ—¥æ•°è¨ˆç®—\r\n\r\nã‚’å«ã‚ãŸå®Œå…¨ç‰ˆã§ã™ã€‚\r\n\r\n```kotlin\r\nimport kotlinx.browser.document\r\nimport org.w3c.dom.HTMLInputElement\r\n\r\n/** dayjsï¼ˆã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã‚ã‚Šï¼‰èª­ã¿è¾¼ã¿ */\r\n@JsModule(\"dayjs\")\r\n@JsNonModule\r\nexternal fun dayjs(d: dynamic): dynamic\r\n\r\n/** dayjsèª­ã¿è¾¼ã¿ */\r\n@JsModule(\"dayjs\")\r\n@JsNonModule\r\nexternal fun dayjs(): dynamic\r\n\r\nfun main() {\r\n\r\n    // æ®‹ã‚Šæ—¥æ•°è¡¨ç¤ºè¦ç´ \r\n    val countdownTextElement = document.getElementById(\"countdown_text\")!!\r\n    // ãƒœã‚¿ãƒ³\r\n    val calcButton = document.getElementById(\"calc_button\")!!\r\n    // æ—¥ä»˜å…¥åŠ›è¦ç´ \r\n    val dateInputElement = document.getElementById(\"date_input\")!! as HTMLInputElement\r\n\r\n    // ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ã\r\n    calcButton.addEventListener(\"click\", {\r\n        // æ—¥ä»˜å–å¾—\r\n        val dateString = dateInputElement.value\r\n        val countdown = dayjs(dateString).diff(dayjs(), \"day\") as Int\r\n        countdownTextElement.textContent = \"æ®‹ã‚Š $countdown æ—¥\"\r\n    })\r\n}\r\n```\r\n\r\nã“ã‚Œã§æ®‹ã‚Šã®æ—¥æ•°ã‚’è¡¨ç¤ºã§ãã¾ã™ã€‚ã‚„ã£ãŸã­ã€‚\r\n\r\n![Imgur](https://imgur.com/gCc7Z3I.png)\r\n\r\n# æ›¸ãå‡ºã™(ãƒ“ãƒ«ãƒ‰)\r\n\r\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥åŠ›ã™ã“ã¨ã§HTMLã‚’æ›¸ãå‡ºã™ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚  \r\n\r\n```gradle\r\n./gradlew browserWebpack\r\n```\r\n\r\n`build/distributions`ã«æ›¸ãå‡ºã•ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/zJ3U8Iw.png)\r\n\r\n# ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°\r\nä»Šå›ã¯`Netlify`ã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦å…¬é–‹ã—ã¾ã™ã€‚  \r\n\r\n## ã¨ã‚Šã‚ãˆãšGitHubã«å…¬é–‹ã™ã‚‹\r\nã“ã“ã‹ã‚‰å‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/jJn3857.png)\r\n\r\n## Netlifyã§å…¬é–‹\r\n\r\nãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã®ã¨ã“ã‚ã‚’ç©ºç™½ã«ã—ã¾ã™ã€‚  \r\nãŠã¾ç’°ã ã‚ã†ã‘ã©ã€`Netlify`ã§ãƒ“ãƒ«ãƒ‰å‡ºæ¥ãªã‹ã£ãŸã®ã§`GitHub Actions`ã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã€çµæœã ã‘Netlifyã«å…¬é–‹ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚\r\n\r\nãƒ“ãƒ«ãƒ‰ã—ãªã„ã‚ˆã†ã«è¨­å®šã‚’å¤‰æ›´ã—ã¾ã™ã€‚`Site settings`ã‹ã‚‰`Build & deploy`ã‚’ãŠã—ã€`Stop builds`ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Bb945fO.png)\r\n\r\n# GitHub Actions ã®å‰ã«\r\nãƒªãƒã‚¸ãƒˆãƒªã®è¨­å®šã‚’é–‹ã„ã¦ã€`Secrets`ã‚’é–‹ãã¾ã™ã€‚  \r\nã“ã®ä¸­ã«ã€å¿…è¦ãªå€¤ã‚’ä¿å­˜ã—ã¦ãŠãã¾ã™ã€‚\r\n\r\n## NETLIFY_AUTH_TOKEN\r\nNetlifyã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆè¨­å®šã¸é€²ã‚“ã§ã€`Applications`ã®ä¸­ã®`Personal access tokens`ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€`New access token`ã‚’æŠ¼ã—ã¦æ‰•ã„å‡ºã—ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚\r\n\r\n## NETLIFY_SITE_ID\r\nã“ã‚Œã¯ã•ã£ãå…¬é–‹ã—ãŸã‚µã‚¤ãƒˆã®è¨­å®šã¸ã™ã™ã‚“ã§ã€`Site information`ã®ä¸­ã®`API ID:`ã®å€¤ã§ã™\r\n\r\nã“ã‚“ãªãµã†\r\n\r\n![Imgur](https://imgur.com/LUm0oxZ.png)\r\n\r\n# GitHub Actions ã‚’çµ„ã‚€\r\nãƒªãƒã‚¸ãƒˆãƒªã®`Actions`ã‚’é¸æŠã—ã¦ã€`set up a workflow yourself`ã‚’æŠ¼ã—ã¦ä½œæˆã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Pd2OpNz.png)\r\n\r\nãã—ãŸã‚‰ä»¥ä¸‹ã‚³ãƒ”ãƒš\r\n\r\n```yml\r\n# å‚è€ƒã«ã—ãŸã€‚thx!ï¼šhttps://qiita.com/nwtgck/items/e9a355c2ccb03d8e8eb0\r\n\r\nname: Netlify\r\n\r\non:\r\n  push:\r\n  workflow_dispatch:\r\n\r\njobs:\r\n  build:\r\n    runs-on: ubuntu-latest\r\n\r\n    steps:\r\n      - uses: actions/checkout@v2\r\n      \r\n      # æ¨©é™ã®å¤‰æ›´\r\n      - name: Grant permission\r\n        run: chmod +x ./gradlew\r\n      \r\n      # HTMLæ›¸ãå‡ºã—ï¼ˆãƒ“ãƒ«ãƒ‰ï¼‰\r\n      - name: Making html\r\n        run: ./gradlew browserWebpack \r\n      \r\n      # Netlifyã«ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹\r\n      - name: Upload netlify\r\n        run: npx netlify-cli deploy --dir=./build/distributions --prod\r\n        env:\r\n          NETLIFY_AUTH_TOKEN: ${{ secrets.NETLIFY_AUTH_TOKEN }}\r\n          NETLIFY_SITE_ID: ${{ secrets.NETLIFY_SITE_ID }}\r\n```\r\n\r\nã§ããŸã‚‰`Commit`ã—ã¦`Actions`ã¸ç§»å‹•ã—ã¦è¦‹ã¦ã¿ã¾ã™ã€‚\r\n\r\nä½œæ¥­é€²è¡Œä¸­\r\n\r\n![Imgur](https://imgur.com/gwxC5in.png)\r\n\r\nçµ‚ã‚ã£ãŸã‚‰Netlifyã§å…¬é–‹ã—ãŸã‚µã‚¤ãƒˆã®URLã‚’é–‹ã„ã¦ã¾ã™ã€‚ç„¡äº‹é–‹ã‘ãŸã‚‰æˆåŠŸã§ã™ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nå®Œæˆå“ã§ã™ï¼šhttps://countdown-kotlinjs.netlify.app/  \r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ï¼šhttps://github.com/takusan23/CountdownKotlinJS"},{"title":"LINE Messaging API ã‚’è©¦ã™","link":"/posts/line_messaging_api_nodejs/","markdown":"\nå§‹æ¥­å¼ã‚ªãƒ³ãƒ©ã‚¤ãƒ³ã®äºˆå®šã ã£ãŸã®ã«ãªã‚“ã§ä¸­æ­¢ã«ãªã£ãŸã®ï¼Ÿ\n\n# LINE Messaging API\nã‚’ä½¿ã†ã“ã¨ã§ã€LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ(LINE Bot)ã‚’ä½œæˆã§ãã¾ã™ã€‚  \nä¸€ãƒ¶æœˆ1000é€šã¾ã§ã¯ç„¡æ–™ã§ã€ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã‚‚åˆ©ç”¨ã§ãã¾ã™(ã¤ã‚ˆã„)ã€‚\n\n# ä»Šå›ã‚„ã‚‹ã“ã¨\nNode.jsã‹ã‚‰LINEå…¬å¼ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨å‹é”ã«ãªã£ã¦ã„ã‚‹äººå…¨å“¡ã«é€ä¿¡ã™ã‚‹ã‚„ã¤ã‚’ä½œæˆã€‚ï¼ˆãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰  \nä»Šå›ã¯ã“ã£ã¡ï¼ˆNode.jså´ï¼‰ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’é€ä¿¡ã§ãã‚Œã°å®Œæˆã£ã¦ã“ã¨ã§\n\n## Messaging API ç™»éŒ²\n(LINEã®ãƒ­ã‚°ã‚¤ãƒ³ã¨ã‹é–‹ç™ºè€…ç™»éŒ²ã¯æ¸ˆã¾ã›ã¦ãŠã„ã¦)  \nãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ç™»éŒ²ã®ã‚„ã‚Šæ–¹ã‚ã‚Šã¾ã™ï¼šhttps://developers.line.biz/ja/docs/messaging-api/getting-started/#using-console\n\nhttps://developers.line.biz/ja/services/messaging-api/  \nã‚’é–‹ã„ã¦ã€`ä»Šã™ãã¯ã˜ã‚ã‚ˆã†`ã‚’é¸ã³ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/4Wm5Iu7.png)\n\n### ãªã‚“ã‹è‹±èªãªã‚“ã ã‘ã©ï¼Ÿ\nå³ä¸‹ã®ã¨ã“ã‚ã‹ã‚‰æ—¥æœ¬èªé¸ã¹ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/MDNDRzS.png)\n\n### ãƒ—ãƒ­ãƒã‚¤ãƒ€ãƒ¼\nã¾ã‚é–‹ç™ºè€…ã®åå‰ã¨ã‹å…¥ã‚Œã¦ãŠã‘ã°ã„ã„ã‚“ã˜ã‚ƒãªã„ã§ã™ã‹ã­ã€‚  \n[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨](https://developers.line.biz/ja/docs/messaging-api/getting-started/#_4-%E3%83%81%E3%83%A3%E3%83%8D%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B)ã“ã®é …ç›®ã¯è¡¨ç¤ºã•ã‚Œãªã„ãã†ã§ã™ã€‚\n\n![Imgur](https://imgur.com/T1lOCmP.png)\n\n### ãƒãƒ£ãƒ³ãƒãƒ«åã€èª¬æ˜æ–‡\nåå‰ã§ã™ã­ã€‚\n\n[ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã«ã‚ˆã‚‹ã¨](https://developers.line.biz/ja/docs/messaging-api/getting-started/#_4-%E3%83%81%E3%83%A3%E3%83%8D%E3%83%AB%E3%82%92%E4%BD%9C%E6%88%90%E3%81%99%E3%82%8B)åå‰ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¡¨ç¤ºã•ã‚Œã‚‹ãã†ã§ã™ã€‚ï¼ˆã¾ã‚å½“ãŸã‚Šå‰ï¼‰  \nèª¬æ˜ã¯LINE Botã‚’ä½œã‚‹åˆ†ã«ã¯è¡¨ç¤ºã•ã‚Œãªã„æ¨¡æ§˜ã€‚\n\n![Imgur](https://imgur.com/7NgoM0x.png)\n\n### ãƒãƒ£ãƒ³ãƒãƒ«ã‚¢ã‚¤ã‚³ãƒ³\nã‚ã‚“ã©ã„ã®ã§é£›ã°ã—ã¾ã™ã€‚ä»»æ„ã§ã™ã®ã§\n\n### è·ç¨®\né©å½“ã«\n\n![Imgur](https://imgur.com/KautfJe.png)\n\nã‚ã¨ã¯ãƒ¡ã‚¢ãƒ‰ã¨ã‹ã‚’å…¥åŠ›ã—ã¦åŒæ„ã™ã‚Œã°ä½œæˆã§ãã¾ã™ã€‚\n\n(ã¡ãªã¿ã«ã‚¹ã‚¯ã‚·ãƒ§ã®ã¾ã‚“ã¾ä½œã‚‹ã¨åå‰ãŒäºˆç´„æ¸ˆã¿ã§ãªã‚“ã¨ã‹ã£ã¦è¨€ã‚ã‚Œã¦æ€’ã‚‰ã‚Œã‚‹)\n\n# å‹é”ç™»éŒ²\nãƒãƒ£ãƒ³ãƒãƒ«åŸºæœ¬è¨­å®šã®ã¨ãªã‚Šã«ã‚ã‚‹`Messaging APIè¨­å®š`ã‚’é¸ã¶ã¨ã€QRã‚³ãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‹ã®ã§ã€  \nGoogleãƒ¬ãƒ³ã‚ºãªã‚Šã€LINEã®QRã‚³ãƒ¼ãƒ‰èª­ã¿å–ã‚Šãªã‚“ã‹ã§å‹é”ç™»éŒ²ã‚’ã—ã¦ãã ã•ã„ã€‚\n\n# ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆã™ã‚‹\n`Messaging APIè¨­å®š`ã®ä¸€ç•ªä¸‹ã«ã€ãƒãƒ£ãƒ³ãƒãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³ã£ã¦ã®ãŒæœ‰ã‚‹ã®ã§ã€ãã“ã§ç™ºè¡Œã—ã¦ãã ã•ã„ã€‚  \nä»–ã®äººã«æ•™ãˆã¡ã‚ƒã ã‚ãªã‚„ã¤ã§ã™ã€‚\n\n![Imgur](https://imgur.com/66q8qv4.png)\n\n# Node.jsã‹ã‚‰å©ã\n\nNode.jsã®ç’°å¢ƒã‚’æƒãˆã¾ã™ã€‚é©å½“ãªãƒ•ã‚©ãƒ«ãƒ€ã‚’é–‹ã„ã¦ã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‹ãä»¥ä¸‹ã‚’å®Ÿè¡Œ\n\n```\nnpm init -y\n```\n\nãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã¾ã™\n\n```\nnpm install @line/bot-sdk --save\n```\n\nãã—ãŸã‚‰ã€æ¬¡ã®JSã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚`src`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ã¦`index.js`ã£ã¦åå‰ã‚’ã¤ã‘ã¦ã‚³ãƒ”ãƒšã—ã¦\n\n```js\n// NodeJSç”¨ LINE SDK\nconst line = require('@line/bot-sdk');\n\n// ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³\nconst client = new line.Client({\n    channelAccessToken: 'ç”Ÿæˆã—ãŸã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³'\n})\n\n// å…¨å“¡ã«é€ä¿¡ã™ã‚‹ã‚„ã¤\nclient.broadcast(\n    // é€ä¿¡å†…å®¹\n    {\n        type: 'text',\n        text: 'Hello World'\n    }\n).then(res => console.log('Ok'))\n```\n\næœ€å¾Œã«å®Ÿè¡Œ\n\n```\nnode src/index.js\n```\n\nã“ã‚Œã¯å‹é”ã«ãªã£ã¦ã„ã‚‹äººå…¨ã¦ã«é€ä¿¡ã•ã‚Œã‚‹ã‚„ã¤ã§ã™ã­ã€‚ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã§ã¯`ãƒ–ãƒ­ãƒ¼ãƒ‰ã‚­ãƒ£ã‚¹ãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸`ã£ã¦è¨€ã£ã¦ã‚‹ã‚„ã¤ã€‚\n\n# ãŠã‚ã‚Šã«\nOSã®å£ã‚’è¶…ãˆã¦ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ã§ãã‚‹ã®ã¯å¼·ã„ã¨æ€ã£ãŸ"},{"title":"Minecraft Fabric ã®ç’°å¢ƒæ§‹ç¯‰ã‚’ã—ã¦ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¦ã¿ã‚‹","link":"/posts/minecraft_fabric_dev_environment/","markdown":"ã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚  \r\nãƒã‚¸ãƒ©ãƒ– -Making\\*Lovers-ï¼ˆMaking\\*Lovers ãƒ•ãƒ«HDãƒªãƒã‚¹ã‚¿ãƒ¼ä»˜ãï¼‰äºˆç´„ã—ã¾ã—ãŸã€‚æœˆæœ«ãŒæ¥½ã—ã¿ã§ã™ã­ã€‚\r\n\r\n# æœ¬é¡Œ\r\nTwitterã§Forgeã‚ˆã‚Šå¿«é©ã¨èã„ã¦ã€‚  \r\nã—ã‹ã‚‚Kotlinã§ModdingãŒã§ãã‚‹!!!\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ    | ã‚ãŸã„                                                                                            |\r\n|-----------|---------------------------------------------------------------------------------------------------|\r\n| IDE       | Intellij IDEA 2021.1.2 Community Edition                                                          |\r\n| Windows   | 10 Pro (ãã†ã„ãˆã°ç™ºè¡¨ä¼šãŒã‚ã‚‹ã‚“ã ã£ã‘ï¼Ÿã„ã„åŠ æ¸›è¨­å®šãŒã‚³ãƒ³ãƒ‘ãƒã¨æ•£ã‚‰ã°ã£ã¦ã‚“ã®ã©ã†ã«ã‹ã—ã¦ã»ã—ã„) |\r\n| Minecraft | 1.17 (1.7.10ã¨ç©ºç›®ã—ãªã„ã§)                                                                       |\r\n| Java      | 16ï¼ˆå¾Œè¿°ï¼‰                                                                                        |\r\n| è¨€èª      | Kotlin                                                                                            |\r\n\r\n# Minecraft 1.17\r\nèª¿ã¹ãŸæ„Ÿã˜ã€Extra Utilitiesã«ã‚ã£ãŸDark GlassãŒãƒãƒ‹ãƒ©ã«é€†è¼¸å…¥ï¼Ÿã•ã‚ŒãŸã¿ãŸã„ã€‚TTã®ç›£è¦–ã§ä½¿ãˆãã†ã€‚\r\n\r\næŠ€è¡“çš„ãªè©±ã‚’ã™ã‚‹ã¨Java 16ä»¥ä¸ŠãŒå¿…è¦ã§ã™ã€‚JDKã®æœ‰å„ŸåŒ–ã‚ˆãã‚ã‹ã‚‰ã‚“ã‘ã©AdoptOpenJDKã®æ–¹ãªã‚‰å¤šåˆ†å¤§ä¸ˆå¤«ã€‚  \r\nã¤ã„ã«Javaã®Moddingã§ã‚‚å‹æ¨è«–ãŒï¼ˆä½¿ã£ã¦ã„ã„ã®ã‹ã¯ã‚ˆãã‚ã‹ã‚‰ã‚“ï¼‰ï¼ˆã¨ã„ã†ã‹`Record`ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã‹ãˆãˆã‚„ã‚“ï¼‰ï¼ˆã¦ã‹ãã‚‚ãã‚‚ä»Šå›ã¯Kotlinä½¿ã†ã‹ã‚‰åˆ¥ã«ï¼‰\r\n\r\n#### èª­ã¾ãªãã¦ã„ã„ã€€Javaæœ‰å„ŸåŒ–ã®è©±\r\n- Javaã¯ä»Šã§ã‚‚ç„¡æ–™ã§ä½¿ãˆã‚‹\r\n- Javaã®JDKã¯è‰²ã‚“ãªä¼šç¤¾ãŒä½œã£ã¦ã‚‹\r\n    - Amazonã¨ã‹Microsoftã¨ã‹\r\n    - Oracleã‚‚ä½œã£ã¦ã‚‹\r\n- ãã®ä¸­ã§Oracleã®ä½œã£ã¦ã‚‹Oracle JDKãŒå•†ç”¨åˆ©ç”¨ã™ã‚‹ãªã‚‰é‡‘æ‰•ãˆã«ãªã£ãŸã€‚\r\n    - Java 11ã‹ã‚‰å‡ºã¦ããŸè©±ã€‚ä»Šã¾ã§ã®ãƒã‚¤ã‚¯ãƒ©ã¯Java 8ã§åˆ©ç”¨ã§ããŸã®ã§ã€‚\r\n    - Oracle JDK\r\n        - ã“ã„ã¤ã¯ä¸€éƒ¨ã‚’é™¤ã„ã¦æœ‰å„Ÿ\r\n    - Open JDK\r\n        - ã“ã„ã¤ã¯ç„¡æ–™ã€‚ãŸã ã—ã‚µãƒãƒ¼ãƒˆæœŸé–“ãŒåŠå¹´\r\n- Oracleä»¥å¤–ã®JDKã‚’é¸ã¹ã°ãˆãˆ\r\n    - AdoptOpenJDK\r\n        - ã“ã„ã¤ã¯ç„¡æ–™+ã‚µãƒãƒ¼ãƒˆ4å¹´+å•†ç”¨åˆ©ç”¨å¯ã€‚ã‚‚ã†ã“ã‚Œä»£æ›¿å“ã ã‚\r\n    - Corretto\r\n        - Amazonè£½JDK\r\n\r\nå¤šåˆ†é–“é•ã£ã¦ã‚‹æ°—ãŒã™ã‚‹ã®ã§ãƒãƒ©ã‚·ã®è£çš„ãªæ„Ÿè¦šã§\r\n\r\n#### Oracle JDK æœ‰å„ŸåŒ–ã®è©±ã®ç¶šã 2021/10/06 è¿½è¨˜\r\nã©ã†ã‚„ã‚‰ã€Java 17ã‹ã‚‰`Oracle JDK`ãŒç„¡å„Ÿæä¾›ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚å†ã³ç„¡å„ŸåŒ–ã€‚  \r\nã¾ãƒ¼ãŸã‚„ã‚„ã“ã—ãã—ã¦ä½•ãŒã—ãŸã„ã‚“ã‚„...\r\n\r\nã¨ã„ã†ã‚ã‘ã§`Java 17ä»¥é™`ã¯`Oracle JDK`ä½¿ã£ã¦ã‚‚å¤§ä¸ˆå¤«ã«ãªã‚Šã¾ã—ãŸã€‚ã§ã‚‚ä»Šã®æ‰€ã‚ªãƒ©ã‚¯ãƒ«ä»¥å¤–ã®JDKã§ã‚„ã£ã¦è¡Œã‘ã¦ã‚‹ã®ã§ãã®ã¾ã¾è¡Œã“ã†ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# Java 16 ã‚’å…¥ã‚Œã‚‹\r\nä»Šå›ã¯`AdoptOpenJDK`ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nhttps://adoptopenjdk.net/ ã‚’é–‹ã„ã¦ã€`OpenJDK 16 (Latest)`ã¨ã€`HotSpot`ã®ãƒ©ã‚¸ã‚ªãƒœã‚¿ãƒ³ã‚’é¸ã‚“ã§`Latest release`ã‚’æŠ¼ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/IilPXDc.png)\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã¾ã‚é©å½“ã«é€²ã‚ã¦ãã ã•ã„ã€‚ï¼ˆç”»åƒãªã„ï¼‰\r\n\r\nä¸€å¿œJava 16ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããŸã‹ç¢ºèªã™ã‚‹ãŸã‚ã«ã€ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã‹ã§ã€`javac -version`ã‚’å©ãã¾ã™ã€‚`javac 16.0.1`ãŒå¸°ã£ã¦ãã‚Œã°ãŠï½‹\r\n\r\n```cmd\r\njavac -version\r\n```\r\n\r\n```cmd\r\njavac 16.0.1\r\n```\r\n\r\n# è¿½è¨˜ï¼š2021/07/28 JAVA_HOMEã®è¨­å®š\r\nãªã‚“ã‹ä¹…ã—ã¶ã‚Šã«ã‚„ã£ãŸã‚‰ã¾ã Java8ä½¿ã£ã¦ã‚“ã®ã‹ã‚ˆã£ã¦è¨€ã‚ã‚ŒãŸã®ã§ç›´ã—ã¾ã™ã€‚\r\n\r\nç’°å¢ƒå¤‰æ•°ã®è¨­å®šé–‹ã„ã¦ã€ã‚·ã‚¹ãƒ†ãƒ ç’°å¢ƒå¤‰æ•°ã®ä¸­ã‹ã‚‰`JAVA_HOME`ã‚’é¸ã‚“ã§ã€`AdoptOpenJDK`ã®ãƒ‘ã‚¹ã‚’è¨­å®šã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/qna3UJ5.png)\r\n\r\n\r\n# IDEAã‚’å…¥ã‚Œã‚‹\r\nå…¥ã‚Œã¦ãŠã„ã¦ãã ã•ã„ã€‚Community Editionã§ã„ã„ã§ã™\r\n\r\n# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ã‚¯ãƒ­ãƒ¼ãƒ³\r\n\r\nIDEAã®ã‚¹ã‚¿ãƒ¼ãƒˆç”»é¢ã‹ã‚‰ã€`Get from VCS`ã‚’æŠ¼ã—ã¦ã€ã„ã‹ã®URLã‚’æŒ‡å®šã—ã¦`Clone`ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/j5tEO0u.png)\r\n\r\n| ãªã¾ãˆ | ã‚ãŸã„                                                  |\r\n|--------|---------------------------------------------------------|\r\n| URL    | https://github.com/natanfudge/fabric-example-mod-kotlin |\r\n\r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä¿¡é ¼ã™ã‚‹ã‹èã‹ã‚Œã‚‹ã®ã§`Trust project`ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚\r\n\r\n# ãã†ã†ã¾ãè¡Œã‹ãªã„\r\n\r\n## Could not merge JARs! Deleting source JARs - please re-run the command and move on.\r\n\r\n`gradle.properties`ã‚’é–‹ã„ã¦ã€`loom_version`ã‚’`0.8`ã«ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/NmjERlf.png)\r\n\r\n## You are using an outdated version of Java (8). Java 16 or higher is required\r\n\r\n### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®š\r\nå³ä¸Šã®`File`ã‹ã‚‰`Project Structure`ã‚’é¸æŠã—ã¦ã€`Project SDK`ã‚’`16`ã«ã€`Project language level`ã‚‚`16`ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/6sn3TEy.png)\r\n\r\né©ç”¨ã—ãŸã‚‰ã€ã“ã®ãƒœã‚¿ãƒ³ã‚’æ¢ã—ã¦æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Q7hdIIO.png)\r\n\r\nãƒœã‚¿ãƒ³ãŒè¦‹ã¤ã‹ã‚‰ãªã„å ´åˆã¯`IDEA`ã®å³ä¸Šã«ã‚ã‚‹ï¼Ÿ`Gradle`ã‚’æŠ¼ã—ã¦ã€`Sync`ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã‚‚ã„ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/0ra6jbW.png)\r\n\r\nã“ã‚Œã§çµ‚ã‚ã‚Œã°ã„ã„ã‚“ã§ã™ãŒã€ã“ã‚Œã§ã‚‚åŒã˜ã‚¨ãƒ©ãƒ¼ã§é€²ã‚ãªã„ã¨ããŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n### IDEAã®è¨­å®š\r\nå³ä¸Šã®`File`ã‹ã‚‰`Settings`ã‚’é¸æŠã—ã¦ã€`Build,Execution,Deployment`ã‚’æŠ¼ã—ã€`Build Tools`ã‚’æŠ¼ã—ã€`Gradle`ã¸é€²ã¿ã€  \r\n`Gradle JVM`ã‚’`16`ã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚ã§ããŸã‚‰ã•ã£ãã¿ãŸã„ã«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ejjN51l.png)\r\n\r\nã†ã¾ãè¡Œã‘ã°å‡¦ç†ãŒé€²ã¿ã¾ã™ã€‚ç§ã®ç’°å¢ƒã§ã¯10åˆ†ã¡ã‚‡ã£ã¨ã‹ã‹ã£ãŸã€‚  \r\n`Gradle Build`ãŒçµ‚ã‚ã£ãŸã‚‰ä¸€æ—¦IDEAã‚’é–‰ã˜ã¾ã™ã€‚ãã®å¾Œã‚‚ã†ä¸€åº¦èµ·å‹•ã™ã‚‹ã¨ãƒã‚¤ã‚¯ãƒ©ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆãŒèµ·å‹•ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/NhEtyaF.png)\r\n\r\næ—©é€Ÿå†ç”Ÿãƒœã‚¿ãƒ³ã¿ãŸã„ãªã‚„ã¤ã‚’æŠ¼ã—ã¦èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚\r\n\r\n# 1.17 Fabric\r\nï¼ˆç§ã ã£ãŸã‚‰ï¼‰èµ·å‹•ç›´å¾Œè¨­å®šã¸é€²ã¿BGMã‚’0ã«ã—ã¾ã™ã€‚ã†ã‚‹ã•ã„ã—\r\n\r\n![Imgur](https://imgur.com/rS1ziQj.png)\r\n\r\n# MODæƒ…å ±ã®å¤‰æ›´\r\n`gradle.properties`ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®å†…å®¹ã‚’å¤‰ãˆã¾ã™\r\n\r\n| ãªã¾ãˆ             | ã‚ãŸã„                                                                             |\r\n|--------------------|------------------------------------------------------------------------------------|\r\n| maven_group        | è‡ªåˆ†ã®æŒã£ã¦ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é€†ã‹ã‚‰ã€‚æŒã£ã¦ãªã„ãªã‚‰Github Pagesã¨ã‹ä»–ã¨ã‹ã¶ã‚‰ãªã„æ–‡å­—åˆ— |\r\n| archives_base_name | MODã®IDï¼ˆå°æ–‡å­—ï¼‰                                                                  |\r\n\r\nç§ãªã‚‰ã“ã‚“ãªæ„Ÿã˜ï¼Ÿ\r\n\r\n```\r\n#Fabric api\r\nfabric_version=0.34.10+1.17\r\n\r\n\tloom_version=0.8-SNAPSHOT\r\n\r\n\t# Mod Properties\r\n\tmod_version = 1.0.0\r\n\tmaven_group = io.github.takusan23\r\n\tarchives_base_name = clickmanaita\r\n```\r\n\r\nã¾ãŸã€`fabric_version`ç­‰ã¯ã€ä»¥ä¸‹ã®ã‚µã‚¤ãƒˆã‹ã‚‰æ›´æ–°ãŒã‚ã‚‹ã‹ç¢ºèªã§ãã‚‹ã®ã§è¦‹ã¦ã¿ã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nhttps://fabricmc.net/versions.html\r\n\r\n# Javaã®ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸åä¿®æ­£\r\nIDEAã®Project(ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‹ã¨ã“ã‚)ã‹ã‚‰`net.fabricmc.example`ã‚’é¸æŠçŠ¶æ…‹ã«ã—ã¦ã€`ShiftæŠ¼ã—ãªãŒã‚‰F6ã‚’æŠ¼ã—ã¾ã™`ã€‚  \r\næŠ¼ã—ãŸã‚‰`Rename Package`ã‚’é¸ã³ã€ãƒ‰ãƒ¡ã‚¤ãƒ³å(é€†ã‹ã‚‰)+MODåå°æ–‡å­— ã‚’å…¥åŠ›ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/JAPuJUz.png)\r\n\r\nç¶šã„ã¦`resources`ã®æ–¹ã‚‚ä¿®æ­£ã—ã¾ã™ã€‚åŒã˜ã‚ˆã†ã«`assets.modid`ã‚’é¸æŠçŠ¶æ…‹ã«ã—ã¦ã€`ShiftæŠ¼ã—ãªãŒã‚‰F6ã‚’æŠ¼ã—ã¾ã™`ã€‚ \r\nãã—ãŸã‚‰å…ˆç¨‹å…¥åŠ›ã—ãŸMODã®IDã‚’å…¥åŠ›ã™ã‚Œã°ã„ã„ã§ã™ã€‚\r\n\r\nãªã‚“ã‹æ®‹ã£ã¦ã‚‹`net.fabricmc`ã£ã¦ã®ã¯å¤šåˆ†æ¶ˆã—ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚\r\n\r\nã“ã†ãªã£ã¦ã„ã‚Œã°ãŠï½‹\r\n\r\n![Imgur](https://imgur.com/jZ7odV0.png)\r\n\r\n# ExampleMod.kt ã®ãƒ•ã‚¡ã‚¤ãƒ«åä¿®æ­£\r\nå‘³æ°—ãªã„ã®ã§`MODå.kt`ã¨ã§ã‚‚ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚åå‰å¤‰æ›´ã¯å…ˆç¨‹ã¨åŒã˜ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/DQvTCV5.png)\r\n\r\n# MODæƒ…å ±ã®ä¿®æ­£\r\n`resources`ã®ä¸­ã«ã‚ã‚‹`fabric.mod.json`ã‚’é–‹ãã¾ã™ã€‚  \r\né–‹ã„ãŸã‚‰ã€`modid`ã€`entrypoints.main`ã®éƒ¨åˆ†ã‚’æœ€ä½é™æ›¸ãæ›ãˆã¦ãŠã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```json\r\n  \"id\": \"clickmanaita\",\r\n```\r\n\r\n`ãƒ‰ãƒ¡ã‚¤ãƒ³(é€†ã‹ã‚‰)`.`MODã®ID`.`ExampleMod.ktã ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«å`Kt::init\r\n\r\n**ã‚¯ãƒ©ã‚¹å+Kt**ã€Ktã‚’ä»˜ã‘ãªã„ã¨ãƒ€ãƒ¡ã£ã½ã„ã€‚\r\n\r\n```json\r\n  \"entrypoints\": {\r\n    \"main\": [\r\n      \"io.github.takusan23.clickmanaita.ClickManaitaKt::init\"\r\n    ]\r\n  },\r\n```\r\n\r\nã‚ã¨ã‚¢ã‚¤ã‚³ãƒ³ã®ã¨ã“ã‚ã®`modid`ã‚‚ã•ã£ãå¤‰ãˆã¡ã‚ƒã£ãŸã®ã§ç›´ã—ã¨ã„ã¦ãã ã•ã„ã€‚\r\n\r\nãã®ä»–ã¯å„è‡ªå¥½ããªã‚ˆã†ã«ã€‚ä»¥ä¸‹ä¾‹\r\n\r\n```json\r\n{\r\n  \"schemaVersion\": 1,\r\n  \"id\": \"clickmanaita\",\r\n  \"version\": \"${version}\",\r\n\r\n  \"name\": \"ClickManaita\",\r\n  \"description\": \"CheatMod\",\r\n  \"authors\": [\r\n    \"takusan_23\"\r\n  ],\r\n  \"contact\": {\r\n    \"homepage\": \"https://www.curseforge.com/minecraft/mc-mods/clickmanaita\",\r\n    \"sources\": \"https://github.com/takusan23/ClickManaita2\"\r\n  },\r\n\r\n  \"license\": \"Apache-2.0 License\",\r\n  \"icon\": \"assets/clickmanaita/icon.png\",\r\n\r\n  \"environment\": \"*\",\r\n  \"entrypoints\": {\r\n    \"main\": [\r\n      \"io.github.takusan23.clickmanaita.ClickManaitaKt::init\"\r\n    ]\r\n  },\r\n  \"mixins\": [\r\n    \"modid.mixins.json\"\r\n  ],\r\n  \"depends\": {\r\n    \"fabricloader\": \">=0.8.7\",\r\n    \"fabric\": \"*\",\r\n    \"fabric-language-kotlin\": \"*\",\r\n    \"minecraft\": \"1.17.x\"\r\n  },\r\n  \"suggests\": {\r\n    \"flamingo\": \"*\"\r\n  }\r\n}\r\n```\r\n\r\n# ã‚ˆãã‚ã‹ã‚‰ã‚“ã‘ã© Mixin ã‚‚ä¿®æ­£\r\n`resources`å†…ã®`modid.mixins.json`ã‚’é–‹ã„ã¦ã€`package`ã®éƒ¨åˆ†ã‚’ç›´ã—ã¾ã™ã€‚ã“ã‚Œãªã‚“ãªã®ï¼Ÿ  \r\n`ãƒ‰ãƒ¡ã‚¤ãƒ³`.`MODã®ID`.`mixin`\r\n\r\n```json\r\n{\r\n  \"required\": true,\r\n  \"package\": \"io.github.takusan23.clickmanaita.mixin\",\r\n  \"compatibilityLevel\": \"JAVA_8\",\r\n  \"mixins\": [\r\n  ],\r\n  \"client\": [\r\n    \"ExampleMixin\"\r\n  ],\r\n  \"injectors\": {\r\n    \"defaultRequire\": 1\r\n  }\r\n}\r\n```\r\n\r\n# èµ·å‹•ã—ã¦ã¿ã‚‹\r\n\r\nã“ã‚Œã§èµ·å‹•ã™ã‚‹ã¯ãšã€‚å¤šåˆ†\r\n\r\n# ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã—ã¦ã¿ã‚‹\r\n\r\nhttps://fabricmc.net/wiki/tutorial:items\r\n\r\nã“ã®é€šã‚Šã«ã‚„ã£ã¦ã¿ã‚‹\r\n\r\nã¾ãšã‚¢ã‚¤ãƒ†ãƒ ã‚¯ãƒ©ã‚¹(Kotlinã ã—objectã§ã‚‚ã„ã„ã‚)ã‚’ä½œã‚Šã¾ã™ã€‚\r\n\r\n```kotlin\r\nobject ClickManaitaItem {\r\n\r\n    /** ç‰¹ã«ãªã‚“ã®æ©Ÿèƒ½ã‚‚ãªã„ã‚¢ã‚¤ãƒ†ãƒ  */\r\n    val CLICKMANAITA_WOOD = Item(FabricItemSettings().group(ItemGroup.TOOLS))\r\n\r\n}\r\n```\r\n\r\n![Imgur](https://imgur.com/ap6YcZj.png)\r\n\r\nãã—ãŸã‚‰`ExampleModKt`ã ã£ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’é–‹ã„ã¦ã€`init`é–¢æ•°å†…ã§ã‚¢ã‚¤ãƒ†ãƒ ã‚’ç™»éŒ²ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\n@Suppress(\"unused\")\r\nfun init() {\r\n    // This code runs as soon as Minecraft is in a mod-load-ready state.\r\n    // However, some things (like resources) may still be uninitialized.\r\n    // Proceed with mild caution.\r\n\r\n    // ã‚¢ã‚¤ãƒ†ãƒ è¿½åŠ ã€‚clickmanaita_woodã®ã¨ã“ã‚ã¯ã‚¢ã‚¤ãƒ†ãƒ ID\r\n    Registry.register(Registry.ITEM, Identifier(\"clickmanaita\", \"clickmanaita_wood\"), ClickManaitaItem.CLICKMANAITA_WOOD)\r\n\r\n}\r\n```\r\n\r\nãã—ãŸã‚‰èµ·å‹•ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚  \r\nç”»é¢ã®ã‚ˆã†ã«ã‚¢ã‚¤ãƒ†ãƒ ãŒè¿½åŠ ã§ãã¦ã„ã‚Œã°æˆåŠŸã€‚\r\n\r\n![Imgur](https://imgur.com/5ZrM8r6.png)\r\n\r\n# ãƒ†ã‚¯ã‚¹ãƒãƒ£\r\nç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã—ã¾ã™ã€‚ç”¨æ„ã§ããŸã‚‰ã€`resources/assets/MODã®ID/textures/item/ã‚¢ã‚¤ãƒ†ãƒ ID.png`ã£ã¦æ„Ÿã˜ã§ç½®ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ezwosDY.png)\r\n\r\nãã—ãŸã‚‰ä»Šåº¦ã¯ã€`resources/assets/MODã®ID/models/item/ã‚¢ã‚¤ãƒ†ãƒ ID.json`ã£ã¦æ„Ÿã˜ã§JSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nä¸­èº«ã¯ã“ã†ã§ã™ã€‚\r\n\r\n```json\r\n{\r\n  \"parent\": \"item/generated\",\r\n  \"textures\": {\r\n    \"layer0\": \"clickmanaita:item/clickmanaita_wood\"\r\n  }\r\n}\r\n```\r\n\r\n`modã®ID:item/ã‚¢ã‚¤ãƒ†ãƒ ã®ID`ã£ã¦æ„Ÿã˜ã§ã™ã­ã€‚ã“ã®ãƒ†ã‚­ã‚¹ãƒãƒ£æŒ‡å®šã¾ã˜ã§ã‚„ã‚„ã“ã—ã„ã‹ã‚‰ã‚„ã‚ã¦ã»ã—ã„ã€‚  \r\nã¨ã„ã†ã‹JSONã¯äººé–“ãŒæ›¸ãã‚‚ã‚“ã˜ã‚ƒãªã„ã ã‚ã€‚æœ¬å½“ã«\r\n\r\næˆåŠŸã—ã¦ã¾ã—ãŸã€‚å¤±æ•—ã—ã¦ãŸã‚‰ã¾ã˜ã§ã¤ã‚‰ã„\r\n\r\n![Imgur](https://imgur.com/4M5ParB.png)\r\n\r\n### ãŠã¾ã‘ã€€ã‚¯ãƒªãƒƒã‚¯ã¾ãªæ¿ã¿ãŸã„ã«ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰å¢—ãˆã‚‹ã‚ˆã†ã«\r\n\r\nãã®ãŸã‚ã«ã¯`Item`ã‚¯ãƒ©ã‚¹ã‚’ç¶™æ‰¿ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ã®ã§`ClickManaitaBaseItem`ã¿ãŸã„ãªã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\n/**\r\n * å³ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã‚¢ã‚¤ãƒ†ãƒ ãŒå¢—ãˆã‚‹ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¿½åŠ ã™ã‚‹\r\n *\r\n * @param settings ã‚¯ãƒªã‚¨ã‚¿ãƒ–ã¨ã‹\r\n * @param dropSize å¢—ãˆã‚‹æ•°\r\n * */\r\nclass ClickManaitaBaseItem(settings: Settings?, private val dropSize: Int = 2) : Item(settings) {\r\n\r\n}\r\n```\r\n\r\nãã—ãŸã‚‰`useOnBlock`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã—ã¾ã™ã€‚å¤šåˆ†ã“ã‚ŒãŒãƒ–ãƒ­ãƒƒã‚¯ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°ã§ã™ã€‚  \r\n\r\n```kotlin\r\n/**\r\n * ãƒ–ãƒ­ãƒƒã‚¯ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹é–¢æ•°\r\n * */\r\noverride fun useOnBlock(context: ItemUsageContext?): ActionResult {\r\n    val world = context?.world\r\n    val state = world?.getBlockState(context.blockPos)\r\n    val copyBlock = state?.block\r\n    repeat(dropSize) {\r\n        copyBlock?.afterBreak(world, context.player, context.blockPos, state, null, context.stack)\r\n    }\r\n    return ActionResult.SUCCESS\r\n}\r\n```\r\n\r\nãã—ãŸã‚‰Item()ã®éƒ¨åˆ†ã‚’ClickManaitaBaseItem()ã«æ›¸ãæ›ãˆã¦å®Ÿè¡Œã—ã¦ã¿ã‚‹ã¨\r\n\r\n```kotlin\r\nobject ClickManaitaItem {\r\n\r\n    /** å³ã‚¯ãƒªãƒƒã‚¯ã—ãŸã‚‰ã‚¢ã‚¤ãƒ†ãƒ ãŒå¢—ãˆã‚‹ */\r\n    val CLICKMANAITA_WOOD = ClickManaitaBaseItem(settings = FabricItemSettings().group(ItemGroup.TOOLS), dropSize = 2)\r\n\r\n}\r\n```\r\n\r\n\r\nå¢—ãˆã¾ã™ã€‚ã¾ã ãƒã‚§ã‚¹ãƒˆã®ä¸­èº«ã¨ã‹ã¯å¢—ãˆãªã„ã®ã§ã¾ã ã¾ã ã£ã¦æ„Ÿã˜ã§ã™ã‹ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/xsXFHrp.png)\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚’èª­ã‚ã‚‹ã‚ˆã†ã«ã™ã‚‹\r\nMinecraftã®ã‚½ãƒ¼ã‚¹ã‚’èª­ã‚ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚IDEAã«ã¯é€†ã‚³ãƒ³ãƒ‘ã‚¤ãƒ©ãƒ¼ãŒæ­è¼‰ã•ã‚Œã¦ã„ã‚‹ã®ã§ãªãã¦ã‚‚æœ€æ‚ªã„ã„ã§ã™ãŒã€æ¤œç´¢æ©Ÿèƒ½ãŒä½¿ãˆãªã„ã®ã§ã‚½ãƒ¼ã‚¹ã‚’ç”Ÿæˆã—ã¨ã„ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nIDEAã®`Gradle`ã‚’æŠ¼ã—ã¦ã€`Tasks` > `fabric` > `genSources` ã‚’ãƒ€ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ç”Ÿæˆã•ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/U0U2TCL.png)\r\n\r\nãã®å¾Œã€é©å½“ã«Blockã‚¯ãƒ©ã‚¹ã¨ã‹ã‚’å‚ç…§ã—ãŸéš›ã«ã€ä¸Šã«å‡ºã¦ãã‚‹`Choose Sources...`ã‚’æŠ¼ã—ã¦ã€`ãªã‚“ã¨ã‹-sources.jar`ã‚’é¸æŠã™ã‚‹ã“ã¨ã§ç”Ÿæˆã—ãŸã‚½ãƒ¼ã‚¹ã‚’èª­ã‚€ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/qHRSVnB.png)\r\n\r\n`Shift`+`Ctrl`+`F`ã®æ¤œç´¢æ©Ÿèƒ½ã‚‚é–‹æ”¾ã•ã‚Œã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/PCDBcwG.png)\r\n\r\n# é…å¸ƒå¯èƒ½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã™ã‚‹\r\n\r\nIDEAå³ä¸Šã®`Gradle`ã‹ã‚‰ã€`Tasks`>`build`ã¸é€²ã¿`build`ã‚’é¸æŠã™ã‚‹ã“ã¨ã§é…å¸ƒå¯èƒ½ãªJarãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆã—ã¾ã™ã€‚  \r\næˆåŠŸã™ã‚‹ã¨ã€`build/libs/`ã«ç”Ÿæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ãŒæœ‰ã‚‹ã¯ãšã§ã™ã€‚ï¼ˆdevã€sourcesã€sources-dev ã˜ã‚ƒãªã„æ–¹ï¼‰  \r\nã‚ã¨ã¯ã“ã®Jarãƒ•ã‚¡ã‚¤ãƒ«ã‚’CurseForgeã¨ã‹ã§å…¬é–‹ã™ã‚Œã°ã„ã„ã‚“ã˜ã‚ƒãªã„ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/6J6OyJb.png)\r\n\r\n# ã‚¨ãƒ³ãƒ‰ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®èª¬æ˜ã¨ã‹\r\nã“ã®Modã¯`Fabric`å°å…¥å¾Œã€`mods`ãƒ•ã‚©ãƒ«ãƒ€ã«ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦æ”¾ã‚Šè¾¼ã‚“ã§ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n- Fabric API\r\n  - https://www.curseforge.com/minecraft/mc-mods/fabric-api/files\r\n- Fabric Language Kotlin\r\n  - Kotlinã¨ã„ã†è¨€èªã§æ›¸ã‹ã‚ŒãŸãŸã‚ã€ä»–ã®MODã¨é•ã„å¿…è¦ã«ãªã‚‹ã€‚\r\n  - https://www.curseforge.com/minecraft/mc-mods/fabric-language-kotlin/files\r\n- Modæœ¬ä½“\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚  \r\nhttps://github.com/takusan23/ClickManaita2/tree/1.17-fabric\r\n\r\nã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸã‚ã¨ãƒ–ãƒ©ãƒ³ãƒåã€Œ1.17-fabricã€ã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã—ã¦ãã ã•ã„ã€‚ä¸€ç™ºã§ãƒ“ãƒ«ãƒ‰é€šã‚‰ãªã„ã¨æ€ã†ã€‚\r\n\r\n# è¿½è¨˜ï¼š2021/07/28 1.17.1ã¸ã®å¯¾å¿œ\r\ngitä½¿ã£ã¦ã‚‹å ´åˆã¯ã‚³ãƒŸãƒƒãƒˆã™ã‚‹ãªã‚Šãƒ–ãƒ©ãƒ³ãƒä½œã‚‹ãªã‚Šã—ã¦ç¾çŠ¶ã®ç’°å¢ƒå£Šã‚Œã¦ã‚‚å¤§ä¸ˆå¤«ãªçŠ¶æ…‹ã«ã—ã¦ãã ã•ã„ã€‚  \r\nä½¿ã£ã¦ãªã‘ã‚Œã°ã©ã£ã‹ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãŠã‘ã°ã„ã„ã®ã§ã¯\r\n\r\n`gradle.properties`ã‚’ã€æœ€æ–°ã®æƒ…å ±ã«æ›´æ–°ã—ã¾ã™ã€‚  \r\næœ€æ–°ã®å€¤ã¯ã€Œhttps://fabricmc.net/versions.htmlã€ã‹ã‚‰ç¢ºèªã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\nä»¥ä¸‹ä¸€ä¾‹ (ãªã‚“ã‹ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®è¨€èªã«propertiesæŒ‡å®šã—ãŸã‚‰ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆå‹•ã„ã¦ã¦ã¡ã‚‡ã£ã¨æ„Ÿå‹•)\r\n\r\n```properties\r\nkotlin.code.style=official\r\norg.gradle.jvmargs=-Xmx1G\r\n\r\n# Fabric Properties\r\n\t# Check these on https://modmuss50.me/fabric.html\r\nminecraft_version=1.17.1\r\nyarn_mappings=1.17.1+build.31\r\nloader_version=0.11.6\r\n\r\n#Fabric api\r\nfabric_version=0.37.1+1.17\r\n\r\n\tloom_version=0.8-SNAPSHOT\r\n\r\n\t# Mod Properties\r\n\tmod_version = 1.0.0\r\n\tmaven_group = io.github.takusan23\r\n\tarchives_base_name = clickmanaita\r\n\r\n# Kotlin\r\n\tkotlin_version=1.5.0\r\n\tfabric_kotlin_version=1.6.0+kotlin.1.5.0\r\n```\r\n\r\nã“ã‚Œã§å¾Œã¯`Minecraft Client`ã‚’èµ·å‹•ã™ã‚‹ã ã‘ã§1.17.1ã¸å¯¾å¿œã§ãã¾ã—ãŸã€‚  \r\nãƒã‚¤ãƒŠãƒ¼ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãªã®ã§ã‚¯ãƒ©ã‚¹ã®å¤‰æ›´ã¨ã‹ç„¡ã„ã‘ã©å¤§å‹ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãªã‚‰ãã†ã†ã¾ãè¡Œã‹ãªã„ã¨æ€ã†ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nã„ã¤ã‚‚Androidã§æ›¸ã„ã¦ã‚‹Kotlinã§Moddingã§ãã‚‹ã®ã§å¿«é©ã€‚Fabricã¸ç§»æ¤ã—ãŸã„ã‹ã‚‰ä¼šç¤¾è¾ã‚ãŸã„ã€‚  \r\nãã†ã„ãˆã°ç§ã®ãƒã‚¤ã‚¯ãƒ©å…¨ç››æœŸã¯ãƒŠãƒã‚¢ãƒ³ã®ãƒã‚¤ã‚¯ãƒ©ãŒæœ€æ–°Verè¿½ã„ã‹ã‘ã¦ãŸã‘ã©ã‚ã®ã‚µã‚¤ãƒˆã©ã†ãªã£ã¦ã‚“ã®ï¼Ÿ"},{"title":"ã‚¯ãƒªãƒƒã‚¯ã¾ãªæ¿ã‚’1.18ã«ç§»è¡Œã—ãŸè©±","link":"/posts/minecraft_mod_1_18_migration/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \nã‘ã‚‚ã®é“â˜†ã‚¬ãƒ¼ãƒªãƒƒã‚·ãƒ¥ã‚¹ã‚¯ã‚¨ã‚¢ æ”»ç•¥ã—ã¾ã—ãŸã€‚  \nhttps://whirlpool.co.jp/kemonomichi-gs/\n\nã‹ã‚ã„ã„ã€‚\n\n![Imgur](https://imgur.com/Ms6q4Ag.png)\n\nä¸€æœ¬é“ã®ãƒãƒ¼ãƒ¬ãƒ ãƒ«ãƒ¼ãƒˆï¼èª°ã‚‚ä¸å¹¸ã«ãªã‚‰ãªã„å¹¸ã›ãƒ«ãƒ¼ãƒˆã§ã„ã„ã­\n\n![Imgur](https://imgur.com/thklLcG.png)\n\n# æœ¬é¡Œ\nã‚¯ãƒªãƒƒã‚¯ã¾ãªæ¿ã‚’**Minecraft 1.18**ã«æ›´æ–°ã—ãŸã¨ãã«é­é‡ã—ãŸã‚¨ãƒ©ãƒ¼ãªã©(ã»ã¼Fabricã®è©±)\n\n# --- Fabric ç·¨ ---\n\n## 1.17ã¨ã®å¤‰æ›´ç‚¹\n\n- `Java 17` ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸ\n    - ç§ã®ç’°å¢ƒã§ã¯`Eclipse Adoptium`ã®`Java 17`ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚\n        - IDEAå³ä¸Šã®Fileã‹ã‚‰Project Structureã‚’é¸æŠã—ã¦ã€JDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’17ã«ã—ã¾ã™ã€‚\n        - IDEAã®è¨­å®šã‚’é–‹ãã€Build,Execution,Deployment > Build Tools > Gradle ã¸é€²ã¿ã€Gradle JVMã‚’17ã«ã—ã¾ã™ã€‚\n    - OracleJDKã‚‚ç„¡å„Ÿæä¾›ã«æˆ»ã£ãŸã®ã§ã€åˆ¥ã«OracleJDKã¤ã‹ã£ã¦ã‚‚ã„ã„ã¯ãšï¼Ÿ\n- `Gradle`ã¯`7.3`ä»¥é™ãŒå¿…è¦ã§ã™\n    - 1.17ã‹ã‚‰å¼•ãç¶™ãéš›ã¯æ³¨æ„\n- loader_version\n    - `0.12.8`\n- fabric_version\n    - `0.43.1+1.18`\n- loom_version\n    - `0.10-SNAPSHOT`\n- fabric_kotlin_version\n    - `1.7.0+kotlin.1.6.0`\n\n### build.gradle\n\nå…¨éƒ¨è¼‰ã›ã‚‹ã¨é•·ã„ã®ã§å¤‰æ›´ç‚¹ã ã‘\n\nJava 17 ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«\n\n```java\nsourceCompatibility = JavaVersion.VERSION_17\ntargetCompatibility = JavaVersion.VERSION_17\n```\n\n```java\ntasks.withType(JavaCompile) {\n    it.options.encoding = \"UTF-8\"\n\n    // Minecraft 1.18 (1.18) upwards uses Java 17.\n    it.options.release = 17\n}\n```\n\n```java\ncompileKotlin.kotlinOptions.jvmTarget = \"17\"\n```\n\n### gradle.properties\n\nã„ã£ã±ã„å¤‰æ›´ç‚¹ãŒã‚ã‚‹ã€‚\n\n```properties\nkotlin.code.style=official\norg.gradle.jvmargs=-Xmx1G\n\n# Fabric Properties\n\t# Check these on https://modmuss50.me/fabric.html\nminecraft_version=1.18\nyarn_mappings=1.18+build.1\nloader_version=0.12.8\n\n#Fabric api\nfabric_version=0.43.1+1.18\n\n\tloom_version=0.10-SNAPSHOT\n\n\t# Mod Properties\n\tmod_version = 1.0.0\n\tmaven_group = io.github.takusan23\n\tarchives_base_name = ClickManaita-Fabric-1.18\n\n\t# Kotlin\n\tkotlin_version=1.6.0\n\tfabric_kotlin_version=1.7.0+kotlin.1.6.0\n```\n\n### gradle-wrapper.properties\n\nGradle 7.3 ã‚’åˆ©ç”¨ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\n\n```\ndistributionBase=GRADLE_USER_HOME\ndistributionPath=wrapper/dists\ndistributionUrl=https\\://services.gradle.org/distributions/gradle-7.3-bin.zip\nzipStoreBase=GRADLE_USER_HOME\nzipStorePath=wrapper/dists\n```\n\n### fabric.mod.json\n\nã“ã£ã¡ã¯å¤‰æ›´éƒ¨åˆ†ã ã‘\n\nã‚¨ãƒ³ãƒˆãƒªãƒ¼ãƒã‚¤ãƒ³ãƒˆã®ç™»éŒ²ã€ãªã‚“ã‹å¤‰ã‚ã£ã¦ãŸã®ã§ä¿®æ­£\n\n```json\n\"entrypoints\": {\n  \"main\": [\n    {\n      \"adapter\": \"kotlin\",\n      \"value\": \"io.github.takusan23.clickmanaita.ClickManaitaKt::init\"\n    }\n  ]\n},\n```\n\nMinecraft 1.18ã€Java 17ã€loader 0.12.8 ã‚’æŒ‡å®šã—ã¾ã™\n\n```json\n\"depends\": {\n  \"fabricloader\": \">=0.12.8\",\n  \"fabric\": \"*\",\n  \"fabric-language-kotlin\": \"*\",\n  \"minecraft\": \"1.18.x\",\n  \"java\": \">=17\"\n},\n```\n\n### modid.mixins.json\n\nä½¿ã£ã¦ãªã„ã‘ã©ä¸€å¿œ\n\nJava 17 ã‚’æŒ‡å®šã—ã¾ã™ã€‚\n\n```\n\"compatibilityLevel\": \"JAVA_17\",\n```\n\n## ç›´ã—ã¦ã‚‚ãã†ç°¡å˜ã«å‹•ã‹ãªã„\n3å›ãã‚‰ã„å£ã«ã¶ã¡å½“ãŸã£ãŸã€‚ã—ã‚“ã©ã„\n\n### Exception in thread \"main\" java.lang.NoClassDefFoundError: joptsimple/OptionSpec\n\n```\nException in thread \"main\" java.lang.NoClassDefFoundError: joptsimple/OptionSpec\nCaused by: java.lang.RuntimeException: Unsupported access widener format (v2)\n```\n\n- IDEAã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã—ãŸã‚‰æ²»ã‚Šã¾ã—ãŸã€‚\n    - ã“ã“ã‹ã‚‰æ¶ˆã›ã¾ã™\n\n![Imgur](https://imgur.com/Qb0Db6s.png)\n\n### Failed to read accessWidener file from mod fabric-content-registries-v0\n\n- ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸã‚‰æ²»ã‚Šã¾ã—ãŸã€‚\n\n```\ngradlew --refresh-dependencies\n```\n\n![Imgur](https://imgur.com/NhDFypB.png)\n\n### There is insufficient memory for the Java Runtime Environment to continue\n\nãƒ¡ãƒ¢ãƒªãŒè¶³ã‚Šã¾ã›ã‚“ï¼ï¼ï¼ï¼  \n(ã‚‚ã—ã‹ã—ãŸã‚‰Cãƒ‰ãƒ©ã‚¤ãƒ–ã®ç©ºããŒãªãã¦ã€ã‚¹ãƒ¯ãƒƒãƒ—ã§ã‚‚ç„¡ç†ã ã£ãŸã‹ã‚‰ã“ã‚ŒãŒå‡ºãŸã®ã‹ã‚‚)\n\n# --- Forge ç·¨ ---\n\n## 1.17.1 ã¨ã®é•ã„\nFabricã¨åŒã˜ï¼Ÿ\n\n- `Java 17` ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸ\n    - ç§ã®ç’°å¢ƒã§ã¯`Eclipse Adoptium`ã®`Java 17`ã‚’åˆ©ç”¨ã—ã¦ã„ã¾ã™ã€‚\n        - IDEAå³ä¸Šã®Fileã‹ã‚‰Project Structureã‚’é¸æŠã—ã¦ã€JDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’17ã«ã—ã¾ã™ã€‚\n        - IDEAã®è¨­å®šã‚’é–‹ãã€Build,Execution,Deployment > Build Tools > Gradle ã¸é€²ã¿ã€Gradle JVMã‚’17ã«ã—ã¾ã™ã€‚\n    - OracleJDKã‚‚ç„¡å„Ÿæä¾›ã«æˆ»ã£ãŸã®ã§ã€åˆ¥ã«OracleJDKã¤ã‹ã£ã¦ã‚‚ã„ã„ã¯ãšï¼Ÿ\n- `Gradle`ã¯`7.3`ä»¥é™ãŒå¿…è¦ã§ã™\n    - mdkè½ã¨ã—ã¦ãã‚Œã°ã¤ã„ã¦ãã‚‹ã®ã§ç‰¹ã«é–¢ä¿‚ãªã„ã¯ãš\n\næ›´æ–°ã®ä»•æ–¹ã‚ˆãçŸ¥ã‚‰ãªã„ã®ã§**Forgeã®mdkè½ã¨ã—ã¦ãã¦1.17.1ã®ç’°å¢ƒã«ã‚³ãƒ”ãƒšã—ãŸ**ã€‚  \nå¤šåˆ†`build.gradle`ã‚’ã„ã˜ã‚Œã°æ›´æ–°ã§ãã‚‹ã¨æ€ã†ã‘ã©ã€‚  \n\n1.18ã®mdkã‚³ãƒ”ãƒ¼ã—ãŸã‚‰IDEAé–‹ãç›´ã—ã¦å³ä¸Šã®`Gradle`ã‹ã‚‰`Tasks > forgegradle runs > genIntellijRuns`ã‚’å®Ÿè¡Œã€‚\n\n### Caused by: java.lang.UnsupportedClassVersionError: net/minecraftforge/fml/loading/targets/FMLClientLaunchHandler has been compiled by a more recent version of the Java Runtime (class file version 61.0), this version of the Java Runtime only recognizes class file versions up to 60.0\n\nIDEAã®Fileã‹ã‚‰ã€`Project Strcture`ã‚’é–‹ãã€`Project SDK`ã«Java 17ã‚’æŒ‡å®šã—ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/dTueBHD.png)\n\nå½±éŸ¿ã‚ã£ãŸã®ã¯ã€ã‚¯ãƒªã‚¨ã‚¤ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®ãƒ­ãƒ¼ã‚«ãƒ©ã‚¤ã‚ºãŒã¡ã‚‡ã£ã¨ã ã‘å¤‰ã‚ã£ã¦ãŸã£ã¦æ‰€ã‹ãªã€‚  \n(ãã‚‚ãã‚‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå¤§è¦æ¨¡éãã¦1.18ã«åˆ†å‰²ã—ãŸã£ã¦è©±ã ã£ã‘ï¼Ÿãã†ãªã‚‰å½±éŸ¿ã‚ã¾ã‚Šãªã•ãã†ï¼Ÿ)\n\n# çµ‚ã‚ã‚Šã«\n**Forge / Fabric å…±ã«`1.18`ã¸ç§»è¡Œã—ãŸéš›ã®ã‚³ãƒ¼ãƒ‰ã®æ›¸ãæ›ãˆã¯ã»ã¼ç„¡ã‹ã£ãŸã§ã™ã€‚**  \n(ã„ã‚„æ°—ä»˜ã„ã¦ç„¡ã„ã ã‘ã‹ã‚‚ã—ã‚Œãªã„)\n\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™\n- 1.18 Fabricç‰ˆ\n    - https://github.com/takusan23/ClickManaita2/tree/1.18-fabric\n- 1.18 Forgeç‰ˆ\n    - https://github.com/takusan23/ClickManaita2/tree/1.18-forge\n\nMODé–‹ç™ºè€…ã•ã‚“ãŒã‚“ã°ã£ã¦ãã ã•ã„ã€‚ãŠã¤ã€‚ï¼˜ï¼˜ï¼˜ï¼˜ï¼˜ï¼˜"},{"title":"AWS ã® Lightsail ã§ãŠä¸€äººæ§˜ Misskey ã‚µãƒ¼ãƒãƒ¼ã‚’ç«‹ã¦ã¦ã¿ãŸ (v10)","link":"/posts/misskey_ohitorisama/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nãƒ‹ã‚³ãƒ‹ã‚³å‹•ç”»ç‰ˆã¯ã“ã¡ã‚‰ã§ã™\r\n\r\nhttps://www.nicovideo.jp/watch/sm42546302\r\n\r\n<script type=\"application/javascript\" src=\"https://embed.nicovideo.jp/watch/sm42546302/script?w=640&h=360\"></script><noscript><a href=\"https://www.nicovideo.jp/watch/sm42546302\">ãŠä¸€äººæ§˜ Misskey ã‚µãƒ¼ãƒãƒ¼ç«‹ã¦ã¦ã¿ãŸ</a></noscript>\r\n\r\n# Misskey ãŠä¸€äººæ§˜ã‚’ä½œã£ã¦ã¿ãŸã„ï¼ï¼ï¼\r\nã„ã‚„ã€åˆ¥ã«ãŠä¸€äººæ§˜ã˜ã‚ƒãªãã¦ã‚‚ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³ãŒç„¡ã„ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚Œã°è‰¯ã„ã®ã§ã™ãŒï¼ˆ`LTL ã¯æµã‚Œã«ã¤ã„ã¦è¡Œã‘ãªã„...`ï¼‰ãƒ»ãƒ»ãƒ»  \r\nã„ã‚„ã€ã€ãªã‚“ã‹ã€ã€ã€ã‚ã®ã€ã€ã€ã€`AWS`ã¨ã‹ä½¿ã£ã¦ã¿ãŸã‹ã£ãŸã‚“ã§ã™ã‚ˆãƒ»ãƒ»ãƒ»ï¼ˆå¤šåˆ†å€¤æ®µãŒé«˜ãä»˜ãã®ã§ã‚‚ã£ã¨ã¡ã‚ƒã‚“ã¨è€ƒãˆã‚‹ã¹ãã§ã™ï¼‰\r\n\r\n# ã•ã‚“ã“ã†ã«ã—ã¾ã—ãŸ\r\nthx!!!!!!!!!!\r\n\r\n- https://misskey-hub.net/docs/install/manual.html\r\n- https://github.com/mei23/memo/blob/master/misskey/Setup-Meisskey-Quick.md\r\n- https://blog.noellabo.jp/entry/2019/08/14/8i3RHuZ1wJNDinIn\r\n- https://seritude.com/misskey-alone-server/\r\n\r\n# æ›´æ–° 2023/08/13\r\nä»¥ä¸‹ã‚’å¤‰æ›´ã—ãªã„ã¨ã€ä¸€éƒ¨ã®ã‚µãƒ¼ãƒãƒ¼ï¼ˆã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ï¼‰ã¨ã®é€šä¿¡ã«å¤±æ•—ã—ã¾ã™  \r\nï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆçµæœãŒ`403`ã«ãªã‚Šé€šä¿¡ã§ãã¾ã›ã‚“ï¼‰\r\n\r\n- Ubuntu ( OS )\r\n    -  `20.04` ã§ã¯ãªã `22.04` ã‚’é¸ã¶\r\n        - ãã®ã¾ã¾ã§ã¯`MongoDB`ã®å°å…¥ã«å¤±æ•—ã—ã¾ã™ã€‚è¿½è¨˜ã—ã¾ã—ãŸã€‚\r\n- Node.js\r\n    - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ 16 ã§ã¯ãªã 18 ã‚’ä½¿ã†\r\n        - ãŠãã‚‰ã`Misskey v10`ã§ã‚‚å‹•ãã¯ãš\r\n\r\n# ã²ã¤ã‚ˆã†ãªã‚‚ã®\r\nä»Šå›ã¯**v13**ã§ã¯ãªã**v10**ã‚’å»ºã¦ã¾ã™ã€‚ï¼ˆã‚ã„ã™ããƒ¼ï¼‰  \r\nå¤ã„ã®ã§æœ€æ–°ç‰ˆã‚’å»ºã¦ãŸã„äººã‹ã‚‰ã—ãŸã‚‰ã‚ã‚“ã¾ã‚Šå‚è€ƒã«ãªã‚‰ãªã„ã¨æ€ã†ï¼ˆ`https`åŒ–ãã‚‰ã„ï¼ŸåŒã˜ãªã®ï¼‰\r\n\r\n- VPS\r\n    - AWS Lightsail ã‚’ä½¿ã„ã¾ã™\r\n    - å¾Œè¿°ã—ã¾ã™ãŒã€ã‚‚ã—ã‹ã—ãŸã‚‰`å›½ç”£ VPS`ã¨ã‹ä»–ã®æ–¹ãŒä½¿ã£ã¦ã„ã‚‹`VPS`ã‚’é¸ã¶ã¹ãã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãƒ»ãƒ»ãƒ»ã‚‚ã—ãã¯`EC2`ï¼Ÿ\r\n    - 1ã‚³ã‚¢CPU / 1GB RAM / 40GB SSD ã«ã—ã¾ã—ãŸ\r\n- ãƒ‰ãƒ¡ã‚¤ãƒ³\r\n    - ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ã„ã¾ã™\r\n        - `diary.negitoro.dev`\r\n    - `Cloudflare`ãŒä½¿ãˆã¾ã›ã‚“ï¼ˆå¾Œè¿°ï¼‰\r\n- SSH ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ\r\n    - `Tera Term`ãªã©\r\n    - æœ€æ‚ª`VPS`ã«ä»˜ã„ã¦ãã‚‹ãƒ–ãƒ©ã‚¦ã‚¶ãƒ™ãƒ¼ã‚¹ã®`SSH ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ`ã§ã‚‚å‡ºæ¥ãªãã¯ãªã„ã¨æ€ã†ãƒ»ãƒ»ãƒ»\r\n- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸\r\n    - ä»Šå›ã¯ AWS ã® S3\r\n- Mastodon / Misskey ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ\r\n    - ä»–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‹ç¢ºèªç”¨\r\n\r\n## æ§‹æˆå›³ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/A4ruvgv.png)\r\n\r\n## ä¸€éƒ¨ã®ã‚µãƒ¼ãƒãƒ¼ã¨ç¹‹ãŒã‚‰ãªã„è©±\r\n`Cloudflare`ãŒä½¿ãˆãªã„ã›ã„ãªã®ã‹ã€ã¯ãŸã¾ãŸ`AWS ã® Lightsailï¼ˆVPSï¼‰`ã®ã›ã„ãªã®ã‹ã‚ˆãåˆ†ã‹ã‚‰ãªã„ã®ã§ã™ãŒã€  \r\nä¸€éƒ¨ã®Misskeyã‚µãƒ¼ãƒãƒ¼ã¨æ¥ç¶šã§ãã¾ã›ã‚“ï¼ˆçŸ¥ã£ã¦ã‚‹é™ã‚Š2ã¤ãã‚‰ã„ã‚ã‚Šã¾ã™ï¼‰\r\n\r\n![Imgur](https://imgur.com/mwNyT7m.png)\r\n\r\nãŠãã‚‰ãç›¸æ‰‹å´ã®ã‚µãƒ¼ãƒãƒ¼ãŒ`Cloudflare`ã§ä¿è­·ã•ã‚Œã¦ã„ã¦ã€ãªã‚“ã‹ç§å´ã®`IP ã‚¢ãƒ‰ãƒ¬ã‚¹`ãŒãƒ–ãƒ©ãƒƒã‚¯ãƒªã‚¹ãƒˆå…¥ã‚Šã—ã¦ã„ã‚‹ã£ã½ã„ã‚“ã§ã™ã‚ˆã­ï¼Ÿ  \r\nã“ã¡ã‚‰ã‚‚`Cloudflare`ã§ä¿è­·ã™ã‚Œã°è‰¯ã„ã®ã‹ãªã¨æ€ã„ã¾ã—ãŸãŒã€`.dev`ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå¯¾å¿œã—ã¦ã„ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚`Google Domains`çµ‚äº†ã™ã‚‹ã—é ¼ã¿ã¾ã™ã‚ˆãƒ»ãƒ»ãƒ»ï¼  \r\nã¨ã„ã†ã‚ã‘ã§`VPS`ã‚’å¤‰ãˆã‚‹ä»¥å¤–ã§è§£æ±ºç­–ãŒç„¡ã„ã§ã™ã€‚çš†ã•ã‚“ã¯ä»–ã®`VPS`ã‚’ä½¿ã£ãŸã»ã†ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ãƒ»ãƒ»ãƒ»  \r\n\r\n# ç«‹ã¦ã‚‹\r\nå‹•ç”»ä½œã£ã¦ãŸã‚‰ä½•ã‚„ã£ãŸã‹å¿˜ã‚ŒãŸã®ã§ã–ã£ãã‚Šè¡Œãã¾ã™  \r\n\r\nè³‡æ–™ã§ã™ï¼š https://github.com/mei23/memo/blob/master/misskey/Setup-Meisskey-Quick.md\r\n\r\n## Misskey ã‚’ãƒ•ã‚©ãƒ¼ã‚¯ã™ã‚‹\r\nã“ã‚Œã¯ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãªã„å ´åˆã¯ã‚¹ã‚­ãƒƒãƒ—ã§è‰¯ã„ã¯ãšã€‚  \r\nç§ã¯ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãã‚‰ã„ã¯ã„ã˜ã‚ŠãŸã„ãªã¨æ€ã£ãŸã®ã§ãƒ•ã‚©ãƒ¼ã‚¯ã™ã‚‹ã“ã¨ã«ã—ã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/umfOvtv.png)\r\n\r\n## AWS ã®ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ç”¨æ„ã™ã‚‹\r\n\r\nç”¨æ„ã—ã¦ãã ã•ã„ã€‚  \r\nä½œæ¥­ç”¨ã®`IAMãƒ¦ãƒ¼ã‚¶ãƒ¼`ã‚’ä½œã£ãŸã‚Šã€2æ®µéšèªè¨¼ã«ã™ã‚‹ãªã‚Šã€æœ€ä½é™ã®ã“ã¨ã‚‚ã‚„ã£ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã‹ã‚‚ã€‚\r\n\r\n## AWS Lightsail ã§ VPS ã‚’å€Ÿã‚Šã‚‹\r\n`Linux`ã§`Ubuntu 20.04`ã§è¡Œãã¾ã™\r\n\r\n![Imgur](https://imgur.com/6jdbpjr.png)\r\n\r\n![Imgur](https://imgur.com/9M5P43F.png)\r\n\r\n## ãƒ‘ãƒ–ãƒªãƒƒã‚¯ IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å›ºå®šåŒ–ã™ã‚‹\r\nã™ã§ã«å›ºå®šåŒ–ã—ãŸçŠ¶æ…‹ã§ã™ãŒãƒ»ãƒ»ãƒ»  \r\nã“ã“ã‹ã‚‰å›ºå®šåŒ–ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/8dee2EE.png)\r\n\r\nã‚¢ã‚¿ãƒƒãƒã—ã¦ã„ã‚‹å ´åˆã¯è¿½åŠ è²»ç”¨ã¯ã‹ã‹ã‚‰ãªã„ãã†\r\n\r\n## HTTPS é€šä¿¡ã§ä½¿ã†ãƒãƒ¼ãƒˆã‚’é–‹ã‘ã‚‹\r\n`https`ã¯`TCP`ã®`443`ç•ªã‚’ä½¿ã†ã®ã§ã€å—ã‘å…¥ã‚Œã‚‰ã‚Œã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\n`Misskey`ã¯`https`ã§ãªã„ã¨æ¥ç¶šã§ããªã„ã§ã™\r\n\r\n![Imgur](https://imgur.com/jEAY8Et.png)\r\n\r\n## éµãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½¿ã£ã¦SSHã§ãƒ­ã‚°ã‚¤ãƒ³ã™ã‚‹\r\nã“ã“ã‹ã‚‰éµãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/0vT2JX4.png)\r\n\r\nã¾ãš`Tera Term`ã§IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥ã‚Œã¦...\r\n\r\n![Imgur](https://imgur.com/bpSOxRC.png)\r\n\r\n`Lightsail`ã«è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åã¨ã€å…ˆã»ã©ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸéµãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã‚’ãã‚Œãã‚Œå…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/d0Ix1qv.png)\r\n\r\n## VPS ã®è¨­å®š\r\nãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿ã«`vim`ã‚’ä½¿ã„ã¾ã™ãŒï¼ˆãã‚Œã—ã‹åˆ†ã‹ã‚‰ã‚“ï¼‰ã€ä»–ã®ã‚¨ãƒ‡ã‚£ã‚¿ãŒå¥½ããªå ´åˆã¯ãã®éƒ½åº¦èª­ã¿æ›¿ãˆã¦ãã ã•ã„ã€‚\r\n\r\n### ã‚¹ãƒ¯ãƒƒãƒ—ï¼ˆä»®æƒ³ãƒ¡ãƒ¢ãƒªï¼‰ã®è¨­å®šã‚’ã™ã‚‹\r\nç‰©ç†ãƒ¡ãƒ¢ãƒªãŒå¤šã„å ´åˆã¯å¤šåˆ†ã„ã‚‰ãªã„ã‹ã‚‚ï¼Ÿ  \r\nä»Šå›ã¿ãŸã„ã«ç‰©ç†ãƒ¡ãƒ¢ãƒªãŒ`1GB`ã—ã‹ãªã„å ´åˆã¯å¾Œã§ã‚„ã‚‹`webpack`å‘¨ã‚Šã§ã“ã‘ã¡ã‚ƒã„ã¾ã™  \r\nä¸€è¡Œãšã¤æ‰“ã¡è¾¼ã‚“ã§ã„ã£ã¦ãã ã•ã„ã€‚\r\n\r\n```bash\r\nsudo fallocate -l 2G /swapfile\r\nsudo chmod 600 /swapfile\r\nsudo mkswap /swapfile\r\nsudo swapon /swapfile\r\n```\r\n\r\næ¬¡ã«`vim`ã§ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo vim /etc/fstab\r\n```\r\n\r\næ”¹è¡Œã—ã¦ä»¥ä¸‹ã®è¡Œã‚’è¶³ã—ã¾ã™ã€‚  \r\n`i`ã‚’æŠ¼ã—ã¦ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã€`Esc`ã§æˆ»ã‚Œã¾ã™ã€‚`:wq`ã§ä¿å­˜ã§ã™ã€‚\r\n\r\n```plaintext\r\n/swapfile none swap sw 0 0\r\n```\r\n\r\næœ€å¾Œã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦ã‚¹ãƒ¯ãƒƒãƒ—é ˜åŸŸãŒå¢—ãˆã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚\r\n\r\n```bash\r\nfree -h\r\n```\r\n\r\nã“ã‚“ãªãµã†ãªå‡ºåŠ›ãŒã‚ã‚‹ã¯ãš\r\n\r\n```bash\r\n              total        used        free      shared  buff/cache   available\r\nMem:          929Mi       450Mi        71Mi       0.0Ki       408Mi       332Mi\r\nSwap:         2.0Gi       174Mi       1.8Gi\r\n```\r\n\r\n### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®æ›´æ–°ã‚’ã™ã‚‹\r\n`Ubuntu ( Debian ç³» )`ã¯å¤šåˆ†`apt`ãªã®ã§ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦æ›´æ–°ã—ã¾ã™ã€‚  \r\n`Misskey`æ§‹ç¯‰ã«é–¢ä¿‚ãªãã€`Linux`ãƒã‚·ãƒ³ã‚’è²°ã£ãŸã‚‰ã¾ãšã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo apt update\r\nsudo apt upgrade\r\n```\r\n\r\n`upgrade`ã®æ–¹ã¯ã€æœ¬å½“ã«å®Ÿè¡Œã™ã‚‹ã‹ã©ã†ã‹èã‹ã‚Œã‚‹ã®ã§ã€`Y`ã‚’æŠ¼ã—ã¦ã‚¨ãƒ³ã‚¿ãƒ¼ã—ã¾ã™ã€‚\r\n\r\n`Do you want to continue? [Y/n]` â†ã“ã‚Œ\r\n\r\nã‚‚ã—ã€æ›´æ–°ä¸­ã«ãƒ”ãƒ³ã‚¯è‰²ã®æ€–ã„ç”»é¢ï¼ˆå¤šåˆ† `want to do about modified configuration file sshd_config?` çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼Ÿï¼‰ãŒã§ãŸã‚‰ã€çŸ¢å°ã‚­ãƒ¼ã§`Keep`ã®æ–¹ã‚’é¸ã‚“ã§ã‚¨ãƒ³ã‚¿ãƒ¼ã™ã‚Œã°è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n## Misskey æ§‹ç¯‰\r\n\r\n### Misskey ç”¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œã‚‹\r\nç‰¹ã«è¨€ã†ã“ã¨ã¯ãªã„ã‹ãª\r\n\r\n```bash\r\nsudo adduser --disabled-password --disabled-login misskey\r\n```\r\n\r\n### å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å…¥ã‚Œã‚‹\r\n`Node.js`ï¼ˆMisskeyã¯ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰JavaScriptã§å‡ºæ¥ã¦ã„ã‚‹ï¼‰\r\n\r\n```bash\r\ncurl -sL https://deb.nodesource.com/setup_16.x | sudo -E bash -\r\nsudo apt-get install -y nodejs\r\nsudo npm i -g pnpm\r\n```\r\n\r\n`MongoDB`ï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼‰\r\n\r\n```bash\r\nsudo apt-get install gnupg\r\nwget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -\r\necho \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list\r\nsudo apt-get update\r\nsudo apt-get install -y mongodb-org\r\n```\r\n\r\n```bash\r\nsudo systemctl start mongod\r\nsudo systemctl enable mongod\r\n```\r\n\r\nãã®ä»–ã€ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’è½ã¨ã—ã¦ãã‚‹`git`ãªã©ã‚’å…¥ã‚Œã¾ã™\r\n\r\n```bash\r\nsudo apt -y install redis git build-essential nginx ssl-cert letsencrypt ffmpeg\r\n```\r\n\r\n#### è¿½è¨˜ 2023/08/13 MongoDB ãŒ Ubuntu 22.04 ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„\r\nã©ã†ã‚„ã‚‰å¿…è¦ãª`libssl`ãŒ`22.04`ã‹ã‚‰åŒæ¢±ã•ã‚Œãªããªã£ãŸã¿ãŸã„...  \r\nå–ã‚Šã‚ãˆãšå…¥ã‚Œã‚‹ã“ã¨ã§å›é¿ã™ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚\r\n\r\nhttps://stackoverflow.com/questions/73656873\r\n\r\n```bash\r\nsudo wget http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2_amd64.deb\r\nsudo dpkg -i libssl1.1_1.1.1f-1ubuntu2_amd64.deb\r\n```\r\n\r\n### ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ˆgit cloneï¼‰ã—ã¦ãã‚‹\r\nã¾ãš Misskey ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆã¦ã€\r\n\r\n```bash\r\nsudo su - misskey\r\n```\r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚ä»Šå›ã¯è‡ªåˆ†ã®ãƒªãƒã‚¸ãƒˆãƒªã®ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™  \r\nï¼ˆ`takusan_23-diary`ã¨`https://github.com/takusan23/misskey`ã¯å„è‡ªå¤‰ãˆã¦ã­ï¼‰\r\n\r\n```bash\r\ngit clone -b takusan_23-diary https://github.com/takusan23/misskey\r\n```\r\n\r\nã‚¯ãƒ­ãƒ¼ãƒ³ã—ãŸãƒ•ã‚©ãƒ«ãƒ€ã¸ç§»å‹•ã—ã¾ã™\r\n\r\n```bash\r\ncd ~/misskey\r\n```\r\n\r\nã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦ã€è‡ªåˆ†ã®ç’°å¢ƒç”¨ã«ç›´ã—ã¾ã™\r\n\r\n```bash\r\ncp .config/example.yml .config/default.yml\r\nvim .config/default.yml\r\n```\r\n\r\nãã—ãŸã‚‰ã€`url`ã‚’ç›´ã—ã¦ã€`mongodb`ã®`user`/`pass`ã€`redis`ã®`pass`ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã—ã¾ã™ã€‚  \r\nä»¥ä¸‹ã¯ä¾‹ã§ã™ã€‚ã“ã‚Œä»¥é™ã®éƒ¨åˆ†ã¯ã„ã˜ã‚Šã¾ã›ã‚“ã€‚ï¼ˆå¾Œã§ã„ã˜ã‚Šã¾ã™ãŒï¼‰\r\n\r\n```yml\r\n# Final accessible URL seen by a user.\r\nurl: https://diary.negitoro.dev/\r\n\r\n# Listen port\r\nport: 3000\r\n\r\n# Listen address (default is probably any)\r\n# addr: '127.0.0.0'\r\n\r\nmongodb:\r\n  host: localhost\r\n  port: 27017\r\n  db: misskey\r\n  #user: example-misskey-user\r\n  #pass: example-misskey-pass\r\n  #options:\r\n  #  poolSize: 10\r\n\r\n# Redis\r\nredis:\r\n  host: localhost\r\n  port: 6379\r\n  #family: 0 # 0=Both, 4=IPv4, 6=IPv6\r\n  #pass: example-pass\r\n  #prefix: example-prefix\r\n  #db: 0\r\n```\r\n\r\nç·¨é›†ãŒçµ‚ã‚ã£ãŸã‚‰ä¿å­˜ã—ã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã€‚  \r\nãƒ“ãƒ«ãƒ‰ã‚’ã—ã¾ã™ã€‚\r\n\r\nã‚¹ãƒšãƒƒã‚¯ãŒä½ã„ã®ã§ã€ã—ã°ã‚‰ãæ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™\r\n\r\n```bash\r\nNODE_ENV=production pnpm i\r\nNODE_ENV=production pnpm build\r\n```\r\n\r\nç„¡äº‹æˆåŠŸã—ãŸã‚‰ã€æˆ»ã‚Šã¾ã™\r\n\r\n```bash\r\nexit\r\n```\r\n\r\n## nginx ã®è¨­å®š\r\nMisskey ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å ´åˆã¯æˆ»ã£ã¦ãã ã•ã„ï¼ˆ`exit`ï¼‰  \r\n`whoami`ã‚’å©ãã¨ä»Šèª°ãªã®ã‹ã‚ã‹ã‚Šã¾ã™ã€‚\r\n\r\n### ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼\r\nç§ã‚‚ã‚ã‹ã‚“ãªã„ã‚“ã§ã™ã‘ã©ã€å¤šåˆ†ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’ä½¿ã†ã®ãŒæ­£è§£ã‚‰ã—ã„ãƒ»ãƒ»ãƒ»\r\n\r\n```bash\r\nsudo cp ~misskey/misskey/docs/examples/misskey.nginx /etc/nginx/sites-enabled/\r\nsudo vim /etc/nginx/sites-enabled/misskey.nginx\r\n```\r\n\r\nã¾ãŸ`vim`ãŒé–‹ãã®ã§ã€`example.tld`ã«ãªã£ã¦ã„ã‚‹éƒ¨åˆ†ã‚’è‡ªåˆ†ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ç›´ã—ã¾ã™ã€‚å¤šåˆ†äºŒç®‡æ‰€ãã‚‰ã„ã ã¨æ€ã†\r\n\r\n`server_name example.tld`ã‚’`server_name diary.negitoro.dev`ã«ã™ã‚‹æ„Ÿã˜ã§ã™ï¼ˆè‡ªåˆ†ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã­ï¼ï¼‰\r\n\r\nã§ããŸã‚‰ä¿å­˜ã—ã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã£ã¦ãã¦ãã ã•ã„ã€‚  \r\n`nginx`ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™\r\n\r\n```bash\r\nsudo service nginx reload\r\n```\r\n\r\n## Misskey èµ·å‹•\r\n\r\n### Misskey ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆã¾ã™\r\n\r\n```bash\r\nsudo su - misskey\r\n```\r\n\r\n### ã‚µãƒ¼ãƒãƒ¼ãŠè©¦ã—èµ·å‹•\r\n\r\næ¬¡ã«ã€`Misskey ã‚µãƒ¼ãƒãƒ¼`ãŒèµ·å‹•ã§ãã‚‹ã‹è©¦ã—ã¦ã¿ã¾ã™ã€‚\r\n\r\n```bash\r\ncd ~/misskey\r\npnpm start\r\n```\r\n\r\nå¤šåˆ†ã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆã¿ãŸã„ãªã®ãŒå‡ºã‚‹ã¯ãšã€‚\r\n\r\nèµ·å‹•ã§ããŸã‚‰ï¼ˆ`listen 3000 ï½`ï¼‰æ­¢ã‚ã¾ã™  \r\n`Ctrl + C`åŒæ™‚æŠ¼ã—ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã£ã¦ã“ã‚‰ã‚Œã‚‹ã¯ãšã€‚\r\n\r\nãã—ãŸã‚‰ã¾ãŸãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’æˆ»ã—ã¦ãã ã•ã„\r\n\r\n```bash\r\nexit\r\n```\r\n\r\n## è‡ªå‹•èµ·å‹•ã®è¨­å®š\r\n`Windows`ã®ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—ã¿ãŸã„ãª\r\n\r\n### ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’æ›¸ã\r\nã¨è¨€ã£ã¦ã‚‚ã“ã‚Œã¯å…¨éƒ¨ã‚³ãƒ”ãƒ¼ã§ãã‚‹ã‚„ã¤ã§ã™ã€‚\r\n\r\n```bash\r\nsudo cp ~misskey/misskey/docs/examples/misskey.service /etc/systemd/system/\r\nsudo systemctl daemon-reload\r\nsudo systemctl enable misskey\r\nsudo systemctl start misskey\r\nsudo systemctl status misskey\r\n```\r\n\r\næœ€å¾Œã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨ã€ã•ã£ãã¿ãŸã„ãªã‚¢ã‚¹ã‚­ãƒ¼ã‚¢ãƒ¼ãƒˆï¼ˆæ¬ ã‘ã¦ã‚‹ã‹ã‚‚ï¼‰ãŒå‡ºã¦ã„ã‚‹ã¯ãšã€‚  \r\nå‡ºã¦ç„¡ãã¦ã‚‚ãƒ­ã‚°ãŒå‡ºã¦ã„ã‚Œã°æˆåŠŸãªã¯ãšã€‚  \r\n`INFO *  [core boot]     Welcome to Meisskey!`  \r\nã¨ã‹  \r\n`INFO *  [core boot]     Meisskey v10.xxxxxxx`  \r\nã¨ã‹ï¼Ÿå‡ºã¦ã„ã‚Œã° OK ãªã¯ãš\r\n\r\n## DNS ã®è¨­å®š\r\nIPã‚¢ãƒ‰ãƒ¬ã‚¹ã¨ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç´ä»˜ã‘ã¾ã™\r\n\r\n### ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã®Aãƒ¬ã‚³ãƒ¼ãƒ‰ã« VPS ã® IP ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã¾ã™\r\n`IPv6`ã®è¨­å®šãŒå¿…è¦ãªã®ã‹ã¯ä¸æ˜ï¼ˆå¾Œè¿°ã™ã‚‹`Let's Encrypt / Certbot`ã¯`IPv4`ã ã‘ã§ã„ã„ã¯ãšï¼‰\r\n\r\n`Google Domains`ãªã‚‰`DNS`ã®é …ç›®ã§ã€æ–°ã—ã„ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€‚  \r\n`IPv4`ãªã®ã§`Aãƒ¬ã‚³ãƒ¼ãƒ‰`ã§ã€ä½¿ã„ãŸã„ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ã€`VPS`ã®`IPv4`ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’æŒ‡å®šã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/cc5Ajf7.png)\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/KOd6RpP.png)\r\n\r\n### åæ˜ ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤\r\n`nslookup`ã¨ã‹ã—ã¦ã€ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã‚‰`IPã‚¢ãƒ‰ãƒ¬ã‚¹`ã‚’å¼•ã‘ã‚‹ã‚ˆã†ã«ãªã‚‹ã¾ã§å¾…ã¡ã¾ã™  \r\nãªãŠã€`Misskey`ã¯`https`ã§ãªã„ã¨æ¥ç¶šã§ããªã„ã‚‰ã—ãã€ã¾ã URLã‚’å…¥åŠ›ã—ã¦ã‚‚é–‹ã‘ãªã„ã¯ãšã€‚\r\n\r\n## SSL ã®è¨­å®šï¼ˆhttps ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰\r\n`Cloudflare`ä½¿ãˆã‚‹å ´åˆã¯ã‚‚ã£ã¨ã„ã„æ–¹æ³•ãŒã‚ã‚‹ã¯ãš\r\n\r\n### Certbot / Let\r\nã“ã“ã‹ã‚‰ã€`Nginx`ã¨`Ubuntu 20`ã‚’é¸ã³ã¾ã™ã€‚  \r\n\r\nhttps://certbot.eff.org/\r\n\r\n![Imgur](https://imgur.com/i6DlDJR.png)\r\n\r\nã‚‚ã—å†…å®¹ãŒãŠã‹ã—ã‹ã£ãŸã‚‰â†‘ãŒæ­£ã—ã„ã§ã™\r\n\r\nã¾ãšã¯`snap`ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãƒãƒãƒ¼ã‚¸ãƒ£ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```bash\r\nsudo snap install core; sudo snap refresh core\r\n```\r\n\r\nã„ã‚ŒãŸã‚‰ã€ä¸€å¿œæ—¢ã«å…¥ã£ã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§`certbot`ã‚’æ¶ˆã—ã¾ã™ã€‚  \r\n`snap`çµŒç”±ã§å…¥ã‚Œãªã„ã¨ã„ã‘ãªã„ã®ã§ã€`apt`ã¨ã‹ã§æ—¢ã«å…¥ã£ã¦ã„ã‚Œã°æ¶ˆã—ã¡ã‚ƒã„ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo apt remove certbot\r\ncertbot --version\r\n```\r\n\r\n`certbot --version`ã§ã‚¨ãƒ©ãƒ¼ãŒå¸°ã£ã¦ãã‚Œã°æˆåŠŸï¼ˆ`bin`ã«`certbot`ãªã‚“ã¦å­˜åœ¨ã—ã­ãˆã‚ˆï¼çš„ãªï¼‰\r\n\r\næ¬¡ã¯`snap`çµŒç”±ã§`certbot`ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```bash\r\nsudo snap install --classic certbot\r\nsudo ln -s /snap/bin/certbot /usr/bin/certbot\r\n```\r\n\r\nãã—ãŸã‚‰ã¤ã„ã«`https`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«`nginx`ã‚’æ§‹æˆã—ã¾ã™ã€‚  \r\nã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹ã®ã§ã™ãŒã€å¤šåˆ†`Misskey`ã«å½±éŸ¿ãªã„çŠ¶æ…‹ã§æ›¸ãæ›ãˆã¦ãã‚Œã¾ã™ã€‚\r\n\r\n```bash\r\nsudo certbot --nginx\r\n```\r\n\r\nã“ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ãŸå¾Œã«ä»¥ä¸‹ã®ã“ã¨ãŒèã‹ã‚Œã¾ã™\r\n- ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹\r\n    - `SSL`è¨¼æ˜æ›¸ã®æ›´æ–°ãŒå‡ºæ¥ãªã‹ã£ãŸã‚‰é€šçŸ¥ãŒæ¥ã‚‹ï¼Ÿ\r\n        - `https`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ããªããªã£ã¦ã—ã¾ã†ã®ã§ãƒ¡ãƒ¼ãƒ«ã§æ•™ãˆã¦ãã‚Œã‚‹ãã†\r\n- åˆ©ç”¨è¦ç´„ã«åŒæ„ã™ã‚‹ã‹\r\n- ãƒ‹ãƒ¥ãƒ¼ã‚¹ãƒ¬ã‚¿ãƒ¼ã‚’å¸Œæœ›ã™ã‚‹ã‹ï¼ˆNo ã§ã„ã„ã¯ãšï¼‰\r\n- `https`ã«ã—ãŸã„ãƒ‰ãƒ¡ã‚¤ãƒ³ã®æœ€çµ‚ç¢ºèªï¼ˆ`nginx`ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’æ¢ã—ã¦ãã‚Œã‚‹ãã†ï¼‰\r\n\r\n![Imgur](https://imgur.com/ry5LjDy.png)\r\n\r\n![Imgur](https://imgur.com/DFgIOOh.png)\r\n\r\nã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã½ã¡ã½ã¡ã—ã¦ãŸã‚‰`https`åŒ–ä½œæ¥­çµ‚ã‚ã£ãŸã€‚ç¥ã ã‚ã“ã‚Œ\r\n\r\n### è‡ªå‹•æ›´æ–°ãŒã§ãã‚‹ã‹ç¢ºèª\r\nã©ã†ã‚„ã‚‰è‡ªå‹•çš„ã«è‡ªå‹•æ›´æ–°ã®`cron ?`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‚‰ã—ãã€è‡ªå‰ã§`cron`ã‚’ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã—ã¦ãŠãå¿…è¦ã‚‚ç„¡ã„ã‚‰ã—ã„ã€‚  \r\nãŸã ã€æˆåŠŸã™ã‚‹ã‹ã¯ã‚ã‹ã‚‰ãªã„ã®ã§ã€ãŠè©¦ã—æ›´æ–°æ©Ÿèƒ½ã‚’ä½¿ã„æœ¬å½“ã«æ›´æ–°ã§ãã‚‹ã‹è©¦ã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo certbot renew --dry-run\r\n```\r\n\r\n`--dry-run`ã—ãªã„ã¨æ›´æ–°ã•ã‚Œã¦ã—ã¾ã†ï¼ˆãã‚‚ãã‚‚æœ‰åŠ¹æœŸé™ãŒååˆ†æ®‹ã£ã¦ã„ã‚‹ã¨æ›´æ–°ã§ããªã„ï¼‰\r\n\r\n![Imgur](https://imgur.com/J8E7lYf.png)\r\n\r\næˆåŠŸã™ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¯ãšã€‚\r\n\r\n## Misskey é–‹ã‘ã‚‹ï¼Ÿ\r\n`https://ãƒ‰ãƒ¡ã‚¤ãƒ³`ã§é–‹ã‘ã‚‹ã¯ãšã€‚  \r\n\r\n![Imgur](https://imgur.com/ZiolQ3B.png)\r\n\r\nã¡ã‚ƒã‚“ã¨`https`ã§ã€éµãƒãƒ¼ã‚¯ã‚‚ä»˜ã„ã¦ã„ã¾ã™ï¼ï¼ï¼ï¼  \r\n\r\nä¸€ç•ªä¹—ã‚Šã§ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œã‚‹ã¨ç®¡ç†è€…ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¨ã—ã¦ãƒãƒ¼ã‚¯ã•ã‚Œï¼ˆã‚³ãƒ³ãƒ•ã‚£ã‚°ã§å¤‰æ›´å¯èƒ½ï¼Ÿï¼‰ã€ç®¡ç†ç”»é¢ã«å…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/pHi7FqG.png)\r\n\r\n## ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è¨­å®š\r\n`Misskey`ã®æŠ•ç¨¿ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã¯ã€å¾Œã‹ã‚‰URLã‚’å¤‰æ›´ã§ããªã„ãŸã‚ã€ã‚„ã‚‹ãªã‚‰å»ºã¦ãŸä»Šã—ã‹ãªã„ï¼  \r\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã¯`VPS`ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«æ›¸ãè¾¼ã¾ã‚Œã¾ã™ãŒã€`VPS`ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯é«˜ã„ã®ã¨æ‹¡å¼µãŒé¢å€’ãªã®ã§ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã†ã®ãŒè‰¯ã„ã¯ãšï¼ˆå®¹é‡å¢—ã‚„ã—æ”¾é¡Œã ã‘ã©ãŠé‡‘ã‚‚ã‹ã‹ã‚‹ã‚ˆï¼‰ã€‚\r\n\r\nå‚è€ƒï¼š  \r\nhttps://docs.aws.amazon.com/ja_jp/AmazonS3/latest/userguide/HostingWebsiteOnS3Setup.html#step4-add-bucket-policy-make-content-public\r\n\r\n### AWS ã® S3 ã‚’ä½¿ã„ã¾ã™\r\nãŸã ã€ã“ã‚Œã¡ã‚‡ã£ã¨é«˜ã„ï¼ˆãªã‚“ã‹è»¢é€é‡ã¨ãƒªã‚¯ã‚¨ã‚¹ãƒˆå›æ•°ã«èª²é‡‘ã•ã‚Œã‚‹ã‚„ã‚„ã“ã—ã„ï¼‰ã®ã§ã€`S3 äº’æ›ã‚µãƒ¼ãƒ“ã‚¹`ã‚’ä½¿ã†ã®ã‚‚è€ƒãˆãŸã»ã†ãŒè‰¯ã•ãã†ã€‚  \r\nä»Šå›ã¯ä»Šå¾Œã®ã“ã¨ã‚’è€ƒãˆã€`S3 äº’æ›ã‚µãƒ¼ãƒ“ã‚¹`ã«ç§»è¡Œã§ãã‚‹ã‚ˆã†ãªè¨­è¨ˆã«ã‚‚ã—ã¦ã¿ã¾ã™ã€‚\r\n\r\nã¨ã„ã†ã‚ã‘ã§`S3`ã®ãƒã‚±ãƒƒãƒˆã‚’ä½œã‚Šã¾ã™ã€‚  \r\nåå‰ã¨ã‹ã¯ã‚ˆã—ãªã«...\r\n\r\n![Imgur](https://imgur.com/9Wlwx4A.png)\r\n\r\nä¸‹ã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€ãƒ‘ãƒ–ãƒªãƒƒã‚¯ã‚¢ã‚¯ã‚»ã‚¹ã®é …ç›®ã§å¤–ã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\nã¾ã ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ã‚’æ›¸ã„ã¦ã„ãªã„ã®ã§ã‚¢ã‚¯ã‚»ã‚¹ã¯å‡ºæ¥ãªã„ã¨æ€ã„ã¾ã™ãŒ...\r\n\r\n![Imgur](https://imgur.com/ogrkowi.png)\r\n\r\nã“ã‚Œã§ä½œæˆã—ã¾ã™ã€‚\r\n\r\n### ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼ ã‚’æ›¸ã\r\nä½œã£ãŸãƒã‚±ãƒƒãƒˆã‚’é–‹ã„ã¦ã€`ã‚¢ã‚¯ã‚»ã‚¹è¨±å¯`ã«é€²ã¿ã€`ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼`ã‚’ç·¨é›†ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/6mF1MxS.png)\r\n\r\n\r\n```json\r\n{\r\n    \"Version\": \"2012-10-17\",\r\n    \"Statement\": [\r\n        {\r\n            \"Sid\": \"PublicReadGetObject\",\r\n            \"Effect\": \"Allow\",\r\n            \"Principal\": \"*\",\r\n            \"Action\": [\r\n                \"s3:GetObject\"\r\n            ],\r\n            \"Resource\": [\r\n                \"arn:aws:s3:::ä½œã£ãŸãƒã‚±ãƒƒãƒˆã®åå‰/*\"\r\n            ]\r\n        }\r\n    ]\r\n}\r\n```\r\n\r\n## API ã§ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ãŸã‚ã€ã‚­ãƒ¼ã‚’ IAM ã§æ‰•ã„å‡ºã—ã¦ã‚‚ã‚‰ã†\r\n`S3`ã«`API`ã§æ“ä½œã™ã‚‹ã«ã¯ã€`IAM`ã§èªå¯æƒ…å ±ã‚’ä½œã£ã¦è²°ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\n### IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä½œæˆ\r\n\r\n`IAM`ã®ç”»é¢ã‚’é–‹ã„ã¦ã€é©å½“ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚’ä½œã‚Šã¾ã™ã€\r\n\r\n![Imgur](https://imgur.com/xSjT5HT.png)\r\n\r\næ¬¡ã®ç”»é¢ã§å‡ºã¦ãã‚‹æ¨©é™ã®ã¨ã“ã‚ã§ã¯ã€`AmazonS3FullAccess`ã‚’ã¤ã‘ã¦ãŠã‘ã°è‰¯ã•ãã†\r\n\r\n![Imgur](https://imgur.com/1gRN1XG.png)\r\n\r\n### ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã‚’æ‰•ã„å‡ºã—ã¦ã‚‚ã‚‰ã†\r\n\r\nä½œã£ãŸ`IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼`ã®è©³ç´°ã‚’é–‹ã„ã¦ã€`ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼`ã®ä½œæˆã‚’ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/qXAayIK.png)\r\n\r\n`Misskey`ã§å¿…è¦ãªã®ã¯ä¸€ç•ªä¸‹ã®`ãã®ä»–`ã®é …ç›®ã®ã‚„ã¤ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/XRymShw.png)\r\n\r\n2ã¤å‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/7r828eY.png)\r\n\r\n### ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è¨­å®šã‚’ã‚³ãƒ³ãƒ•ã‚£ã‚°ã«è¨˜è¿°ã™ã‚‹\r\n**v13 ã§ã¯ Web UI ã‹ã‚‰ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®è¨­å®šãŒã§ãã¾ã™**  \r\n\r\nã¾ãš`Misskey`ã‚’æ­¢ã‚ã¦\r\n\r\n```bash\r\nsudo systemctl stop misskey\r\n```\r\n\r\n`Misskey`ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«åˆ‡ã‚Šæ›¿ãˆã¦ã€ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’æ›´æ–°ã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo su - misskey\r\ncd ~/misskey\r\nvim .config/default.yml\r\n```\r\n\r\nãã—ãŸã‚‰ã€ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ ã«æ›¸ãè¾¼ã‚€è¨­å®šã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼ˆ`#`ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã§ãã‚‹ï¼‰ã—ã¦ã€  \r\nã¡ã‚‡ã£ã¨ä¸‹ã«ã‚ã‚‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç”¨ã®è¨­å®šã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n```yml\r\n\r\n### drive ###\r\n#drive:\r\n#  storage: 'fs' # ã“ã“ã‚’ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã™ã‚‹\r\n\r\n# OR\r\n#drive:\r\n#  storage: 'db'\r\n\r\n# OR\r\ndrive:\r\n  storage: 'minio' # ã“ã“ã¯è²·ãˆãªãã¦è‰¯ã„ã¯ãš\r\n  bucket: 'xxxxxxxx' # ãƒã‚±ãƒƒãƒˆåã§ã™\r\n  prefix: 'files' # ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚‹ãªã‚‰\r\n  baseUrl: 'https://diary.negitoro.dev/objectstorage' # nginx ã®ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã™ã‚‹ URL\r\n  config:\r\n    endPoint: '' # S3 ã®å ´åˆã¯ç©ºæ–‡å­—ã€‚S3 äº’æ›ã‚µãƒ¼ãƒ“ã‚¹ãªã‚‰å…¥ã‚Œã‚‹\r\n    region: 'ap-northeast-1' # ãƒã‚±ãƒƒãƒˆã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³\r\n    useSSL: true\r\n    accessKey: 'xxxx' # IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼\r\n    secretKey: 'xxxx' # IAM ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚­ãƒ¼ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼\r\n    useProxy: true\r\n    setPublicRead: false\r\n    s3ForcePathStyle: true\r\n```\r\n\r\nã‚‚ã—ã€ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã—ãªã„å ´åˆï¼ˆ`S3`ã®å…¬é–‹URLã‚’ãã®ã¾ã¾ä½¿ã†å ´åˆï¼‰ã¯ã€`baseUrl`ã¯`https://s3.ap-northeast-1.amazonaws.com/ãƒã‚±ãƒƒãƒˆå`ã«ãªã‚‹ã¯ãšã§ã™ã€‚  \r\nãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ãŒå¿…è¦ã‹ã©ã†ã‹ã¯`S3`ä»¥å¤–ã‚’ä½¿ã†äºˆå®šãŒã‚ã‚‹ã‹ã©ã†ã‹ã§æ±ºã¾ã‚Šã¾ã™ã€‚è©³ã—ãã¯ â†“ ã§ã€‚  \r\n\r\n`CloudFront`ã‚’çµŒç”±ã™ã‚‹ã¨ã‹ã€å¾Œè¿°ã™ã‚‹`nginx`ã‚’çµŒç”±ã™ã‚‹è¨­è¨ˆã®å ´åˆã¯`baseUrl`ãŒå¤‰ã‚ã‚‹ã¯ãš  \r\n\r\nå¾Œã¯ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’é–‰ã˜ã¦ã€ãŠã¾ã˜ãªã„ç¨‹åº¦ã«ãƒ“ãƒ«ãƒ‰ã—ã¦ãŠãã¾ã—ãŸï¼ˆå¿…è¦ã‹ã©ã†ã‹ã¯ä¸æ˜ï¼‰\r\n\r\n```bash\r\nNODE_ENV=production pnpm build\r\nexit\r\n```\r\n\r\n`Misskey`èµ·å‹•ã•ã›ã¾ã™\r\n\r\n```bash\r\nsudo systemctl start misskey\r\n```\r\n\r\n## ãƒ¡ãƒ‡ã‚£ã‚¢ã®URLã‚’ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã™ã‚‹ï¼ˆnginx ã‚’çµŒç”±ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼‰\r\nå…ˆè¿°ã®é€šã‚Š`S3`ä»¥å¤–ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«å¼•ã£è¶Šã—ã§ãã‚‹ã‚ˆã†ã«ã€ãƒ¡ãƒ‡ã‚£ã‚¢ã®URLã§ã¯`S3`ã®`å¤–éƒ¨å…¬é–‹ç”¨URL`ã‚’ä½¿ã‚ãªã„ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\nä»£ã‚ã‚Šã«ã€ãƒ¡ãƒ‡ã‚£ã‚¢ã®URLã‚’ç”¨æ„ã—ã¦ï¼ˆ`https://ãƒ‰ãƒ¡ã‚¤ãƒ³/objectstorage/xxxxx`ï¼‰ã€`/objectstorage`ã«æ¥ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯ã™ã¹ã¦`nginx`ã‚’ä½¿ã„`S3`ã®URLã«å‘ãå…ˆã‚’å¤‰ãˆã‚‹ã‚ˆã†ã«ã—ã¾ã™ï¼ˆãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ï¼‰\r\n\r\n```plaintext\r\nã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ ( PC / ã‚¹ãƒãƒ› ç­‰ )\r\n\r\nâ†“ ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n\r\nnginx ãŒå¾…ã¡å—ã‘ã‚‹\r\n\r\nâ†“\r\n\r\nã‚‚ã— URL ãŒ /objectstorage ã ã£ãŸã‚‰ ---> [S3 ã®å¤–éƒ¨å…¬é–‹ç”¨URLã¸ã‚¢ã‚¯ã‚»ã‚¹] \r\nãã‚Œä»¥å¤– / ã ã£ãŸã‚‰ ---> [Misskey ã‚µãƒ¼ãƒãƒ¼]\r\n```\r\n\r\næœ¬å½“ï¼ˆã¨ã„ã†ã‹ä»–ã®ã‚µãƒ¼ãƒãƒ¼ã ã¨ï¼‰ã¯ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ç”¨ã®ãƒ‰ãƒ¡ã‚¤ãƒ³ã€`files.ãƒ‰ãƒ¡ã‚¤ãƒ³`ã¿ãŸã„ãªã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç”¨æ„ã—ã¦ã€`S3 + CloudFront`ã¨ã‹ã§å…¬é–‹ã—ã¦ã€`CNAME`ã§`CloudFront`ã‚’æŒ‡ã™ã‚ˆã†ã«ã™ã‚‹ã®ãŒè‰¯ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚  \r\nï¼ˆä½•è¨€ã£ã¦ã‚‹ã‹åˆ†ã‹ã‚‰ã‚“ã¨æ€ã†ã‘ã©ãƒ»ãƒ»ãƒ»ï¼‰\r\n\r\n### nginx ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’ã„ã˜ã‚‹\r\nã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo vim sudo cat /etc/nginx/sites-enabled/misskey.nginx\r\n```\r\n\r\nãã—ãŸã‚‰ã€`/objectstorage`ã«æ¥ãŸãƒªã‚¯ã‚¨ã‚¹ãƒˆã¯`S3`ã®URLã¸ãƒªãƒãƒ¼ã‚¹ãƒ—ãƒ­ã‚­ã‚·ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\nURL ã¯éƒ½åº¦è²·ãˆã¦ãã ã•ã„ã€‚\r\n\r\nã‚ˆãçŸ¥ã‚‰ãªã„ã‘ã©ã€`location /`ã®ä¸Šã«æ›¸ã„ã¦ãŠã‘ã°ã‚ˆã„ã®ã‹ãªï¼Ÿ  \r\n\r\n`nginx server { } 443` ã®æ–¹ã§ã™\r\n\r\n```config\r\n\r\n# Media file storage is AWS S3.\r\n# Use nginx proxy in AWS S3 to Internet transfer.\r\n# thats because, Cant edit media file url.\r\nlocation /objectstorage {\r\n    proxy_pass https://s3.ap-northeast-1.amazonaws.com/ãƒã‚±ãƒƒãƒˆå;\r\n}\r\n\r\n# Proxy to Node\r\nlocation / {\r\n    proxy_pass http://127.0.0.1:3000;\r\n    proxy_set_header Host $host;\r\n```\r\n\r\n![Imgur](https://imgur.com/FNcgOxb.png)\r\n\r\nãã—ãŸã‚‰ä¿å­˜ã—ã¦ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«æˆ»ã£ã¦ã€`nginx`ã¸é©ç”¨ã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo systemctl restart nginx\r\n```\r\n\r\n### å‹•ä½œç¢ºèª\r\nå®Ÿéš›ã«`Misskey`ã®ãƒ‰ãƒ©ã‚¤ãƒ–ã«ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŠ•ã’ã¦ã€`S3`ã«ä¸ŠãŒã£ã¦ã„ã‚Œã°æˆåŠŸã§ã™ã€‚  \r\nURL ãŒ `/objectstorage`ã§å§‹ã¾ã£ã¦ã„ã‚Œã°ã†ã¾ãè¡Œã£ã¦ã¾ã™ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/1JfWkc5.png)\r\n\r\n![Imgur](https://imgur.com/T4a1855.png)\r\n\r\n![Imgur](https://imgur.com/QykrHbN.png)\r\n\r\n## ãŠç–²ã‚Œæ§˜ã§ã—ãŸï¼ï¼ï¼\r\nå¤šåˆ†ã“ã‚Œã§æ§‹ç¯‰ã¯è‰¯ã„ã¯ãšã€‚\r\n\r\nã‚ã¨ã¯é©å½“ã«ãƒ¡ãƒ¢ã‚’æ®‹ã—ã¦ãŠãã¾ã™ã€‚\r\n\r\n### ãŠã™ã™ã‚è¨­å®šï¼Ÿ\r\nç®¡ç†ç”»é¢ã‹ã‚‰å‡ºæ¥ã¾ã™\r\n\r\n- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ã®å—ä»˜ã‚’åœæ­¢ã™ã‚‹ ã‚’ ON\r\n    - ãŠä¸€äººæ§˜ãªã®ã§\r\n- ãƒªãƒ¢ãƒ¼ãƒˆã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã™ã‚‹ ã¯ OFF\r\n    - å¤šåˆ†ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ OFF\r\n\r\n### Misskey ã‚µãƒ¼ãƒãƒ¼ã® åœæ­¢ é–‹å§‹ å†èµ·å‹•\r\n\r\n- é–‹å§‹\r\n    - `sudo systemctl start misskey`\r\n- åœæ­¢\r\n    - `sudo systemctl stop misskey`\r\n- å†èµ·å‹•\r\n    - `sudo systemctl restart misskey`\r\n\r\n### æœ¬ä½“æ›´æ–°æ–¹æ³•\r\nãƒ•ã‚©ãƒ¼ã‚¯ã—ãŸã®ã§æœ¬å®¶ã«è¿½å¾“ã™ã‚‹ã«ã¯ã¾ãš`git rebase`ã¨ã‹ã‚„ã£ã¦æ›´æ–°ã‚’å–ã‚Šè¾¼ã‚€å¿…è¦ãŒã‚ã‚‹  \r\nã“ã£ã¡ã«æ›¸ã„ãŸ\r\n\r\nhttps://github.com/takusan23/misskey#å¤‰æ›´ã‚’æœ¬ç•ªã«å…¥ã‚Œã‚‹æœ¬ç•ªæ›´æ–°æ‰‹é †\r\n\r\n### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—\r\n**ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹**ã‚’å¹ã£é£›ã°ã™ã¨åŒã˜ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã‚µãƒ¼ãƒãƒ¼ã‚’å»ºã¦ã‚‰ã‚Œãªã„ã‚‰ã—ã„ï¼Ÿã®ã§ã€å®šæœŸçš„ã«ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™  \r\n\r\nã¾ãšã¯`Misskey`ã‚’æ­¢ã‚ã¾ã™\r\n\r\n```bash\r\nsudo systemctl stop misskey\r\n```\r\n\r\næ¬¡ã«ã€`Misskey`ã§åˆ©ç”¨ã—ã¦ã„ã‚‹`MongoDB`ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã‚Šã¾ã™ã€‚  \r\nä»Šå›ã¯ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚`dump`ãƒ•ã‚©ãƒ«ãƒ€ãŒå‡ºæ¥ã¾ã™ã€‚  \r\nï¼ˆãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ `~`â†ãƒãƒ«ãƒ€ ã§ç§»å‹•ã§ãã¾ã™ï¼‰\r\n\r\n```bash\r\ncd ~\r\nmongodump -o \"./dump\"\r\n```\r\n\r\n**æ¬¡ã«ã€PowerShell ã‚’é–‹ãï¼ˆSSH ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¨ã¯åˆ¥ã«ï¼‰**ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦æ‰‹å…ƒã® Windows ãƒã‚·ãƒ³ã¸ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’è»¢é€ã—ã¾ã™ã€‚  \r\n`scp`ã‚³ãƒãƒ³ãƒ‰ã§ã™ã€‚\r\n\r\n```shell\r\nscp -i {éµã®ãƒ‘ã‚¹} -r {ãƒªãƒ¢ãƒ¼ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼å}@{IPã‚¢ãƒ‰ãƒ¬ã‚¹}:{ãƒ•ã‚©ãƒ«ãƒ€ã®ãƒ‘ã‚¹} {ãƒ­ãƒ¼ã‚«ãƒ«ã®Windowsãƒã‚·ãƒ³ã®ä¿å­˜å…ˆãƒ‘ã‚¹}\r\n```\r\n\r\nä¾‹ã§ã™\r\n\r\n```shell\r\nscp -i C:\\Users\\takusan23\\key.pem -r ubuntu@000.000.000.000:~/dump C:\\Users\\takusan23\\misskey_backup\\\r\n```\r\n\r\nã“ã‚Œã§ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼åã®ãƒ•ã‚©ãƒ«ãƒ€ã®ã¨ã“ã‚ã«ã‚ã‚‹ã¯ãšï¼ˆ`C:\\Users\\takusan23` ã¿ãŸã„ãªï¼‰\r\n\r\nå¾Œã¯ã“ã‚Œã‚’`zip`ã¨ã‹ã«ã—ã¦å®‰å…¨ãªã¨ã“ã‚ã«ä¿å­˜ã—ã¦ãŠãã¾ã™ï¼ˆ Google Drive ã¨ã‹ï¼Ÿ AWS S3 Glacier ã¨ã‹ï¼Ÿ ï¼‰\r\n\r\n### Misskey ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ãŸã„ï¼ˆVPS ã§ã¯ãªãã€æ‰‹å…ƒã® Windows ã§ Misskey ã‚’æ§‹ç¯‰ã—ãŸã„ï¼‰\r\næ›¸ã„ãŸã€‚`v10`ãªã®ã§`v13`ã ã¨ç›´ã•ãªã„ã¨ä½¿ãˆãªã„\r\n\r\nhttps://github.com/takusan23/misskey#æ‰‹å…ƒã®é–‹ç™ºç’°å¢ƒæ§‹ç¯‰\r\n\r\n### 2023/08/06 è¿½è¨˜ Cloudflare ã‚’åˆ©ç”¨ã—ã¦ Misskey ã‚µãƒ¼ãƒãƒ¼ã‚’ä¿è­·ã™ã‚‹ï¼Ÿ\r\n`Certbot`ã§`HTTPS`é€šä¿¡ã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸãŒã€`Misskey`çš„ã«ã¯`Cloudflare`ã§`SSL (HTTPS)`ã™ã‚‹ã®ãŒè‰¯ã„ã‚‰ã—ã„ã€‚  \r\n\r\nã‚ã‚‰ã‹ã˜ã‚ã€`Cloudflare`ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ç§»ç®¡ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆã„ã‚„`Cloudflare DNS`ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ï¼‰\r\n\r\nã¾ãšã¯`Cloudflare ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰`ã‹ã‚‰`Webã‚µã‚¤ãƒˆ`ã‚’é¸ã³ã€ç¨¼åƒã—ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é¸ã³ã¾ã™ã€‚  \r\nãã—ã¦`SSL/TLS`ã‚’æŠ¼ã—ã¦ã€`æ¦‚è¦`ã®`æš—å·åŒ–ãƒ¢ãƒ¼ãƒ‰`ã‚’`ãƒ•ãƒ«`ã«ã—ã¾ã™ã€‚ä¸å…·åˆã®åŸå› ã«ãªã‚‹ã¿ãŸã„ã€‚\r\n\r\n![Imgur](https://imgur.com/H6Kgw28.png)\r\n\r\næ¬¡ã«ã€`DNS`>`ãƒ¬ã‚³ãƒ¼ãƒ‰`ã¨é€²ã¿ã€`Misskey`ã®`IPã‚¢ãƒ‰ãƒ¬ã‚¹`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ãŒ`ãƒ—ãƒ­ã‚­ã‚·æ¸ˆã¿`ã‹ã©ã†ã‹ç¢ºèªã—ã¾ã™ã€‚  \r\n`ãƒ—ãƒ­ã‚­ã‚·æ¸ˆã¿`ã˜ã‚ƒãªã„å ´åˆã¯ã—ã¦ãã ã•ã„ã€‚é›²ã®ã‚¢ã‚¤ã‚³ãƒ³ãŒã‚ªãƒ¬ãƒ³ã‚¸è‰²ã«ãªã‚Œã°è‰¯ã„ã¯ãšã€‚  \r\nã“ã‚Œã§ã€`Misskey ã‚µãƒ¼ãƒãƒ¼`ã¨ã®é€šä¿¡ã®å‰ã«`Cloudflare`ãŒå…¥ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\n```plaintext\r\n[ãƒ–ãƒ©ã‚¦ã‚¶ (PC / ã‚¹ãƒãƒ›) ] <---> [Cloudflare] <---> [Misskey ã‚µãƒ¼ãƒãƒ¼ (VPS)]\r\n```\r\n\r\nã•ã£ãã®`SSL/TLS`ã®è¨­å®šã¯ã“ã®é–“ã«å…¥ã‚‹`Cloudflare`ã®è¨­å®šã®ãŸã‚ã«å¿…è¦ã§ã—ãŸã€‚\r\n\r\næ¬¡ã«`VPS`ã¸ãƒ­ã‚°ã‚¤ãƒ³ã—ã¾ã™ã€‚  \r\nã¾ãšã¯`Misskey`ã‚’æ­¢ã‚ã¦ã€ãŠå¥½ã¿ã§ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãã ã•ã„ã€‚\r\n\r\n```bash\r\nsudo systemctl stop misskey\r\n```\r\n\r\næ¬¡ã«`nginx`ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’é–‹ã„ã¦ã€`Let's Encrypt`ã§ã¯ãªãã€`è‡ªå·±ç½²åè¨¼æ˜æ›¸`ã‚’ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo vim /etc/nginx/sites-enabled/misskey.nginx\r\n```\r\n\r\n```nginx\r\nserver {\r\n    listen 443 ssl http2;\r\n    listen [::]:443 ssl http2;\r\n    server_name diary.negitoro.dev;\r\n    ssl_session_cache shared:ssl_session_cache:10m;\r\n\r\n    # Self-Certificate\r\n    ssl_certificate     /etc/ssl/certs/ssl-cert-snakeoil.pem;\r\n    ssl_certificate_key /etc/ssl/private/ssl-cert-snakeoil.key;\r\n\r\n    # Disbaled Certbot ( thats because, use Cloudflare )\r\n    # To use Debian/Ubuntu's self-signed certificate (For testing or before issuing a certificate)\r\n    # ssl_certificate /etc/letsencrypt/live/diary.negitoro.dev/fullchain.pem; # managed by Certbot\r\n    # ssl_certificate_key /etc/letsencrypt/live/diary.negitoro.dev/privkey.pem; # managed by Certbot\r\n```\r\n\r\nä¿å­˜ã—ã¦ã€`Misskey`ã‚’èµ·å‹•ã—ã€ãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ã‘ã‚‹ã‹ç¢ºèªã—ã¾ã™ã€‚\r\n\r\n```bash\r\nsudo systemctl start misskey\r\n```\r\n\r\næˆåŠŸã—ã¦ã„ã‚Œã°ã€ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ã«`Cloudflare`é–¢é€£ã®å€¤ãŒå…¥ã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚  \r\n![Imgur](https://imgur.com/7AUss7f.png)\r\n\r\nãã—ãŸã‚‰ã‚‚ã†ã€ä»Šä½¿ã£ã¦ã„ã‚‹`Let's Encrypt`ã®è¨¼æ˜æ›¸ã¯ä¸è¦ã«ãªã‚‹ã®ã§ã€æ¶ˆã—ã¦ã—ã¾ã„ã¾ã™ã€‚  \r\n\r\n```bash\r\nsudo certbot revoke --cert-path /etc/letsencrypt/live/ãƒ‰ãƒ¡ã‚¤ãƒ³å/cert.pem\r\n```\r\n\r\n```plaintext\r\nWould you like to delete the certificate(s) you just revoked, along with all\r\nearlier and later versions of the certificate?\r\n```\r\n`Y`ã§\r\n\r\n```plaintext\r\nWARNING: Before continuing, ensure that the listed certificates are not being\r\nused by any installed server software (e.g. Apache, nginx, mail servers).\r\nDeleting a certificate that is still being used will cause the server software\r\nto stop working. See https://certbot.org/deleting-certs for information on\r\ndeleting certificates safely.\r\n\r\nAre you sure you want to delete the above certificate(s)?\r\n```\r\n`Y`ã§\r\n\r\n`Deleted all files relating to certificate ãƒ‰ãƒ¡ã‚¤ãƒ³å.`ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°å®Œäº†ã§ã™ã€‚"},{"title":"Misskey ã‚µãƒ¼ãƒãƒ¼ã‚’ãŠå¼•è¶Šã—ãŸãƒ¡ãƒ¢","link":"/posts/misskey_server_ohikkosi/","markdown":"`v10`ã ã‹ã‚‰ã‚ã‚“ã¾ã‚Šå‚è€ƒã«ãªã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„\r\n\r\n# ç’°å¢ƒ\r\n\r\n- `AWS Lightsail`\r\n- `Cloudflare`ã§`SSL`åŒ–ã—ãŸ\r\n    - `Cloudflare`ã®`SSL/TLS æš—å·åŒ–ãƒ¢ãƒ¼ãƒ‰`ã¯`ãƒ•ãƒ«`\r\n        - ã“ã‚Œã§`https`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹\r\n- ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¯`S3`\r\n    - `VPS`ã®ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«æ›¸ãè¾¼ã‚“ã§ã„ã‚‹å ´åˆã¯ãã‚Œã‚‚å¼•ãç¶™ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n`Let's Encrypt + Certbot`ã§ã‚‚ç§»è¡Œå¾Œã«è¨¼æ˜æ›¸å†ç™ºè¡Œã§è‰¯ã„ã¯ãš...ï¼Ÿï¼ˆ`IPã‚¢ãƒ‰ãƒ¬ã‚¹`ã§ã¯ãªããƒ‰ãƒ¡ã‚¤ãƒ³ã«å¯¾ã—ã¦æ‰•ã„å‡ºã•ã‚Œã‚‹ï¼Ÿï¼‰\r\n\r\n# æ–°ã—ã„ãƒã‚·ãƒ³ã‚’ç”¨æ„\r\n`Ubuntu 22.04`ã‚’ç”¨æ„ã—ã¾ã—ãŸã€‚  \r\n`TeraTerm`ãŒä½¿ãˆãªã„...å–ã‚Šã‚ãˆãš`PowerShell`ã«å…¥ã£ã¦ã‚‹ï¼Ÿ`ssh`ã‚’ä½¿ã†ã“ã¨ã«ã—ã¾ã™ã€‚  \r\n\r\néµãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹ã¨IPã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’ç›´ã—ã¦å©ã‘ã°ä½¿ãˆã‚‹ã¯ãšã€‚\r\n\r\n```powershell\r\nssh -i 'éµãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹.pem' ubuntu@000.000.000.000\r\n```\r\n\r\n# ç§»è¡Œå…ˆã‚’æ§‹ç¯‰ã™ã‚‹\r\n\r\nãƒ¡ãƒ¢ãƒªã‚’å¢—ã‚„ã—ã¦ã€`sudo apt update`ã¨`sudo apt upgrade`ã—ã¦ã€`Misskey`ã®ã‚½ãƒ¼ã‚¹ã„ã‚Œã¦ãƒ“ãƒ«ãƒ‰ã—ã¦ã€`nginx`ã—ã¦ã€ã€  \r\nã£ã¦ã‚“æ„Ÿã˜ã§ã€`DNS`ã®è¨­å®šã®å‰ã¾ã§ã‚„ã£ã¦ãŠã„ã¦ãã ã•ã„ã€‚\r\n\r\nhttps://takusan.negitoro.dev/posts/misskey_ohitorisama/#dns-ã®è¨­å®š\r\n\r\n## MongoDB ãŒå…¥ã‚‰ãªã„\r\n`mongodb`ã‚’å…¥ã‚Œã¦ã‚‹é€”ä¸­ã§...\r\n\r\n```\r\nsudo apt-get install gnupg\r\nwget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -\r\necho \"deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse\" | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list\r\nsudo apt-get update\r\nsudo apt-get install -y mongodb-org\r\n```\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ã€å¤±æ•—ã—ã¦ã—ã¾ã„ã¾ã™...\r\n\r\n```bash\r\nThe following packages have unmet dependencies:\r\n mongodb-org-mongos : Depends: libssl1.1 (>= 1.1.0) but it is not installable\r\n mongodb-org-server : Depends: libssl1.1 (>= 1.1.0) but it is not installable\r\n mongodb-org-shell : Depends: libssl1.1 (>= 1.1.0) but it is not installable\r\nE: Unable to correct problems, you have held broken packages.\r\n```\r\n\r\n`libssl1.1`ãŒå¿…è¦ãªã®ã§ã™ãŒã€ã©ã†ã‚„ã‚‰`Ubuntu 22.04`ã‹ã‚‰ã¯åŒæ¢±ã•ã‚Œãªããªã£ãŸã¿ãŸã„ã§ã™ã€‚  \r\n`MongoDB`ã®æœ€æ–°ç‰ˆã«ã™ã‚‹ã¨æ²»ã‚‹ãã†ã§ã™ãŒã€ã€ã€`Misskey`ã®ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã„ã˜ã‚‹ã®ã“ã‚ã„ï¼ˆã¨ã„ã†ã‹`DB`ãŒä½•ã‚‚ã‚ã‹ã‚‰ãªã„ï¼‰ã®ã§ã€ä¸€æ—¦`libssl`ã‚’å…¥ã‚Œã‚‹æ–¹é¢ã§ã„ãã¾ã™ã€‚\r\n\r\nhttps://stackoverflow.com/questions/73656873\r\n\r\n```bash\r\nsudo wget http://archive.ubuntu.com/ubuntu/pool/main/o/openssl/libssl1.1_1.1.1f-1ubuntu2_amd64.deb\r\nsudo dpkg -i libssl1.1_1.1.1f-1ubuntu2_amd64.deb\r\n```\r\n\r\n`amd`ç‰ˆï¼ˆ`Intel`ã€`AMD`ç³»`CPU`ï¼‰ãªã®ã§ã€`arm`ã¨ã‹ã®å ´åˆã¯èª­ã¿æ›¿ãˆã¦ãã ã•ã„  \r\nã“ã‚Œã§`MongoDB`å…¥ã‚Œã‚‰ã‚Œã‚‹ã¯ãš\r\n\r\n```\r\nsudo apt-get install -y mongodb-org\r\n```\r\n\r\n## ç§»è¡Œå…ˆã§ã‚„ã‚‹ã“ã¨ï¼ˆæ–°è¦ã§ç«‹ã¦ã‚‹éš›ã¨ã®é•ã„ï¼‰\r\n\r\n`Misskey`ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã€`nginx`ã®ã‚³ãƒ³ãƒ•ã‚£ã‚°ã‚’å…ƒã®ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰ã‚³ãƒ”ãƒ¼ã—ã¦ãã¾ã™ã€‚  \r\nã‚³ãƒ”ãƒ¼ã¯`Vim`ã®ãƒšãƒ¼ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ãŒä¾¿åˆ©ã§ã™ï¼ˆãã®ã¾ã¾è²¼ã‚Šä»˜ã‘ã‚‹ã¨`#`ã§ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆã•ã‚ŒãŸã‚Šã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã•ã‚Œã¦ã—ã¾ã†ï¼‰\r\n\r\n# MongoDB ã®å¼•ãç¶™ã\r\n\r\n## ç§»è¡Œå‰ã‚µãƒ¼ãƒãƒ¼\r\n\r\n`Misskey`ã‚’æ­¢ã‚ã¾ã™\r\n\r\n```bash\r\nsudo systemctl stop misskey\r\n```\r\n\r\næ¬¡ã«ãƒ«ãƒ¼ãƒˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã§ãƒ­ã‚°ã‚¤ãƒ³ã—ãŸã‚ã¨ã€ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆ`~`ï¼‰ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¾ã™\r\n\r\n```bash\r\ncd ~\r\nmongodump -o \"./dump\"\r\n```\r\n\r\nã¤ãã«ã€æ‰‹å…ƒã®`Windows`ãƒã‚·ãƒ³ã‚’ä½¿ã„ã€ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¸€æ—¦`Windows`ãƒã‚·ãƒ³ã¸ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚  \r\nã‚‚ã—ã‹ã—ãŸã‚‰ç›´æ¥è»¢é€ã§ãã‚‹ã‹ã‚‚...ï¼ˆãŠäº’ã„ã®ã‚µãƒ¼ãƒãƒ¼ã®éµãƒ•ã‚¡ã‚¤ãƒ«ãªã„ã®ã§ä¸€æ—¦çµŒç”±ã™ã‚‹ã“ã¨ã«ã—ãŸï¼‰\r\n\r\n`PowerShell`ã‚’é–‹ã„ã¦ã€`SCP`ã‚³ãƒãƒ³ãƒ‰ã‚’ä½¿ã„ã¾ã™\r\n\r\n```bash\r\nscp -i 'éµãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹.pem' -r ubuntu@000.000.000.000:Linuxã®ä¿å­˜å…ˆ Windowsã®ä¿å­˜å…ˆ\r\n```\r\n\r\nä»¥ä¸‹ä¾‹\r\n\r\n```bash\r\nscp -i 'C:\\Users\\takusan23\\.ssh\\key.pem' -r ubuntu@000.000.000.000:~/dump C:\\Users\\takusan23\\misskey_backup\\\r\n```\r\n\r\n## ç§»è¡Œå¾Œã‚µãƒ¼ãƒãƒ¼\r\nãƒ•ã‚©ãƒ«ãƒ€ã”ã¨ç§»è¡Œå…ˆã®ã‚µãƒ¼ãƒãƒ¼ã¸ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™  \r\nã¾ãŸ`PowerShell`ã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™\r\n\r\n```bash\r\nscp -i 'éµãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒ‘ã‚¹' -r Windowsã®ä¿å­˜å…ˆ ubuntu@000.000.000.000:Linuxã®ä¿å­˜å…ˆ\r\n```\r\n\r\nä»¥ä¸‹ä¾‹\r\n\r\n```bash\r\nscp -i 'C:\\Users\\takusan23\\.ssh\\key.pem' -r C:\\Users\\takusan23\\misskey_backup\\ ubuntu@18.176.65.230:~/dump\r\n```\r\n\r\nãã—ãŸã‚‰ã€ãƒªã‚¹ãƒˆã‚¢ç”¨ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™ã€‚  \r\nç§»è¡Œå¾Œã‚µãƒ¼ãƒãƒ¼ã«`SSH`ã§å…¥ã£ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¾ã™ã€‚ï¼ˆé–“é•ãˆã¦ãƒ‘ã‚¹æ·±ããªã£ã¡ã‚ƒã£ãŸ...ï¼‰\r\n\r\n`Misskey`ãŒå‹•ã„ã¦ã„ãªã„å ´åˆã¯ä¸€è¡Œç›®ã¯ã„ã‚‰ãªã„ã¯ãšã€‚\r\n\r\n```bash\r\nsudo systemctl stop misskey\r\nmongorestore --drop ~/dump/dump/\r\n```\r\n\r\n`-drop`ã§æ—¢ã«ã‚ã‚‹ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã—ãŸå¾Œã€ãƒªã‚¹ãƒˆã‚¢ã‚’ã—ã¦ãã‚Œã¾ã™ã€‚æ§‹ç¯‰æ‰‹é †ã®`systemctl`ã®ã¨ã“ã‚ã§`misskey`ã‚’èµ·å‹•ã—ã¦ã—ã¾ã£ãŸã®ã§ã€ãŠãã‚‰ããƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒä½œã‚‰ã‚Œã¦ã—ã¾ã£ã¦ã„ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nãƒ‡ãƒ¼ã‚¿ãŒå¾©å…ƒã§ããŸã‹è¦‹ã¦ã¿ã¾ã™ã€‚ã¾ãšä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦\r\n\r\n```bash\r\nmongo\r\nshow dbs;\r\n```\r\n\r\nãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä¸€è¦§ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ãŒã€ã“ã“ã§å®¹é‡ãŒ`0GB`ã§ãªã‘ã‚Œã°æˆåŠŸãªã¯ãšã€‚\r\n\r\n```bash\r\n> show dbs;\r\nadmin    0.000GB\r\nconfig   0.000GB\r\nlocal    0.000GB\r\nmisskey  0.011GB\r\n```\r\n\r\n`exit`ã‚’å©ãã¨æŠœã‘ã‚Œã¾ã™ã€‚\r\n\r\n# èµ·å‹•ã™ã‚‹\r\nç§»è¡Œå¾Œã‚µãƒ¼ãƒãƒ¼ã§å©ãã¾ã™\r\n\r\n```bash\r\nsudo systemctl start misskey\r\nsudo systemctl start nginx\r\n```\r\n\r\n# DNS ã®è¨­å®šã‚’ç›´ã™\r\n\r\nç§»è¡Œå…ˆã®ã‚µãƒ¼ãƒãƒ¼ã¸`DNS`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’å‘ã‘ã¾ã™ã€‚\r\n\r\n# å‹•ä½œç¢ºèª\r\n\r\nã©ã†ã§ã—ã‚‡ã†ã€ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã—ãŸã‹ï¼Ÿï¼Ÿï¼Ÿ  \r\nä¸€å¿œæ–°ã‚µãƒ¼ãƒãƒ¼ã§è¦‹ã‚Œã¦ã„ã‚‹ã‹ã®ç¢ºèªã‚’ã™ã‚‹ã®ã«ã€ç§»è¡Œå¾Œã‚µãƒ¼ãƒãƒ¼ã®`nginx`ã®ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ã‚’è¦‹ã‚‹ã¨ã„ã†æ‰‹ãŒã‚ã‚Šã¾ã™ã€‚  \r\nã¾ã‚ã™ã‚‹å¿…è¦ã‚‚ãªã„ã§ã—ã‚‡ã†ãŒã€‚\r\n\r\n```bash\r\ncat /var/log/nginx/access.log\r\n```\r\n\r\næºå¸¯å›ç·šã‹ã‚‰ã‚‚è¦‹ã‚Œã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/4rzqtqH.png)\r\n\r\n# ç§»è¡Œå‰ã® VPS ã‚’ãŠç‰‡ä»˜ã‘ã™ã‚‹\r\né‡‘ãªã„ã®ã§ã•ã£ã•ã¨æ­¢ã‚ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/qtZ8GP6.png)\r\n\r\nä»¥ä¸Šã§ã™!!!!!!!!!\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\nä»Šå›ã¯ã‚®ãƒªã‚®ãƒªã¾ã§ï¼ˆ`DB`å¼•ã£è¶Šã—ï¼‰ã¾ã§ç§»è¡Œå‰ã®ã‚µãƒ¼ãƒãƒ¼ã‚’å‹•ã‹ã™æ–¹æ³•ã§è¡Œãã¾ã—ãŸã€‚  \r\nãŒã€å¤šåˆ†ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã€ç”»åƒã¨ã‹ã®ãƒ¡ãƒ‡ã‚£ã‚¢ï¼ˆS3ã¨ã‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ã£ã¦ãªã„ãªã‚‰ï¼‰ã€ã‚³ãƒ³ãƒ•ã‚£ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ`misskey`ã¨`nginx`ï¼‰ã‚’`æ‰‹å…ƒã® Windows ãƒã‚·ãƒ³`ã¨ã‹ã«ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã—ã¦ãŠã„ã¦ã€  \r\n`VPS`ã‚’æ¶ˆã™æ–¹æ³•ã§ã‚‚è‰¯ã„ã¯ãšã§ã™ã€‚ï¼ˆæœ€å¾Œã¾ã§æ®‹ã™æ–¹æ³•ã ã¨ã€ç§»è¡Œä½œæ¥­ä¸­ã¯äºŒå°`VPS`ã‚’å‹•ã‹ã™ã“ã¨ã«ãªã‚‹ã®ã§ã€ãŠä¸€äººæ§˜ã«ãã“ã¾ã§ã®ãŠé‡‘ã‚’ã‹ã‘ã‚‰ã‚Œã‚‹ã‹...ï¼‰\r\n\r\n# ãã®ã»ã‹\r\n\r\n## JavaScript heap out of memory\r\n`Linux`ã®å ´åˆã¯ã€`npm`ã‚³ãƒãƒ³ãƒ‰ã®å…ˆé ­ã«ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã€ãƒ¡ãƒ¢ãƒªå‰²ã‚Šå½“ã¦ã‚’æ‰‹å‹•ã§èª¿æ•´ã§ãã¾ã™ã€‚  \r\nå˜ä½ã¯`MB`ã£ã½ã„\r\n\r\n```bash\r\nNODE_OPTIONS=\"--max-old-space-size=2048\"\r\n```\r\n\r\nä»¥ä¸‹ä¾‹ï¼š\r\n\r\n```bash\r\nNODE_OPTIONS=\"--max-old-space-size=2048\" NODE_ENV=production npm build\r\n```"},{"title":"ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®é€Ÿåº¦å¤‰ãˆã‚‹ã‚¢ãƒ—ãƒªä½œã£ãŸ","link":"/posts/mousecursor_wpf/","markdown":"\r\nWindowsã‚€ãšãã­ï¼Ÿ  \r\nC#ã¨WPFã¯è‰¯ã„ã¨ã—ã¦ã€.Net Coreï¼ˆ.Net Frameworkï¼‰ã£ã¦ãªã«ï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\nãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®é€Ÿåº¦å¤‰ãˆã‚‰ã‚Œã‚‹ã‚„ã¤(WPFè£½)ä½œã£ãŸã€‚\r\n\r\n![Imgur](https://i.imgur.com/gAxYowU.png)\r\n\r\n- ãƒã‚¦ã‚¹ã®é€Ÿåº¦ã«å¤‰æ›´\r\n    - Windowsã®è¨­å®šã§`5`\r\n- ã‚¿ãƒƒãƒãƒ‘ãƒƒãƒ‰ã®é€Ÿåº¦ã«å¤‰æ›´\r\n    - Windowsã®è¨­å®šã§`10`\r\n\r\nã«ã™ã‚‹ã ã‘ã®ã‚¢ãƒ—ãƒªï¼ï¼ï¼\r\n\r\n# ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/MouseCursorSpeedChanger/releases/tag/1.0\r\n\r\n# ä½œã‚‹ã®ã«å¤§å¤‰ã ã£ãŸã“ã¨\r\nã‚’åˆ¥ã®è¨˜äº‹ã§æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# ãªã‚“ã§ä½œã£ãŸã®ï¼Ÿ\r\nãŠå‹é”ã‹ã‚‰ç„¡ç·šãƒã‚¦ã‚¹ã‚‚ã‚‰ã£ãŸã€‚ï¼ˆã†ã‚Œã—ã„ğŸ¥³ï¼‰  \r\nãã‚Œã§ã‚«ãƒ¼ã‚½ãƒ«ã®é€Ÿåº¦ãŒé…ã‹ã£ãŸã‹ã‚‰Windowsã®è¨­å®šã‚’å¤‰ãˆãŸã‚‰ã€ã‚¿ãƒƒãƒãƒ‘ãƒƒãƒ‰ã®ã¨ãã®æ“ä½œãŒé…ããªã£ã¡ã‚ƒã£ãŸã€‚  \r\nãã®éƒ½åº¦å¤‰ãˆã‚Œã°è‰¯ã„ã‚“ã ã‘ã©ã‚ã‚“ã©ã„ã®ã§è§£æ±ºã—ã¦ã¿ãŸã€‚\r\n\r\n## C#ã§ãƒã‚¦ã‚¹ã‚«ãƒ¼ã‚½ãƒ«ã®é€Ÿåº¦ãŒå¤‰æ›´ã§ãã‚‹ã‚‰ã—ã„ã€‚\r\nå‚è€ƒï¼šhttps://ez-net.jp/article/D8/VnBq1qVD/s7VwewtZmDws/\r\n\r\nC#ã»ã¼æ›¸ã‹ãªã„ã‹ã‚‰ã‚ã‹ã‚‰ã‚“\r\n\r\n```cs\r\n/** ãƒã‚¦ã‚¹ã®ã‚«ãƒ¼ã‚½ãƒ«ã®é€Ÿåº¦å¤‰æ›´é–¢ä¿‚ */\r\npublic const uint SPI_GETMOUSESPEED = 0x70;\r\npublic const uint SPI_SETMOUSESPEED = 0x71;\r\n\r\n[DllImport(\"User32.dll\")]\r\nstatic extern Boolean SystemParametersInfo(\r\n    UInt32 uiAction,\r\n    UInt32 uiParam,\r\n    IntPtr pvParam,\r\n    UInt32 fWinIni);\r\n```\r\n\r\nä½¿ã„æ–¹ã¯ã“ã†ã§ã™ã€‚  \r\nã“ã‚Œã¯ã‚«ãƒ¼ã‚½ãƒ«ã®é€Ÿåº¦ã‚’5ã«ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™ã­ã€‚\r\n```cs\r\nint speed = 5;\r\nSystemParametersInfo(SPI_SETMOUSESPEED, 0, new IntPtr(speed), 0);\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\nè©±å¤‰ã‚ã‚‹ã‘ã©åˆå¾Œç™»æ ¡é•·ãå¯ã‚Œã‚‹ã‹ã‚‰è‰¯ã„ã­ã€‚æ—©èµ·ãã—ãŸã‚‰å­¦æ ¡ã¾ã§ã®ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³ã®ã›ã„ã§è‹¦ç—›ã ã‚ã†ã‘ã©ã€‚"},{"title":"Androidã®MediaBrowserServiceã‚’ä½œã‚‹","link":"/posts/nakinagara_media_browser_service/","markdown":"\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã¯ã€‚  \n8æœˆã«å­¦æ ¡ã‚ã‚‹ã£ã¦ã‚¯ã‚½é•å’Œæ„Ÿã ã‚ˆãªã€‚æ—¥ä»˜ã®ã¨ã“ã‚ã«8æœˆã£ã¦æ›¸ãã¨**ã‚ã€ã¾ã 8æœˆãªã®ã‹**ã£ã¦ã€‚ä¸æ€è­°\n\n# æœ¬é¡Œ\nAndroid 11ã§ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ã£ã¦ã®ãŒã§ããŸã®ã§ã€~~çœŸé¢ç›®ã«~~MediaSessionã¨MediaBrowserServiceã‚’ä½œã‚‹ã€‚  \n\n# ç’°å¢ƒ\nã“ã‚Œã‚’æ›¸ã‹ãªã„ã¨ï¼ˆè¨˜äº‹æ›¸ã„ãŸå¾Œã«ï¼‰ä»•æ§˜å¤‰æ›´ãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œã‚“ã—ãªã€‚\n\n|ãªã¾ãˆ|ã‚ãŸã„|\n|---|---|\n|Android|11 Beta 3|\n|Kotlin|1.4 â†JSã¿ãŸã„ã«é…åˆ—ã®æœ€å¾Œã«ã€Œ,ã€å…¥ã‚Œã¦ã‚‚æ€’ã‚‰ã‚Œãªããªã£ãŸï¼|\n\n# ãã‚‚ãã‚‚ MediaSession ã¦ä½•ï¼Ÿ\n**Always on Display** ã£ã¦ã„ã†ãšã£ã£ã£ã¨æ™‚è¨ˆã‚’è¡¨ç¤ºã§ããŸã‚Šã™ã‚‹æ©Ÿèƒ½ãŒã‚ã‚‹ã‚“ã§ã™ã‘ã©ã€éŸ³æ¥½ã‚’å†ç”Ÿã—ã¦ã„ã‚‹ã¨ãã“ã«æ›²åãŒå‡ºã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \nä»–ã«ã‚‚**Google Assistant**ã§éŸ³æ¥½ã®æ“ä½œãŒã§ããŸã‚Šã€‚\n\nã“ã‚Œã€MediaSessionã‚’åˆ©ç”¨ã—ã¦ExoPlayerç­‰ã®ãƒ¡ãƒ‡ã‚£ã‚¢ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®çŠ¶æ…‹ã‚’å…¬é–‹ã—ã¦ãã‚Œã¦ã‚‹ã‹ã‚‰ãªã‚“ã§ã™ã­ã€‚\n\nã‚ˆã£ã¦MediaSessionã¯ExoPlayerã¿ãŸã„ã«éŸ³æ¥½ã‚’å†ç”Ÿã™ã‚‹ã‚‚ã®ã§ã¯ç„¡ã„ã§ã™ã€‚\n\n# ä»Šå›ã®è¨­è¨ˆ\n\n- éŸ³æ¥½å†ç”Ÿ\n    - ExoPlayer\n- éŸ³æ¥½ã®æƒ…å ±\n    - ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆï¼ˆã‚ã‚“ã©ã„ã—ã‚„ã‚„ã“ã—ããªã‚‹ï¼‰\n- Activity\n    - æ›²ã®æ“ä½œã¯ç”³ã—è¨³ãªã„ãŒActivityã§ã¯ã‚„ã‚‰ãšã«ã€é€šçŸ¥ã§ã®ã¿è¡Œã†ã‚ˆã†ã«ã€‚ä»Šå›ã¯MediaBrowserServiceãŒã‚„ã‚ŠãŸã„ã®ã§\n\n# Android 11 ã® ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ #ã¨ã¯\n\nhttps://developer.android.com/preview/features/media-controls?hl=ja\n\nhttps://android-developers.googleblog.com/2020/08/playing-nicely-with-media-controls.html\n\nè©³ã—ãã¯ã“ã“ã‚‰ã¸ã‚“èª­ã‚“ã§ã€‚  \nã¾ã‚ä½•ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‹ã£ã¦è¨€ã†ã¨ã€**ãƒ‡ãƒã‚¤ã‚¹å†èµ·å‹•å¾Œã«æœ€å¾Œã«èã„ã¦ã„ãŸæ›²ã‚’å†ç”Ÿã§ãã‚‹**ã£ã¦æ©Ÿèƒ½ã ã¨æ€ã„ã¾ã™ã€‚  \n\n![Imgur](https://imgur.com/IpX69hG.png)\n\nã“ã®MediaSessioné€šçŸ¥ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¾ã§ã«ã€  \n- `onGetRoot`ãŒå‘¼ã°ã‚Œã‚‹ï¼ˆå®Ÿè£…ã§è©³ã—ãï¼‰\n- `onLoadChildren`ãŒå‘¼ã°ã‚Œã‚‹ï¼ˆå®Ÿè£…ã§è©³ã—ãï¼‰\n    - æœ€å¾Œã®æ›²ã‚’ã“ã“ã§è¿”ã™ï¼ˆéåŒæœŸãŠï½‹ï¼‰\n\nå†ç”Ÿãƒœã‚¿ãƒ³ã ã‘ãŒè¡¨ç¤ºã•ã‚Œã¦ã‚‹ã€‚ã“ã‚Œã‚’æŠ¼ã™ã¨ã€\n- `MediaSessionCompat.setCallBack`ã®`onPrepare()`ãŒå‘¼ã°ã‚Œã‚‹\n- `MediaSessionCompat.setCallBack`ã®`onPlay()`ãŒå‘¼ã°ã‚Œã‚‹\n    - ã“ã“ã‚‰ã¸ã‚“ã§é€šçŸ¥ã‚’æ›´æ–°ã™ã‚‹ï¼Ÿ\n\n## å®Ÿè£…ã‚ã‹ã‚‰ã‚“\nhttps://github.com/android/uamp  \nèª­ã‚ã°åˆ†ã‹ã‚‹ã£ã¦æ›¸ã„ã¦ã‚ã‚‹ã‘ã©ã€**MediaSessionã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢ä¿‚ã‚’åˆ¥ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆexoplayer:extension-mediasessionï¼‰** ã«ä»»ã›ã¦ã‚‹ã®ã§~~ã‚ã‚“ã¾å‚è€ƒã«~~  \n\nãã‚Œã§ã‚‚å…±é€šéƒ¨åˆ†ã¯ã¾ã‚ã¾ã‚ã‚ã‹ã£ãŸæ°—ãŒã—ãŸã€‚\n\n# ä»Šå›ã®è¨˜äº‹ã¯ã‚³ãƒ”ãƒšã§ã¯å‹•ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚\nä¸­ç´šè€…å‘ã‘ã®è¨˜äº‹ã«ãªã‚Šã¾ã™ã­ã€‚\n\n# ä½œã‚Šæ–¹\n\n# build.gradle\n\n```gradle\n// ExoPlayer\nimplementation 'com.google.android.exoplayer:exoplayer-core:2.11.3'\nimplementation 'com.google.android.exoplayer:exoplayer-hls:2.11.3'\nimplementation 'com.google.android.exoplayer:extension-mediasession:2.10.4'\n// Preference\nimplementation \"androidx.preference:preference:1.1.1\"\n```\n\nã¾ãš`AndroidManifest.xml`ã«æ›¸ãè¶³ã™å†…å®¹ã§ã™\n\n```xml\n<service\n        android:name=\".Service.BackgroundPlaylistCachePlayService\"\n        android:enabled=\"true\"\n        android:exported=\"true\"\n        android:label=\"@string/cache_background_play\">\n    <intent-filter>\n        <action android:name=\"android.media.browse.MediaBrowserService\" />\n    </intent-filter>\n</service>\n<!-- ã“ã‚Œæ›¸ã‹ãªã„ã¨é€šçŸ¥ã‹ã‚‰æ“ä½œä¸€ç”Ÿã“ãªã„ -->\n<receiver android:name=\"androidx.media.session.MediaButtonReceiver\">\n    <intent-filter>\n        <action android:name=\"android.intent.action.MEDIA_BUTTON\" />\n    </intent-filter>\n</receiver>\n```\n\n`android:name`ã€`android:label`ã¯å„è‡ªæ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚\n\nãã‚Œã¨åˆ¥ã«ã€ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆ©ç”¨ã™ã‚‹ã®ã§ã€ä¸Šã«æ¨©é™ã‚’æ›¸ã„ã¦ãã ã•ã„ã€‚\n\n```xml\n<uses-permission android:name=\"android.permission.FOREGROUND_SERVICE\" />\n```\n\n# BackgroundPlaylistCachePlayService.kt\nã‚’ä½œæˆã—ã¦ã€ï¼ˆã‚¯ãƒ©ã‚¹åã¯åˆ¥ã«ãªã‚“ã§ã‚‚ã„ã„ï¼‰`MediaBrowserServiceCompat`ã‚’ç¶™æ‰¿ã—ã¦ã­ã€‚\n\n```kotlin\nclass BackgroundPlaylistCachePlayService : MediaBrowserServiceCompat() {\n\n\n    override fun onGetRoot(clientPackageName: String, clientUid: Int, rootHints: Bundle?): BrowserRoot? {\n\n    }\n\n    override fun onLoadChildren(parentId: String, result: Result<MutableList<MediaBrowserCompat.MediaItem>>) {\n\n    }\n\n}\n```\n\nã‚ã‚Œï¼Ÿ`onCreate`ã¨ã‹æ›¸ã‹ãªã„ã®ã£ã¦è©±ã§ã™ãŒ**ã¡ã‚‡ã£ã¨ã¾ã£ã¦ã€‚æ™‚æœŸãŒæ‚ªã„**\n\n## onGetRoot\nã“ã‚Œã¯`MediaBrowserService`ã«æ¥ç¶šã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«å‘¼ã°ã‚Œã¾ã™ã€‚  \n**Android 11 ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ã‹ã©ã†ã‹**ã¯ã“ã“ã§åˆ¤æ–­ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ã­ã€‚\n\n### Android 11 ã® ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ ã‹ã©ã†ã‹åˆ¤æ–­ã™ã‚‹\n`rootHints?.getBoolean(BrowserRoot.EXTRA_RECENT)`ãŒ`true`ãªã‚‰**ã‚·ã‚¹ãƒ†ãƒ ãŒæœ€å¾Œã®æ›²ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹**ã“ã¨ã«ãªã‚Šã¾ã™ã€‚\n\n```kotlin\n/** [onLoadChildren]ã§parentIdã«å…¥ã£ã¦ãã‚‹ã€‚Android 11ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ã®å ´åˆã¯ã“ã®å€¤ */\nprivate val ROOT_RECENT = \"root_recent\"\n/** [onLoadChildren]ã§parentIdã«å…¥ã£ã¦ãã‚‹ã€‚[ROOT_RECENT]ä»¥å¤–ã®å ´åˆ */\nprivate val ROOT = \"root\"\n/**\n * [MediaBrowserServiceCompat]ã¸æ¥ç¶šã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«å‘¼ã°ã‚Œã‚‹\n * Android 11 ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ã§ã¯é‡è¦ã«ãªã£ã¦ã„ã‚‹\n * */\noverride fun onGetRoot(clientPackageName: String, clientUid: Int, rootHints: Bundle?): BrowserRoot? {\n    // æœ€å¾Œã®æ›²ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹å ´åˆã¯true\n    val isRequestRecentMusic = rootHints?.getBoolean(BrowserRoot.EXTRA_RECENT) ?: false\n    // BrowserRootã«å…¥ã‚Œã‚‹å€¤ã‚’å¤‰ãˆã‚‹\n    val rootPath = if (isRequestRecentMusic) ROOT_RECENT else ROOT\n    return BrowserRoot(rootPath, null)\n}\n```\n\nã“ã‚Œã§ã€ã“ã®å¾Œã«ã‚ã‚‹`onLoadChildren`ã§**ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹**ã‹ã©ã†ã‹åˆ†ã‹ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\n\n**ã‚ã€ã“ã“ã§ã¯æ›²ä¸€è¦§ã‚’èª­ã¿è¾¼ã‚€ã¨ã‹ã®é‡ã„å‡¦ç†ã¯ã—ãªã„ã§ã­ã€‚æ›²ä¸€è¦§ã¯ã“ã®å¾Œã®`onLoadChildren`ã§ã‚„ã£ã¦ãã ã•ã„ã€‚**\n\n## onLoadChildren\nã“ã“ã§ã¯ã€Activityã‚„ä»–ãƒ‡ãƒã‚¤ã‚¹ï¼ˆWear OSã¨ã‹è»Šã¨ã‹ï¼Ÿï¼‰ã«è¿”ã™æ›²ã‚’èª­ã¿è¾¼ã¿ã¾ã™ã€‚  \n**Android 11 ã® ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹**ã«å¯¾å¿œã™ã‚‹ã«ã¯ã“ã“ã§æœ€å¾Œã«èã„ã¦ã„ãŸæ›²ã‚’è¿”ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \nã ã‹ã‚‰`onGetRoot`ãŒå¿…è¦ã ã£ãŸã®ã§ã™ã­ã€‚\n\n```kotlin\n/**\n * Activityã¨ã‹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸æ›²ä¸€è¦§ã‚’è¿”ã™\n * */\noverride fun onLoadChildren(parentId: String, result: Result<MutableList<MediaBrowserCompat.MediaItem>>) {\n    // ä¿é™ºã€‚é…ããªã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹ã½ã„ï¼Ÿ\n    result.detach()\n    if (parentId == ROOT_RECENT) {\n        // å‹•ç”»æƒ…å ±ã„ã‚Œã‚‹\n        result.sendResult(arrayListOf(createMediaItem(\"sm157\",\"ã¦ã™ã¨ã§ã™\",\"ã•ã¶ãŸã„ã¨ã‚‹\")))\n    }\n}\n/**\n * [onLoadChildren]ã§è¿”ã™ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆã™ã‚‹\n * */\nprivate fun createMediaItem(videoId: String, title: String, subTitle: String): MediaBrowserCompat.MediaItem {\n    val mediaDescriptionCompat = MediaDescriptionCompat.Builder().apply {\n        setTitle(title)\n        setSubtitle(subTitle)\n        setMediaId(videoId)\n    }.build()\n    return MediaBrowserCompat.MediaItem(mediaDescriptionCompat, MediaBrowserCompat.MediaItem.FLAG_PLAYABLE)\n}\n```\n\nã“ã“ã§`SharedPreferenceã«æœ€å¾Œã®æ›²ã®IDã‚’ä¿å­˜ã—ã¦ãŠã`ã¨ã‹æ›¸ã„ã¦ã‚ã‚Šã¾ã™ãŒã€æœ€å¾Œã®æ›²ã®æƒ…å ±ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã¨ã‹ï¼‰ãŒå–ã‚Œã‚Œã°ã“ã“ã¯è‡ªç”±ã«ä½œã£ã¦ãã ã•ã„ã€‚  \nä»Šå›ã¯ã‚ã‚“ã©ã„ã®ã§ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã—ã¾ã—ãŸã€‚\n\n## onCreate\nã•ã¦ã€ã‚ˆã†ã‚„ãã§ã™ã­ã€‚  \nã“ã“ã§ã¯`MediaSession`ã€`ExoPlayer`ã®åˆæœŸåŒ–ã‚’è¡Œã„ã¾ã™ã€‚ã€€ã€€\n\n```kotlin\n/** éŸ³æ¥½å†ç”Ÿã®ExoPlayer */\nlateinit var exoPlayer: SimpleExoPlayer\n/** MediaSession */\nlateinit var mediaSessionCompat: MediaSessionCompat\n/** é€šçŸ¥å‡ºã™ã®ã«ä½¿ã† */\nlateinit var notificationManager: NotificationManager\n/** MediaSessionåˆæœŸåŒ–ãªã© */\noverride fun onCreate() {\n    super.onCreate()\n    // é€šçŸ¥å‡ºã™ã®ã«ä½¿ã†\n    notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n    // ExoPlayerç”¨æ„\n    exoPlayer = SimpleExoPlayer.Builder(this).build()\n    // MediaSessionç”¨æ„\n    mediaSessionCompat = MediaSessionCompat(this, \"media_session\").apply {\n        // MediaButtons ã¨ TransportControls ã®æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹\n        setFlags(MediaSessionCompat.FLAG_HANDLES_MEDIA_BUTTONS or MediaSessionCompat.FLAG_HANDLES_TRANSPORT_CONTROLS)\n        // MediaSessionã®æ“ä½œã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n        setCallback(object : MediaSessionCompat.Callback() {\n            /** å†ç”Ÿæº–å‚™ */\n            override fun onPrepare() {\n                super.onPrepare()\n                val dataSourceFactory = DefaultDataSourceFactory(this@BackgroundPlaylistCachePlayService, \"TatimiDroid;@takusan_23\")\n                val mediaSource = ProgressiveMediaSource.Factory(dataSourceFactory)\n                    .createMediaSource(\"å„è‡ªãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’å…¥ã‚Œã¦ã­\".toUri()) // å‹•ç”»ã®å ´æ‰€\n                exoPlayer.prepare(mediaSource)\n            }\n            /** å†ç”Ÿ */\n            override fun onPlay() {\n                super.onPlay()\n                exoPlayer.playWhenReady = true\n                isActive = true\n            }\n            /** ä¸€æ™‚åœæ­¢ */\n            override fun onPause() {\n                super.onPause()\n                exoPlayer.playWhenReady = false\n            }\n            /** é€šçŸ¥ã®ã‚·ãƒ¼ã‚¯å‹•ã‹ã—ãŸæ™‚ */\n            override fun onSeekTo(pos: Long) {\n                super.onSeekTo(pos)\n                exoPlayer.seekTo(pos)\n            }\n            /** æ­¢ã‚ãŸæ™‚ */\n            override fun onStop() {\n                super.onStop()\n                isActive = false\n                stopSelf()\n            }\n        })\n        // å¿˜ã‚Œãšã«\n        setSessionToken(sessionToken)\n    }\n    // ExoPlayerã®å†ç”ŸçŠ¶æ…‹ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã‚‚é€šçŸ¥ã‚’æ›´æ–°ã™ã‚‹\n    exoPlayer.addListener(object : Player.EventListener {\n        override fun onPlayerStateChanged(playWhenReady: Boolean, playbackState: Int) {\n            super.onPlayerStateChanged(playWhenReady, playbackState)\n        }\n    })\n}\n```\n\nå‹•ç”»ã®ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯å„è‡ªæ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚  \n\n### ã“ã‚Œä½•ã—ã¦ã‚‹ã®ï¼Ÿ\n`MediaSession`çµŒç”±ã§`å†ç”Ÿãƒ»ä¸€æ™‚åœæ­¢`ã—ãŸéš›ã«ExoPlayerã§ã¯ä½•ã‚’ã™ã‚Œã°è‰¯ã„ã®ã‹ã£ã¦è¨€ã†ã®ã‚’æ›¸ã„ã¦ã¾ã™ã€‚  \n\n## MediaSessionã®Callbackã®onPlayã§ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹\nã“ã‚Œã—ãªã„ã¨ã€**Android 11ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹**ã¾ã§ã§ããŸã®ã«ã€ã„ã–å†ç”Ÿã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ•°ç§’ã§æ­¢ã¾ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \n~~ã“ã‚Œã§ä¸€æ—¥ãã‚‰ã„ç„¡é§„ã«ã—ãŸ~~\n\nã¨ã„ã†ã‹ãƒã‚¸ã§`onPlay`ã§ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã™ã‚‹ã®ï¼Ÿã£ã¦è©±ã§ã™ãŒã€**æ›¸ ã„ ã¦ ã‚ ã‚Š ã¾ ã— ãŸ ã€‚**\n\nhttps://developer.android.com/guide/topics/media-apps/audio-app/building-a-mediabrowserservice#service-lifecycle\n\n<p style=\"border: 1px solid;padding:10px\">\nThe media session onPlay() callback should include code that calls startService(). This ensures that the service starts and continues to run, even when all UI MediaBrowser activities that are bound to it unbind.\n</p>\n\n<p style=\"color:red\">æœ€åˆã‹ã‚‰èª­ã‚“ã§ã‚Œã°ã‚ˆã‹ã£ãŸã§ã™ã­ãˆï¼</p>\n\nã¨ã„ã†ã‚ã‘ã§`onPlay`ã«ï¼ˆå¤šåˆ†ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ï¼‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã—ã‚‡ã†\n\n```kotlin\n/** å†ç”Ÿ */\noverride fun onPlay() {\n    super.onPlay()\n    startThisService()\n    exoPlayer.playWhenReady = true\n    isActive = true\n}\n```\n\n`startThisService()`é–¢æ•°ã¯ä»¥ä¸‹\n```kotlin\n/** ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹ */\nprivate fun startThisService() {\n    val playlistPlayServiceIntent = Intent(this, BackgroundPlaylistCachePlayService::class.java)\n    // èµ·å‹•\n    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n        startForegroundService(playlistPlayServiceIntent)\n    } else {\n        startService(playlistPlayServiceIntent)\n    }\n}\n```\n\n# éŸ³æ¥½ã®æƒ…å ±ã¨å†ç”ŸçŠ¶æ…‹ã‚’æ›´æ–°ã™ã‚‹\nã“ã“ã§ç”¨æ„ã—ãŸæƒ…å ±ãŒã€AODã‚„GoogleAssistantã§ä½¿ã‚ã‚Œã‚‹ã‚“ã§ã™ã­ã€‚  \n\nã‚‚ã—éŸ³æ¥½ã®æ™‚é–“ãŒå–ã‚Œã‚‹å ´åˆã¯ã€ä¸€ç·’ã«å…¥ã‚Œã¦ãŠãã¨Android 10ä»¥é™ã§é€šçŸ¥ã‚·ãƒ¼ã‚¯ãŒã§ãã¾ã™ã€‚  \nä»Šå›ã¯ã‚ã‚“ã©ã„ã®ã§ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã—ã¾ã™\n\n```kotlin\n/**\n * å†ç”ŸçŠ¶æ…‹ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ã€‚ä»Šå›ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã™ã‚‹\n *\n * MediaSessionã®setCallBackã§æ‰±ã†æ“ä½œ([MediaSessionCompat.Callback.onPlay]ãªã©)ã‚‚[PlaybackStateCompat.Builder.setState]ã«æ›¸ã‹ãªã„ã¨ä½•ã‚‚èµ·ããªã„\n * */\nprivate fun updateState() {\n    val stateBuilder = PlaybackStateCompat.Builder().apply {\n        // å–ã‚Šæ‰±ã†æ“ä½œã€‚ã¨ã‚Šã‚ãˆãš å†ç”Ÿæº–å‚™ å†ç”Ÿ ä¸€æ™‚åœæ­¢ ã‚·ãƒ¼ã‚¯ ã‚’æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ã€‚æ›¸ãå¿˜ã‚Œã‚‹ã¨ä½•ã‚‚èµ·ããªã„\n        setActions(PlaybackStateCompat.ACTION_PREPARE or PlaybackStateCompat.ACTION_PLAY or PlaybackStateCompat.ACTION_PAUSE or PlaybackStateCompat.ACTION_STOP or PlaybackStateCompat.ACTION_SEEK_TO or PlaybackStateCompat.ACTION_STOP)\n        // å†ç”Ÿã—ã¦ã‚‹ã‹ã€‚ExoPlayerã‚’å‚ç…§\n        val state = if (exoPlayer.isPlaying) PlaybackStateCompat.STATE_PLAYING else PlaybackStateCompat.STATE_PAUSED\n        // ä½ç½®\n        val position = exoPlayer.currentPosition\n        // å†ç”ŸçŠ¶æ…‹ã‚’æ›´æ–°\n        setState(state, position, 1.0f) // æœ€å¾Œã¯å†ç”Ÿé€Ÿåº¦\n    }.build()\n    mediaSessionCompat.setPlaybackState(stateBuilder)\n    // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š\n    val duration = 288L // å†ç”Ÿæ™‚é–“\n    val mediaMetadataCompat = MediaMetadataCompat.Builder().apply {\n        // Android 11 ã® MediaSession ã§ä½¿ã‚ã‚Œã‚‹ã‚„ã¤\n        putString(MediaMetadataCompat.METADATA_KEY_TITLE, \"éŸ³æ¥½ã®ã‚¿ã‚¤ãƒˆãƒ«\")\n        putString(MediaMetadataCompat.METADATA_KEY_ARTIST, \"éŸ³æ¥½ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ\")\n        putLong(MediaMetadataCompat.METADATA_KEY_DURATION, duration * 1000) // ã“ã‚Œã‚ã‚‹ã¨Android 10ã§ã‚·ãƒ¼ã‚¯ä½¿ãˆã¾ã™\n    }.build()\n    mediaSessionCompat.setMetadata(mediaMetadataCompat)\n}\n```\n\nã“ã‚Œã‚’ã€ExoPlayerã®`onPlayerStateChanged`ã«æ›¸ã„ã¦ãŠãã¾ã—ã‚‡ã†ã€‚å†ç”ŸçŠ¶æ…‹ãŒå¤‰ã‚ã£ãŸã‚‰å‹æ‰‹ã«é–¢æ•°ã‚’å‘¼ã‚“ã§æ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\n\n```kotlin\n// ExoPlayerã®å†ç”ŸçŠ¶æ…‹ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã‚‚é€šçŸ¥ã‚’æ›´æ–°ã™ã‚‹\nexoPlayer.addListener(object : Player.EventListener {\n    override fun onPlayerStateChanged(playWhenReady: Boolean, playbackState: Int) {\n        super.onPlayerStateChanged(playWhenReady, playbackState)\n        updateState()\n    }\n})\n```\n\n## ã¯ã„æ³¨æ„äº‹é …\n`setActions()`ã«å…¥ã‚ŒãŸå†…å®¹ã®ã¿ãŒæ‰±ãˆã¾ã™ã€‚  \nã“ã®ä¸­ã«æ›¸ã„ã¦ãªã„æ“ä½œã¯ã€MediaSessionã®`setCallback`ã«æ›¸ã„ã¦ã‚‚ä¸€ç”Ÿå‘¼ã°ã‚Œã¾ã›ã‚“ã€‚æ‚²ã—ã„ã­\n\n# ForegroundServiceã‚’ç¶­æŒã™ã‚‹ãŸã‚ã«é€šçŸ¥ã‚’å‡ºã™\nã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•ã‹ã‚‰5ç§’çµŒéã™ã‚‹å‰ã«ã€é€šçŸ¥ã‚’å‡ºã—ã¾ã—ã‚‡ã†ã€‚  \nã“ã‚Œã§ãƒ¡ãƒ¢ãƒªãŒè¶³ã‚Šãªã„ã¨ãã‚‚å‹•ã‹ã™ã“ã¨ãŒã§ãã¾ã™ï¼ˆï¼Ÿï¼‰\n\n```kotlin\n/** é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ */\nprivate fun showNotification() {\n    // é€šçŸ¥ã‚’ä½œæˆã€‚é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã®ã›ã„ã§é•·ã„\n    val notification = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n        // é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«\n        val channelId = \"playlist_play\"\n        val notificationChannel = NotificationChannel(channelId, \"éŸ³æ¥½ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼\", NotificationManager.IMPORTANCE_LOW)\n        if (notificationManager.getNotificationChannel(channelId) == null) {\n            // ç™»éŒ²\n            notificationManager.createNotificationChannel(notificationChannel)\n        }\n        NotificationCompat.Builder(this, channelId)\n    } else {\n        NotificationCompat.Builder(this)\n    }\n    notification.apply {\n        setStyle(androidx.media.app.NotificationCompat.MediaStyle().setMediaSession(mediaSessionCompat.sessionToken).setShowActionsInCompactView(0))\n        setSmallIcon(R.drawable.ic_background_icon)\n        // é€šçŸ¥é ˜åŸŸã«ç½®ããƒœã‚¿ãƒ³\n        if (exoPlayer.isPlaying) {\n            addAction(NotificationCompat.Action(R.drawable.ic_pause_black_24dp, \"ä¸€æ™‚åœæ­¢\", MediaButtonReceiver.buildMediaButtonPendingIntent(this@BackgroundPlaylistCachePlayService, PlaybackStateCompat.ACTION_PAUSE)))\n        } else {\n            addAction(NotificationCompat.Action(R.drawable.ic_play_arrow_24px, \"å†ç”Ÿ\", MediaButtonReceiver.buildMediaButtonPendingIntent(this@BackgroundPlaylistCachePlayService, PlaybackStateCompat.ACTION_PLAY)))\n        }\n        addAction(NotificationCompat.Action(R.drawable.ic_clear_black, \"åœæ­¢\", MediaButtonReceiver.buildMediaButtonPendingIntent(this@BackgroundPlaylistCachePlayService, PlaybackStateCompat.ACTION_STOP)))\n    }\n    // é€šçŸ¥è¡¨ç¤º\n    startForeground(84, notification.build())\n}\n```\n\nã‚ã€ã‚¢ã‚¤ã‚³ãƒ³ã¯å„è‡ªç”¨æ„ã—ã¦ãã ã•ã„ã€‚  \n`ResourceManager â†’ + `ã‹ã‚‰å¥½ããªã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸ã‚“ã§ãã¦ãã ã•ã„ã€‚\n\nã“ã‚Œã‚‚ã€ExoPlayerã®`onPlayerStateChanged`ã«æ›¸ã„ã¦ãŠãã¾ã—ã‚‡ã†\n\n```kotlin\n// ExoPlayerã®å†ç”ŸçŠ¶æ…‹ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã‚‚é€šçŸ¥ã‚’æ›´æ–°ã™ã‚‹\nexoPlayer.addListener(object : Player.EventListener {\n    override fun onPlayerStateChanged(playWhenReady: Boolean, playbackState: Int) {\n        super.onPlayerStateChanged(playWhenReady, playbackState)\n        updateState()\n        showNotification()\n    }\n})\n```\n\nã“ã‚Œã§ç”Ÿãã¦ã„ã‘ã¾ã™ã€‚  \nã‚ã¨ãªã‚“ã‹ã—ã‚‰ã‚“ã‘ã©ã€é€šçŸ¥ã®ãƒ†ã‚­ã‚¹ãƒˆã¨ã‹å…¥ã‚Œã¦ãªã„ã‚“ã ã‘ã©ã“ã‚Œ`MediaStyle`ã ã¨å‹æ‰‹ã«æ›²ã®åå‰ã¨ã‹å…¥ã‚Œã¦ãã‚Œã‚‹ã®ã‹ãªã€‚\n\n### ã¯ã„æ³¨æ„äº‹é …\nsetSmallIconãŒç„¡ãã¦ã‚‚ **é€šçŸ¥ã¯å‡ºã›ã¾ã™ãŒã€MediaStyleãªé€šçŸ¥ã‚’å‡ºã™ãŸã‚ã«ã¯ã€ã‚¢ã‚¤ã‚³ãƒ³ã®æŒ‡å®šãŒå¿…è¦ã§ã™ã€‚**  \nã‚¢ã‚¤ã‚³ãƒ³ã¯ã¡ã‚ƒã‚“ã¨æŒ‡å®šã—ã‚ˆã†ã€‚\n\n# ã‚ã¨ã—ã¾ã¤\n```kotlin\noverride fun onDestroy() {\n    super.onDestroy()\n    mediaSessionCompat.release()\n    exoPlayer.release()\n}\n```\n\n# Fragment(Activity)ã‹ã‚‰æ“ä½œã§ãã‚‹ã‚ˆã†ã«\n\n~~startForegroundService()ã§èµ·å‹•ã—ãŸã»ã†ãŒæ—©ãã­~~\n\nã¾ãšä½¿ã†é–¢æ•°ãŸã¡ã§ã™\n\n```kotlin\nprivate fun initCachePlaylistPlay() {\n    bottom_fragment_nicovideo_list_menu_playlist_background.setOnClickListener {\n        // ãƒœã‚¿ãƒ³æŠ¼ã—ãŸæ™‚\n        mediaControllerCompat.transportControls.play()\n    }\n}\n/** [BackgroundPlaylistCachePlayService]ã¨æ¥ç¶šã™ã‚‹é–¢æ•° */\nprivate fun initMediaBrowserConnect() {\n    // MediaBrowser\n    mediaBrowserCompat = MediaBrowserCompat(requireContext(), ComponentName(requireContext(), BackgroundPlaylistCachePlayService::class.java), object : MediaBrowserCompat.ConnectionCallback() {\n        override fun onConnected() {\n            super.onConnected()\n            mediaControllerCompat = MediaControllerCompat(requireContext(), mediaBrowserCompat.sessionToken)\n            // ã¨ã‚Šã‚ãˆãšprepareã‚’å‘¼ã¶\n            mediaControllerCompat.transportControls.prepare()\n        }\n    }, null)\n    // æ¥ç¶š\n    mediaBrowserCompat.connect()\n}\n\noverride fun onDestroy() {\n    super.onDestroy()\n    mediaBrowserCompat.disconnect()\n}\n```\n\nãã‚Œã‹ã‚‰`onViewCreated`ã§ã“ã‚“ãªæ„Ÿã˜ã«\n\n```kotlin\noverride fun onViewCreated(view: View, savedInstanceState: Bundle?) {\n    super.onViewCreated(view, savedInstanceState)\n    // MediaBrowserã¨æ¥ç¶š\n    initMediaBrowserConnect()\n    \n    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ç”¨é€£ç¶šå†ç”Ÿ\n    initCachePlaylistPlay()\n}\n```\n\nActivityã§ã‚‚åŒã˜ã‚ˆã†ã«ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\n\n## ä½•ã—ã¦ã‚‹ã®ï¼Ÿ\nã‚ã‹ã‚‰ã‚“ã€‚  \n`ä»Šå›ä½œã£ãŸMediaBrowserService`ã‚’æ“ä½œã™ã‚‹`MediaControllerCompat`ã‚’ç”¨æ„ã™ã‚‹ãŸã‚ã«ã€ãªã‚“ã‹ã‚„ã£ã¦ã‚‹ã€‚\n\nã¨ã‚Šã‚ãˆãšå†ç”Ÿã§ãã‚‹ã‚ˆã†ã«æ“ä½œã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰`prepare()`ã‚’å‘¼ã‚“ã§ã‚‹ã€‚\n\n`bottom_fragment_nicovideo_list_menu_playlist_background`ã¯ç§ã®ç’°å¢ƒã«ã—ã‹ç„¡ã„ã®ã§ã€å„è‡ªActivityã‹Fragmentã«ãƒœã‚¿ãƒ³ã‚’ç½®ã„ã¦ã€`setOnClickListener{ }`ã®ä¸­ã«`mediaControllerCompat.transportControls.play()`ã‚’æ›¸ã‘ã°ã„ã„ã§ã™ã€‚\n\nã¨ã“ã‚ã§`requireContext()`ã£ã¦ã„ã¤ã®é–“ã«ã§ããŸã®ï¼Ÿ\n\n# `mediaControllerCompat.transportControls.play()`ã®çµæœ\n![Imgur](https://imgur.com/9BWwp5X.png)\n\nã„ã‹ãŒã§ã—ã‚‡ã†ã‹ï¼ï¼ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã—ãŸã‹ï¼ï¼Ÿï¼ï¼Ÿ\n\n### play()ã®æ™‚ã«å€¤ã‚’æ¸¡ã—ãŸã„\n`playFromMediaId()`ã‚ãŸã‚Šã‚’ä½¿ãˆã°ã§ããã†ã€‚  \nä½¿ã†éš›ã¯ã€\n- `setCallBack()`ã«`override fun onPlayFromUri`ã‚’è¿½åŠ \n- `updateState()`é–¢æ•°ã«ã‚ã‚‹ã€`setActions()`ã®ä¸­ã«`PlaybackStateCompat.ACTION_PLAY_FROM_MEDIA_ID`è¿½åŠ \n\nã—ãªã„ã¨ãƒ€ãƒ¡ã ã¨æ€ã„ã¾ã™ã€‚\n\n# æœãŸã—ã¦å†èµ·å‹•å¾Œã‚‚éŸ³æ¥½ã®å†é–‹ãŒã§ãã‚‹ã®ã‹\nã§ãã¾ã—ãŸã€‚onLoadChildrenã§è¿”ã—ã¦ã‚‹å†…å®¹ãŒè¡¨ç¤ºã•ã‚Œã¦ã¾ã™ã­ã€‚\n\n![Imgur](https://imgur.com/blfcxsI.png)\n\n# å…¨ã‚³ãƒ¼ãƒ‰\n```kotlin\nclass BackgroundPlaylistCachePlayService : MediaBrowserServiceCompat() {\n\n    /** [onLoadChildren]ã§parentIdã«å…¥ã£ã¦ãã‚‹ã€‚Android 11ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ã®å ´åˆã¯ã“ã®å€¤ */\n    private val ROOT_RECENT = \"root_recent\"\n\n    /** [onLoadChildren]ã§parentIdã«å…¥ã£ã¦ãã‚‹ã€‚[ROOT_RECENT]ä»¥å¤–ã®å ´åˆ */\n    private val ROOT = \"root\"\n\n    /** éŸ³æ¥½å†ç”Ÿã®ExoPlayer */\n    lateinit var exoPlayer: SimpleExoPlayer\n\n    /** MediaSession */\n    lateinit var mediaSessionCompat: MediaSessionCompat\n\n    /** é€šçŸ¥å‡ºã™ã®ã«ä½¿ã† */\n    lateinit var notificationManager: NotificationManager\n\n    /** MediaSessionåˆæœŸåŒ–ãªã© */\n    override fun onCreate() {\n        super.onCreate()\n\n        // é€šçŸ¥å‡ºã™ã®ã«ä½¿ã†\n        notificationManager = getSystemService(Context.NOTIFICATION_SERVICE) as NotificationManager\n\n        // ExoPlayerç”¨æ„\n        exoPlayer = SimpleExoPlayer.Builder(this).build()\n\n        // MediaSessionç”¨æ„\n        mediaSessionCompat = MediaSessionCompat(this, \"media_session\").apply {\n\n            // MediaButtons ã¨ TransportControls ã®æ“ä½œã‚’å—ã‘ä»˜ã‘ã‚‹\n            setFlags(MediaSessionCompat.FLAG_HANDLES_MEDIA_BUTTONS or MediaSessionCompat.FLAG_HANDLES_TRANSPORT_CONTROLS)\n\n            // MediaSessionã®æ“ä½œã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯\n            setCallback(object : MediaSessionCompat.Callback() {\n\n                /** å†ç”Ÿæº–å‚™ */\n                override fun onPrepare() {\n                    super.onPrepare()\n                    val dataSourceFactory = DefaultDataSourceFactory(this@BackgroundPlaylistCachePlayService, \"TatimiDroid;@takusan_23\")\n                    val mediaSource = ProgressiveMediaSource.Factory(dataSourceFactory)\n                        .createMediaSource(\"å„è‡ªã„ã‚Œã¦\".toUri()) // å‹•ç”»ã®å ´æ‰€\n                    exoPlayer.prepare(mediaSource)\n                }\n\n                /** å†ç”Ÿ */\n                override fun onPlay() {\n                    super.onPlay()\n                    startThisService()\n                    exoPlayer.playWhenReady = true\n                }\n\n                /** ä¸€æ™‚åœæ­¢ */\n                override fun onPause() {\n                    super.onPause()\n                    exoPlayer.playWhenReady = false\n                }\n\n                /** é€šçŸ¥ã®ã‚·ãƒ¼ã‚¯å‹•ã‹ã—ãŸæ™‚ */\n                override fun onSeekTo(pos: Long) {\n                    super.onSeekTo(pos)\n                    exoPlayer.seekTo(pos)\n                }\n\n                /** æ­¢ã‚ãŸæ™‚ */\n                override fun onStop() {\n                    super.onStop()\n                    isActive = false\n                    stopSelf()\n                }\n\n            })\n\n            // å¿˜ã‚Œãšã«\n            setSessionToken(sessionToken)\n        }\n\n        // ExoPlayerã®å†ç”ŸçŠ¶æ…‹ãŒæ›´æ–°ã•ã‚ŒãŸã¨ãã‚‚é€šçŸ¥ã‚’æ›´æ–°ã™ã‚‹\n        exoPlayer.addListener(object : Player.EventListener {\n            override fun onPlayerStateChanged(playWhenReady: Boolean, playbackState: Int) {\n                super.onPlayerStateChanged(playWhenReady, playbackState)\n                updateState()\n                showNotification()\n            }\n        })\n    }\n\n    /**\n     * å†ç”ŸçŠ¶æ…‹ã¨ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’è¨­å®šã™ã‚‹ã€‚ä»Šå›ã¯ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¯ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã™ã‚‹\n     *\n     * MediaSessionã®setCallBackã§æ‰±ã†æ“ä½œ([MediaSessionCompat.Callback.onPlay]ãªã©)ã‚‚[PlaybackStateCompat.Builder.setState]ã«æ›¸ã‹ãªã„ã¨ä½•ã‚‚èµ·ããªã„\n     * */\n    private fun updateState() {\n        val stateBuilder = PlaybackStateCompat.Builder().apply {\n            // å–ã‚Šæ‰±ã†æ“ä½œã€‚ã¨ã‚Šã‚ãˆãš å†ç”Ÿæº–å‚™ å†ç”Ÿ ä¸€æ™‚åœæ­¢ ã‚·ãƒ¼ã‚¯ ã‚’æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ã€‚æ›¸ãå¿˜ã‚Œã‚‹ã¨ä½•ã‚‚èµ·ããªã„\n            setActions(PlaybackStateCompat.ACTION_PREPARE or PlaybackStateCompat.ACTION_PLAY or PlaybackStateCompat.ACTION_PAUSE or PlaybackStateCompat.ACTION_STOP or PlaybackStateCompat.ACTION_SEEK_TO or PlaybackStateCompat.ACTION_STOP)\n            // å†ç”Ÿã—ã¦ã‚‹ã‹ã€‚ExoPlayerã‚’å‚ç…§\n            val state = if (exoPlayer.isPlaying) PlaybackStateCompat.STATE_PLAYING else PlaybackStateCompat.STATE_PAUSED\n            // ä½ç½®\n            val position = exoPlayer.currentPosition\n            // å†ç”ŸçŠ¶æ…‹ã‚’æ›´æ–°\n            setState(state, position, 1.0f) // æœ€å¾Œã¯å†ç”Ÿé€Ÿåº¦\n        }.build()\n        mediaSessionCompat.setPlaybackState(stateBuilder)\n        // ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã®è¨­å®š\n        val duration = 288L // å†ç”Ÿæ™‚é–“\n        val mediaMetadataCompat = MediaMetadataCompat.Builder().apply {\n            // Android 11 ã® MediaSession ã§ä½¿ã‚ã‚Œã‚‹ã‚„ã¤\n            putString(MediaMetadataCompat.METADATA_KEY_TITLE, \"éŸ³æ¥½ã®ã‚¿ã‚¤ãƒˆãƒ«\")\n            putString(MediaMetadataCompat.METADATA_KEY_ARTIST, \"éŸ³æ¥½ã®ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ\")\n            putLong(MediaMetadataCompat.METADATA_KEY_DURATION, duration * 1000) // ã“ã‚Œã‚ã‚‹ã¨Android 10ã§ã‚·ãƒ¼ã‚¯ä½¿ãˆã¾ã™\n        }.build()\n        mediaSessionCompat.setMetadata(mediaMetadataCompat)\n    }\n\n    /** é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ */\n    private fun showNotification() {\n        // é€šçŸ¥ã‚’ä½œæˆã€‚é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«ã®ã›ã„ã§é•·ã„\n        val notification = if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            // é€šçŸ¥ãƒãƒ£ãƒ³ãƒãƒ«\n            val channelId = \"playlist_play\"\n            val notificationChannel = NotificationChannel(channelId, getString(R.string.background_playlist_play_channel), NotificationManager.IMPORTANCE_LOW)\n            if (notificationManager.getNotificationChannel(channelId) == null) {\n                // ç™»éŒ²\n                notificationManager.createNotificationChannel(notificationChannel)\n            }\n            NotificationCompat.Builder(this, channelId)\n        } else {\n            NotificationCompat.Builder(this)\n        }\n        notification.apply {\n            setStyle(androidx.media.app.NotificationCompat.MediaStyle().setMediaSession(mediaSessionCompat.sessionToken).setShowActionsInCompactView(0))\n            setSmallIcon(R.drawable.ic_background_icon)\n            // é€šçŸ¥é ˜åŸŸã«ç½®ããƒœã‚¿ãƒ³\n            if (exoPlayer.isPlaying) {\n                addAction(NotificationCompat.Action(R.drawable.ic_pause_black_24dp, \"ä¸€æ™‚åœæ­¢\", MediaButtonReceiver.buildMediaButtonPendingIntent(this@BackgroundPlaylistCachePlayService, PlaybackStateCompat.ACTION_PAUSE)))\n            } else {\n                addAction(NotificationCompat.Action(R.drawable.ic_play_arrow_24px, \"å†ç”Ÿ\", MediaButtonReceiver.buildMediaButtonPendingIntent(this@BackgroundPlaylistCachePlayService, PlaybackStateCompat.ACTION_PLAY)))\n            }\n            addAction(NotificationCompat.Action(R.drawable.ic_clear_black, \"åœæ­¢\", MediaButtonReceiver.buildMediaButtonPendingIntent(this@BackgroundPlaylistCachePlayService, PlaybackStateCompat.ACTION_STOP)))\n        }\n        // é€šçŸ¥è¡¨ç¤º\n        startForeground(84, notification.build())\n    }\n\n    /** ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ã™ã‚‹ */\n    private fun startThisService() {\n        val playlistPlayServiceIntent = Intent(this, BackgroundPlaylistCachePlayService::class.java)\n        // èµ·å‹•\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.O) {\n            startForegroundService(playlistPlayServiceIntent)\n        } else {\n            startService(playlistPlayServiceIntent)\n        }\n    }\n\n    /**\n     * [MediaBrowserServiceCompat]ã¸æ¥ç¶šã—ã‚ˆã†ã¨ã—ãŸæ™‚ã«å‘¼ã°ã‚Œã‚‹\n     * Android 11 ã®ãƒ¡ãƒ‡ã‚£ã‚¢ã®å†é–‹ã§ã¯é‡è¦ã«ãªã£ã¦ã„ã‚‹\n     * */\n    override fun onGetRoot(clientPackageName: String, clientUid: Int, rootHints: Bundle?): BrowserRoot? {\n        // æœ€å¾Œã®æ›²ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã„ã‚‹å ´åˆã¯true\n        val isRequestRecentMusic = rootHints?.getBoolean(BrowserRoot.EXTRA_RECENT) ?: false\n        // BrowserRootã«å…¥ã‚Œã‚‹å€¤ã‚’å¤‰ãˆã‚‹\n        val rootPath = if (isRequestRecentMusic) ROOT_RECENT else ROOT\n        return BrowserRoot(rootPath, null)\n    }\n\n    /**\n     * Activityã¨ã‹ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸æ›²ä¸€è¦§ã‚’è¿”ã™\n     * */\n    override fun onLoadChildren(parentId: String, result: Result<MutableList<MediaBrowserCompat.MediaItem>>) {\n        // ä¿é™ºã€‚é…ããªã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹ã½ã„ï¼Ÿ\n        result.detach()\n        if (parentId == ROOT_RECENT) {\n            // å‹•ç”»æƒ…å ±ã„ã‚Œã‚‹\n            result.sendResult(arrayListOf(createMediaItem(\"sm157\", \"ã¦ã™ã¨ã§ã™\", \"ã•ã¶ãŸã„ã¨ã‚‹\")))\n        }\n    }\n\n    /**\n     * [onLoadChildren]ã§è¿”ã™ã‚¢ã‚¤ãƒ†ãƒ ã‚’ä½œæˆã™ã‚‹\n     * */\n    private fun createMediaItem(videoId: String, title: String, subTitle: String): MediaBrowserCompat.MediaItem {\n        val mediaDescriptionCompat = MediaDescriptionCompat.Builder().apply {\n            setTitle(title)\n            setSubtitle(subTitle)\n            setMediaId(videoId)\n        }.build()\n        return MediaBrowserCompat.MediaItem(mediaDescriptionCompat, MediaBrowserCompat.MediaItem.FLAG_PLAYABLE)\n    }\n\n    override fun onDestroy() {\n        super.onDestroy()\n        mediaSessionCompat.release()\n        exoPlayer.release()\n    }\n\n}\n```\n\n# ãŠã‚ã‚Šã«\nMediaSessionã€ã‚ˆãã‚ã‹ã‚‰ã‚“ã€‚  \n**ãªã‚“ã‹ã—ã‚‰ã‚“ã‘ã© `setMetadata()` ã§è¤‡é›‘ãªã“ã¨ã™ã‚‹ã¨é€šçŸ¥ãŒäºŒé‡ã§ã§ã‚‹ã€‚**  \nã„ã‚„ç§ã®è¨­è¨ˆãŒæ‚ªã„ã®ã‹ã‚‚ã—ã‚Œãªã„ã€‚(ExoPlayerã«TagãŒãªã‘ã‚Œã°è¡¨ç¤ºã—ãªã„ã¨ã‹ã„ã†ä»•æ§˜ã ã‹ã‚‰ã€TagãŒç„¡ã„ã¨ãã¯é©å½“ãªæƒ…å ±ã‚’å…¥ã‚Œã¦ãŠãã“ã¨ã§(ä»Šã‚“æ‰€)è§£æ±º)  \n\nã†ãƒ¼ã‚“ã€‚ã‚ã‹ã‚‰ã‚“ï¼  \nMediaStyleé€šçŸ¥ãŒäºŒé‡ã§è¡¨ç¤ºã•ã‚Œã‚‹å ´åˆã¯ã¨ã‚Šã‚ãˆãšä»®ã§ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’ä½œã£ã¦ãŠã„ã¦ã€ãã®å¾Œã«æœ¬ç•ªã‚’å…¥ã‚Œã¦ã‚ã’ã‚‹ã¨ã†ã¾ãã„ãã‹ã‚‚ã—ã‚Œãªã„ã€‚\n\n~~ã¾ã‚å‹•ã„ã¦ã‚ˆã‹ã£ãŸã‚ï¼ˆã‚ˆããªã„ï¼‰~~\n\n```kotlin\nval stateBuilder = PlaybackStateCompat.Builder().apply {\n    // å–ã‚Šæ‰±ã†æ“ä½œã€‚ã¨ã‚Šã‚ãˆãš å†ç”Ÿæº–å‚™ å†ç”Ÿ ä¸€æ™‚åœæ­¢ ã‚·ãƒ¼ã‚¯ ã‚’æ‰±ã†ã‚ˆã†ã«ã™ã‚‹ã€‚æ›¸ãå¿˜ã‚Œã‚‹ã¨ä½•ã‚‚èµ·ããªã„\n    setActions(PlaybackStateCompat.ACTION_PREPARE or PlaybackStateCompat.ACTION_PLAY or PlaybackStateCompat.ACTION_PAUSE or PlaybackStateCompat.ACTION_STOP or PlaybackStateCompat.ACTION_SEEK_TO or PlaybackStateCompat.ACTION_STOP)\n    // å†ç”Ÿã—ã¦ã‚‹ã‹ã€‚ExoPlayerã‚’å‚ç…§\n    val state = if (exoPlayer.isPlaying) PlaybackStateCompat.STATE_PLAYING else PlaybackStateCompat.STATE_PAUSED\n    // ä½ç½®\n    val position = exoPlayer.currentPosition\n    // å†ç”ŸçŠ¶æ…‹ã‚’æ›´æ–°\n    setState(state, position, 1.0f) // æœ€å¾Œã¯å†ç”Ÿé€Ÿåº¦\n}.build()\nmediaSessionCompat.setPlaybackState(stateBuilder)\n// ãªã‚“ã‹ã“ã“ã‚‰ã¸ã‚“ãŒãŠã‹ã—ã„ã¨é€šçŸ¥ãŒäºŒé‡ã§ç™ºè¡Œã•ã‚Œã‚‹ã€‚ã®ã§ã¨ã‚Šã‚ãˆãšä»®ã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’é€ã£ã¦\nval mediaMetadataCompat = MediaMetadataCompat.Builder().apply {\n    // Android 11 ã® MediaSession ã§ä½¿ã‚ã‚Œã‚‹ã‚„ã¤\n    putString(MediaMetadataCompat.METADATA_KEY_TITLE, \"ã‚¿ã‚¤ãƒˆãƒ«\")\n    putString(MediaMetadataCompat.METADATA_KEY_ARTIST, \"ã‚¢ãƒ¼ãƒ†ã‚£ã‚¹ãƒˆ\")\n    putLong(MediaMetadataCompat.METADATA_KEY_DURATION, 0 * 1000) // ã“ã‚Œã‚ã‚‹ã¨Android 10ã§ã‚·ãƒ¼ã‚¯ä½¿ãˆã¾ã™\n}.build()\nmediaSessionCompat.setMetadata(mediaMetadataCompat)\n// å–ã‚Œãã†ãªã‚‰æœ¬ç•ªã®ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’é€ã‚‹ã€‚ãªãœã‹ä¸Šã® setMetadata ã‚’çœç•¥ã™ã‚‹ã¨å‹•ã‹ãªã„ã€‚\nif (exoPlayer.currentTag is String) {\n    mediaSessionCompat.setMetadata(createMetaData(exoPlayer.currentTag as String))\n}\n```\n\n\nã‚ã¨å†èµ·å‹•ã‹ã‚‰èµ·å‹•â†’å†ç”Ÿãƒœã‚¿ãƒ³æŠ¼ã™â†’ãªãœã‹ã“ã‚Œä»¥é™æŠ¼ã›ãªããªã‚‹  \nãƒã‚°ãªã®ãƒ»ãƒ»ãƒ»ï¼Ÿã§ã‚‚UAMPã®ã‚µãƒ³ãƒ—ãƒ«ã ã¨ãã‚“ãªã“ã¨ç„¡ã„ã—ï¼Ÿã‚ã‹ã‚‰ã‚“ã€‚  \nBetaã®ã›ã„ï¼Ÿï¼ˆäººã®ã›ã„ã«ã™ã‚‹ãªï¼‰\n\nåˆéŸ³ãƒŸã‚¯ã•ã‚“èª•ç”Ÿæ—¥ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚\n\n\n### ãã†ã„ãˆã°\n```koltin\nimplementation \"androidx.media:media:1.1.0\"\n```\n\nã“ã‚Œå…¥ã‚Œã‚‹ã¨`setFlags`ãŒçœç•¥ã§ãã‚‹ï¼Ÿ\n\n# å‚è€ƒã«ã—ã¾ã—ãŸ\nhttps://dev.classmethod.jp/articles/how-to-android-media-player/\n\nhttps://qiita.com/siy1121/items/f01167186a6677c22435\n\nhttps://android-developers.googleblog.com/2020/08/playing-nicely-with-media-controls.html\n\nhttps://developer.android.com/guide/topics/media-apps/audio-app/building-a-mediabrowserservice\n\nhttps://developer.android.com/preview/features/media-controls"},{"title":"Next.js ã® AppRouter ã«ç§»è¡Œã™ã‚‹","link":"/posts/next_js_13_app_router_migration/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\næ‹ã«ã¯ã‚ã¾ãˆãŒå¿…è¦ã§ã™ æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\nã‚†ã³ã•ãã®ã¨ãã¨ã¯é•ã£ã¦ã¡ã‚ƒã‚“ã¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ãƒ—ãƒªã®ãƒ†ã‚­ã‚¹ãƒˆã‚‚èª­ã¿ä¸Šã’ã¦ãã‚Œã¾ã™ç¥ã€‚  \r\n\r\nã“ã®å­ã®Bãƒ«ãƒ¼ãƒˆã®æœ€å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆCGãŒã‚ã£ã¡ã‚ƒå¥½ã¿ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/KvcE0Gh.png)\r\n\r\n![Imgur](https://imgur.com/tB5j7YX.png)\r\n\r\nå€‹äººçš„ã«ã¯ æº€ç•™ã•ã‚“ ã¨ åƒç¾½ã¡ã‚ƒã‚“ ã®ãƒ«ãƒ¼ãƒˆãŒå¥½ãã§ã™ã€  \r\nAãƒ«ãƒ¼ãƒˆã®ã»ã†ãŒå¥½ã¿ã§ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/UTyFiFD.png)\r\n\r\n![Imgur](https://imgur.com/62BW6gS.png)\r\n\r\nã‹ã‚ã„ã„\r\n\r\n![Imgur](https://imgur.com/bOC7SP1.png)\r\n\r\nâ†‘ ãƒ’ãƒ­ã‚¤ãƒ³è¦–ç‚¹ãŒã‚ã£ã¡ã‚ƒã„ã„\r\n\r\n![Imgur](https://imgur.com/PYaEeQ2.png)\r\n\r\nãƒ«ãƒ¼ãƒˆé¸æŠã€å¦¹ã¡ã‚ƒã‚“ãƒ«ãƒ¼ãƒˆã¯ã¡ã‚ƒã‚“ã¨åˆå¾Œã‹ã‚‰ã—ã‹å‡ºç¾ã—ãªã„ã‚ˆã†ã«ãªã£ã¦ãŸï¼ˆãã‚Œã¯ãã†ã‹\r\n\r\n![Imgur](https://imgur.com/d4bVeUR.png)\r\n\r\nã‚ã¤ã„ãƒ»ãƒ»ãƒ»ã‚ã¤ã„ã­  \r\näºˆæƒ³ã‚ˆã‚Šã‚‚ã‚ã£ã¡ã‚ƒã‚ˆã‹ã£ãŸã§ã™ï¼ï¼ãŠã™ã™ã‚ï¼ˆæ§˜å­è¦‹ã—ã‚ˆã†ã‹ã¨æ€ã£ã¦ãŸã‘ã©äºˆç´„ã—ã¦ã‚ˆã‹ã£ãŸï¼‰\r\n\r\nã‚ã¨ã‚ã£ã¡ã‚ƒé–¢ä¿‚ãªã„ã§ã™ãŒ`Misskeyã®ãŠä¸€äººæ§˜ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹`ç«‹ã¦ã¦ã¿ã¾ã—ãŸã€‚ã—ã°ã‚‰ãè¦‹ã¦ãªã„ã†ã¡ã«`ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹`ã§ã¯ãªã`ã‚µãƒ¼ãƒãƒ¼`ã£ã¦è¨€ã†ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ã„ã€‚  \r\nã“ã¡ã‚‰ã§ã™ã€‚ç«‹ã¦ã¦ã—ã¾ã£ãŸä»¥ä¸Šä½¿ã‚ãªã„ã¨ãŠé‡‘ã‹ã‹ã‹ã‚‹ã®ã§ä½¿ã„ã¾ã™ãƒ»ãƒ»ãƒ»å¤šåˆ†ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰\r\n\r\n- URL\r\n    - https://diary.negitoro.dev/@takusan_23\r\n- ID ã¨ é¯–\r\n    - `@takusan_23@diary.negitoro.dev`\r\n\r\nãªãœã‹ç§ã®é¯–ã‹ã‚‰ãƒªãƒ¢ãƒ¼ãƒˆã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒå–ã‚Œãªã„é¯–ãŒã‚ã‚‹ã‚“ã§ã™ã‘ã©ã‚ˆãåˆ†ã‹ã‚Šã¾ã›ã‚“ãƒ»ãƒ»ãƒ»  \r\nioé¯–ã¨ã‹ã¯æ™®é€šã«ãƒªãƒ¢ãƒ¼ãƒˆãƒ•ã‚©ãƒ­ãƒ¼å‡ºæ¥ãŸã®ã§ã»ã‚“ã¨ã«è¬ã§ã™ãƒ»ãƒ»ãƒ»\r\n\r\n# æœ¬é¡Œ\r\n`Next.js`ã®`AppRouter`ã«ç§»è¡Œã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚ã„ã„åŠ æ¸›ã‚„ã‚Šã¾ã™ã€‚  \r\nãŠãã‚‰ãæ—¥ãŒçµŒã£ãŸã®ã§ã€`Promiseã§JSX`ã‚’è¿”ã—ã¦ã‚‚ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã¯ãšãƒ»ãƒ»ãƒ»ï¼\r\n\r\n# ç’°å¢ƒ\r\n\r\n|            |                     |\r\n|------------|---------------------|\r\n| Next.js    | 13.4.4              |\r\n| React      | 18.2.0              |\r\n| TypeScript | 5.1.3 (å¾Œè¿°)        |\r\n| ãƒªãƒã‚¸ãƒˆãƒª | app_router ãƒ–ãƒ©ãƒ³ãƒ |\r\n\r\n\r\n# Next.js ã® AppRouter\r\n\r\n`React Server Components`ãŒæ¡ç”¨ã•ã‚Œã¦ã„ã‚‹ã®ã§ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`.tsx`ã‚’ä½œã£ãŸå ´åˆã¯ã‚µãƒ¼ãƒãƒ¼å´ã§æç”»ã•ã‚Œã¾ã™ã€‚  \r\n\r\n???\r\n\r\nã‚µãƒ¼ãƒãƒ¼å´ï¼ˆã“ã®ãƒ–ãƒ­ã‚°ã¯`SSG`ã§ã™ãŒï¼‰ã§`React (JSX)`ã‹ã‚‰`HTML`ã‚’ä½œã£ã¦ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã«è¿”ãã†è¨€ã£ã¦ã„ã¾ã™ã€‚ï¼Ÿ  \r\nå‹•ãã®ãªã„ï¼ˆã‚¿ã‚¤ãƒˆãƒ«ã‚’è¡¨ç¤ºã—ã¦ã„ã‚‹éƒ¨åˆ†ãªã©ï¼‰ã¯ã“ã‚Œã‚’ä½¿ã†ã¨ã€è¿½åŠ ã®`JavaScript`ãŒç„¡ã„ã®ã§è»½ããªã‚‹ã¨ã‹ï¼Ÿï¼Ÿ  \r\n\r\nã‚µãƒ¼ãƒãƒ¼å´ã§æç”»ã™ã‚‹ãŸã‚ã€ç›´æ¥`ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ / API`ã¸ã‚¢ã‚¯ã‚»ã‚¹ã—ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¸è¿”ã™ã“ã¨ãŒã§ãã‚‹ã‚‰ã—ã„ã€‚ã†ãƒ¼ã‚“é›£ã—ã„  \r\nã‚µãƒ¼ãƒãƒ¼å´ã§æç”»ã•ã‚Œã‚‹ã®ã§ã€`useState`ã‚„ã€`onClick`ã€`Context`ã¯ä½¿ãˆãªã„ï¼ˆå‹•çš„ãªè¦ç´ ãŒå¿…è¦ãªã‚‰ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒå¿…è¦ï¼‰  \r\n\r\nã¦ãªã“ã¨ãŒã“ã“ã«æ›¸ã„ã¦ã‚ã‚‹ã€‚  \r\nhttps://nextjs.org/docs/getting-started/react-essentials#when-to-use-server-and-client-components\r\n\r\n### ãƒ‡ãƒ¼ã‚¿å–å¾—ã®æ–°ã—ã„è€ƒãˆæ–¹ï¼Ÿ\r\n`getStaticProps`ã¯ç„¡ããªã£ãŸãã†ã€‚ã‹ã‚ã‚Šã«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒéåŒæœŸã§è¿”ã›ã‚‹ï¼ˆï¼ï¼Ÿï¼‰ã®ã§ã€ç›´æ¥`await`ã§ãƒ–ãƒ­ã‚°è¨˜äº‹ã¨ã‹ã‚’èª­ã¿è¾¼ã‚ã°ã„ã„ã‚‰ã—ã„ã€‚  \r\nã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§APIå©ãã¨ã‹éåŒæœŸãªã“ã¨ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã®ãŒ`RSC`ãªã®ã‹ãƒ»ãƒ»ãƒ»ï¼Ÿ  \r\n\r\nä¸Šã«é–¢é€£ã—ã¦ãªã‚“ã§ã™ãŒã€ã©ã†ã‚„ã‚‰ãƒšãƒ¼ã‚¸ã®ä½œã‚Šæ–¹ã®è€ƒãˆæ–¹ã‚‚å¤‰ã‚ã£ã¦ã‚‹ãã†ã§ã€  \r\nä»Šã¾ã§ã¯`getStaticProps`ã§ãƒ‡ãƒ¼ã‚¿ã‚’å–ã£ãŸã‚‰ã€`Props`ã‚’ä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã—ã¦ãŸã¨æ€ã†ã®ã§ã™ãŒã€ã€  \r\n`AppRouter`ã§ã¯ã§ãã‚‹é™ã‚Šã€éåŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ãã‚Œãã‚Œ`getStaticProps`ã«å½“ãŸã‚‹å–å¾—å‡¦ç†ã‚’ã™ã‚‹ã®ãŒè‰¯ã„ã‚‰ã—ã„ã€‚ã©ã‚†ã“ã¨ï¼Ÿ  \r\n\r\n```tsx\r\n// ã“ã‚Œã‚ˆã‚Š ----\r\nexport default async function DetailPage() {\r\n    const data = await getArticle() // è¨˜äº‹ã‚’èª­ã¿è¾¼ã‚€é–¢æ•° Promise\r\n    return (\r\n        <>\r\n            <Title>{data.title}</Title>\r\n            <Detail body={data.html} />\r\n        </>\r\n    )\r\n}\r\n\r\n// ã“ã£ã¡ã®æ–¹ãŒã„ã„ã‚‰ã—ã„ ----\r\nasync function Title() {\r\n    const data = await getArticle()\r\n    return (<h1>{data.title}</h1>)\r\n}\r\nasync function Detail() {\r\n    const data = await getArticle()\r\n    return (<body dangerouslySetInnerHTML={data.html} />)\r\n}\r\n\r\nexport default async function DetailPage() {\r\n  return (\r\n    <>\r\n        <Title/>\r\n        <Detail />\r\n    </>\r\n  )\r\n}\r\n```\r\n\r\n- https://nextjs.org/docs/app/building-your-application/data-fetching#fetching-data-on-the-server\r\n    - ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ãƒ­ãƒ¼ãƒ‰ã—ã‚\r\n- https://nextjs.org/docs/app/building-your-application/data-fetching#automatic-fetch-request-deduping\r\n    - `fetch()`ã¯é‡è¤‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¦ã‚‚ã€è¤‡æ•°å›`API`ã‚’å©ãã‚ˆã†ãªå‡¦ç†ã«ã¯ãªã‚‰ãªã„ã‚ˆ\r\n- https://nextjs.org/docs/app/building-your-application/data-fetching/caching#react-cache\r\n    - `fetch()`ãŒä½¿ãˆãªã„ï¼ˆã“ã®ãƒ–ãƒ­ã‚°ã®ã‚ˆã†ã«ã€`Node.js`ã®`fs ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«`ã‚’ä½¿ã†ãªã©ï¼‰å ´åˆã¯`cache()`ã‚’ç”¨æ„ã—ãŸã‹ã‚‰ä½¿ã£ã¦ã­ï¼\r\n\r\n## Material-UI\r\nã“ã®ãƒ–ãƒ­ã‚°ã¯`Material-UI`ã‚’ä½¿ã£ã¦ã„ã¦ã€`Material-UI`ã¯ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§æç”»ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§ã€`\"use client\";`ã‚’ã²ãŸã™ã‚‰æ›¸ã„ã¦ã„ãã®ãŒä»Šå›ã®ç§»è¡Œä½œæ¥­ã ã¨æ€ã„ã¾ã™ãƒ»ãƒ»ãƒ»\r\n\r\n- https://github.com/mui/material-ui/issues/34905#issuecomment-1587760474\r\n- https://github.com/mui/material-ui/issues/34905#issuecomment-1401306594\r\n\r\nã›ã£ã‹ã`App Router`ãªã®ã«ã€å…¨éƒ¨ã«å…¨éƒ¨`\"use client\"`ã—ãŸã‚‰æ„å‘³ãŒãªã„ã‚“ã˜ã‚ƒãªã„ã‹ã¨æ€ã£ã¦ã„ã¾ã—ãŸãŒã€  \r\nã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»¥å¤–ã«ã‚‚ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚‹ã¨è¨€ã£ã¦ãã‚Œã¦ã„ã‚‹ã®ã§ã€`pages`ã‹ã‚‰ç§»è¡Œã—ãŸã»ã†ãŒè‰¯ã•ãã†  \r\nï¼ˆ éåŒæœŸãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚„ã€`Next.js ç”¨ fetch API`ã€`pages ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª`ã‚ˆã‚Šã‚‚æŸ”è»Ÿãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ ãªã©ã€‚ç‰¹ã«æœ€å¾Œã®ã‚„ã¤ã¯ãã‚Œã ã‘ã§ã‚‚æ—¨å‘³ã‚ã‚Šãã†ï¼Ÿ ï¼‰\r\n\r\n# ç§»è¡Œã—ã¾ã™\r\nå…¬å¼  \r\nhttps://nextjs.org/docs/app/building-your-application/upgrading/app-router-migration\r\n\r\næ‰‹é †ã¨ã—ã¦ã¯ãƒ»ãƒ»ãƒ»\r\n\r\n- ã‚‚ã‚ã‚‚ã‚æ›´æ–°ã™ã‚‹\r\n    - æš—é»™çš„ãª`children`ãŒç„¡ããªã£ãŸã‚Šã¨ã‚ã‚“ã©ã„ã‹ã‚‚\r\n- `pages`ã®ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’`app`ã«ç§»å‹•ã™ã‚‹\r\n- æ—¢å­˜ã®`pages`ã§å‹•ã„ã¦ãŸãƒšãƒ¼ã‚¸ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹ï¼ˆ`\"use client\"`ã‚’ã²ãŸã™ã‚‰ä»˜ã‘ã‚‹ï¼‰\r\n- `app`ã¸ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦å‹•ããƒšãƒ¼ã‚¸ã‚’ä½œã‚Šã€ãƒ‡ãƒ¼ã‚¿å–å¾—ã¨â†‘ã§ä½œã£ãŸã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’å‘¼ã³å‡ºã™\r\n- `generateStaticParams`ã‚’ä½¿ã£ã¦å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚’å®Ÿè£…ã™ã‚‹\r\n- `GoogleAnalytics`ã‚„`ã‚°ãƒ­ãƒ¼ãƒãƒ«CSS`ã‚’å‹•ãã‚ˆã†ã«èª¿ç¯€ã™ã‚‹\r\n\r\nãŒã‚“ã°ã‚Šã¾ã—ã‚‡ã†ã€‚ã€‚ã€‚\r\n\r\n## æ›´æ–°\r\n`Next.js`ã‚’æ›´æ–°ã—ã¾ã™  \r\n```\r\nnpm install next@latest react@latest react-dom@latest \r\n```\r\n\r\n`TypeScript`ã ã‘ã¯`npm i -D typescript`ã§æ›´æ–°ã•ã‚Œãªã‹ã£ãŸã®ã§ç›´æ¥`package.json`ã‚’ã„ã˜ã‚Šã¾ã—ãŸã€‚  \r\n`typescript`ã‚’`5.1.3`ä»¥é™ã¸ã€`@types/react`ã‚’`18.2.8`ä»¥é™ã«ã—ã¾ã™ã€‚  \r\nç›´æ¥ã„ã˜ã£ãŸå ´åˆã€`package-lock.json`ã€`node_module`ã‚’æ¶ˆã—ã¦`npm i`ã—ãªã„ã¨ã ã‚ã§ã™ã€‚\r\n\r\n```json\r\n  \"devDependencies\": {\r\n    \"@types/react\": \"^18.2.8\",\r\n    \"typescript\": \"^5.1.3\"\r\n  }\r\n}\r\n```\r\n\r\n## app ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚‹\r\n`pages`ã®ã‚ˆã†ã«`app`ã‚’ä½œã‚Šã¾ã—ãŸã€‚\r\n\r\n## _app.tsx ã‚’ layout.tsx ã«ã™ã‚‹\r\n`_app.tsx`ã‚’ä½¿ã£ã¦å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½œã£ã¦ã¾ã—ãŸãŒã€`App Router`ã§ã¯`layout.tsx`ã‚’ä½œã‚‹ã“ã¨ã§å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  \r\n\r\n![Imgur](https://imgur.com/msvtbZg.png)\r\n\r\n`app/layout.tsx`  \r\n```tsx\r\nimport ClientLayout from \"./ClientLayout\"\r\n\r\n/** å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆéƒ¨åˆ† */\r\nexport default function RootLayout({ children, }: { children: React.ReactNode }) {\r\n    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æç”»ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚\r\n    return (<ClientLayout children={children} />)\r\n}\r\n```\r\n\r\n`app/ClientLayout.tsx`  \r\n```tsx\r\n// Material-UI ã‚’ä½¿ã†ãŸã‚ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\r\n\"use client\"\r\n\r\nimport { ThemeProvider } from '@mui/material/styles'\r\nimport Layout from '../../components/Layout'\r\nimport useCustomTheme from '../../src/ZiyuutyouTheme'\r\nimport { useEffect, useState } from \"react\"\r\nimport useMediaQuery from '@mui/material/useMediaQuery'\r\n\r\n/** ClientLayout ã¸æ¸¡ã™å€¤  */\r\ntype ClientLayoutProps = {\r\n    /** å­è¦ç´  */\r\n    children: React.ReactNode\r\n}\r\n\r\n/** å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ */\r\nexport default function ClientLayout({ children }: ClientLayoutProps) {\r\n    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¤ãƒƒãƒ\r\n    const [isDarkmode, setDarkmode] = useState(false)\r\n    // ãƒ†ãƒ¼ãƒã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼Ÿä½•ã‚‚ã‚ã‹ã‚‰ã‚“\r\n    const theme = useCustomTheme(isDarkmode)\r\n    // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãŒãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ã€‚Win10ã§ç¢ºèªæ¸ˆã¿\r\n    const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\r\n    // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ãƒ†ãƒ¼ãƒã‚‚åˆ‡ã‚Šæ›¿ãˆ\r\n    useEffect(() => {\r\n        setDarkmode(prefersDarkMode)\r\n    }, [prefersDarkMode])\r\n\r\n    return (\r\n        <>\r\n            <ThemeProvider theme={theme}>\r\n                {/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã‚’Appã§æç”»ã™ã‚‹ã€‚å„Pageã§ã¯æç”»ã—ãªã„ */}\r\n                <Layout\r\n                    isDarkmode={isDarkmode}\r\n                    onDarkmodeChange={() => setDarkmode(!isDarkmode)}\r\n                >\r\n                    {/* å„Pageã¯ã“ã“ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚ã“ã‚Œã§ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ç­‰ã¯å…±é€šåŒ–ã•ã‚Œã‚‹ */}\r\n                    {children}\r\n                </Layout>\r\n            </ThemeProvider>\r\n        </>\r\n    )\r\n}\r\n```\r\n\r\n## _document.tsx ã‚’ layout.tsx ã«ã™ã‚‹\r\nã¾ãŸã€`next/head`ã‚‚å¤‰æ›´ã•ã‚Œã¦ãŠã‚Šã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’å…¬é–‹ã™ã‚‹ã‚ˆã†ãªå½¢ã«ãªã£ã¦ã„ã¾ã™ã€‚  \r\n`_document.tsx`ã§`head`ã„ã˜ã£ã¦ãŸå ´åˆã¯ã“ã“ã«æ›¸ãã£ã½ã„ã€‚\r\n\r\n`pages/_document.tsx`  \r\n```tsx\r\nexport default class Document extends NextDocument {\r\n    render() {\r\n        return (\r\n            <Html>\r\n                <Head>\r\n                    {/* PWA */}\r\n                    <link rel=\"icon\" sizes=\"192x192\" href=\"/icon.png\" />\r\n                    <link rel=\"manifest\" href=\"/manifest.json\" />\r\n                </Head>\r\n                <body>\r\n                    <Main />\r\n                    <NextScript />\r\n                </body>\r\n            </Html>\r\n        );\r\n    }\r\n}\r\n```\r\n\r\n`app/layout.tsx`  \r\n```tsx\r\nimport { Metadata } from \"next\"\r\nimport ClientLayout from \"./ClientLayout\"\r\n\r\nexport const metadata: Metadata = {\r\n    manifest: '/manifest.json'\r\n}\r\n\r\n/** å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆéƒ¨åˆ† */\r\nexport default function RootLayout({ children, }: { children: React.ReactNode }) {\r\n    // TODO Google Analytics\r\n    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æç”»ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚\r\n    return (<ClientLayout children={children} />)\r\n}\r\n```\r\n\r\n`icon`ã€`favicon`ã¯ã€`appãƒ•ã‚©ãƒ«ãƒ€`å†…ã«å…¥ã‚Œã¦ãŠãã“ã¨ã§è‡ªå‹•ã§èªè­˜ã—ã¦è¿½åŠ ã—ã¦ãã‚Œã‚‹ãã†ã§ã™ã€‚  \r\n![Imgur](https://imgur.com/J4KEWCE.png)\r\n\r\nhttps://nextjs.org/docs/app/api-reference/file-conventions/metadata/app-icons#image-files-ico-jpg-png\r\n\r\n## pages ã‚’ app ã«ç§»å‹•ã™ã‚‹\r\n`pages/index.tsx`ã‚’ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã—ã¾ã™ã€‚\r\n\r\n`app/ClientHomePage.tsx`  \r\n```tsx\r\n// Material-UI ã‚’ä½¿ã†ãŸã‚ ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ\r\n\"use client\"\r\n\r\nimport LinkCard from \"../../components/LinkCard\";\r\nimport MakingAppCard from \"../../components/MakingAppCard\";\r\nimport ProfileCard from \"../../components/ProfileCard\";\r\nimport Spacer from \"../../components/Spacer\";\r\nimport LinkData from \"../../src/data/LinkData\";\r\nimport { MakingAppData } from \"../../src/data/MakingAppData\";\r\n\r\n/** ClientHomePage ã¸æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ */\r\ntype ClientHomePageProps = {\r\n    /** ãƒ©ãƒ³ãƒ€ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®é…åˆ— */\r\n    randomMessageList: Array<string>,\r\n    /** ä½œã£ãŸã‚¢ãƒ—ãƒªé…åˆ— */\r\n    makingAppList: MakingAppData[],\r\n    /** ãƒªãƒ³ã‚¯é›† */\r\n    linkList: LinkData[]\r\n}\r\n\r\n/** æœ€åˆã«è¡¨ç¤ºã™ã‚‹ç”»é¢ */\r\nexport default function ClientHomePage(props: ClientHomePageProps) {\r\n    return (\r\n        <>\r\n            <ProfileCard randomMessageList={props.randomMessageList} />\r\n            <Spacer value={1} />\r\n            <LinkCard linkList={props.linkList} />\r\n            <Spacer value={1} />\r\n            <MakingAppCard makingAppList={props.makingAppList} />\r\n        </>\r\n    )\r\n}\r\n```\r\n\r\næ¬¡ã«ã€`app/page.tsx`ã‚’ä½œã‚Šã€`getStaticProps`ã§ã‚„ã£ã¦ã„ãŸãƒ­ãƒ¼ãƒ‰å‡¦ç†ã‚’éåŒæœŸã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå†…ã§ã‚„ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚  \r\n\r\n`app/page.tsx`  \r\n```tsx\r\nimport { Metadata } from \"next\";\r\nimport JsonFolderManager from \"../src/JsonFolderManager\";\r\nimport ClientHomePage from \"./ClientHomePage\";\r\n\r\n/** <head> ã«å…¥ã‚Œã‚‹å€¤ */\r\nexport const metadata: Metadata = {\r\n    title: 'ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ - ãŸãã•ã‚“ã®è‡ªç”±å¸³'\r\n}\r\n\r\n/** æœ€åˆã«è¡¨ç¤ºã•ã‚Œã‚‹ãƒšãƒ¼ã‚¸ */\r\nexport default async function Home() {\r\n    // ãƒ‡ãƒ¼ã‚¿ã‚’ async/await ã‚’ä½¿ã£ã¦å–å¾—ã™ã‚‹\r\n    // ãªã‚“ã¨ãªãä¸¦åˆ—ã«ã—ã¦ã¿ãŸ\r\n    const [randomMessageList, makingAppList, linkList] = await Promise.all([\r\n        // ãƒ©ãƒ³ãƒ€ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\r\n        JsonFolderManager.getRandomMessageList(),\r\n        // ä½œã£ãŸã‚¢ãƒ—ãƒª\r\n        JsonFolderManager.getMakingAppMap(),\r\n        // ãƒªãƒ³ã‚¯é›†\r\n        JsonFolderManager.getLinkList()\r\n    ])\r\n\r\n    return (<ClientHomePage randomMessageList={randomMessageList} makingAppList={makingAppList} linkList={linkList} />)\r\n}\r\n```\r\n\r\nãªã‚“ã¨ãªãä¸¦åˆ—ã«ã—ã¦ã¿ãŸã ã‘ã§ã€å¤§äººã—ãä¸€å€‹ä¸€å€‹`await`ã—ã¦ã‚‚å•é¡Œãªã„ã¯ãšã§ã™ã€‚  \r\n\r\n```ts\r\n// ã“ã‚Œã§ã‚‚ã„ã„\r\n// ãƒ©ãƒ³ãƒ€ãƒ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸\r\nconst randomMessageList = await JsonFolderManager.getRandomMessageList()\r\n// ä½œã£ãŸã‚¢ãƒ—ãƒª\r\nconst makingLovers = await JsonFolderManager.getMakingAppMap()\r\n// ãƒªãƒ³ã‚¯é›†\r\nconst linkList = await JsonFolderManager.getLinkList()\r\n```\r\n\r\næœ€å¾Œã«ã€`pages/index.tsx`ã€`pages/_app.tsx`ã€`pages/_document.tsx`ã‚’æ¶ˆã—ã¾ã™ã€‚æ®‹ã—ã¦ãŠãã¨ã€`app`ãªã®ã‹`pages`ãªã®ã‹ã©ã£ã¡ãªã‚“ã ã„ï¼ã£ã¦ãªã£ã¡ã‚ƒã†ã®ã§  \r\n\r\nã©ã†ã ã‚ã†ã€ã“ã‚Œã§è¦‹ã‚Œã‚‹ã¯ãšï¼Ÿ  \r\n![Imgur](https://imgur.com/5p4dvJN.png)\r\n\r\n## ã²ãŸã™ã‚‰ pages ã‚’ app ã«ã™ã‚‹ä½œæ¥­ã‚’ã™ã‚‹\r\nã“ã‚Œã‚’ç¹°ã‚Šè¿”ã—ã¾ã™ã€‚  \r\n`getStaticPaths`ã¯å¾Œã§ã‚„ã‚Šã¾ã™ã€‚  \r\n\r\n### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\r\n`App Router`ã¯ã€ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ãŸã ã‘ã§ã¯ãƒ‘ã‚¹ã¨ã—ã¦ã¯èªè­˜ã•ã‚Œã¾ã›ã‚“ã€‚  \r\nãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­ã«`page.tsx`ãŒã‚ã‚‹ã‹ã§ãƒ‘ã‚¹ã¨ã—ã¦ã¯èªè­˜ã™ã‚‹ã‹ã©ã†ã‹ãŒæ±ºã¾ã‚Šã¾ã™ã€‚\r\n\r\nãªã®ã§`pages`ã§ã“ã†ã ã£ãŸæ§‹æˆã ã¨\r\n- pages\r\n    - pages\r\n        - [page].tsx\r\n    - posts\r\n        - page\r\n            - [page].tsx\r\n        - tag\r\n            - [tag].tsx\r\n            - all_tags.tsx\r\n        - [blog].tsx\r\n\r\n`app`ã ã¨ã“ã†ãªã‚‹ã¯ãš\r\n\r\n- app\r\n    - pages\r\n        - [page]\r\n            - page.tsx\r\n    - posts\r\n        - [blog]\r\n            - page.tsx\r\n        - page\r\n            - [page]\r\n                - page.tsx\r\n        - tag\r\n            - [tag]\r\n                - page.tsx\r\n            - all_tags\r\n                - page.tsx\r\n\r\nãƒ‘ã‚¹ã®åå‰ã®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚‹å¿…è¦ãŒã‚ã‚‹æ„Ÿã˜ã§ã™ã­ã€‚  \r\nä¸€è¦‹ã‚„ã‚„ã“ã—ã„ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€`page.tsx`ã‚’ç½®ã„ã¦ãªã„ãƒ•ã‚©ãƒ«ãƒ€ã¯ã•ã£ãã®é€šã‚Šãƒ‘ã‚¹ã¨ã—ã¦ã¯èªè­˜ã•ã‚Œãªã„ã®ã§ã€  \r\nåŒã˜å ´æ‰€ã«ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰ã€ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ç½®ããªã©ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\r\n\r\n- app\r\n    - posts\r\n        - posts-components // è¨˜äº‹è¡¨ç¤ºã§ä½¿ã†ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆç½®ãå ´\r\n            - Title.tsx\r\n        - tests // ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰\r\n            - test.tsx\r\n        - [blog]\r\n            - page.tsx // è¨˜äº‹è¡¨ç¤º\r\n\r\nã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ãªãƒ»ãƒ»ãƒ»ã‚„ã‚„ã“ã—ã„ã‚ˆã†ãªãƒ»ãƒ»ãƒ»\r\n\r\nã‚ã¨å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã¯ãƒ•ã‚©ãƒ«ãƒ€åã‚’`[å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å]`ã«ã™ã‚Œã°ã„ã„ã§ã™ã€‚ï¼ˆ`[id]`ã¨ã‹`[page]`ã¨ã‹ï¼‰  \r\n`page.tsx`ã‹ã‚‰ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«å¼•æ•°ã§å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®ãƒ‘ã‚¹åãŒå–ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\n```tsx\r\n// slug ã¯ [slug] ã ã‹ã‚‰ã€‚\r\n// ãƒ•ã‚©ãƒ«ãƒ€åãŒ [id] ãªã‚‰ { id: string } ãŒæ­£è§£\r\nexport default function Page({ params }: { params: { slug: string } }) {\r\n  return <div>My Post: {params.slug}</div>\r\n}\r\n```\r\n\r\nhttps://nextjs.org/docs/app/building-your-application/routing/dynamic-routes\r\n\r\nã©ã†ã§ã—ã‚‡ã†ã€`CSS`ãŒå½“ãŸã£ã¦ãªã‹ã£ãŸã‚Šã—ã¾ã™ãŒã€ã€ã€ã€ã¨ã‚Šã‚ãˆãšã¯å‡ºã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã‹ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/hC0jLrc.png)\r\n\r\nã‚‚ã—`Conflicting app and page file found`ãŒã§ã¦ã—ã¾ã£ãŸã‚‰ã€ä¸€åº¦é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ç›´ã™ã¨ã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚  \r\n`npm run dev`\r\n\r\n## å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚° ã‚’è¿”ã—ã¦ã‚ã’ã‚‹\r\nå‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã§ç”Ÿæˆã•ã‚Œã‚‹ãƒ‘ã‚¹ä¸€è¦§ã‚’è¿”ã—ã¦ã‚ã’ã¾ã™ã€‚  \r\n`getStaticPaths`ã¯`AppRouter`ã§ã¯`generateStaticParams`ã«ãªã‚Šã¾ã™ã€‚  \r\n`API`ã¯ãã‚“ãªã«å¤‰ã‚ã£ã¦ãªã„ã¯ãšã§ã™ã€‚  \r\n\r\n`pages/posts/[blog].tsx`  \r\n```ts\r\n/**\r\n * ã“ã“ã§ç”Ÿæˆã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’åˆ—æŒ™ã—ã¦è¿”ã™ã€‚ï¼ˆå®Ÿéš›ã«ã¯ãƒ‘ã‚¹ã®ä¸€éƒ¨ï¼‰\r\n * \r\n * /posts/<ã“ã“> â†ã“ã“ã®éƒ¨åˆ†ã®åå‰ã‚’æ¸¡ã—ã¦ç”Ÿæˆã™ã¹ããƒšãƒ¼ã‚¸ã‚’å…¨éƒ¨åˆ—æŒ™ã—ã¦è¿”ã—ã¦ã‚‹\r\n * \r\n * ã“ã‚Œã‚‚ä¸Šè¨˜åŒæ§˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã¯å‘¼ã°ã‚Œãªã„ã€‚\r\n */\r\nexport const getStaticPaths: GetStaticPaths = async () => {\r\n    const fileNameList = (await ContentFolderManager.getBlogNameList())\r\n        // ã“ã®å ´åˆã¯ã‚­ãƒ¼ãŒ blog ã«ãªã‚‹ã‘ã©ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«åã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ï¼ˆ[page].tsxãªã‚‰ page ãŒã‚­ãƒ¼ã«ãªã‚‹ï¼‰\r\n        .map(name => ({ params: { blog: name } }))\r\n    return {\r\n        paths: fileNameList,\r\n        fallback: false\r\n    }\r\n}\r\n```\r\n\r\n`app/posts/[blog]/page.tsx`  \r\n```ts\r\n/**\r\n * ã“ã“ã§ç”Ÿæˆã™ã‚‹ãƒšãƒ¼ã‚¸ã‚’åˆ—æŒ™ã—ã¦è¿”ã™ã€‚ï¼ˆå®Ÿéš›ã«ã¯ãƒ‘ã‚¹ã®ä¸€éƒ¨ï¼‰\r\n * \r\n * /posts/<ã“ã“> â†ã“ã“ã®éƒ¨åˆ†ã®åå‰ã‚’æ¸¡ã—ã¦ç”Ÿæˆã™ã¹ããƒšãƒ¼ã‚¸ã‚’å…¨éƒ¨åˆ—æŒ™ã—ã¦è¿”ã—ã¦ã‚‹\r\n * \r\n * ã“ã‚Œã‚‚ä¸Šè¨˜åŒæ§˜ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã¯å‘¼ã°ã‚Œãªã„ã€‚\r\n */\r\nexport async function generateStaticParams() {\r\n    const fileNameList = await ContentFolderManager.getBlogNameList()\r\n    // ã“ã®å ´åˆã¯ã‚­ãƒ¼ãŒ blog ã«ãªã‚‹ã‘ã©ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«åã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ï¼ˆ[page].tsxãªã‚‰ page ãŒã‚­ãƒ¼ã«ãªã‚‹ï¼‰\r\n    return fileNameList.map((name) => ({ blog: name }))\r\n}\r\n```\r\n\r\n## 404.tsx ã‚’ not-found.tsx ã¸ç§»è¡Œã™ã‚‹\r\n`pages/404.tsx`ã‚‚`app/not-found.tsx`ã¸ç§»å‹•ã—ã¾ã™ã€‚  \r\nã“ã‚Œã§`pages`ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã¯å‰Šé™¤ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšãƒ»ãƒ»ãƒ»ï¼\r\n\r\n## CSS ã‚’ãªãŠã™\r\n`layout.tsx`ã§`css`ã‚’èª­ã¿è¾¼ã‚€ã“ã¨ãŒå‡ºæ¥ã¾ã™\r\n\r\n```tsx\r\nimport { Metadata } from \"next\"\r\nimport ClientLayout from \"./ClientLayout\"\r\n// ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®CSS\r\nimport \"highlight.js/styles/vs2015.css\"\r\n// ã‚°ãƒ­ãƒ¼ãƒãƒ«CSS\r\nimport \"../styles/css/global.css\"\r\n```\r\n\r\n## GoogleAnalytics ã‚’ãªãŠã™\r\nã“ã‚Œã¯`GA4`ã§`SPA`ã§ã‚‚ä½¿ãˆã‚‹è¨­å®šï¼ˆãªã‚“ã ã£ã‘ï¼Ÿã€ãƒ‘ã‚¹ã®å¤‰åŒ–ã‚’æ¤œçŸ¥ã™ã‚‹ã¿ãŸã„ãªã‚„ã¤ï¼‰ã‚’ã—ã¦ã„ãªã„å ´åˆã«å¿…è¦ã§ã™ã€‚  \r\n`useRouter`ã§é·ç§»æ™‚ã«ã‚¤ãƒ™ãƒ³ãƒˆã‚’å–å¾—ã—ã€ãã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã§`GAã®é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆ`ã‚’é£›ã°ã—ã¦ã„ãŸã‚„ã¤ã¯ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚  \r\n\r\nã“ãƒ¼ã‚†ãƒ¼ã‚„ã¤ â†“â†“â†“  \r\n```tsx\r\nuseEffect(() => {\r\n    const handleRouteChange = (url: string) => {\r\n        pageview(url)\r\n    }\r\n    router.events.on('routeChangeComplete', handleRouteChange)\r\n    return () => {\r\n        router.events.off('routeChangeComplete', handleRouteChange)\r\n    }\r\n}, [router.events])\r\n```\r\n\r\nã§ã€`useRouter usePathname useSearchParams`ã®3ã¤ã«åˆ†è£‚ã—ãŸãã†ãªã®ã§ç½®ãæ›ãˆã¾ã™ã€‚  \r\nã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\nhttps://nextjs.org/docs/app/api-reference/functions/use-router#router-events\r\n\r\n```tsx  \r\n/** Google Analytics 4 ã§åˆ©ç”¨ã™ã‚‹JavaScriptã‚’å·®ã—è¾¼ã‚€ã‚„ã¤ã€‚æœ¬ç•ªï¼ˆæ„å‘³æ·±ï¼‰ã®ã¿å®Ÿè¡Œ */\r\nexport default function GoogleAnalytics() {\r\n    const pathname = usePathname()\r\n    const searchParams = useSearchParams()\r\n\r\n    // Google Analytics ã¸next/routerã®ãƒšãƒ¼ã‚¸é·ç§»ã®çŠ¶æ…‹ã‚’é€šçŸ¥ã™ã‚‹\r\n    useEffect(() => {\r\n        const url = `${pathname}${searchParams}`\r\n        pageview(url)\r\n    }, [pathname, searchParams])\r\n\r\n    // æœ¬ç•ªãƒ“ãƒ«ãƒ‰æ™‚ã®ã¿ GoogleAnalytics ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã™ã‚‹\r\n    return (\r\n        <>\r\n            {!isDevelopment && <>\r\n                <Script\r\n                    strategy=\"afterInteractive\"\r\n                    src={`https://www.googletagmanager.com/gtag/js?id=${UA_TRACKING_ID}`}\r\n                />\r\n                <Script\r\n                    strategy=\"afterInteractive\"\r\n                    dangerouslySetInnerHTML={{\r\n                        __html: `\r\n                        window.dataLayer = window.dataLayer || [];\r\n                        function gtag(){dataLayer.push(arguments);}\r\n                        gtag('js', new Date());\r\n                        gtag('config', '${UA_TRACKING_ID}');\r\n                        gtag('config', '${GA_TRACKING_ID}');\r\n                    `}}\r\n                />\r\n            </>}\r\n        </>\r\n    )\r\n}\r\n```\r\n\r\n`app/layout.tsx`ã§å‘¼ã³å‡ºã›ã°è‰¯ã„ã®ã§ã™ãŒã€`<suspense>`ã§ããã‚‰ãªã„ã¨æ€’ã‚‰ã‚Œã¾ã™ã€‚  \r\n\r\n```tsx\r\n/** å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆéƒ¨åˆ† */\r\nexport default function RootLayout({ children, }: { children: React.ReactNode }) {\r\n    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æç”»ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚\r\n    return (\r\n        <html>\r\n            <body className={koruriFont.variable}>\r\n                {/* å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã¨ã‹ */}\r\n                <ClientLayout children={children} />\r\n                {/* GoogleAnalytics */}\r\n                <Suspense fallback={null}>\r\n                    <GoogleAnalytics />\r\n                </Suspense>\r\n            </body>\r\n        </html>\r\n    )\r\n}\r\n```\r\n\r\nã“ã‚Œã§ä¸€é€šã‚Šå‡ºæ¥ãŸã‹ãªï¼Ÿï¼Ÿï¼Ÿ\r\n\r\n## é™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã—ã‚’æœ‰åŠ¹ã«ã—ã¦ã€æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹\r\nhttps://nextjs.org/docs/pages/building-your-application/deploying/static-exports\r\n\r\n`next.config.js`ã«è¿½è¨˜ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```js\r\n// https://github.com/vercel/next.js/blob/canary/examples/progressive-web-app/next.config.js\r\nconst withPWA = require('next-pwa')({\r\n    // https://github.com/GoogleChrome/workbox/issues/1790#issuecomment-729698643\r\n    disable: process.env.NODE_ENV === 'development',\r\n    dest: 'public',\r\n})\r\n\r\nmodule.exports = withPWA({\r\n    output: 'export', // ã“ã‚Œ\r\n    trailingSlash: true,\r\n    experimental: {\r\n        scrollRestoration: true,\r\n    }\r\n})\r\n```\r\n\r\nã¾ãŸã€`output: 'export'`ãŒè¿½åŠ ã•ã‚ŒãŸå½±éŸ¿ã§ã€`npx next export`ãŒç„¡ããªã£ãŸãŸã‚ã€`package.json`ã«æ›¸ã„ãŸãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã‚‚ä¿®æ­£ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ï¼ˆ`npx next build`ã ã‘ã§ã‚ˆããªã‚Šã¾ã—ãŸï¼‰  \r\n\r\n```diff\r\n- \"deploy\": \"npm run build && npm run export && npm run postbuild\"\r\n+ \"deploy\": \"npm run build && npm run postbuild\"\r\n```\r\n\r\nã“ã‚Œã§ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã‚‹ã€‚å¤šåˆ†å‹•ãã¯ãšã€‚  \r\næµçŸ³ã«å…¨éƒ¨ã‚„ã‚‹ã¨æ™‚é–“ã‹ã‹ã‚Šã™ãã‚‹ã®ã§è¨˜äº‹ã‚’2å€‹ãã‚‰ã„ã«ã—ãŸã€‚\r\n\r\n### å‹ãƒã‚§ãƒƒã‚¯ãŒå³ã—ããªã£ãŸï¼Ÿ\r\nå‹ã®ãƒã‚§ãƒƒã‚¯ãŒå³ã—ããªã£ã¦ã„ã‚‹ï¼Ÿ\r\n\r\n```ts\r\n./components/MakingAppCard.tsx:120:20\r\nType error: Object is possibly 'undefined'.\r\n\r\n  118 |     const changeAppListPlatform = (platformName: string) => {\r\n  119 |         // ã‚ã‚ŒTypeScriptãã‚“ã“ã‚Œé€šã™ã‚“ã‹ï¼Ÿ\r\n> 120 |         setAppList(makingAppList.find(platformObj => platformObj.platfromName === platformName).appList)\r\n      |                    ^\r\n  121 |     }\r\n  122 | \r\n  123 |     /**\r\n```\r\n\r\n```ts\r\nconst makingApp = makingAppList.find(platformObj => platformObj.platfromName === platformName)\r\nif (makingApp) {\r\n    setAppList(makingApp.appList)\r\n}\r\n```\r\n\r\n`TypeScript`ã€ã‚¨ãƒ©ãƒ¼ãŒã‚ã‹ã‚Šã«ãã„æ°—ãŒã™ã‚‹ã‚“ã§ã™ã‘ã©ã€ç§ã ã‘ãªã‚“ã§ã™ã‹ã­ãƒ»ãƒ»ãƒ»\r\n\r\n```ts\r\n./src/MarkdownParser.ts:97:15\r\nType error: Type '{ label: string | null; level: number; hashTag: string; }[]' is not assignable to type 'TocData[]'.\r\n  Type '{ label: string | null; level: number; hashTag: string; }' is not assignable to type 'TocData'.\r\n    Types of property 'label' are incompatible.\r\n      Type 'string | null' is not assignable to type 'string'.\r\n        Type 'null' is not assignable to type 'string'.\r\n```\r\n\r\n`Kotlin`ã®`filterNotNull`ã«å½“ãŸã‚‹å‡¦ç†ãŒæ€ã„ã¤ã‹ãªã„ã®ã§èª¿ã¹ãŸã‚“ã§ã™ãŒã€`flatMap`ã‚’ä½¿ã†æ–¹æ³•ã ã¨å‹ã‚’äºˆæ¸¬ã—ã¦è§£æ±ºã—ã¦ãã‚Œã¦ã„ã„æ„Ÿã˜ã€‚  \r\nhttps://stackoverflow.com/questions/43118692/typescript-filter-out-nulls-from-an-array\r\n\r\n```ts\r\n/**\r\n * HTML ã‚’è§£æã—ã¦ ç›®æ¬¡ãƒ‡ãƒ¼ã‚¿ã‚’ä½œæˆã™ã‚‹ã€‚çµæ§‹æ™‚é–“ãŒã‹ã‹ã‚‹ã€‚\r\n * \r\n * @param html HTML\r\n * @returns ç›®æ¬¡ãƒ‡ãƒ¼ã‚¿ã®é…åˆ—\r\n */\r\nstatic parseToc(html: string): TocData[] {\r\n    // HTML ãƒ‘ãƒ¼ã‚µãƒ¼ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’åˆ©ç”¨ã—ã¦ h1 , h2 ... ã‚’å–å¾—ã™ã‚‹\r\n    // ã“ã®é–¢æ•°ã¯ ãƒ–ãƒ©ã‚¦ã‚¶ ã§ã¯ãªã Node.js ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ãŸã‚ã€document ã¯ä½¿ãˆãªã„ã€‚\r\n    const window = (new JSDOM(html)).window\r\n    const document = window.document\r\n    const tocElementList = document.querySelectorAll('h1, h2, h3, h4, h5, h6')\r\n    // ç›®æ¬¡ãƒ‡ãƒ¼ã‚¿ã«å¤‰æ›ã—ã¦è¿”ã™\r\n    const tocDataList: TocData[] = Array.from(tocElementList)\r\n        .map(element => {\r\n            if (element.textContent) {\r\n                return {\r\n                    label: element.textContent,\r\n                    level: Number(element.tagName.charAt(1)), // h1 ã® 1 ã ã‘å–ã‚Šå‡ºã—æ•°å€¤å‹ã¸\r\n                    hashTag: `#${element.getAttribute('id')}` // idå±æ€§ ã‚’å–ã‚Šå‡ºã—ã€å…ˆé ­ã«#ã‚’ã¤ã‘ã‚‹\r\n                }\r\n            } else {\r\n                return null\r\n            }\r\n        })\r\n        // null ã‚’é…åˆ—ã‹ã‚‰æ¶ˆã™æŠ€ã§ã™\r\n        .flatMap(tocDataOrNull => tocDataOrNull ? [tocDataOrNull] : [])\r\n    window.close()\r\n    return tocDataList\r\n}\r\n```\r\n\r\n### é™çš„æ›¸ãå‡ºã—çµæœã‚’è¦‹ã¦ã¿ã‚‹\r\n`npx next start`ã¯ä½¿ãˆãªããªã‚Šã¾ã—ãŸã€‚  \r\n\r\n```plaintext\r\nError: \"next start\" does not work with \"output: export\" configuration. Use \"npx serve@latest out\" instead.\r\n```\r\n\r\nã‹ã‚ã‚Šã«ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§èµ·å‹•ã§ãã¾ã™ã€‚  \r\n\r\n```shell\r\nnpx serve@latest out\r\n```\r\n\r\nã†ãƒ¼ã‚“ãªã‚“ã‹å…¨ç„¶å‹•ã„ã¦ç„¡ããªã„ã‹ï¼Ÿ  \r\n~~`/posts/page/1/`ã‚’æŠ¼ã—ã¦ã‚‚ãªã‚“ã‹ãƒ‘ã‚¹ãŒä¸­é€”åŠç«¯ãªã‚“ã§ã™ã‘ã©ï¼Ÿ~~ â†’ `generateStaticParams`é–“é•ã£ã¦ã¾ã—ãŸã€‚ã”ã‚ã‚“ãªã•ã„\r\n\r\n![Imgur](https://imgur.com/Kfoniwd.png)\r\n\r\n# ã¤ã„ã§ã«ç›´ã—ãŸã„ã¨ã“ã‚\r\nä»–ã«ç›´ã—ãŸã„éƒ¨åˆ†ãŒä½•å€‹ã‹ã‚ã‚‹ã‚“ã§ã™ã‚ˆã­...\r\n\r\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ãƒãƒ¼ãƒ‰ã‚³ãƒ¼ãƒˆã™ã‚‹ã®ã‚’ã‚„ã‚ã¦ã€ç’°å¢ƒå¤‰æ•°ã«ã™ã‚‹\r\n- ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆé€šã‚Šã®ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ç”Ÿæˆã‚’ä½¿ã†\r\n- app/README.md æ›´æ–°ã™ã‚‹\r\n- Babel ã‚’ã‚„ã‚ãŸã„\r\n- ServiceWorker ã‚„ã‚ãŸã„\r\n- next/font ã‚’åˆ©ç”¨ã—ãŸã„\r\n- ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã®ç”»åƒå¤‰ãˆãŸã„\r\n- ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ç”Ÿæˆã‚‚å¤‰ãˆãŸã„\r\n- 404 ã®ç”»åƒå¤‰ãˆãŸã„\r\n- OSSãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç”»é¢æ›´æ–°\r\n- ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã®ä¿®æ­£ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªç„¡ã—ã§ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ç”Ÿæˆã—ãŸã®ã§`postbuild`ãªã—ã§ã‚ˆããªã£ãŸã€‚`npx next build`ã ã‘ã§ã„ã„ã¯ãšï¼‰\r\n\r\n## ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ç”Ÿæˆ\r\n`App Router`ã‹ã‚‰ã€ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ç”ŸæˆãŒãƒ©ã‚¤ãƒ–ãƒ©ãƒªç„¡ã—ã§ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã£ã½ã„ã®ã§ã€ç§»è¡Œã—ã¾ã™ã€‚  \r\nhttps://nextjs.org/docs/app/api-reference/file-conventions/metadata/sitemap\r\n\r\n`app/sitemap.ts`  \r\n```ts\r\nimport { MetadataRoute } from \"next\";\r\nimport UrlTool from \"../src/UrlTool\";\r\nimport ContentFolderManager from \"../src/ContentFolderManager\";\r\n\r\n/**\r\n * ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã‚’ç”Ÿæˆã™ã‚‹ã€‚Next.js å˜ä½“ã§ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚\r\n * Trailing Slash ãŒæœ‰åŠ¹ãªã®ã§æœ€å¾Œã«ã‚¹ãƒ©ãƒƒã‚·ãƒ¥å…¥ã‚Œã¾ã—ãŸã€‚\r\n */\r\nexport default async function sitemap(): Promise<MetadataRoute.Sitemap> {\r\n    const currentTime = new Date()\r\n\r\n    // é™çš„ãƒšãƒ¼ã‚¸\r\n    const staticPathList: MetadataRoute.Sitemap = [\r\n        {\r\n            url: `${UrlTool.BASE_URL}/`,\r\n            lastModified: currentTime\r\n        }\r\n    ]\r\n\r\n    // ãƒ–ãƒ­ã‚°è¨˜äº‹\r\n    const blogPathList = (await ContentFolderManager.getBlogNameList())\r\n        .map(name => ({\r\n            url: `${UrlTool.BASE_URL}/posts/${name}/`,\r\n            lastModified: currentTime\r\n        }))\r\n\r\n    // å›ºå®šãƒšãƒ¼ã‚¸\r\n    const pagePathList = (await ContentFolderManager.getPageNameList())\r\n        .map(name => ({\r\n            url: `${UrlTool.BASE_URL}/pages/${name}/`,\r\n            lastModified: currentTime\r\n        }))\r\n\r\n    return [...staticPathList, ...blogPathList, ...pagePathList]\r\n}\r\n```\r\n\r\n`npm run build`ã—ãŸã‚ã¨`out/sitemap.xml`ãŒå‡ºæ¥ã¦ã€ã“ã‚“ãªã®ãŒå‡ºã¦ãã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"UTF-8\"?>\r\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\">\r\n<url>\r\n<loc>https://takusan.negitoro.dev/</loc>\r\n<lastmod>2023-06-18T17:15:15.809Z</lastmod>\r\n</url>\r\n<url>\r\n<loc>https://takusan.negitoro.dev/posts/next_js_13_app_router_migration/</loc>\r\n<lastmod>2023-06-18T17:15:15.809Z</lastmod>\r\n</url>\r\n<url>\r\n<loc>https://takusan.negitoro.dev/posts/windows_winui3_installer_and_virtual_desktop/</loc>\r\n<lastmod>2023-06-18T17:15:15.809Z</lastmod>\r\n</url>\r\n<url>\r\n<loc>https://takusan.negitoro.dev/pages/about/</loc>\r\n<lastmod>2023-06-18T17:15:15.809Z</lastmod>\r\n</url>\r\n</urlset>\r\n```\r\n\r\n## Babel ã‚’ã‚„ã‚ã¦ SWC ã«ã™ã‚‹\r\nhttps://nextjs.org/docs/architecture/nextjs-compiler\r\n\r\nãã‚‚ãã‚‚ä½•ã ã“ã‚Œã¯ã¨ã„ã†è©±ã§ã™ãŒã€ãªã‚“ã‹`SWC`ã‚’ä½¿ã£ãŸã»ã†ãŒé«˜é€Ÿã«å‹•ãã‚‰ã—ã„ã€‚  \r\nã§ã€`SWC`ã«ã—ãŸã„ã¨ã“ã‚ãªã‚“ã§ã™ãŒã€ã€`Babel`ã§`svg`ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåŒ–ã™ã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ã“ã®ä»£ã‚ã‚Šã‚’ã©ã†ã«ã‹ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\nå›°ã£ã¦ã‚‹äººç§ä»¥å¤–ã«ã‚‚ã„ãŸ  \r\nhttps://github.com/vercel/next.js/discussions/33161\r\n\r\n`SVGR`ã‚’ä½¿ã£ã¦ã„ã‚‹äººãŒå¤šãã†ã‹ãªã€ã˜ã‚ƒã‚ã“ã‚Œã§  \r\nhttps://react-svgr.com/docs/next/\r\n\r\n`.babelrc`ã‚’æ¶ˆã—ã¦ã€ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚‚æ¶ˆã—ã¡ã‚ƒã„ã¾ã™ã€‚  \r\n\r\næ¬¡ã«å…¥ã‚Œã¦  \r\n`npm install --save-dev @svgr/webpack`\r\n\r\n`next.config.js`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚  \r\n`webpack`ã®ç®‡æ‰€ã§ã™ã­ã€‚  \r\n\r\n```js\r\noutput: 'export',\r\ntrailingSlash: true,\r\nwebpack(config) {\r\n    // SVG ã‚’ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã§ãã‚‹\r\n    config.module.rules.push({\r\n        test: /\\.svg$/,\r\n        use: ['@svgr/webpack'],\r\n    })\r\n    return config\r\n},\r\nexperimental: {\r\n    scrollRestoration: true,\r\n}\r\n```\r\n\r\nã‚ã¨ã¯`svg`ã®ãƒ‘ã‚¹ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¦ã€JSXæ›¸ã‘ã°è‰¯ã„ã¯ãšï¼ã™ã”ã„ï¼  \r\n\r\n```tsx\r\n// https://react-svgr.com/docs/next/ å‚ç…§\r\nimport NotFoundIcon from \"../public/not_found.svg\"\r\n\r\nexport default function Component() {\r\n    return (\r\n        <>\r\n            <NotFoundIcon\r\n                className={'theme_color'}\r\n                height={250}\r\n                width={250}\r\n            />\r\n```\r\n\r\n## next/font ã‚’ä½¿ã†\r\nã“ã£ã¡ã®æ–¹ãŒã„ã„ã‚‰ã—ã„ã€‚ã®ã§  \r\nå‰ã¯`@next/font`ã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã£ãŸã¿ãŸã„ã§ã™ãŒã€`Next.js`ã«çµ„ã¿è¾¼ã¾ã‚ŒãŸã¿ãŸã„ãªã®ã§ã€å…¥ã‚Œãªãã¦ã‚‚ä½¿ãˆã‚‹ã‚‰ã—ã„ã€‚  \r\n`app/layout.tsx`ã§èª­ã¿è¾¼ã‚ã°è‰¯ã•ãã†ã€‚  \r\n\r\nç”¨æ„ã—ãŸãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã¿ãŸã„ã®ã§ã€`local`ã®æ–¹ã‚’ä½¿ã†ã½ã„  \r\nhttps://nextjs.org/docs/app/building-your-application/optimizing/fonts#local-fonts\r\n\r\n`variable`ã‚’æŒ‡å®šã™ã‚‹ã¨ã€`.css`ãªã©ã‹ã‚‰å‚ç…§ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\n`<body className={koruriFont.variable}>`ã‚’å¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚ï¼ˆä¸€æ•—ï¼‰\r\n\r\n`app/layout.tsx`  \r\n```tsx\r\nimport localFont from \"next/font/local\"\r\n\r\n/** ãƒ•ã‚©ãƒ³ãƒˆã‚’èª­ã¿è¾¼ã‚€ */\r\nconst koruriFont = localFont({\r\n    // CSS å¤‰æ•°ã¨ã—ã¦ä½¿ã†\r\n    variable: '--koruri-font',\r\n    src: [\r\n        { path: '../styles/css/fonts/Koruri-Regular-sub.eot' },\r\n        { path: '../styles/css/fonts/Koruri-Regular-sub.ttf' },\r\n        { path: '../styles/css/fonts/Koruri-Regular-sub.woff' },\r\n    ]\r\n})\r\n\r\n/** å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆéƒ¨åˆ† */\r\nexport default function RootLayout({ children, }: { children: React.ReactNode }) {\r\n    // ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦æç”»ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãŸã‚\r\n    return (\r\n        <html>\r\n            <body className={koruriFont.variable}>\r\n                {/* å…±é€šãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€‚ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã¨ã‹ */}\r\n                <ClientLayout children={children} />\r\n                {/* GoogleAnalytics */}\r\n                <Suspense fallback={null}>\r\n                    <GoogleAnalytics />\r\n                </Suspense>\r\n            </body>\r\n        </html>\r\n    )\r\n}\r\n```\r\n\r\n`CSS`ã‹ã‚‰ã¯`var()`ã§å‚ç…§ã§ãã¾ã™ã€‚  \r\n`global.css`  \r\n```css\r\n/* ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ */\r\ncode {\r\n    overflow-x: scroll;\r\n    font-family: var(--koruri-font);\r\n    background-color: rgba(0, 0, 0, 0.05);\r\n}\r\n```\r\n\r\n`Material-UI`ã®`createTheme`ã‚‚å¤šåˆ†ã“ã‚Œã§å‚ç…§ã§ãã¦ã„ã‚‹ã¯ãšã€‚  \r\n```ts\r\ncreateTheme({\r\n    typography: {\r\n        fontFamily: [\r\n            'var(--koruri-font)'\r\n        ].join(','),\r\n    }\r\n})\r\n```\r\n\r\nã¯ã„  \r\n![Imgur](https://imgur.com/fiMT1nU.png)\r\n\r\n## next/head ãŒç„¡ããªã£ã¦ã—ã¾ã£ãŸã®ã§ã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ head ãŒæ“ä½œã§ããªã„ï¼Ÿ\r\nå”¯ä¸€å›°ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ã€‚  \r\n`next/head`ã‚’ä½¿ã£ã¦ã€ãƒ†ãƒ¼ãƒã®è‰²ã«åˆã‚ã›ã¦`Android`ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã®è‰²ã‚‚åŒã˜è‰²ã«åˆã‚ã›ã‚‹ã‚ˆã†ã«ã—ã¦ã„ãŸã®ã§ã™ãŒã€`AppRouter`ã§ä½¿ãˆãªããªã£ã¦ã—ã¾ã£ãŸã€‚  \r\nã¨ã‚Šã‚ãˆãš`DOM`ã‚’`JavaScript`ã§ç„¡ç†ã‚„ã‚Šå¤‰ãˆã¦ã‚‹ã‚“ã§ã™ã‘ã©ã€ã€ã€ã“ã‚Œã§ã„ã„ã®ï¼Ÿ  \r\n\r\n```ts\r\n\"use client\"\r\n\r\nimport { useEffect, useRef } from \"react\"\r\n\r\n/**\r\n * Androidã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒãƒ¼ã«è‰²ã‚’è¨­å®šã™ã‚‹\r\n * AppRouter ã ã¨ next/head ãŒä½¿ãˆãªã„ã€‚å¤šåˆ†ç¾çŠ¶ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ head ã®ä¸­èº«ã‚’å¤‰ãˆã‚‹æ–¹æ³•ãŒ Next.js ã«ã¯ãªã•ãã†ï¼Ÿ\r\n * ä»•æ–¹ãªã„ã®ã§ã€DOM ã‚’è§¦ã‚‹ã€‚\r\n * \r\n * @param colorCode ã‚«ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰\r\n */\r\nexport default function useAndroidStatusBarColor(colorCode: string) {\r\n    const statusBarColorMeta = useRef<HTMLMetaElement>()\r\n\r\n    // è¿½åŠ ã™ã‚‹\r\n    useEffect(() => {\r\n        statusBarColorMeta.current = document.createElement('meta')\r\n        statusBarColorMeta.current.setAttribute('name', 'theme-color')\r\n        document.head.append(statusBarColorMeta.current)\r\n    }, [])\r\n\r\n    // è‰²ãŒå¤‰åŒ–ã—ãŸã‚‰æ›´æ–°ã™ã‚‹\r\n    useEffect(() => {\r\n        statusBarColorMeta.current?.setAttribute('content', colorCode)\r\n    }, [colorCode])\r\n}\r\n```\r\n\r\n# å‹•ãã¾ã—ãŸï¼\r\n`pages`â†’`app`å·®åˆ†ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™ã€‚  \r\n\r\nhttps://github.com/takusan23/ziyuutyou-next/pull/1\r\n\r\nå®Ÿéš›ã«é©å½“ã«å…¬é–‹ã—ã¦ã‚‚å•é¡Œãªã•ãã†ã ã£ãŸã®ã§ã€äººãŒã„ãªã•ãã†ãªæ™‚ã«ã‚ã’ã‚ˆã†ã‹ãªã€‚ã„ã‚„åˆ¥ã«ã„ã¤ã§ã‚‚è‰¯ã„ã‹ãƒ»ãƒ»ï¼Ÿ  \r\n\r\n## 2023/07/11 åˆå‰2~3æ™‚ ãã‚‰ã„ã«å…¥ã‚Œã¾ã—ãŸ\r\n`Next.js` `AppRouter` å¯¾å¿œã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nè¦‹ã¦ã‚‹äººç„¡ã•ãã†ã ã£ãŸã®ã§ï¼ˆãã‚‚ãã‚‚ã‚ã‚“ã¾ã‚Šå±…ãªã„ï¼›ï¼›\r\n\r\n# ãŠã‚ã‚Šã«\r\nã‚ã¡ã‚ƒé–¢ä¿‚ãªã„ã‘ã©`Tailwind CSS`ï¾ï½®ï½¯ï¾„ã ã‘è§¦ã£ã¦ã¿ã¾ã—ãŸãŒã€ã“ã‚Œã§è‰¯ããªã„ï¼Ÿ  \r\nã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¨ã—ã¦ã‚‚`Tailwind CSS`ã¯ä½¿ãˆã‚‹ã¿ãŸã„ãªã®ã§`Material-UI`ã‚’ã‚„ã‚ã¦ã‚‚ã„ã„ã‹ã‚‚ã—ã‚Œãªã„  \r\n\r\nã‚ã¨å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã€Chromeã®ç¿»è¨³ã—ã¦ã‚‹ã¨ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å¤±æ•—ã—ãªã„ï¼Ÿ  \r\nã‚ã¨`VSCode`ã¯`Altã‚­ãƒ¼`ã‚’æŠ¼ã—ãªãŒã‚‰ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã™ã‚‹ã¨é«˜é€Ÿã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã§ãã¾ã™ã€‚  \r\n\r\n# ãŠã‚ã‚Šã«2\r\nã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãŒãŸã‚Šãªã„ï¼ï¼ï¼\r\n\r\n`[Error: ENOSPC: no space left on device, write]`"},{"title":"Next.js 13 ã«ã—ãŸ (ã—ãŸã ã‘)","link":"/posts/next_js_13_migration/","markdown":"ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹ã ã‘ã—ã¦`pagesãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª`ã®ã¾ã¾ä½¿ã†ã€‚\r\n\r\n# æœ¬é¡Œ\r\n`Next.js`ã‚’`13`ã¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã™\r\n\r\n```\r\nnpm i next@latest react@latest react-dom@latest\r\n```\r\n\r\nã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¾ã—ãŸ\r\n\r\n```\r\n+ react@18.2.0\r\n+ react-dom@18.2.0\r\n+ next@13.0.4\r\nadded 2 packages from 1 contributor, updated 9 packages and audited 679 packages in 29.044s\r\n```\r\n\r\nãªã‚“ã‹è„†å¼±æ€§ãŒã‚ã‚‹ã¨è¨€ã‚ã‚ŒãŸã®ã§ã€`npm audit`ã§ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ç‰¹å®šã—ãŸã®ã¡ã€\r\n\r\n```\r\nnpm i next-pwa@latest\r\n```\r\n\r\nã‚’å®Ÿè¡Œã—ã¾ã—ãŸã€‚\r\n\r\n```\r\n+ next-pwa@5.6.0\r\nadded 1 package from 1 contributor, removed 2 packages, updated 124 packages and audited 678 packages in 47.296s\r\n```\r\n\r\nã¯ã„ï¼å‹•ã‹ãªããªã‚Šã¾ã—ãŸï¼\r\n\r\n![Imgur](https://imgur.com/j6iRaTB.png)\r\n\r\n# ã¤ã„ã§ã« Material UI ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ\r\n\r\n```\r\nnpm install @mui/material @emotion/react @emotion/styled\r\n```\r\n\r\nã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã§ãã¾ã—ãŸ\r\n\r\n```\r\n+ @mui/material@5.10.14\r\n+ @emotion/styled@11.10.5\r\n+ @emotion/react@11.10.5\r\nadded 23 packages from 8 contributors, removed 4 packages, updated 36 packages and audited 697 packages in 34.223s\r\n```\r\n\r\nã—ã‹ã—å‹•ã‹ãš...ãã¬ã¬\r\n\r\n# åŸå› ã¯ next/link ã®å­è¦ç´ ã‚’ aã‚¿ã‚° ã§ããã£ã¦ãŸã‹ã‚‰\r\nã©ã†ã‚„ã‚‰`Next.js 13`ã‹ã‚‰å­è¦ç´ ã‚’`a`ã«ã™ã‚‹å¿…è¦ãŒãªããªã£ãŸæ¨¡æ§˜ã€‚ãªã®ã§`MUI`ã®`component=\"a\"`ã‚’æ¶ˆã›ã°ã„ã„ã‚‰ã—ã„ã€‚\r\n\r\n```tsx\r\n/** ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */\r\nconst NavigationLink = () => {\r\n    return (\r\n        <Box>\r\n            <List>\r\n                {\r\n                    // mapã§Elementã‚’è¿”ã™\r\n                    linkList.map(linkData => (\r\n                        <Link href={linkData.link} passHref key={linkData.link}>\r\n                            <ListItemButton component=\"a\">\r\n                                <ListItemIcon>{linkData.icon}</ListItemIcon>\r\n                                <ListItemText primary={linkData.title} />\r\n                            </ListItemButton>\r\n                        </Link>\r\n                    ))\r\n                }\r\n            </List>\r\n        </Box>\r\n    )\r\n}\r\n```\r\n\r\næ¶ˆã—ãŸã‚‰ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆãŒãƒ€ã‚µããªã£ãŸã®ã§ã€`aã‚¿ã‚°`ã®ä¸‹ã®ç·šã¨è‰²ã‚’æ¶ˆã™ã‚ˆã†ãª`CSS`ã‚’ã‚»ãƒƒãƒˆã—ã¾ã™ã€‚`CSS`ã‚¬ãƒã§ã©ã“ã«ã‹ã‘ã°åæ˜ ã•ã‚Œã‚‹ã®ã‹ã‚ã‹ã‚‰ã‚“ï¼›ï¼›\r\n\r\n```tsx\r\n/** ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ */\r\nconst NavigationLink = () => {\r\n    return (\r\n        <Box>\r\n            <List>\r\n                {\r\n                    // mapã§Elementã‚’è¿”ã™\r\n                    linkList.map(linkData => (\r\n                        <Link\r\n                            style={{\r\n                                textDecoration: 'none',\r\n                                color: 'inherit'\r\n                            }}\r\n                            href={linkData.link}\r\n                            key={linkData.link}\r\n                        >\r\n                            <ListItemButton>\r\n                                <ListItemIcon>{linkData.icon}</ListItemIcon>\r\n                                <ListItemText primary={linkData.title} />\r\n                            </ListItemButton>\r\n                        </Link>\r\n                    ))\r\n                }\r\n            </List>\r\n        </Box>\r\n    )\r\n}\r\n```\r\n\r\nä»¥ä¸‹ã®ã‚ˆã†ã«`<a>`ã§ããã£ã¦ãŸéƒ¨åˆ†ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ã«ç½®ãæ›ãˆã‚‰ã‚Œã¾ã™ã€‚\r\n\r\n```tsx\r\n<Link passHref href={props.blogItem.link}>\r\n    <a style={{ color: theme.palette.primary.main, fontSize: 25 }} >\r\n        {props.blogItem.title}\r\n    </a>\r\n</Link>\r\n```\r\n\r\nâ†“\r\n\r\n```tsx\r\n<Link\r\n    style={{\r\n        color: theme.palette.primary.main,\r\n        fontSize: 25\r\n    }}\r\n    href={props.blogItem.link}\r\n>\r\n    {props.blogItem.title}\r\n</Link>\r\n```\r\n\r\n`<Chip>`ã®å ´åˆã¯`clickable`å±æ€§ã‚’ã¤ã‘ã‚‹ã¨ãƒã‚¦ã‚¹ãƒã‚¤ãƒ³ã‚¿ã‚‚ã„ã„æ„Ÿã˜ã«å‡ºæ¥ã¾ã™\r\n\r\n```tsx\r\n<Link\r\n    style={{\r\n        textDecoration: 'none',\r\n        color: 'inherit'\r\n    }}\r\n    href={`/posts/tag/${data.name}/`}\r\n    key={data.name}\r\n>\r\n    <Chip\r\n        sx={{\r\n            marginRight: 1,\r\n            marginTop: 1\r\n        }}\r\n        clickable\r\n        color=\"primary\"\r\n        icon={<LocalOfferOutlined />}\r\n        label={`${data.name} - ${data.count} ä»¶`}\r\n    />\r\n</Link>\r\n```\r\n\r\nãŠã‚ã‚Šã€‚  \r\n`appãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª`ã¯ãªã‚“ã‹é›£ã—ãã†...ã ã—`Netlify`ã§å‹•ãã‹åˆ†ã‹ã‚‰ã‚“ã®ã§æ§˜å­è¦‹ã—ã¾ã™ ( Ë˜Ï‰Ë˜)ï½½ï¾”ï½§\r\n\r\n# ãŠã¾ã‘\r\n`Netlify`ã®`Build image`ãŒå¤ãã¦ã‚³ã‚±ã¦ã¾ã—ãŸã€‚  \r\n`Ubuntu`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼Ÿã©ã†ã‚„ã‚‰è­¦å‘ŠãŒæ¥ã¦ã„ãŸãã†ã§ã™ãŒè¦‹è½ã¨ã—ã¦ã¾ã—ãŸã€‚ã™ã„ã¾ã›ã‚“\r\n\r\n![Imgur](https://imgur.com/k5yYXC4.png)\r\n\r\n## ãƒ†ã‚¹ãƒˆã™ã‚‹\r\nå¤šåˆ†å‹•ãã¨æ€ã†ã®ã§ã™ãŒã€ä¸€å¿œã¡ã‚ƒã‚“ã¨è¦‹ã‚Œã‚‹ã‹ç¢ºèªã—ãŸã„ã§ã™ã€‚  \r\nè‡ªå‹•å…¬é–‹ã‚’ã‚ªãƒ•ã«ã™ã‚‹ã¨å‹•ä½œç¢ºèªã§ãã‚‹ãã†ã§ã™ã€‚\r\n\r\n`Lock to stop auto publishing` ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/fy4lEKx.png)\r\n\r\nãã®ã‚ã¨`Site setting`ã¸é€²ã¿`Build & Deploy`ã®`Build image`ã‚’æ–°ã—ã„ã®ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/WdiYnJg.png)\r\n\r\nå‡ºæ¥ãŸã‚‰`Deploys`ã«æˆ»ã‚Šã€æ‰‹å‹•ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ã—ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/206PDDO.png)\r\n\r\nãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã®ã§ã¾ã å¤ã„ã¾ã¾ã®æˆæœç‰©ãŒãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã•ã‚Œã¦ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/VDRodqk.png)\r\n\r\nã¡ãªã¿ã«ä»Šå›ã¯ç‰¹ã«ä½•äº‹ã‚‚ãªããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã¾ã—ãŸã€‚ä»¥ä¸Šã§ã™ã€‚"},{"title":"Next.jsã¸Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®GA4ã¨UAã‚’å…±å­˜ã•ã›ã‚‹","link":"/posts/next_js_google_analytics_ua_ga4/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\n\r\nã‚­ã‚¹ã‹ã‚‰å§‹ã¾ã‚‹ã‚®ãƒ£ãƒ«ã®æ‹ ã€œãã‚‹ã¿ã®ã‚¦ãƒ¯ã‚µã¨ãƒ›ãƒ³ãƒˆã®ã‚­ãƒ¢ãƒã€œ æ”»ç•¥ã—ã¾ã—ãŸã€‚\r\n\r\nã„ã„ã­ï¼æ¬¡å›ä½œã‚‚äºˆç´„ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/kBGvFeJ.png)\r\n\r\nä¸å¯§ã«æ›¸ã‹ã‚Œã¦ã¦ï¼Ÿè‰¯ã‹ã£ãŸã¨æ€ã„ã¾ã™\r\n\r\n![Imgur](https://imgur.com/gZpbJXu.png)\r\n\r\n# æœ¬é¡Œ\r\n\r\nGoogleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‹ã‚‰GA4ã‚’ä½¿ã£ã¦ã¿ã¾ã›ã‚“ã‹ã£ã¦å®šæœŸçš„ã«ãƒ¡ãƒ¼ãƒ«ã§ãŠçŸ¥ã‚‰ã›ã—ã¦ãã‚‹ã®ã§å¯¾å¿œã—ã¦ã¿ãŸã€‚  \r\nNext.jsã§ä½œã‚Šç›´ã—ãŸè¨˜å¿µã«\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ  | ã‚ãŸã„                                                                       |\r\n|---------|------------------------------------------------------------------------------|\r\n| Windows | 10 Pro                                                                       |\r\n| Next.js | è¨˜è¿°æ™‚æ™‚ç‚¹æœ€æ–°ç‰ˆ                                                             |\r\n| React   | 17                                                                           |\r\n| è¨€èª    | TypeScriptã€‚JavaScriptã®å ´åˆã¯ã‚³ãƒ”ãƒšå‡ºæ¥ãªã„ã®ã§ã«ã‚‰ã‚ã£ã“ã—ã¦æ›¸ãæ›ãˆã¦ï¼›ï¼› |\r\n\r\n# å‚è€ƒ\r\n\r\nthx!!!!!\r\n\r\nhttps://github.com/vercel/next.js/tree/main/examples/with-google-analytics\r\n\r\nhttps://panda-program.com/posts/nextjs-google-analytics\r\n\r\n## GA4 ã¨ UA ã¯ãœã‚“ãœã‚“é•ã†ï¼Ÿ\r\nãªã‚“ã‹å¾Œç¶™ã¿ãŸã„ãªé›°å›²æ°—ï¼ˆãªãœã‹å¤‰æ›ã§ããªã„ï¼ˆã§ãã¦ã‚‹ï¼‰ï¼‰å‡ºã—ã¦ã¾ã™ãŒã€UIã‹ã‚‰ã—ã¦çµæ§‹é•ã†ã‚·ã‚¹ãƒ†ãƒ ã‚‰ã—ã„ï¼Ÿ  \r\nãªã‚“ãªã‚‰`ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ (UA)`æ™‚ä»£ã«é›†è¨ˆã—ãŸãƒ‡ãƒ¼ã‚¿ã¯`Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ 4 (GA4)`ã«ã¯å¼•ãç¶™ã’ãªã„ã¿ãŸã„ã§ã™ã‚ˆï¼Ÿ\r\n\r\nãƒ‡ãƒ¼ã‚¿ãŒGA4ã«å¼•ãç¶™ã’ãªã„ã®ã¯ã—ã‚“ã©ã„ã®ã§ã€ã¨ã‚Šã‚ãˆãšã¯`ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹`ã¨`Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ 4`ã®åŒæ™‚åˆ©ç”¨ã§è¡Œãã¾ã™ï¼ˆåŒã˜çµæœãŒé›†è¨ˆã•ã‚Œã‚‹ã¯ãšï¼‰ã€‚\r\n\r\n(ã¡ã‚‡ã£ã¨æ™‚é–“ãŒçµŒã£ã¡ã‚ƒã£ãŸã‹ã‚‰ã†ã‚è¦šãˆ)\r\n\r\n## å˜èªé›†\r\n\r\n| ããƒ¼                       | ã°ã‚Šã‚…ãƒ¼                                                   |\r\n|----------------------------|------------------------------------------------------------|\r\n| ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ | ç•¥ã—ã¦UAã€‚è¨­å®šã‚’é–‹ã„ãŸéš›ã«`GA4 è¨­å®šã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ`ãŒã‚ã‚Œã°UA |\r\n| Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ 4    | ç•¥ã—ã¦GA4ã€‚ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã®ãƒšãƒ¼ã‚¸ã«åœ°å›³ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚Œã°GA4 |\r\n| æ¸¬å®š ID                    | GA4ã§ä½¿ã†IDã€‚ **G-** ã‹ã‚‰å§‹ã¾ã‚‹                            |\r\n| ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰         | UAã§ä½¿ã†IDã€‚ **UA-** ã‹ã‚‰å§‹ã¾ã‚‹                            |\r\n\r\n# æ—¢å­˜ã®ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã§GA4ã‚’æœ‰åŠ¹ã«ã™ã‚‹\r\nãƒ–ãƒ©ã‚¦ã‚¶ã§UAã®æ–¹ã®è¨­å®šç”»é¢ã‚’é–‹ã„ã¦ã€`Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ 4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®šã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ`ã‚’é¸ã‚“ã§ã€å§‹ã‚ã¾ã™\r\n\r\n![Imgur](https://imgur.com/FPOrU2F.png)\r\n\r\nã“ã‚“ãªç”»é¢ãŒå‡ºã‚‹ã‘ã©ã€ä»Šå›ã¯ UA â†’ GA4 ã¸ã‚¤ãƒ™ãƒ³ãƒˆã®è»¢é€ã¯è¡Œã‚ãšã«ã€ãã‚Œãã‚Œå¯¾å¿œã™ã‚‹ã®ã§ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã¯ãã®ã¾ã¾ã«ã—ã¦ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’ä½œæˆã‚’ãŠã—ã¾ã™ã€‚  \r\n(è‡ªåˆ†ã§HTMLã‚’æ›¸ãæ›ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ãªã„å ´åˆã®ãŸã‚ã®å‡¦ç½®ã ã¨æ€ã†)\r\n\r\n![Imgur](https://imgur.com/pv04NvW.png)\r\n\r\nä½œæˆã§ãã‚‹ã¨GA4ã®ç®¡ç†ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã§ãã‚‹ãƒœã‚¿ãƒ³ãŒç¾ã‚Œã‚‹ã®ã§ãã®ã¾ã¾ãŠã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/FB4Gd2Y.png)\r\n\r\nç§»å‹•ã—ãŸã‚‰ã€`ã‚¿ã‚°ã®è¨­å®š`ã‚’æŠ¼ã—ã¦ã€ä¸€ã¤ã ã‘ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒªãƒ¼ãƒ ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ãã‚Œã‚’é¸æŠã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/hpg4USI.png)\r\n\r\nãã—ãŸã‚‰ã€è¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹`æ¸¬å®š ID`ã‚’æ§ãˆã¾ã™ã€‚`G-`ã‹ã‚‰å§‹ã¾ã‚‹ã‚„ã¤ã§ã™ã­ã€‚\r\n\r\n![Imgur](https://imgur.com/pTpOTPf.png)\r\n\r\n## Next.js(ã®next/router)ã§ã‚‚å‹•ãã‚ˆã†ã«å¯¾å¿œã™ã‚‹\r\n`æ¸¬å®š ID`ã‚’æ§ãˆãŸç”»é¢ã«ã‚ã‚‹æ­¯è»Šãƒãƒ¼ã‚¯âš™ã‚’æŠ¼ã—ã¦ã€æ‹¡å¼µè¨ˆæ¸¬æ©Ÿèƒ½ã®è¨­å®šã‚’ã—ã¾ã™ã€‚  \r\nã“ã“ã®`ãƒšãƒ¼ã‚¸ãƒ“ãƒ¥ãƒ¼æ•°`ã®`è©³ç´°è¨­å®š`ã‚’æŠ¼ã—ã¦ã€**ãƒ–ãƒ©ã‚¦ã‚¶ã®å±¥æ­´ã‚¤ãƒ™ãƒ³ãƒˆã«åŸºã¥ããƒšãƒ¼ã‚¸ã®å¤‰æ›´**ã®ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å¤–ã—ã¦ã€ä¿å­˜ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/SciZSld.png)\r\n\r\n### ãªãœï¼Ÿ\r\n\r\n`Next.js ç­‰ã®JSãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯`ã§ã¯ç”»é¢ã‚’å‹•çš„ã«æ›¸ãæ›ãˆã¦ï¼ˆãƒ–ãƒ©ã‚¦ã‚¶ã®ãƒ­ãƒ¼ãƒ‰ã‚’æŒŸã¾ãªã„ï¼‰ç”»é¢é·ç§»ãŒè¡Œã‚ã‚Œã‚‹ãŸã‚ã€Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã§ã¯ãƒšãƒ¼ã‚¸é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã‚’æ•æ‰å‡ºæ¥ã¾ã›ã‚“ã€‚  \r\nã®ã§ã€è‡ªåˆ†ã§ãƒšãƒ¼ã‚¸é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã‚’é€ä¿¡ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€ãªã‚“ã‹**GA4**ã«ãƒ­ãƒ¼ãƒ‰ã‚’æŒŸã¾ãªã„é·ç§»ã‚’æ•ã¾ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ãã€ã“ã®ã¾ã¾ã§ã¯äºŒé‡ã§è¨ˆæ¸¬ã•ã‚Œã¦ã—ã¾ã†ã€‚  \r\nãã“ã§**GA4**ã®è¨ˆæ¸¬ã®è¨­å®šã‚’å¤‰ãˆã¾ã™ã€‚\r\n\r\nã‚‚ã—ã‹ã—ãŸã‚‰ã€ä¸Šè¨˜ã®ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ONã«ã—ã¦ãŠãã¨ã€ãƒšãƒ¼ã‚¸ã®å¤‰æ›´ã‚¤ãƒ™ãƒ³ãƒˆã‚’ã‚ã–ã‚ã–é€ä¿¡ã™ã‚‹å¿…è¦ã‚‚ãªããªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€UAã¨åˆã‚ã›ãŸã„ã®ã§ä»Šå›ã¯OFFã§è¡Œãã¾ã™ã€‚\r\n\r\n## (analytics.js ã‹ã‚‰ gtag.js ã¸ç§»è¡Œã™ã‚‹)\r\nã‚‚ã—`gtag.js`ã§æ›¸ã„ã¦ã„ãŸå ´åˆã¯ã“ã“ã¯é£›ã°ã—ã¦ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nUAã®æ–¹ã®è¨­å®šç”»é¢ã‚’é–‹ã„ã¦ã€**ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°æƒ…å ± > ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰**ã¸é€²ã¿ã€**ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° ID**ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚`UA-`ã‹ã‚‰å§‹ã¾ã‚‹ã‚„ã¤ã§ã™ã­ã€‚\r\n\r\n## Next.js ã§ã®ä½œæ¥­\r\n`_app.tsx`(jsxã‹ã‚‚ã—ã‚Œã‚“)ã‚’é–‹ãã¾ã™ã€‚  \r\nä½œã£ã¦ã„ãªã„å ´åˆã¯ä»–èª¿ã¹ã¦ä½œã£ã¦ä¸‹ã•ã„ã€‚\r\n\r\nãã—ãŸã‚‰ã€ä»¥ä¸‹ã‚’å‚è€ƒã«æ›¸ã„ã¦ä¸‹ã•ã„ï¼ˆã¾ã‚‹ãªã’ï¼‰  \r\nanalytics.jsæ™‚ä»£ã®ã‚³ãƒ¼ãƒ‰ã¯æ¶ˆã—ã¡ã‚ƒãˆï½ã€‚  \r\nå®šæ•°`UA_TRACKING_ID`ã®ä¸­ã«ã¯å„è‡ªUAã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°IDã‚’å…¥ã‚Œã¦ä¸‹ã•ã„ã€‚\r\n\r\n```tsx\r\n\r\n// å„è‡ªã“ã“ã« UA ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° ID\r\nconst UA_TRACKING_ID = `UA-`\r\n\r\nconst App = ({ Component, pageProps }) => {\r\n    return (\r\n        <>            \r\n            {/* Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ GA4 / UA */}\r\n            <Head>\r\n                <script async src={`https://www.googletagmanager.com/gtag/js?id=${UA_TRACKING_ID}`}></script>\r\n                <script dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                        window.dataLayer = window.dataLayer || [];\r\n                        function gtag(){dataLayer.push(arguments);}\r\n                        gtag('js', new Date());\r\n                        gtag('config', '${UA_TRACKING_ID}');\r\n                    `}}\r\n                />\r\n            </Head>\r\n\r\n            <Component {...pageProps} />\r\n        </>\r\n    )\r\n}\r\nexport default App\r\n```\r\n\r\n# gtag.js ã« GA4 ã‚‚è¨ˆæ¸¬ã™ã‚‹ã‚ˆã†ã«æ›¸ãè¶³ã™\r\n`gtag('config', '${UA_TRACKING_ID}');`ã¨åŒã˜æ§˜ã«GA4ã®æ¸¬å®š IDã‚’ç™»éŒ²ã—ã¾ã™ã€‚  \r\n`gtag.js`ã‚’èª­ã¿è¾¼ã‚“ã§ã‚‹`<script>`ã‚¿ã‚°ã¯ãã®ã¾ã¾UAã®ã‚’ä½¿ãˆã‚‹ã¿ãŸã„ã§ã™ã€‚\r\n\r\nä»¥ä¸‹ä¾‹ï¼š\r\n\r\n```tsx\r\n// å„è‡ªã“ã“ã« UA ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° ID\r\nconst UA_TRACKING_ID = `UA-`\r\n// å„è‡ªã“ã“ã« GA4 æ¸¬å®š ID\r\nconst GA_TRACKING_ID = `G-`\r\n\r\nconst App = ({ Component, pageProps }) => {\r\n    return (\r\n        <>            \r\n            {/* Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ GA4 / UA */}\r\n            <Head>\r\n                <script async src={`https://www.googletagmanager.com/gtag/js?id=${UA_TRACKING_ID}`}></script>\r\n                <script dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                        window.dataLayer = window.dataLayer || [];\r\n                        function gtag(){dataLayer.push(arguments);}\r\n                        gtag('js', new Date());\r\n                        gtag('config', '${UA_TRACKING_ID}');\r\n                        gtag('config', '${GA_TRACKING_ID}');\r\n                    `}}\r\n                />\r\n            </Head>\r\n\r\n            <Component {...pageProps} />\r\n        </>\r\n    )\r\n}\r\nexport default App\r\n```\r\n\r\n## Next.jsã® next/script ä½¿ãˆãªã„ã®ï¼Ÿ\r\nã“ã‚Œä½¿ã†ã¨`<body>`å†…ã«`<script>`åŸ‹ã‚è¾¼ã‚“ã§ã‚‹ã£ã½ã„ã‚“ã ã‘ã©ã©ã†ãªã‚“ã ã‚ã†ã€‚Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã¯`<head>`å†…ã«æ›¸ã„ã¦ã£ã¦è¨€ã‚ã‚Œã¦ã‚‹ã®ã§...\r\n\r\n## UAã® gtag.js è»¢ç”¨ã—ã¦ä½¿ãˆã‚“ã®ã‹ã‚ˆwww\r\n\r\næ—¢å­˜ã® gtag.js ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã‚‹å ´åˆã¯**GA4ã®æ¸¬å®šIDã‚’ç™»éŒ²ã™ã‚‹ä¸€è¡Œ**ã‚’ãã®ã¾ã¾æ›¸ãè¶³ã›ã°OKã‚‰ã—ã„ã€‚ã‚„ã‚‹ã‚„ã‚“\r\n\r\n<https://support.google.com/analytics/answer/9310895?hl=ja&utm_id=ad#which_product&zippy=%2Cã“ã®è¨˜äº‹ã®å†…å®¹>\r\n\r\n# next/router ã®ãƒšãƒ¼ã‚¸é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã‚’ç™»éŒ²ã™ã‚‹\r\nã“ã®ã¾ã¾ã ã¨åˆå›ã®èª­ã¿è¾¼ã¿ã¯æ­£ã—ãé€ä¿¡ã•ã‚Œã¾ã™ãŒã€ãƒšãƒ¼ã‚¸ã‚’åˆ‡ã‚Šæ›¿ãˆãŸéš›ã«ã¯å¯¾å¿œã§ãã¾ã›ã‚“ã€‚  \r\nã®ã§`next/router`ã®é·ç§»ã‚¤ãƒ™ãƒ³ãƒˆã‚’GA4ã¨UAã¸é£›ã°ã—ã¾ã™ã€‚\r\n\r\nä»¥ä¸‹ä¾‹ï¼š  \r\nTSãªã®ã«`as any`ã—ã¦ã‚‹ã‹ã‚‰å‚è€ƒã«ã™ã‚‹ã«ã¯è‰¯ããªã„ã‹ã‚‚ã€‚  \r\nJavaScriptæ´¾é–¥ã®æ–¹ã¯TypeScriptã®å‹æ³¨é‡ˆ(ã¨ã‚­ãƒ£ã‚¹ãƒˆ)ã‚’æ¶ˆã—ã¦ã€ã©ã†ãã€‚\r\n\r\n```tsx\r\n// å„è‡ªã“ã“ã« UA ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚° ID\r\nconst UA_TRACKING_ID = `UA-`\r\n// å„è‡ªã“ã“ã« GA4 æ¸¬å®š ID\r\nconst GA_TRACKING_ID = `G-`\r\n\r\n/**\r\n * ãƒšãƒ¼ã‚¸é·ç§»ã®ãŸã³ã«å‘¼ã¶\r\n * \r\n * @param {string} url ã†ã‚‰ã‚‹\r\n */\r\nconst pageview = (url: string) => {\r\n    // å¤šåˆ† UA ã¨ GA4 ä¸¡æ–¹ãã‚Œãã‚Œé€ä¿¡ã—ãªã„ã¨ã„ã‘ãªã„\r\n    (window as any).gtag('config', UA_TRACKING_ID, {\r\n        page_path: url,\r\n    });\r\n    (window as any).gtag('config', GA_TRACKING_ID, {\r\n        page_path: url,\r\n    });\r\n}\r\n\r\nconst App = ({ Component, pageProps }) => {\r\n\r\n    // Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã¸ãƒšãƒ¼ã‚¸é·ç§»ã‚’é€šçŸ¥\r\n    const router = useRouter()\r\n    useEffect(() => {\r\n        const handleRouteChange = (url: string) => {\r\n            pageview(url)\r\n        }\r\n        router.events.on('routeChangeComplete', handleRouteChange)\r\n        return () => {\r\n            router.events.off('routeChangeComplete', handleRouteChange)\r\n        }\r\n    }, [router.events])\r\n\r\n    return (\r\n        <>            \r\n            {/* Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ GA4 / UA */}\r\n            <Head>\r\n                <script async src={`https://www.googletagmanager.com/gtag/js?id=${UA_TRACKING_ID}`}></script>\r\n                <script dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                        window.dataLayer = window.dataLayer || [];\r\n                        function gtag(){dataLayer.push(arguments);}\r\n                        gtag('js', new Date());\r\n                        gtag('config', '${UA_TRACKING_ID}');\r\n                        gtag('config', '${GA_TRACKING_ID}');\r\n                    `}}\r\n                />\r\n            </Head>\r\n\r\n            <Component {...pageProps} />\r\n        </>\r\n    )\r\n}\r\nexport default App\r\n```\r\n\r\nã“ã‚Œã§å¤šåˆ†å¯¾å¿œã¯çµ‚äº†ã§ã™ã€‚  \r\nGA4ã¨UAãã‚Œãã‚Œé–‹ã„ã¦ã€ã¡ã‚ƒã‚“ã¨ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ç¾ã‚ŒãŸã‚‰æˆåŠŸã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n## ç•ªå¤–ç·¨ GoogleAnalytics.tsx ã«ã¾ã¨ã‚ã‚‹ç·¨\r\n\r\n`_app.tsx`ãŒé•·ããªã‚‹ã¨ã—ã‚“ã©ã„ã®ã§åˆ†ã‘ã¦ãŠãã¨è‰¯ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nã¤ã„ã§ã«æœ¬ç•ªç’°å¢ƒã®ã¿Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚’å‹•ä½œã•ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚\r\n\r\n```tsx\r\n// GoogleAnalytics.tsx\r\n\r\n/** Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ (UA) ã® æ¸¬å®šID */\r\nexport const UA_TRACKING_ID = `UA-`\r\n\r\n/** Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ (GA4) ã® æ¸¬å®šID */\r\nexport const GA_TRACKING_ID = `G-`\r\n\r\n/** é–‹ç™ºãƒ¢ãƒ¼ãƒ‰ã€‚æœ¬ç•ªï¼ˆæ„å‘³æ·±ï¼‰ã ã‘ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã‚’å‹•ä½œã•ã›ã‚‹ãŸã‚ */\r\nconst isDevelopment = process.env.NODE_ENV === 'development'\r\n\r\n/**\r\n * ãƒšãƒ¼ã‚¸é·ç§»ã®ãŸã³ã«å‘¼ã¶\r\n * \r\n * @param {string} url ã†ã‚‰ã‚‹\r\n */\r\nconst pageview = (url: string) => {\r\n    // æœ¬ç•ªã®ã¿å®Ÿè¡Œ\r\n    if (isDevelopment) {\r\n        return\r\n    }\r\n    (window as any).gtag('config', UA_TRACKING_ID, {\r\n        page_path: url,\r\n    });\r\n    (window as any).gtag('config', GA_TRACKING_ID, {\r\n        page_path: url,\r\n    });\r\n}\r\n\r\n/** Google Analytics ã¸next/routerã®ãƒšãƒ¼ã‚¸é·ç§»ã®çŠ¶æ…‹ã‚’é€šçŸ¥ã™ã‚‹ */\r\nexport const useGoogleAnalytics = () => {\r\n    // Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã¸ãƒšãƒ¼ã‚¸é·ç§»ã‚’é€šçŸ¥\r\n    const router = useRouter()\r\n    useEffect(() => {\r\n        const handleRouteChange = (url: string) => {\r\n            pageview(url)\r\n        }\r\n        router.events.on('routeChangeComplete', handleRouteChange)\r\n        return () => {\r\n            router.events.off('routeChangeComplete', handleRouteChange)\r\n        }\r\n    }, [router.events])\r\n}\r\n\r\n/** Google Analytics 4 ã§åˆ©ç”¨ã™ã‚‹JavaScriptã‚’å·®ã—è¾¼ã‚€ã‚„ã¤ã€‚æœ¬ç•ªï¼ˆæ„å‘³æ·±ï¼‰ã®ã¿å®Ÿè¡Œ */\r\nexport const GoogleAnalyticsHead = () => {\r\n    return (\r\n        <>\r\n            {!isDevelopment && <Head>\r\n                <script async src={`https://www.googletagmanager.com/gtag/js?id=${UA_TRACKING_ID}`}></script>\r\n                <script dangerouslySetInnerHTML={{\r\n                    __html: `\r\n                        window.dataLayer = window.dataLayer || [];\r\n                        function gtag(){dataLayer.push(arguments);}\r\n                        gtag('js', new Date());\r\n                        gtag('config', '${UA_TRACKING_ID}');\r\n                        gtag('config', '${GA_TRACKING_ID}');\r\n                    `}}\r\n                />\r\n            </Head>}\r\n        </>\r\n    )\r\n}\r\n```\r\n\r\nã“ã‚Œã‚’`_app.tsx`ã§å‘¼ã¶ã‚ˆã†ã«ã™ã‚Œã°ãŠã£ã‘\r\n\r\n```tsx\r\nimport { GoogleAnalyticsHead, useGoogleAnalytics } from '../src/GoogleAnalytics'\r\n\r\nconst App = ({ Component, pageProps }) => {\r\n\r\n    // GoogleAnalyticsã¸next/routerã®ãƒšãƒ¼ã‚¸é·ç§»ã‚’é€šçŸ¥ã™ã‚‹ã€‚\r\n    useGoogleAnalytics()\r\n\r\n    return (\r\n        <>            \r\n            {/* Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ GA4 / UA */}\r\n            <GoogleAnalyticsHead />\r\n\r\n            <Component {...pageProps} />\r\n        </>\r\n    )\r\n}\r\n```\r\n\r\nã‚‚ã—ãƒ‘ã‚¯ã£ãŸå ´åˆã¯æœ¬ç•ªç’°å¢ƒã®ã¿ã§å‹•ãã®ã§ã€å‹•ã„ã¦ã‚‹ã‹ç¢ºèªã—ãŸã„å ´åˆã¯\r\n\r\n```\r\nnpm run build\r\nnpm run start\r\n```\r\n\r\nã™ã‚Œã°æœ¬ç•ªç’°å¢ƒã®ãƒ“ãƒ«ãƒ‰æˆæœç‰©ã‚’ãƒ›ã‚¹ãƒˆã—ãŸé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒç«‹ã¡ä¸ŠãŒã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/DwEizfq.png)"},{"title":"MaterialUIã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’ä½¿ã†ã¨ãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒé…ããªã‚‹ã®ã‚’ç›´ã™","link":"/posts/next_js_mui_material_icon_build_speed/","markdown":"\r\nã©ã†ã‚‚ãŠã¯ã‚ˆã†ã”ã–ã„ã¾ã™ã€‚  \r\nã“ã®ã‚µã‚¤ãƒˆã¯Nuxt.jsãªã‚“ã§ã™ã‘ã©ã­åˆè¦‹ã•ã‚“ï¼ˆè¨˜è¿°æ™‚æ™‚ç‚¹ï¼‰\r\n\r\n# æœ¬é¡Œ\r\n`Next.js`ã«`Material UI`ã‚’å…¥ã‚ŒãŸã‚ã¨ã€`import`ã®æ›¸ãæ–¹æ¬¡ç¬¬ã§ãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒé•·ããªã£ã¦ã—ã¾ã†ã€‚\r\n\r\n## ã©ã†ã„ã†ã“ã¨\r\n\r\n```js\r\nimport { AndroidOutlined } from '@mui/icons-material'\r\n```\r\n\r\nã‚ˆã‚Šã‚‚\r\n\r\n```js\r\nimport AndroidOutlined from '@mui/icons-material/AndroidOutlined'\r\n```\r\n\r\nã®æ–¹ãŒãƒ“ãƒ«ãƒ‰æ™‚é–“ãŒé«˜é€Ÿã«ãªã‚Šã€ã‚µã‚¤ã‚ºãŒå°ã•ããªã‚‹\r\n\r\n# è©¦ã—ã¦ã¿ã‚‹\r\n\r\n```tsx\r\n// index.tsx\r\n\r\nimport type { NextPage } from 'next'\r\nimport AndroidOutlined from '@mui/icons-material/AndroidOutlined'\r\n\r\nconst Home: NextPage = () => {\r\n  return (\r\n    <AndroidOutlined />\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\n```tsx\r\n// index.tsx\r\n\r\nimport type { NextPage } from 'next'\r\nimport { AndroidOutlined } from '@mui/icons-material'\r\n\r\nconst Home: NextPage = () => {\r\n  return (\r\n    <AndroidOutlined />\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\nã©ã¡ã‚‰ã‚‚åŒã˜ã‚¢ã‚¤ã‚³ãƒ³ã‚’ç”»é¢ã«è¡¨ç¤ºã™ã‚‹ã‚³ãƒ¼ãƒ‰ã§ã™\r\n\r\n\r\n# æ¤œè¨¼çµæœ\r\n\r\n## import { AndroidOutlined } from '@mui/icons-material'\r\n\r\n3.1 MB\r\n\r\n![Imgur](https://imgur.com/z4ZXCC2.png)\r\n\r\n## import AndroidOutlined from '@mui/icons-material/AndroidOutlined'\r\n\r\n965 kB\r\n\r\n![Imgur](https://imgur.com/ojVnl0z.png)\r\n\r\nã¾ã˜ï¼Ÿ\r\n\r\n# æœ¬ç•ªãƒ“ãƒ«ãƒ‰ã¯ï¼Ÿ\r\n\r\nNext.jsã®é™çš„HTMLã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ã—ã¦æ¯”è¼ƒã—ã¦ã¿ã‚‹\r\n\r\n## package.jsonã«ã‚¹ã‚¯ãƒªãƒ—ãƒˆè¿½åŠ \r\n\r\n`npm run export`ã‚³ãƒãƒ³ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™\r\n\r\n```json\r\n{\r\n  \"name\": \"next-material-ui\",\r\n  \"version\": \"0.1.0\",\r\n  \"private\": true,\r\n  \"scripts\": {\r\n    \"dev\": \"next dev\",\r\n    \"build\": \"next build\",\r\n    \"start\": \"next start\",\r\n    \"lint\": \"next lint\",\r\n    \"export\": \"next build && next export\"\r\n  },\r\n```\r\n\r\n## import { AndroidOutlined } from '@mui/icons-material'\r\n\r\n```\r\nPage                              Size     First Load JS\r\nâ”Œ â—‹ / (5246 ms)                   18.1 kB          85 kB\r\nâ”œ   /_app                         0 B              67 kB\r\nâ”œ â—‹ /404                          194 B          67.2 kB\r\nâ”” Î» /api/hello                    0 B              67 kB\r\n+ First Load JS shared by all     67 kB\r\n  â”œ chunks/framework.0441fa.js    42.4 kB\r\n  â”œ chunks/main.62b8ca.js         23.3 kB\r\n  â”œ chunks/pages/_app.d6feaf.js   557 B\r\n  â”œ chunks/webpack.1a8a25.js      729 B\r\n  â”” css/120f2e2270820d49a21f.css  209 B\r\n```\r\n\r\n## import AndroidOutlined from '@mui/icons-material/AndroidOutlined'\r\n\r\n```\r\nPage                              Size     First Load JS\r\nâ”Œ â—‹ / (444 ms)                    19.3 kB        86.3 kB\r\nâ”œ   /_app                         0 B              67 kB\r\nâ”œ â—‹ /404                          194 B          67.2 kB\r\nâ”” Î» /api/hello                    0 B              67 kB\r\n+ First Load JS shared by all     67 kB\r\n  â”œ chunks/framework.2191d1.js    42.4 kB\r\n  â”œ chunks/main.62b8ca.js         23.3 kB\r\n  â”œ chunks/pages/_app.d6feaf.js   557 B\r\n  â”œ chunks/webpack.1a8a25.js      729 B\r\n  â”” css/120f2e2270820d49a21f.css  209 B\r\n```\r\n\r\nãªã‚“ã‹å¾Œè€…ã®æ–¹ãŒãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºå¤§ãã„ã‚“ã ã‘ã©ã€‚  \r\nã¾ãæ¤œè¨¼çµæœã¨ã—ã¦ã¯æœ¬ç•ªãƒ“ãƒ«ãƒ‰ãªã‚‰ä¸Šè¨˜ã®æ›¸ãæ–¹ã§ã‚‚ãƒ„ãƒªãƒ¼ã‚·ã‚§ã‚¤ã‚­ãƒ³ã‚°ï¼Ÿã§æœ€é©åŒ–ãŒè¡Œã‚ã‚Œã‚‹ã®ã ã¨æ€ã†ã€‚ã ãŸæ™‚é–“ã¯ã‹ã‹ã‚Šã¾ã™ã­ã€ã€ã€  \r\n\r\nhttps://mui.com/guides/minimizing-bundle-size/#when-and-how-to-use-tree-shaking\r\n\r\n# é–‹ç™ºæ™‚ã§ã‚‚ã»ã—ã„\r\n\r\nBabelã‚’æ­£ã—ãè¨­å®šã™ã‚‹ã¨åŒã˜ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’å‡ºã›ã‚‹ã‚‰ã—ã„ã§ã™ã€‚\r\n\r\n## ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’å…¥ã‚Œã‚‹\r\n\r\n```\r\nnpm install babel-plugin-import --save-dev\r\n```\r\n\r\n## .babelrcã«è¿½è¨˜\r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ«ãƒ¼ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼ˆpackage.jsonãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ï¼‰ã«`.babelrc`ã£ã¦åå‰ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚  \r\nè¿½åŠ ã—ãŸã‚‰ã€ä»¥ä¸‹ã®å†…å®¹ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```json\r\n{\r\n  \"presets\": [\r\n    \"next/babel\"\r\n  ],\r\n  \"plugins\": [\r\n    [\r\n      \"babel-plugin-import\",\r\n      {\r\n        \"libraryName\": \"@mui/material\",\r\n        \"libraryDirectory\": \"\",\r\n        \"camel2DashComponentName\": false\r\n      },\r\n      \"core\"\r\n    ],\r\n    [\r\n      \"babel-plugin-import\",\r\n      {\r\n        \"libraryName\": \"@mui/icons-material\",\r\n        \"libraryDirectory\": \"\",\r\n        \"camel2DashComponentName\": false\r\n      },\r\n      \"icons\"\r\n    ]\r\n  ]\r\n}\r\n```\r\n\r\n## å†…éƒ¨ã‚µãƒ¼ãƒãƒ¼èµ·å‹•\r\n\r\n`npm run dev`\r\n\r\nä»¥ä¸Šã§ã™ã€‚ã“ã‚Œã§æœ‰åŠ¹ã«ãªã‚‹ã¯ãšã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/wGoVOy8.png)\r\n\r\n## ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nã»ã„\r\n\r\nhttps://github.com/takusan23/next-js-materialui-icon-babel"},{"title":"ä½œã£ãŸãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã‚’ AWS ã‚’ä½¿ã£ã¦ã„ã¤ã§ã‚‚éŠã¹ã‚‹ã‚ˆã†ã«ã™ã‚‹","link":"/posts/nicolive_game_hosting_aws/","markdown":"\r\nRPGã‚¢ãƒ„ãƒãƒ¼ãƒ«ãŒçµ‚äº†ã—ãŸã“ã¨ã«ã‚ˆã‚Šã€ãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã‚’éŠã¶ã«ã¯å®Ÿéš›ã«ãƒ‹ã‚³ç”Ÿã§æ å–ã£ã¦æ”¾é€ã—ãªã„ã¨ã„ã‘ãªã„ã‚‰ã—ã„ã€‚  \r\néŠã¶å´ã‹ã‚‰ã™ã‚‹ã¨ã¨ã¦ã‚‚ä¸ä¾¿ã«ãªã£ãŸã¨æ€ã†ã€‚\r\n\r\nã¨ã„ã†ã‚ã‘ã§ä»Šå›ã¯ãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã‚’ AWS ã®é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚’ä½¿ã£ã¦ã€ãƒ‹ã‚³ç”Ÿã§æ ã‚’å–ã‚‰ãšã«ã„ã¤ã§ã‚‚éŠã¹ã‚‹ã‚ˆã†ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n# ä»Šå›è¡Œãæ§‹æˆ\r\n\r\n```plaintext\r\n[ S3 ] -> [ CloudFront ] -> internet -> ã‚¹ãƒãƒ›/PC\r\n```\r\n\r\n`AWS Amplify`ã§ã¯ãªãã€`S3 + CloudFront`ã§ä½œã‚Šã¾ã™ã€‚  \r\n`S3`ã«ãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã®`html`ã‚’ç½®ã„ã¦ã€`CloudFront`ã‚’ä¸€å›çµŒç”±ã—ã¦ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã¨é€šã˜ã¦ã‚¹ãƒãƒ›/PCã®ãƒ–ãƒ©ã‚¦ã‚¶ã¸ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’é€ã‚Šã¾ã™ã€‚\r\n\r\nã¾ãŸã€ä»Šå›ã¯`S3`ã®é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã¯ä½¿ã‚ãšã€`OAC`ã§ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n\r\n# ã§ã‚ã‚Šã£ã¨\r\nä»–ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã¨é•ã„ã“ã®æ–¹æ³•ã ã¨`S3`ã®æ–™é‡‘ãŒã©ã†ã—ã¦ã‚‚ã‹ã‹ã£ã¦ã—ã¾ã†ã®ã§ã€å®Œå…¨ç„¡æ–™ã«ã—ãŸã„å ´åˆã¯`Netlify`ã‚„`Cloudflare Pages`ã€`GitHub Pages`ã‚„`Vercel`ç­‰ã®ã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½¿ã†ã¨ã»ã¼ç„¡æ–™ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n`Cloudflare Pages`ãŒã±ã£ã¨è¦‹ãŸæ„Ÿã˜ç„¡æ–™ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å„ªã—ãã†ã€  \r\nï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã«ã—ãŸã„ + ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ãƒ‰ãƒ¡ã‚¤ãƒ³ã§é‹ç”¨ã—ãŸã„å ´åˆã¯`Cloudflare DNS`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ãã‚‰ã„ï¼‰  \r\n\r\n**ã§ã‚‚å˜ã«ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ã ã‘ãªã‚‰ã©ã“ã§ã‚‚è‰¯ã„ã¯ãšã€‚**  \r\nåå‰ä¸Šã’ãŸã‚„ã¤ã¯ä¸€å¿œä½¿ã£ãŸã“ã¨ãŒã‚ã‚‹ã€é¸æŠè‚¢ãŒå¤šãã¦ã„ã„ã§ã™ã­\r\n\r\nã¡ãªã¿ã«ã€ã“ã®æ–¹æ³•ã§ãŠé‡‘ãŒã‹ã‹ã‚‹ã¨è¨€ã„ã¾ã—ãŸãŒã€**1ãƒ‰ãƒ«**ã‹ã‹ã‚‹ã‹æ€ªã—ã„ã®ã§ã€`AWS`æ—¢ã«ä½¿ã£ã¦ã‚‹ã¨ã‹ãªã‚‰å¤šåˆ†å®‰ã„æ–¹ï¼Ÿ  \r\nï¼ˆç§ã¯`ãŠä¸€äººæ§˜ Misskey`ãŒ`Lightsail`ã§å‹•ã„ã¦ã‚‹ã®ã§ï¼‰\r\n\r\n# ã‹ã‹ã‚‹ãŠé‡‘ï¼Ÿ\r\nãƒ‰ãƒ¡ã‚¤ãƒ³ä»£ã‚’é™¤ã‘ã°...\r\n\r\n- CloudFront\r\n    - ãƒ‡ãƒ¼ã‚¿è»¢é€\r\n        - ï¼‘ã‹æœˆ 1 TB ã¾ã§ç„¡æ–™ã€‚äºŒå¹´ç›®ä»¥é™ã‚‚ã“ã®ç„¡æ–™æ ã¯ã‚‚ã‚‰ãˆã¾ã™\r\n            - AWS -> ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆ -> ã‚¹ãƒãƒ›/PC ã®é€šä¿¡ã®äº‹ã§ã™\r\n    - CloudFront Functions\r\n        - 200 ä¸‡ãƒªã‚¯ã‚¨ã‚¹ãƒˆã¾ã§ç„¡æ–™ã€‚äºŒå¹´ç›®ä»¥é™ã‚‚ã‚ã‚Šã¾ã™\r\n            - ä»Šå›ã¯ã“ã¡ã‚‰ã‚’ä½¿ã†æ§‹æˆã§è¡Œãã¾ã™ã€ã“ã‚Œã‚’ä½¿ã‚ãªã„æ–¹æ³•ã‚‚ã‚ã‚Šã¾ã™ã€‚\r\n- S3\r\n    - ãƒ‡ãƒ¼ã‚¿è»¢é€æ–™é‡‘\r\n        - 0 å††\r\n        - S3 - CloudFront é–“ã®è»¢é€ã¯ç„¡æ–™\r\n        - å—ä¿¡ã¯ç„¡æ–™\r\n    - ãƒ‡ãƒ¼ã‚¿ã®æ“ä½œï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰\r\n        - å°‘ãªã‹ã‚‰ãšã‹ã‹ã‚‹\r\n            - è»¢é€æ–™é‡‘ã¨ã¯åˆ¥ã«èª²é‡‘ã•ã‚Œã‚‹ã€ã‚„ã‚„ã“ã—ã„\r\n        - `CloudFront`ãŒé–“ã«å…¥ã‚Œã°ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚Œã‚‹ã®ã§ã€ã“ã®æ–™é‡‘ã‚’æŠ‘ãˆã‚‰ã‚Œã‚‹\r\n    - ãƒ‡ãƒ¼ã‚¿ä¿å­˜\r\n        - ã“ã‚Œã‚‚å°‘ãªã‹ã‚‰ãšã‹ã‹ã‚Šã¾ã™ï¼ˆåˆå¹´åº¦ã¯ç„¡æ–™æ ãŒã‚ã‚Šã¾ã™ï¼‰\r\n\r\nãŸã ã€å…ˆè¿°ã®é€šã‚Š`ãŠä¸€äººæ§˜ Misskey`ãŒå‹•ã„ã¦ã„ã‚‹ã®ã§ã€ã¡ã‚‡ã£ã¨è«‹æ±‚ãŒå¢—ãˆã¦ã‚‚ã¾ãã„ã„ã‹ãªã¨  \r\n`ç„¡æ–™ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹`ã‚ˆã‚Šã‚‚`AWS`ä½¿ã£ã¦ã¿ãŸã•ãŒå‹ã£ã¦ã—ã¾ã£ãŸ...\r\n\r\n# AWS ã§é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹\r\n\r\n`AWS`ã§é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹å ´åˆã€2ã¤ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒã‚ã£ã¦\r\n\r\n- `AWS Amplify`ã‚’ä½¿ã†\r\n- `S3 + CloudFront`ã‚’ä½¿ã†\r\n\r\nã®2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã£ã¦ã€å‰è€…ã¯ä½¿ã„ã‚„ã™ã•ã«å…¨æŒ¯ã‚Šã—ã¦ã„ã‚‹ãã†ã€‚  \r\nãŸã ã€`CloudFront`ã‚ˆã‚Šã‚‚è‹¥å¹²é«˜ã„ã‹ãªï¼Ÿ\r\n\r\nã¨ã„ã†ã‚ã‘ã§å¾Œè€…ã‚’ä½¿ãŠã†ã¨æ€ã†ã®ã§ã™ãŒã€ã“ã‚Œã‚‚2ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚ã‚Šã¾ã™ã€‚  \r\nãŒã€ã“ã®2ã¤ã©ã£ã¡ã‚‚ä¸€é•·ä¸€çŸ­ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n- `S3`ã®é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã‚’ä½¿ã„ãªãŒã‚‰ã€`CloudFront`ã‚’çµŒç”±ã™ã‚‹æ–¹æ³•\r\n    - `S3`å˜å“ã ã¨`https`ãŒä½¿ãˆãªã„ã®ã§ã€`CloudFront`ã‚’çµŒç”±ã•ã›ã¾ã™\r\n- `S3`ã®é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã¯ä½¿ã‚ãšã€`CloudFront`ãŒ`S3`ã«å•ã„åˆã‚ã›ã¦è¿”ã™æ–¹æ³•\r\n\r\nã¾ãšå¾Œè€…ã‹ã‚‰ã€ã“ã¡ã‚‰ã¯é›£ã—ã„ã§ã™ã€‚  \r\n`example.com/example`ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆãŒæ¥ãŸå ´åˆã«ã€`example.html`ã«å¤‰æ›ã—ã¦`S3`ã«å•ã„åˆã‚ã›ã‚‹æ–¹æ³•ãŒæ¨™æº–ã§ã¯æä¾›ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚  \r\nãªã®ã§ã€`CloudFront Functions`ã‚’ä½¿ã„ã€`S3`ã«å•ã„åˆã‚ã›ã‚‹å‰ã«`.html`ã‚’ã¤ã‘ã‚‹å‡¦ç†ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ï¼ˆã‚³ãƒ¼ãƒ‰è‡ªä½“ã¯ JS ãªã®ã§å…¨ç„¶é›£ã—ããªã„ã§ã™ã€‚ï¼‰  \r\nãŒã€ãŠæ‰‹è»½ã¨è¨€ã‚ã‚Œã‚‹ã¨å¾®å¦™ã€`CloudFront Functions`ã«é–¢ã—ã¦ã¯äºŒå¹´ç›®ä»¥é™ç„¡æ–™æ ãŒã‚ã‚‹ã¨ã¯è¨€ãˆã†ãƒ¼ã‚“  \r\n\r\nå‰è€…ã¯æ¥½ã§ã™ã€‚`CloudFront Functions`ãªã‚“ã¦ä½¿ã‚ãšã«ä½œã‚Œã¾ã™ã€‚  \r\nã“ã‚Œã§ã„ã„ã˜ã‚ƒã‚“ï¼ã¨ã¯ã„ãã¾ã›ã‚“ã€ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯`S3`ã®é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã§ä½¿ã£ã¦ã„ã‚‹`URL`ãŒãƒãƒ¬ãŸã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚  \r\nï¼ˆ`S3`è‡ªä½“ã‚’é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã—ã¦ã„ã‚‹ãŸã‚ï¼‰  \r\n\r\nã“ã‚Œã‚’`CloudFront`ã®ã¿ã«åˆ¶é™ã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã›ã‚“ï¼ˆæš«å®šå¯¾å¿œã¿ãŸã„ãªã®ãªã‚‰ã‚ã‚‹ï¼‰ã€‚ãƒãƒ¬ãªã„ã¨ã¯æ€ã„ã¾ã™ãŒãƒãƒ¬ãŸã‚‰`SEO`çš„ã«è‰¯ããªã„ï¼ˆæ­£è¦ URLï¼‰ã®ã¨ã€  \r\n`CloudFront`ã‚’çµŒç”±ã™ã‚‹ã¨å€¤æ®µãŒå®‰ããªã‚‹ï¼ˆç„¡æ–™æ ã§åã¾ã‚‹ï¼‰ãŒã€`S3`ã«ç›´æ¥ã‚¢ã‚¯ã‚»ã‚¹ã•ã‚Œã‚‹ã¨ãã®åˆ†é«˜ããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚\r\n\r\n# S3 ã¨ CloudFront ã§é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹ãªãŒã‚Œ\r\n\r\n- ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ãƒ‘ã‚¹ã®æ§‹æˆã‚’æ±ºã‚ã‚‹\r\n- `S3` ã®ãƒã‚±ãƒƒãƒˆã‚’ç”¨æ„ã™ã‚‹\r\n- `html` ã‚’æ ¼ç´ã™ã‚‹\r\n- `CloudFront` ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã£ã¦ã€`OAC`ã§`S3`ã‹ã‚‰å–ã‚Œã‚‹ã‚ˆã†ã«\r\n- `CloudFront` ã«ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨`HTTPS`ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«\r\n- `CloudFront` ã§`URL`æœ«å°¾ã«`.html`ãŒç„¡ãã¦ã‚‚ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã«`CloudFront Functions`ã‚’æ›¸ã\r\n\r\nãªãŒã„  \r\nã¾ãŸã€ä»Šå›ã¯ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¯ä½¿ã‚ãšã€`HTML`ã¨ã‹ã‚’æ‰‹å‹•ã§ç½®ã„ã¦ã„ãæ„Ÿã˜ã§è¡Œãã¾ã™  \r\nï¼ˆã‚ã‚“ã¾ã‚Šå‚è€ƒã«ãªã‚‰ã‚“ã‹ã‚‚ï¼ï¼‰\r\n\r\n## ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ãƒ‘ã‚¹ã®æ§‹æˆã‚’æ±ºã‚ã‚‹\r\n\r\né©å½“ã«ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã€‚  \r\nãƒ‘ã‚¹ã®æ§‹æˆã¯ã“ã‚“ãªæ„Ÿã˜ã§è¡Œã“ã†ã¨æ€ã„ã¾ã™ã€‚  \r\n`Next.js`ã¨ã‹ã®ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã‚’ä½¿ã£ã¦ã„ã‚‹å ´åˆã¯ã€æ—¢ã«ãƒ‘ã‚¹ãŒæ±ºã¾ã£ã¦ã„ã‚‹ã®ã§ã“ã®å·¥ç¨‹ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³æ±ºã‚ã‚‹ã ã‘ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n- namagame.negitoro.dev\r\n    - /game\r\n        - /game1\r\n            - index.html\r\n        - /game2\r\n            - index.html\r\n    - index.html\r\n\r\næœ€å¾Œã® index.html ã¯ `/game/game1` `/game/game2`ã¸ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã®ãƒªãƒ³ã‚¯é›†ã«ã™ã‚‹äºˆå®šã€‚  \r\nè¦ªã®`/game`ã‚’ä½œã‚‹ã‹å¾®å¦™ã ã£ãŸã‘ã©`index.js`ã¨ã‹`favicon`ã¨ã‹ç½®ããŸããªã£ãŸã‚‰ã€ã©ã‚ŒãŒ`index.html`ã§å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‹åˆ†ã‹ã‚‰ãªããªã‚‹ã®ã§ã¾ã‚è‰¯ã„ã‹ã€‚\r\n\r\n- /game\r\n    - /game1\r\n        - index.html\r\n    - /game2\r\n        - index.html\r\n- favicon.ico\r\n- index.js\r\n- index.html\r\n\r\n## S3 ã®ãƒã‚±ãƒƒãƒˆã‚’ä½œã‚‹\r\n\r\nãƒã‚±ãƒƒãƒˆåã¯ãŠã¾ã‹ã›ã—ã¾ã™ã€`S3`ã®ä¸­ã§ãƒ¦ãƒ‹ãƒ¼ã‚¯ã§ã‚ã‚‹å¿…è¦ãŒã‚ã£ãŸã¯ãšï¼Ÿãªã®ã§ãƒ‰ãƒ¡ã‚¤ãƒ³åã¨ã‹ã‚’å…¥ã‚Œã¦ãŠã‘ã°è‰¯ã„ã®ã§ã¯ãªã„ã§ã—ã‚‡ã†ã‹ã€‚  \r\nãƒªãƒ¼ã‚¸ãƒ§ãƒ³ã¯æ±äº¬ã«ã—ã¾ã—ãŸã€‚  \r\nãŠé‡‘ã‚’è€ƒãˆã‚‹ã¨ã‚¢ãƒ¡ãƒªã‚«ã®ã‚ªãƒ¬ã‚´ãƒ³ã¨ã‹ã®ã»ã†ãŒå®‰ã„ã—ã€`CloudFront`ã‚’çµŒç”±ã™ã‚‹ã®ã§ç‰©ç†çš„ã«é›¢ã‚Œã¦ã¦ã‚‚å•é¡Œã¯ãªã„ã¯ãšã§ã™ãŒãƒ»ãƒ»ãƒ»ã¾ã‚\r\n\r\n## html ã‚’æ ¼ç´ã™ã‚‹\r\n`index.html`ã‚’ä½œã‚Šã¾ã™ã€‚  \r\nå‹•ä½œç¢ºèªç”¨ãªã®ã§é©å½“ã«ã€å…¨éƒ¨çµ‚ã‚ã£ã¦ã‹ã‚‰ã¡ã‚ƒã‚“ã¨`html`ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n`Next.js`ã¨ã‹ã§æ—¢ã«é™çš„æ›¸ãå‡ºã—ã—ãŸå ´åˆã¯`out`ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã‚’å…¨éƒ¨`S3`ã®ãƒã‚±ãƒƒãƒˆã«å…¥ã‚Œã¡ã‚ƒã£ã¦ã‚‚è‰¯ã„ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\r\n\r\n```html\r\n<!DOCTYPE html>\r\n<html lang=\"ja\">\r\n\r\n<head>\r\n    <meta charset=\"UTF-8\">\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\r\n    <title>ä½œã£ãŸãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã®ãƒªãƒ³ã‚¯é›†</title>\r\n</head>\r\n\r\n<body>\r\n\r\n    <p>ã‚¢ãƒ„ãƒãƒ¼ãƒ«ãŒçµ‚äº†ã—ãŸã®ã§ã€ã¨ã‚Šã‚ãˆãšãƒ‹ã‚³ç”Ÿä»¥å¤–ã§ã‚‚éŠã¹ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã¨ã‹ã¯ãªã„ã§ã™ã€‚</p>\r\n\r\n    <ul>\r\n        <li>\r\n            <a href=\"/game/baitoomo/\">ã°ã„ã¨ãƒ¼ã‚‚</a>\r\n        </li>\r\n        <li>\r\n            <a href=\"/game/tobetoomo/\">ã¨ã¹ã¨ãƒ¼ã‚‚</a>\r\n        </li>\r\n        <li>\r\n            <a href=\"/game/toritoomo/\">ã¨ã‚Šã¨ãƒ¼ã‚‚</a>\r\n        </li>\r\n        <li>\r\n            <a href=\"/game/tumitoomo/\">ã¤ã¿ã¨ãƒ¼ã‚‚</a>\r\n        </li>\r\n        <li>\r\n            <a href=\"/game/turitoomo/\">ã¤ã‚Šã¨ãƒ¼ã‚‚</a>\r\n        </li>\r\n    </ul>\r\n\r\n</body>\r\n\r\n</html>\r\n```\r\n\r\n`Markdown`ã£ã¦å‰å¤§ã§ã™ã­ã€`html`ã²ã£ã•ã³ã•ã«æ›¸ã„ãŸ  \r\nå¤šåˆ†ãƒˆãƒ¬ã‚¤ãƒªãƒ³ã‚°ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã¯å¿…è¦ã§ã™ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/c7ywpmc.png)\r\n\r\nã“ã‚Œã‚’ã•ã£ãä½œã£ãŸ`S3`ã®ãƒã‚±ãƒƒãƒˆã«ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¦ã€ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/NTeLN1A.png)\r\n\r\n`index.html`ãŒä¸€è¦§ã«ã‚ã‚Œã°æˆåŠŸ  \r\n`/game`ã¯å¾Œã§ãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã‚’ç½®ã„ã¦ãŠããƒ•ã‚©ãƒ«ãƒ€ã¨ã—ã¦ä½œã£ãŸã ã‘ã§ã€ç„¡ãã¦ã„ã„ã§ã™ã€‚ã¦ã‹æœ€å¾Œã§è‰¯ã‹ã£ãŸ\r\n\r\n![Imgur](https://imgur.com/1ZbPWZ5.png)\r\n\r\n## CloudFront ã®ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚‹\r\n\r\nã•ã‚“ã“ã†ï¼šhttps://repost.aws/ja/knowledge-center/cloudfront-serve-static-website\r\n\r\n`CloudFront`ã®ç”»é¢ã‚’å‡ºã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/cxZXYRg.png)\r\n\r\nãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/6HzYKs7.png)\r\n\r\nã‚ªãƒªã‚¸ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³  \r\nã«ã¯ã•ã£ãä½œã£ãŸ`S3`ã®ãƒã‚±ãƒƒãƒˆã‚’é¸ã³ã¾ã™ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã§é¸ã¹ã¾ã™\r\n\r\n![Imgur](https://imgur.com/NjvBN5L.png)\r\n\r\næ¬¡ã¯ ã‚ªãƒªã‚¸ãƒ³ã‚¢ã‚¯ã‚»ã‚¹  \r\nã“ã‚Œã¯`Origin access control settings (recommended)`ã‚’é¸ã³ã¾ã™  \r\né¸ã¶ã¨ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒå¢—ãˆã‚‹ã®ã§ã€ãã®æ¨ªã®`ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«è¨­å®šã‚’ä½œæˆ`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/5s4jlkt.png)\r\n\r\nå¤šåˆ†ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®šã§è‰¯ã„ã¯ãšã€èª¬æ˜ã¨ã‹ã¯æ›¸ããŸã‘ã‚Œã°æ›¸ã„ã¦ã­\r\n\r\n![Imgur](https://imgur.com/QKIIa7i.png)\r\n\r\nã“ã®è­¦å‘Šã¯å¾Œã§å¯¾å¿œã™ã‚‹ã®ã§ä¸€æ—¦é£›ã°ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/OvHFDSo.png)\r\n\r\nã‚ã¨ WAF ãŒãªã‚“ã¨ã‹ã¨ã‹è¨€ã‚ã‚Œã¦ã„ã‚‹ã®ã§ã™ãŒã€ä½¿ã‚ãªã„ã§è‰¯ã„ã¯ãšãªã®ã§ä½¿ã‚ãªã„ã§\r\n\r\n![Imgur](https://imgur.com/U96KwPW.png)\r\n\r\nã¨ã‚Šã‚ãˆãšä¸€ç•ªä¸‹ã¾ã§ç§»å‹•ã—ã¦ä½œæˆã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/NXiIJ0j.png)\r\n\r\nä½œæˆã§ãã‚‹ã¨ã€ã”ä¸å¯§ã«`S3`ã®è¨­å®šã‚’å¤‰æ›´ã—ãªã„ã¨ã ã‚ã®æ—¨ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€ãã‚Œã«å¾“ã„ã¾ã™  \r\n`ãƒãƒªã‚·ãƒ¼ã‚’ã‚³ãƒ”ãƒ¼`ã‚’æŠ¼ã—ã¦ã‚³ãƒ”ãƒ¼ã—ãŸå¾Œã€`S3 ãƒã‚±ãƒƒãƒˆã®æ¨©é™ã«ç§»å‹•ã—ã¦ãƒãƒªã‚·ãƒ¼ã‚’æ›´æ–°ã™ã‚‹`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/oJt8SI4.png)\r\n\r\næŠ¼ã—ãŸã‚‰`ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼`ã¾ã§ç§»å‹•ã—ã¦ã€`ç·¨é›†`ã‚’æŠ¼ã—ã¾ã™  \r\nãã—ã¦å…¥åŠ›æ¬„ã¸ã•ã£ãã‚³ãƒ”ãƒ¼ã—ãŸã®ã‚’ãƒšãƒ¼ã‚¹ãƒˆã—ã¾ã™ï¼\r\n\r\n![Imgur](https://imgur.com/jKclOM6.png)\r\n\r\n`JSON`ãŒè²¼ã‚Šä»˜ã‘ã‚‰ã‚Œã‚Œã°æˆåŠŸã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/P5q2fVm.png)\r\n\r\n`CloudFront`ã«æˆ»ã£ã¦ã€`ä¸€èˆ¬ã‚¿ãƒ–`ã¸ç§»å‹•ã—ã€`ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³å`ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚  \r\nãã—ã¦ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹æ¬„ã¸ã€ã‚³ãƒ”ãƒ¼ã—ãŸã‚„ã¤ã‚’è²¼ã‚Šä»˜ã‘ã€ãã®å¾Œã«`/index.html`ã‚’ã¤ã‘ã¾ã™\r\n\r\n![Imgur](https://imgur.com/ur3eGgc.png)\r\n\r\n![Imgur](https://imgur.com/gZGPpnt.png)\r\n\r\nã©ã†ã§ã—ã‚‡ã†ã€ã¡ã‚ƒã‚“ã¨ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã¦ã„ã‚‹ã§ã—ã‚‡ã†ã‹ï¼Ÿ  \r\n\r\n## ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã¨ HTTPS\r\n\r\nã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ï¼ˆ`CNAME`ï¼‰ã‚‚`HTTPS`ã‚‚ç„¡æ–™ã§å‡ºæ¥ã¾ã™ï¼ˆãƒ‰ãƒ¡ã‚¤ãƒ³ä»£ã¯åˆ¥ï¼‰\r\n\r\nã•ã‚“ã“ã†ï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html\r\n\r\nã¡ã‚ƒã‚“ã¨ãƒšãƒ¼ã‚¸ãŒè¦‹ã‚ŒãŸã¨ã“ã‚ã§ã€æ¬¡ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ã®é©ç”¨ã¨ HTTPS åŒ–ã‚’è¡Œã„ã¾ã™  \r\n`CloudFront`ã®è¨­å®šã®`ç·¨é›†`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/PBaxR4z.png)\r\n\r\nä»£æ›¿ãƒ‰ãƒ¡ã‚¤ãƒ³åã®é …ç›®ã§ã€`è¿½åŠ `ã‚’æŠ¼ã—ä½¿ã„ãŸã„ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥åŠ›ã—ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/ZAjHqso.png)\r\n\r\n![Imgur](https://imgur.com/KcWfkXy.png)\r\n\r\n![Imgur](https://imgur.com/6LaAU7w.png)\r\n\r\nã“ã‚Œã§`å¤‰æ›´ã‚’ä¿å­˜`ã—ã‚ˆã†ã¨ã™ã‚‹ã¨æ€’ã‚‰ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/UcmP0A9.png)\r\n\r\n```plaintext\r\nTo add an alternate domain name (CNAME) to a CloudFront distribution, you must attach a trusted certificate that validates your authorization to use the domain name. For more details, see: https://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements\r\n```\r\n\r\nhttps://docs.aws.amazon.com/AmazonCloudFront/latest/DeveloperGuide/CNAMEs.html#alternate-domain-names-requirements\r\n\r\nã¤ã¾ã‚Šã€`HTTPSåŒ– ( SSL/TLS è¨¼æ˜æ›¸ ) `ã‚‚ä¸€ç·’ã«ã—ãªã„ã¨`CNAME`ã®è¨­å®šãŒå‡ºæ¥ãªã„ã‚ˆã†ã§ã™ã€‚  \r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€ä¸Šã«ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—`ã‚«ã‚¹ã‚¿ãƒ  SSL è¨¼æ˜æ›¸`ã®é …ç›®ã‚’è¦‹ã¤ã‘ã¦ã€`è¨¼æ˜æ›¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆ`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/24lE43J.png)\r\n\r\n`Amazon Certificate Manager`ã¨ã‹è¨€ã†ç”»é¢ãŒé–‹ãã¾ã—ãŸã‹ï¼Ÿ  \r\n\r\n![Imgur](https://imgur.com/dqjIaAV.png)\r\n\r\n**ã§ã€ã“ã“ã«ãƒ¯ãƒŠãŒã‚ã£ã¦**ã€`CloudFront`ã§ä½¿ã†ãŸã‚ã«ã¯`ACM`ã®ãƒªãƒ¼ã‚¸ãƒ§ãƒ³ãŒ`us-east-1 (ãƒãƒ¼ã‚¸ãƒ‹ã‚¢åŒ—éƒ¨)`ã«ãªã£ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™\r\n\r\n![Imgur](https://imgur.com/rvZzw0s.png)\r\n\r\nã§ããŸã‚‰è¨¼æ˜æ›¸ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ã¾ã™ã€`ãƒªã‚¯ã‚¨ã‚¹ãƒˆ`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/rtJ1TY7.png)\r\n\r\nãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æ¬¡ã«è¡Œãã¾ã™\r\n\r\n![Imgur](https://imgur.com/HidjfV1.png)\r\n\r\nå®Œå…¨ä¿®é£¾ãƒ‰ãƒ¡ã‚¤ãƒ³å ã¯ä½¿ã„ãŸã„ãƒ‰ãƒ¡ã‚¤ãƒ³åã‚’å…¥ã‚Œã¾ã™ã€‚  \r\næ¤œè¨¼æ–¹æ³• ã¯`DNS`ã§è‰¯ã„ã¯ãšã€‚  \r\næœ¬å½“ã«æœ¬äººãŒæŒã£ã¦ã„ã‚‹ãƒ‰ãƒ¡ã‚¤ãƒ³ã‹ã©ã†ã‹ã‚’æ¤œè¨¼ã™ã‚‹ãŸã‚ã«ã€æŒã¡ä¸»ãŒ`DNS`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¦`Amazon`å´ã‹ã‚‰å¼•ã‘ã‚‹ã‹ã©ã†ã‹ã‚’è¦‹ã‚‹ã‚“ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/5BT5Dq9.png)\r\n\r\nä½œæˆã™ã‚‹ã¨ã€ä½œæ¥­ãŒå¿…è¦ãªæ—¨ãŒä¸Šã«è¡¨ç¤ºã•ã‚Œã‚‹ã®ã§ã€`è¨¼æ˜æ›¸ã‚’è¡¨ç¤º`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/AESm2a2.png)\r\n\r\nãƒ‰ãƒ¡ã‚¤ãƒ³ ã®é …ç›®ã§ã€`CNAME å` ã¨ `CNAME å€¤`ã¨ã„ã†ã®ãŒã‚ã‚‹ã¨æ€ã†ï¼  \r\nã“ã‚Œã‚’`DNS`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã¨ã—ã¦è¿½åŠ ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/x0MMQiu.png)\r\n\r\n### DNS æ¤œè¨¼\r\n\r\nç§ã¯ãƒ‰ãƒ¡ã‚¤ãƒ³ã®`DNS`ã«`Cloudflare`ï¼ˆãã‚‰ã†ã©ãµã‚Œã‚ï¼‰ã‚’ä½¿ã£ã¦ã¾ã™  \r\nã“ã®è¨˜äº‹ã§ã¯`CloudFront`ã¨ã„ã†ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒä½•åº¦ã‚‚å‡ºã¦ã„ã¾ã™ãŒã€ã“ã‚Œã¯`AWS`ã®ã‚µãƒ¼ãƒ“ã‚¹ã§ã™ã€‚  \r\n`Cloudflare`ã¯ä¼šç¤¾ã®åå‰ã§ã™ã€ã”ã£ã¡ã‚ƒã«ãªã‚‰ãªã„ã‚ˆã†æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„\r\n\r\nä»Šå›ã¯`Cloudflare DNS`ã®å ´åˆã§ã™ãŒã€å¤šåˆ†ã»ã‹ã§ã‚‚åŒã˜æ„Ÿã˜ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’é¸ã‚“ã§ã€`DNS`ã®ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã™ã‚‹ç”»é¢ã«æ¥ãŸã‚‰ã€`CNAME`ã§è¿½åŠ ã—ã¾ã™  \r\nName ã¨ Target ã‚’ãã‚Œãã‚Œ`CNAME å` `CNAME å€¤`ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Y5Q6PBd.png)\r\n\r\n![Imgur](https://imgur.com/3tiCc2B.png)\r\n\r\nãªã‚“ã‹å…¥åŠ›ã™ã‚‹ã¨ã€æœ€å¾Œã®`.`ãŒæ¶ˆãˆã¡ã‚ƒã†ã‚“ã ã‘ã©`Cloudflare`ã ã‹ã‚‰ãªã®ã‹ãªã€åˆ¥ã«æœ€å¾Œã®ãƒ‰ãƒƒãƒˆã¯æ¶ˆãˆã¦ã‚‚æ¤œè¨¼å‡ºæ¥ãŸã®ã§ã¾ã‚è‰¯ã„ã®ã‹ï¼Ÿ\r\n\r\nã—ã°ã‚‰ãå¾…ã¡ã¾ã™\r\n\r\n![Imgur](https://imgur.com/Xpc4fhW.png)\r\n\r\næ•°åˆ†å¾…ã£ã¦ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã¨ ç™ºè¡Œæ¸ˆã¿ ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/bv77LVh.png)\r\n\r\nã‚ã€`DNS`ã®è¨­å®šç”»é¢ã¯ã‚‚ã†ä¸€å›ä½¿ã†ã®ã§é–‹ã„ã¦ãŠã„ãŸã»ã†ãŒè‰¯ã„ã‹ã‚‚ï¼ˆé–‹ãç›´ã›ã°è‰¯ã„è©±ã ã‘ã©ï¼‰\r\n\r\n### CloudFront ã«æˆ»ã‚‹\r\n\r\nã“ã‚Œã§`ã‚«ã‚¹ã‚¿ãƒ  SSL è¨¼æ˜æ›¸`ã®é …ç›®ã‚‚åŸ‹ã‚ã‚‹ã“ã¨ãŒå‡ºæ¥ã‚‹ã¯ãšã€‚ã•ã£ãä½œã£ãŸã‚„ã¤ã‚’é¸ã¹ã°ã‚ªãƒƒã‚±ãƒ¼ã§ã™\r\n\r\n![Imgur](https://imgur.com/xvJQbRj.png)\r\n\r\n`å¤‰æ›´ã‚’ä¿å­˜`ã‚’æŠ¼ã—ã¦é–‰ã˜ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ã€‚\r\n\r\n### DNS ã«æˆ»ã‚‹\r\nã•ã£ãã¾ã§é–‹ã„ã¦ãŸ`DNS`ã®ãƒšãƒ¼ã‚¸ã‚’é–‹ãã¾ã™ã€ã‚‚ã—é–‰ã˜ãŸå ´åˆã¯é–‹ãç›´ã—ã¦ã­ã€‚  \r\n`CNAME`ã®è¨­å®šã‚’ã—ã¾ã™ã€`CNAME`ã§`CloudFront`ã‚’æŒ‡ã™ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n`CNAME`ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’è¿½åŠ ã—ã¾ã™ã€åå‰ã¯ã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³åã€å€¤ã¯`CloudFront`ã®`ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ¡ã‚¤ãƒ³å`ã‚’å…¥ã‚Œã¾ã™\r\n\r\n![Imgur](https://imgur.com/cWKXQ2m.png)\r\n\r\n![Imgur](https://imgur.com/Re2vOHg.png)\r\n\r\nã“ã“ã¾ã§å‡ºæ¥ãŸã‚‰ã€  \r\nã‚«ã‚¹ã‚¿ãƒ ãƒ‰ãƒ¡ã‚¤ãƒ³ + `/index.html`ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹æ¬„ã«å…¥åŠ›ã—ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã©ã†ã§ã™ã‹ï¼Ÿè¦‹ã‚Œã¾ã™ã‹ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/qro53Lk.png)\r\n\r\n## .html ç„¡ã—ã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã‚ˆã†ã« CloudFront Functions ã‚’æ›¸ã\r\nã“ã‚Œã‚‚äºŒå¹´ç›®ä»¥é™ã‚‚ä»˜ãç„¡æ–™æ ã®ç¯„å›²å†…ã«å…¥ã‚‹ã¨ã¯æ€ã†ã‘ã©ãªã‚\r\n\r\nã•ã‚“ã“ã†ï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/example-function-add-index.html\r\n\r\nä»Šã®ã“ã®ã¾ã¾ã ã¨ã€URLã®æœ€å¾Œã«`.html`æ‹¡å¼µå­ã‚’ä»˜ã‘ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¯é¢å€’ã§ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/2P3lHbT.png)\r\n\r\n`S3`ã®é™çš„ã‚µã‚¤ãƒˆãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°æ©Ÿèƒ½ã‚’ä½¿ã†å ´åˆã‚„ã€ã»ã¨ã‚“ã©ã®ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã¯å‹æ‰‹ã«ã‚„ã£ã¦ãã‚Œã¾ã™ãŒã€`CloudFront OAC`ã§ä½œã£ãŸå ´åˆã¯ã“ã®å•é¡Œã«ã¶ã¡å½“ãŸã‚Šã¾ã™ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§ã€`CloudFront Functions`ã§`S3`ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹éš›ã«`URL`ã‚’åŠ å·¥ã—ã¦`.html`ã‚’ã¤ã‘ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚\r\n\r\n`CloudFront`ã‚’é–‹ãé–¢æ•°ã‚’é¸ã³ã¾ã™\r\n\r\n![Imgur](https://imgur.com/JfkXJBm.png)\r\n\r\né–¢æ•°ã‚’ä½œæˆã‚’é¸ã³ã¾ã™ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/sROEgZL.png)\r\n\r\nã„ã„æ„Ÿã˜ã®åå‰ã‚’ã¤ã‘ã¦\r\n\r\n![Imgur](https://imgur.com/4mGOxc3.png)\r\n\r\nã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ã‚’ãã®ã¾ã¾ä½¿ãŠã†ã¨æ€ã„ã¾ã™  \r\nhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/example-function-add-index.html\r\n\r\n![Imgur](https://imgur.com/RSbI2b9.png)\r\n\r\n`index.html`ãŒãªã‘ã‚Œã°ã¤ã‘ã‚‹å‡¦ç†ã§ã™ã€‚  \r\n`JavaScript`ã§ã™ãŒçµæ§‹åˆ¶é™ãŒã‚ã‚Šã¾ã™ï¼šhttps://docs.aws.amazon.com/ja_jp/AmazonCloudFront/latest/DeveloperGuide/edge-functions.html\r\n\r\nä¿å­˜ã—ãŸã‚‰ç™ºè¡Œã‚¿ãƒ–ã‚’é–‹ãã€`é–¢æ•°ã®ç™ºè¡Œ`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/4wJjXBs.png)\r\n\r\nãã®ã‚ã¨ã€ä¸‹ã« é–¢é€£ä»˜ã‘ã•ã‚Œã¦ã„ã‚‹ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ ã®é …ç›®ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€ã“ã“ã§`é–¢é€£ä»˜ã‘ã‚’è¿½åŠ `ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/T7VNnNi.png)\r\n\r\nä»¥ä¸‹ã‚’åŸ‹ã‚ã¾ã™\r\n\r\n- ãƒ‡ã‚£ã‚¹ãƒˆãƒªãƒ“ãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ ã¯ã•ã£ãä½œã£ãŸ`CloudFront`ã‚’é¸ã¶\r\n- ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ— ã¯`Viewer request`ã‚’é¸ã¶\r\n- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ“ãƒ˜ã‚¤ãƒ“ã‚¢ ã¯å¤šåˆ†`default`ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/iGsb5tk.png)\r\n\r\nã“ã‚Œã§`URL`ã®æœ«å°¾ã«`index.html`ã‚’ã¤ã‘ãªãã¦ã‚‚è¦‹ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/SYoWLpR.png)\r\n\r\né•·ã‹ã£ãŸ...\r\n\r\n# ãŠã‚ã‚Šã«\r\nçµæ§‹å¤§å¤‰ï¼\r\nãã‚Œã˜ã‚ƒå¾Œã¯ãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã‚’`html / js`ã«æ›¸ãå‡ºã—ã¦ `S3` ã«ä¸Šã’ã‚‹ã ã‘ã€‚  \r\n\r\nã•ã¦ã€ã€ã€ã€ãƒ‹ã‚³ç”Ÿã‚²ãƒ¼ãƒ ã€å¤ã„ã‚„ã¤ã ã¨3å¹´å‰ãã‚‰ã„å‰ã«ãªã‚‹ã‚“ã ã‘ã©ã¡ã‚ƒã‚“ã¨æ›¸ãå‡ºã—ã§ãã‚‹ã‹ãª...ï¼ˆ`package-lock.json`æ¶ˆã—ãŸã‚‰å‡ºæ¥ãŸ\r\n\r\n![Imgur](https://imgur.com/QFP82El.png)\r\n\r\n![Imgur](https://imgur.com/BQwx4W0.png)"},{"title":"npm i ã™ã‚‹ã¨ cb() never called npm","link":"/posts/node_js_cb_called_npm/","markdown":"\n<p style=\"color:red;font-size:30px\">ä½•å›ã‹ npm i ã—ã¦ãŸã‚‰ç›´ã‚Šã¾ã—ãŸ</p>\n\nä¼‘æ—¥ãŒçµ‚ã‚ã‚‹ã€‚ç¤¾ä¼šäººã—ã‚“ã©ããªã„ï¼Ÿ\n\n```\ntiming npm Completed in 7273ms\nerror cb() never called!\nerror This is an error with npm itself. Please report this error a\nerror <https://npm.community>\n```\n\n# ç›´ã‚‰ãªã‹ã£ãŸ\n- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆã™\n    - `npm cache clean --force`\n    - ç›´ã‚‰ãªã„\n- `node_module`ã‚’æ¶ˆã™\n    - ç›´ã‚‰ãªã„\n- `package-lock.json`ã‚’æ¶ˆã™\n    - ç›´ã‚‰ãªã„\n- Node.jså†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\n    - ï¼ˆç¢ºã‹ï¼‰ç›´ã‚‰ãªã‹ã£ãŸ\n- Wi-Fiã‚’ç„¡åŠ¹ã«ã—ãŸã‚Šæœ‰åŠ¹ã«ã—ãŸã‚Šã—ãŸã€‚å†èµ·å‹•ã‚‚ã—ã¦ã¿ã‚‹\n    - ï¼ˆç¢ºã‹ï¼‰ç›´ã‚‰ãªã‹ã£ãŸ\n\n# ä»•æ–¹ãªããƒ¬ãƒãƒ¼ãƒˆã‚’é–‹ã\n\nã“ã‚“ãªã‚„ã¤â†“\n\n```\nnpm-cache\\_logs\\2021-04-04T09_40_13_200Z-debug.log\n```\n\nã§è¦‹ã¦ã¿ã‚‹ã¨ã€æ¯å›é•ã†ã¨ã“ã‚ã§ã‚³ã‚±ã¦ã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚\n\n```\n1597 http fetch GET 200 https://registry.npmjs.org/escape-string-regexp/-/escape-string-regexp-4.0.0.tgz 56ms\n1598 silly pacote range manifest for escape-string-regexp@^4.0.0 fetched in 60ms\n1599 timing npm Completed in 16630ms\n1600 error cb() never called!\n1601 error This is an error with npm itself. Please report this error at:\n1602 error <https://npm.community>\n```\n\nâ†“\n\n```\n3459 http fetch GET 200 https://registry.npmjs.org/file-uri-to-path/-/file-uri-to-path-1.0.0.tgz 44ms\n3460 silly pacote version manifest for file-uri-to-path@1.0.0 fetched in 133ms\n3461 timing npm Completed in 15087ms\n3462 error cb() never called!\n3463 error This is an error with npm itself. Please report this error at:\n3464 error <https://npm.community>\n```\n\nâ†“\n\n```\n2712 http fetch GET 304 https://registry.npmjs.org/iferr 41ms (from cache)\n2713 silly pacote range manifest for iferr@^0.1.5 fetched in 42ms\n2714 timing npm Completed in 7273ms\n2715 error cb() never called!\n2716 error This is an error with npm itself. Please report this error at:\n2717 error <https://npm.community>\n```\n\nãªã®ã§ã€ä½•å›ã‹`npm i`ã—ã¦ãŸã‚‰ãªã‚“ã‹ç›´ã£ã¦ã¾ã—ãŸã€‚ãªã‚“ã§ã‚„"},{"title":"Node.jsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã§é–‹ã„ãŸã‚‰è„†å¼±æ€§ãŒã‚ã‚‹ã¨è¨€ã‚ã‚ŒãŸã¨ã","link":"/posts/node_js_github_dependencies/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€è‡ªåˆ†ç”¨ãƒ¡ãƒ¢ã€‚\r\n\r\n# æœ¬é¡Œ\r\nNode.jsãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã§é–‹ã„ãŸã‚‰ãªã‚“ã‹è­¦å‘ŠãŒå‡ºã¦ã„ãŸã®ã§æ¶ˆã—ã¦ã¿ã‚‹ã€‚\r\n\r\n```bash\r\nWe found potential security vulnerabilities in your dependencies.\r\nOnly the owner of this repository can see this message.\r\n```\r\n\r\n![Imgur](https://imgur.com/9yLmNje.png)\r\n\r\n## è‡ªåˆ†ã§å…¥ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å ´åˆã¯\r\n\r\n`npm i ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå`\r\n\r\nã™ã‚Œã°è‰¯ã„ã¯ãš\r\n\r\n## ç›´ã—æ–¹1 ( è¿½è¨˜ 2023/07/11 )\r\nè‡ªåˆ†ã§å…¥ã‚ŒãŸãƒ©ã‚¤ãƒ–ãƒ©ãƒªã§ã¯ãªã„ï¼ˆãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ä¸­ã§ä½¿ã‚ã‚Œã¦ã„ã‚‹ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®å ´åˆï¼‰  \r\nã‚‚ã—ã‹ã—ãŸã‚‰ãƒ©ã‚¤ãƒ–ãƒ©ãƒªé–‹ç™ºè€…ã•ã‚“ãŒå¯¾å¿œã—ã¦ãã‚Œã¦ã„ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\r\n\r\n`package-lock.json` ã¨ `node_modules` ã‚’æ¶ˆã—ãŸå¾Œã€ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ PowerShellã¨ã‹ï¼‰ã‚’é–‹ã„ã¦  \r\n`npm i` ã‚’ã™ã‚‹ã¨å¯¾å¿œçµ‚äº†ã™ã‚‹ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚\r\n\r\n## ç›´ã—æ–¹2\r\n\r\nã¨ã‚Šã‚ãˆãš `package.json` ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€å†…ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆPowerShellã¨ã‹ï¼‰ã‚’é–‹ãã€ `npm audit` ã‚’å©ãã¾ã™ã€‚  \r\n\r\nãã—ãŸã‚‰ã“ã‚“ãªãµã†ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒã€‚\r\n```bash\r\nnpm audit\r\n\r\n=== npm audit security report ===\r\n\r\n# Run  npm update minimist --depth 2  to resolve 1 vulnerability\r\n\r\n  Critical        Prototype Pollution in minimist\r\n\r\n  Package         minimist\r\n\r\n  Dependency of   next-sitemap [dev]\r\n\r\n  Path            next-sitemap > minimist\r\n\r\n  More info       https://github.com/advisories/GHSA-xvch-5gv4-984h\r\n\r\n\r\n\r\nfound 1 critical severity vulnerability in 607 scanned packages\r\n  run `npm audit fix` to fix 1 of them.\r\n\r\n```\r\n`Path`ã®éƒ¨åˆ†ã‚’è¦‹ã‚‹ã¨ã€`next-sitemap > minimist`ã¨æ›¸ã‹ã‚Œã¦ã¾ã™ã­ã€‚  \r\n`next-sitemap`ã®ä¸­ã§ä½¿ã£ã¦ã„ã‚‹`minimist`ã£ã¦ãƒ©ã‚¤ãƒ–ãƒ©ãƒªï¼ˆãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼‰ã«å¯¾ã—ã¦è„†å¼±æ€§ãŒã‚ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚  \r\nãªã‚“ã‹`npm audit fix`ã§ç›´ã›ã‚‹ã‚‰ã—ã„ã§ã™ãŒã€ä»Šå›ã¯`npm i next-sitemap`ã‚’å©ã„ã¦å¤§æœ¬ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›´æ–°ã™ã‚‹æ–¹é‡ã§è¡Œãã¾ã™ã€‚\r\n\r\n## å¤§æœ¬ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›´æ–°ã™ã‚‹\r\nã¯ã„ã€‚  \r\nå„è‡ªå¤§æœ¬ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ›´æ–°ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```bash\r\nnpm i next-sitemap\r\n```\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‡ºæ¥ãŸã®ã§ã€å†åº¦ç¢ºèªã—ã¾ã™ã€‚\r\n\r\n```bash\r\nnpm audit\r\n\r\n=== npm audit security report ===                        \r\n\r\nfound 0 vulnerabilities\r\n in 605 scanned packages\r\n```\r\n\r\næ¶ˆãˆã¦ã„ã¾ã—ãŸã€‚  \r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# GitHubã¸Push\r\n\r\nGitHubã¸Pushã—ã€æ•°åç§’å¾Œã«ã¡ã‚ƒã‚“ã¨æ¶ˆãˆã¦ã„ã¾ã—ãŸã€‚ã‚ˆã‹ã£ãŸ\r\n\r\n![Imgur](https://imgur.com/zAKmxGs.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\n\r\nã‚ˆãçŸ¥ã‚‰ã‚“ã‘ã©`package-lock.json`åŸºæœ¬ã„ã˜ã£ãŸã‚‰é§„ç›®ã ã‚ˆã­ï¼Ÿ"},{"title":"Nuxt.jsã®Full StaticãŒã™ã”ã„","link":"/posts/nuxt_2_13_sugoi/","markdown":"\r\næ­¯ç£¨ãã—ãŸã‚‰è¡€ãŒå‡ºãŸã€‚ã¡ã‚‡ã£ã¨ã³ã£ãã‚Šã—ãŸ\r\n\r\n# æœ¬é¡Œ\r\nNuxt.jsã®2.13ã‹ã‚‰`å®Œå…¨ãªé™çš„ç”Ÿæˆ`æ©Ÿèƒ½ãŒã¤ã„ãŸæ¨¡æ§˜ã€‚  \r\nã‚€ã—ã‚ä»Šã¾ã§ã¯å®Œå…¨ã§ã¯ãªã‹ã£ãŸã®ã‹ï¼Ÿã£ã¦è©±ã§ã‚ˆãã‚ã‹ã‚‰ãªã„ã‘ã©ã€ã“ã®ä¸­ã«ã‚ã‚‹`ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°è‡ªå‹•ç”Ÿæˆ`ãŒå¤šåˆ†å¼·ã„ã€‚\r\n\r\nè©³ã—ãã¯ã“ã‚Œ  \r\n[æœ¬å®¶ãƒ–ãƒ­ã‚°](https://nuxtjs.org/blog/going-full-static)\r\n\r\n\r\n# ã“ã‚“ãªã‚“èª­ã‚“ã§ã‚‰ã‚Œã‚“ã‚\r\n\r\n- 1.Nuxt.jsã‚’ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚‹\r\n- 2.`nuxt.config.js`ã«ã“ã‚“ãªæ„Ÿã˜ã§`target:static`ã‚’æŒ‡å®š\r\n```js\r\nexport default {\r\n  // é™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã—ã€‚universalã¨staticå…¥ã‚Œã¦ã­\r\n  mode: 'universal',\r\n  target: 'static',\r\n}\r\n```\r\n- 3.`package.json`ã®`generate`ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä»¥ä¸‹ã«å¤‰æ›´\r\n```json\r\n\"scripts\": {\r\n  \"generate\": \"nuxt build && nuxt export\",\r\n}\r\n```\r\n- 4.`npm run generate`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚`dist`ãƒ•ã‚©ãƒ«ãƒ€ãŒã§ãã‚‹ã€‚ãŠã¤ã‹ã‚Œæ§˜ã§ã™ã€‚\r\n- ãŠã¾ã‘ï¼š`npx nuxt serve`ã§é™çš„ç”Ÿæˆã—ãŸã‚µã‚¤ãƒˆã‚’ã™ãã«ç¢ºèªã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚\r\n\r\n# ä½•ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ï¼Ÿ\r\n- æ–°ã—ããªã£ãŸé™çš„ç”Ÿæˆ\r\n    - `nuxt generate`ã‹ã‚‰\r\n    - `nuxt build && nuxt export`ã¸\r\n- æ€–ããªã„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\r\n    - å‹æ‰‹ã«ãƒšãƒ¼ã‚¸ã‚’è§£æã—ã€ãƒªãƒ³ã‚¯ã‚’è‡ªå‹•ã§è¦‹ã¤ã‘ã¦å‹æ‰‹ã«ç”Ÿæˆã—ã¾ã™ã€‚\r\n    - ã©ã†ã„ã†ã“ã¨ã‹ã¨è¨€ã†ã¨ã€ä»¥ä¸‹ã®JSã®ç”¨ã«`generate.routes`ã‚’æ›¸ãå¿…è¦ãŒã‚‚ã†ãªã„ã¨ã„ã†ã“ã¨ã§ã™ã€‚**ã‚³ãƒ¡ãƒ³ãƒˆã¨åŒ–ã—ãŸçµæ§‹é‡è¦ï¼ˆå¤šåˆ†ä¸€ç•ªã‚ã‚“ã©ã„ï¼‰ãªéƒ¨åˆ†**\r\n```js\r\nexport default {\r\n  generate: {\r\n    // routes: generateRoutes, // ç”Ÿæˆã™ã‚‹\r\n    dir: 'docs'\r\n  },\r\n}\r\n```\r\n\r\n# Nuxt.jsã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ\r\n2.0ã‹ã‚‰2.13ã¸ä¸Šã’ã¾ã™ã€‚  \r\n## package.json é–‹ã„ã¦\r\n\r\n`dependencies`ã®ä¸­ã®`nuxt`ã‚’`^2.13.1`ã«ã—ã¾ã™ã€‚ä»¥ä¸‹ã¯ä¸€ä¾‹\r\n\r\n```json\r\n\"dependencies\": {\r\n  \"@nuxtjs/google-analytics\": \"^2.3.0\",\r\n  \"@nuxtjs/markdownit\": \"^1.2.9\",\r\n  \"@nuxtjs/pwa\": \"^3.0.0-0\",\r\n  \"markdown-it-footnote\": \"^3.0.2\",\r\n  \"markdown-it-highlight\": \"^0.2.0\",\r\n  \"nuxt\": \"^2.13.1\"\r\n},\r\n```\r\n\r\nãªãŠç§ã‚‚ã‚ˆãåˆ†ã‹ã£ã¦ã„ãªã„ã€‚`^`â†ã“ã‚Œãªã«ï¼Ÿ\r\n\r\n## package-lock.json ãƒ•ã‚¡ã‚¤ãƒ«ã¨ node_modules ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¶ˆã™\r\n\r\nnpm installã§å†å¬å–šã™ã‚‹ã®ã§å¤§ä¸ˆå¤«\r\n\r\n## npm install ã‚’å®Ÿè¡Œ\r\n`npm install`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  \r\nãŠãã‚‰ããŠã¾ç’°ã ã‚ã†ã‘ã©ç§ã®ç’°å¢ƒã§ã¯**ç®¡ç†è€…æ¨©é™**ãªã„ã¨ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\r\n\r\n### ã“ã‘ã‚‹\r\nã¾ã‚ã†ã¾ãè¡Œã‹ãªã„ã‚ˆã­\r\n- `Unexpected end of JSON input while parsing`ãªã‚“ã¨ã‹\r\n    - ç®¡ç†è€…æ¨©é™ã§cmdç­‰ã‚’é–‹ã„ã¦`npm cache clean --force`ã‚’å®Ÿè¡Œã™ã‚‹ã€‚**ä½•ã—ã¦ã‚‹ã‹åˆ†ã‹ã£ã¦ã‚‹ã‚ˆãªï¼Ÿ** ã£ã¦è¨€ã‚ã‚ŒãŸã€‚åˆ†ã‹ã‚‰ãªã„  \r\n    `npm WARN using --force I sure hope you know what you are doing.`\r\n\r\n# nuxt.config.js ã‚’é–‹ã\r\né–‹ã„ãŸã‚‰ã€é™çš„ç”Ÿæˆã—ã¦ï¼¾ï½ã£ã¦Nuxtã«ä¼ãˆã¾ã™ã€‚  \r\n`target:static`ã‚’è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n```js\r\nexport default {\r\n  // é™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã—ã€‚universalã¨staticå…¥ã‚Œã¦ã­\r\n  mode: 'universal',\r\n  target: 'static',\r\n}\r\n```\r\n\r\n# nuxt build && nuxt export\r\n`package.json`ã‚’é–‹ã„ã¦ã€`script`ã«ã‚ã‚‹ã€`generate`ã‚’æ›¸ãæ›ãˆã¾ã™ã€‚\r\n\r\n```json\r\n\"scripts\": {\r\n  \"generate\": \"nuxt build && nuxt export\",\r\n}\r\n```\r\n\r\n# npm run generate å®Ÿè¡Œ\r\nã™ã‚‹ã¨ç”Ÿæˆã•ã‚Œã¾ã™ã€‚ãŠç–²ã‚Œæ§˜ã§ã—ãŸï½\r\n\r\n# æ€–ããªã„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°  \r\nä»Šå›ã®Nuxt.jsã•ã‚“ã¯ã€å‹æ‰‹ã«ãƒªãƒ³ã‚¯ã‚’è¦‹ã¤ã‘ã¦ãƒªãƒ³ã‚¯ã®åˆ†ã ã‘ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§ã‚‚ã†ä¸è¦ã§ã™ã€‚  \r\nã„ã‚„ãƒ¼ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°é¢å€’ã ã£ãŸã®ã§ã“ã‚Œã¯ã¨ã¦ã‚‚ã‚ã‚ŠãŒãŸã„ã€‚\r\n\r\nä¸€å¿œã€`nuxt.config.js`ã§æ˜ç¤ºçš„ã«ç„¡åŠ¹ã«ã™ã‚‹ï¼ˆ`generate.crawler: false`ï¼‰ã“ã¨ã§æ—§ä»•æ§˜ï¼ˆ`generate.routes`ï¼‰ã‚’åˆ©ç”¨ã§ãã‚‹ã£ã½ã„ã€‚\r\n\r\n# é™çš„ç”Ÿæˆã—ãŸã‚µã‚¤ãƒˆã‚’ç¢ºèªã§ãã‚‹æ©Ÿèƒ½\r\næœ¬ç•ªç’°å¢ƒï¼ˆç§ãªã‚‰Netlifyï¼‰ã«å…¬é–‹ã•ã‚ŒãŸå ´åˆã©ã‚“ãªæ„Ÿã˜ã«è¦‹ã‚Œã‚‹ã®ã‹ï¼ˆå¤šåˆ†å¤‰ã‚ã‚‰ã‚“ã¨æ€ã†ã‘ã©ï¼‰ã‚’ç¢ºèªã§ãã‚‹æ©Ÿèƒ½ãŒä»˜ãã¾ã—ãŸã€‚\r\n\r\n- ä¸€åº¦ãã‚Šãªã‚‰\r\n    - `npx nuxt serve`ï¼ˆpackage.jsonã«scriptæ›¸ã‹ãªãã¦ã‚‚ã€`npx`ä½¿ãˆã°ç›´æ¥ä½¿ãˆã‚‹ï¼‰\r\n- package.jsonã«æ›¸ããªã‚‰\r\n```json\r\n\"scripts\": {\r\n  \"staticdev\": \"nuxt serve\",\r\n}\r\n```\r\nå®Ÿè¡Œã¯`npm run staticdev`ï¼ˆåˆ¥ã«`staticdev`ã£ã¦åå‰ã§ã‚ã‚‹å¿…è¦ã¯ãªã„ã€‚ã¿ã‚“ãªã¯ã‹ã£ã“ã„ã„åå‰ã‚’ã¤ã‘ã¦ã‚ã’ã‚ˆã†ï¼‰\r\n\r\n# ãŠã¾ã‘\r\n## VuetifyãŒå¤‰ã‚ã£ãŸï¼Ÿ\r\n\r\n`v-content`ã‹ã‚‰`v-main`ã«ãªã£ãŸæ¨¡æ§˜\r\n\r\nã‚ã¨å¼·åˆ¶ä¸Šæ›¸ãCSSãŒã¾ãŸå‹•ã‹ãªããªã£ã¦ãŸï¼ˆåŠ›æŠ€ã‚„ã‚ã¨ã‘ï¼‰  \r\nãã‚Œã§ãµã¨`SCSS`ã£ã¦ã‚„ã¤ã§VuetifyãŒé©ç”¨ã™ã‚‹CSSã®å†…å®¹å¤‰ãˆã‚‰ã‚Œã‚‹ã‚„ã‚“ã£ã¦æ€ã£ã¦è¦‹ã¦ã¿ã‚‹ã¨ã€ã‚ã‚‹ã‚“ã§ã™ã­ï½\r\n\r\n```scss\r\n// VuetifyãŒå‹æ‰‹ã«è‰²ã¤ã‘ã‚‹å•é¡Œ\r\n$code-background-color: '#000000';\r\n```\r\n\r\n`code-background-color`ãªã‚“ã¦ã„ã¤ã®é–“ã«è¿½åŠ ã—ã¦ãŸã®ï¼Ÿ\r\n\r\nã¾ãŸä»Šåº¦ã‚„ã‚ã†ã¨æ€ã„ã¾ã™\r\n\r\n# ãŠã‚ã‚Šã«\r\n`npx`ãªã‚“ã¦ä¾¿åˆ©ãªæ©Ÿèƒ½ã‚ã£ãŸã‚“ã§ã™ã­ï¼ˆãˆï¼‰\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸã€‚\r\nhttps://nuxtjs.org/blog/going-full-static  \r\nhttps://ja.nuxtjs.org/guide/upgrading/  \r\nhttps://microcms.io/blog/nuxt-full-static-generation/"},{"title":"nuxtã§cssã‚’æŒ‡å®šã™ã‚‹ã¨ Could not compile template","link":"/posts/nuxt_css_err/","markdown":"ã©ã†ã‚‚ã“ã‚“ã«ã¡ã¯ã€‚ãã‚ãã‚è™«ã®å­£ç¯€ã‹ãƒ¼å«Œã ãªãƒ¼\r\n\r\n# æœ¬é¡Œ\r\n\r\n`nuxt.config.js`ã§`CSS`ã‚’æŒ‡å®šã™ã‚‹ã¨æ€’ã‚‰ã‚Œã‚‹\r\n\r\n```\r\nCould not compile template ~\r\n```\r\n\r\n# ç›´ã™\r\n\r\nhttps://ja.nuxtjs.org/docs/2.x/configuration-glossary/configuration-css/\r\n\r\nã“ã‚Œè¦‹ã‚‹ã¨`@`ãŒå¿…è¦ã¿ãŸã„ã ã‘ã©ãªã‚“ã‹ã„ã‚‰ãªã‹ã£ãŸã‚ã€‚\r\n\r\n```js\r\n  css: [\r\n    \"assets/css/styles.css\" // @ ãªã—ã§æ›¸ã\r\n  ],\r\n```"},{"title":"Nuxt.jsã®ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒãŒã¯ã‚„ã„","link":"/posts/nuxt_link_hayai/","markdown":"\r\nã¾ãšã¯ã“ã¡ã‚‰ã®GIFã‚’è¦‹ã¦ãã ã•ã„ï¼ˆ3MBãã‚‰ã„ï¼‰\r\n\r\n![Imgur](https://i.imgur.com/oyePdWI.gif)\r\n\r\nå·¦å´ã¯ä»Šã¾ã§ã€å³å´ã¯Nuxt.jsã®Smart Prefechingæ©Ÿèƒ½ã‚’ä½¿ã£ãŸãƒšãƒ¼ã‚¸é·ç§»ã§ã™ã€‚  \r\n\r\næŠ¼ã—ãŸç¬é–“ã«åˆ‡ã‚Šæ›¿ã‚ã£ã¦ã„ã‚‹ã“ã¨ãŒåˆ†ã‹ã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# Smart Prefeching ã¨ã¯\r\n[æœ¬å®¶ãƒ–ãƒ­ã‚°](https://nuxtjs.org/blog/introducing-smart-prefetching)\r\n\r\nãƒ–ãƒ©ã‚¦ã‚¶ã®è¡¨ç¤ºé ˜åŸŸã«ãƒªãƒ³ã‚¯`<nuxt-link>`ã‚’è¦‹ã¤ã‘ãŸã‚‰ãã®ãƒªãƒ³ã‚¯ã‚’ãƒ–ãƒ©ã‚¦ã‚¶ãŒå…ˆèª­ã¿ã™ã‚‹æ©Ÿèƒ½ã€‚ã“ã‚Œã‚’ãƒ—ãƒªãƒ•ã‚§ãƒƒãƒæ©Ÿèƒ½ã£ã¦ã„ã†ã‚‰ã—ã„ã€‚\r\n\r\n# ä½¿ã„æ–¹\r\n- `<nuxt-link>`ã‚’ä½¿ã†\r\n- Vuetifyã®å ´åˆ\r\n    - `to=\"é·ç§»å…ˆ\"`ã¨`nuxt`ã‚’å±æ€§ã«ä»˜ã‘ã‚‹ã“ã¨ã§åˆ©ç”¨å¯èƒ½ã€‚`nuxt`ã‚’ä»˜ã‘å¿˜ã‚Œã‚‹ã¨æ©Ÿèƒ½ã—ãªã„ã€‚\r\n    - GIFã®ç”¨ã«`<v-card>`ã‚’ãƒšãƒ¼ã‚¸é·ç§»ã«ä½¿ã†éš›ã¯ã“ã‚“ãªé¢¨ã«\r\n```html\r\n<v-card\r\n  class=\"ma-2 pa-5\"\r\n  to=\"`/posts/taihendattakoto\"\r\n  nuxt\r\n>\r\n</v-card>\r\n```\r\n\r\nä»¥ä¸Šã§ã™ã€‚"},{"title":"Nuxtã®é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã¯ãƒ¢ãƒ¼ãƒ‰ã‚’universalã«ã—ã‚ˆã†","link":"/posts/nuxt_universal/","markdown":"\r\né™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã›ã¦ãŸã¨æ€ã£ãŸã‚‰æ›¸ãå‡ºã›ã¦ãªã‹ã£ãŸè©±ã§ã™ã€‚  \r\nã“ã‚Œä»¥å¤–ã«ã‚‚å¤§å¤‰ã ã£ãŸã“ã¨ãŒã„ã£ã±ã„ã‚ã‚‹ã®ã§ã‚‚ã—ã‚ˆã‘ã‚Œã°è¦‹ã¦ã­ã€‚â†’[å¤§å¤‰ã ã£ãŸã“ã¨](/posts/taihendattakoto)\r\n\r\n# ãªã«ãŒã‚ã£ãŸã®\r\nMastodonã®èªè¨¼ãƒãƒ¼ã‚¯ãŒä»˜ã‹ãªã‹ã£ãŸã€‚  \r\nMastodonã®èªè¨¼ãƒãƒ¼ã‚¯ã¯ã‚µã‚¤ãƒˆã«aã‚¿ã‚°ç½®ã„ã¦ã€hrefã¨`rel=\"me\"`ä»˜ã‘ã°é€šã‚‹ã€‚ã¡ã‚ƒã‚“ã¨Chromeã§ã‚ã£ã¦ã‚‹ã‹ç¢ºèªã—ãŸã‚“ã ã‘ã©ã€ãªãœã‹èªè¨¼ã•ã‚Œãªã‹ã£ãŸã€‚\r\n\r\n## ã•ã‚‰ã«\r\nJavaScriptã‚’ç„¡åŠ¹ã«ã™ã‚‹ã¨ï¼ˆã‚ã£ãŸã«ãªã„ã‘ã©ï¼‰çœŸã£ç™½ã«ãªã£ãŸã€‚  \r\né™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã—ãªã‚‰ãŸã HTMLã‚’è¡¨ç¤ºã™ã‚‹ã ã‘ãªã®ã«ãªã‚“ã§JSæ¶ˆã™ã¨å‹•ã‹ãªããªã‚‹ã‚“ã ï¼Ÿã€‚JSãŒã©ã†ã“ã†é–¢ä¿‚ãªãã­ï¼Ÿ  \r\n\r\n**ã‚ã‚Œã“ã‚ŒJavaScriptã§å‹•çš„ã«DOMæ“ä½œï¼Ÿ**\r\n\r\n# é™çš„ã‚µã‚¤ãƒˆã‚’æ›¸ãå‡ºã™æ–¹æ³•\r\n\r\n`nuxt.config.js`ã®`mode`ã‚’`universal`ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\n\r\nãã†ã™ã‚Œã°HTMLãƒ•ã‚¡ã‚¤ãƒ«ã«ã¡ã‚ƒã‚“ã¨å†…å®¹ãŒã¾ã‚“ã¾å…¥ã£ã¦ã‚‹ã¯ãšã§ã™ã€‚\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«â†“  \r\n![Imgur](https://imgur.com/WkV9GT2.png)\r\n\r\n(ã¡ãªã¿ã«VSCodeã€`Ctrlã¨+`ã§æ‹¡å¤§ã€`Ctrlã¨-`ã§ç¸®å°ãŒã§ãã¾ã™ã€‚é–“é•ãˆã¦æŠ¼ã—ãŸæ™‚ã«è¦šãˆã¦ãŠã‘ã°è‰¯ã„ã‹ã‚‚ï¼Ÿ)\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# ãŠã¾ã‘\r\n`mode:'universal'`ã«ã—ãŸã›ã„ã‹ã€Vuetifyã®Chipã®ã¨ã“ã‚ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã‚ˆã†ã«ãªã£ã¡ã‚ƒã£ãŸã€‚  \r\nã‚ˆãã‚ã‹ã‚‰ãªã„ã®ã§ã¨ã‚Šã‚ãˆãš`<client-only>`ã§é»™ã‚‰ã›ãŸï¼ˆãˆï¼‰\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://jamstack.jp/blog/nuxt_stumble_point/"},{"title":"Vue packages version mismatch ã‚’ç›´ã™","link":"/posts/nuxt_vue_version_missing/","markdown":"\r\n`npm audit fix`ã—ãŸã‚‰ã“ã†ãªã£ãŸ\r\n\r\n# æœ¬é¡Œ\r\n\r\n```\r\nâœ– Nuxt Fatal Error                                                                   \r\n                                                                                      \r\nError:                                                                                \r\n                                                                                      \r\nVue packages version mismatch:                                                        \r\n                                                                                      \r\n- vue@2.6.11                                                                          \r\n- vue-server-renderer@2.6.12                                                          \r\n                                                                                      \r\nThis may cause things to work incorrectly. Make sure to use the same version for both.\r\n```\r\n\r\nã¯ã„\r\n\r\n# ç›´ã—æ–¹\r\n`vue`ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ã¾ã™\r\n\r\n```\r\nnpm i vue\r\n```\r\n\r\n`+ vue@2.6.12`ã¨ã‹å‡ºã¦ã‚Œã°ãŠï½‹ã ã¨æ€ã†\r\n\r\nã“ã‚Œã§å®Ÿè¡Œã§ãã‚‹ã¨æ€ã„ãã‚„ã€ã§ããªã„\r\n\r\n```\r\nVue packages version mismatch:\r\n\r\n- vue@2.6.12\r\n- vue-template-compiler@2.6.11\r\n```\r\n\r\nã¨ã„ã†ã‚ã‘ã§`npm i vue-template-compiler`ã®æ–¹ã‚‚ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚ã’ã¾ã™\r\n\r\n```\r\nnpm i vue-template-compiler\r\n```\r\n\r\nã“ã‚Œã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ãŠã¤"},{"title":"OkHttpã¨Coroutineã§åˆ†å‰²ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’å®Ÿè£…ã™ã‚‹","link":"/posts/okhttp_split_download/","markdown":"\r\né«˜æ ¡ç”Ÿãƒ–ãƒ©ãƒ³ãƒ‰ãŒã‚ã¨æ•°æ—¥ã§ãªããªã‚Šã¾ã™ã­\r\n\r\n# æœ¬é¡Œ\r\nãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒé…ã„ã®ã§ã„ãã¤ã‹ã«åˆ†ã‘ã¦ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„  \r\nãŸã ã§ã•ãˆé€Ÿåº¦ãŒé…ã„ã‚“ã ã‹ã‚‰ã•ã‚\r\n\r\n## åˆ†å‰²ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã®èª¿æŸ»\r\nhttps://developer.mozilla.org/ja/docs/Web/HTTP/Range_requests\r\n\r\næŒ‡å®šã—ãŸç¯„å›²ï¼ˆãƒã‚¤ãƒˆï¼‰ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ãã‚‹ã‚‰ã—ã„  \r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ã«ã‚ˆãã‚ã‚‹ä¸€æ™‚åœæ­¢ã‹ã‚‰ã®å†é–‹æ©Ÿèƒ½ã¯ã“ã‚Œã‚’ä½¿ã£ã¦ã‚‹ãã†  \r\nä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯ã—ã‚‰ã‚“ã‘ã©ã€`Chrome`ã®`videoã‚¿ã‚°`ã§ã‚·ãƒ¼ã‚¯ãƒãƒ¼ã‚’å‹•ã‹ã™ã¨ãã®ãŸã³ã«ã“ã®éƒ¨åˆ†ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã—ã¦ã‚‹ã£ã½ã„\r\n\r\nãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ˜ãƒƒãƒ€ã«ã€\r\n\r\n| name  | value      |\r\n|-------|------------|\r\n| Range | bytes=0-50 |\r\n\r\nã¨å…¥ã‚Œã‚‹ã¨0ã‹ã‚‰50ã¾ã§ã®ãƒ‡ãƒ¼ã‚¿ãŒè¿”ã£ã¦ãã‚‹ãã†ã€‚  \r\nã¡ãªã¿ã«æ¬¡ã®ãƒ‡ãƒ¼ã‚¿(ä¾‹ãˆã°50ãƒã‚¤ãƒˆåˆ†)ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹éš›ã¯`50`ã§ã¯ãªã`51`ã‹ã‚‰ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼Ÿ  \r\n\r\n| name  | value        |\r\n|-------|--------------|\r\n| Range | bytes=51-100 |\r\n\r\nhttps://triple-underscore.github.io/RFC7233-ja.html#p.byte-ranges-specifier  \r\n\r\nã¡ãªã¿ã«ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰ã¯`206`ã«ãªã‚‹\r\n\r\n# ä½¿ã†ã‚‚ã®\r\n## OkHttp\r\nHTTPã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã€‚WebAPIå©ã„ãŸã‚Šè‰²ã‚“ãªæ‰€ã§ä½¿ã£ã¦ã‚‹ã€‚  \r\nAndroid 5ä»¥ä¸Šå¯¾å¿œ\r\n\r\n## Coroutine\r\né›£ã—ã„ã€‚éåŒæœŸå‡¦ç†(ã‚¢ãƒ—ãƒªã®ç”»é¢ã‚’æ­¢ã‚ãªã„)ã‚’æ›¸ãã¨ãã«å¹¸ã›ã«ãªã‚Œã‚‹ã‚„ã¤ã€‚  \r\né›£ã—ã„ã‚“ã§ä¾‹ã‚’ã‚ã’ã‚‹ã¨\r\n\r\n- ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯åœ°ç„ã‚’è„±å´ï¼ˆãŸã¨ãˆãªã®ã§å‹•ãã¾ã›ã‚“ãŒï¼‰\r\n    - `lifecycleScope.launch`ã€çœç•¥æ™‚ã¯UIã‚¹ãƒ¬ãƒƒãƒ‰ã«ãªã‚Šã¾ã™\r\n```kotlin\r\n// åœ°ç„\r\ngetLocation { location ->\r\n    getWeatherId(location) { id ->\r\n        getWeather(id) { weather ->\r\n            runOnUiThread {\r\n                // UI Thread\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n// å¤©å›½\r\nlifecycleScope.launch {\r\n    val location = suspendGetLocation()\r\n    val weatherId = suspendGetWeatherId(location)\r\n    val weather = suspendGetWeather(weatherId)\r\n    withContext(Dispatchers.Main) {\r\n        // UI Thread\r\n    }\r\n}\r\n\r\nfun getLocation(callback: (String) -> Unit) {\r\n}\r\nfun getWeatherId(location: String, callback: (String) -> Unit) {\r\n}\r\nfun getWeather(id: String, callback: (String) -> Unit) {\r\n}\r\nsuspend fun suspendGetLocation() = withContext(Dispatchers.IO) {\r\n    \"tokyo\"\r\n}\r\nsuspend fun suspendGetWeatherId(location: String) = withContext(Dispatchers.IO) {\r\n    \"tokyo\"\r\n}\r\nsuspend fun suspendGetWeather(id: String) = withContext(Dispatchers.IO) {\r\n}\r\n```\r\n\r\n- ã‚­ãƒ£ãƒ³ã‚»ãƒ«ã‚‚ã§ãã‚‹\r\n\r\n```kotlin\r\nval job = lifecycleScope.launch { \r\n    while (true){\r\n        delay(1000)\r\n        Toast.makeText(this@MainActivity, \"é–‰ã˜ã‚‰ã‚Œã¾ã›ã‚“ã‚ˆï½\", Toast.LENGTH_SHORT).show()\r\n    }\r\n}\r\nlifecycleScope.launch { \r\n    delay(5000)\r\n    job.cancel() // ã‚„ã‚ã«ã™ã‚‹\r\n}\r\n```\r\n\r\n- ã‚³ãƒ«ãƒ¼ãƒãƒ³å†…ã®ä¾‹å¤–ã‚’ã‚­ãƒ£ãƒƒãƒ\r\n\r\n```kotlin\r\nval errorHandler = CoroutineExceptionHandler { coroutineContext, throwable ->\r\n    throwable.printStackTrace()\r\n    runOnUiThread {\r\n        Toast.makeText(this, \"å•é¡ŒãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚${throwable}\", Toast.LENGTH_SHORT).show()\r\n    }\r\n}\r\nlifecycleScope.launch(errorHandler + Dispatchers.Main) {\r\n    // ã‚‚ã—é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒèµ·ãã¦ã‚‚CoroutineExceptionHandlerãŒæ‹¾ã£ã¦ãã‚Œã‚‹ï¼Ÿ\r\n    val videoFile = getLargeFile()\r\n}\r\n\r\nprivate suspend fun getLargeFile() = withContext(Dispatchers.IO) {\r\n}\r\n```\r\n\r\nãã—ã¦ä»Šå›ä½¿ã†äºˆå®šã®ã€`asunc { }`  \r\n\r\n- ã™ã¹ã¦ç›´åˆ—ã«ã™ã‚‹ï¼ˆãŠãã„ï¼‰\r\n\r\n```kotlin\r\nlifecycleScope.launch {\r\n    val gameCategoryTop = getVideoRankingTopItem(\"game\")\r\n    val vocaloidCategoryTop = getVideoRankingTopItem(\"vocaloid\")\r\n    val animeCategoryTop = getVideoRankingTopItem(\"anime\")\r\n    val cookCategoryTop = getVideoRankingTopItem(\"cook\")\r\n    textView.text = \"\"\"\r\n        ã‚²ãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${gameCategoryTop}\r\n        ãƒœã‚«ãƒ­ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${vocaloidCategoryTop}\r\n        ã‚¢ãƒ‹ãƒ¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${animeCategoryTop}\r\n        æ–™ç†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${cookCategoryTop}\r\n        \"\"\".trimIndent()\r\n}\r\n\r\nprivate suspend fun getVideoRankingTopItem(categoryId: String) = withContext(Dispatchers.IO) {\r\n    return@withContext \"\"\r\n}\r\n```\r\n\r\nã®ã§ã€ä¸¦åˆ—ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãŸã„ã§ã™ã‚ˆã­ï¼Ÿãã“ã§ä½¿ã†ã®ãŒ`async { }`ã§ã™ã€‚  \r\n\r\n```kotlin\r\nlifecycleScope.launch {\r\n    // ã™ãã«å®Ÿè¡Œã•ã‚Œã‚‹\r\n    val gameCategoryTop = async { getVideoRankingTopItem(\"game\") }\r\n    val vocaloidCategoryTop = async { getVideoRankingTopItem(\"vocaloid\") }\r\n    val animeCategoryTop = async { getVideoRankingTopItem(\"anime\") }\r\n    val cookCategoryTop = async { getVideoRankingTopItem(\"cook\") }\r\n\r\n    // ä¸¦åˆ—ã§å®Ÿè¡Œã—ãŸçµæœã‚’å¾…ã¤\r\n    gameCategoryTop.await()\r\n    vocaloidCategoryTop.await()\r\n    animeCategoryTop.await()\r\n    cookCategoryTop.await()\r\n    \r\n    textView.text = \"\"\"\r\n        ã‚²ãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${gameCategoryTop}\r\n        ãƒœã‚«ãƒ­ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${vocaloidCategoryTop}\r\n        ã‚¢ãƒ‹ãƒ¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${animeCategoryTop}\r\n        æ–™ç†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${cookCategoryTop}\r\n        \"\"\".trimIndent()\r\n}\r\n\r\nprivate suspend fun getVideoRankingTopItem(categoryId: String) = withContext(Dispatchers.IO) {\r\n    return@withContext \"\"\r\n}\r\n```\r\n\r\nã¾ãŸã€é…åˆ—ã‚’ä½¿ã†ã¨ã‚‚ã†å°‘ã—ãã‚Œã„ã«æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚  \r\n\r\n```kotlin\r\nlifecycleScope.launch {\r\n    val categoryList = arrayListOf(\"game\", \"vocaloid\", \"anime\", \"cook\")\r\n    val topItemList = categoryList\r\n        .map { id -> async { getVideoRankingTopItem(id) } } // ã™ãã«å®Ÿè¡Œã•ã‚Œã‚‹\r\n        .map { deferred -> deferred.await() } // ã™ã¹ã¦ã®çµæœã‚’å¾…ã¤\r\n    textView.text = \"\"\"\r\n        ã‚²ãƒ¼ãƒ ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${topItemList[0]}\r\n        ãƒœã‚«ãƒ­ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${topItemList[1]}\r\n        ã‚¢ãƒ‹ãƒ¡ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${topItemList[2]}\r\n        æ–™ç†ãƒ©ãƒ³ã‚­ãƒ³ã‚°ä¸€ä½:${topItemList[3]}\r\n        \"\"\".trimIndent()\r\n}\r\n\r\nprivate suspend fun getVideoRankingTopItem(categoryId: String) = withContext(Dispatchers.IO) {\r\n    return@withContext \"\"\r\n}\r\n```\r\n\r\nä»–ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°è¨€èªã§ã¯ã€é–¢æ•°ã‚’ä½œã‚‹éš›ã«`async`ã‚’ä½¿ã†ã¨æ€ã†ã‚“ã§ã™ãŒã€  \r\n`Kotlinã®Coroutine`ã§ã¯å‘¼ã¶éš›ã«`async { }`ã‚’ä½¿ã†ã“ã¨ã«ãªã‚Šã¾ã™ã€‚(ã®ã§`async/await`ã®ã“ã¨ã¯å¿˜ã‚ŒãŸã»ã†ãŒã‚ã‹ã‚‹ã‹ã‚‚)\r\n\r\n# æœ¬ç·¨\r\nè©±é¡ŒãŒé€¸ã‚ŒéããŸã€‚\r\n\r\n## ç’°å¢ƒ\r\n\r\nKotlinã§è¡Œãã¾ã™\r\n\r\n```kotlin\r\nmutableMapOf(\r\n    \"Android Studio\" to \"4.1.1\",\r\n    \"ç«¯æœ«\" to \"Pixel 3 XL\", // ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã ã¨ãªã‚“ã‹å¤±æ•—ã™ã‚‹ã®ã§å®Ÿæ©Ÿã‚’å¼·ãæ¨å¥¨\r\n)\r\n```\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’ç¢ºä¿ã—ã¦ãŠã„ã¦ã­\r\n\r\n## ä»•æ§˜\r\nä¿å­˜å…ˆã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸ã‚“ã§ã‚‚ã‚‰ã†å½¢å¼ã‚’å–ã‚‹ã€‚  \r\næœ¬å½“ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«è‡ªå‹•ã§å…¥ã‚ŒãŸã„ã‚“ã ã‘ã©ã€`Android 10`ä»¥é™ã—ã‹æä¾›ã•ã‚Œã¦ã„ãªã„  \r\n(ã™ã„ã¾ã›ã‚“ã“ã‚Œã¯å˜˜ã§Android 9ä»¥å‰ã§ã‚‚ã§ãã‚‹ã‚“ã ã‘ã©å®Ÿè£…æ–¹æ³•ãŒå…¨ç„¶é•ã†ã®ã§ã‚ã‚“ã©ã„)  \r\n\r\nç§ãŒã‚„ã‚ŠãŸã„ã®ã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ã‚ã£ã¦ã€  \r\nAndroidã®`MediaStore`ã§ã¯ãªã„ã€‚ã‚„ã‚Šã ã—ãŸã‚‰ã‚‚ã†åé›†ãŒã¤ã‹ãªã„ã€‚  \r\n(Androidã¯ç”Ÿï¼ˆæ„å‘³æ·±ï¼‰ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã§ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãŒä¸€éƒ¨ã‚’é™¤ãç¦æ­¢ã•ã‚Œã¦ã„ã‚‹ãŸã‚)  \r\n```kotlin\r\nFile(\"sdcard/Download\") // Android 10ä»¥é™ç¦æ­¢\r\n```\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰å‡¦ç†ã¯`ViewModel`ã«æ›¸ãã¨ã—ã¾ã™\r\n\r\n## ãƒ©ã‚¤ãƒ–ãƒ©ãƒª\r\n`OkHttp`ã¨`Coroutine`(ã¨ãã‚Œé–¢ä¿‚)ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n`app/build.gradle`ã«æ›¸ãè¶³ã™ã€‚ViewBindingã‚‚æœ‰åŠ¹ã«ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```gradle\r\ndependencies {\r\n    // ã‚³ãƒ«ãƒ¼ãƒãƒ³\r\n    implementation 'org.jetbrains.kotlinx:kotlinx-coroutines-android:1.4.1'\r\n    // ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’Activityã§ä½¿ã„ã‚„ã™ãã™ã‚‹ã‚„ã¤\r\n    implementation \"androidx.lifecycle:lifecycle-runtime-ktx:2.3.0\"\r\n    // OkHttp\r\n    implementation(\"com.squareup.okhttp3:okhttp:4.9.0\")\r\n    // ViewModel\r\n    implementation \"androidx.lifecycle:lifecycle-viewmodel-ktx:2.3.0\"\r\n    // LiveData\r\n    implementation \"androidx.lifecycle:lifecycle-livedata-ktx:2.3.0\"\r\n    // Activity Result API\r\n    implementation \"androidx.activity:activity-ktx:1.2.0\"\r\n    implementation \"androidx.fragment:fragment-ktx:1.3.0\"\r\n\r\n    // çœç•¥\r\n}\r\n```\r\n\r\n## AndroidManifest.xml\r\n\r\nã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆæ¨©é™ãŒå¿…è¦ã§ã™ã€‚ï¼ˆã‚ˆãæ›¸ãå¿˜ã‚Œã‚‹ï¼‰\r\n\r\n```xml\r\n<uses-permission android:name=\"android.permission.INTERNET\" />\r\n```\r\n\r\n## activity_main.xml\r\n\r\né–‹å§‹ãƒœã‚¿ãƒ³ã¨ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’ãŠãã¾ã™\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<androidx.constraintlayout.widget.ConstraintLayout xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    xmlns:app=\"http://schemas.android.com/apk/res-auto\"\r\n    xmlns:tools=\"http://schemas.android.com/tools\"\r\n    android:layout_width=\"match_parent\"\r\n    android:layout_height=\"match_parent\"\r\n    tools:context=\".MainActivity\">\r\n\r\n    <Button\r\n        android:id=\"@+id/start_button\"\r\n        android:layout_width=\"wrap_content\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:text=\"Start\"\r\n        app:layout_constraintBottom_toBottomOf=\"parent\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toTopOf=\"parent\" />\r\n\r\n    <ProgressBar\r\n        android:id=\"@+id/progress_bar\"\r\n        style=\"?android:attr/progressBarStyleHorizontal\"\r\n        android:layout_width=\"0dp\"\r\n        android:layout_height=\"wrap_content\"\r\n        android:layout_marginStart=\"16dp\"\r\n        android:layout_marginEnd=\"16dp\"\r\n        android:max=\"100\"\r\n        app:layout_constraintEnd_toEndOf=\"parent\"\r\n        app:layout_constraintStart_toStartOf=\"parent\"\r\n        app:layout_constraintTop_toBottomOf=\"@+id/start_button\" />\r\n</androidx.constraintlayout.widget.ConstraintLayout>\r\n```\r\n\r\n## MainActivity.kt\r\nã¨ã‚Šã‚ãˆãš`ViewBinding`ã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠã„ã¦ãã ã•ã„\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n    }\r\n}\r\n```\r\n\r\n## MainActivityViewModel.kt\r\nã‚’ä½œæˆã—ã¦ã€ã‚³ãƒ”ãƒšã—ã¾ã™ã€‚  \r\nã—ã°ã‚‰ãã¯ã“ã®ã‚¯ãƒ©ã‚¹ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’æ›¸ã„ã¦ã„ãã¾ã™\r\n\r\n```kotlin\r\n/**\r\n * [MainActivity]ã‹ã‚‰UIä»¥å¤–ã®ã‚³ãƒ¼ãƒ‰ã‚’æŒã£ã¦ããŸã€‚\r\n * */\r\nclass MainActivityViewModel(application: Application) : AndroidViewModel(application) {\r\n\r\n    private val context = application.applicationContext\r\n\r\n}\r\n```\r\n\r\n### ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã‚’å–å¾—ã™ã‚‹\r\nã“ã‚Œã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã‚ã‘ã§ã™ãŒã€åˆ†å‰²ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ã«ã¯ã¾ãšå…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã‚’æ±‚ã‚ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\nã“ã“ã§ã»ã—ã„ã®ã¯ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãªã®ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒœãƒ‡ã‚£ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã—ãªã„`HEAD`ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é£›ã°ã—ã¾ã™ã€‚\r\n\r\n```kotlin\r\nprivate val okHttpClient = OkHttpClient()\r\n/** HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹ */\r\nprivate suspend fun getResponseHeader(url: String) = withContext(Dispatchers.IO) {\r\n    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n    val request = Request.Builder().apply {\r\n        url(url)\r\n        head() // bodyã„ã‚‰ã‚“\r\n    }.build()\r\n    return@withContext okHttpClient.newCall(request).execute()\r\n}\r\n```\r\n\r\n### åˆ†å‰²ã™ã‚‹é–¢æ•°\r\né•·ã£ãŸã‚‰ã—ã„ã€‚\r\n\r\n```kotlin\r\n/**\r\n * åˆ†å‰²ã—ã¦é…åˆ—ã«ã—ã¦è¿”ã™\r\n * \r\n * @param totalBytes åˆè¨ˆã‚µã‚¤ã‚º\r\n * @param splitCount åˆ†å‰²æ•°\r\n * */\r\nprivate fun splitByteList(totalBytes: Long, splitCount: Int): ArrayList<Pair<Long, Long>> {\r\n    // ã‚ã¾ã‚ŠãŒå‡ºãªã„ã»ã†ãŒãŠã‹ã—ã„ã®ã§ä½™ã‚Šã‚’å‡ºã™\r\n    val amari = totalBytes % splitCount\r\n    // ã‚ã¾ã‚Šåˆ†ã‚’å¼•ã„ã¦ä¸€å€‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®ãƒã‚¤ãƒˆæ•°ã‚’æ±ºå®š\r\n    val splitByte = (totalBytes - amari) / splitCount\r\n    // é…åˆ—ã«ã—ã¦è¿”ã™\r\n    val byteList = arrayListOf<Pair<Long, Long>>()\r\n    // 2å›ç›®ã®ãƒ«ãƒ¼ãƒ—ãªã‚‰1å›ç›®ã®å€¤ãŒå…¥ã£ã¦ã‚‹ã€‚å‰ã®å€¤\r\n    var prevByte = 0L\r\n    while (true) {\r\n        // ãƒ”ãƒƒã‚¿ãƒªåˆ†ã‘ãŸã„ã®ã§\r\n        if (totalBytes >= prevByte) {\r\n            /***\r\n             * æœ€å¾Œä½™åˆ†ã«å–å¾—ã—ãªã„ã‚ˆã†ã«ã€‚\r\n             * true(splitByteè¶³ã—ã¦ã‚‚è¶³ã‚Šãªã„)ãªã‚‰splitByteã‚’è¶³ã—ã¦ã€falseãªã‚‰totalByteã‚’æ¸¡ã—ã¦çµ‚äº†\r\n             * */\r\n            val toByte =\r\n                if (totalBytes > (prevByte + splitByte)) prevByte + splitByte else totalBytes\r\n            byteList.add(Pair(prevByte, toByte))\r\n            prevByte += splitByte + 1 // 1è¶³ã—ã¦æ¬¡ã®ãƒã‚¤ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹\r\n        } else break\r\n    }\r\n    return byteList\r\n}\r\n```\r\n\r\nã¡ãªã¿ã«ã“ã®é–¢æ•°ã®è¿”ã‚Šå€¤ã¯ã“ã‚“ãªæ„Ÿã˜ã«ãªã‚Šã¾ã™\r\n\r\n```kotlin\r\n// 685MB\r\nviewModel.splitByteList(719200584, 5)\r\n// return\r\n[\r\nPair(0, 143840116),\r\nPair(143840117, 287680233),\r\nPair(287680234, 431520350),\r\nPair(431520351, 575360467),\r\nPair(575360468, 719200584),\r\n]\r\n```\r\n\r\n\r\n### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\nä»Šå›ã¯`HEAD`ã§ã¯ãªã`GET`ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã™ã‚ˆï¼  \r\n\r\nã¨ã€ãã®å‰ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸåˆ†å‰²ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒã£ã¦ãŠãã‚ã‘ã«ã‚‚ã„ã‹ãªã„ã®ã§ã€ä¸€æ—¦ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚ãã®ä¿å­˜å…ˆãƒ•ã‚©ãƒ«ãƒ€ã‚’å…ˆã«ä½œã£ã¦ãŠãã¾ã™\r\n\r\n```kotlin\r\n/** ä¸€æ™‚ä¿å­˜å…ˆ */\r\nprivate val tmpFolder = File(context.externalCacheDir, \"split_file\").apply { mkdir() }\r\n```\r\n\r\nãã—ãŸã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹é–¢æ•°ã‚’æ›¸ãã¾ã—ã‚‡ã†ã€‚æ‹¡å¼µå­ã«ãƒ•ã‚¡ã‚¤ãƒ«ã®é †ç•ªã‚’ä»˜ã‘ã¦ã¾ã™\r\n\r\n```kotlin\r\n/**\r\n * ç¯„å›²ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹\r\n *\r\n * @param fromByte ã“ã£ã‹ã‚‰\r\n * @param toByte ã“ã“ã¾ã§\r\n * @param count ä½•å€‹ç›®ã‹\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * */\r\nprivate suspend fun requestFile(url: String, fromByte: Long, toByte: Long, count: Int,fileName: String) = withContext(Dispatchers.IO) {\r\n    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n    val request = Request.Builder().apply {\r\n        url(url)\r\n        addHeader(\"Range\", \"bytes=${fromByte}-${toByte}\")\r\n        get()\r\n    }.build()\r\n    val response = okHttpClient.newCall(request).execute()\r\n    val inputStream = response.body?.byteStream()\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã€‚æ‹¡å¼µå­ã«é †ç•ªã‚’å…¥ã‚Œã‚‹\r\n    val splitFile = File(tmpFolder, \"${fileName}.${count}\").apply { createNewFile() }\r\n    val splitFileOutputStream = splitFile.outputStream()\r\n    // æ›¸ãè¾¼ã‚€\r\n    val buffer = ByteArray(1024 * 1024)\r\n    while (true) {\r\n        val read = inputStream?.read(buffer)\r\n        if (read == -1 || read == null) {\r\n            // çµ‚ã‚ã‚Šãªã‚‰ç„¡é™ãƒ«ãƒ¼ãƒ—æŠœã‘\r\n            break\r\n        }\r\n        splitFileOutputStream.write(buffer, 0, read)\r\n    }\r\n    inputStream?.close()\r\n    splitFileOutputStream.close()\r\n}\r\n```\r\n\r\n### ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆã™ã‚‹é–¢æ•°\r\n\r\nçµåˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«(`File`)ã‚’è¿”ã—ã¦ã‚ã’ã¦ãã ã•ã„ã€‚å¾Œã§ä½¿ã†  \r\n\r\n```kotlin\r\n/**\r\n * ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ã¤ã«ã¾ã¨ã‚\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * @return çµåˆãƒ•ã‚¡ã‚¤ãƒ«\r\n * */\r\nprivate suspend fun multipleFileToOneFile(fileName: String) = withContext(Dispatchers.Default) {\r\n    // æœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«\r\n    val resultFile = File(context.getExternalFilesDir(null), fileName).apply { createNewFile() }\r\n    tmpFolder.listFiles()\r\n        ?.sortedBy { file -> file.extension } // ä¸¦ã³æ›¿ãˆã€‚ç”·å¥³ç”·ç”·å¥³ç”·å¥³\r\n        ?.map { file -> file.readBytes() } // readBytes()ã¯2GBã¾ã§ã—ã‹å¯¾å¿œã—ã¦ãªã„(ã•ã™ãŒã«ãªã„ã‚„ã‚)\r\n        ?.forEach { bytes -> resultFile.appendBytes(bytes) }\r\n    // ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¶ˆã™\r\n    tmpFolder.deleteRecursively()\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”ã™\r\n    return@withContext resultFile\r\n}\r\n```\r\n\r\n### ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®é¸ã‚“ã ä¿å­˜å…ˆã«ä¿å­˜ã™ã‚‹\r\nã¾ã ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¿å­˜å…ˆã‚’é¸ã‚“ã§ã‚‚ã‚‰ã†å‡¦ç†ã¯æ›¸ã„ã¦ã¾ã›ã‚“ãŒã€‚ä¿å­˜å…ˆã‚’é¸ã¶ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã€ã€ã€ã§ã¯ãªã`Uri`ãŒè¿”ã£ã¦ãã‚‹ã®ã§ã“ã‚Œã‚’ä½¿ã„ã¾ã™ã€‚  \r\n\r\n\r\n```kotlin\r\n/**\r\n * ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Uriã®å ´æ‰€ã«æ›¸ãè¾¼ã‚“ã§ã€å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ[resultFile]ï¼‰ã‚’å‰Šé™¤ã™ã‚‹\r\n *\r\n * @param resultFile å®Œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«\r\n * @param uri Activity Result APIã§ã‚‚ã‚‰ãˆã‚‹Uri\r\n * */\r\nprivate suspend fun moveFile(resultFile: File, uri: Uri) = withContext(Dispatchers.IO) {\r\n    val contentResolver = context.contentResolver\r\n    // outputStreamã‚’ã‚‚ã‚‰ã†\r\n    val outputStream = contentResolver.openOutputStream(uri)\r\n    outputStream?.write(resultFile.readBytes()) // readBytes()ã¯å¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ä½¿ã†ã¹ãã§ã¯ãªã„\r\n    outputStream?.close()\r\n    // å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¶ˆã™\r\n    resultFile.deleteRecursively()\r\n}\r\n```\r\n\r\n### Activityã‹ã‚‰å‘¼ã¶é–¢æ•°ã‚’æ›¸ã\r\n\r\n`start`é–¢æ•°ã‚’æ›¸ã„ã¦ã€Activityã‹ã‚‰ã¯ã“ã®é–¢æ•°ã‚’å‘¼ã¶ã“ã¨ã«ã—ã¾ã™\r\n\r\n```kotlin\r\n/**\r\n * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * @param uri ä¿å­˜å…ˆ\r\n * @param url URL\r\n * */\r\nfun start(url: String, uri: Uri, fileName: String) {\r\n    viewModelScope.launch {\r\n        val responseHeader = getResponseHeader(url)\r\n        // åˆè¨ˆã‚µã‚¤ã‚º\r\n        val contentLength = responseHeader.headers[\"Content-Length\"]!!.toLong()\r\n        // åˆ†å‰²ã€‚ã¨ã‚Šã‚ãˆãš5åˆ†å‰²\r\n        val splitList = splitByteList(contentLength, 5)\r\n        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n        splitList\r\n            .mapIndexed { index, pair ->\r\n                // asyncã§ä¸¦åˆ—å®Ÿè¡Œ\r\n                async { requestFile(url, pair.first, pair.second, index, fileName) }\r\n            }.map { deferred ->\r\n                // ã™ã¹ã¦ã®asyncã‚’å¾…ã¤\r\n                deferred.await()\r\n            }\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ\r\n        val resultFile = multipleFileToOneFile(fileName)\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã•ã›ã¦å®Œæˆ\r\n        moveFile(resultFile, uri)\r\n        // ãŠã—ã¾ã„\r\n        Toast.makeText(context, \"ãŠã‚ã‚Š\", Toast.LENGTH_SHORT).show()\r\n    }\r\n}\r\n```\r\n\r\n### ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰\r\n\r\n```kotlin\r\n/**\r\n * [MainActivity]ã‹ã‚‰UIä»¥å¤–ã®ã‚³ãƒ¼ãƒ‰ã‚’æŒã£ã¦ããŸã€‚\r\n * */\r\nclass MainActivityViewModel(application: Application) : AndroidViewModel(application) {\r\n\r\n    private val context = application.applicationContext\r\n\r\n    /** ã‚·ãƒ³ã‚°ãƒ«ãƒˆãƒ³ã«ã™ã¹ã */\r\n    private val okHttpClient = OkHttpClient()\r\n\r\n    /** ä¸€æ™‚ä¿å­˜å…ˆ */\r\n    private val tmpFolder = File(context.externalCacheDir, \"split_file\").apply { mkdir() }\r\n\r\n    /**\r\n     * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹\r\n     * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     * @param uri ä¿å­˜å…ˆ\r\n     * @param url URL\r\n     * */\r\n    fun start(url: String, uri: Uri, fileName: String) {\r\n        viewModelScope.launch {\r\n            val responseHeader = getResponseHeader(url)\r\n            // åˆè¨ˆã‚µã‚¤ã‚º\r\n            val contentLength = responseHeader.headers[\"Content-Length\"]!!.toLong()\r\n            // åˆ†å‰²ã€‚ã¨ã‚Šã‚ãˆãš5åˆ†å‰²\r\n            val splitList = splitByteList(contentLength, 5)\r\n            // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n            splitList\r\n                .mapIndexed { index, pair ->\r\n                    // asyncã§ä¸¦åˆ—å®Ÿè¡Œ\r\n                    async { requestFile(url, pair.first, pair.second, index, fileName) }\r\n                }.map { deferred ->\r\n                    // ã™ã¹ã¦ã®asyncã‚’å¾…ã¤\r\n                    deferred.await()\r\n                }\r\n            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ\r\n            val resultFile = multipleFileToOneFile(fileName)\r\n            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã•ã›ã¦å®Œæˆ\r\n            moveFile(resultFile, uri)\r\n            // ãŠã—ã¾ã„\r\n            println(\"ãŠã‚ã‚Š\")\r\n        }\r\n    }\r\n\r\n\r\n    /**\r\n     * HEADãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹\r\n     * @param url URL\r\n     * */\r\n    private suspend fun getResponseHeader(url: String) = withContext(Dispatchers.IO) {\r\n        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n        val request = Request.Builder().apply {\r\n            url(url)\r\n            head() // bodyã„ã‚‰ã‚“\r\n        }.build()\r\n        return@withContext okHttpClient.newCall(request).execute()\r\n    }\r\n\r\n    /**\r\n     * åˆ†å‰²ã—ã¦é…åˆ—ã«ã—ã¦è¿”ã™\r\n     *\r\n     * @param totalBytes åˆè¨ˆã‚µã‚¤ã‚º\r\n     * @param splitCount åˆ†å‰²æ•°\r\n     * */\r\n    private fun splitByteList(totalBytes: Long, splitCount: Int): ArrayList<Pair<Long, Long>> {\r\n        // ã‚ã¾ã‚ŠãŒå‡ºãªã„ã»ã†ãŒãŠã‹ã—ã„ã®ã§ä½™ã‚Šã‚’å‡ºã™\r\n        val amari = totalBytes % splitCount\r\n        // ã‚ã¾ã‚Šåˆ†ã‚’å¼•ã„ã¦ä¸€å€‹ã®ãƒªã‚¯ã‚¨ã‚¹ãƒˆã§ã®ãƒã‚¤ãƒˆæ•°ã‚’æ±ºå®š\r\n        val splitByte = (totalBytes - amari) / splitCount\r\n        // é…åˆ—ã«ã—ã¦è¿”ã™\r\n        val byteList = arrayListOf<Pair<Long, Long>>()\r\n        // 2å›ç›®ã®ãƒ«ãƒ¼ãƒ—ãªã‚‰1å›ç›®ã®å€¤ãŒå…¥ã£ã¦ã‚‹ã€‚å‰ã®å€¤\r\n        var prevByte = 0L\r\n        while (true) {\r\n            // ãƒ”ãƒƒã‚¿ãƒªåˆ†ã‘ãŸã„ã®ã§\r\n            if (totalBytes >= prevByte) {\r\n                /***\r\n                 * æœ€å¾Œä½™åˆ†ã«å–å¾—ã—ãªã„ã‚ˆã†ã«ã€‚\r\n                 * true(splitByteè¶³ã—ã¦ã‚‚è¶³ã‚Šãªã„)ãªã‚‰splitByteã‚’è¶³ã—ã¦ã€falseãªã‚‰totalByteã‚’æ¸¡ã—ã¦çµ‚äº†\r\n                 * */\r\n                val toByte =\r\n                    if (totalBytes > (prevByte + splitByte)) prevByte + splitByte else totalBytes\r\n                byteList.add(Pair(prevByte, toByte))\r\n                prevByte += splitByte + 1 // 1è¶³ã—ã¦æ¬¡ã®ãƒã‚¤ãƒˆã‹ã‚‰ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹\r\n            } else break\r\n        }\r\n        return byteList\r\n    }\r\n\r\n    /**\r\n     * ç¯„å›²ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹\r\n     *\r\n     * @param fromByte ã“ã£ã‹ã‚‰\r\n     * @param toByte ã“ã“ã¾ã§ã®ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã™\r\n     * @param count ä½•å€‹ç›®ã‹\r\n     * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     * */\r\n    private suspend fun requestFile(url: String, fromByte: Long, toByte: Long, count: Int, fileName: String) = withContext(Dispatchers.IO) {\r\n        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n        val request = Request.Builder().apply {\r\n            url(url)\r\n            addHeader(\"Range\", \"bytes=${fromByte}-${toByte}\")\r\n            get()\r\n        }.build()\r\n        val response = okHttpClient.newCall(request).execute()\r\n        val inputStream = response.body?.byteStream()\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã€‚æ‹¡å¼µå­ã«é †ç•ªã‚’å…¥ã‚Œã‚‹\r\n        val splitFile = File(tmpFolder, \"${fileName}.${count}\").apply { createNewFile() }\r\n        val splitFileOutputStream = splitFile.outputStream()\r\n        // æ›¸ãè¾¼ã‚€\r\n        val buffer = ByteArray(1024 * 1024)\r\n        while (true) {\r\n            val read = inputStream?.read(buffer)\r\n            if (read == -1 || read == null) {\r\n                // çµ‚ã‚ã‚Šãªã‚‰ç„¡é™ãƒ«ãƒ¼ãƒ—æŠœã‘ã¦é«˜éšé–¢æ•°ã‚ˆã¶\r\n                break\r\n            }\r\n            splitFileOutputStream.write(buffer, 0, read)\r\n        }\r\n        inputStream?.close()\r\n        splitFileOutputStream.close()\r\n    }\r\n\r\n    /**\r\n     * ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã¦å®Œæˆ\r\n     * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     * @return çµåˆãƒ•ã‚¡ã‚¤ãƒ«\r\n     * */\r\n    private suspend fun multipleFileToOneFile(fileName: String) = withContext(Dispatchers.Default) {\r\n        // æœ€çµ‚çš„ãªãƒ•ã‚¡ã‚¤ãƒ«\r\n        val resultFile = File(context.getExternalFilesDir(null), fileName).apply { createNewFile() }\r\n        tmpFolder.listFiles()\r\n            ?.sortedBy { file -> file.extension } // ä¸¦ã³æ›¿ãˆã€‚ç”·å¥³ç”·ç”·å¥³ç”·å¥³\r\n            ?.map { file -> file.readBytes() } // readBytes()ã¯2GBã¾ã§ã—ã‹å¯¾å¿œã—ã¦ãªã„(ã•ã™ãŒã«ãªã„ã‚„ã‚)\r\n            ?.forEach { bytes -> resultFile.appendBytes(bytes) }\r\n        // ãƒ•ã‚©ãƒ«ãƒ€ã‚’æ¶ˆã™\r\n        tmpFolder.deleteRecursively()\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”ã™\r\n        return@withContext resultFile\r\n    }\r\n\r\n    /**\r\n     * ãƒ•ã‚¡ã‚¤ãƒ«ã‚’Uriã®å ´æ‰€ã«æ›¸ãè¾¼ã‚“ã§ã€å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆ[resultFile]ï¼‰ã‚’å‰Šé™¤ã™ã‚‹\r\n     *\r\n     * @param resultFile å®Œæˆã—ãŸãƒ•ã‚¡ã‚¤ãƒ«\r\n     * @param uri Activity Result APIã§ã‚‚ã‚‰ãˆã‚‹Uri\r\n     * */\r\n    private suspend fun moveFile(resultFile: File, uri: Uri) = withContext(Dispatchers.IO) {\r\n        val contentResolver = context.contentResolver\r\n        // outputStreamã‚’ã‚‚ã‚‰ã†\r\n        val outputStream = contentResolver.openOutputStream(uri)\r\n        outputStream?.write(resultFile.readBytes()) // readBytes()ã¯å¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ã§ã¯ä½¿ã†ã¹ãã§ã¯ãªã„\r\n        outputStream?.close()\r\n        // å…ƒã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ¶ˆã™\r\n        resultFile.deleteRecursively()\r\n    }\r\n\r\n}\r\n```\r\n\r\n## MainActivity.kt\r\n\r\nStorage Access Frameworkã‚’é–‹ã„ã¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ä¿å­˜å…ˆã‚’é¸ã‚“ã§ã‚‚ã‚‰ã„ã¾ã™  \r\nã‚ã¨`ViewModel`ã‚‚ä½¿ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãŠã„ã¦ã­  \r\nã‚ã¨URLã«ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã„ãƒ•ã‚¡ã‚¤ãƒ«ã®URLã‚’å…¥ã‚Œã¦ãŠã„ã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    private val viewModel by viewModels<MainActivityViewModel>()\r\n\r\n    /** URL */\r\n    private val URL = \"\"\r\n\r\n    /** ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private val FILE_NAME = \"download.mp4\"\r\n\r\n    /** Activity Result API ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val callback = registerForActivityResult(ActivityResultContracts.CreateDocument()) { uri ->\r\n        if (uri != null) {\r\n            // ViewModelã«æ›¸ã„ãŸãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–¢æ•°ã‚’å‘¼ã¶\r\n            viewModel.start(URL, uri, FILE_NAME)\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        viewBinding.startButton.setOnClickListener {\r\n            // é¸ã°ã›ã‚‹\r\n            callback.launch(FILE_NAME)\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ã€ä¿å­˜å…ˆã‚’é¸ã¶ã¨ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãŒé–‹å§‹ã•ã‚Œã‚‹ã¯ãšã§ã™ã€‚  \r\nãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã¯å‹•ãã¾ã›ã‚“ãŒ\r\n\r\n## ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚’å‹•ã‹ã™\r\n\r\nå¤‰æ•°ã‚’å®£è¨€ã—ã¦\r\n\r\n```kotlin\r\n/** åˆè¨ˆãƒã‚¤ãƒˆ */\r\nprivate var totalByte = 0L\r\n\r\n/** æ›¸ãè¾¼ã¿ãŒçµ‚ã‚ã£ãŸãƒã‚¤ãƒˆ */\r\nprivate var progressByte = 0L\r\n\r\n/** é€²æ—LiveData */\r\nprivate val _progressLiveData = MutableLiveData<Int>()\r\n\r\n/** å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹é€²æ—LiveData */\r\nval progressLiveData: LiveData<Int> = _progressLiveData\r\n```\r\n\r\nstarté–¢æ•°ã‚’å°‘ã—æ›¸ãè¶³ã™\r\n\r\n```kotlin\r\n/**\r\n * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * @param uri ä¿å­˜å…ˆ\r\n * @param url URL\r\n * */\r\nfun start(url: String, uri: Uri, fileName: String) {\r\n    totalByte = 0L\r\n    progressByte = 0L\r\n    viewModelScope.launch {\r\n        val responseHeader = getResponseHeader(url)\r\n        // åˆè¨ˆã‚µã‚¤ã‚º\r\n        val contentLength = responseHeader.headers[\"Content-Length\"]!!.toLong()\r\n        totalByte = contentLength\r\n        // åˆ†å‰²ã€‚ã¨ã‚Šã‚ãˆãš5åˆ†å‰²\r\n        val splitList = splitByteList(contentLength, 5)\r\n        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n        splitList\r\n            .mapIndexed { index, pair ->\r\n                // asyncã§ä¸¦åˆ—å®Ÿè¡Œ\r\n                async { requestFile(url, pair.first, pair.second, index, fileName) }\r\n            }.map { deferred ->\r\n                // ã™ã¹ã¦ã®asyncã‚’å¾…ã¤\r\n                deferred.await()\r\n            }\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ\r\n        val resultFile = multipleFileToOneFile(fileName)\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã•ã›ã¦å®Œæˆ\r\n        moveFile(resultFile, uri)\r\n        // ãŠã—ã¾ã„\r\n        _progressLiveData.postValue(100)\r\n        println(\"ãŠã‚ã‚Š\")\r\n    }\r\n}\r\n```\r\n\r\n`requestFile`é–¢æ•°ã«æ›¸ãè¶³ã™\r\n\r\n```kotlin\r\n/**\r\n * ç¯„å›²ãƒªã‚¯ã‚¨ã‚¹ãƒˆã‚’é€ä¿¡ã™ã‚‹\r\n *\r\n * @param fromByte ã“ã£ã‹ã‚‰\r\n * @param toByte ã“ã“ã¾ã§ã®ãƒã‚¤ãƒˆæ•°ã‚’è¿”ã™\r\n * @param count ä½•å€‹ç›®ã‹\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * */\r\nprivate suspend fun requestFile(url: String, fromByte: Long, toByte: Long, count: Int, fileName: String) = withContext(Dispatchers.IO) {\r\n    // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n    val request = Request.Builder().apply {\r\n        url(url)\r\n        addHeader(\"Range\", \"bytes=${fromByte}-${toByte}\")\r\n        get()\r\n    }.build()\r\n    val response = okHttpClient.newCall(request).execute()\r\n    val inputStream = response.body?.byteStream()\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã€‚æ‹¡å¼µå­ã«é †ç•ªã‚’å…¥ã‚Œã‚‹\r\n    val splitFile = File(tmpFolder, \"${fileName}.${count}\").apply { createNewFile() }\r\n    val splitFileOutputStream = splitFile.outputStream()\r\n    // æ›¸ãè¾¼ã‚€\r\n    val buffer = ByteArray(1024 * 1024)\r\n    while (true) {\r\n        val read = inputStream?.read(buffer)\r\n        if (read == -1 || read == null) {\r\n            // çµ‚ã‚ã‚Šãªã‚‰ç„¡é™ãƒ«ãƒ¼ãƒ—æŠœã‘ã¦é«˜éšé–¢æ•°ã‚ˆã¶\r\n            break\r\n        }\r\n        splitFileOutputStream.write(buffer, 0, read)\r\n        // é€²æ—\r\n        progressByte += read\r\n        val progress = ((progressByte / totalByte.toFloat()) * 100).toInt()\r\n        // LiveDataé€ä¿¡\r\n        if (_progressLiveData.value != progress) {\r\n            _progressLiveData.postValue(progress)\r\n        }\r\n    }\r\n    inputStream?.close()\r\n    splitFileOutputStream.close()\r\n}\r\n```\r\n\r\n\r\næœ€å¾Œã«`MainActivity`\r\n\r\n```kotlin\r\noverride fun onCreate(savedInstanceState: Bundle?) {\r\n    super.onCreate(savedInstanceState)\r\n    setContentView(viewBinding.root)\r\n    viewBinding.startButton.setOnClickListener {\r\n        // é¸ã°ã›ã‚‹\r\n        callback.launch(FILE_NAME)\r\n    }\r\n    // é€²æ—\r\n    viewModel.progressLiveData.observe(this) { progress ->\r\n        println(progress)\r\n        viewBinding.progressBar.progress = progress\r\n        if (progress == 100) {\r\n            Toast.makeText(this, \"ãŠã‚ã‚Š\", Toast.LENGTH_SHORT).show()\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚‚å‹•ãã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# ã‚„ã£ã¦ã‚‹ã“ã¨\r\n- ãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚µã‚¤ã‚ºã‚’æ±‚ã‚ã‚‹\r\n- åˆ†å‰²æ•°ã«åˆã‚ã›ã¦ãƒã‚¤ãƒˆæ•°ã‚’æ±ºå®š\r\n- ä¸¦åˆ—ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€‚ä¸€æ—¦ä¿å­˜\r\n- ä¸€æ—¦ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã¦ä¿å­˜\r\n- Uriã‹ã‚‰OutputStreamã‚’å–å¾—ã—ã¦æ›¸ãè¾¼ã‚€\r\n- ã¾ã¨ã‚ãŸãƒ•ã‚¡ã‚¤ãƒ«ã€ä¸€æ—¦ä¿å­˜ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤\r\n\r\n# MediaStore.Download ã®ä¾‹\r\n\r\nã¾ãƒ¼ã˜ã§Androidã®ãƒ•ã‚¡ã‚¤ãƒ«æ“ä½œã©ã†ã«ã‹ãªã‚‰ã­ãˆã®ã“ã‚Œ\r\n\r\n```kotlin\r\n/**\r\n * MediaStore.Downloadã‚’åˆ©ç”¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ã«å…¥ã‚Œã‚‹\r\n * \r\n * Android 10ä»¥é™ã®ã¿å¯¾å¿œ\r\n * */\r\nprivate fun insertFileToDownloadFolder(fileName: String): Uri? {\r\n    val contentResolver = context.contentResolver\r\n    val contentUri = MediaStore.Downloads.getContentUri(MediaStore.VOLUME_EXTERNAL_PRIMARY)\r\n    val contentValues = ContentValues().apply {\r\n        put(MediaStore.Downloads.DISPLAY_NAME, fileName)\r\n    }\r\n    // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒ‡ãƒ¼ã‚¿ã‚’è¿½åŠ ã€‚Uriã‚’å—ã‘å–ã‚‹\r\n    val uri = contentResolver.insert(contentUri, contentValues)\r\n    return uri\r\n}\r\n```\r\n\r\nãã—ã¦`start`é–¢æ•°ã‚’å°‘ã—æ›¸ãæ›ãˆã‚‹\r\n\r\n```kotlin\r\n/**\r\n * ãƒ•ã‚¡ã‚¤ãƒ«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã‚’é–‹å§‹ã™ã‚‹\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * @param url URL\r\n * */\r\nfun start(url: String, fileName: String) {\r\n    totalByte = 0L\r\n    progressByte = 0L\r\n    viewModelScope.launch {\r\n        val responseHeader = getResponseHeader(url)\r\n        // åˆè¨ˆã‚µã‚¤ã‚º\r\n        val contentLength = responseHeader.headers[\"Content-Length\"]!!.toLong()\r\n        totalByte = contentLength\r\n        // åˆ†å‰²ã€‚ã¨ã‚Šã‚ãˆãš5åˆ†å‰²\r\n        val splitList = splitByteList(contentLength, 5)\r\n        // ãƒªã‚¯ã‚¨ã‚¹ãƒˆ\r\n        splitList\r\n            .mapIndexed { index, pair ->\r\n                // asyncã§ä¸¦åˆ—å®Ÿè¡Œ\r\n                async { requestFile(url, pair.first, pair.second, index, fileName) }\r\n            }.map { deferred ->\r\n                // ã™ã¹ã¦ã®asyncã‚’å¾…ã¤\r\n                deferred.await()\r\n            }\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’çµåˆ\r\n        val resultFile = multipleFileToOneFile(fileName)\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç§»å‹•ã•ã›ã¦å®Œæˆ\r\n        val uri = insertFileToDownloadFolder(fileName)\r\n        if (uri != null) {\r\n            moveFile(resultFile, uri)\r\n            // ãŠã—ã¾ã„\r\n            _progressLiveData.postValue(100)\r\n            println(\"ãŠã‚ã‚Š\")\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n`MainActivity`ã®æ–¹ã‚‚æ›¸ãæ›ãˆã¾ã™\r\n\r\n```kotlin\r\nclass MainActivity : AppCompatActivity() {\r\n\r\n    private val viewBinding by lazy { ActivityMainBinding.inflate(layoutInflater) }\r\n\r\n    private val viewModel by viewModels<MainActivityViewModel>()\r\n\r\n    /** URL */\r\n    private val URL = \"\"\r\n\r\n    /** ãƒ•ã‚¡ã‚¤ãƒ«å */\r\n    private val FILE_NAME = \"download.mp4\"\r\n\r\n    /** Activity Result API ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ */\r\n    private val callback = registerForActivityResult(ActivityResultContracts.CreateDocument()) { uri ->\r\n        if (uri != null) {\r\n            // ViewModelã«æ›¸ã„ãŸãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–¢æ•°ã‚’å‘¼ã¶\r\n            // viewModel.start(URL, FILE_NAME)\r\n        }\r\n    }\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContentView(viewBinding.root)\r\n\r\n        viewBinding.startButton.setOnClickListener {\r\n            // ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹\r\n            // callback.launch(FILE_NAME)\r\n            viewModel.start(URL, FILE_NAME)\r\n\r\n        }\r\n\r\n        // é€²æ—\r\n        viewModel.progressLiveData.observe(this) { progress ->\r\n            println(progress)\r\n            viewBinding.progressBar.progress = progress\r\n            if (progress == 100) {\r\n                Toast.makeText(this, \"ãŠã‚ã‚Š\", Toast.LENGTH_SHORT).show()\r\n            }\r\n        }\r\n\r\n    }\r\n}\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\nã¤ã‹ã‚ŒãŸã€‚ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™ã­ã€‚  \r\n\r\nhttps://github.com/takusan23/OkHttpRangeDownload"},{"title":"2020å¹´ã¾ã¨ã‚","link":"/posts/omisoka_2020/","markdown":"\r\nå†¬ä¼‘ã¿çŸ­ãã­ï¼Ÿ\r\n\r\n# ãŸã¡ã¿ã©ã‚ã„ã©\r\n2020å¹´12æœˆ31æ—¥ 17æ™‚48åˆ† ç¾åœ¨ã€releaseãƒ–ãƒ©ãƒ³ãƒï¼ˆã‚¹ãƒˆã‚¢ã«ãƒªãƒªãƒ¼ã‚¹ã—ãŸã‚³ãƒ¼ãƒ‰ã€masterã¯é–‹ç™ºãƒ–ãƒ©ãƒ³ãƒï¼‰ã®æƒ…å ±ã§ã™ã€‚\r\n\r\n## è¡Œæ•°\r\n`Intelij IDEA`ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã€[Statistic](https://plugins.jetbrains.com/plugin/4509-statistic)ã§è¨ˆæ¸¬ã—ã¾ã—ãŸã€‚\r\n\r\nimportå«ã‚ **29,991è¡Œ**\r\n\r\nimportãªã— **20,294è¡Œ**\r\n\r\nimportãªã—ã®çŠ¶æ…‹ã§ãƒ¬ãƒãƒ¼ãƒˆç”¨ç´™(ä¸€æš34è¡Œ)æ›ç®—ã™ã‚‹ã¨ï¼š**596æš**ãã‚‰ã„ï¼Ÿï¼ˆ20294/34ï¼‰\r\n\r\n### ã‚³ãƒ¡ãƒ³ãƒˆæ–‡ã®è¡Œæ•°\r\nå¤šåˆ†ã“ã‚Œã®ã›ã„ã§ä½™è¨ˆã«ã‚«ã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã‚‹ã€‚ã¨ã„ã†ã‚ã‘ã§ã‚³ãƒ¡ãƒ³ãƒˆã®è¡Œæ•°ã‚’è¦‹ã¦ã„ã“ã†ã€‚\r\n\r\nã‚³ãƒ¡ãƒ³ãƒˆ **6,669è¡Œ**\r\n\r\nãƒ¬ãƒãƒ¼ãƒˆç”¨ç´™(ä¸€æš34è¡Œ)ã§æ›ç®—ã™ã‚‹ã¨ï¼š**196æš**ãã‚‰ã„ï¼Ÿ(6669/34)\r\n\r\n### ã‚³ãƒŸãƒƒãƒˆå›æ•°\r\n\r\nã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å©ãã¨å‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n```\r\n$ git rev-list --count HEAD --since=\"Jan 01 2020\" --before=\"Dec 31 2020\"\r\n```\r\n\r\nå‚è€ƒï¼šhttps://stackoverflow.com/questions/36079884/count-git-commits-per-period\r\n\r\n**552**ã‚³ãƒŸãƒƒãƒˆã§ã—ãŸã€‚(ã‚³ãƒ­ãƒŠã§ä¼‘æ ¡é•·ã‹ã£ãŸã—ã¾ã‚ï¼Ÿ)  \r\n\r\n## ãã®ä»–\r\n\r\n- Qiitaæ¶ˆã—ã¦è‡ªä½œãƒ–ãƒ­ã‚°(Nuxt.js)ã«ä¹—ã‚Šæ›ãˆãŸ\r\n    - ã§ã‚‚ãªã‚“ã‹æ¤œç´¢ã«ã®ã‚‰ãªã„ã“ã¨ãŒå¤šã„\r\n\r\n- ã‚³ãƒ­ãƒŠã‚«ãƒ¬ãƒ³ãƒ€ãƒ¼ä½œã‚Šã¾ã—ãŸ\r\n    - https://tokyo-covid19-calendar.netlify.app/\r\n    - Netlify + GitHub Actions + Nuxt  è£½ã§ã™ã€‚\r\n    - https://github.com/takusan23/tokyo_covid19_calendar\r\n\r\nã‚“ã˜ã‚ƒç´…ç™½è¦‹ã¦ãã‚‹ã‚"},{"title":"2022å¹´ã¾ã¨ã‚","link":"/posts/omisoka_2022/","markdown":"\r\n2021ã¯ãªãœã‹ã‚ã‚Šã¾ã›ã‚“ã€‚\r\n\r\nã‚ã¨10åˆ†ãã‚‰ã„ã§å¹´è¶Šã—ãªã®ã§ã€‚\r\n\r\n# ï¼ˆã‚ˆãï¼‰èã„ãŸã‚¨ãƒ­ã‚²ã‚½ãƒ³ã‚°\r\nãªã‚“ã ã‹ã‚“ã CDé›†ã‚ã¦ã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/iuDE8vI.png)\r\n\r\n# ã™ã¾ã»\r\næ‰‹æŒã¡XperiaãŒSIMãƒ•ãƒªãƒ¼ã®ã«ãªã£ãŸ  \r\nå›ç·š`docomo`ã®ä»–ã€æ¥½å¤©ãƒ¢ãƒã‚¤ãƒ«ãŒãªããªã£ã¦ã€`povo`ã¨`linemo`ãŒæ–°ãŸã«åŠ ã‚ã‚Šã¾ã—ãŸï¼ˆ`NewRadioSupporter`ãƒ‡ãƒ¥ã‚¢ãƒ«SIMåŒ–ã«ã‚ˆã‚Šç«¯æœ«ã¨å›ç·šã‚’æ–°èª¿ï¼‰  \r\nå®‰ãæœ¬å®¶å›ç·šãŒæ‰‹ã«å…¥ã‚Šã¾ã™ï¼ˆæœ¬å®¶å›ç·šãªã®ã‹ãªï¼Ÿï¼‰\r\n\r\n# Git\r\nã‚ã‚“ã¾ã‚Šã‚³ãƒŸãƒƒãƒˆã§ãã¾ã›ã‚“ã§ã—ãŸã€‚\r\n\r\n# è¨˜äº‹\r\n2022å¹´æ›¸ã„ãŸè¨˜äº‹ã§ã™ã€‚\r\n\r\n[NewRadioSupporterãŒãƒ‡ãƒ¥ã‚¢ãƒ«SIMå¯¾å¿œã«å¯¾å¿œã—ã¾ã—ãŸ](/posts/android_new_radio_supporter_dual_sim_update/)  \r\n[2022å¹´ã¾ã¨ã‚](/posts/omisoka_2022/)  \r\n[WindowsAppSDK ã® WinUI 3 ã«å…¥é–€ã—ãŸã‚‰æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã—ã¦å‡ºé¼»ã‚’ãã˜ã‹ã‚ŒãŸè©±](/posts/windows_winui3_xml_charset/)  \r\n[Androidã®ARCoreã§GitHubã®è‰(skyline)ã‚’è¡¨ç¤ºã•ã›ã‚‹ã¾ã§ã€‚without Sceneformæ™‚ä»£ã®ARCoreã‚’è©¦ã™ã€‚](/posts/android_ar_core_github_skyline/)  \r\n[Next.js 13 ã«ã—ãŸ (ã—ãŸã ã‘)](/posts/next_js_13_migration/)  \r\n[Wear OS ã‹ã‚‰ã‚¹ãƒãƒ›ã®ãƒ–ãƒ©ã‚¦ã‚¶ã‚’é–‹ã](/posts/android_wear_os_open_smartphone_browser/)  \r\n[Wear OS ã®ã‚³ãƒ³ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œã‚ŠãŸã„](/posts/android_wear_os_complication/)  \r\n[WebMã‚’æ”»ç•¥ã™ã‚‹](/posts/video_webm_spec/)  \r\n[JavaScriptã§ãƒ‘ã‚½ã‚³ãƒ³ã®ç”»é¢éŒ²ç”»ã¨MPEG-DASHã§ãƒ©ã‚¤ãƒ–é…ä¿¡](/posts/javascript_webm_livestreaming/)  \r\n[Androidå˜ä½“ã§WebMã¨MPEG-DASHã‚’ä½¿ã£ãŸãƒ©ã‚¤ãƒ–ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°](/posts/android_standalone_webm_livestreaming/)  \r\n[ãƒ–ãƒ©ã‚¦ã‚¶ã¸Androidã®ç”»é¢ã‚’ãƒŸãƒ©ãƒ¼ãƒªãƒ³ã‚°ã§ãã‚‹ã‚¢ãƒ—ãƒªã€ãœã‚ã¿ã‚‰ãƒ¼ã‚’ä½œã£ãŸ](/posts/android_zero_mirror/)  \r\n[Androidã‚¢ãƒ—ãƒªå´ã§ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã®å­¦ç¿’æ©Ÿèƒ½ã‚’ç„¡åŠ¹ã«ã—ãŸã„](/posts/android_disable_keybord_learning/)  \r\n[Node.jsã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’GitHubã§é–‹ã„ãŸã‚‰è„†å¼±æ€§ãŒã‚ã‚‹ã¨è¨€ã‚ã‚ŒãŸã¨ã](/posts/node_js_github_dependencies/)  \r\n[è‡ªä½œAndroidãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ Maven Central ã¸å…¬é–‹ã™ã‚‹](/posts/android_library_publish_to_maven_central/)  \r\n[Hello Android 13ã€‚æ‡ä¸­é›»ç¯ç·¨](/posts/android_13_camera_flash_torch_level/)  \r\n[Androidã®MediaCodecã‚’åˆ©ç”¨ã—ã¦è¤‡æ•°ã®å‹•ç”»ã‚’ç¹‹ã’ã¦ä¸€ã¤ã®å‹•ç”»ã«ã™ã‚‹](/posts/android_mediacodec_merge_video/)  \r\n[Jetpack Compose ã® TextField ã§ã‚«ãƒ¼ã‚½ãƒ«ã®ä½ç½®å¤‰æ›´](/posts/android_jc_textfield_cursor/)  \r\n[Hello Android 13ã€‚ãƒ€ã‚¤ãƒŠãƒŸãƒƒã‚¯ã‚«ãƒ©ãƒ¼ã®ã‚¢ã‚¤ã‚³ãƒ³ç·¨ (Android 12ã‚‚ã‚ã‚‹ã‚ˆ)](/posts/android_13_dynamic_color_icon/)  \r\n[Androidã‚¢ãƒ—ãƒªã®ãƒ“ãƒ«ãƒ‰ã—ãŸæ—¥ä»˜ã‚’ã‚¢ãƒ—ãƒªå´ã‹ã‚‰å–å¾—ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹](/posts/android_build_date_resource/)  \r\n[MUIã®Gridã‚’ä½¿ã£ã¦æ®‹ã‚Šã‚’åŸ‹ã‚ãŸã‚ŠçœŸã‚“ä¸­ã«ãŠã„ãŸã‚Š](/posts/react_material_ui_responsive/)  \r\n[GitHub Actions ã§ Androidã®ãƒªãƒªãƒ¼ã‚¹APKä½œæˆ](/posts/github_actions_android_release_apk/)  \r\n[Android Studio Bumblebee ã§ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã® build.gradle ã®æ›¸ãæ–¹ãŒå¤‰ã‚ã£ãŸã¿ãŸã„](/posts/android_gradle_bumblebee/)  \r\n[JetpackComposeã§è¦ªã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚‚ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãŒã»ã—ã„](/posts/android_jc_parent_component_click/)  \r\n[Android Studio Bumblebee ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸã‚‰ ADB ãŒèµ·å‹•ã—ãªã„ï¼ˆãšã£ã¨ Loading Devices... ï¼‰](/posts/android_studio_bumblebee_not_start_adb/)  \r\n[Next.jsã¸Googleã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã®GA4ã¨UAã‚’å…±å­˜ã•ã›ã‚‹](/posts/next_js_google_analytics_ua_ga4/)  \r\n[Next.jsã§ãƒ–ãƒ­ã‚°ä½œã‚Šç›´ã—ãŸã®ã§ãã®éš›ã«å¤§å¤‰ã ã£ãŸã“ã¨](/posts/taihendattakoto_next_js_blog/)  \r\n\r\n# ä»¥ä¸Šã§ã™ã€‚ã¾ãŸæ¥å¹´"},{"title":"PlayStoreã¸ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹","link":"/posts/play_store_upload/","markdown":"ç¥æ§˜ã«ãªã£ãŸæ—¥ã®å¹¼é¦´æŸ“ã‹ã‚ã„ã„ã€‚ã‚“ã ã‘ã©å¿™ã—ã„ã‹ã‚‰è¦‹ã‚‹æ™‚é–“ãŒãªã„ã€‚\n\n# æœ¬é¡Œ\nPlayConsoleã‚’ä½¿ã„ã€PlayStoreã¸ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹æ–¹æ³•ã‚’æ›¸ãã¾ã™ã€‚  \n\n# <span style=\"color:red\">å–ã‚Šè¿”ã—ã®ã¤ã‹ãªã„ã“ã¨ã¾ã¨ã‚</span>\nã¨ãã®ã¾ãˆã«ã€å–ã‚Šè¿”ã—ã®ã¤ã‹ãªã„ã“ã¨ã‚’æ›¸ã„ã¦ãŠãã¾ã™ã€‚è¦šãˆã¦ã‚‹ç¯„å›²ã§\n- å…¬é–‹ã™ã‚‹ã¨ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³IDã®å¤‰æ›´ãŒã§ããªã„\n    - ä»–ã¨è¢«ã‚‰ãªã„ã‚ˆã†ã«ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’ä½¿ã†ä¾‹ãŒå¤šã„ã‘ã©åˆ¥ã«**è¢«ã‚‰ãªã‘ã‚Œã°ä½•ã§ã‚‚ã„ã„ã¨æ€ã†**\n- aabç”Ÿæˆæ™‚(apkã‚‚ãã†)ã«ä½¿ã†KeyStoreã£ã¦ã‚„ã¤ï¼ˆç½²åéµï¼‰ã€ã‚ã‚Œã‚’ãªãã™ã¨å…¬é–‹ã§ããªããªã‚‹ã€‚\n    - ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ™‚ã®æœ¬äººç¢ºèªã§ã“ã®ç½²åéµã§ç½²åã•ã‚ŒãŸã‹ã©ã†ã‹ã§ä½¿ã£ã¦ã‚‹ãã†ã€‚\n    - ã§ã‚‚ãªã‚“ã‹ Google Play App Signing ã£ã¦ã‚„ã¤ã‚’ä½¿ã£ã¦ã„ã‚Œã°ç½²åéµã‚’å†åº¦ç™»éŒ²ã—ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã‹ \n        - Googleå…ˆç”Ÿã¨è¦ç›¸è«‡\n- **KeyStoreä½œæˆæ™‚ã«æ›¸ã„ãŸCertificateã¯è¦‹ã‚ˆã†ã¨æ€ãˆã°è¦‹ã‚Œã‚‹**\n    - **æœ¬å**ã¨ã‹**ä½æ‰€**ã‚’å…¥ã‚Œã‚‹æ¬„ãŒã‚ã‚‹ã‘ã©ã€å…¥ã‚Œã‚‹ã¨ã¾ãšã„å¯èƒ½æ€§ãŒã‚ã‚‹\n    - è¦‹ã‚‰ã‚ŒãŸããªã‘ã‚Œã°ç©ºç™½ã«ã§ãã‚‹ã®ã§ãã‚Œã§ã„ã„\n- ä¸€åº¦å…¬é–‹ã™ã‚‹ã¨æ¶ˆã›ãªã„\n    - ã„ã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã§ã‚ã‚‹ä»¥ä¸Šé¿ã‘ã‚Œã‚“ã‚„ã‚ï½—ï½—ï½—ã£ã¦è©±ã§ã¯ã‚ã‚‹\n        - Twitterãªã‚‰ãƒ„ã‚¤æ¶ˆã—ã§ä¸€å¿œæ¶ˆã™ã“ã¨ã¯å‡ºæ¥ã¾ã™ãŒã€Playã‚¹ãƒˆã‚¢ã«é–¢ã—ã¦ã¯å°‘ã—é•ã„ã¾ã™ã€‚\n        - **Playã‚¹ãƒˆã‚¢ã‹ã‚‰ã‚¢ãƒ—ãƒªã‚’æ¶ˆã—ãŸéš›ã®æŒ™å‹•**\n            - ä¸€åº¦ã‚‚ã‚¢ãƒ—ãƒªã‚’å…¥ã‚ŒãŸã“ã¨ã®ãªã„ãƒ¦ãƒ¼ã‚¶ãƒ¼\n                - **URLã‹ã‚‰ç›´æ¥é–‹ã„ã¦ã‚‚è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒå‡ºæ¥ãªã„**\n            - ä¸€åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ãŸã“ã¨ãŒã‚ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼\n                - **URLã‹ã‚‰ç›´æ¥é–‹ã‘ã°ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹**\n                - ã“ã®ã›ã„ã§å®Œå…¨ã«æ¶ˆã™ã“ã¨ãŒå‡ºæ¥ãªã„ã€‚\n    - ãªã‚“ã‹çŸ¥ã‚‰ã‚“ã†ã¡ã«apkãŒã‚ˆãã‚ã‹ã‚‰ã‚“ã¨ã“ã‚ã§é…ä¿¡ã•ã‚Œã‚‹\n        - ãªã‚“ã‹ã‚ã£ã¡ã‚ƒã‚ã‚„ã—ã„\n\n# PlayConsoleã‚’åˆ©ç”¨ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹\n25ãƒ‰ãƒ«æ‰•ã£ã¦ãã ã•ã„ã€‚ç¢ºã‹Kyashã§æ‰•ãˆãŸæ°—ãŒã—ã¾ã™ã€‚  \nç§ãŒæ‰•ã£ãŸæ™‚ã¯2863å††ã§ã—ãŸã€‚ä»Šèª¿ã¹ãŸã‚‰2583å††ã‚‰ã—ã„ã§ã™ã€‚å¤§çµ±é ˜é¸ã®ã›ã„ï¼Ÿã‹çŸ¥ã‚Šã¾ã›ã‚“ãŒå††é«˜ã«ãªã£ã¦ã¾ã™ã­ã€‚\n\n# ç½²åéµã‚’ä½œæˆã™ã‚‹ - Android Studioã§ã®ä½œæ¥­\nãƒ¡ãƒ‹ãƒ¥ãƒ¼ãƒãƒ¼ã®ã“ã“ã§ã™ã€‚\n\n![Imgur](https://imgur.com/SbJfYuR.png)\n\nãã—ãŸã‚‰ã€aabã®æ–¹ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚  \n\n![Imgur](https://imgur.com/AdgEBP6.png)\n\n## ç½²åéµãŒã‚ã‚Œã°\nKeyStoreä½œæˆæ™‚ã«è¨­å®šã—ãŸå€¤\n- Key store password\n- Key alias\n- Key password\nã‚’å…¥ã‚Œã¦ã€\n\n![Imgur](https://imgur.com/9Ax3dPK.png)\n\n<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">Next</span>ã‚’æŠ¼ã—ã¦æ¬¡ã¸é€²ã¿ã¾ã™ã€‚\n\n## ç½²åéµãŒç„¡ã„æ™‚ã¯ä½œæˆ\n<span style=\"border: solid 1px gray;padding:2px;border-radius:5px\">Create new...</span>ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚\n\n![Imgur](https://imgur.com/k67IYmO.png)\n\nã“ã‚“ãªç”»é¢ãŒå‡ºã‚‹ã®ã§ã€é …ç›®ã‚’åŸ‹ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\n\n![Imgur](https://imgur.com/d8FPCip.png)\n\nå¿…é ˆé …ç›®ã¯ä»¥ä¸‹ã§ã™ã€‚\n\n| åå‰                | è©³ç´°                                                                                              |\n|---------------------|---------------------------------------------------------------------------------------------------|\n| Key store path      | ç½²åéµã®ä¿å­˜å…ˆã§ã™ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å…¥ã‚Œã‚‹ã¨GitHubã¸å…¬é–‹ã•ã‚Œã¡ã‚ƒã„ãã†ãªæ°—ãŒã™ã‚‹ã®ã§æ°—ã‚’ã¤ã‘ã¦ã€‚    |\n| Password            | ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã€‚6æ–‡å­—ä»¥ä¸Š                                                                             |\n| Confirm             | ã‚‚ã†ä¸€å›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›                                                                            |\n|                     |                                                                                                   |\n| Key                 |                                                                                                   |\n| Alias               | ç½²åéµã®åå‰ï¼Ÿ                                                                                    |\n| Password            | ã•ã£ãä½œæˆã—ãŸãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã§ã‚‚ç‰¹ã«ã‚¨ãƒ©ãƒ¼ã¯å‡ºãªã‹ã£ãŸã‘ã©ã€Androidã¯é•ã†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’æ¨å¥¨ã—ã¦ã‚‹ã£ã½ã„ |\n| Confirm             | ã‚‚ã†ä¸€å›ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å…¥åŠ›                                                                            |\n| Validity            | 25å¹´ä»¥ä¸Š                                                                                          |\n|                     |                                                                                                   |\n| Certificate         | æ³¨æ„ï¼šè¦‹ã‚ˆã†ã¨æ€ãˆã°ä»¥ä¸‹ã®é …ç›®ã¯è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚                                              |\n| First and Last Name | éµã®æ‰€æœ‰è€…æƒ…å ±ã€‚ã“ã‚Œã ã‘å¿…é ˆé …ç›®                                                                  |\n\nå¿˜ã‚Œã‚‹ã¨äºŒå›ç›®ä»¥é™å…¬é–‹ã§ããªããªã‚‹ã®ã§ååˆ†æ°—ã‚’ã¤ã‘ã¾ã—ã‚‡ã†ã€‚\n\n![Imgur](https://imgur.com/gX7vYDI.png)\n\nå…¥åŠ›ã§ããŸã‚‰ã€OKã‚’æŠ¼ã—ã¾ã—ã‚‡ã†ã€‚ãªã‚“ã‹<span style=\"color:red\">æ¨å¥¨ã—ã¦ã„ã¾ã›ã‚“</span>ã¿ãŸã„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‡ºã‚‹ã‘ã©ã€ãã®ã¾ã¾é–‰ã˜ã‚Œã°ãŠï½‹ã§ã™ã€‚\n\n<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">Next</span>ã‚’æŠ¼ã—ã¦æ¬¡ã¸é€²ã¿ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/9Ax3dPK.png)\n\næœ€å¾Œã€releaseã‚’é¸æŠã—ã¦ã€<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">Finish</span>ã‚’æŠ¼ã—ã¦.aabã‚’ç”Ÿæˆã—ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/UPqzNgi.png)\n\nã“ã‚Œã§aabãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã§ãã¾ã—ãŸã€‚æ¬¡ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã§ã®ä½œæ¥­ã§ã™ã€‚\n\n# PlayConsoleã¸ç™»éŒ²\nUIãŒå¤‰ã‚ã‚Šã¾ã—ãŸã­ï¼ˆï¼‰\n\n## ã‚¢ãƒ—ãƒªã‚’ä½œæˆ\nã‚’æŠ¼ã—ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/4MVCOH6.png)\n\nãã—ãŸã‚‰é …ç›®ã‚’åŸ‹ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\n\n![Imgur](https://imgur.com/CodMVOr.png)\n\n## ç±³å›½è¼¸å‡ºæ³• #ã¨ã¯\nã‚ˆãçŸ¥ã‚‰ãªã„ã‘ã©ã€  \n**Google Play Storeã¯ã‚¢ãƒ¡ãƒªã‚«ã«ã‚ã£ã¦ã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã‚‹ã“ã¨ ãã‚Œã¯ ã‚¢ãƒ¡ãƒªã‚«ã‹ã‚‰æ—¥æœ¬ã¸ã‚¢ãƒ—ãƒªã‚’è¼¸å‡ºã—ã¦ã„ã‚‹ äº‹ã¨åŒã˜ï¼**  \nã¨è§£é‡ˆã•ã‚Œã‚‹ã‚‰ã—ãã€é•åã—ã¦ã„ãªã„ã“ã¨ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \n\nè‹±èªï¼šhttps://www.bis.doc.gov/index.php/policy-guidance/encryption\n\n\n<details>\n<summary>ï¼ˆå¤šåˆ†ï¼‰èª­ã‚€å¿…è¦ãŒãªã„ã®ã§æŠ˜ã‚ŠãŸãŸã‚“ã§ãŠã</summary>\n\n<h3>ã“ã£ã‹ã‚‰åˆã£ã¦ã‚‹ã‹ã‚ã‹ã‚‰ã‚“</h3>\næ³•å¾‹ã‚ã‹ã‚‰ã‚“ä¸Šã«è‹±èªãªã®ã§è©°ã‚“ã§ã‚‹ã€‚å°‚é–€å®¶ã¨ã‹ã˜ã‚ƒãªãã€ãŸã ã®å­¦ç”Ÿã ã‹ã‚‰ãã‚Œã§ã‚‚ã‚ˆã‘ã‚Œã°ã€‚\n\nã§ã€ç±³å›½è¼¸å‡ºæ³•ã£ã¦ã®ã¯ã©ã†ã‚„ã‚‰æš—å·åŒ–æŠ€è¡“ã«ã¤ã„ã¦ã®è©±ã‚‰ã—ãã€  \nã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‚’æ‰±ã†å ´åˆã¯HTTPSãŒã‚‚ã‚Œãªãæš—å·åŒ–æŠ€è¡“ã«å½“ãŸã‚‹ã€‚\n\n<h3>EARã®ã‚µã‚¤ãƒˆã‚’è¦‹ã¦ã¿ã‚‹</h3>\næœ‰å¿—?ã®æ—¥æœ¬èªç‰ˆã‚’ãŠå€Ÿã‚Šã—ã¦è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚\n\nhttps://www009.web.fc2.com/cipher5/Encryption_0.htm\n\n**EARã®å¯¾è±¡ã¨ãªã‚‰ãªã„æš—å·å“ç›®**ã‚’é–‹ã„ã¦ã¿ã‚‹\n\nhttps://www009.web.fc2.com/cipher5/notEAR.htm\n\n<p style=\"border: solid 1px red;\">\nãƒ»ã€€ä¾‹ãˆã°ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³åˆã¯ã‚³ãƒ³ãƒ”ãƒ¥ãƒ¼ã‚¿ç”¨ã«ä½œæˆã•ã‚ŒãŸã‚¢ãƒ—ãƒªã§ã‚ã£ã¦ã€ãƒã‚¹ãƒãƒ¼ã‚±ãƒƒãƒˆåŸºæº–ï¼ˆã‚«ãƒ†ã‚´ãƒªãƒ¼5 ãƒ‘ãƒ¼ãƒˆ2ã®æ³¨3ã§è¦å®šã•ã‚Œã‚‹åŸºæº–ï¼‰ã‚’æº€ãŸã™ã‚‚ã®ã®ã†ã¡ã€ç„¡æ–™ã§å…¥æ‰‹å¯èƒ½ã¨ã•ã‚Œã‚‹ã‚‚ã®ã¯ã€\"ä¸€èˆ¬ã«å…¥æ‰‹ã§ãã‚‹\"ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚ ã“ã®å ´åˆã€ã‚ãªãŸã¯ã€è‡ªå·±ç•ªå·åˆ†é¡å ±å‘Šè¦ä»¶ã‚’ä¼´ã†5D992.cã¨ã—ã¦ã®è‡ªå·±ç•ªå·åˆ†é¡ï¼ˆåˆã¯BISã¸ã®ç•ªå·åˆ†é¡è«‹æ±‚ã®æå‡ºï¼‰ã«ã‚ˆã‚Šã€740.17 (b)(1)åˆã¯(b)(3)ã«åŸºã¥ããƒã‚¹ãƒãƒ¼ã‚±ãƒƒãƒˆè¦æ±‚äº‹é …ã‚’æœ€åˆã«ä¸€åº¦ã ã‘é †å®ˆã—ãªã‘ã‚Œã°ãªã‚Šã¾ã›ã‚“ã€‚ ãã®å¾Œã€å½“è©²å“ç›®ãŒä¸€èˆ¬ã«å…¥æ‰‹å¯èƒ½ã¨ã•ã‚ŒãŸå ´åˆï¼ˆä¾‹ãˆã°ã€ç„¡æ–™ã®ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼‰ã€ãã‚Œä»¥é™ã¯EARã®å¯¾è±¡ã§ãªã„ã¨ã¿ãªã•ã‚Œã¾ã™ã€‚\n</p>\n\nä¾‹ã‚ã‚‹ã‚„ã‚“ã‘ï¼  \nç¬¬5ç·¨æ³¨3ã«è¨˜è¼‰ã‚’è¦‹ã¦ã¿ã‚‹\nhttps://www009.web.fc2.com/EAR_J/J774-5-2.pdf#Note3\n\n<p style=\"border: solid 1px red\">\nãƒ»éµé•·ãŒ 64 ãƒ“ãƒƒãƒˆè¶…ã®å¯¾ç§°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ <br>\nãƒ»éµé•·ãŒ 768 ãƒ“ãƒƒãƒˆè¶…ã®éå¯¾ç§°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ <br>\nãƒ»éµé•·ãŒ 128 ãƒ“ãƒƒãƒˆè¶…ã®æ¥•å††æš—å·ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ <br>\nã“ã‚Œã‚‰ã«è©²å½“ã™ã‚‹å ´åˆã¯ã€<span style=\"color:red\">ç•ªå·åˆ†é¡è«‹æ±‚åˆã¯è‡ªå·±ç•ªå·åˆ†é¡å ±å‘Š</span>ã‚’æå‡ºã—ãªã„ã¨ã„ã‘ãªã„\n</p>\n\nä½•ã®ã“ã¨ã ã‹ã•ã£ã±ã‚Šã§ã™ãŒã€HTTPSã¯è©²å½“ã™ã‚‹æ¨¡æ§˜ã€‚ã‚ˆã£ã¦å¹´æ¬¡è‡ªå·±åˆ†é¡å ±å‘Šæ›¸ã‚’æå‡ºã™ã‚‹å¿…è¦ãŒã‚ã‚‹æ¨¡æ§˜ã€‚åˆè€³ï¼ˆï¼‰\n\nå‚è€ƒãƒšãƒ¼ã‚¸\n- https://docs.microsoft.com/ja-jp/windows/uwp/security/export-restrictions-on-cryptography\n- https://support.google.com/googleplay/android-developer/answer/113770?hl=ja\n- https://www.bis.doc.gov/index.php/policy-guidance/encryption/1-encryption-items-not-subject-to-the-ear\n- http://tmurakam.hatenablog.com/?page=1318328575\n\n</details>\n<br>\n\n**iOSã®AppStoreã§ã¯HTTPSä½¿ã£ã¦ã‚“ãªã‚‰ã€Œå¹´æ¬¡è‡ªå·±åˆ†é¡å ±å‘Šæ›¸ã€æ›¸ã‘ã‚ˆãª**ã£ã¦è¨€ã‚ã‚Œã¦ã‚‹ã‚‰ã—ã„ã®ã§ã€  \nAndroidã§ã‚‚HTTPSã‚’åˆ©ç”¨ã—ãŸãªã‚‰æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ã£ã½ã„ã§ã™ã€‚ã‚„ã¹ãƒ¼ãã‚“ãªã“ã¨ä¸€å›ã‚‚ã‚„ã£ãŸã“ã¨ç„¡ã„ã\n\næå‡ºæ–¹æ³•ã®æœ‰å¿—ï¼Ÿæ—¥æœ¬èªç‰ˆã¯ã“ã¡ã‚‰ã«ï¼šhttps://www009.web.fc2.com/cipher5/Howto_file_selfClassify.htm\n\nè©³ã—ãã¯å„è‡ªèª¿ã¹ã¦ãã ã•ã„ã€‚\n\nã¨ã‚Šã‚ãˆãšãƒã‚§ãƒƒã‚¯ã‚’ã„ã‚Œã¦ã‚¢ãƒ—ãƒªã‚’ä½œæˆã—ã¾ã—ã‚‡ã†(ä»Šå›ã®ã‚¢ãƒ—ãƒªã§ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä½¿ã£ã¦ãªã„)\n\n![Imgur](https://imgur.com/9XNAAk7.png)\n\n# åˆæœŸè¨­å®š\n\n~~å‰ã®UIã ã¨å…¥åŠ›ãŒçµ‚ã‚ã‚‹ã¨ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã«ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ãŒã¤ã„ãŸã‚“ã ã‘ã©æ–°UIã«ã¯å¼•ãç¶™ãŒã‚Œãªã‹ã£ãŸã‹~~æ˜”ã®è©±ã¯ç½®ã„ã¦ãŠã„ã¦æ‰‹é †ã‚’è¸ã‚“ã§ã„ãã¾ã—ã‚‡ã†ã€‚\n\n![Imgur](https://imgur.com/McE3Wxk.png)\n\n## ã‚¹ãƒˆã‚¢ã®è¨­å®š\nã§ã€PlayStoreã§å…¬é–‹ã•ã‚Œã‚‹ãƒ¡ã‚¢ãƒ‰ã‚’å…¥åŠ›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã€å…¬é–‹ã•ã‚Œã¦ã‚‚ã„ã„ãƒ¡ã‚¢ãƒ‰ã‚’ç”¨æ„ã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚\n\n## ãƒ¡ã‚¤ãƒ³ã®ã‚¹ãƒˆã‚¢ã®æ²è¼‰æƒ…å ±\nPlayã‚¹ãƒˆã‚¢ã«è¡¨ç¤ºã™ã‚‹æƒ…å ±ã§ã™ã­ã€‚ã“ã“ã«å£²ã‚Šæ–‡å¥ã‚’æ›¸ã„ã¦ã„ãã¾ã—ã‚‡ã†ã€‚  \n\nã‚¢ã‚¤ã‚³ãƒ³ã®ç”»åƒã§ã™ãŒã€`Android Studio`ã§ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®šã—ãŸéš›ã«ã€`src/main/ic_launcher-playstore.png`ã«ç”Ÿæˆã•ã‚Œã¦ã‚‹ã¨æ€ã†ã®ã§ãã‚Œã‚’ä½¿ãˆã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \nã‚‚ã—ã‚¢ã‚¤ã‚³ãƒ³ã‚’æãéš›ã€è§’ã‚’ä¸¸ãã™ã‚‹åŠ å·¥ã¯Playã‚¹ãƒˆã‚¢ã§ã‚„ã£ã¦ãã‚Œã‚‹ã®ã§å››è§’ã„ç”»åƒã§ä½œæˆã—ã¾ã—ã‚‡ã†ã€‚  \n\n### ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ ã‚°ãƒ©ãƒ•ã‚£ãƒƒã‚¯\nã¯ã©ã“ã§ä½¿ã£ã¦ã‚‹ã®ã‹ã‚ˆãã‚ã‹ã‚Šã¾ã›ã‚“ã€‚å°‘ã—å‰ã®Playã‚¹ãƒˆã‚¢ãªã‚‰Twitterã®ãƒ˜ãƒƒãƒ€ãƒ¼ã¿ãŸã„ã«è¡¨ç¤ºã•ã‚Œã¦ãŸæ°—ãŒã—ã¾ã™ãŒã€ã„ã¤ã®é–“ã«ã‹ãªããªã£ã¦ãŸã®ã§ç§ã¯é©å½“ã«ä½œã£ã¦å…¥ã‚Œã¦ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/et7Q7WJ.png)\n\n### ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ\nç§ã¯Android Studioã®Androidã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ä½¿ã£ã¦ã¾ã™ã€‚  \nç«¯æœ«ã«ã¯**Pixel 2**ã‚’ä½¿ã£ã¦ã¾ã™ã€‚Pixel 3 XL ã ã¨ãªã‚“ã‹ã‚µã‚¤ã‚ºãŒåˆã‚ãªãã¦ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¼¾ã‹ã‚ŒãŸã€‚\n\nãã†ã„ãˆã°Googleãƒ•ã‚©ãƒˆã®ç„¡æ–™ç„¡åˆ¶é™ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãŒãªããªã‚‹ãã†ã§ã™ã­ã€‚SDã‚«ãƒ¼ãƒ‰ã®æ™‚ä»£å¾©æ´»ï¼Ÿ\n\nã‚ã¨7ã‚¤ãƒ³ãƒã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã€10ã‚¤ãƒ³ãƒã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç”¨ã®ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’è¦æ±‚ã•ã‚Œã¦ã‚‹ã‚ˆã†ã«è¦‹ãˆã¾ã™ãŒã€æœ€ä½é™ã‚¹ãƒãƒ›ç”¨ã®ã‚¹ã‚¯ã‚·ãƒ§ãŒã‚ã‚Œã°é€šã‚Šã¾ã™ã€‚\n\n# ã‚¢ãƒ—ãƒªå…¬é–‹\næ—©é€Ÿè£½å“ç‰ˆã¨ã—ã¦å…¬é–‹ã—ã¾ã—ã‚‡ã†ï¼ã€‚ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã®ä¸­ã‹ã‚‰è£½å“ç‰ˆã‚’æ¢ã—ã¦é¸ã‚“ã§ãã ã•ã„ã€‚\n\n![Imgur](https://imgur.com/7NQDgPs.png)\n\n<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">æ–°ã—ã„ãƒªãƒªãƒ¼ã‚¹ã‚’ä½œæˆ</span>ã‚’ãˆã‚‰ã‚“ã§aabã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ç”»é¢ã¸é€²ã¿ã¾ã™ã€‚  \n\n## Google Play ã‚¢ãƒ—ãƒªç½²å\n\n<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">æ¬¡ã¸</span>ã‚’é¸ã‚“ã§ã“ã®æ©Ÿèƒ½ã‚’æœ‰åŠ¹ã«ã—ã¾ã—ã‚‡ã†ã€‚  \n- aabå½¢å¼ã§ã‚¢ãƒ—ãƒªã‚’æå‡ºã™ã‚‹éš›ã¯ã“ã‚Œã‚’æœ‰åŠ¹ã«ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹æ¨¡æ§˜ã€‚\n- **ä¸€ç•ªæœ€åˆã«ä½œã£ãŸKeyStoreã¨ã¯åˆ¥ç‰©ã§ã€ã“ã£ã¡(Google Play ã‚¢ãƒ—ãƒªç½²å)ã«é–¢ã—ã¦ã¯ã“ã‚Œä»¥é™è§¦ã‚‹ã“ã¨ã¯ãªã„ã§ã™**\n    - é–‹ç™ºè€…ãŒaabã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹éš›ã®æœ¬äººç¢ºèªã¨ã—ã¦ä½¿ã†ã®ãŒã€`ä¸€ç•ªæœ€åˆã«ä½œã£ãŸKeyStore`ã€‚\n    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ãƒ—ãƒªã®æ›´æ–°ã®éš›ã«é–‹ç™ºå…ƒãŒåŒã˜ã‹ã©ã†ã‹ã®è¨¼æ˜ã«ä½¿ã†ã®ãŒã€`Google Play ã‚¢ãƒ—ãƒªç½²å`ã€‚\n        - GoogleãŒç®¡ç†ã™ã‚‹ã®ã§ç§é”ã¯æ°—ã«ã™ã‚‹å¿…è¦ãªã—\n    - aabæå‡ºæ™‚ã«ä½¿ã†ç½²åã¨ã‚¢ãƒ—ãƒªã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹éš›ã®ç½²åãŒãã‚Œãã‚Œé•ã†ã®ã§ã€ä¸‡ãŒä¸€`KeyStore`ã‚’ç´›å¤±ã—ã¦ã‚‚Googleå…ˆç”Ÿã¨ç›¸è«‡ã™ã‚Œã°ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚‚ã‚‰ãˆã‚‹ã—ã€æ—¢å­˜ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãã®ã¾ã¾ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã‚’å—ã‘å–ã‚Œã‚‹ã€‚\n    - (å¤šåˆ†ã“ã‚“ãªæ„Ÿã˜ã ã¨æ€ã†)\n\n![Imgur](https://imgur.com/jTJaRTX.png)\n\nãã—ãŸã‚‰ã€**App Bundle ã¨ APK**ã®æ¬„ã«`app-release.aab`ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã•ã›ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/MBEp94q.png)\n\n\n### ã‚‚ã—ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—(äºŒå›ç›®ä»¥é™ã®æå‡º)ã•ã›ã‚‹å ´åˆã¯\n`app`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚‹`build.gradle`ã‚’é–‹ãã€\n\n```gradle\ndefaultConfig {\n    applicationId \"io.github.takusan23.countdownwidgetlist\"\n    minSdkVersion 21\n    targetSdkVersion 30\n    versionCode 1\n    versionName \"1.0\"\n    testInstrumentationRunner \"androidx.test.runner.AndroidJUnitRunner\"\n}\n```\n\nã“ã®ä¸­ã®\n- `versionCode`\n    - æå‡ºã®åº¦ã«1è¶³ã™ï¼ˆã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆï¼‰ã—ãªã„ã¨ã ã‚ã§ã™ã€‚\n- `versionName`(ä¸€å¿œ)\n    - `1.0.1` ã¿ãŸã„ãªæ„Ÿã˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã“ã“ã§æŒ‡å®šã—ã¾ã™ã€‚\n\nã“ã®2ã¤ã‚’æ›¸ãæ›ãˆã¦ãŠãã¾ã—ã‚‡ã†\n\n\n### ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆ\næ›´æ–°å†…å®¹ã§ã™ã­ã€‚æœ€åˆã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãªã®ã§ã¨ã‚Šã‚ãˆãšåˆå›ç‰ˆã¨ã‹æ›¸ã„ã¦ãŠã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/cV2PKiJ.png)\n\nã§ããŸã‚‰ ä¿å­˜ â†’ ãƒªãƒªãƒ¼ã‚¹ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ ã‚’æŠ¼ã—ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/xmZcl8M.png)\n\nãªã‚“ã‹è¨­å®šå¿˜ã‚Œã¦ãŸã£ã½ã„ã®ã§è¨­å®šã—ã¾ã—ã‚‡ã†ã€‚\n\n# å›½/åœ°åŸŸ\nè£½å“ç‰ˆã®ä¸­ã«ã‚ã‚Šã¾ã™ã€‚\n\n![Imgur](https://imgur.com/Au6CsEq.png)\n\n`å›½ / åœ°åŸŸã‚’è¿½åŠ `ã‚’æŠ¼ã—ã¦ã€ä¸€è¦§ã®ä¸­ã®ä¸€ç•ªä¸Šã«æœ‰ã‚‹`å›½ / åœ°åŸŸ`ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§ã™ã¹ã¦ã®å›½ã§ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚å¤šåˆ†å¤§ä¸ˆå¤«ã ã¨æ€ã„ã¾ã™ã€‚(å®Ÿã¯ä»–ã®å›½ã§ã‚¢ãƒ—ãƒªãŒå…¬é–‹ã§ããªããªã£ãŸäº‹ãŒã‚ã‚‹)\n\nã“ã‚Œã§ã‚¢ãƒ—ãƒªã®å…¬é–‹ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã¯ãšã§ã™ã€‚\n\n\n<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">è£½å“ç‰ˆã¨ã—ã¦å…¬é–‹ã‚’é–‹å§‹</span>ã‚’æŠ¼ã—ã¦å‡ºã¦ããŸãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã®<span style=\"padding:2px;border-radius:5px;background:dodgerblue;color:white;\">å…¬é–‹</span>ã‚’æŠ¼ã™ã“ã¨ã§å¯©æŸ»ãŒå§‹ã¾ã‚Šã¾ã™ã€‚  \nã‚¹ãƒãƒ›ã«`PlayConsole`ã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã¦ãŠãã“ã¨ã§å…¬é–‹ã•ã‚ŒãŸéš›ã«ãƒ—ãƒƒã‚·ãƒ¥é€šçŸ¥ãŒè¡Œãã¾ã™ã‚ˆãƒ¼ã„ãã„ãã€‚\n\n![Imgur](https://imgur.com/6lr58tu.png)\n\nã‚ã¨ã¯å…¬é–‹ã•ã‚Œã‚‹ã®ã‚’å¾…ã¤ã ã‘ã§ã™ã€‚ãŸã®ã—ã¿ï½  \n\n# è¿½è¨˜\n2020å¹´11æœˆ14æ—¥ã®19æ™‚33åˆ†ã«å…¬é–‹ã•ã‚ŒãŸã¨PlayConsoleã‚¢ãƒ—ãƒªãŒé€šçŸ¥ã‚’é£›ã°ã—ã¦ãã¾ã—ãŸã€‚"},{"title":"ãƒ©ã‚ºãƒ‘ã‚¤ã«æœ€æ–°ç‰ˆNode.jsã‚’å…¥ã‚Œã‚‹","link":"/posts/raspi-nodejs/","markdown":"\r\nãƒ¡ãƒ¢ä»£ã‚ã‚Š\r\n\r\nURLã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ¬¡ç¬¬ã§å¤‰ã‚ã‚‹ã¨æ€ã†ï¼ˆv12.xãªã‚‰`https://deb.nodesource.com/setup_12.x`ã«ãªã‚‹ï¼‰\r\n\r\n```terminal\r\ncurl -sL https://deb.nodesource.com/setup_14.x | sudo -E bash -\r\n```\r\n\r\nâ†“\r\n\r\n```terminal\r\nsudo apt-get install -y nodejs\r\n```\r\n\r\nâ†“\r\n\r\n```terminal\r\nnode -v\r\n```\r\n\r\nã—ãŸçµæœãŒ `v14.9.0`(ç‹™ã£ãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³) ã«ãªã£ã¦å…¥ã‚Œã°ãŠï½‹\r\n\r\n# ãŠã‚ã‚Šã«\r\n`sudo apt upgrade`â†ã“ã„ã¤é•·ã™ã\r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nhttps://nodejs.org/en/download/package-manager/#debian-and-ubuntu-based-linux-distributions-enterprise-linux-fedora-and-snap-packages\r\n\r\nhttps://github.com/nodesource/distributions/blob/master/README.md"},{"title":"MUIã®Gridã‚’ä½¿ã£ã¦æ®‹ã‚Šã‚’åŸ‹ã‚ãŸã‚ŠçœŸã‚“ä¸­ã«ãŠã„ãŸã‚Š","link":"/posts/react_material_ui_responsive/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nViewã‚’ç›®ä¸€æ¯åºƒã’ã‚‹å ´åˆAndroidã ã¨`weight=\"1\"`ãªã®ã«ã€HTMLã«ãªã‚‹ã¨æ€¥ã«æ„å‘³ãŒã‚ã‹ã‚‰ãªããªã‚‹ã€‚  \r\nè‡ªåˆ†ç”¨ãƒ¡ãƒ¢\r\n\r\n# ç’°å¢ƒ\r\n\r\n`MUI`ã§ãã‚Œã°ã„ã„ã®ã§`Next.js`ä½¿ã†å¿…è¦ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n| ãªã¾ãˆ                        | ã‚ãŸã„     |\r\n|-------------------------------|------------|\r\n| è¨€èª                          | TypeScript |\r\n| React                         | 17         |\r\n| Next.js (å¤šåˆ†Reactã ã‘ã§ã„ã„) | 12         |\r\n| MUI                           | 5.4.0      |\r\n\r\n# æ®‹ã‚Šã‚’åŸ‹ã‚ã‚‹\r\nã“ã‚Œã ã‘ã§åŸ‹ã‚ã¦ãã‚Œã¾ã™ã€CSSä½•ã‚‚åˆ†ã‹ã‚‰ã‚“ã‹ã‚‰ãã£ãä¾¿åˆ©\r\n\r\n## æ¨ª\r\n\r\n```tsx\r\nconst Home: NextPage = () => {\r\n  return (\r\n    <Box>\r\n      <Grid container >\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.blue[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs>\r\n          <Card sx={{ backgroundColor: colors.red[100] }}>\r\n            <p>ã“ã“ã¯ç›®ä¸€æ¯ä½¿ã£ã¦ã»ã—ã„</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.blue[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n      </Grid>\r\n    </Box>\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\n![Imgur](https://imgur.com/ih47IOr.png)\r\n\r\n`xs=\"auto\"`ã‚’ä»˜ã‘ã‚‹ã“ã¨ã§å¿…è¦æœ€ä½é™ã¯ç¢ºä¿ã—ã¦ãã‚Œã¾ã™ã€‚  \r\næ®‹ã‚Šã¯`xs`ã‚’ä»˜ã‘ãŸè¦ç´ ãŒä½¿ã£ã¦ãã‚Œã¾ã™ã€‚\r\n\r\nè©³ã—ãã¯ï¼š  \r\n\r\nhttps://mui.com/components/grid/#auto-layout\r\n\r\n## ç¸¦\r\n\r\nå¤šåˆ†`height`ã®æŒ‡å®šãŒå¿…è¦ã ã¨æ€ã†\r\n\r\n```tsx\r\nconst Home: NextPage = () => {\r\n  return (\r\n    <Box>\r\n      <Grid\r\n        container\r\n        direction=\"column\"\r\n        sx={{ minHeight: \"100vh\" }}\r\n      >\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.blue[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs>\r\n          <Card sx={{\r\n            height: \"100%\",\r\n            backgroundColor: colors.yellow[100]\r\n          }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.red[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n      </Grid>\r\n    </Box>\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\n![Imgur](https://imgur.com/JBSInFU.png)\r\n\r\n\r\n# çœŸã‚“ä¸­\r\n\r\nthx!!!  \r\nhttps://stackoverflow.com/questions/50766693/how-to-center-a-component-in-mui-and-make-it-responsive\r\n\r\n## æ¨ª\r\n\r\n```tsx\r\nconst Home: NextPage = () => {\r\n  return (\r\n    <Box>\r\n      <Grid\r\n        container\r\n        direction=\"row\"\r\n        alignContent=\"center\"\r\n        justifyContent=\"center\"\r\n        sx={{ minHeight: \"100vh\" }}\r\n      >\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.blue[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.yellow[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.red[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n      </Grid>\r\n    </Box>\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\n![Imgur](https://imgur.com/PzIUYF0.png)\r\n\r\n## ç¸¦\r\n\r\n```tsx\r\nconst Home: NextPage = () => {\r\n  return (\r\n    <Box>\r\n      <Grid\r\n        container\r\n        direction=\"column\"\r\n        alignContent=\"center\"\r\n        justifyContent=\"center\"\r\n        sx={{ minHeight: \"100vh\" }}\r\n      >\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.blue[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.yellow[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n        <Grid item xs=\"auto\">\r\n          <Card sx={{ backgroundColor: colors.red[100] }}>\r\n            <p>ã“ã“ã¯æœ€ä½é™ã‚ã‚Œã°ã„ã„ã®ã‚ˆ</p>\r\n          </Card>\r\n        </Grid>\r\n\r\n      </Grid>\r\n    </Box>\r\n  )\r\n}\r\n\r\nexport default Home\r\n```\r\n\r\n![Imgur](https://imgur.com/b0aJ2Fd.png)"},{"title":"TypeScript+nuxt/contentã§ã“ã®ã‚µã‚¤ãƒˆã‚’ä½œã‚Šç›´ã—ã¦ã„ã‚‹","link":"/posts/remake_ziyuutyou/","markdown":"ã“ã“ã®å†…å®¹ã‚‚Next.jsã«ç§»è¡Œã—ãŸã®ã§é–¢ä¿‚ãªããªã‚Šã¾ã™ã€‚\r\n\r\n[Next.jsã§ç§»è¡Œã—ãŸãƒ¡ãƒ¢ã¯ã“ã¡ã‚‰](/posts/taihendattakoto_next_js_blog/)\r\n\r\n\r\n# æœ¬é¡Œ\r\n`TypeScript`+`nuxt/content`ã§ã“ã®ãƒ–ãƒ­ã‚°ã‚’ä½œã‚Šç›´ã™ã€‚  \r\nãã“ã§èº“ã„ãŸã¨ã“ã‚ãªã©ã‚’æ›¸ã„ã¦ã„ã“ã†ã¨æ€ã†ã€‚\r\n\r\n# nuxt/content ã¨ã¯\r\nãƒ–ãƒ­ã‚°ã‚’ä½œã‚‹ã¨ãã«ä½¿ãˆã‚‹ï¼ˆã¨ã„ã†ã‹ä½¿ã£ãŸï¼‰ã€‚  \r\n`content`ãƒ•ã‚©ãƒ«ãƒ€ã«ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ãŠã‘ã°ä½¿ãˆã‚‹ã€‚  \r\n\r\nä»¥ä¸‹ã¯`content/posts`ãƒ•ã‚©ãƒ«ãƒ€ã®ä¸­èº«ã‚’å–å¾—ã™ã‚‹TypeScriptã§ã™ã€‚\r\n```typescript\r\n// è¨˜äº‹ä¸€è¦§ã‚’å–ã‚Šå‡ºã™\r\nasync asyncData({ $content, params }) {\r\n  const blogItems = await $content(`posts`)\r\n    .sortBy(\"created_at\", \"desc\") // æŠ•ç¨¿æ—¥æ™‚é †ã«ä¸¦ã³æ›¿ãˆã‚‹\r\n    .skip((parseInt(params.id) - 1) * 10) // æŒ‡å®šã—ãŸåˆ†é£›ã°ã™ã€‚ä»Šå›ã¯è¡¨ç¤ºãƒšãƒ¼ã‚¸ã‹ã‚‰ï¼‘å¼•ã„ã¦ï¼‘ï¼æ›ã‘ãŸç­”ãˆåˆ†é£›ã°ã™ã€‚ï¼ˆä¾‹:2ãƒšãƒ¼ã‚¸ç›®ã®å ´åˆã¯(2-1)*10 = 10è¨˜äº‹é£›ã°ã™ï¼‰\r\n    .limit(10) // 10è¨˜äº‹å–å¾—ã™ã‚‹\r\n    .fetch();\r\n  return { blogItems };\r\n},\r\n```\r\n\r\nã“ã‚Œã§`processmd`ã‚’ä½¿ã†ã“ã¨ã¯ãªããªã‚Šã¾ã—ãŸã€‚\r\n\r\n# Vuexã£ã¦ã®ã‚‚ä½¿ã£ãŸã€‚\r\nVue.jsï¼ˆã“ã‚Œã¯Nuxt.jsã ã‘ã©ï¼‰å…¨ä½“ã§ç®¡ç†ã—ãŸã„å€¤ã‚’æ‰±ã†å ´åˆã¯`Vuex`ã£ã¦ã®ã‚’ä½¿ã†ãã†ã§ã™ã‚ˆã€‚  \r\nã“ã®ã‚µã‚¤ãƒˆã§ã¯ã©ã“ã§ä½¿ã£ã¦ã„ã‚‹ã‹ã¨è¨€ã†ã¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´ã™ã‚‹ã¨ãã«ä½¿ã£ã¦ã„ã¾ã™ã€‚  \r\nä»Šã¾ã§ã¯`document.getElementById`ã§ç„¡ç†ã‚„ã‚Šå¤‰æ›´ã—ã¦ãŸã®ã§ãƒã‚·ã«ãªã£ãŸã€‚  \r\n\r\nã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¶…ãˆã¦å€¤ã‚’ç®¡ç†ã—ãŸã„ã¨ãã«ä½¿ã†ã‚ˆã†ã§ã™ã€‚\r\n\r\nä»¥ä¸‹ã¯ã‚¿ã‚¤ãƒˆãƒ«ã‚’å…¥ã‚Œã¦ãŠãVuexã‚¹ãƒˆã‚¢ä¾‹(`store/index.js`)ã€‚  \r\nã“ã“ã¯TypeScriptã§ã¯ãªã„\r\n```js\r\n// Vueå…¨ä½“ã§ç®¡ç†ã—ãŸã„å€¤ã€‚ä»Šå›ã¯ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã®ãƒ†ã‚­ã‚¹ãƒˆ\r\nexport const state = () => ({\r\n    barTitle: \"ãŸãã•ã‚“ã®è‡ªç”±å¸³\"\r\n})\r\n\r\n// Vuexã®å€¤ã¯ã“ã“ã§å¤‰æ›´ã™ã‚‹ã€‚\r\nexport const mutations = {\r\n    setBarTitle(state, title) {\r\n        state.barTitle = title\r\n    }\r\n}\r\n```\r\n  \r\nVuexã‚¹ãƒˆã‚¢ã‹ã‚‰å€¤ã‚’å–å¾—ã™ã‚‹ä¾‹ã€‚`this.$store.state.barTitle`ã£ã¦ã®ãŒãã‚Œï¼ˆãªã‚“ã‹WARNãŒæ¶ˆãˆãªã„ã‘ã©ï¼‰\r\n```vue\r\n<!-- ã‚¿ã‚¤ãƒˆãƒ« -->\r\n<v-toolbar-title v-show=\"!drawer\" id=\"title\" v-text=\"this.$store.state.barTitle\" />\r\n```\r\n\r\nå…¥ã‚Œã‚‹ã®ã¯ã“ã†ã€‚ä»¥ä¸‹ä¾‹\r\n```typescript\r\n// Vuexã¦ã‚„ã¤ã§ãƒãƒ¼ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’å¤‰æ›´ã—ã¦ã„ã‚‹ã€‚\r\nthis.$store.commit(\"setBarTitle\", \"è¨˜äº‹ä¸€è¦§\");\r\n```\r\n\r\n# å¤§å¤‰ã ã£ãŸã“ã¨\r\n\r\n## TypeScriptã‚ã‹ã‚‰ã‚“å•é¡Œ\r\nè¨˜äº‹è¡¨ç¤ºãƒšãƒ¼ã‚¸ã§ã‚¿ã‚¤ãƒˆãƒ«ã‚’å–å¾—ã—ã‚ˆã†ã¨ã—ã¦ã€ä»¥ä¸‹ã®ã‚ˆã†ã«æ‰“ã¤ã¨æ€’ã‚‰ã‚Œã¾ã™ã€‚  \r\nè§£æ±ºæ–¹æ³•ãŒã‚ã‚Šãã†ãªæ°—ãŒã—ã¾ã™ãŒã€ã¨ã‚Šã‚ãˆãšã¯`this as any`ã§é»™ã‚‰ã›ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n```typescript\r\n// ã‚¨ãƒ©ãƒ¼ã§ã¡ã‚ƒã†ã‹ã‚‰anyã§ã€‚è§£æ±ºæ–¹æ³•ã‚ã‚‹ï¼Ÿ\r\nconst title = (this as any).article.title;\r\n```\r\n\r\n## created_at vs createdAt å•é¡Œ\r\nãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®å…ˆé ­ã«ã€ã‚ã–ã‚ã–`created_at`ã£ã¦æ›¸ã„ã¦ä»Šã™ãŒã€å®Ÿã¯`nuxt/content`å´ã§ã‚‚`createdAt`ã£ã¦ã®ã‚’ç”¨æ„ã—ã¦ãã‚Œã¦ã¾ã—ãŸã€‚  \r\nãŸã ãŠã¾ç’°ã®ã›ã„ã‹ã†ã¾ãè¡Œã‹ãªã‹ã£ãŸã®ã§å¼•ãç¶šã`created_at`ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã‚ã¨ã¯ã¾ãŸæ€ã„å‡ºã—ãŸã‚‰æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n# ã‚ˆã‹ã£ãŸã¨ã“ã‚\r\n\r\n## æ›´æ–°ãŒæ—©ã„\r\næ›´æ–°ãŒæ—©ã„ã§ã™ã€‚ã™ãã«åæ˜ ã•ã‚Œã¾ã™ã€‚\r\n\r\n```\r\ni Updated .\\content/posts\\remake_ziyuutyou.md                                                           @nuxt/content 20:29:55\r\ni Updated .\\content/posts\\remake_ziyuutyou.md                                                           @nuxt/content 20:29:59\r\ni Updated .\\content/posts\\remake_ziyuutyou.md                                                           @nuxt/content 20:30:14\r\n```\r\n\r\n# HTMLãŒæ›¸ã‘ã‚‹\r\n\r\n<span style=\"color:red;box-shadow:5px\">htmlãŒæ›¸ã‘ã‚‹</span>  \r\n<span style=\"color:blue\">ä»¥ä¸‹ã®ã‚ˆã†ã«HTMLã‚’æ›¸ã„ã¦ã‚‚ã¡ã‚ƒã‚“ã¨èª­ã¿è¾¼ã‚“ã§ãã‚Œã¾ã™</span>\r\n\r\n```html\r\n<span style=\"color:red\">HTMLã‚’ç†è§£ã§ãã‚‹</span>\r\n```\r\n\r\n<span style=\"border: solid 2px green;padding:2px;border-radius:10px\">å›²ã„æ–‡å­—ã¯ã“ã‚“ãªæ„Ÿã˜ã«</span>\r\n\r\n```html\r\n<span style=\"border: solid 2px skyblue;padding:2px;border-radius:10px\">CSSã‚‚ç†è§£ã—ã¦ãã‚Œã‚‹</span>\r\n```\r\n\r\n\r\nä»¥ä¸Šã§ã™ã€‚ã¾ãŸãªã‚“ã‹ã‚ã‚Œã°æ›¸ãã¾ã™"},{"title":"Google Search Consoleã«ã“ã®ã‚µã‚¤ãƒˆã®ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã—ã¦ã‚‚ã‚‰ãŠã†","link":"/posts/search_console/","markdown":"\r\nã¡ã‚‡ã£ã¨å‰ã®è¨˜æ†¶ã‹ã‚‰æ›¸ãã¾ã™\r\n\r\n# æœ¬é¡Œ\r\nGoogleã®æ¤œç´¢ã«ã“ã®ã‚µã‚¤ãƒˆã‚’è¼‰ã›ã¦ã»ã—ã„ã€‚  \r\nãã®ãŸã‚ã«`Google Search Console`ã‚’ä½¿ã†ã¨ã„ã„ã‚‰ã—ã„\r\n\r\n# Google Search Console ã¨ã¯\r\n- Googleæ¤œç´¢ã§ã‚µã‚¤ãƒˆã‚’ç™ºè¦‹ã§ãã‚‹ã‹ã©ã†ã‹\r\n    - ã‚¯ãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ŸGoogleBotï¼Ÿã‚’å¼¾ã„ã¦ãªã„ã‹ã¨ã‹\r\n- ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã‚’ç™»éŒ²ã—ã¦æ˜ç¤ºçš„ã«ã‚µã‚¤ãƒˆã‚’ç™»éŒ²ã—ã¦ã‚‚ã‚‰ã†ã¨ã‹\r\n    - ä»Šå›ã¯ã“ã‚Œ\r\n\r\n# Google Search Consoleã«ç™»éŒ²ã™ã‚‹\r\n\r\nhttps://search.google.com/search-console/welcome?hl=ja\r\n\r\nã‚’é–‹ã„ã¦ã€`URL ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹`ã®æ–¹ã«URLã‚’å…¥åŠ›ã—ã¾ã™ã€‚\r\n\r\nã§ã€æœ¬æ¥ã¯èªè¨¼ã®ãŸã‚ã«ã„ãã¤ã‹ä½œæ¥­ãŒå¿…è¦ãã†ã§ã™ãŒã€**ãªã‚“ã‹Google Domainsã§ãƒ‰ãƒ¡ã‚¤ãƒ³ã‚’å–ã£ãŸãŠã‹ã’ã‹è‡ªå‹•ã§èªè¨¼ã•ã‚Œã¾ã—ãŸã€‚**\r\n\r\n![Imgur](https://imgur.com/DFjFW8r.png)\r\n\r\n# ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã‚’æ›¸ãå‡ºã™\r\n## Nuxt.js ã§ã®ä½œæ¥­\r\nå‚è€ƒã«ã—ã¾ã—ãŸï¼šhttps://ninebolt.net/articles/nuxt-content-sitemap/\r\n\r\n\r\n(å‰æï¼š`nuxt/content`ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹ã“ã¨)\r\n\r\nã¾ãšã¯`@nuxt/sitemap`ã‚’å…¥ã‚Œã¾ã™\r\n\r\n```\r\nnpm install @nuxtjs/sitemap\r\n```\r\n\r\nãã—ãŸã‚‰ã€`nuxt.config.js`ã‚’é–‹ã„ã¦ã€\r\n\r\n\r\n`modules`ã®é…åˆ—ã«è¶³ã—ã¾ã™ã€‚\r\n```js\r\n  /*\r\n  ** Nuxt.js modules\r\n  */\r\n  modules: [\r\n    '@nuxt/content',\r\n    '@nuxtjs/sitemap'\r\n  ],\r\n\r\n```\r\n\r\nãã†ã—ãŸã‚‰ã€ãã®ä¸‹ã®æ–¹ã«ä»¥ä¸‹ã®ã‚ˆã†ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã™ã€‚  \r\nç§ã®å ´åˆã¯è¨˜äº‹ãŒ`posts`ã«å…¥ã£ã¦ã„ã¾ã™ãŒã€ã“ã“ã¯å„è‡ªæ›¸ãæ›ãˆã¦ãã ã•ã„ã€‚\r\n\r\n```js\r\n  /**\r\n   * ã‚µã‚¤ãƒˆãƒãƒƒãƒ—æ›¸ãå‡ºã—\r\n   */\r\n  sitemap: {\r\n    hostname: 'https://takusan.negitoro.dev',\r\n    routes: async () => {\r\n      const { $content } = require('@nuxt/content')\r\n      const posts = await $content('posts').only(['path']).fetch()\r\n      return posts.map(post => post.path)      \r\n    }\r\n  }\r\n```\r\n\r\nå…¨éƒ¨ãã£ã¤ã‘ã‚‹ã¨ã“ã‚“ãªæ„Ÿã˜\r\n\r\n```js\r\nexport default {\r\n  \r\n  // --- çœç•¥ ---\r\n  \r\n  /*\r\n  ** Nuxt.js modules\r\n  */\r\n  modules: [\r\n    '@nuxtjs/pwa',\r\n    '@nuxtjs/markdownit',\r\n    '@nuxt/content',\r\n    '@nuxtjs/sitemap'\r\n  ],\r\n\r\n  // --- çœç•¥ ---\r\n  \r\n  /**\r\n   * ã‚µã‚¤ãƒˆãƒãƒƒãƒ—æ›¸ãå‡ºã—\r\n   */\r\n  sitemap: {\r\n    hostname: 'https://takusan.negitoro.dev',\r\n    routes: async () => {\r\n      const { $content } = require('@nuxt/content')\r\n      const posts = await $content('posts').only(['path']).fetch()\r\n      return posts.map(post => post.path)      \r\n    }\r\n  }\r\n}\r\n```\r\n\r\næ›¸ãè¶³ã›ãŸã‚‰ã€`localhost:ãªã‚“ã¨ã‹/sitemap.xml`ã¨ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚¢ãƒ‰ãƒ¬ã‚¹æ¬„ã¸å…¥åŠ›ã—ã¦ã¿ã‚‹ã¨ã€xmlãƒ•ã‚¡ã‚¤ãƒ«ã¿ãŸã„ãªã®ãŒå‡ºã¦ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã“ã‚“ãªã®â†“\r\n\r\n```xml\r\n<urlset xmlns=\"http://www.sitemaps.org/schemas/sitemap/0.9\" xmlns:news=\"http://www.google.com/schemas/sitemap-news/0.9\" xmlns:xhtml=\"http://www.w3.org/1999/xhtml\" xmlns:mobile=\"http://www.google.com/schemas/sitemap-mobile/1.0\" xmlns:image=\"http://www.google.com/schemas/sitemap-image/1.1\" xmlns:video=\"http://www.google.com/schemas/sitemap-video/1.1\">\r\n<url>\r\n<loc>https://takusan.negitoro.dev/posts/search_console</loc>\r\n</url>\r\n<url>\r\n```\r\n\r\nç¢ºèªã§ããŸã‚‰ã€`nuxt generate`ã—ã¦ã€Netlifyãªã‚ŠGitHub Pagesãªã‚Šã«å…¬é–‹ã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n(`nuxt generete`ã™ã‚‹ã¨å‹æ‰‹ã«`/sitemap.xml`ã‚‚ç”Ÿæˆã•ã‚Œã‚‹ãã†ã§ã™)\r\n\r\n## Google Search Console ã§ã®ä½œæ¥­\r\n\r\nãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã®ä¸­ã‹ã‚‰`ã‚µã‚¤ãƒˆãƒãƒƒãƒ—`ã‚’é¸ã‚“ã§ã€`æ–°ã—ã„ã‚µã‚¤ãƒˆãƒãƒƒãƒ—ã®è¿½åŠ `ã«URLã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/szoUpIE.png)\r\n\r\nã‚ã¨ã¯æ•°æ—¥å¾…ã¦ã°ã„ã„ã‚‰ã—ã„ã€‚\r\n\r\n# URL æ¤œæŸ» # ã¨ã¯\r\nURLã‚’å…¥ã‚Œã‚‹ã¨oogleæ¤œç´¢ã§è¦‹ã¤ã‘ã‚‹ã“ã¨ãŒã§ãã‚‹ã‹(ç™»éŒ²æ¸ˆã¿ã‹ã©ã†ã‹)ã‚’ç¢ºèªã§ãã‚‹æ©Ÿèƒ½ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/7PXFURn.png)\r\n\r\nã§ã‚‚ãªã‚“ã‹è¦‹ã¤ã‹ã‚‰ãªã‹ã£ãŸ\r\n\r\n# site:ã‚µã‚¤ãƒˆã®URL ã§ã‚‚ä»£æ›¿ã§ãã‚‹\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«\r\n\r\n![Imgur](https://imgur.com/sr3hFm3.png)\r\n\r\n# ãªã‚“ã‹ãƒªãƒ³ã‚¯ãŒãŠã‹ã—ã„\r\n\r\n`URL æ¤œæŸ»`ã®ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’çœºã‚ã¦ã¿ã‚‹ã¨ã€ãªã‚“ã‹URLãŒé•ã†ã‚“ã§ã™ã‚ˆã­\r\n\r\n![Imgur](https://imgur.com/N7eo5oE.png)\r\n\r\nã“ã‚Œã©ã†ã‚„ã‚‰`<link data-n-head=\"ssr\" rel=\"canonical\" href=\"\">`ãŒæ‚ªã•ã‚’ã—ã¦ã„ã‚‹ã£ã½ã„ã§ã™ã­ã€‚  \r\n\r\nã“ã‚Œãªã‚“ã‹ç›¸å¯¾ãƒ‘ã‚¹ãŒå‹æ‰‹ã«å…¥ã£ã¦ã‚‹ï¼ˆç§ãŒçŸ¥ã‚‰ã‚“ã†ã¡ã«ã‚„ã£ã¦ãŸï¼Ÿï¼‰ã‚“ã§ã™ãŒã€ã“ã‚Œçµ¶å¯¾ãƒ‘ã‚¹å…¥ã‚Œãªã„ã¨ãŠã‹ã—ããªã‚‹ã£ã½ã„ã§ã™ã­ã€‚\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã¡ã‚ƒã‚“ã¨æŒ‡å®šã™ã‚‹ã‚ˆã†ã«ã€`head{ }`ã‚’å¤‰æ›´ã—ã¦ãã¾ã—ãŸã€‚\r\n\r\n```js\r\n  // ã‚¿ã‚¤ãƒˆãƒ«å¤‰æ›´ã«ä½¿ã†\r\n  head() {\r\n    // ã‚¨ãƒ©ãƒ¼ã§ã¡ã‚ƒã†ã‹ã‚‰anyã§ã€‚è§£æ±ºæ–¹æ³•ã‚ã‚‹ï¼Ÿ\r\n    const title = (this as any).article.title;\r\n    const url = `https://takusan.negitoro.dev/posts/${(this as any).article.slug}`;\r\n    return {\r\n      title: title,\r\n      meta: [\r\n        { hid: \"og:url\", property: \"og:url\", content: url },\r\n        { hid: \"og:title\", property: \"og:title\", content: title },\r\n      ],\r\n      link: [{ rel: \"canonical\", href: url }],\r\n    };\r\n  },\r\n```\r\n\r\nã¨ã“ã‚ã§`as any`ç›´ã—ãŸã„ã‚“ã ã‘ã©ã€TypeScriptã®`class`ã¨`interface`ã©ã£ã¡ãŒã„ã„ã§ã™ã‹ï¼Ÿ  \r\nã¨ã‹èª¿ã¹ã¦ãŸã‚‰`type`ã¨ã‹ã„ã†æ¦‚å¿µã‚‚ã‚ã£ã¦ã‚ˆãã‚ã‹ã‚‰ãªããªã£ãŸã€‚"},{"title":"SMBCãƒ‡ãƒ“ãƒƒãƒˆã§åˆ©ç”¨åˆ¶é™å¯¾è±¡å–å¼•ã«ãªã£ãŸã®ã§é›»è©±ã§è§£é™¤ã—ã¦ã‚‚ã‚‰ã£ãŸ","link":"/posts/smbc_debit_error/","markdown":"\r\nã‚¿ã‚¤ãƒˆãƒ«é€šã‚Šã§ã€3Dã‚»ã‚­ãƒ¥ã‚¢ã™ã‚‰é€šã£ãŸã®ã«ã€**åˆ©ç”¨åˆ¶é™å¯¾è±¡å–å¼•**ã«åˆ†é¡ã•ã‚Œæ±ºæ¸ˆã§ããªã‹ã£ãŸæ™‚ã®è©±ã€‚  \r\né›»è©±ã™ã‚‹ã¨è§£é™¤ã—ã¦ã‚‚ã‚‰ãˆã¾ã™ã€‚ç¿Œæ—¥ã«ã¯æ‰•ãˆã‚‹ã‚ˆã†ã«ã—ã¦ãã‚Œã‚‹ã‚‰ã—ã„ã®ã§æ‰•ãˆãŸã‚‰è¿½è¨˜ã—ã¾ã™ã€‚  \r\n\r\nã¡ãªã¿ã«ã‚«ãƒ¼ãƒ‰ã®è£ã«æ›¸ã„ã¦ã‚ã‚‹ãªã‚“ã¨ã‹ãƒ‡ã‚¹ã‚¯ã«ã¯ç¹‹ãŒã‚‰ãªã£ãŸã§ã™ï¼ˆäºˆç´„ã‚’å‹§ã‚ã¦ãã‚‹ï¼‰ã€‚\r\n\r\nè§£é™¤ã™ã‚‹ãŸã‚ã«ã¯å¤šåˆ†é›»è©±ã™ã‚‹ã—ã‹ãªã„ã®ã§ã™ãŒã€  \r\né›»è©±ã‚’ã“ã£ã¡ãŒã‹ã‘ã‚‹è¨³ã§ã¯ãªãã€äºˆã‚äºˆç´„ã—ã¦ã‹ã‘ã¦ãã¦è²°ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\nãŒã€é›»è©±äºˆç´„ãƒšãƒ¼ã‚¸ãªã®ã§ã™ãŒã€ã©ã†ã‚„ã‚‰æ™®é€šã«æ¤œç´¢ã—ã¦ãƒªãƒ³ã‚¯ã‚’è¾¿ã£ã¦ã„ãã ã‘ã˜ã‚ƒè¦‹ã¤ã‹ã‚‰ãªã„ã‚‰ã—ãï¼ˆã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’ã¤ã‘ã‚‹ã¨é›»è©±äºˆç´„ã®ãƒœã‚¿ãƒ³ãŒå‡ºã‚‹ã£ã½ã„ï¼‰ã€URLã‚’æ•™ãˆã¦è²°ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚  \r\nï¼ˆæµçŸ³ã«ã“ã“ã«URLã‚’è²¼ã‚‹ã‚ã‘ã«ã¯è¡Œã‹ãªã„ã®ã§...ï¼‰\r\n\r\nã§ã€URLã§ã™ãŒã€ãƒ‡ãƒ“ãƒƒãƒˆã‚«ãƒ¼ãƒ‰è£é¢ã®ãªã‚“ã¨ã‹ãƒ‡ã‚¹ã‚¯ã«ã‹ã‘ã¦ã€éŸ³å£°ã‚¬ã‚¤ãƒ‰ã«å¾“ã£ã¦ï¼ˆãŠãã‚‰ãï¼‰`2`ï¼Ÿã‚’æŠ¼ã—ã¾ã™  \r\nãã®å¾ŒãŠæ±ºã¾ã‚Šã®æ··ã¿åˆã£ã¦ã„ã¾ã™ã€äºˆç´„ã™ã‚‹å ´åˆã¯ï½ã£ã¦æ¡ˆå†…ã•ã‚Œã‚‹ã§ã€`1`ï¼Ÿã‚’æŠ¼ã—ã¾ã™  \r\n\r\nã™ã‚‹ã¨æºå¸¯é›»è©±ã®SMSã«ãƒªãƒ³ã‚¯ãŒæ¥ã‚‹ï¼ˆã“ã‚ŒãŒã‚¯ã‚¨ãƒªãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ä»˜ãã®URLï¼‰ã®ã§ã€å¾Œã¯é›»è©±äºˆç´„ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦äºˆç´„ã—ã¦é›»è©±ã‚’å¾…ã¡ã¾ã™ã€‚  \r\nç§ã®å ´åˆã¯ãŠæ˜¼ã”ã‚ã ã£ãŸã®ã§å½“æ—¥ã®æ¬¡ã®æ™‚é–“å¸¯ã¨ã‹ã§å¯¾å¿œã—ã¦ãã‚Œã¾ã—ãŸã€‚\r\n\r\né›»è©±ã¯ã‚ã£ã•ã‚Šã§ã™ãã«çµ‚ã‚ã‚Šã¾ã—ãŸã€‚\r\n\r\næ±ºæ¸ˆã§ããŸã‚‰è¿½è¨˜ã—ã¾ã™ã€‚ä»¥ä¸Šã§ã™ã€‚\r\n\r\nã§ãã¾ã—ãŸã€‚ã‚‚ã—ã‹ã—ãŸã‚‰é›»è©±ã—ã¦ä¸€æ—¥çµŒãŸãšã«æ±ºæ¸ˆã§ãã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚"},{"title":"å¤ä¼‘ã¿ä¼ç”»ã€€Mi 11 Lite 5G ã®èµ¤å¤–ç·šé€ä¿¡æ©Ÿèƒ½ã‚’ä½¿ã£ã¦ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆã‚’æ“ä½œ","link":"/posts/summer_vacation_android_ir/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nãƒã‚¸ãƒ©ãƒ– -Making*Lovers- æ”»ç•¥ã—ã¾ã—ãŸã€‚  \r\næ¡œå­ã¡ã‚ƒã‚“ãŒå¯æ„›ã‹ã£ãŸã§ã™ã€‚ç„¡å°ç‰ˆã‚‚ã‚„ã‚ŠãŸã„ã¨æ€ã„ã¾ã™ã€‚    \r\n![Imgur](https://imgur.com/Dm9TXuI.png)ã€€ã€€\r\n\r\nã‚ã¨åˆ¥ã«ã“ã®ã‚²ãƒ¼ãƒ ã«é™ã£ãŸè©±ã˜ã‚ƒãªã„ã‘ã©ä»–ã®ãƒ’ãƒ­ã‚¤ãƒ³æ”»ç•¥ã™ã‚‹ã®ã—ã‚“ã©ããªã‚‹ã‚„ã¤ã‚ã‹ã‚‹äººã„ã¾ã™ã‹ã­ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/ZqkR7Qw.png)\r\n\r\nå¥½ããªå¨˜ã‹ã‚‰ã‚„ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ãŒãŠã™ã™ã‚ã¯åˆç©‚ã•ã‚“ã‚’æœ€å¾Œã«ã‚„ã‚‹ã¨ã„ã„ã‹ã‚‚ï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\nãªã‚“ã‹BLUå‡ºæ¥ã‚‹ã‚‰ã—ã„ã‹ã‚‰è²·ã£ãŸ`Xiaomi Mi 11 Lite 5G`ã€ã“ã®å­`Mi Remote`ã£ã¦ã„ã†ãƒ—ãƒªã‚¤ãƒ³ã‚¢ãƒ—ãƒªã§èµ¤å¤–ç·šã‚’é€ä¿¡ã—ã¦å®¶é›»æ“ä½œãŒã§ãã‚‹ã‚“ã§ã™ã­ã€‚  \r\nã§ã‚‚ã“ã®ã‚¢ãƒ—ãƒªã€ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆãŒä½•æ•…ã‹ç”¨æ„ã•ã‚Œã¦ã¾ã›ã‚“ã€‚  \r\n\r\nèµ¤å¤–ç·šé€šä¿¡ã€æ‡ã‹ã—ã„éŸ¿ããªã‚“ã§ã™ã‹ã­ï¼Ÿã€‚ã‚¹ãƒãƒ›ä¸–ä»£ã ã‹ã‚‰ã‚ã‹ã‚‰ã‚“  \r\n(iãƒ¢ãƒ¼ãƒ‰ï¼Ÿã€ç€ã›æ›¿ãˆãƒ„ãƒ¼ãƒ«ï¼Ÿã€ãƒ•ãƒ«ãƒ–ãƒ©ã‚¦ã‚¶ï¼Ÿã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯æš—è¨¼ç•ªå·ï¼Ÿã€ã‚»ãƒ³ã‚¿ãƒ¼å•ã„åˆã‚ã›ï¼Ÿã€å¯Œå£«é€šã®ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ãƒ¢ãƒ¼ãƒ‰ï¼Ÿã€ãƒ‘ã‚±ãƒ»ãƒ›ãƒ¼ãƒ€ã‚¤ï¼Ÿ)\r\n\r\n# MIUIåˆä½“é¨“\r\nãªã‚“ã‹USBãƒ‡ãƒãƒƒã‚°ã¨ã¯åˆ¥ã«USBçµŒç”±ã®ã‚¢ãƒ—ãƒªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã®è¨­å®šãŒã‚ã£ã¦ã€ã“ã‚Œ`SIMã‚«ãƒ¼ãƒ‰`åˆºã•ãªã„ã¨ONã«å‡ºæ¥ãªã„ã®ã§æ³¨æ„ã€‚\r\n\r\n# èµ¤å¤–ç·šé€ä¿¡ã™ã‚‹ãŸã‚ã«ã¯\r\n- èµ¤å¤–ç·šé€ä¿¡ãŒã§ãã¦ã€`ConsumerIrManager#hasIrEmitter()`ãŒ`true`ã‚’è¿”ã™ç«¯æœ«\r\n    - ä»Šå›ã¯`Xiaomi Mi 11 Lite 5G`ã‚’åˆ©ç”¨ã€‚33Wå……é›»ã‚ã£ã¡ã‚ƒæ—©ãã¦æ€–ã„ã¾ã§ã‚ã‚‹ã€‚\r\n- èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–å¾—å‡ºæ¥ã‚‹ç’°å¢ƒ\r\n    - ä»Šå›ã¯ãƒ©ã‚ºãƒ‘ã‚¤ã¨èµ¤å¤–ç·šå—ä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã§å–å¾—\r\n    - Nature Remo(ã‚¨ã‚¢ã‚³ãƒ³ã‚„ç…§æ˜ã‚’å¤–å‡ºå…ˆã‹ã‚‰ONã«å‡ºæ¥ã‚‹ã‚„ã¤)ã‚’æŒã£ã¦ã„ã‚‹å ´åˆã¯ã„ã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„\r\n        - å¾Œè¿°ã€‚ãªãŠç§ã¯æŒã£ã¦ã„ãªã„ã€‚èª°ã‹ç¢ºã‹ã‚ã¦ã¿ã¦ãã‚Œã€‚\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ               | ã‚ãŸã„                    |\r\n|----------------------|---------------------------|\r\n| ç«¯æœ«                 | Xiaomi Mi 11 Lite 5G      |\r\n| è¨€èª                 | Kotlin                    |\r\n| UI                   | Jetpack Compose           |\r\n| Raspberry Pi         | 2 Model B                 |\r\n| èµ¤å¤–ç·šå—ä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« | OSRB38C9AA (ç§‹æœˆã§è²·ãˆãŸ) |\r\n\r\nUIä½œã‚‹ã®ã ã‚‹ã„ã®ã§ã€Jetpack Composeã‚’ä½¿ã„ã¾ã™ã€‚\r\n\r\n# èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³å–å¾—ç·¨\r\n\r\nä»Šå›ã¯`NEC`ã®ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆã®èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–å¾—ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚NECã£ã¦æ˜”ã‚²ãƒ¼ãƒ ä½œã£ã¦ãŸã£ã¦ãƒã‚¸ï¼Ÿ  \r\nRaspberry Piã¨èµ¤å¤–ç·šå—ä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’GPIOã§æ¥ç¶šã—ã¦å–å¾—ã™ã‚‹ã‚“ã§ã™ãŒã€æ®‹å¿µãªãŒã‚‰ã“ã®è¾ºã¯è©³ã—ããªã„ã®ã§å…ˆäººã«ä¹—ã£ã‹ã‚Šã¾ã™ã€‚ã“ã®è¾ºè©³ã—ããªãã¦ã‚‚å‡ºæ¥ã‚‹ã®ã§å…ˆäººGJ  \r\n\r\n## ã©ã‚“ãªãƒ‡ãƒ¼ã‚¿ï¼Ÿ\r\nã“ã‚“ãªæ„Ÿã˜ã®é…åˆ—ã€‚æœ¬å½“ã¯ã‚‚ã£ã¨é•·ã„ã€‚\r\n\r\n```json\r\n[\r\n    8925, 4540, 514, 626, 514,\r\n]\r\n```\r\n\r\n## ãƒ©ã‚ºãƒ‘ã‚¤ã¨ã‹æŒã£ã¦ãªã„ã‚ˆ\r\nèµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ãŒæ‰‹ã«å…¥ã‚Œã°ã„ã„ã®ã§ã€`Nature Remo`ã‚’ãŠæŒã¡ã®æ–¹ã¯ã€`Nature Remo èµ¤å¤–ç·šãƒ‡ãƒ¼ã‚¿`ã¨ã‹ã§èª¿ã¹ã‚‹ã¨ãã‚Œã£ã½ã„ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–å¾—ã§ãã‚‹ãã†ã§ã™ã‚ˆï¼ˆãã‚‚ãã‚‚æŒã£ã¦ãŸã‚‰ã“ã‚“ãªäº‹ã™ã‚‹å¿…è¦ã™ã‚‰ãªã„ã‘ã©ãªï¼‰\r\n\r\n## Raspberry Pi ã« èµ¤å¤–ç·šå—ä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ« ã‚’æ¥ç¶šã™ã‚‹\r\nå…ˆäººã«ä¹—ã£ã‹ã‚Šã¾ã™ã€‚ãƒ©ã‚ºãƒ‘ã‚¤ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã¯å„è‡ªã€‚ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¤ãªã„ã§åˆæœŸè¨­å®šçµ‚ã‚ã‚‰ã›ã¦ãŠã„ã¦ã­ã€‚  \r\n\r\nhttps://qiita.com/takjg/items/e6b8af53421be54b62c9#%E8%B5%A4%E5%A4%96%E7%B7%9A%E3%82%92%E5%8F%97%E4%BF%A1%E3%81%99%E3%82%8B%E5%9B%9E%E8%B7%AF\r\n\r\nå—å…‰éƒ¨ã‚’æ­£é¢ã«ã—ãŸå ´åˆã€å³ã‹ã‚‰ã€Œ3.3Vã€ã€Œã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã€ã€Œãƒ‡ãƒ¼ã‚¿ã€ç·šã‚’ã¤ãªãã¾ã™ã€‚\r\n\r\n```\r\n+-+\r\n|â—|\r\n+-+\r\n|||\r\n\r\n321\r\n```\r\n\r\n```\r\n3. ãƒ‡ãƒ¼ã‚¿ç·š     GPIO 18 (ãƒ”ãƒ³ç•ªå·12)\r\n2. ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰   ãƒ”ãƒ³ç•ªå· 9 (GNDãªã‚‰ã©ã“ã§ã‚‚ãŠï½‹)\r\n1. 3.3V        ãƒ”ãƒ³ç•ªå· 1 (3.3Vãªã‚‰ã©ã“ã§ã‚‚ãŠï½‹)\r\n```\r\n\r\nä»¥ä¸‹çµç·šä¾‹ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/jmBtlwx.png)\r\n\r\n## Raspberry Piã«SSHæ¥ç¶šã™ã‚‹\r\nSSHæ¥ç¶šã£ã¦ã®ã¯ãƒ©ã‚ºãƒ‘ã‚¤ã«ã‚ã‚‹ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ï¼ˆWindowsã§ã„ã†ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼‰ã‚’ä»–PCã‹ã‚‰æ“ä½œã™ã‚‹ã¨ãã«ä½¿ã†ã‚„ã¤ã§ã™ã€‚ãƒªãƒ¢ãƒ¼ãƒˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã§ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆæ“ä½œã—ã¦ã‚‹ã¿ãŸã„ãªæ„Ÿã˜ã ã¨æ€ã†ã€‚\r\n\r\nRaspberry Piã«ãƒªãƒ¢ãƒ¼ãƒˆã§å…¥ã‚Šã¾ã™ã€‚åˆ¥ã«ãƒ©ã‚ºãƒ‘ã‚¤ã«ã¤ãªã„ã ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¨ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã§æ“ä½œã—ã¦ã‚‚ã„ã„ã‚“ã ã‘ã©ã€èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¯è‰¦ï¼ˆé–‹ç™ºç’°å¢ƒãŒã‚ã‚‹PCï¼‰ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹ã®ãŒé¢å€’ãªã®ã§ãƒªãƒ¢ãƒ¼ãƒˆã§å…¥ã‚Šã¾ã™ã€‚  \r\nã¨ã“ã‚ã§æ¯è‰¦ã£ã¦æ­»èªï¼Ÿ\r\n\r\nãªã‚“ã‹æœ€è¿‘ã¯ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãªã—ã§ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ä½œã£ã¦ãƒ©ã‚ºãƒ‘ã‚¤ã¨æœ‰ç·šLANã§ç¹‹ã’ã°åˆå›èµ·å‹•ã‹ã‚‰SSHã«å…¥ã‚Œã‚‹ãã†ã§ã™ã­ï¼Ÿ\r\n\r\nSSHã®æœ‰åŠ¹åŒ–ã¯çœç•¥ã•ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚ã”ã‚ã‚“ã­ã€‚`TeraTerm`ã‹`PowerShellã®ssh`ã§ãƒ©ã‚ºãƒ‘ã‚¤ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ç”»é¢ãŒå‡ºã‚‹ã¨ã“ã‚ã¾ã§ç”¨æ„ã—ã¦ãŠã„ã¦ãã ã•ã„ã€‚\r\n\r\nWi-Fiã®å ´åˆã‚‚LANã®å ´åˆã‚‚`mDNS`ï¼Ÿã®ãŠã‹ã’ã§ãƒ›ã‚¹ãƒˆã®æ¬„ã«`pi@raspberrypi.local`ã£ã¦å…¥ã‚Œã‚Œã°æ¥ç¶šã§ãã¾ã™ã€‚å›ºå®šIPã«ã—ã¦ã„ãªã„å ´åˆã§ã‚‚ã‚ã–ã‚ã–èª¿ã¹ã«è¡Œã‹ãªãã¦ã„ã„ã®ã§ã¨ã¦ã‚‚ä¾¿åˆ©ã€‚\r\n\r\nã¡ãªã¿ã«ä»¥ä¸‹ã®ç”»åƒã¯é–¢ä¿‚ãªã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/3sOhTFh.png)\r\n\r\n## èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ‰‹ã«å…¥ã‚Œã‚‹\r\n\r\n### å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ãƒ©ã‚ºãƒ‘ã‚¤ã¸ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\r\né»’ã„ç”»é¢ã«å…¥ã‚Œã¦ã„ãã¾ã™\r\n\r\n```\r\nsudo apt install pigpio python3-pigpio\r\nsudo systemctl enable pigpiod.service\r\nsudo systemctl start pigpiod\r\n```\r\n\r\n### GPIOã®è¨­å®š\r\nèµ¤å¤–ç·šãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã®ãƒ‡ãƒ¼ã‚¿ç·šã‚’`GPIO 18`ã«ç¹‹ã„ã ã®ã§ãã®æ—¨ã‚’æ•™ãˆã¦ã‚ã’ã¾ã™ã€‚\r\n\r\n```\r\necho 'm 18 r    pud 18 u' > /dev/pigpio\r\n```\r\n\r\n### èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³å…¥æ‰‹ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\r\n\r\n```\r\ncurl http://abyz.me.uk/rpi/pigpio/code/irrp_py.zip | zcat > irrp.py\r\n```\r\n\r\n### èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å–å¾—\r\nå…ˆç¨‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã‚’å®Ÿè¡Œã™ã‚‹ã¨èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å…¥æ‰‹å‡ºæ¥ã¾ã™ã€‚  \r\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ãŸå¾Œã€ãƒªãƒ¢ã‚³ãƒ³ã‚’èµ¤å¤–ç·šå—ä¿¡ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã¸å‘ã‘ã¦ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n```\r\npython3 irrp.py -r -g18 -f codes light_on --no-confirm --post 130\r\n```\r\n\r\næˆåŠŸã™ã‚‹ã¨`Okey`ã¾ã§å‡ºã¾ã™ã€‚\r\n\r\n```\r\nRecording\r\nPress key for 'light_on'\r\nOkay\r\n```\r\n\r\nèµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã¯`codes`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚\r\n\r\n### èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¦‹ã‚‹\r\nä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’æ‰“ã¡è¾¼ã‚€ã¨èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’è¨˜è¼‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¦‹ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n```\r\ncat codes\r\n```\r\n\r\n![Imgur](https://imgur.com/kvgL2CS.png)\r\n\r\n`[`ã‹ã‚‰`]`ã§å›²ã‚ã‚Œã¦ã‚‹æ•°å€¤ã‚’æ§ãˆã¦ãŠãã¾ã™ã€‚  \r\nç”»åƒã®ä¾‹ã§ã¯`8953`ã‹ã‚‰`]`ã®å‰ã¾ã§ã€‚ä»¥ä¸‹ä¾‹\r\n\r\n```\r\n8953, 4544, 463, 730, 463, 1730, 463, 1730, 463, 586, 549, 586, 549, 586, 463, 586, 463, 586, 463, 1730, 463, 1730, 549, 586, 463, 586, 463, 586, 549, 1730, 463, 730, 463, 1730, 549, 586, 463, 586, 463, 730, 463, 586, 463, 1730, 549, 1730, 463, 1730, 463, 586, 549, 586, 463, 586, 463, 586, 463, 586, 463, 730, 463, 1730, 463, 1730, 463, 1730, 463, 41143, 8953, 2224, 463\r\n```\r\n\r\n**èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³ã®ä¸­èº«çŸ¥ã‚ŠãŸã„æ–¹ã¯`NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã ã‘ã§ã™ãŒ`é©å½“ã«ã¾ã¨ã‚ãŸã®ã§ã©ã†ãï¼š**[èµ¤å¤–ç·šã®NECãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¾ã¨ã‚ï¼Ÿ](/posts/ir_nec_format/)  \r\nåˆ¥ã«è¦‹ãªãã¦ã‚‚åˆ†ã‹ã‚‰ãªãã¦ã‚‚ä½œã‚Œã¾ã™ã€‚\r\n\r\n# Xiaomi Mi 11 Lite 5G ã§é€ä¿¡\r\n\r\n## ãƒ†ã‚¹ãƒˆç”¨ã‚¢ãƒ—ãƒªç”¨æ„ã—ã¦ãŠãã¾ã—ãŸã€‚\r\n\r\nèµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å…¥ã‚Œã¦é€ä¿¡ã§ãã‚‹ã‹è©¦ã›ã‚‹ã‚¢ãƒ—ãƒªã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/WaXQlJj.png)\r\n\r\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ï¼šhttps://github.com/takusan23/IrSenDroid\r\n\r\nAPKãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼šhttps://github.com/takusan23/IrSenDroid/releases/tag/1.0\r\n\r\n## AndroidManifest\r\n\r\né©å½“ã«Composeãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nã§ããŸã‚‰ã€èµ¤å¤–ç·šã‚’ä½¿ã†ã®ã§æ¨©é™ã‚’`Manifest`ã«æ›¸ãè¶³ã—ã¾ã™ã€‚\r\n\r\n```xml\r\n<?xml version=\"1.0\" encoding=\"utf-8\"?>\r\n<manifest xmlns:android=\"http://schemas.android.com/apk/res/android\"\r\n    package=\"io.github.takusan23.irsendroid\">\r\n\r\n    <uses-permission android:name=\"android.permission.TRANSMIT_IR\"/>\r\n\r\n```\r\n\r\n## é€ä¿¡ç”¨é–¢æ•°ã®ç”¨æ„\r\n\r\n`IrSendTool.kt`ã‚’ä½œæˆã—ã¦ã€ä»¥ä¸‹ã‚’ã‚³ãƒ”ãƒš  \r\n\r\n`LIGHT_OFF_DATA`ã¨`LIGHT_ON_DATA`ã®é…åˆ—ã¯å„è‡ªå–å¾—ã—ãŸãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’å…¥ã‚Œã¦ãã ã•ã„ã€‚\r\n\r\n```kotlin\r\nobject IrSendTool {\r\n\r\n    /** NECã®ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆã® æ¶ˆç¯ãƒœã‚¿ãƒ³ ã‚’æŠ¼ã—ãŸã¨ãã«é€ä¿¡ã•ã‚Œã‚‹èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ */\r\n    val LIGHT_OFF_DATA = listOf(\r\n        8925, 4540, 514, 626, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 626, 514\r\n    )\r\n\r\n    /** NECã®ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆã® å…¨ç¯ãƒœã‚¿ãƒ³ ã‚’æŠ¼ã—ãŸã¨ãã«é€ä¿¡ã•ã‚Œã‚‹èµ¤å¤–ç·šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ */\r\n    val LIGHT_ON_DATA = listOf(\r\n        8925, 4540, 514, 626, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 1730, 514, 626, 514, 1730, 514, 1730, 514, 626, 514, 626, 514, 626, 514, 626, 514, 626, 514, 1730, 514, 626, 514\r\n    )\r\n\r\n    /**\r\n     * èµ¤å¤–ç·šé€ä¿¡\r\n     * @param context Context\r\n     * @param pattern èµ¤å¤–ç·šãƒ‘ã‚¿ãƒ¼ãƒ³\r\n     * */\r\n    fun sendIr(context: Context, pattern: List<Int>) {\r\n        val consumerIrManager = context.getSystemService(Context.CONSUMER_IR_SERVICE) as ConsumerIrManager\r\n        // èµ¤å¤–ç·šåˆ©ç”¨å¯èƒ½ã‹ã©ã†ã‹\r\n        if (consumerIrManager.hasIrEmitter()) {\r\n            // åˆ©ç”¨å¯èƒ½ãªã‚‰é€ä¿¡\r\n            consumerIrManager.transmit(38_000, pattern.toIntArray())\r\n        }\r\n    }\r\n\r\n}\r\n```\r\n\r\nä½¿ã†ã¨ãã¯ã“ã‚“ãªé¢¨ã«\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n\r\n        IrSendTool.sendIr(this, IrSendTool.LIGHT_ON_DATA)\r\n\r\n    }\r\n}\r\n```\r\n\r\n## Composeã§ã¡ã‚ƒã¡ã‚ƒã£ã¨UIã‚’ä½œã‚‹\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            IrSenDroidTheme {\r\n                Surface(color = MaterialTheme.colors.background) {\r\n                    HomeScreen()\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@Preview(backgroundColor = 0xFFFFFF, showBackground = true)\r\n@Composable\r\nfun HomeScreenPrev() {\r\n    HomeScreen()\r\n}\r\n\r\n@Composable\r\nfun HomeScreen() {\r\n    Column(\r\n        modifier = Modifier.fillMaxSize(),\r\n        verticalArrangement = Arrangement.Center,\r\n        horizontalAlignment = Alignment.CenterHorizontally,\r\n    ) {\r\n        RoomLightOnButton()\r\n        RoomLightOffButton()\r\n    }\r\n}\r\n\r\n@Composable\r\nfun RoomLightOnButton() {\r\n    val context = LocalContext.current\r\n\r\n    Button(\r\n        modifier = Modifier.padding(10.dp),\r\n        onClick = { IrSendTool.sendIr(context, IrSendTool.LIGHT_ON_DATA) }\r\n    ) {\r\n        Text(text = \"ç…§æ˜ON\")\r\n    }\r\n}\r\n\r\n@Composable\r\nfun RoomLightOffButton() {\r\n    val context = LocalContext.current\r\n\r\n    Button(\r\n        modifier = Modifier.padding(10.dp),\r\n        onClick = { IrSendTool.sendIr(context, IrSendTool.LIGHT_OFF_DATA) }\r\n    ) {\r\n        Text(text = \"ç…§æ˜OFF\")\r\n    }\r\n}\r\n```\r\n\r\nã“ã‚Œã§`Xiaomi Mi 11 Lite 5G`ãŒã‚ã‚Œã°ã‚·ãƒ¼ãƒªãƒ³ã‚°ãƒ©ã‚¤ãƒˆæ“ä½œã—æ”¾é¡Œã§ã™ã€‚ã‚„ã£ãŸã­ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nèµ¤å¤–ç·šé€ä¿¡ä»˜ã„ã¦ã‚‹ã®ãŠã‚‚ã‚ã„ãªã€‚  \r\nä¼‘æ—¥çµ‚ã‚ã‚‹ã®æ—©ã™ããªï½ï½ï½"},{"title":"å¤ä¼‘ã¿ã®è‡ªç”±ç ”ç©¶ é€šå¸¸ç‰ˆã¨ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’ä½¿ã£ã¦ãƒœãƒ¼ã‚«ãƒ«ã ã‘ã®éŸ³æ¥½ã‚’ä½œã‚‹","link":"/posts/summer_vacation_music_vocal_only/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nä»Šã§ã‚‚ 8/31 ã¾ã§å¤ä¼‘ã¿ã‚ã‚‹ã‚“ã§ã™ã‹ã­ï¼Ÿ\r\n\r\n# æœ¬é¡Œ\r\nãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°ã£ã¦ã€å‘¨ã‚Šã®éŸ³ã‚’é€†ä½ç›¸ã«ã—ã¦å‘¨å›²ã®éŸ³ã‚’æ‰“ã¡æ¶ˆã—ã¦ã„ã‚‹ã‚‰ã—ã„ã‚“ã§ã™ã‚ˆã­ã€‚  \r\n\r\nã§ã€ãã‚Œã‚’ä½¿ãˆã°éŸ³æ¥½ã®é€šå¸¸ç‰ˆã¨ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’ä½¿ã„ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’é€†ä½ç›¸ã«ã™ã‚‹ã“ã¨ã§ã€ã‚«ãƒ©ã‚ªã‚±ç‰ˆã®é€†ã€ã¤ã¾ã‚Šãƒœãƒ¼ã‚«ãƒ«ã ã‘ã®ãƒˆãƒ©ãƒƒã‚¯ãŒä½œã‚Œã‚‹  \r\n\r\næ˜”ã‹ã‚‰ã‚ã‚‹ã‚„ã¤ãªã®ã§ã€æ™®é€šã¯`Audacity`ã¨ã‹ã§ã‚„ã‚Œã°ã„ã„ã¨æ€ã†ã‚“ã§ã™ã‘ã©ã€ä»Šå›ã¯`Android`ã§ã‚„ã‚Šã¾ã™ï¼ï¼ï¼\r\n\r\n# ãªãŒã‚Œ\r\n\r\n- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”¨æ„ã™ã‚‹\r\n    - é€šå¸¸ç‰ˆã¨ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’ç”¨æ„ã™ã‚‹\r\n- éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æœªåœ§ç¸®çŠ¶æ…‹ã«ã™ã‚‹ï¼ˆãƒ‡ã‚³ãƒ¼ãƒ‰ï¼‰\r\n    - å¾Œè¿°\r\n    - PCM ã¨ã‹ã„ã†ã‚„ã¤ã§ã™ã­\r\n- é€šå¸¸ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã¨é€†ä½ç›¸ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’è¶³ã—ç®—ã—ã¦ã€ãƒœãƒ¼ã‚«ãƒ«ã ã‘ã«ã™ã‚‹\r\n    - æ­£ç¢ºã«ã¯é€šå¸¸ç‰ˆã‹ã‚‰ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’å¼•ã\r\n        - éŸ³ã¯æ³¢ãªã®ã§ã€ãã®ã¾ã¾è¶³ã—ãŸã‚Šå¼•ã„ãŸã‚Šã§ãã‚‹\r\n        - é€†ä½ç›¸ã«ã—ã¦åˆæˆã™ã‚‹ã®ã¨ã‚„ã£ã¦ã‚‹ã“ã¨ã¯å¤‰ã‚ã‚‰ã‚“ã¯ãš\r\n- æœªåœ§ç¸®çŠ¶æ…‹ã®ãƒ‡ãƒ¼ã‚¿ãªã®ã§ã€ã“ã®ã¾ã¾ã ã¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãŒå¤§ãã„ã¾ã¾ãªã®ã§ã€åœ§ç¸®ã™ã‚‹ï¼ˆã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ï¼‰\r\n    - æœªåœ§ç¸®çŠ¶æ…‹ã ã¨å¤šåˆ†éŸ³æ¥½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã§ã‚‚å†ç”Ÿã§ããªã„\r\n    - `ffplay`ã¨ã‹`Audacity`ã§ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åˆã‚ã›ã‚Œã°å†ç”Ÿã§ãã‚‹ã‹ã‚‚ã—ã‚Œã‚“\r\n\r\n## æœªåœ§ç¸®çŠ¶æ…‹ã«ã™ã‚‹\r\n`CD`ã¨ã‹ã§å–ã‚Šè¾¼ã‚€ã¨ã€æ—¢ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ã§ä¿å­˜ã•ã‚Œã¾ã™ã‚ˆã­ã€‚ï¼ˆ`.mp3`ã€`.flac`ã€`.aac`ï¼‰  \r\nã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ã¨ã„ã†ã“ã¨ã¯ã€åœ§ç¸®ã•ã‚Œã¦ã„ã‚‹çŠ¶æ…‹ãªã®ã§ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’åŠ å·¥ã—ãŸã„å ´åˆã¯ã¾ãšåœ§ç¸®ã‚’å…ƒã«æˆ»ã™å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãƒ‡ã‚³ãƒ¼ãƒ‰ã¨å‘¼ã°ã‚Œã‚‹ä½œæ¥­ã§ã™ã­ã€‚  \r\nï¼ˆ`zip`ã‚’è§£å‡ã—ãªã„ã¨ä¸­èº«ã„ã˜ã‚Œãªã„æ„Ÿã˜ã§ï¼‰  \r\n\r\nå‹•ç”»/éŸ³æ¥½ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒåœ§ç¸®ã•ã‚Œã¦ã„ã‚‹éŸ³å£°ã‚’å†ç”Ÿã§ãã‚‹ã®ã¯ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã¨å‘¼ã°ã‚Œã‚‹ä½œæ¥­ã‚’ã—ã€å…ƒã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã«æˆ»ã—ã¦ã„ã‚‹ã‹ã‚‰ãªã‚“ã§ã™ã­ã€‚  \r\n`Audacity`ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒå¤§ãã„ã®ã¯ç·¨é›†ã®ãŸã‚ã«æœªåœ§ç¸®çŠ¶æ…‹ã§æŒã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã‹ã‚‰ãªã‚“ã§ã™ã­\r\n\r\n## éŸ³å£°ã‚’æ”¯ãˆã‚‹æŠ€è¡“\r\n\r\n- MediaCodec\r\n    - ã“ã®ãƒ–ãƒ­ã‚°ã§ã‚‚ä½•å›ã‹å–ã‚Šä¸Šã’ã¦ã„ã‚‹ãã›è€…\r\n        - https://takusan.negitoro.dev/posts/tag/MediaCodec/\r\n    - æ˜ åƒã‚„éŸ³å£°ã®ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã€ãƒ‡ã‚³ãƒ¼ãƒ‰ã‚’ã™ã‚‹ã‚¯ãƒ©ã‚¹\r\n        - `Media3 (ExoPlayer)`ãŒå‹•ç”»ã‚’å†ç”Ÿã§ãã‚‹ã®ã¯ã€ãã›è€…`MediaCodec`ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã‚‰ãªã‚“ã§ã™ã­\r\n    - æœ€çµ‚çš„ã«ã¯Cè¨€èªã¨ã‹ã§æ›¸ã‹ã‚ŒãŸå‡¦ç†ã«åˆ°é”ã™ã‚‹ã€ã‚¨ãƒ©ãƒ¼ãŒä½•ã‚‚ã‚ã‹ã‚‰ãªã„\r\n    - `H.264`ã€`H.265`ã€`VP9`ã¨ã‹`AAC`ã¨ã‹ã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨å‘¼ã°ã‚Œã‚‹ã‚„ã¤ã‚’ã‚„ã£ã¦ãã‚Œã‚‹\r\n    - ãã›è€…\r\n- MediaExtractor\r\n    - `mp4`ã‚„`aac`ãªã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰ã€`MediaCodec`ã¸æ¸¡ã™ãŸã‚ã®ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ã¦ãã‚Œã‚‹ã‚¯ãƒ©ã‚¹\r\n        - `mp4`ã¨ã‹`aac`ã«ã¯å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ä»¥å¤–ã«ã‚‚ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æŒã£ã¦ã„ã‚‹ï¼ˆå‹•ç”»ã®ç¸¦æ¨ªã‚µã‚¤ã‚ºã€ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã€fps ãªã©ï¼‰ã®ã§ã€ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã¨å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãã‚Œãã‚Œåˆ†ã‘ã¦å–ã‚Šå‡ºã—ã¦ãã‚Œã‚‹\r\n    - `mp4`ã¨ã‹`aac`ã¯ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã¨ã‹ã„ã†ã‚„ã¤ã§ã™ã­\r\n    - ãã›è€…\r\n- MediaMuxer\r\n    - `MediaCodec`ã‹ã‚‰å‡ºã¦ããŸãƒ‡ãƒ¼ã‚¿ã‚’`mp4`ã¨ã‹ã«ä¿å­˜ã™ã‚‹ãŸã‚ã®ã‚¯ãƒ©ã‚¹ã€`MediaExtractor`ã®é€†ã‚’ã™ã‚‹\r\n        - ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã£ã¦é›£ã—ã„ã‚“ã§ã™ã­...\r\n    - ãã›è€…\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ           | ã‚ãŸã„                                                                                                 |\r\n|------------------|--------------------------------------------------------------------------------------------------------|\r\n| Windows          | 10 Pro                                                                                                 |\r\n| Android Studio   | Android Studio Giraffe                                                                                 |\r\n| ãŸã‚“ã¾ã¤         | Google Pixel 6 Pro                                                                                     |\r\n| ä½¿ã†éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ« | `flac`ï¼ˆå¤šåˆ†`AAC`ã§ã‚‚ã„ã„ã¯ãšï¼‰/ ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•° 44.1 kHz / ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ 1 Mbps / ãƒãƒ£ãƒ³ãƒãƒ«æ•° 2 ch |\r\n\r\néŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€é€šå¸¸ç‰ˆã¨ã‚«ãƒ©ã‚ªã‚±ç‰ˆã§ã€ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°å‘¨æ³¢æ•°ï¼ˆãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã‚‚ï¼Ÿï¼Ÿï¼‰ãŒåŒã˜ã˜ã‚ƒãªã„ã¨ãƒ€ãƒ¡ã ã¨æ€ã†ï¼ˆCDã‹ã‚‰å…¥ã‚Œã‚Œã°åŒã˜è¨­å®šã ã¨æ€ã„ã¾ã™ãŒ...ï¼‰\r\n\r\n![Imgur](https://imgur.com/taTzKxx.png)\r\n\r\n# ä½œã‚‹\r\n\r\nã¤ãã‚Šã¾ã™\r\n\r\n## é©å½“ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œæˆ\r\n`Jetpack Compose`ã§ã„ãã¾ã™ï¼ã‚‚ã†`ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã®xml`ä¸€ç”Ÿæ›¸ããŸããªã„ï¼\r\n\r\nã¤ã„ã«ï¼`build.gradle.kts`ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ä½œã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã­ï¼ï¼ï¼  \r\né•·ã‹ã£ãŸã‘ã©ã¾ãæ—¨å‘³ã‚ã‚“ã¾ã‚Šãªã„ã‹ã‚‰`build.gradle`ã‹ã‚‰ç§»è¡Œã™ã‚‹ã»ã©ã§ã¯ãªã•ãã†\r\n\r\n![Imgur](https://imgur.com/FWVEz3f.png)\r\n\r\n## éŸ³æ¥½ã‚’é¸ã¶ãŸã‚ã®UI\r\nãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã‚’é–‹ã„ã¦ã€éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã¶å‡¦ç†ã‚’æ›¸ãã¾ã™ã€‚  \r\né©å½“ã«ãƒœã‚¿ãƒ³ã‚’ç½®ãã¾ã™ã€‚  \r\n\r\næœ¬å½“ã¯`HomeScreen`ã¯åˆ¥ãƒ•ã‚¡ã‚¤ãƒ«ã®ã»ã†ãŒè‰¯ã•ãã†ã§ã™ãŒã¾ãå˜ç™ºä¼ç”»ãªã®ã§ã“ã®ã¾ã¾ã§è¡Œãã¾ã™\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            VocalOnlyDroidTheme {\r\n                HomeScreen()\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun HomeScreen() {\r\n    val context = LocalContext.current\r\n\r\n    // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã® Uri\r\n    val normalTrackUri = remember { mutableStateOf<Uri?>(null) }\r\n    val instrumentalTrackUri = remember { mutableStateOf<Uri?>(null) }\r\n\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼\r\n    val normalTrackFilePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.OpenDocument()) { normalTrackUri.value = it }\r\n    val instrumentalTrackFilePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.OpenDocument()) { instrumentalTrackUri.value = it }\r\n\r\n    Scaffold(\r\n        topBar = { TopAppBar(title = { Text(text = stringResource(id = R.string.app_name)) }) }\r\n    ) {\r\n        Column(\r\n            modifier = Modifier.padding(it),\r\n            verticalArrangement = Arrangement.spacedBy(5.dp)\r\n        ) {\r\n\r\n            Button(\r\n                onClick = { normalTrackFilePicker.launch(arrayOf(\"audio/*\")) }\r\n            ) { Text(text = normalTrackUri.value?.toString() ?: \"é€šå¸¸ç‰ˆã®é¸æŠ\") }\r\n\r\n            Button(\r\n                onClick = { instrumentalTrackFilePicker.launch(arrayOf(\"audio/*\")) }\r\n            ) { Text(text = instrumentalTrackUri.value?.toString() ?: \"ã‚«ãƒ©ã‚ªã‚±ç‰ˆã®é¸æŠ\") }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã®è¿”ã‚Šå€¤ã¯`Uri`ã§ã€**ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã§ã¯ãªã„ã§ã™ã€‚**  \r\nã‚‚ã¡ã‚ã‚“ã¡ã‚ƒã‚“ã¨`Uri`ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ãŸã‚Šã€æ›¸ãè¾¼ã‚“ã ã‚Šã™ã‚‹æ–¹æ³•ãŒã‚ã‚Šã¾ã™ï¼ˆ`InputStream / OutputStream`ãŒé–‹ã‘ã¾ã™ï¼‰ã€‚  \r\n\r\nã¯ãï½ï¼Ÿï¼Ÿï¼Ÿã£ã¦æ„Ÿã˜ã§ã™ã‚ˆã­ã€ã€ã€ãªã‚“ã§ã ã‚ˆãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚ˆã“ã›ã‚ˆã£ã¦è©±ã§ã™ãŒã€ã“ã®æ–¹æ³•ã ã¨ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒãŸãªã„ã‚¢ãƒ—ãƒªã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Œã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \r\nã¤ã¾ã‚Šã©ã†ã„ã†ã“ã¨ã‹ã¨ã„ã†ã¨ã€`Google ãƒ‰ãƒ©ã‚¤ãƒ–`ã‚„`Google ãƒ•ã‚©ãƒˆ`ãªã©ã®ã€ç«¯æœ«å†…ã«ã¯ç„¡ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã§é¸æŠã™ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ï¼ˆç«¯æœ«å†…ã«ç„¡ã„ã®ã§ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã‚’æŒã£ã¦ã¾ã›ã‚“...ï¼‰  \r\nï¼ˆã‚‚ã¡ã‚ã‚“ã€ä¸Šè¨˜ã®ã‚¢ãƒ—ãƒªã‹ã‚‰ç«¯æœ«å¤–ã«ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã å ´åˆã€ä¸€æ™‚çš„ã«ã¯ç«¯æœ«å†…ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã•ã‚Œã‚‹ã¨ã¯æ€ã„ã¾ã™ãŒï¼‰\r\n\r\nã‚ã¨`Uri`ã¯ãƒ—ãƒ­ã‚»ã‚¹ãŒç”Ÿãã¦ã„ã‚‹é–“ï¼ˆã‚¢ãƒ—ãƒªãŒå‹•ã„ã¦ã„ã‚‹é–“ï¼‰ã®ã¿æœ‰åŠ¹ã¿ãŸã„ãªè©±ã ã£ãŸã¯ãšã€ã€ã€ã¡ã‚‡ã£ã¨æ€ã„å‡ºã›ãªã„  \r\n\r\né¸ã‚“ã ã‚‰`normalTrackUri / instrumentalTrackUri`ã«ãã‚Œãã‚Œå…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/91Z4HfD.png)\r\n\r\n## å®Ÿè¡Œãƒœã‚¿ãƒ³ã¨ã‚‚ã‚ã‚‚ã‚ã‚’æ›¸ã\r\n\r\nã¾ãšã¯ UI ã«çŠ¶æ…‹ã‚’é€šçŸ¥ã™ã‚‹ãŸã‚ã€çŠ¶æ…‹ä¸€è¦§ã‚’æ›¸ãã¾ã™ã€‚  \r\n`WWDC 2023`ã§ä¹…ã—ã¶ã‚Šã«å‡ºãŸ`One more thing...`ã€`iPhone X`ã®ç™ºè¡¨ä»¥æ¥ä½¿ã£ã¦ãªã„ã‚“ã˜ã‚ƒãªã„ã¨æ€ã£ã¦èª¿ã¹ãŸã‚‰`Apple Silicon`ã§ä½¿ã£ãŸã®ã‹\r\n\r\n```kotlin\r\nprivate enum class ProgressStatus {\r\n    /** å®Ÿè¡Œå¯èƒ½ */\r\n    IDLE,\r\n\r\n    /** ãƒ‡ã‚³ãƒ¼ãƒ‰ä¸­ */\r\n    DECODE,\r\n\r\n    /** éŸ³å£°ã®åŠ å·¥ä¸­ */\r\n    EDIT,\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ */\r\n    ENCODE,\r\n\r\n    /** ã‚ã¨ã—ã¾ã¤ */\r\n    ONE_MORE_THING\r\n}\r\n```\r\n\r\nãã—ã¦å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’è¨­ç½®ã—ã¾ã—ãŸã€`HomeScreen`ã ã‘ã§ã™ä»¥å¤–ã¯å¤‰ãˆã¦ãªã„ã§ã™ã€‚\r\n\r\n```kotlin\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun HomeScreen() {\r\n    val context = LocalContext.current\r\n    val scope = rememberCoroutineScope()\r\n\r\n    // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã® Uri\r\n    val normalTrackUri = remember { mutableStateOf<Uri?>(null) }\r\n    val instrumentalTrackUri = remember { mutableStateOf<Uri?>(null) }\r\n\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼\r\n    val normalTrackFilePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.OpenDocument()) { normalTrackUri.value = it }\r\n    val instrumentalTrackFilePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.OpenDocument()) { instrumentalTrackUri.value = it }\r\n    \r\n    val progressStatus = remember { mutableStateOf(ProgressStatus.IDLE) }\r\n    \r\n    // å‡¦ç†å†…å®¹\r\n    fun start() {\r\n        // TODO ã“ã®ã‚ã¨ã™ãï¼\r\n    }\r\n\r\n    Scaffold(\r\n        topBar = { TopAppBar(title = { Text(text = stringResource(id = R.string.app_name)) }) }\r\n    ) {\r\n        Column(\r\n            modifier = Modifier.padding(it),\r\n            verticalArrangement = Arrangement.spacedBy(5.dp)\r\n        ) {\r\n\r\n            Button(\r\n                onClick = { normalTrackFilePicker.launch(arrayOf(\"audio/*\")) }\r\n            ) { Text(text = normalTrackUri.value?.toString() ?: \"é€šå¸¸ç‰ˆã®é¸æŠ\") }\r\n\r\n            Button(\r\n                onClick = { instrumentalTrackFilePicker.launch(arrayOf(\"audio/*\")) }\r\n            ) { Text(text = instrumentalTrackUri.value?.toString() ?: \"ã‚«ãƒ©ã‚ªã‚±ç‰ˆã®é¸æŠ\") }\r\n\r\n            // å®Ÿè¡Œä¸­ã¯å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’å‡ºã•ãªã„\r\n            if (progressStatus.value == ProgressStatus.IDLE) {\r\n                Button(\r\n                    onClick = { start() }\r\n                ) { Text(text = \"å‡¦ç†ã‚’å§‹ã‚ã‚‹\") }\r\n            } else {\r\n                CircularProgressIndicator()\r\n                Text(text = \"å‡¦ç†ä¸­ã§ã™ï¼š${progressStatus.value}\")\r\n            }\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## éŸ³å£°ã‚’ç·¨é›†ã™ã‚‹å‡¦ç†ã‚’æ›¸ã\r\n`MediaCodec`ã¨ã‹ã®ãã›è€…ã‚’ã“ã“ã‹ã‚‰ä½¿ã£ã¦ã„ãã‚ã‘ã§ã™ãŒ...  \r\nä»Šå›ã¯å‰ç§ãŒæ›¸ã„ãŸã‚„ã¤ãŒã‚ã‚‹ã®ã§ãã‚Œã‚’ãƒ‘ã‚¯ã‚‹ã“ã¨ã«ã—ã¾ã™ã€‚ã‚ã‚ŠãŒã¨ã†éå»ã®ç§\r\n\r\nhttps://github.com/takusan23/AkariDroid/tree/master/akari-core/src/main/java/io/github/takusan23/akaricore/common\r\n\r\n## AudioEncoder / AudioDecoder\r\nä»¥ä¸‹ã®ã‚¯ãƒ©ã‚¹ã‚’ä½œã£ã¦ãã ã•ã„...  \r\n\r\nã‚„ã£ã¦ã‚‹ã“ã¨ã¯\r\n- `MediaCodec`ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n    - ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆã¨ã‹ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¨ã‹å…¥ã‚Œã‚‹\r\n- çµ‚ã‚ã‚Šã¾ã§ãƒ‡ãƒ¼ã‚¿ã‚’`MediaCodec`ã«æµã™\r\n    - åœ§ç¸®ã—ãŸãƒ‡ãƒ¼ã‚¿ or æœªåœ§ç¸®ãƒ‡ãƒ¼ã‚¿ ãŒå‡ºã¦ãã‚‹\r\n\r\n```kotlin\r\n/**\r\n * éŸ³å£°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n * MediaCodecã‚’ä½¿ã„ã‚„ã™ãã—ãŸã ã‘\r\n *\r\n * ç”Ÿï¼ˆæ„å‘³æ·±ï¼‰ã®éŸ³å£°ï¼ˆPCMï¼‰é€ã‚‰ã‚Œã¦ãã‚‹ã®ã§ã€ AAC / Opus ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦åœ§ç¸®ã™ã‚‹ã€‚\r\n */\r\nclass AudioEncoder {\r\n\r\n    /** MediaCodec ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ */\r\n    private var mediaCodec: MediaCodec? = null\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–ã™ã‚‹\r\n     *\r\n     * @param codec ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã€‚[MediaFormat.MIMETYPE_AUDIO_AAC]ãªã©\r\n     * @param sampleRate ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆ\r\n     * @param channelCount ãƒãƒ£ãƒ³ãƒãƒ«æ•°\r\n     * @param bitRate ãƒ“ãƒƒãƒˆãƒ¬ãƒ¼ãƒˆ\r\n     * @param\r\n     */\r\n    fun prepareEncoder(\r\n        codec: String = MediaFormat.MIMETYPE_AUDIO_AAC,\r\n        sampleRate: Int = 44_100,\r\n        channelCount: Int = 2,\r\n        bitRate: Int = 192_000,\r\n    ) {\r\n        val audioEncodeFormat = MediaFormat.createAudioFormat(codec, sampleRate, channelCount).apply {\r\n            setInteger(MediaFormat.KEY_AAC_PROFILE, MediaCodecInfo.CodecProfileLevel.AACObjectLC)\r\n            setInteger(MediaFormat.KEY_BIT_RATE, bitRate)\r\n        }\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ç”¨æ„\r\n        mediaCodec = MediaCodec.createEncoderByType(codec).apply {\r\n            configure(audioEncodeFormat, null, null, MediaCodec.CONFIGURE_FLAG_ENCODE)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’é–‹å§‹ã™ã‚‹ã€‚åŒæœŸãƒ¢ãƒ¼ãƒ‰ã‚’ä½¿ã†ã®ã§ã‚³ãƒ«ãƒ¼ãƒãƒ³ã‚’ä½¿ã„ã¾ã™ï¼ˆã‚¹ãƒ¬ãƒƒãƒ‰ã§ã‚‚è‰¯ã„ã‘ã©ï¼‰\r\n     *\r\n     * @param onRecordInput ByteArrayã‚’æ¸¡ã™ã®ã§ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã€ã‚µã‚¤ã‚ºã‚’è¿”ã—ã¦ãã ã•ã„\r\n     * @param onOutputBufferAvailable ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæµã‚Œã¦ãã¾ã™\r\n     * @param onOutputFormatAvailable ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰å¾Œã®MediaFormatãŒå…¥æ‰‹ã§ãã‚‹\r\n     */\r\n    suspend fun startAudioEncode(\r\n        onRecordInput: suspend (ByteArray) -> Int,\r\n        onOutputBufferAvailable: suspend (ByteBuffer, MediaCodec.BufferInfo) -> Unit,\r\n        onOutputFormatAvailable: suspend (MediaFormat) -> Unit,\r\n    ) = withContext(Dispatchers.Default) {\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n        mediaCodec!!.start()\r\n\r\n        try {\r\n            while (isActive) {\r\n                // ã‚‚ã— -1 ãŒè¿”ã£ã¦ãã‚Œã° configure() ãŒé–“é•ã£ã¦ã‚‹\r\n                val inputBufferId = mediaCodec!!.dequeueInputBuffer(TIMEOUT_US)\r\n                if (inputBufferId >= 0) {\r\n                    // AudioRecodeã®ãƒ‡ãƒ¼ã‚¿ã‚’ã“ã®ä¸­ã«å…¥ã‚Œã‚‹\r\n                    val inputBuffer = mediaCodec!!.getInputBuffer(inputBufferId)!!\r\n                    val capacity = inputBuffer.capacity()\r\n                    // ã‚µã‚¤ã‚ºã«åˆã‚ã›ã¦ä½œæˆ\r\n                    val byteArray = ByteArray(capacity)\r\n                    // byteArrayã¸ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã‚‚ã‚‰ã†\r\n                    val readByteSize = onRecordInput(byteArray)\r\n                    if (readByteSize > 0) {\r\n                        // æ›¸ãè¾¼ã‚€ã€‚æ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã¯[onOutputBufferAvailable]ã§å—ã‘å–ã‚Œã‚‹\r\n                        inputBuffer.put(byteArray, 0, readByteSize)\r\n                        mediaCodec!!.queueInputBuffer(inputBufferId, 0, readByteSize, System.nanoTime() / 1000, 0)\r\n                    } else {\r\n                        // ã‚‚ã†ãªã„ï¼\r\n                        break\r\n                    }\r\n                }\r\n                // å‡ºåŠ›\r\n                val outputBufferId = mediaCodec!!.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (outputBufferId >= 0) {\r\n                    val outputBuffer = mediaCodec!!.getOutputBuffer(outputBufferId)!!\r\n                    if (bufferInfo.size > 1) {\r\n                        if (bufferInfo.flags and MediaCodec.BUFFER_FLAG_CODEC_CONFIG == 0) {\r\n                            // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€...\r\n                            onOutputBufferAvailable(outputBuffer, bufferInfo)\r\n                        }\r\n                    }\r\n                    // è¿”å´\r\n                    mediaCodec!!.releaseOutputBuffer(outputBufferId, false)\r\n                } else if (outputBufferId == MediaCodec.INFO_OUTPUT_FORMAT_CHANGED) {\r\n                    // MediaFormatã€MediaMuxerã«å…¥ã‚Œã‚‹ã¨ãã«ä½¿ã†ã‚„ã¤\r\n                    // ãŸã¶ã‚“ã“ã£ã¡ã®ã»ã†ãŒå…ˆã«å‘¼ã°ã‚Œã‚‹\r\n                    onOutputFormatAvailable(mediaCodec!!.outputFormat)\r\n                }\r\n            }\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        } finally {\r\n            // ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹æ”¾ã™ã‚‹\r\n            try {\r\n                mediaCodec?.stop()\r\n                mediaCodec?.release()\r\n            } catch (e: Exception) {\r\n                e.printStackTrace()\r\n            }\r\n        }\r\n    }\r\n\r\n    companion object {\r\n        /** MediaCodec ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n        private const val TIMEOUT_US = 10_000L\r\n    }\r\n}\r\n```\r\n\r\n```kotlin\r\n/**\r\n * éŸ³å£°ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼\r\n * MediaCodecã‚’ä½¿ã„ã‚„ã™ãã—ãŸã ã‘\r\n *\r\n * ç”Ÿï¼ˆæ„å‘³æ·±ï¼‰ã®éŸ³å£°ï¼ˆPCMï¼‰é€ã‚‰ã‚Œã¦ãã‚‹ã®ã§ã€ AAC / Opus ã«ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ã¦åœ§ç¸®ã™ã‚‹ã€‚\r\n */\r\nclass AudioDecoder {\r\n    /** MediaCodec ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ */\r\n    private var mediaCodec: MediaCodec? = null\r\n\r\n    /**\r\n     * åˆæœŸåŒ–ã™ã‚‹\r\n     * ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ãªã‚‰ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ãƒ¼æŒã£ã¦ã‚‹ã¯ãš...\r\n     *\r\n     * @param mediaFormat [android.media.MediaExtractor]ã‹ã‚‰å‡ºã¦ããŸMediaFormat\r\n     */\r\n    fun prepareDecoder(mediaFormat: MediaFormat) {\r\n        val mimeType = mediaFormat.getString(MediaFormat.KEY_MIME)!!\r\n        mediaCodec = MediaCodec.createDecoderByType(mimeType).apply {\r\n            configure(mediaFormat, null, null, 0)\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’é–‹å§‹ã™ã‚‹\r\n     *\r\n     * @param readSampleData ByteArrayã‚’æ¸¡ã™ã®ã§ã€éŸ³å£°ãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¦ã€ã‚µã‚¤ã‚ºã¨å†ç”Ÿæ™‚é–“ï¼ˆãƒã‚¤ã‚¯ãƒ­ç§’ï¼‰ã‚’è¿”ã—ã¦ãã ã•ã„\r\n     * @param onOutputBufferAvailable ãƒ‡ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿ãŒæµã‚Œã¦ãã¾ã™\r\n     */\r\n    suspend fun startAudioDecode(\r\n        readSampleData: (ByteBuffer) -> Pair<Int, Long>,\r\n        onOutputBufferAvailable: (ByteArray) -> Unit,\r\n    ) = withContext(Dispatchers.Default) {\r\n        val bufferInfo = MediaCodec.BufferInfo()\r\n        mediaCodec!!.start()\r\n\r\n        try {\r\n            while (isActive) {\r\n                // ã‚‚ã— -1 ãŒè¿”ã£ã¦ãã‚Œã° configure() ãŒé–“é•ã£ã¦ã‚‹\r\n                val inputBufferId = mediaCodec!!.dequeueInputBuffer(TIMEOUT_US)\r\n                if (inputBufferId >= 0) {\r\n                    // Extractorã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿ã ã™\r\n                    val inputBuffer = mediaCodec!!.getInputBuffer(inputBufferId)!!\r\n                    // æ›¸ãè¾¼ã‚€ã€‚æ›¸ãè¾¼ã‚“ã ãƒ‡ãƒ¼ã‚¿ã¯[onOutputBufferAvailable]ã§å—ã‘å–ã‚Œã‚‹\r\n                    val (size, presentationTime) = readSampleData(inputBuffer)\r\n                    if (size > 0) {\r\n                        mediaCodec!!.queueInputBuffer(inputBufferId, 0, size, presentationTime, 0)\r\n                    } else {\r\n                        // ãƒ‡ãƒ¼ã‚¿ãªããªã£ãŸå ´åˆã¯çµ‚äº†ãƒ•ãƒ©ã‚°ã‚’ç«‹ã¦ã‚‹\r\n                        mediaCodec!!.queueInputBuffer(inputBufferId, 0, 0, 0, MediaCodec.BUFFER_FLAG_END_OF_STREAM)\r\n                        // ãŠã‚ã‚Š\r\n                        break\r\n                    }\r\n                }\r\n                // å‡ºåŠ›\r\n                val outputBufferId = mediaCodec!!.dequeueOutputBuffer(bufferInfo, TIMEOUT_US)\r\n                if (outputBufferId >= 0) {\r\n                    // ãƒ‡ã‚³ãƒ¼ãƒ‰çµæœã‚’ã‚‚ã‚‰ã†\r\n                    val outputBuffer = mediaCodec!!.getOutputBuffer(outputBufferId)!!\r\n                    val outData = ByteArray(bufferInfo.size)\r\n                    outputBuffer.get(outData)\r\n                    onOutputBufferAvailable(outData)\r\n                    // è¿”å´\r\n                    mediaCodec!!.releaseOutputBuffer(outputBufferId, false)\r\n                }\r\n            }\r\n        } catch (e: Exception) {\r\n            e.printStackTrace()\r\n        } finally {\r\n            // ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹æ”¾ã™ã‚‹\r\n            try {\r\n                mediaCodec?.stop()\r\n                mediaCodec?.release()\r\n            } catch (e: Exception) {\r\n                e.printStackTrace()\r\n            }\r\n        }\r\n    }\r\n\r\n    companion object {\r\n\r\n        /** MediaCodec ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ */\r\n        private const val TIMEOUT_US = 10_000L\r\n    }\r\n}\r\n```\r\n\r\n## éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ã€ä¸€æ™‚çš„ã«ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€\r\n`aac`ã‚„`flac`ã¯ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚Œã¦ã„ã‚‹ï¼ˆåœ§ç¸®ã•ã‚Œã¦ã„ã‚‹ï¼‰ã®ã§ã€ã¾ãšã¯ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦æœªåœ§ç¸®çŠ¶æ…‹ã®ãƒ‡ãƒ¼ã‚¿ã«æˆ»ã™å¿…è¦ãŒã‚ã‚‹ã¨è¨€ã„ã¾ã—ãŸã€ãã‚Œã‚’ã—ã¾ã™ã€‚  \r\nã§å‡ºæ¥ãŸã€æœªåœ§ç¸®çŠ¶æ…‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚  \r\n\r\né›‘ã«ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ãŸã®ã§ä½•ã—ã¦ã‚‹ã‹è¦‹ãŸã„æ–¹ã¯ã©ã†ãã€‚  \r\nä¸€ç‚¹ã€`Uri`ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã®ã«`InputStream`ã¿ãŸã„ãªã®ã‚’ä½¿ãŠã†ã¨ã—ãŸã‚“ã§ã™ã‘ã©ã€ãã‚Œè‡ªä½“ã¯æ¸¡ã›ãªã•ãã†ã§ã€`FileDescriptor`ã¨ã‹ã„ã†ã‚„ã¤ã‚’çµŒç”±ã—ã¦ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã‚ˆã†ã«ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚ã‚ˆãåˆ†ã‹ã‚Šã¾ã›ã‚“\r\n\r\nã‚ï¼ã€ã‚‚ã†ä¸€ç‚¹ã€  \r\nå‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«ãŒ`File ã‚¯ãƒ©ã‚¹`ã«ãªã£ã¦ãŸã‚Šã—ã¾ã™ãŒã€ã“ã‚Œã¯ã“ã®ä¸‹ã®ã©ã£ã‹ã§è©±ã™ã¨æ€ã†\r\n\r\n```kotlin\r\n/** ãƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Šå‡ºã™å‡¦ç†ã‚’è¡Œã† */\r\nobject VocalOnlyProcessor {\r\n\r\n    /**\r\n     * éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n     *\r\n     * @param fileDescriptor [android.content.ContentResolver.openFileDescriptor]\r\n     * @param outputFile å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«\r\n     */\r\n    suspend fun decode(\r\n        fileDescriptor: FileDescriptor,\r\n        outputFile: File\r\n    ) = withContext(Dispatchers.Default) {\r\n        // ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã‚„ã¤\r\n        val extractor = MediaExtractor().apply {\r\n            setDataSource(fileDescriptor)\r\n        }\r\n        // éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã‚’è¦‹ã¤ã‘ã‚‹\r\n        // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰ã€éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã—ã‹ç„¡ã„ã¯ãšãªã®ã§ã€0 æ±ºã‚æ‰“ã¡ã§ã‚‚è‰¯ã•ãã†\r\n        val audioTrackIndex = (0 until extractor.trackCount)\r\n            .first { extractor.getTrackFormat(it).getString(MediaFormat.KEY_MIME)?.startsWith(\"audio/\") == true }\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™\r\n        val audioDecoder = AudioDecoder().apply {\r\n            prepareDecoder(extractor.getTrackFormat(audioTrackIndex))\r\n        }\r\n        extractor.selectTrack(audioTrackIndex)\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€æº–å‚™\r\n        outputFile.outputStream().use { outputStream ->\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n            audioDecoder.startAudioDecode(\r\n                readSampleData = { byteBuffer ->\r\n                    // ãƒ‡ãƒ¼ã‚¿ã‚’é€²ã‚ã‚‹\r\n                    val size = extractor.readSampleData(byteBuffer, 0)\r\n                    extractor.advance()\r\n                    size to extractor.sampleTime\r\n                },\r\n                onOutputBufferAvailable = { bytes ->\r\n                    // ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€\r\n                    outputStream.write(bytes)\r\n                }\r\n            )\r\n        }\r\n    }\r\n}\r\n```\r\n\r\n## é€šå¸¸ç‰ˆã¨ã‚«ãƒ©ã‚ªã‚±ç‰ˆã‚’ä½¿ã£ã¦ã€ãƒœãƒ¼ã‚«ãƒ«ã ã‘ã‚’å–ã‚Šå‡ºã™å‡¦ç†\r\nå†’é ­ã«è¨€ã£ãŸé€šã‚Šã€æœªåœ§ç¸®çŠ¶æ…‹ã®ãƒ‡ãƒ¼ã‚¿ãªã®ã§ã€è¶³ã—ç®—ãƒ»å¼•ãç®—ãŒå‡ºæ¥ã¾ã™ã€‚  \r\næœªåœ§ç¸®çŠ¶æ…‹ã®ãƒ‡ãƒ¼ã‚¿ã®ãƒã‚¤ãƒˆé…åˆ—ã®åŒã˜ä½ç½®åŒå£«ã‚’è¶³ã—ãŸã‚Šå¼•ã„ãŸã‚Šã™ã‚Œã°è‰¯ã„ã¯ãšã§ã™...ï¼\r\n\r\n`readNBytes`ã¨ã‹ã„ã†ã€æŒ‡å®šã‚µã‚¤ã‚ºã®`ByteArray`ã‚’ä½œã£ã¦èª­ã¿å‡ºã—ã¦è¿”ã—ã¦ãã‚Œã‚‹ã‚„ã¤ãŒã‚ã‚‹ã‚“ã§ã™ã‘ã©ã€å¤ã„`Android`ã‚’ã‚¿ãƒ¼ã‚²ãƒƒãƒˆã«ã™ã‚‹ãªã‚‰ä½¿ãˆãªã•ãã†...\r\nhttps://developer.android.com/reference/java/io/InputStream#readNBytes(int)\r\n\r\næµçŸ³ã«3ã¤ã‚‚`use { }`ã™ã‚‹ã¨åˆ†ã‹ã‚Šã«ãã„æ°—ãŒã—ã¦ããŸ...ã§ã‚‚è‡ªå‹•ã§é–‰ã˜ã¦ãã‚Œã‚‹ã®ä¾¿åˆ©ãªã‚“ã ã‚ˆãª\r\n\r\n```kotlin\r\n/**\r\n * é€šå¸¸ç‰ˆã‹ã‚‰ã‚«ãƒ©ã‚ªã‚±ç‰ˆã‚’å¼•ã„ã¦ãƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Šå‡ºã™\r\n *\r\n * @param normalTrackFile é€šå¸¸ç‰ˆã®ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿\r\n * @param instrumentalTrackFile ã‚«ãƒ©ã‚ªã‚±ç‰ˆã®ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿\r\n * @param resultFile ä¿å­˜å…ˆ\r\n */\r\nsuspend fun extract(\r\n    normalTrackFile: File,\r\n    instrumentalTrackFile: File,\r\n    resultFile: File\r\n) = withContext(Dispatchers.IO) {\r\n    resultFile.outputStream().use { resultOutputStream ->\r\n        normalTrackFile.inputStream().use { normalTrackInputStream ->\r\n            instrumentalTrackFile.inputStream().use { instrumentalTrackInputStream ->\r\n                // ãƒ‡ãƒ¼ã‚¿ãŒç„¡ããªã‚‹ã¾ã§\r\n                while (isActive) {\r\n                    // ã¡ã‚‡ã£ã¨ãšã¤å–ã‚Šå‡ºã—ã¦ã€éŸ³ã®åŠ å·¥ã‚’ã—ã¦ã„ã\r\n                    // ä¸€æ°—ã«èª­ã¿å–ã‚‹ã®ã¯å¤šåˆ†ç„¡ç†\r\n                    val normalTrackByteArray = ByteArray(BYTE_ARRAY_SIZE).also { byteArray -> normalTrackInputStream.read(byteArray) }\r\n                    val instrumentalTrackByteArray = ByteArray(BYTE_ARRAY_SIZE).also { byteArray -> instrumentalTrackInputStream.read(byteArray) }\r\n                    \r\n                    // é€šå¸¸ç‰ˆã‹ã‚‰ã‚«ãƒ©ã‚ªã‚±ç‰ˆã‚’å¼•ãå‡¦ç†\r\n                    val size = max(normalTrackByteArray.size, instrumentalTrackByteArray.size)\r\n                    val vocalOnlyByteArray = (0 until size)\r\n                        .map { index -> (normalTrackByteArray[index] - instrumentalTrackByteArray[index]).toByte() }\r\n                        .toByteArray()\r\n\r\n                    // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€\r\n                    resultOutputStream.write(vocalOnlyByteArray)\r\n                    // ã©ã¡ã‚‰ã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¿çµ‚ã‚ã£ãŸã‚‰ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹\r\n                    if (normalTrackInputStream.available() == 0 || instrumentalTrackInputStream.available() == 0) {\r\n                        break\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nprivate const val BYTE_ARRAY_SIZE = 8192\r\n```\r\n\r\n## ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹å‡¦ç†\r\nã¯ã„ã€‚ã“ã£ã¡ã‚‚ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ãŸã®ã§è¦‹ã¦ã­  \r\n`MediaMuxer`ã‚’é–‹å§‹ã™ã‚‹ã«ã¯ã€`MediaCodec`ã‚’é–‹å§‹ã—ãŸå¾Œã«å–å¾—ã§ãã‚‹`MediaFormat`ã‚’å¾…ã¤å¿…è¦ãŒã‚ã‚Šã¾ã™...\r\n\r\n```kotlin\r\n/**\r\n * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n * \r\n * @param rawFile åœ§ç¸®ã—ã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿\r\n * @param resultFile ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿\r\n */\r\nsuspend fun encode(\r\n    rawFile: File,\r\n    resultFile: File\r\n) = withContext(Dispatchers.Default) {\r\n    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–\r\n    val audioEncoder = AudioEncoder().apply {\r\n        prepareEncoder(\r\n            codec = MediaFormat.MIMETYPE_AUDIO_AAC,\r\n            sampleRate = 44_100,\r\n            channelCount = 2,\r\n            bitRate = 192_000\r\n        )\r\n    }\r\n    // ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä¿å­˜ã—ã¦ã„ãã‚„ã¤\r\n    val mediaMuxer = MediaMuxer(resultFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4)\r\n    var trackIndex = -1\r\n    rawFile.inputStream().use { inputStream ->\r\n        audioEncoder.startAudioEncode(\r\n            onRecordInput = { bytes ->\r\n                // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã™\r\n                inputStream.read(bytes)\r\n            },\r\n            onOutputBufferAvailable = { byteBuffer, bufferInfo ->\r\n                // ç„¡ã„ã¨æ€ã†ã‘ã© MediaMuxer ãŒé–‹å§‹ã—ã¦ã„ãªã‘ã‚Œã°è¿½åŠ ã—ãªã„\r\n                if (trackIndex != -1) {\r\n                    mediaMuxer.writeSampleData(trackIndex, byteBuffer, bufferInfo)\r\n                }\r\n            },\r\n            onOutputFormatAvailable = {\r\n                // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒç¢ºå®šã—ãŸã‚‰ MediaMuxer ã‚’é–‹å§‹ã™ã‚‹\r\n                trackIndex = mediaMuxer.addTrack(it)\r\n                mediaMuxer.start()\r\n            }\r\n        )\r\n    }\r\n    mediaMuxer.stop()\r\n}\r\n```\r\n\r\n## å‡ºæ¥ãŸéŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç«¯æœ«ã®éŸ³æ¥½ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã•ã›ã‚‹\r\næœ€å¾Œï¼  \r\nå®Œæˆå“ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç«¯æœ«ã®éŸ³å£°ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™ï¼  \r\nã¨ã„ã†ã®ã‚‚ã€ä½œæ¥­ã®ãŸã‚ã«ã™ã¹ã¦ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’`Context#getExternalFilesDir`ã§è¿”ã•ã‚Œã‚‹ä¿å­˜å…ˆã«æ›¸ãè¾¼ã‚“ã§ã„ãŸã‚ã‘ã§ã™ãŒã€ï¼ˆ`Java`ã®`File`ã‚¯ãƒ©ã‚¹ãŒä½¿ãˆã‚‹ã®ã§ä¸€æ™‚çš„ã«ãƒ•ã‚©ãƒ«ãƒ€ä½œã‚‹ã®ã«è‰¯ã„ï¼‰  \r\nã“ã®ä¿å­˜å…ˆã¨ã„ã†ã®ã¯ã‚¢ãƒ—ãƒªå›ºæœ‰ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã¨ã‹è¨€ã‚ã‚Œã¦ã„ã¦ã€ä»–ã®ã‚¢ãƒ—ãƒªã‹ã‚‰ã‚¢ã‚¯ã‚»ã‚¹ã§ããªã„ã‚“ã§ã™ã‚ˆã­...  \r\nï¼ˆã¡ãªã¿ã«`sdcard/Android/data/{applicationId}`ã¿ãŸã„ãªä¿å­˜å…ˆãƒ‘ã‚¹ã«ãªã‚‹ã¯ãšï¼‰\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€`MediaStore (ContentResolver ?)`ã«éŸ³æ¥½ãƒ‡ãƒ¼ã‚¿è¿½åŠ ã‚’ä¾é ¼ã—ã¦ã€ãã£ã¡ã«ãƒ‡ãƒ¼ã‚¿ã‚’ç§»å‹•ã•ã›ã¾ã™ï¼  \r\nã“ã‚Œã§ä»–ã®ã‚¢ãƒ—ãƒªã‹ã‚‰å‚ç…§ã§ãã‚‹ã¯ãšã§ã™ï¼ï¼ï¼\r\n\r\n`new File(\"sdcard/Music/VocalOnly\")`ã¿ãŸã„ãªã‚³ãƒ¼ãƒ‰ã¯å‹•ã‹ãªã„ã®ã§ã€å¤§äººã—ããƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã©ãŠã‚Šã«ã—ã¾ã—ã‚‡ã†...  \r\nhttps://developer.android.com/training/data-storage/shared/media\r\n\r\n```kotlin\r\n/**\r\n * éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç«¯æœ«ã®éŸ³å£°ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n *\r\n * @param context [Context]\r\n * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n * @param targetFile éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«\r\n */\r\nsuspend fun copyToAudioFolder(\r\n    context: Context,\r\n    fileName: String,\r\n    targetFile: File\r\n) = withContext(Dispatchers.IO) {\r\n    val contentResolver = context.contentResolver\r\n    // åå‰ã¨ã‹\r\n    val contentValues = contentValuesOf(\r\n        MediaStore.Audio.Media.DISPLAY_NAME to fileName,\r\n        // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ã‚‹å ´åˆ\r\n        MediaStore.Audio.Media.RELATIVE_PATH to \"${Environment.DIRECTORY_MUSIC}/VocalOnlyTrack\"\r\n    )\r\n    // è¿½åŠ ã™ã‚‹\r\n    val uri = contentResolver.insert(\r\n        if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) MediaStore.Video.Media.getContentUri(MediaStore.VOLUME_EXTERNAL) else MediaStore.Video.Media.EXTERNAL_CONTENT_URI,\r\n        contentValues\r\n    ) ?: return@withContext\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n    targetFile.inputStream().use { inputStream ->\r\n        contentResolver.openOutputStream(uri)?.use { outputStream ->\r\n            // Kotlin æ‹¡å¼µé–¢æ•°ã§ã‚³ãƒ”ãƒ¼ ä¸€ç™º\r\n            inputStream.copyTo(outputStream)\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Uri ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã‚¯ã‚¨ãƒªã™ã‚‹\r\n * \r\n * @param uri [Uri]\r\n * @param context [Context]\r\n * @return ãƒ•ã‚¡ã‚¤ãƒ«å\r\n */\r\nsuspend fun getFileNameFromUri(\r\n    context: Context,\r\n    uri: Uri\r\n) = withContext(Dispatchers.IO) {\r\n    // DISPLAY_NAME ã‚’ SELECT ã™ã‚‹\r\n    context.contentResolver.query(uri, arrayOf(MediaStore.Audio.Media.DISPLAY_NAME), null, null, null)?.use { cursor ->\r\n        // DB ã®å…ˆé ­ã«ç§»å‹•ã—ã¦ã€\r\n        cursor.moveToFirst()\r\n        cursor.getString(cursor.getColumnIndexOrThrow(MediaStore.Audio.Media.DISPLAY_NAME))\r\n    }\r\n}\r\n```\r\n\r\n## ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰\r\n\r\nã¤ãã¯ã“ã‚Œã‚‰ã‚’UIã‹ã‚‰å‘¼ã³å‡ºã—ã¦ã„ãã¾ã™...\r\n\r\n```kotlin\r\n/** ãƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Šå‡ºã™å‡¦ç†ã‚’è¡Œã† */\r\n/** ãƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Šå‡ºã™å‡¦ç†ã‚’è¡Œã† */\r\nobject VocalOnlyProcessor {\r\n\r\n    /**\r\n     * éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n     *\r\n     * @param fileDescriptor [android.content.ContentResolver.openFileDescriptor]\r\n     * @param outputFile å‡ºåŠ›å…ˆãƒ•ã‚¡ã‚¤ãƒ«\r\n     */\r\n    suspend fun decode(\r\n        fileDescriptor: FileDescriptor,\r\n        outputFile: File\r\n    ) = withContext(Dispatchers.Default) {\r\n        // ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã‚„ã¤\r\n        val extractor = MediaExtractor().apply {\r\n            setDataSource(fileDescriptor)\r\n        }\r\n        // éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã‚’è¦‹ã¤ã‘ã‚‹\r\n        // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãªã‚‰ã€éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã—ã‹ç„¡ã„ã¯ãšãªã®ã§ã€0 æ±ºã‚æ‰“ã¡ã§ã‚‚è‰¯ã•ãã†\r\n        val audioTrackIndex = (0 until extractor.trackCount)\r\n            .first { extractor.getTrackFormat(it).getString(MediaFormat.KEY_MIME)?.startsWith(\"audio/\") == true }\r\n        // ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã«ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ã‚’æ¸¡ã™\r\n        val audioDecoder = AudioDecoder().apply {\r\n            prepareDecoder(extractor.getTrackFormat(audioTrackIndex))\r\n        }\r\n        extractor.selectTrack(audioTrackIndex)\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€æº–å‚™\r\n        outputFile.outputStream().use { outputStream ->\r\n            // ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n            audioDecoder.startAudioDecode(\r\n                readSampleData = { byteBuffer ->\r\n                    // ãƒ‡ãƒ¼ã‚¿ã‚’é€²ã‚ã‚‹\r\n                    val size = extractor.readSampleData(byteBuffer, 0)\r\n                    extractor.advance()\r\n                    size to extractor.sampleTime\r\n                },\r\n                onOutputBufferAvailable = { bytes ->\r\n                    // ãƒ‡ãƒ¼ã‚¿ã‚’æ›¸ãè¾¼ã‚€\r\n                    outputStream.write(bytes)\r\n                }\r\n            )\r\n        }\r\n    }\r\n\r\n    /**\r\n     * é€šå¸¸ç‰ˆã‹ã‚‰ã‚«ãƒ©ã‚ªã‚±ç‰ˆã‚’å¼•ã„ã¦ãƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Šå‡ºã™\r\n     *\r\n     * @param normalTrackFile é€šå¸¸ç‰ˆã®ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿\r\n     * @param instrumentalTrackFile ã‚«ãƒ©ã‚ªã‚±ç‰ˆã®ãƒ‡ã‚³ãƒ¼ãƒ‰æ¸ˆã¿ãƒ‡ãƒ¼ã‚¿\r\n     * @param resultFile ä¿å­˜å…ˆ\r\n     */\r\n    suspend fun extract(\r\n        normalTrackFile: File,\r\n        instrumentalTrackFile: File,\r\n        resultFile: File\r\n    ) = withContext(Dispatchers.IO) {\r\n        resultFile.outputStream().use { resultOutputStream ->\r\n            normalTrackFile.inputStream().use { normalTrackInputStream ->\r\n                instrumentalTrackFile.inputStream().use { instrumentalTrackInputStream ->\r\n                    // ãƒ‡ãƒ¼ã‚¿ãŒç„¡ããªã‚‹ã¾ã§\r\n                    while (isActive) {\r\n                        // ã¡ã‚‡ã£ã¨ãšã¤å–ã‚Šå‡ºã—ã¦ã€éŸ³ã®åŠ å·¥ã‚’ã—ã¦ã„ã\r\n                        // ä¸€æ°—ã«èª­ã¿å–ã‚‹ã®ã¯å¤šåˆ†ç„¡ç†\r\n                        val normalTrackByteArray = ByteArray(BYTE_ARRAY_SIZE).also { byteArray -> normalTrackInputStream.read(byteArray) }\r\n                        val instrumentalTrackByteArray = ByteArray(BYTE_ARRAY_SIZE).also { byteArray -> instrumentalTrackInputStream.read(byteArray) }\r\n\r\n                        // é€šå¸¸ç‰ˆã‹ã‚‰ã‚«ãƒ©ã‚ªã‚±ç‰ˆã‚’å¼•ãå‡¦ç†\r\n                        val size = max(normalTrackByteArray.size, instrumentalTrackByteArray.size)\r\n                        val vocalOnlyByteArray = (0 until size)\r\n                            .map { index -> (normalTrackByteArray[index] - instrumentalTrackByteArray[index]).toByte() }\r\n                            .toByteArray()\r\n                        // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãè¾¼ã‚€\r\n                        resultOutputStream.write(vocalOnlyByteArray)\r\n\r\n                        // ã©ã¡ã‚‰ã‹ã®ãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã¿è¾¼ã¿çµ‚ã‚ã£ãŸã‚‰ã€ç„¡é™ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹\r\n                        if (normalTrackInputStream.available() == 0 || instrumentalTrackInputStream.available() == 0) {\r\n                            break\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n     *\r\n     * @param rawFile åœ§ç¸®ã—ã¦ã„ãªã„ãƒ‡ãƒ¼ã‚¿\r\n     * @param resultFile ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿\r\n     */\r\n    suspend fun encode(\r\n        rawFile: File,\r\n        resultFile: File\r\n    ) = withContext(Dispatchers.Default) {\r\n        // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã‚’åˆæœŸåŒ–\r\n        val audioEncoder = AudioEncoder().apply {\r\n            prepareEncoder(\r\n                codec = MediaFormat.MIMETYPE_AUDIO_AAC,\r\n                sampleRate = 44_100,\r\n                channelCount = 2,\r\n                bitRate = 192_000\r\n            )\r\n        }\r\n        // ã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã«ä¿å­˜ã—ã¦ã„ãã‚„ã¤\r\n        val mediaMuxer = MediaMuxer(resultFile.path, MediaMuxer.OutputFormat.MUXER_OUTPUT_MPEG_4)\r\n        var trackIndex = -1\r\n        rawFile.inputStream().use { inputStream ->\r\n            audioEncoder.startAudioEncode(\r\n                onRecordInput = { bytes ->\r\n                    // ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ€ãƒ¼ã«æ¸¡ã™\r\n                    inputStream.read(bytes)\r\n                },\r\n                onOutputBufferAvailable = { byteBuffer, bufferInfo ->\r\n                    // ç„¡ã„ã¨æ€ã†ã‘ã© MediaMuxer ãŒé–‹å§‹ã—ã¦ã„ãªã‘ã‚Œã°è¿½åŠ ã—ãªã„\r\n                    if (trackIndex != -1) {\r\n                        mediaMuxer.writeSampleData(trackIndex, byteBuffer, bufferInfo)\r\n                    }\r\n                },\r\n                onOutputFormatAvailable = {\r\n                    // ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãŒç¢ºå®šã—ãŸã‚‰ MediaMuxer ã‚’é–‹å§‹ã™ã‚‹\r\n                    trackIndex = mediaMuxer.addTrack(it)\r\n                    mediaMuxer.start()\r\n                }\r\n            )\r\n        }\r\n        mediaMuxer.stop()\r\n    }\r\n\r\n    /**\r\n     * éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç«¯æœ«ã®éŸ³å£°ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n     *\r\n     * @param context [Context]\r\n     * @param fileName ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     * @param targetFile éŸ³æ¥½ãƒ•ã‚¡ã‚¤ãƒ«\r\n     */\r\n    suspend fun copyToAudioFolder(\r\n        context: Context,\r\n        fileName: String,\r\n        targetFile: File\r\n    ) = withContext(Dispatchers.IO) {\r\n        val contentResolver = context.contentResolver\r\n        // åå‰ã¨ã‹\r\n        val contentValues = contentValuesOf(\r\n            MediaStore.Audio.Media.DISPLAY_NAME to fileName,\r\n            // ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’æ˜ã‚‹å ´åˆ\r\n            MediaStore.Audio.Media.RELATIVE_PATH to \"${Environment.DIRECTORY_MUSIC}/VocalOnlyTrack\"\r\n        )\r\n        // è¿½åŠ ã™ã‚‹\r\n        val uri = contentResolver.insert(\r\n            if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.Q) MediaStore.Audio.Media.getContentUri(MediaStore.VOLUME_EXTERNAL) else MediaStore.Video.Media.EXTERNAL_CONTENT_URI,\r\n            contentValues\r\n        ) ?: return@withContext\r\n        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n        targetFile.inputStream().use { inputStream ->\r\n            contentResolver.openOutputStream(uri)?.use { outputStream ->\r\n                // Kotlin æ‹¡å¼µé–¢æ•°ã§ã‚³ãƒ”ãƒ¼ ä¸€ç™º\r\n                inputStream.copyTo(outputStream)\r\n            }\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Uri ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«åã‚’ã‚¯ã‚¨ãƒªã™ã‚‹\r\n     *\r\n     * @param uri [Uri]\r\n     * @param context [Context]\r\n     * @return ãƒ•ã‚¡ã‚¤ãƒ«å\r\n     */\r\n    suspend fun getFileNameFromUri(\r\n        context: Context,\r\n        uri: Uri\r\n    ) = withContext(Dispatchers.IO) {\r\n        // DISPLAY_NAME ã‚’ SELECT ã™ã‚‹\r\n        context.contentResolver.query(uri, arrayOf(MediaStore.Audio.Media.DISPLAY_NAME), null, null, null)?.use { cursor ->\r\n            // DB ã®å…ˆé ­ã«ç§»å‹•ã—ã¦ã€\r\n            cursor.moveToFirst()\r\n            cursor.getString(cursor.getColumnIndexOrThrow(MediaStore.Audio.Media.DISPLAY_NAME))\r\n        }\r\n    }\r\n\r\n    private const val BYTE_ARRAY_SIZE = 8192\r\n\r\n}\r\n```\r\n\r\n## ã¤ãªãåˆã‚ã›ã‚‹\r\n`UI`ã‹ã‚‰ã•ã£ãä½œã£ãŸé–¢æ•°ã‚’å‘¼ã³å‡ºã—ã¦ã„ãã¾ã™ã€‚  \r\næœ¬å½“ã¯`UI`ã§ã¯ãªãã€`ãƒ•ã‚©ã‚¢ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹`ãªã‚“ã‹ã§`Activity`ã‚’ç ´æ£„ã—ãŸå¾Œã§ã‚‚å‹•ãã‚ˆã†ã«ã™ã¹ãã§ã™  \r\n\r\nã¨ã„ã†ã‚ã‘ã§ UI ã®ã‚³ãƒ¼ãƒ‰å…¨éƒ¨å¼µã‚Šã¾ã™ï¼ã©ãƒ¼ãƒ¼ãƒ¼ã‚“\r\n\r\nã‚„ã£ã¦ã‚‹ã“ã¨ã¯ã‚³ãƒ¡ãƒ³ãƒˆã«æ›¸ã„ã¦ã‚‹ã®ã§è¦‹ã¦ãã ã•ã„ï¼ˆå…¨æŠ•ã’\r\n\r\n```kotlin\r\nclass MainActivity : ComponentActivity() {\r\n\r\n    override fun onCreate(savedInstanceState: Bundle?) {\r\n        super.onCreate(savedInstanceState)\r\n        setContent {\r\n            VocalOnlyDroidTheme {\r\n                HomeScreen()\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\n@OptIn(ExperimentalMaterial3Api::class)\r\n@Composable\r\nfun HomeScreen() {\r\n    val context = LocalContext.current\r\n    val scope = rememberCoroutineScope()\r\n\r\n    // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã® Uri\r\n    val normalTrackUri = remember { mutableStateOf<Uri?>(null) }\r\n    val instrumentalTrackUri = remember { mutableStateOf<Uri?>(null) }\r\n\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼\r\n    val normalTrackFilePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.OpenDocument()) { normalTrackUri.value = it }\r\n    val instrumentalTrackFilePicker = rememberLauncherForActivityResult(contract = ActivityResultContracts.OpenDocument()) { instrumentalTrackUri.value = it }\r\n\r\n    val progressStatus = remember { mutableStateOf(ProgressStatus.IDLE) }\r\n\r\n    // å‡¦ç†å†…å®¹\r\n    fun start() {\r\n        scope.launch(Dispatchers.Default) {\r\n\r\n            // ä½œæ¥­ç”¨ã®ä»®ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã‚‹\r\n            val tempFolder = context.getExternalFilesDir(null)?.resolve(\"temp_work\")!!.apply {\r\n                mkdir()\r\n            }\r\n\r\n            // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‡ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n            progressStatus.value = ProgressStatus.DECODE\r\n            val (normalRawFile, instrumentalRawFile) = listOf(normalTrackUri.value!!, instrumentalTrackUri.value!!)\r\n                .mapIndexed { index, uri ->\r\n                    // ä¸¦åˆ—ã§ãƒ‡ã‚³ãƒ¼ãƒ‰ã—ã¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿”ã™\r\n                    async {\r\n                        context.contentResolver.openFileDescriptor(uri, \"r\")!!.use {\r\n                            val rawFile = File(tempFolder, \"audio_$index.raw\").apply { createNewFile() }\r\n                            VocalOnlyProcessor.decode(\r\n                                fileDescriptor = it.fileDescriptor,\r\n                                outputFile = rawFile\r\n                            )\r\n                            return@use rawFile\r\n                        }\r\n                    }\r\n                }\r\n                // ä¸¦åˆ—ã§å®Ÿè¡Œã—ãŸå‡¦ç†ã‚’å¾…ã¡åˆã‚ã›ã‚‹\r\n                .map { it.await() }\r\n\r\n            // ãƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Šå‡ºã™\r\n            progressStatus.value = ProgressStatus.EDIT\r\n            val vocalRawFile = tempFolder.resolve(\"audio_vocal.raw\").apply { createNewFile() }\r\n            VocalOnlyProcessor.extract(\r\n                normalTrackFile = normalRawFile,\r\n                instrumentalTrackFile = instrumentalRawFile,\r\n                resultFile = vocalRawFile\r\n            )\r\n\r\n            // ç”Ÿãƒ‡ãƒ¼ã‚¿ã‚’ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹\r\n            progressStatus.value = ProgressStatus.ENCODE\r\n            val encodeVocalFile = tempFolder.resolve(\"audio_vocal.aac\").apply { createNewFile() }\r\n            VocalOnlyProcessor.encode(\r\n                rawFile = vocalRawFile,\r\n                resultFile = encodeVocalFile\r\n            )\r\n\r\n            // ãƒ•ã‚¡ã‚¤ãƒ«ã‚’éŸ³æ¥½ãƒ•ã‚©ãƒ«ãƒ€ã«ã‚³ãƒ”ãƒ¼ã™ã‚‹\r\n            progressStatus.value = ProgressStatus.ONE_MORE_THING\r\n            val fileName = VocalOnlyProcessor.getFileNameFromUri(context, normalTrackUri.value!!)!!\r\n            VocalOnlyProcessor.copyToAudioFolder(\r\n                context = context,\r\n                fileName = \"$fileName.aac\",\r\n                targetFile = encodeVocalFile\r\n            )\r\n\r\n            // å¾Œå§‹æœ«\r\n            tempFolder.deleteRecursively()\r\n            progressStatus.value = ProgressStatus.IDLE\r\n        }\r\n    }\r\n\r\n    Scaffold(\r\n        topBar = { TopAppBar(title = { Text(text = stringResource(id = R.string.app_name)) }) }\r\n    ) {\r\n        Column(\r\n            modifier = Modifier.padding(it),\r\n            verticalArrangement = Arrangement.spacedBy(5.dp)\r\n        ) {\r\n\r\n            Button(\r\n                onClick = { normalTrackFilePicker.launch(arrayOf(\"audio/*\")) }\r\n            ) { Text(text = normalTrackUri.value?.toString() ?: \"é€šå¸¸ç‰ˆã®é¸æŠ\") }\r\n\r\n            Button(\r\n                onClick = { instrumentalTrackFilePicker.launch(arrayOf(\"audio/*\")) }\r\n            ) { Text(text = instrumentalTrackUri.value?.toString() ?: \"ã‚«ãƒ©ã‚ªã‚±ç‰ˆã®é¸æŠ\") }\r\n\r\n            // å®Ÿè¡Œä¸­ã¯å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’å‡ºã•ãªã„\r\n            if (progressStatus.value == ProgressStatus.IDLE) {\r\n                Button(\r\n                    onClick = { start() }\r\n                ) { Text(text = \"å‡¦ç†ã‚’å§‹ã‚ã‚‹\") }\r\n            } else {\r\n                CircularProgressIndicator()\r\n                Text(text = \"å‡¦ç†ä¸­ã§ã™ï¼š${progressStatus.value}\")\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nprivate enum class ProgressStatus {\r\n    /** å®Ÿè¡Œå¯èƒ½ */\r\n    IDLE,\r\n\r\n    /** ãƒ‡ã‚³ãƒ¼ãƒ‰ä¸­ */\r\n    DECODE,\r\n\r\n    /** éŸ³å£°ã®åŠ å·¥ä¸­ */\r\n    EDIT,\r\n\r\n    /** ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä¸­ */\r\n    ENCODE,\r\n\r\n    /** ã‚ã¨ã—ã¾ã¤ */\r\n    ONE_MORE_THING\r\n}\r\n```\r\n\r\n# ä½¿ã£ã¦ã¿ãŸ\r\nå¤šåˆ†å®Ÿè¡Œã§ãã‚‹ã¯ãšã€‚  \r\nèµ·å‹•ã—ãŸã‚‰ãã‚Œãã‚Œãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸ã‚“ã§å‡¦ç†ã‚’é–‹å§‹ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/9A2ASVs.png)\r\n\r\n![Imgur](https://imgur.com/HRmVKQ8.png)\r\n\r\nä¿å­˜å…ˆã¯ã“ã“ã«ãªã‚Šã¾ã™ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/gRoaKrP.png)\r\n\r\n# æ„Ÿæƒ³\r\n\r\n- ã†ã¾ããƒœãƒ¼ã‚«ãƒ«ã ã‘å–ã‚Œã‚‹ ãƒ‘ã‚¿ãƒ¼ãƒ³\r\n- è‹¥å¹²ãƒœãƒ¼ã‚«ãƒ«ä»¥å¤–ã‚‚å…¥ã£ã¦ã‚‹ ãƒ‘ã‚¿ãƒ¼ãƒ³\r\n- å¤±æ•—ã—ã¡ã‚ƒã† ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆéŸ³å‰²ã‚Œï¼‰\r\n\r\nã„ãã¤ã‹è©¦ã—ã¾ã—ãŸãŒçµæ§‹ãªç¢ºç‡ã§å¤±æ•—ã—ã¡ã‚ƒã„ã¾ã™ã­ã€‚  \r\nåŸå› ã¯ãŠãã‚‰ãã€éŸ³å£°ã®æ³¢ãŒé€šå¸¸ç‰ˆã¨ã‚«ãƒ©ã‚ªã‚±ç‰ˆã§è‹¥å¹²ãšã‚Œã¦ã‚‹ã“ã¨ãŒã‚ã‚‹ã‚“ã§ã™ã‚ˆã­ã€ã€ã€ï¼ˆã‚ªãƒ•ã‚»ãƒƒãƒˆãŒã‚ã‚‹ï¼Ÿï¼‰  \r\n`Audacity`ã§é€†ä½ç›¸ã«ã—ã¦åŒæ™‚å†ç”Ÿã™ã‚‹æ–¹æ³•ã§ã‚‚ã€ã¾ãšã¯æ³¢ã‚’åˆã‚ã›ã‚‹ä½œæ¥­ã‚’ã™ã‚‹å¿…è¦ãŒã‚ã‚‹å ´åˆãŒãŒå¤šãã€  \r\nä»Šå›ã®ã‚ˆã†ã«ãã®ã¾ã¾ã‚«ãƒ©ã‚ªã‚±ç‰ˆãƒˆãƒ©ãƒƒã‚¯ã‚’é€†ä½ç›¸ã«ã—ã¦ï¼ˆé€šå¸¸ç‰ˆã‹ã‚‰å¼•ãç®—ã—ã¦ï¼‰åŒæ™‚å†ç”Ÿã—ã¦ã‚‚ã†ã¾ãæŠœã‘ã¾ã›ã‚“ã€‚\r\n\r\nãªã‹ãªã‹é›£ã—ã„...ã†ã¾ãæŠœã‘ã‚‹ã¨ã»ã‚“ã¨ã«ãƒœãƒ¼ã‚«ãƒ«ã—ã‹èã“ãˆãªãã¦æ„Ÿå‹•ã‚‚ã®ãªã®ã§ã™ãŒ...\r\n\r\n# ããƒ¼ã™ã“ãƒ¼ã©\r\nã©ã†ã  \r\næœ€æ–°ã® Android Studio ã§å®Ÿè¡Œã§ãã‚‹ã¯ãšã§ã™ã€‚\r\n\r\nhttps://github.com/takusan23/VocalOnlyDroid\r\n\r\n# ãŠã‚ã‚Šã«\r\n8æœˆã‚‚çµ‚ã‚ã‚Šã¾ã™ã­...\r\n\r\nå…¨ç„¶è©±å¤‰ã‚ã‚‹ã‚“ã ã‘ã©ã€ä¸‰äº•ä½å‹éŠ€è¡Œã•ã‚“ã•ã‚...ãƒ¡ãƒ¼ãƒ«æ™®é€šã«ãƒ“ãƒ“ã‚‹ã‹ã‚‰ã‚„ã‚ã¦ã»ã—ã„\r\n\r\n![Imgur](https://imgur.com/eWb136O.png)\r\n\r\nå±•é–‹ã™ã‚‹ã¨ã¡ã‚ƒã‚“ã¨ã‚¦ã‚½ã§ã‚ã‚‹ã“ã¨ãŒæ›¸ã„ã¦ã‚ã‚‹\r\n\r\n![Imgur](https://imgur.com/GGsYLqt.png)"},{"title":"å¤ä¼‘ã¿ä¼ç”»ã€€ç§‹è‘‰åŸã®ä¸­å¤ã‚¨ãƒ­ã‚²ã‚·ãƒ§ãƒƒãƒ—ã‚ãã‚Š","link":"/posts/summer_vacation_r3_akiba_used_eroge/","markdown":"\nã¡ãªã¿ã«ç§ã¯ç¤¾ä¼šäººãªã®ã§å¤ä¼‘ã¿ã‚ã‚Šã¾ã›ã‚“ã€‚  \nå­¦ç”Ÿå„ä½ã¯æ¥½ã—ã‚“ã§ï¼ˆã¾ã‚é«˜æ ¡ç”Ÿä»¥ä¸‹ã¯ã“ã®è¨˜äº‹èª­ã‚“ã§ã‚‚å®Ÿè·µã§ããªã„ãª...ï¼‰\n\n# æœ¬é¡Œ\nçŸ¥ã£ã¦ã‚‹é™ã‚Šä¸­å¤ã‚¨ãƒ­ã‚²ã‚’æ‰±ã£ã¦ã‚‹ãŠåº—ã‚’ç´¹ä»‹ã—ã¾ã™ã€‚  \nã‚¨ãƒ­ã‚²ã‚µã‚¦ãƒ³ãƒ‰ãƒˆãƒ©ãƒƒã‚¯ã®å–ã‚Šæ‰±ã„ã‚‚åˆ†ã‹ã‚‹ç¯„å›²ã§ã€‚Kyashï¼ˆKyash Card Liteã®æ–¹ï¼‰ãŒä½¿ãˆã‚‹ã‹ã©ã†ã‹ã‚‚è²·ã£ãŸã“ã¨ãŒã‚ã‚‹åº—èˆ—ã ã£ãŸã‚‰æ›¸ã„ã¦ãŠãã¾ã™ã€‚  \næœ¬å½“ã¯Xiaomi Mi 11 Lite 5Gã®è¨˜äº‹ã‚’æ›¸ã“ã†ã¨æ€ã„ã¾ã—ãŸãŒäºˆå®šå¤‰æ›´ã€‚\n\n# ä»Šå›è¡ŒããŠåº—\n\n- [ã‚½ãƒ•ãƒãƒƒãƒ—AKIBA ã‚½ãƒ•ãƒˆé¤¨](#ã‚½ãƒ•ãƒãƒƒãƒ—AKIBAã‚½ãƒ•ãƒˆé¤¨)\n    - HPï¼šhttps://www.sofmap.com/tenpo/contents/?id=shops&sid=akiba_soft\n    - äºŒéšãŒæ–°ä½œã€ä¸‰éšãŒä¸­å¤\n\n- ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ (æœ¬åº—ã€2ã€3å·åº—)\n    - HPï¼šhttp://www.e-trader.jp/shop/akiba01.html\n    - [æœ¬åº—](#ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼æœ¬åº—)\n        - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯5éš\n        - CDã¯4éš\n    - [2å·åº—](#ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼2å·åº—)\n        - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯2éš\n    - [3å·åº—](#ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼3å·åº—)\n        - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯4éš\n        - CDã¯1éš\n\n- [é§¿æ²³å±‹ï¼ˆç§‹è‘‰åŸæœ¬é¤¨ï¼‰](#é§¿æ²³å±‹)\n    - HPï¼šhttps://www.suruga-ya.jp/feature/akihabara_main/index.html\n    - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯7éš\n\n- [ã¾ã‚“ã ã‚‰ã‘ï¼ˆã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹ï¼‰](#ã¾ã‚“ã ã‚‰ã‘)\n    - HPï¼šhttps://www.mandarake.co.jp/dir/cmp/\n    - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯4éš\n    - CDã‚‚4éšã«ãŠã„ã¦ã‚ã£ãŸ\n\n- [ã‚‰ã—ã‚“ã°ã‚“](#ã‚‰ã—ã‚“ã°ã‚“)\n    - https://www.lashinbang.com/store/13/\n    - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯2éšã®ã®ã‚Œã‚“ã‹ã‹ã£ã¦ã‚‹ã¨ã“ã‚\n    - CDã¯CDã‚³ãƒ¼ãƒŠãƒ¼ã«ã‚ã£ãŸï¼ˆã®ã‚Œã‚“ã®ã¨ã“ã‚ã˜ã‚ƒãªã„ï¼‰\n\n- ãƒ ãƒ¼ãƒ©ãƒ³ï¼ˆæœ¬åº—ã€ä¸­å¤®é€šã‚Šåº—ï¼‰\n    - HPï¼šhttp://www.mooran.co.jp/\n    - [æœ¬åº—](#ãƒ ãƒ¼ãƒ©ãƒ³æœ¬åº—)\n        - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯2éš\n    - [ä¸­å¤®é€šã‚Šåº—](#ãƒ ãƒ¼ãƒ©ãƒ³ä¸­å¤®é€šã‚Šåº—)\n        - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯4éš\n\n- [K-Booksï¼ˆç§‹è‘‰åŸæœ¬é¤¨ï¼‰](#K-Books)\n    - HPï¼šhttps://k-books.co.jp/shop/akihabara_honkan\n    - ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯3éš\n    - CDã‚‚3éš\n    - ã©ã£ã¡ã‹ã£ã¦ã„ã†ã¨ã‚°ãƒƒã‚ºãŒãƒ¡ã‚¤ãƒ³ãªé›°å›²æ°—\n\n# ãŠã™ã™ã‚ã®é †ç•ªï¼Ÿ\næœ€åˆã«ã‚½ãƒ•ãƒãƒƒãƒ—ç›®æŒ‡ã—ã¦ã€ã‚ã¨ã¯é§…ã«æˆ»ã‚‹æ„Ÿã˜ã§ç§ã¯ã„ã¤ã‚‚ã—ã¦ã‚‹ã€‚      \nã‚ã¨ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã®3å·åº—ã¯ä¸­å¤®é€šã‚Šã‚’æ¨ªæ–­ã™ã‚‹ï¼ˆãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã®æ–¹ï¼‰å¿…è¦ãŒã‚ã‚‹ã®ã§ã©ã†ã™ã‚‹ã‹ãªã€‚  \n`ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ 2å·åº—`ã¨`ãƒ ãƒ¼ãƒ©ãƒ³ æœ¬åº—`ã¯è¿‘ã„ã€‚ã¡ã‚‡ã£ã¨æ­©ã‘ã°`ã‚‰ã—ã‚“ã°ã‚“`ã¨`ãƒ ãƒ¼ãƒ©ãƒ³ ä¸­å¤®é€šã‚Šåº—`ã«ã‚‚è¡Œã‘ã‚‹ã€‚  \n`é§¿æ²³å±‹`ã¨`ã¾ã‚“ã ã‚‰ã‘`ã‚‚è¿‘ã„ã€‚\n\n# è¡Œãå‰ã«\nå¹´é½¢ç¢ºèªã§ãã‚‹ã‚„ã¤ã‚’æŒã£ã¦ã„ã“ã†ã€‚  \n~~ä»Šã¾ã§ã§ä¸€å›ã ã‘èã‹ã‚ŒãŸäº‹ãŒã‚ã‚‹~~\n\n# <span id=\"ã‚½ãƒ•ãƒãƒƒãƒ—AKIBAã‚½ãƒ•ãƒˆé¤¨\">ã‚½ãƒ•ãƒãƒƒãƒ—AKIBA ã‚½ãƒ•ãƒˆé¤¨</span>\n~~å†™çœŸæ’®ã‚Šãã“ã­ãŸã®ã§4æœˆã®å†™çœŸã‚’ä»£ã‚ã‚Šã«ï¼ˆæ¬¡è¡Œã£ãŸã¨ãå–ã‚Šç›´ã—ã¦ãã‚‹ï¼‰~~ å–ã‚Šç›´ã—ã¦ãã¾ã—ãŸã€‚ã¤ã„ã§ã«äºˆç´„ã—ã¦ããŸã€‚ã‹ã‚ã„ã„  \nãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«å‰ã‚’çŸ¥ã‚‰ãªã„ã®ã§å°‘ã—æ®‹å¿µã€‚\n\n![Imgur](https://imgur.com/dYNQqBD.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d12960.043336936349!2d139.771178!3d35.701351!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xec9b4fc028069b57!2z44K944OV44Oe44OD44OXIEFLSUJBIOOCveODleODiOmkqA!5e0!3m2!1sja!2sjp!4v1627226250763!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nãšã£ã¨æ­©ã„ã¦ã€ã‚µã‚¤ã‚¼ã®ã‚ã‚‹ã¨ã“ã‚ã‚’æ›²ãŒã‚Œã°è¡Œã‘ã‚‹ã€‚  \næ–°ä½œã¯2éšã€ä¸­å¤ã¯3éšã«ãŠã„ã¦ã‚ã‚Šã¾ã™ã€‚  \nKyashä½¿ãˆã¾ã—ãŸã€‚  \n\næ–°ä½œã®å–ã‚Šæ‰±ã„ã«é–¢ã—ã¦ã¯ä¸€ç•ªã ã¨æ€ã„ã¾ã™ã€‚ãƒã‚¸ãƒ©ãƒ–ã¯ã‚½ãƒ•ãƒãƒƒãƒ—ã§äºˆç´„ã—ãŸã€‚  \nä¸­å¤ã¯ã¡ã‚‡ã£ã¨å€¤æ®µé«˜ã‚ãªæ°—ãŒã™ã‚‹ã€‚  \nã¨ã‚Šã‚ãˆãš`ã‚½ãƒ•ãƒãƒƒãƒ—`ã¨ã“ã®å¾Œç´¹ä»‹ã™ã‚‹`ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼`è¡Œã‘ã°ãŠç›®å½“ã¦ãŒè¦‹ã¤ã‹ã‚‹ã¨æ€ã†ã€‚  \n\n# <span id=\"ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼æœ¬åº—\">ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ æœ¬åº—</span>\nå†™çœŸã¯Mi 11 Lite 5Gã§æ’®å½±ã—ãŸã‘ã©ã€ã‚µã‚¤ã‚ºãŒã§ã‹ã™ããŸã®ã§GIMPã§å“è³ªã‚’åŠåˆ†ã«ã—ãŸç”»åƒã‚’è²¼ã‚Šã¾ã™ã€‚\n\n![Imgur](https://imgur.com/flkYYZp.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d3240.029730098827!2d139.771296!3d35.700886!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xf44917d603081bf7!2z44OI44Os44O844OA44O8IOacrOW6lw!5e0!3m2!1sja!2sjp!4v1627226235931!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\næ–°å“ã€ä¸­å¤å•ã‚ãšã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯5éšã§ã™ã€‚  \nCDã¯4éšã«ã‚ã‚Šã¾ã™ã€‚  \nKyashä½¿ãˆã¾ã—ãŸã€‚\n\nã“ã®ãŠåº—ã«é™ã‚‰ãšãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã¯å“æƒãˆãŒã„ã„æ„Ÿã˜ã€‚  \næœ¬åº—ã¯ã¡ã¨ç‹­ã„ã€‚    \nãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã®ä¸­ã§ã‚‚æœ¬åº—ã ã‘ï¼Ÿå¤§æ‰‹ã®ãƒ¡ãƒ¼ã‚«ãƒ¼ã¯ãƒ¡ãƒ¼ã‚«ãƒ¼åˆ¥ã«ä¸¦ã‚“ã§ã„ã‚‹ã®ã§å¥¥ã¾ã§é€²ã‚“ã§ã¿ã¦ã­ã€‚\n\n# <span id=\"ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼2å·åº—\">ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ 2å·åº—</span>\n\n~~å†™çœŸã¯å–ã‚Šãã“ã­ã¾ã—ãŸã€‚è¦šãˆã¦ã„ã‚Œã°æ¬¡è¡Œã£ãŸã¨ãæ’®ã£ã¦ãã¾ã™ã€‚~~ æ’®ã£ã¦ãã¾ã—ãŸã€‚\n\n![Imgur](https://imgur.com/gClfuuz.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d3240.1229465748465!2d139.77038!3d35.698592!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0xd9fcac2ce87d746d!2z44OI44Os44O844OA44O8IOeni-iRieWOnzLlj7flupc!5e0!3m2!1sja!2sjp!4v1627226930875!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\næ–°å“ã€ä¸­å¤å•ã‚ãšã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯2éšã§ã™ã€‚\n\nãŠãªã˜ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ã§ã‚‚å€¤æ®µãŒé•ã†ã“ã¨ãŒã‚ã‚‹ã€‚ã€‚ã‹ã‚‚ï¼Ÿ\n\n# <span id=\"ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼3å·åº—\">ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ 3å·åº—</span>\n\n![Imgur](https://imgur.com/xyZvjei.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d3240.059963038522!2d139.771644!3d35.700142!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x72c850c866fa53e8!2z44OI44Os44O844OA44O8IOeni-iRieWOnzPlj7flupc!5e0!3m2!1sja!2sjp!4v1627227197765!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\næ–°å“ã€ä¸­å¤å•ã‚ãšã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯4éšã§ã™ã€‚  \nCDã¯1éšã«ãŠã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚\n\nç§‹è‘‰åŸã‚¨ãƒ­ã‚²ã‚·ãƒ§ãƒƒãƒ—ã®ä¸­ã§ã‚‚åº—ã®ä¸­ãŒåºƒã„ã€‚  \nãƒ“ãƒƒã‚¯ã‚«ãƒ¡ãƒ©ã®éš£ã®æ–¹ã«ã‚ã‚‹ã€‚ã®ã§æ¨ªæ–­æ­©é“ã‚’æ¸¡ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚ã¡ã‚‡ã„ã‚ã‚“ã©ã„\n\n# <span id=\"é§¿æ²³å±‹\">é§¿æ²³å±‹ ç§‹è‘‰åŸæœ¬åº—</span>\nå†™çœŸå–ã‚‹ã®ä¸‹æ‰‹ããã‹ã‚ˆ\n\n![Imgur](https://imgur.com/vgjRTvc.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d1620.0201883535572!2d139.770562!3d35.700624!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c1dcb95431f%3A0x762fbb4675087d94!2z44CSMTAxLTAwMjEg5p2x5Lqs6YO95Y2D5Luj55Sw5Yy65aSW56We55Sw77yT5LiB55uu77yR77yR4oiS77yT!5e0!3m2!1sja!2sjp!4v1627227496352!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\næ–°ä½œã€ä¸­å¤å•ã‚ãšã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯7éšã§ã™ã€‚éšæ®µã§ä¸ŠãŒã‚‹ã®ã¯çµæ§‹ã—ã‚“ã©ã„  \n\nå“æƒãˆã‚‚ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \nå€¤æ®µã¯æ™®é€šï¼Ÿ\n\n## CDã¯ é§¿æ²³å±‹ ç§‹è‘‰åŸé§…å‰åº—\nCDã¯é§¿æ²³å±‹ ç§‹è‘‰åŸé§…å‰åº—ã«ç½®ã„ã¦ã‚ã‚Šã¾ã—ãŸã€‚  \né§…ã‹ã‚‰è¿‘ã„ã‘ã©ï¼ˆãƒ©ã‚¸ã‚ªä¼šé¤¨ã®ãŠéš£ï¼‰ã€ä»–ã®ã‚¨ãƒ­ã‚²ã‚·ãƒ§ãƒƒãƒ—ã‹ã‚‰ã¯é ã„ã€‚\n\n![Imgur](https://imgur.com/nvF5bEf.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d810.0393001366185!2d139.77159982922305!3d35.697748998761924!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c1d4da05555%3A0x6222da3b1962b0eb!2z6ae_5rKz5bGLIOeni-iRieWOn-mnheWJjeW6lw!5e0!3m2!1sja!2sjp!4v1630768780832!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nã‚²ãƒ¼ãƒ CDã¯äºŒéšã®å¥¥ã®éš…ã£ã“ã«ã‚ã‚Šã¾ã—ãŸã€‚  \nKyash Card Liteä½¿ãˆã¾ã—ãŸã€‚\n\n# <span id=\"ã¾ã‚“ã ã‚‰ã‘\">ã¾ã‚“ã ã‚‰ã‘ ã‚³ãƒ³ãƒ—ãƒ¬ãƒƒã‚¯ã‚¹</span>\n\n![Imgur](https://imgur.com/9AAeVOJ.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d6480.101558869009!2d139.770513!3d35.700368!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x8c537b9b72799bd3!2z44G-44KT44Gg44KJ44GR44Kz44Oz44OX44Os44OD44Kv44K5!5e0!3m2!1sja!2sjp!4v1627228337141!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯4éšã®å¥¥ã®æ–¹ã€‚å¤šåˆ†ä¸­å¤ã ã‘ã€‚  \n\nCDã¯ã€\n\n- 6éšã®ã‚²ãƒ¼ãƒ CDã‚³ãƒ¼ãƒŠãƒ¼ã€‚å¥¥ã®æ–¹ã€‚\n- ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã®éš£\n\nã®ã©ã£ã¡ã‹ã«ã‚ã‚‹ã¨æ€ã„ã¾ã™ã€‚ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã®éš£ã¯åˆå›ç‰¹å…¸ã§ä»˜ã„ã¦ããŸCDã¨ã‹ãŒãƒ¡ã‚¤ãƒ³ãªã®ã§ã€CDç›®çš„ã®å ´åˆã¯6éšè¡Œã£ã¦ãã ã•ã„ã€‚\n\nå“æƒãˆã¯å°‘ãªã‚ã§ã™ã€‚ã ã‘ã©å€¤æ®µãŒå®‰ã„ã€‚\n\nã“ã“ã¯Kyash Card LiteãŒä½¿ãˆãªã‹ã£ãŸã¯ãšã€‚ã“ã®ãŠåº—ã¯æš—è¨¼ç•ªå·ã«å¯¾å¿œã—ã¦ã„ã‚‹ã‚«ãƒ¼ãƒ‰ã˜ã‚ƒãªã„ã¨æ±ºæ¸ˆã§ããªã„ã¨æ€ã†ã€‚(ã¤ã¾ã‚ŠICãƒãƒƒãƒ—ãŒä»˜ã„ã¦ã‚‹ã‚«ãƒ¼ãƒ‰ã˜ã‚ƒãªã„ã¨ã ã‚)  \niDã¨ã‹ä»£æ›¿æ±ºæ¸ˆæ‰‹æ®µãŒã‚ã‚‹ã®ã§å¿ƒé…ã™ã‚‹å¿…è¦ã¯ãªã„ã¨æ€ã†ã€‚\n\n\n# <span id=\"ã‚‰ã—ã‚“ã°ã‚“\">ã‚‰ã—ã‚“ã°ã‚“</span>\n\n![Imgur](https://imgur.com/Uf2CEDE.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m14!1m8!1m3!1d6480.1704760139655!2d139.770391!3d35.69952000000001!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c1dacbd172f%3A0x6abc12977417ce04!2z44KJ44GX44KT44Gw44KT56eL6JGJ5Y6f5bqX5paw6aSo!5e0!3m2!1sja!2sus!4v1627228711576!5m2!1sja!2sus\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯2éšã®ã®ã‚Œã‚“ãŒã‹ã‹ã£ã¦ã‚‹ã¨ã“ã‚ã€‚å¤šåˆ†ä¸­å¤ã ã‘ã€‚  \nCDã¯2éšã®CDã‚³ãƒ¼ãƒŠãƒ¼ã«æ™®é€šã«ä¸¦ã‚“ã§ã‚ã‚Šã¾ã™ã€‚ã®ã‚Œã‚“ã‹ã‹ã£ã¦ãªã„  \n\n(ã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹ã®ä¸­ã«ã‚‚ã‚ã‚‹ã£ã¡ã‚ƒã‚ã‚‹ã‘ã©ã€ã‚·ãƒ§ãƒ¼ã‚±ãƒ¼ã‚¹ã®ä¸­ãªã®ã§ãŠå¯Ÿã—)\n\nå“æƒãˆã¯å°‘ãªã„ã§ã™ãŒã€å€¤æ®µãŒå®‰ã„ã€‚  \n`Sugar*Style`ãŒ2200å††ã ã£ãŸã®ã§è²·ã£ã¡ã‚ƒã£ãŸã€‚\n\nKyashä½¿ãˆã¾ã—ãŸã€‚\n\n# <span id=\"ãƒ ãƒ¼ãƒ©ãƒ³æœ¬åº—\">ãƒ ãƒ¼ãƒ©ãƒ³ æœ¬åº—</span>\nå†™çœŸã‚‚ã£ã¨ã†ã¾ãæ’®ã‚Œã‚„\n\n![Imgur](https://imgur.com/ALzjSpH.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d810.0300042318594!2d139.7692180292248!3d35.6986640987619!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c1cf98b4049%3A0xe6fc2d9a47b85b6e!2z6LK35Y-W6LKp5aOy5biC5aC044Og44O844Op44OzQUtJQkHmnKzlupc!5e0!3m2!1sja!2sjp!4v1627229573133!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ 2å·åº—ãŒã‚ã‚‹é«˜æ¶ä¸‹ã«ã‚ã‚Šã¾ã™ã€‚ãã®ã¾ã¾å¥¥ã«é€²ã‚“ã§ã„ã‘ã°ãŠï½‹ã€‚  \nã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯2éšã«ã‚ã‚Šã¾ã™ã€‚AVã°ã£ã‹ã§è¿·å­ã«ãªã‚Šã¾ã™ãŒã€çœŸã‚“ä¸­ã‚‰ã¸ã‚“ã«ã‚ã‚Šã¾ã—ãŸï¼Ÿ  \nã“ã¡ã‚‰ã‚‚å€¤æ®µãŒå®‰ã„ã€‚å“æƒãˆã¯ã¡ã‚‡ã£ã¨å¤šã„æ–¹ï¼Ÿã€‚  \nKyashä½¿ãˆã¾ã—ãŸã€‚\n\nã“ã“ã§ã¯OPã€EDå…±ã«åæ›²ã®`ã¡ã„ã•ãªå½¼å¥³ã®å°å¤œæ›²`ã‚’è²·ã„ã¾ã—ãŸã€‚**fengç”Ÿãè¿”ã‚Œ...ã€‚** å€¤æ®µãŒ1800å††ã§è²·ã†äºˆå®šãªã‹ã£ãŸã‘ã©å®‰ã‹ã£ãŸã®ã§è³¼å…¥ã—ãŸã€‚  \n\n![Imgur](https://imgur.com/xbNjp65.png)\n\n# <span id=\"ãƒ ãƒ¼ãƒ©ãƒ³ä¸­å¤®é€šã‚Šåº—\">ãƒ ãƒ¼ãƒ©ãƒ³ ä¸­å¤®é€šã‚Šåº—</span>\n\n![Imgur](https://imgur.com/BXGqPQZ.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d25920.96056003467!2d139.75225560007613!3d35.698662792538094!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c1d08f1b007%3A0x85ae0041177e526a!2z6LK35Y-W6LKp5aOy5biC5aC044Og44O844Op44OzQUtJQkHkuK3lpK7pgJrjgorlupc!5e0!3m2!1sja!2sus!4v1627229846365!5m2!1sja!2sus\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯3éšã§ã™ã€‚  \nå“æƒãˆã¯å¤šã‚ã ã¨æ€ã†ã€‚CDã¯ä¸€ç•ªå¥¥ã®æ£šã®ç«¯ã£ã“ã«ã‚ã‚‹ã€‚\n\n# <span id=\"K-Books\">K-Books ç§‹è‘‰åŸæœ¬åº—</span>  \nâ†“ã“ã®å»ºç‰©ã®3éš\n\n![Imgur](https://imgur.com/qq3wdGa.png)\n\n<iframe src=\"https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3240.1504602823316!2d139.76976841526525!3d35.69791488019043!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188c1d4ec94be1%3A0xe8781a5ca3d62bed!2z44CSMTAxLTAwMjEg5p2x5Lqs6YO95Y2D5Luj55Sw5Yy65aSW56We55Sw77yR5LiB55uu77yR77yV4oiS77yR77yWIOODqeOCuOOCquS8mumkqA!5e0!3m2!1sja!2sjp!4v1627230502940!5m2!1sja!2sjp\" width=\"80%\" height=\"450\" style=\"border:0;\" allowfullscreen=\"\" loading=\"lazy\"></iframe>\n\nã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã¯3éšã®å¥¥ã®æ–¹ã§ã™ã€‚ã“ã“ã¯ã©ã£ã¡ã‹ã£ã¦ã„ã†ã¨ã‚°ãƒƒã‚ºãŒãƒ¡ã‚¤ãƒ³ãªã®ã§ã‚¨ãƒ­ã‚²ã‚ã‚“ã¾ã‚Šãªã‹ã£ãŸã€‚  \nCDã‚‚ã‚¨ãƒ­ã‚²ã‚³ãƒ¼ãƒŠãƒ¼ã®éš£ã«ã‚ã‚Šã¾ã—ãŸã€‚ä»–ã‚ˆã‚ŠCDã¯å¤šã„ã¨æ€ã†ã€‚\n\nã¦ã‹ã„ã¤ã®é–“ã«ã‹ãƒ¤ãƒãƒ€é›»æ©Ÿãªããªã£ã¦ãŸã€‚ãƒ¤ãƒãƒ€é›»æ©Ÿè·¡åœ°ã®ã¨ãªã‚Šã§ã™ã€‚\n\n![Imgur](https://imgur.com/YVZ5gth.png)\n\nã¡ãªã¿ã«ãƒ¤ãƒãƒ€é›»æ©Ÿã®å‰ã¯ã‚µãƒˆãƒ¼ãƒ ã‚»ãƒ³ãŒå…¥ã£ã¦ã„ãŸã‚‰ã—ã„ã€‚çŸ¥ã‚‰ã‚“ã‘ã©\n\n<div>\n<script type=\"application/javascript\" src=\"https://embed.nicovideo.jp/watch/sm4163864/script?w=640&h=360&from=45\"></script><noscript><a href=\"https://www.nicovideo.jp/watch/sm4163864\">å®¶é›»é‡è²©åº—CMã‚½ãƒ³ã‚°ç­‰æœ‰åéƒ¨åˆ†ã®è©°ã‚åˆã‚ã›</a></noscript>\n</div>\n\n# ãŠã¾ã‘ å€¤æ®µæ¯”è¼ƒ\n\nã¡ã‚ƒã‚“ã¨è¦‹ã¦ãªã„ã®ã§ï¼ˆå®‰ããªã£ã¦ã„ã‚‹ç†ç”±ã¨ã‹ã‚ˆãè¦‹ã¦ãªã„ã—ã€æœªé–‹å°ã§é«˜ããªã£ã¦ãŸã‚Šã™ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ï¼‰ã®ã§ã‚ã‚“ã¾å‚è€ƒã«ã—ãªã„ã§\n\n|        ã‚¨ãƒ­ã‚²ã‚¿ã‚¤ãƒˆãƒ«        | ã‚½ãƒ•ãƒãƒƒãƒ— | ãƒˆãƒ¬ãƒ¼ãƒ€ãƒ¼ | é§¿æ²³å±‹ | ã¾ã‚“ã ã‚‰ã‘ | ã‚‰ã—ã‚“ã°ã‚“ | ãƒ ãƒ¼ãƒ©ãƒ³ |\n|:----------------------------:|:----------:|:----------:|:------:|:----------:|:----------:|:--------:|\n| ãƒãƒƒãƒ”ãƒ¼ãƒ©ã‚¤ãƒ´ ã‚·ãƒ§ã‚¦ã‚¢ãƒƒãƒ—! |     -      |    4480    |  5200  |    4400    |     -      |   4546   |\n|      å¤¢ã¨è‰²ã§ã§ãã¦ã„ã‚‹      |    5808    |    5480    |  7480  |     -      |    4620    |   4000   |\n|         Sugar*Style          |    2508    |    3180    |  2800  |    2700    |    2200    |    -     |\n|     ã‚†ã³ã•ãã‚³ãƒã‚¯ã‚·ãƒ§ãƒ³     |    5808    |    5780    |   -    |    4400    |     -      |   4091   |\n|       æ”¾èª²å¾Œã‚·ãƒ³ãƒ‡ãƒ¬ãƒ©       |    6578    |    6380    |  6400  |    5600    |     -      |    -     |\n\n# çµ‚ã‚ã‚Šã«\nãƒ•ãƒ«ãƒ—ãƒ©ã‚¤ã‚¹ã®ã‚¨ãƒ­ã‚²ã£ã¦ã‚„ã£ã±ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç‰ˆãŒæ¬²ã—ã„ã‚ˆã­ï¼Ÿã€‚~~DLç‰ˆã ã¨ãªã‚“ã‹æã—ãŸæ°—æŒã¡ã«ï¼Ÿ~~\n\nãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç‰ˆãŒæ¬²ã—ã„ã€åˆå›é™å®šç‰ˆ(åˆå›è±ªè¯ç‰ˆï¼Ÿ)ãŒæ¬²ã—ã„ã£ã¦æ–¹ã¯è¡Œã£ã¦ã¿ã¦ãã ã•ã„ã€‚DLç‰ˆã®ã‚»ãƒ¼ãƒ«ã‚ˆã‚Šã‚‚å®‰ããªã£ã¦ã„ã‚‹ã¨ããŒã‚ˆãã‚ã‚‹ï¼ˆ**ãªãŠäº¤é€šè²»**ï¼‰\n\nãªã‚“ã‹ã„ã„ãŠåº—ã‚ã‚Œã°ã“ã®ãƒ–ãƒ­ã‚°ã®Issueã§ã‚‚Twitterã§ã‚‚ã„ã„ã®ã§ã©ã†ãã€‚\n\nã‚ã¨è©±å¤‰ã‚ã‚‹ã‚“ã ã‘ã©ã€`GitHub Copilot`å›ã«çµæ§‹åŠ©ã‘ã‚‰ã‚Œã¦ã‚‹ã€‚GitHubã€GJ  \nâ†“è£œå……ãŒæœ‰èƒ½ã™ãã‚‹ã€‚ãªã‚“ã§ã“ã‚Œã‹ã‚‰å…¥åŠ›ã—ã‚ˆã†ã¨ã—ã¦ã‚‹ã“ã¨åˆ†ã‹ã‚“ã ã‚ˆã“ãˆãƒ¼ã‚ˆ  \n\n![Imgur](https://imgur.com/u0YKTxt.png)"},{"title":"Surface Pro7 ä¿®ç†(äº¤æ›)ã«å‡ºã—ãŸ","link":"/posts/surface_pro7_repair/","markdown":"ç”»é¢ãŒã¡ã‚‰ã¤ã„ã¦ãŸã®ã§~~ä¿®ç†ã«å‡ºã™~~ã€‚äº¤æ›æ©Ÿã¨å–ã‚Šæ›¿ãˆã¦ã‚‚ã‚‰ã£ãŸã€‚  \r\nã“ã‚Œæ³•äººå‘ã‘ã§Officeãªã—ãƒ¢ãƒ‡ãƒ«ã ã‹ã‚‰å‚è€ƒã«ãªã‚‰ãªã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\n# ä¿®ç†å‡ºã™ã¾ã§\r\n\r\n## MSã‚¢ã‚«ã‚¦ãƒ³ãƒˆã¨Surfaceãƒ‡ãƒã‚¤ã‚¹ã‚’ç´ä»˜ã‘ã‚‹\r\nã‚·ãƒªã‚¢ãƒ«ã‚’ç™»éŒ²ã—ã¾ã™ã€‚\r\n\r\n## ä¿®ç†ã‚’æ³¨æ–‡ã™ã‚‹\r\n\r\nä½•ãŒæ‚ªã„ã®ã‹æ›¸ã„ã¦\r\n\r\n![Imgur](https://imgur.com/Bmhd1o6.png)\r\n\r\nä¿è¨¼ã‚’é¸ã³ã¾ã™ã€‚  \r\nã‚ˆãè¦‹ã¦ãªã‹ã£ãŸã‘ã©ã“ã“ã«ã¡ã‚ƒã‚“ã¨äº¤æ›æ©Ÿã¨äº¤æ›ã£ã¦æ›¸ã„ã¦ã‚ã‚‹ã˜ã‚ƒã‚“ã€‚\r\n\r\n![Imgur](https://imgur.com/8mbGPQ5.png)\r\n\r\nä»Šå›ã¯ã‚†ã†ãƒ‘ãƒƒã‚¯ã§é€ã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/QDbjtMv.png)\r\n\r\næ•°ååˆ†å¾Œã«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã®ãƒ‡ãƒã‚¤ã‚¹ç”»é¢ã‹ã‚‰ä¿®ç†ã®é€²æ—ã¨ã€ãƒ¡ãƒ¼ãƒ«ãŒå±Šãã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/unjDtYs.png)\r\n\r\n\r\n![Imgur](https://imgur.com/q5P9qcL.png)\r\n\r\n## Surfaceã®ãƒ‡ãƒ¼ã‚¿ã‚’æ¶ˆã™\r\næ¶ˆã—ã¾ã™ã€‚  \r\nãƒ‡ãƒ¼ã‚¿ã‚’é€ƒã—ãŸã„å ´åˆã¯ä»ŠãŒãƒãƒ£ãƒ³ã‚¹ã€‚\r\n\r\n## å£Šã‚Œã¦ã‚‹Surfaceã‚’é€ã‚‹\r\næ—¥ãŒçµŒã£ãŸã®ã§ã‚ã‚“ã¾è¦šãˆã¦ãªã„ã‘ã©ã€ã”æ³¨æ–‡ç•ªå·ãŒç™ºè¡Œã•ã‚Œã¦ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãƒ¡ãƒ¼ãƒ«ã¨ã‹ã§æ¥ã‚‹ã¨æ€ã†ã€‚  \r\nãã—ãŸã‚‰ç®±ã«è©°ã‚ã¾ã™ã€‚å¤šåˆ†ã‚†ã†ãƒ‘ãƒƒã‚¯ã§é€ã‚Œã‚‹ã‚µã‚¤ã‚ºã®ãƒ€ãƒ³ãƒœãƒ¼ãƒ«ã«SurfaceãŒå‹•ã‹ãªã„ã‚ˆã†ç·©è¡æã‚’å…¥ã‚Œã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nå……é›»å™¨ã¨ã‹ã‚¿ã‚¤ãƒ—ã‚«ãƒãƒ¼ã¯é€ã‚Šã¾ã›ã‚“ã€‚SDã‚«ãƒ¼ãƒ‰å·®ã—ã¦ã‚‹å ´åˆã¯æŠœã„ã¦ã­ã€‚\r\n\r\nâ†“ æ³•äººå‘ã‘ãƒ¢ãƒ‡ãƒ«ã®ã›ã„ãªã®ã‹ãƒ€ãƒ³ãƒœãƒ¼ãƒ«ã«å…¥ã£ã¦ã„ãŸã®ã§ãã®ã¾ã¾ã—ã¾ã£ã¦é€ã£ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/LZQfv2m.png)\r\n\r\n## éƒµä¾¿å±€ãƒ˜è¡Œã\r\nçª“å£ã§**ç€æ‰•ã„ã®ã‚†ã†ãƒ‘ãƒƒã‚¯ã§é€ã‚ŠãŸã„ã‚“ã§ã™ã‘ã©**ã£ã¦è¨€ãˆã°ä¼ç¥¨ã‚’ãã‚Œã¾ã™ã®ã§ã€å°ã§å¿…é ˆé …ç›®ã‚’æ›¸ãã¾ã™ã€‚  \r\nä½æ‰€ã€éƒµä¾¿ç•ªå·ã¯ä¿®ç†ç”³ã—è¾¼ã¿ã‚’ã—ãŸã¨ãã«æ¥ã‚‹ãƒ¡ãƒ¼ãƒ«ã®ä¸‹ã®æ–¹ã«`é€ä»˜å…ˆä½æ‰€`ã¨ã—ã¦æ›¸ã„ã¦ã‚ã‚‹ã®ã§ã€æ›¸ãå†™ã—ã¾ã™ã€‚\r\n\r\nå•†å“ã®æ¬„ã¯ `PC` + `æ³¨æ–‡ç•ªå·` ã‚’æ›¸ãã¾ã™ã€‚  \r\nã‚‚ã—ã‹ã—ãŸã‚‰`ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆPC`ã£ã¦æ›¸ã„ãŸã»ã†ãŒã„ã„ã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\næ›¸ã„ãŸã‚‰ä¼ç¥¨ã‚’è²¼ã‚‰ãšã«çª“å£ã«æŒã£ã¦ã„ã£ãŸã€‚æ­£æ”»æ³•ãªã®ã‹ã¯çŸ¥ã‚‰ãªã„ã€‚\r\n\r\n## é€²æ—ãŒãƒ¡ãƒ¼ãƒ«ã§æ¥ã‚‹\r\nãƒã‚¤ã‚¯ãƒ­ã‚½ãƒ•ãƒˆã«è·ç‰©ãŒæ¸¡ã£ãŸã‚ã¨ã¯å‰²ã¨æ—©ã‹ã£ãŸæ°—ãŒã™ã‚‹ã€‚  \r\n\r\n## äº¤æ›æ©Ÿåˆ°ç€\r\næ—¥æœ¬éƒµä¾¿ã§é€ã£ã¦ãã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/VPbKjZM.png)\r\n\r\n![Imgur](https://imgur.com/v9nnkNx.png)\r\n\r\n![Imgur](https://imgur.com/BtfEQQq.png)\r\n\r\nWindows 10ãŒå…¥ã£ã¦ã¾ã—ãŸã€‚  \r\nã²ãŸã™ã‚‰Windows Update (åå°„ã‚„ã°)\r\n\r\n![Imgur](https://imgur.com/FaWnEyj.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\nãƒ•ã‚¡ãƒ³ãŒãªã„ã®ã§ã‚¨ãƒ­ã‚²ã‚„ã‚‹ã®ã«ä¾¿åˆ©ã§ã™ã­ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nWindows 10ã¾ã§ã¯å³ç«¯ã‹ã‚‰ä¸­å¤®ã¸ã‚¹ãƒ¯ã‚¤ãƒ—ã™ã‚Œã°å…¨ç”»é¢æ™‚ã§ã‚‚ã‚¢ãƒ—ãƒªåˆ‡ã‚Šæ›¿ãˆãŒå‡ºæ¥ãŸã®ã«ã€  \r\nWindows 11ã‹ã‚‰å‡ºæ¥ãªããªã£ã¦åŠ£åŒ–ã—ã¦ã‚“ã˜ã‚ƒã‚“ï¼ï¼ã£ã¦æ€ã£ãŸã‚“ã§ã™ã‘ã©ã€  \r\n**ä¸‹ã‹ã‚‰3æœ¬æŒ‡ã‚¿ãƒƒãƒã—ãªãŒã‚‰ä¸Šã‚¹ãƒ¯ã‚¤ãƒ—**ã§åˆ‡ã‚Šæ›¿ãˆã§ãã¾ã—ãŸã€‚ã™ã„ã¾ã›ã‚“ã€‚"},{"title":"ã‚¿ã‚°ã®ãƒšãƒ¼ã‚¸ä½œã£ãŸ","link":"/posts/taglist/","markdown":"\r\nã‚¿ã‚°ã®ãƒšãƒ¼ã‚¸ä½œã‚Šã¾ã—ãŸã€‚  \r\n**ã¾ã ã‚¿ã‚°ä¸€è¦§ã¯ä½œã£ã¦ã¾ã›ã‚“ãŒ**ã€ã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹è¨˜äº‹ã®ä¸€è¦§è¡¨ç¤ºãªã‚‰ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸ\r\n\r\nè©¦ã—ã«Chipã‚’æŠ¼ã—ã¦ã¿ã¦ã­ã€‚  \r\n\r\n**ã‚ã¨ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³(äºŒãƒšãƒ¼ã‚¸ç›®ã¿ãŸã„ãªã‚„ã¤)ä»˜ã‘ã¦ãªã„ã‹ã‚‰å¤šåˆ†å¤§å¤‰ãªã“ã¨ã«ãªã‚‹**\r\n\r\n## æŠ€è¡“çš„ãªè©±\r\n\r\n`posts/tag/è‡ªä½œãƒ–ãƒ­ã‚°/index.html` ã¿ãŸã„ãªãƒ•ã‚¡ã‚¤ãƒ«ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚  \r\n\r\n```js\r\n/** ã‚¿ã‚°ãŒå«ã¾ã‚Œã¦ã„ã‚‹è¨˜äº‹ä¸€è¦§ã®ãƒ‘ã‚¹é…åˆ—ç”Ÿæˆé–¢æ•°ã€‚ */\r\nconst generateTagPageRoutesList = () => {\r\n  // è¨˜äº‹ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆä¸€è¦§é…åˆ—ã‚’ç”Ÿæˆã™ã‚‹ã€‚ã‚­ãƒ¼ã ã‘ã®é…åˆ—ã«ã—ã¦mapã§å–ã‚Šå‡ºã™\r\n  const blogItems = Object.keys(postsJSON.fileMap).map(key => postsJSON.fileMap[key])\r\n  // ã‚¿ã‚°ã ã‘ã®é…åˆ—ã‚’ä½œã‚‹\r\n  const allTagItems = blogItems.map(blog => blog.tags).flat()\r\n  // è¢«ã‚Šã‚’æ¶ˆã™ã€‚new Set()ã§ã„ã„ã‚‰ã—ã„\r\n  const tagList = [...new Set(allTagItems)]\r\n  // ãƒ‘ã‚¹ç”Ÿæˆã€‚ã“ã‚“ãªæ„Ÿã˜ã®â†’ /posts/tag/è‡ªä½œãƒ–ãƒ­ã‚° ã¿ãŸã„ãªæ„Ÿã˜ã«\r\n  const pathList = tagList.map(tagName => `/posts/tag/${tagName}`)\r\n  return pathList\r\n}\r\n// çœç•¥\r\n/** é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆé–¢æ•°ã€‚é…åˆ—(pages/ã¨posts/)ãã£ã¤ã‘ã‚‹ */\r\nconst generateRoutes = callback => {\r\n  callback(null, [generateTagPageRoutesList()].flat())\r\n}\r\n```\r\n\r\nJavaScriptã®é…åˆ—ã€è¢«ã‚Šã‚’æ¶ˆã™æ–¹æ³•ã«ã“ã‚“ãªæ–¹æ³•ãŒã‚ã£ãŸã‚“ã§ã™ã­ã€‚  \r\n```js\r\nconsole.log([...new Set([1,2,1])]) // [1,2]\r\n```\r\n\r\nã¡ãªã¿ã«Kotlinã ã¨`array()#distinct()`ãŒã‚ã‚Šã¾ã™ã€‚è¶…ä¾¿åˆ©\r\n\r\nä»¥ä¸Šã§ã™ï¼ˆï¼Ÿï¼‰  \r\nä¹…ã€…ã®å­¦æ ¡ã¯ã¾ã‚ã¾ã‚æ¥½ã—ã‹ã£ãŸã§ã™ã€‚å¸°ã‚Šé™½ã‚­ãƒ£ãŒçµ¡ã‚“ã§ããŸã®ãŒæ¸›ç‚¹ãƒã‚¤ãƒ³ãƒˆã§ã™ã­ã€‚  \r\n\r\nã‚ã¨2mç¢ºä¿ã¨ãŒç„¡ç†ã˜ã‚ƒã­ï¼Ÿ"},{"title":"ã“ã‚Œä½œã‚‹ã®ã«å¤§å¤‰ã ã£ãŸã“ã¨","link":"/posts/taihendattakoto/","markdown":"\r\n**[TypeScript(nuxt/content)åŒ–ã«ä¼´ã„ã“ã®è¨˜äº‹ã¯å¤ããªã‚Šã€ã“ã“ã«æ›¸ã„ã¦ã‚ã‚‹å†…å®¹ã‚‚ï¼ˆã»ã¼ï¼‰é–¢ä¿‚ãªããªã£ã¦ã„ã¾ã™](/posts/remake_ziyuutyou)**\r\n\r\nHexoã£ã¦ã™ã”ã„ã‚“ã ãªã£ã¦ã€‚  \r\nãªãŠå®Œæˆã¯ã„ã¤ã«ãªã‚‹ã‹ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚ã„ã¤å‡ºæ¥ä¸ŠãŒã‚‹ã‚“ã ã“ã‚Œï¼Ÿ  \r\nå®Œæˆã¾ã§ã«æ€ã£ãŸã“ã¨ã‚’æ›¸ã„ã¦ã„ãã¨æ€ã†ã€‚\r\n\r\n~~ã‚ã¨ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒæ¬²ã—ã„ã€‚è²·ã£ãŸã“ã¨ç„¡ã„ã‘ã©ã©ã†ãªã‚“ã§ã™ã‹ã­ï¼Ÿ~~\r\n\r\n[å–ã‚Šã¾ã—ãŸ](/posts/domain_katta)\r\n\r\n## ã“ã‚Œä½œã‚‹ã®ã«å¤§å¤‰ã ã£ãŸã“ã¨\r\næ›¸ãã€‚\r\n\r\n### VuetifyãŒ`<code>`ã«è‰²ã¤ã‘ã‚‹ã€‚\r\n\r\nVuetifyãã‚“ãŒå‹æ‰‹ã«è‰²ã‚’ä»˜ã‘ã¦ãã‚Œã¾ã™ã€‚ãŒã€ãªã‚“ã‹ã„ã¾ã„ã¡ãªã®ã§é ‘å¼µã£ã¦CSSæ›¸ã„ã¦ç›´ã—ãŸã„ã‚“ã§ã™ãŒã€  \r\nVuetifyãã‚“ãŒè¨±ã—ã¦ãã‚Œã¾ã›ã‚“ã€‚ï¼Ÿ  \r\nã—ã‹ãŸãªã„ã®ã§`!important`ã§é»™ã‚‰ã›ã¾ã—ãŸã€‚    \r\n\r\nassets/css/styles.css\r\n```css\r\n/* Vuetifyã®ã›ã„ã§Codeã‚¿ã‚°ã«å‹æ‰‹ã«CSSé©ç”¨ã•ã‚Œã‚‹ã®ã§å¼·åˆ¶ä¸Šæ›¸ã */\r\n\r\n.v-application code {\r\n    box-shadow: initial !important;\r\n    border: 1px solid gray;\r\n    border-radius: 5px !important;\r\n    font-family: 'Koruri Regular';\r\n    margin: 10px;\r\n}\r\n\r\n.v-application code, .v-application kbd {\r\n    font-weight: initial !important;\r\n}\r\n```\r\n\r\nã¤ã„ã§ã«`highlight.js`ã®CSSã€`vs2015.css`ã‚’å…¥ã‚Œã¦ã‚³ãƒ¼ãƒ‰ã«ã‚·ãƒ³ã‚¿ãƒƒã‚¯ã‚¹ãƒã‚¤ãƒ©ã‚¤ãƒˆã‚’ã¤ã‘ã‚ˆã†ã¨ã—ãŸã‚“ã§ã™ã‘ã©ã€ã“ã‚Œã‚‚ã†ã¾ãå‹•ã‹ãªã‹ã£ãŸã®ã§`vs2015.css`ã«`!important`ä»˜ã‘ã¦å¯¾å¿œã—ã¾ã—ãŸã€‚\r\n\r\n### CSS\r\nCSSã‚ˆãã‚ãŒã‚“ã­ã€‚\r\n\r\n```css\r\n/* ã»ã°ãƒ¼ */\r\n.titleHover:hover {\r\n    color: #5870cb;\r\n    transition: color 0.5s;\r\n}\r\n```\r\n\r\nã“ã‚Œã¯è¨˜äº‹ä¸€è¦§ã®ã‚¿ã‚¤ãƒˆãƒ«ã‚’ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼ã™ã‚‹ã¨ã‚¸ãƒ¯ãƒ¼ãƒƒã¨è‰²ãŒå¤‰ã‚ã‚‹CSSã§ã™ã€‚  \r\n\r\n### Processmdãã‚“ãŒæ™‚ç³»åˆ—é †ã«ä¸¦ã¹ã¦ãã‚Œãªã„\r\n\r\nã“ã‚Œã¯ãŠã¾ç’°å¢ƒã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€æ™‚ç³»åˆ—é †ã«ä¸¦ã‚“ã§ãã‚Œã¾ã›ã‚“ã€‚  \r\næµçŸ³ã«æ™‚ç³»åˆ—é †ã«ãªã‚‰ãªã„ã®ã¯ãã¤ã„ã®ã§ã€JavaScriptã§æ™‚ç³»åˆ—ã«ä¸¦ã³æ›¿ãˆã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã¾ã—ãŸã€‚sorté–¢æ•°ã‚ã£ãŸã—ã€‚\r\n\r\n```js\r\n// ãªã‚“ã‹ã—ã‚‰ã‚“ã‘ã©ä¸¦ã³é †ãŒæ–°ã—ã„é †ã¨ã¯é™ã‚‰ãªã„ã‚‰ã—ã„ï¼Ÿ\r\nconst sortedKeyList = Object.keys(fileMap);\r\nsortedKeyList.sort(function(a, b) {\r\n  const aDate = new Date(fileMap[a].created_at).getTime();\r\n  const bDate = new Date(fileMap[b].created_at).getTime();\r\n  if (aDate > bDate) return -1;\r\n  if (aDate < bDate) return 1;\r\n  return 0;\r\n});\r\n```\r\n\r\nKotlinã®`sortBy{}`ã¨ã¯ä½¿ã„æ–¹ãŒé•ã£ã¦ã¦ã¡ã‚‡ã£ã¨è¿·ã£ãŸã€‚\r\n\r\nã‚ã¨processmdãã‚“ã€/posts/jsonã«æ¶ˆã—ãŸè¨˜äº‹ãŒæ®‹ã£ã¦ã‚‹ã‚“ã§ã™ãŒãã‚Œã¯ã€ã€\r\n\r\n### ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³\r\n\r\nè¿½è¨˜ï¼ˆ2020/06/27ï¼‰ï¼šã‚‚ã—ã‹ã—ãŸã‚‰ã“ã‚Œæ›¸ãå¿…è¦ãªã„ã¨æ€ã†ï¼ˆ`_id.vue`ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¿…è¦ã ã¨æ€ã†ï¼‰  \r\nè©³ç´°â†’ [Nuxt.jsã‚’2.13ã«ä¸Šã’ãŸæ™‚ã®è©±](/posts/nuxt_2_13_sugoi)\r\n\r\næ¬¡ã®ãƒšãƒ¼ã‚¸ã€å‰ã®ãƒšãƒ¼ã‚¸ã‚’ä»˜ã‘ã‚‹ã“ã¨ã‚’ã€ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ã£ã¦è¨€ã†ãã†ã§ã™ã‚ˆã€‚  \r\nã“ã‚Œä»˜ã‘ãªã„ã¨è¨˜äº‹ãŒå¢—ãˆãŸã¨ãã®ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ãŒã¨ã‚“ã§ã‚‚ãªã„ã“ã¨ã«ãªã‚‹ã€‚  \r\n\r\nè¨˜äº‹ä¸€è¦§ã¯ã“ã‚“ãªæ„Ÿã˜ã«é™çš„ã«å‡ºã—ã¦ã»ã—ã„ã®ã§ï¼ˆpostsã«ç½®ãã¨ã‚¿ã‚¤ãƒˆãƒ«è¢«ã‚Šãã†ãªã®ã§pageãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ã€‚ï¼‰\r\n```js\r\n/posts/page/1\r\n```\r\n\r\nç‰¹ã«éœ€è¦ã¯ãªã•ãã†ã§ã™ãŒä¸€å¿œå¿…è¦ãªãƒšãƒ¼ã‚¸æ•°ã«åˆã‚ã›ã¦`posts/page`ã®é…åˆ—ã‚’è¿”ã™é–¢æ•°ç½®ã„ã¨ãã¾ã™ã­ã€‚\r\n\r\n```js\r\n/** æ¬¡ã®ãƒšãƒ¼ã‚¸æ©Ÿèƒ½ã‚’ã¤ã‘ã‚‹ã€‚ãã†ã—ãªã„ã¨è¨˜äº‹ä¸€è¦§ã«ã©ã°ãƒ¼ã£ã¦ãªã£ã¦ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¤§å¤‰ã«ãªã‚‹ */\r\nconst generatePagenationRoutesList = () => {\r\n  // ä½•ãƒšãƒ¼ã‚¸å¿…è¦ã‹è¨ˆç®—ã™ã‚‹ï¼ˆ10ã§å‰²ã‚Œã°ã„ã„ã£ã—ã‚‡ï¼‰ã€‚ãŸã 1ãƒšãƒ¼ã‚¸ç›®ã¯æœ€ä½é™å¿…è¦ãªã®ã§1è¶³ã™\r\n  const calc = Math.floor(postsJSON.sourceFileArray.length / PAGE_LIMIT) + 1\r\n  // ãƒšãƒ¼ã‚¸åˆ†ã ã‘å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®é…åˆ—å‡ºã™ï¼Ÿ\r\n  const dynamicRouterPathList = []\r\n  // console.log(`ãƒšãƒ¼ã‚¸æ•°ï¼š${calc} / è¨˜äº‹æ•°ï¼š${postsJSON.sourceFileArray.length}`)\r\n  // ãƒšãƒ¼ã‚¸ç”Ÿæˆã€‚1ãƒšãƒ¼ã‚¸ç›®ã‹ã‚‰ä½œã‚‹ã®ã§1ã‹ã‚‰ã‚¹ã‚¿ãƒ¼ãƒˆ\r\n  for (let i = 1; i <= calc; i++) {\r\n    dynamicRouterPathList.push(`/posts/page/${i}`)\r\n  }\r\n  return dynamicRouterPathList\r\n}\r\n\r\n// çœç•¥\r\n\r\n/** é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆé–¢æ•°ã€‚é…åˆ—(pages/ã¨posts/)ãã£ã¤ã‘ã‚‹ */\r\nconst generateRoutes = callback => {\r\n  callback(null, [generatePagenationRoutesList()].flat())\r\n}\r\n\r\n```\r\n\r\nã“ã‚Œå‹•ã‹ã™ã«ã¯`postsãƒ•ã‚©ãƒ«ãƒ€`ã«`pageãƒ•ã‚©ãƒ«ãƒ€`ã‚’ä½œã£ã¦ä¸­ã«ã€`_id.vue`ã‚’ç½®ã„ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\nã“ã‚Œã§`posts/page/1`ãªã©ãŒç”Ÿæˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ï¼ˆå¤šåˆ†ï¼‰\r\n\r\n~~ã“ã®è¨˜äº‹æ›¸ã„ã¦ã‚‹é€”ä¸­ã§ãªã‚“ã§ã“ã‚Œå‹•ã„ã¦ã‚“ã®ã‹ã‚ˆãã‚ã‹ã‚‰ãªããªã£ãŸã®ã¯å†…ç·’~~â†ã‚„ã£ã±ã‚Šç”Ÿæˆã§ãã¦ãªã‹ã£ãŸã®ã§ç›´ã—ã¾ã—ãŸã€‚ï¼ˆ2020/06/03ï¼‰\r\n\r\n### `<v-card>`ãŒé…ã„ï¼Ÿâ†’ã„ã¤ã®é–“ã«ã‹ç›´ã£ãŸï¼Ÿ\r\nä½•æ•…ã‹çŸ¥ã‚Šã¾ã›ã‚“ãŒã€Vuetiryã®Cardã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒãŠãã„ã€‚ã¨ã„ã†ã‹ãƒšãƒ¼ã‚¸é·ç§»ãŒã“ã„ã¤ã®ã›ã„ã§é…ããªã‚‹ã€‚  \r\n\r\nã›ã£ã‹ãã®é™çš„ã‚µã‚¤ãƒˆã§é…ã„ã®ã¯è¾›ã„ã®ã§ç›´ã—ãŸã„ã€‚ï¼ˆã—ã‹ã‚‚è¨˜äº‹ä¸€è¦§ã«æˆ»ã£ãŸæ™‚ã«ãƒ¯ãƒ³ãƒ†ãƒ³ãƒé…ã‚Œã‚‹ã¨ã‹è¦‹ã¦ã‚‰ã‚Œãªã„ï¼‰\r\n\r\nã§ã€ãªãœã‹`<v-card>`ã‚’`<v-sheet>`ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã—ãŸã€‚  \r\n\r\nãªã‚“ã§ï¼Ÿ\r\n\r\n### è¨˜äº‹ä¸€è¦§ã‚’å†èª­ã¿è¾¼ã¿ã—ãŸå¾Œè¨˜äº‹ã‚’é–‹ãã¨404\r\n\r\nãªã‚“ã‹ã—ã‚‰ã‚“ã‘ã©F5ã™ã‚‹ã¨URLã®å¾Œã‚ã«`/`ãŒå…¥ã‚Šã¾ã™ã€‚  \r\næœ€å¾Œã«`/`ãŒå…¥ã£ã¦ã„ãªã„ã®ãŒå‰æã§ä½œã£ã¦ã„ã‚‹ã®ã§ã€æœ€å¾Œã«å…¥ã‚‹ã¨ **`../`(ä¸€å€‹å‰ã«æˆ»ã‚‹)** ãŒãŠã‹ã—ãªå ´æ‰€ã‚’æŒ‡ã™ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n---è¿½è¨˜---\r\n\r\n**åˆ¥ã«`../`ä½¿ã‚ãªãã¦ã‚‚è‰¯ã„ã“ã¨ã«æ°—ä»˜ã„ãŸã®ã§ã“ã®å•é¡Œã¯è§£æ±ºã—ã¾ã—ãŸã€‚**  \r\n**`to='/posts/first'`ã¿ãŸã„ãªæ„Ÿã˜ã§åˆ¥ã«æˆ»ã‚‹å¿…è¦ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚**\r\n\r\n---è¿½è¨˜ãŠã‚ã‚Š---\r\n\r\nã¨ã„ã†ã‹ã“ã‚Œã¯ç§ã®ä½œã‚Šæ–¹ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆï¼‰ãŒæ‚ªã„ã§ã™ã­ã€ãªã‚“ã§æˆ»ã£ãŸã‚Šã—ãªã„ã¨ã„ã‘ãªã„ã‚“ã ã€‚\r\n\r\n- pages\r\n  - pagesï¼ˆå›ºå®šãƒšãƒ¼ã‚¸ã€‚ä»Šå›ã¯çœç•¥ï¼‰\r\n  - postsï¼ˆãƒ–ãƒ­ã‚°ï¼‰\r\n    - page\r\n      - _id.vueï¼ˆè¨˜äº‹ä¸€è¦§ï¼‰\r\n    - tag\r\n      - _id.vueï¼ˆã‚¿ã‚°æ¤œç´¢çµæœï¼‰\r\n    - index.vueï¼ˆæœ¬æ¥ã“ã“ã«è¨˜äº‹ä¸€è¦§ãŒæœ‰ã‚‹ã¹ãï¼Ÿï¼‰\r\n    - _slug.vueï¼ˆè¨˜äº‹ã€‚ã“ã“ã«å±…ã‚‹ã®ã§ä¸€è¦§ã‹ã‚‰æ¥ãŸã‚‰æˆ»ã‚‰ãªã„ã¨ã„ã‘ãªã„ã€‚ï¼‰\r\n\r\n\r\nä»Šå›ã¯`nuxt.config.js`ã‚’é–‹ãã€URLã®æœ€å¾Œã«`/`ã‚’å…¥ã‚Œã‚‹è¨­å®šã‚’ä»˜ã‘ã¾ã—ãŸã€‚ãŠã‹ã’ã¦ä¿®æ­£ãŒå¿…è¦ã«ãªã‚Šã¾ã—ãŸãŒã€‚\r\n\r\n```js\r\nexport.default {\r\n  // çœç•¥\r\n  router: {\r\n    base: '/Ziyuutyou/',\r\n    trailingSlash: true // â†ã“ã‚Œ\r\n  }\r\n}\r\n```\r\n\r\n### `sw.js`ãŒã‚ˆãã‚ã‹ã‚‰ã‚“ã‘ã©ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†å¯¾è±¡å¤–ã«ãªã£ã¦ã¦**ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ **ãŒæ¶ˆãˆã¦ãŸ\r\n\r\nGitHubã®ãƒªãƒã‚¸ãƒˆãƒªé–‹ã„ã¦`/docs`é–‹ã„ãŸã‚‰è¦‹äº‹ã«ServiceWorkerã ã‘æŠœã‘ã¦ã¾ã—ãŸã€‚ãªã‚“ã§ï¼Ÿ\r\n\r\n### Hexoã¨é•ã£ã¦ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§è¨˜äº‹ã®å†…å®¹ãŒåæ˜ ã•ã‚Œãªã„\r\n\r\nHexoã£ã¦æ›¸ã„ã¦ã‚‹é€”ä¸­ã§ã‚‚ã€ãƒªãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°è¨˜äº‹ã®å†…å®¹ãŒæ›´æ–°ã•ã‚Œã¦ã©ã‚“ãªæ„Ÿã˜ã«è¦‹ã‚Œã¦ã‚‹ã‹ç¢ºèªã§ãã‚‹ã‚“ã§ã™ã‘ã©ã€processmdãã‚“ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨ã§ããªã„ã£ã½ã„ï¼Ÿ  \r\n`processmd`è¦‹ã‚‹æ„Ÿã˜ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä¸­èº«ã‚’ç›£è¦–ã™ã‚‹`--watch`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ãŒå­˜åœ¨ã™ã‚‹ã®ã§ãã‚Œä½¿ãˆã°ã‚ˆã•ãã†ã§ã™ã€  \r\nãã‚Œã§é©å½“ã«`package.json`ã®`scripts`ã®ä¸­ã«å®Ÿè¡Œã¨processmdã®ç›£è¦–ã‚ªãƒ—ã‚·ãƒ§ãƒ³ä»˜ãã‚’åŒæ™‚ã«å®Ÿè¡Œã™ã‚‹æ§˜ã«æ›¸ã„ãŸã‚“ã§ã™ã‘ã©ã€  \r\n**nuxtèµ·å‹•ã‹ã‚‰å…ˆã«é€²ã¿ã¾ã›ã‚“ï¼ãã‚Šã‚ƒnuxtã‚‚ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›£è¦–ã—ã¦ã‚‹ã‹ã‚‰ãã“ã§æ­¢ã¾ã‚Šã¾ã™ã‚ˆã­ã€‚**\r\n\r\nãã‚Œã§ã©ã†ã™ã‚Œã°åŒæ™‚ã«ï¼ˆä¸¦åˆ—ã«ï¼‰èµ·å‹•ã§ãã‚‹ã‹ã£ã¦è©±ã§ã™ãŒã€`npm-run-all`ã£ã¦ã®ã‚’ä½¿ãˆã°ä¸¦åˆ—å®Ÿè¡ŒãŒã§ããã†ã§ã™ã€‚  \r\nãŸã ã€ã“ã‚Œä½¿ã£ã¦ã‚‚æ›´æ–°ã§ãã‚‹ã®ã¯è¨˜äº‹ã®ä¸­èº«ã ã‘ã§è¨˜äº‹ä¸€è¦§(summary.json)ã¯æ›´æ–°ã§ããªã„ã£ã½ã„ã§ã™ã€‚(nuxtèµ·å‹•æ™‚ã«summary.jsonãŒç©ºã£ã½ã ãã£ã¦æ€’ã‚‰ã‚Œã‚‹ã€‚ã©ã†ã‚„ã‚‰ä¸€åº¦æ¶ˆãˆã‚‹ã‚‰ã—ã„ï¼Ÿ)  \r\n\r\nã§ã‚‚è¨˜äº‹ã®ä¸­èº«ãŒãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§åæ˜ ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã£ãŸã®ã§æº€è¶³ã§ã™ã€‚VSCodeåŠåˆ†ã«ã—ãªãã¦æ¸ˆã‚€ã—ã€‚  \r\nå‚è€ƒç¨‹åº¦ã®`package.json`ã®script\r\n\r\n```json\r\n{\r\n  \"scripts\": {\r\n    \"dev\": \"nuxt --port 11451\",\r\n    \"build\": \"nuxt build\",\r\n    \"start\": \"nuxt start\",\r\n    \"generate\": \"nuxt generate\",\r\n    \"markdown\": \"npm run post && npm run page\",\r\n    \"page\": \"processmd contents/pages/**/*.md --stdout --outputDir contents/pages/json > contents/pages/summary.json --markdownOptions.linkify\",\r\n    \"post\": \"processmd contents/posts/**/*.md --stdout --outputDir contents/posts/json > contents/posts/summary.json --markdownOptions.linkify\",\r\n    \"pagewatch\": \"processmd contents/pages/**/*.md --outputDir contents/pages/json --markdownOptions.linkify --watch\",\r\n    \"postwatch\": \"processmd contents/posts/**/*.md --outputDir contents/posts/json --markdownOptions.linkify --watch\",\r\n    \"all\": \"npm-run-all markdown --parallel dev postwatch\"\r\n  },\r\n}\r\n```\r\n\r\n`npm run all`ã‚’å®Ÿè¡Œã™ã‚‹ã¨\r\n- markdownãƒ•ã‚¡ã‚¤ãƒ«ãŒJSONå½¢å¼ã«å¤‰æ›ã•ã‚Œã‚‹\r\n- nuxtèµ·å‹•\r\n- nuxtèµ·å‹•ã¨åŒæ™‚ã«processmdã®ç›£è¦–ã‚’å§‹ã‚ã‚‹\r\n  - `--stdout`ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã¯å¤–ã—ã¦ã‚ã‚‹ã®ã§ã€è¨˜äº‹ä¸€è¦§ã¯æ›´æ–°ã•ã‚Œãªã„ã€‚\r\n\r\n`--parallel`ã®ã‚ã¨ã«æŒ‡å®šã—ãŸã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒä¸¦åˆ—ã§å®Ÿè¡Œã•ã‚Œã€ãã®å‰ã«æ›¸ã„ã¦ã‚ã‚‹ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯ç›´åˆ—ã§å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚\r\n\r\nã¡ãªã¿ã«processmdãã‚“ãŒJSONãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ›¸ãæ›ãˆã‚‹ã¨nuxtã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ç›£è¦–ã«å¼•ã£ã‹ã‹ã‚‹ã®ã§è‡ªå‹•ã§æ›´æ–°ã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã™ã’ãˆ\r\n\r\n~~ãŸã¾ã«undefinedã«ãªã‚‹ã‘ã©ã—ã‚ƒãƒ¼ãªã„~~\r\n\r\n### ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã«æ›¸ã„ãŸURLãŒãƒªãƒ³ã‚¯ã«ãªã‚‰ãªã„\r\n\r\nprocessmdãã‚“ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«`--markdownOptions.linkify`ã‚’ãã£ã¤ã‘ã¦å®Ÿè¡Œã™ã‚Œã°ã„ã„ã§ã™ã€‚\r\n\r\n```json\r\n{\r\n  \"scripts\": {\r\n    \"post\": \"processmd contents/posts/**/*.md --stdout --outputDir contents/posts/json > contents/posts/summary.json --markdownOptions.linkify\"\r\n  }\r\n}\r\n```\r\n\r\n### ~~ã—ã‚Œã£ã¨~~Netlifyã«ãŠå¼•è¶Šã—ã—ãŸã‚Šã—ãŸã€‚\r\n\r\nGitHubPagesã‚ˆã‚Šè‰¯ã„ã®ã‹ã¯ã—ã‚‰ã‚“ã‘ã©ãŠè©¦ã—ã§å¼•ã£è¶Šã—ã¦ã¿ãŸã€‚ã“ã‚Œå‹æ‰‹ã«ãƒ¡ã‚¢ãƒ‰å…¬é–‹ã—ãŸã‚Šã—ãªã„ã‚ˆãªï¼Ÿ  \r\n[Netlify ã¸ãƒ‡ãƒ—ãƒ­ã‚¤ã™ã‚‹ã«ã¯ï¼Ÿ](https://ja.nuxtjs.org/faq/netlify-deployment/)ã£ã¦ã®ãŒæœ‰ã‚‹ã®ã§ãã‚Œã«æ²¿ã£ã¦ã‚„ã‚Œã°ã§ãã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nã˜ã‚ƒã‚ãªã‚“ã§**å¤§å¤‰ã ã£ãŸã“ã¨**ã«æ›¸ã„ã¦ã‚“ã ã‚ˆã£ã¦è©±ã§ã™ãŒã€ã£ã±ã‚³ã‚±ã‚‹ã‚“ã§ã™ã­ã€‚\r\n\r\n<iframe src=\"https://best-friends.chat/@takusan_23/104330325427830329/embed\" class=\"mastodon-embed\" style=\"max-width: 100%; border: 0; height:200px\" width=\"400\" allowfullscreen=\"allowfullscreen\"></iframe><script src=\"https://best-friends.chat/embed.js\" async=\"async\"></script>\r\n\r\nã‚ãƒ¼JSã ã‹ã‚‰ã—ã‚ƒãƒ¼ãªã„ã®ã‹ãªãƒ¼ãªã‚“ã¦æ€ã£ã¦ã¨ã‚Šã‚ãˆãšæ¤œç´¢ã™ã‚‹ã¨ã€`Chromeã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³çš„ã«å¯¾å¿œã—ã¦ã„ãªã„`ã¨ã‹å‡ºã¦ããŸã®ã§ãƒ¯ãƒ³ã¡ã‚ƒã‚“Node.jsãã‚“ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒãŠã‹ã—ã„ã®ã§ã¯ãªã„ã‹ã¨è€ƒãˆã¾ã—ãŸã€‚  \r\n\r\nNetlifyã«Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã™ã‚‹æ–¹æ³•ã§ã™ãŒã€æ¤œç´¢ã—ãŸã‚‰ã‚ã‚Šã¾ã—ãŸã€‚ [å‚è€ƒå…ƒ](https://qiita.com/n0bisuke/items/8bddad87610b01c90003)\r\n\r\n`.nvmrc`ã¨ã„ã†ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç½®ã„ã¦ã€ä¸­ã«Node.jsã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›¸ãã ã‘ã§è§£æ±ºã—ã¾ã—ãŸã€‚\r\n\r\n`v12.14.1`\r\n\r\nã“ã‚Œã ã‘ã€‚ã“ã‚Œã§æˆåŠŸã—ã¾ã—ãŸã€‚\r\n\r\nã¡ãªã¿ã‚µã‚¤ãƒˆä½œæˆæ™‚ã®ã‚¹ãƒ†ãƒƒãƒ—ï¼“ã§ã€ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã«`npm run generate`ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’`docs(GitHubPagesã®åæ®‹)`ã™ã‚Œã°ã€ã‚³ãƒŸãƒƒãƒˆ+ãƒ—ãƒƒã‚·ãƒ¥æ™‚ã«å‹æ‰‹ã«`npm run genreate`ã—ã¦å…¬é–‹ã—ã¦ãã‚Œã¾ã™ã€‚ã‚‰ã\r\n\r\n### å®Ÿã¯é™çš„ã‚µã‚¤ãƒˆæ›¸ãå‡ºã—ã§ãã¦ãªã‹ã£ãŸ\r\nã“ã‚Œã¯åˆ¥ã«è¨˜äº‹ã«æ›¸ã„ãŸâ†’ [Nuxtã®é™çš„ã‚µã‚¤ãƒˆã‚¸ã‚§ãƒãƒ¬ãƒ¼ãƒˆã¯ãƒ¢ãƒ¼ãƒ‰ã‚’universalã«ã—ã‚ˆã†](/posts/nuxt_universal)\r\n\r\nèª­ã¿ãŸããªã„æ–¹å‘ã‘â†’`nuxt.config.js`ã®`mode:`ã‚’`universal`ã«ã™ã‚Œã°HTMLã«æ›¸ãå‡ºã—ã¦ãã‚Œã¾ã™ã€‚  \r\n`spa`ã ã¨HTMLã®bodyè¦‹ã¦ã‚‚scriptã‚¿ã‚°ãŒä½•å€‹ã‹æœ‰ã‚‹ã ã‘ã§ã€å†…å®¹ã¯JSå®Ÿè¡Œã•ã‚Œã‚‹ã¾ã§è¡¨ç¤ºã•ã‚Œã¾ã›ã‚“ã§ã—ãŸã€‚  \r\n`universal`ãªã‚‰HTMLã«æ›¸ãå‡ºã—ã¦ãã‚Œã‚‹ã®ã§JSåˆ‡ã£ã¦ã‚‚è¦‹ã‚Œã¾ã™ã€‚\r\n\r\n### (æœ¬å½“ã‹ã‚ã‹ã‚‰ã‚“ã‘ã©)é–‹ç™ºæ™‚(localhost)ã®æ™‚ã¯åˆ¥ã®ã‚¿ãƒ–ã§é–‹ã‘ãªã„ï¼Ÿ\r\n\r\nè¨˜äº‹ã‚’åˆ¥ã®ã‚¿ãƒ–ã§é–‹ãã¨æ°¸é ã«èª­ã¿è¾¼ã‚“ã§ãŸã‚Šã™ã‚‹ã‚“ã ã‘ã©ã‚‚ã—ã‹ã—ã¦åˆ¥ã®ã‚¿ãƒ–ã§é–‹ãã“ã¨ã§ããªã„ï¼Ÿ\r\n\r\n## ç‰¹ã«å¤§å¤‰ã˜ã‚ƒãªã‹ã£ãŸã“ã¨\r\n\r\n### PWA\r\n\r\nPWAã£ã¦ã‚ã‚“ã©ã„ã‚“ã§ã™ã‚ˆã€‚ã‚¢ã‚¤ã‚³ãƒ³ç”»åƒã‚’ç”¨æ„ã™ã‚‹ã®ãŒã­ï¼ï¼ï¼ã€‚  \r\n192x192ã ã£ãŸã‚Š512x512ã ã£ãŸã‚Šã„ã£ã±ã„è¦æ±‚ã—ã¦ãã‚‹ã‚“ã§ã™ã‘ã©ã€  \r\n`@nuxt/pwa`ã¯æŒ‡å®šãŒãªã„å ´åˆã€`static/icon.png`ã‚’ä½¿ã£ã¦ãã‚Œã‚‹ã®ã§ã€512x512ã®pngã‚’ç½®ã„ã¦ãŠãã ã‘ã§çµ‚ã‚ã‚Šã¾ã—ãŸã€‚PWA RTAè¡Œã‘ãã†ï¼ˆã¯ï¼Ÿï¼‰  \r\n\r\nä¸€å¿œ`nuxt.config.js`ã®`manifest`ç½®ã„ã¦ãŠãã¾ã™ã­ã€‚\r\n\r\n```js\r\n/** \r\n * PWA manifest.json\r\n */\r\nmanifest: {\r\n  name: 'ãŸãã•ã‚“ã®è‡ªç”±å¸³',\r\n  title: 'ãŸãã•ã‚“ã®è‡ªç”±å¸³',\r\n  'og:title': 'ãŸãã•ã‚“ã®è‡ªç”±å¸³',\r\n  lang: 'ja',\r\n  theme_color: '#8c9eff',\r\n  background_color: '#5870cb',\r\n  display: 'standalone',\r\n}\r\n```\r\n\r\n### ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰\r\n\r\nVuetifyãªã‚‰  \r\n```js\r\n$vuetify.theme.dark = true\r\n```  \r\nã§çµ‚ã‚ã‚Šã¾ã™ã€‚Vuetifyã™ã’ãƒ¼\r\n\r\nãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆã‚¹ã‚¤ãƒƒãƒã®ä¾‹ç½®ã„ã¨ãã¾ã™ã­ã€‚\r\n\r\n```js\r\n<!-- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¤ãƒƒãƒ -->\r\n<v-switch\r\n  class=\"text-center ma-2\"\r\n  :append-icon=\"`${$vuetify.theme.dark ? 'mdi-weather-night' : 'mdi-weather-sunny'}`\"\r\n  v-model=\"$vuetify.theme.dark\"\r\n  label=\"ãƒ†ãƒ¼ãƒåˆ‡ã‚Šæ›¿ãˆ\"\r\n></v-switch>\r\n```\r\n\r\nä¸‰é …æ¼”ç®—å­ä½¿ã†ã®åˆã‚ã¦ã‹ã‚‚ã—ã‚Œãªã„ï¼ˆã¾ãšKotlinã«ã¯ãªã„ã—ï¼‰  \r\n\r\nã¨ã“ã‚ã§$â†ã“ã‚Œãªã«ï¼Ÿ\r\n\r\n### ç«¯æœ«ãŒãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹\r\n\r\nä»¥ä¸‹ã®JSã§ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‹ã©ã†ã‹ã‚’ç›£è¦–ã—ã¦ã€Vuetifyã®ãƒ¢ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã™ã‚‹ã‚ˆã†ã«ã§ãã¾ã™ã€‚  \r\n[å‚è€ƒï¼šStackOverflow](https://stackoverflow.com/questions/56393880/how-do-i-detect-dark-mode-using-javascript)\r\n\r\n```js\r\nwindow\r\n      .matchMedia(\"(prefers-color-scheme: dark)\")\r\n      .addEventListener(\"change\", e => {\r\n        const isDeviceDarkModeEnabled = e.matches;\r\n        // Vuetifyåˆ‡ã‚Šæ›¿ãˆã‚‹\r\n        this.$vuetify.theme.dark = isDeviceDarkModeEnabled\r\n      });\r\n```\r\n\r\n**StackOverflow**å…ˆç”Ÿã®å›ç­”ã§ã¯`e.matches`ã«`darkã‹light`ãŒå…¥ã£ã¦ã‚‹ã£ã½ã„ã‚“ã§ã™ãŒã€ç§ã®Chromeãã‚“ã§ã¯`trueã‹false`ã§ã—ãŸã€‚å…ˆç”Ÿã®å›ç­”ã¡ã‚‡ã£ã¨å¤ã‹ã£ãŸã®ã‹ãªã€‚\r\n\r\n~~ã¾ã‚ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã‚“ã¦ã‚ã‚“ã¾ä½¿ã‚ãªã„ã‚“ã§ã™ã‘ã©ã­ï¼ˆã¯ï¼Ÿï¼‰~~\r\n\r\n## ãŠã‚ã‚Šã«\r\nå­¦æ ¡å§‹ã¾ã‚‹ã‚ã€‚æ—©èµ·ãã¤ã£ã‚‰  \r\nã‚ã¨ç”»åƒè²¼ã‚‹æ–¹æ³•ç¢ºç«‹ã—ã¦ãªã„ã€‚imgurä½¿ã†ã‹ï¼Ÿ"},{"title":"Next.jsã§ãƒ–ãƒ­ã‚°ä½œã‚Šç›´ã—ãŸã®ã§ãã®éš›ã«å¤§å¤‰ã ã£ãŸã“ã¨","link":"/posts/taihendattakoto_next_js_blog/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚\r\n\r\nNext.jsã¸ç§»è¡Œã—ãŸã‚‰ãªã‚“ã‹èª­ã¿è¾¼ã¿ãŒæ—©ããªã£ãŸæ°—ãŒã™ã‚‹ã€‚TypeScriptã®ã‚µãƒãƒ¼ãƒˆãŒã„ã„ã­ï¼\r\n  \r\nInternet Explorer 11 ã§ã‚‚è¦‹ã‚Œãªãã¯ãªã„ã§ã™ã­ã€‚  \r\nå…ˆäººãŒé ‘å¼µã£ã¦Polyfillã—ãŸã‚“ã‹ãªã€ã€ã€ãŠç–²ã‚Œæ§˜ã§ã™\r\n\r\n## Nuxt.js ã‹ã‚‰ã®ç§»è¡Œ\r\n- URLã®æœ«å°¾ã«ã‚¹ãƒ©ãƒƒã‚·ãƒ¥ã‚’ä»˜ã‘ã‚‹\r\n    - çŸ¥ã‚‰ã‚“ã‘ã©ONã«ã—ã¦ãŠã\r\n\r\n### nuxt/content ã§ä½¿ã£ã¦ãŸæ©Ÿèƒ½\r\n- è¨˜äº‹æ›¸ã„ã¦ã‚‹ã¨ãã®ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°\r\n    - ã„ã‚‰ãªã„ã¨è¨€ãˆã°ã„ã‚‰ãªã„ã‹ã‚‚...\r\n\r\n## remark() ã¨ rehype() \r\n- remark\r\n    - Markdownå‡¦ç†ç³»\r\n- rehype\r\n    - Htmlå‡¦ç†ç³»\r\n\r\n```ts\r\n// ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ -> unified -> HTML \r\nconst remarkParser = await unified()\r\n    .use(remarkParse)\r\n    .use(remarkRehype, { allowDangerousHtml: true })\r\n    .use(rehypeRaw)\r\n    .use(remarkGfm)\r\n    .use(rehypeStringify)\r\n    .use(rehypeHighlight, {\r\n        // åˆ©ç”¨ã§ããªã„è¨€èªã®å ´åˆã¯ã‚¨ãƒ©ãƒ¼å‡ºã•ãšã«ç„¡è¦–\r\n        ignoreMissing: true\r\n    })\r\n    .process(matterResult.content)\r\nconst markdownToHtml = remarkParser.toString()\r\n```\r\n\r\n### Markdownã®ãƒ†ãƒ¼ãƒ–ãƒ«ï¼ˆè¡¨ï¼‰ã€æ‰“ã¡æ¶ˆã—ç·šã€URLã®è‡ªå‹•ãƒªãƒ³ã‚¯æ©Ÿèƒ½ã¯æ¨™æº–æ©Ÿèƒ½ã§ã¯ãªã„ï¼\r\n\r\nã™ã¹ã¦æœ‰å¿—ã®æ‹¡å¼µæ©Ÿèƒ½ã ã£ãŸã‚“ã§ã™ã­ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§ã€`remark-gfm`ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n```\r\nnpm i remark-gfm\r\n```\r\n\r\nã‚ã¨è¡¨ã«ã¯ CSS ã‚’å½“ã¦ãªã„ã¨è¦‹ãšã‚‰ã„ã§ã™ã­ã€‚\r\n\r\n```css\r\ntable {\r\n    border-collapse: collapse;\r\n    border-spacing: 0;\r\n    width: 100%;\r\n    margin: 10px;\r\n}\r\n\r\ntable tr {\r\n    border-bottom: solid 1px #000;\r\n}\r\n\r\ntable td {\r\n    padding: 10px;\r\n    text-align: center;\r\n}\r\n```\r\n\r\n### Markdownã«åŸ‹ã‚è¾¼ã‚“ã HTMLã‚‚å¯¾å¿œã•ã›ã‚‹\r\n\r\n`npm i rehype-raw`ã§å¯¾å¿œã§ãã¾ã™\r\n\r\n## getStaticPaths ã¨ getStaticProps ã®å‹•çš„ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°\r\n\r\n`[ã“ã“ã®åå‰].tsx`â†ã“ã“ã®åå‰ ã®éƒ¨åˆ†ãŒã‚­ãƒ¼ã«ãªã‚Šã¾ã™ã€‚æ³¨æ„ã—ã¦ä¸‹ã•ã„\r\n\r\n\r\n```ts\r\n// getStaticPaths\r\n\r\nconst pathIdList = []\r\nfor (let i = 0; i < requirePageCount; i++) {\r\n    // ã“ã®å ´åˆã¯ã‚­ãƒ¼ãŒ page ã«ãªã‚‹ã‘ã©ã“ã‚Œã¯ãƒ•ã‚¡ã‚¤ãƒ«åã«ã‚ˆã£ã¦å¤‰ã‚ã‚‹ï¼ˆ[page].tsxã ã‹ã‚‰ï¼‰\r\n    pathIdList.push({ params: { page: `${i}` } })\r\n}\r\nreturn {\r\n    paths: pathIdList,\r\n    fallback: false\r\n}\r\n```\r\n\r\n```ts\r\n// getStaticProps\r\nexport const getStaticProps: GetStaticProps<BlogListPageProps> = async context => {\r\n    // posts/page/<ã“ã“> ã‚’å–å¾—\r\n    const pageId = parseInt(context.params[\"page\"] as string) //[page].tsx ã ã‹ã‚‰ page\r\n    // çœç•¥...\r\n```\r\n\r\n## Reactã®JSX(TSX)ã®ä¸­ã§æ¡ä»¶ä»˜ããƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°\r\nã“ã‚Œä½¿ã£ã¦ã„ã„ã®ã‹çŸ¥ã‚‰ã‚“ã‘ã©é¢ç™½ã„ã®ã§ä½¿ã£ã¦ã¾ã™ã€‚  \r\n`Jetpack Compose`ã¨é•ã£ã¦ã€returnã§JSXã‚’è¿”ã™å¿…è¦ãŒã‚ã‚‹ã‚“ã ã‘ã©JSXå†…ã§ã¯ifãŒæ›¸ã‘ãªã„ã€‚  \r\nä»£ã‚ã‚Šã«`&&`ã‚’ä½¿ã£ã¦å·¦å´ãŒtrueã®å ´åˆã¯å³å´ã«é€²ã‚€ã“ã¨ã‚’åˆ©ç”¨ã—ãŸæ–¹æ³•ã§ã‹ã‘ã‚‹ã€‚ã‹ã—ã“ã„ï¼\r\n\r\nhttps://ja.reactjs.org/docs/conditional-rendering.html#inline-if-with-logical--operator\r\n\r\n```tsx\r\nconst ExpandedText = () => {\r\n    const [isExpanded, setExpanded] = useState(false)\r\n\r\n    return (\r\n        <>\r\n            <p>Hello</p>\r\n            {\r\n                isExpanded && <p>World</p>\r\n            }\r\n            <Button onClick={()=> setExpanded(!isExpanded)}>\r\n                Open!\r\n            </Button>\r\n        </p>\r\n    )\r\n}\r\n```\r\n\r\n## ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰\r\n`MUI`ã®æ©Ÿèƒ½ã§ã§ãã¾ã™ã€‚  \r\nä¸€å¿œè‰²ç½®ã„ã¦ãŠãã¾ã™ã€‚\r\n\r\n```tsx\r\nconst useCustomTheme = (isDarkmode: boolean) => {\r\n    // isDarkmode ãŒå¤‰ã‚ã£ãŸã¨ãã ã‘å†è¨ˆç®—ã•ã‚Œã‚‹ã¯ãš\r\n    return React.useMemo(\r\n        () => createTheme({\r\n            palette: {\r\n                mode: isDarkmode ? 'dark' : 'light',\r\n                primary: {\r\n                    main: isDarkmode ? '#b6c4ff' : '#4559a9', // md_theme_light_primary\r\n                },\r\n                secondary: {\r\n                    main: '#006c49',\r\n                },\r\n                error: {\r\n                    main: '#ba1b1b',\r\n                },\r\n                background: {\r\n                    default: isDarkmode ? '#000000' : '#dce1ff', // md_theme_light_primaryContainer\r\n                    paper: isDarkmode ? '#1b1b1f' : '#fefbff', // md_theme_light_surface : md_theme_dark_surface\r\n                }\r\n            },\r\n            typography: {\r\n                fontFamily: [\r\n                    'Koruri Regular'\r\n                ].join(','),\r\n            }\r\n        }),\r\n        [isDarkmode]\r\n    )\r\n}\r\n\r\nexport default useCustomTheme\r\n```\r\n\r\nãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¤ãƒƒãƒã®ã‚¤ãƒ™ãƒ³ãƒˆã¯`Props`ã§ã‚¹ã‚¤ãƒƒãƒã®åˆ‡ã‚Šæ›¿ãˆãƒã‚±ãƒ„ãƒªãƒ¬ãƒ¼ã—ã¦ã¾ã™ã€‚  \r\næ­£æ”»æ³•ã¯ã‚ã‹ã‚‰ã‚“ã€‚é »ç¹ã«ä½¿ã†ã‚‚ã‚“ã˜ã‚ƒãªã„ã—ã„ã„ã‚“ã˜ã‚ƒã­ï¼Ÿ\r\n\r\nã¤ã„ã§ã«ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚‚åæ˜ ã•ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã—ãŸã€‚Win10ã§ç¢ºèªã—ãŸ\r\n\r\n```tsx\r\n// _app.tsx\r\n\r\n/**\r\n * Androidã§è¨€ã†ã¨ã“ã‚ã®Activityã€‚ã“ã®ä¸­ã§Pages(Androidã§ã„ã†ã¨Fragment)ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹\r\n */\r\nconst App = ({ Component, pageProps }) => {\r\n    // ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚¹ã‚¤ãƒƒãƒ\r\n    const [isDarkmode, setDarkmode] = useState(false)\r\n    // ãƒ†ãƒ¼ãƒã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼Ÿä½•ã‚‚ã‚ã‹ã‚‰ã‚“\r\n    const theme = useCustomTheme(isDarkmode)\r\n\r\n    // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šãŒãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã‚‰ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã«ã™ã‚‹ã€‚Win10ã§ç¢ºèªæ¸ˆã¿\r\n    const prefersDarkMode = useMediaQuery('(prefers-color-scheme: dark)')\r\n    // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã®ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰åˆ‡ã‚Šæ›¿ãˆæ™‚ã«ãƒ†ãƒ¼ãƒã‚‚åˆ‡ã‚Šæ›¿ãˆ\r\n    useEffect(() => {\r\n        setDarkmode(prefersDarkMode)\r\n    }, [prefersDarkMode])\r\n\r\n    return (\r\n        <>\r\n            <ThemeProvider theme={theme}>\r\n                {/* ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‰ãƒ­ãƒ¯ãƒ¼ã¨ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ã‚’Appã§æç”»ã™ã‚‹ã€‚å„Pageã§ã¯æç”»ã—ãªã„ */}\r\n                <Layout\r\n                    isDarkmode={isDarkmode}\r\n                    onDarkmodeChange={() => setDarkmode(!isDarkmode)}\r\n                >\r\n                    {/* å„Pageã¯ã“ã“ã§åˆ‡ã‚Šæ›¿ãˆã‚‹ã€‚ã“ã‚Œã§ã‚¿ã‚¤ãƒˆãƒ«ãƒãƒ¼ç­‰ã¯å…±é€šåŒ–ã•ã‚Œã‚‹ */}\r\n                    <Component {...pageProps} />\r\n                </Layout>\r\n            </ThemeProvider>\r\n        </>\r\n    )\r\n}\r\n```\r\n\r\n## Android 12 ã¿ãŸã„ãªã‚¹ã‚¤ãƒƒãƒ\r\nã“ã“ã«ä¾‹ãŒã‚ã‚Šã¾ã™ã€‚thx!!!\r\n\r\nhttps://mui.com/components/switches/#customization\r\n\r\n## SVGç”»åƒã®è‰²ã‚’ç°¡å˜ã«å¤‰ãˆã‚‰ã‚Œã‚‹ã¨æ€ã£ã¦ãŸ\r\nAndroidã ã¨`ImageView#setTint() ã ã£ã‘ï¼Ÿ`ã§ãã‚‹ã‘ã©CSSã«ã¯ãã†ã„ã†æ©Ÿèƒ½ç„¡ã„ã‚‰ã—ã„ã€‚  \r\nãªã®ã§ã“ã†ã„ã†CSSã‚’ã‹ã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚ç§ã‚‚ã‚ˆãçŸ¥ã‚‰ãªã„ã®ã§è©³ã—ãã¯ å±æ€§ã‚»ãƒ¬ã‚¯ã‚¿ãƒ¼ ã¨ã‹ã§æ¤œç´¢ã—ã¦ãã ã•ã„ã€‚  \r\n`!important`ã‚’è¿½è¨˜ã™ã‚Œã°svgå†…ã®pathã€circleã®è‰²ã‚‚ä¸Šæ›¸ãå‡ºæ¥ã¾ã™ã€‚ä½¿ã£ã¦ã„ã„ã®ã‹ã¯çŸ¥ã‚‰ã‚“ã‘ã©\r\n\r\n```html\r\n<svg className=\"svg_color\">\r\n\r\n</svg>\r\n```\r\n\r\n```css\r\n.svg_color path {\r\n    stroke: red;\r\n}\r\n.svg_color circle[style*=\"fill:none\"] {\r\n    stroke: red;\r\n}\r\n.svg_color circle[style*=\"stroke:none\"] {\r\n    fill: red;\r\n}\r\n```\r\n\r\n`pages/404.tsx`å‚ç…§\r\n\r\n\r\n## ã‚µã‚¤ãƒˆãƒãƒƒãƒ—\r\n\r\nhttps://github.com/iamvishnusankar/next-sitemap \r\n\r\nã‚’åˆ©ç”¨ã™ã‚‹ã“ã¨ã§ç°¡å˜ã«ä½œæˆã§ãã¾ã™ã€‚  \r\n\r\nã„ã‚Œã¦\r\n\r\n`npm install --save-dev next-sitemap`\r\n\r\n`package.json`ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã«`next-sitemap.config.js`ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\nå…¬å¼ã§ã¯`next-sitemap.js`ã‚’ä½œã‚Œã¨è¨€ã£ã¦ã¾ã™ãŒã€Windowsã®å ´åˆã¯é§„ç›®ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n(Windowsã ã¨ã©ã†ã‚„ã‚‰ ç’°å¢ƒå¤‰æ•° ã‚ˆã‚Šã‚‚ ãƒ•ã‚©ãƒ«ãƒ€å†…ãƒ•ã‚¡ã‚¤ãƒ« ãŒå„ªå…ˆã•ã‚Œã‚‹ã‚‰ã—ã„)\r\n\r\nã‚ã¨ã¯ãƒ“ãƒ«ãƒ‰æ™‚ã«ç”Ÿæˆã™ã‚‹ã‚ˆã†ã«`package.json`ã«è¿½è¨˜ã™ã‚Œã°ãŠk\r\n\r\n```\r\n\"scripts\": {\r\n  \"dev\": \"next dev\",\r\n  \"build\": \"next build\",\r\n  \"start\": \"next start\",\r\n  \"postbuild\": \"next-sitemap --config next-sitemap.config.js\",\r\n  \"deploy\": \"npm run build && npm run postbuild && npm run export\"\r\n},\r\n```\r\n\r\n## Google Analytics 4 ã‚’å…¥ã‚Œã‚‹\r\nGoogleã•ã‚“ãŒå®šæœŸçš„ã«ãƒ¡ãƒ¼ãƒ«ã§ GA4ã„ã‹ãŒãƒ»ãƒ» ã£ã¦ãƒ¡ãƒ¼ãƒ«ã§é€ã£ã¦ãã‚‹ã®ã§å¯¾å¿œã—ãŸã€‚  \r\n\r\nã¨ã„ã†ã‹`GA4`ã€ã“ã‚Œä»Šã¾ã§ã®`UA`ã‚’ç½®ãæ›ãˆã‚‹ã‚„ã¤ã‹ã¨æ€ã£ã¦ãŸã‚“ã ã‘ã©ã€ã©ã†ã‚„ã‚‰é•ã†ã¿ãŸã„ï¼Ÿ  \r\nãªã‚“ã‹ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ«ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ã§é›†ã‚ã¦ãŸæ™‚ä»£ã®ãƒ‡ãƒ¼ã‚¿ã¯å¼•ãç¶™ã„ã§ãã‚Œãªã„ã£ã½ã„ã—ä½•ã‚„ã­ã‚“ãƒ»ãƒ»ãƒ»\r\n\r\n```\r\nGA4 è¨­å®šã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ ã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ã§ã¯ã€ä½œæˆã—ãŸ GA4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ãŒéå»ã®ãƒ‡ãƒ¼ã‚¿ã«åŸºã¥ããƒãƒƒã‚¯ãƒ•ã‚£ãƒ«ã•ã‚Œã‚‹ã“ã¨ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚GA4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã«ä¿å­˜ã•ã‚Œã‚‹ã®ã¯ã€è¨­å®šå¾Œã«ç™ºç”Ÿã—ãŸãƒ‡ãƒ¼ã‚¿ã®ã¿ã§ã™ã€‚éå»ã®ãƒ‡ãƒ¼ã‚¿ã‚’å‚ç…§ã™ã‚‹éš›ã¯ã€ãƒ¦ãƒ‹ãƒãƒ¼ã‚µãƒ« ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ãƒ¬ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚\r\n```\r\n\r\n<https://support.google.com/analytics/answer/9744165?hl=ja&utm_id=ad#zippy=%2Cã”è‡ªèº«ã¾ãŸã¯ã‚¦ã‚§ãƒ–-ãƒ‡ãƒ™ãƒ­ãƒƒãƒ‘ãƒ¼ãŒã‚¦ã‚§ãƒ–ãƒšãƒ¼ã‚¸ã«æ‰‹å‹•ã§ã‚¿ã‚°ã‚’è¨­å®šã™ã‚‹å ´åˆ>\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€ä»Šã®ã¨ã“ã‚ã¯`GA4`ã¨`UA`ã®ä¸¡æ–¹ã§é›†è¨ˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã‚ã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/4bkbzPv.png)\r\n\r\n`head`å†…ã«`GA4`ã®JavaScriptã‚’å·®ã—è¾¼ã‚€ã‚ˆã†ã«ã™ã‚Œã°ã„ã„ã§ã™ã€‚\r\n`GA_TRACKING_ID`ã«ã¯**GA4ã®æ¸¬å®šID**ã€`UA_TRACKING_ID`ã«ã¯**UAã®ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ã‚³ãƒ¼ãƒ‰**ã‚’å¤‰æ•°ã«å…¥ã‚Œã¦ãŠã„ã¦ä¸‹ã•ã„ã€‚  \r\nå¤šåˆ†`Google ã‚¢ãƒŠãƒªãƒ†ã‚£ã‚¯ã‚¹ 4 ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®è¨­å®šã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆ`ã‚’åˆ©ç”¨ã—ãªã„ã¨é§„ç›®ã‹ã‚‚ï¼Ÿ\r\n\r\n```tsx\r\n<Head>\r\n    <script async src={`https://www.googletagmanager.com/gtag/js?id=${GA_TRACKING_ID}`}></script>\r\n    <script dangerouslySetInnerHTML={{\r\n        __html: `\r\n            window.dataLayer = window.dataLayer || [];\r\n            function gtag(){dataLayer.push(arguments);}\r\n            gtag('js', new Date());\r\n            gtag('config', '${UA_TRACKING_ID}');\r\n            gtag('config', '${GA_TRACKING_ID}');\r\n        `}}\r\n    />\r\n</Head>\r\n```\r\n\r\nãªã‚“ã‹èª¿ã¹ã¦ã‚‹ã¨`next/script`ã§ã„ã„æ„Ÿã˜ã«èª­ã¿è¾¼ã‚€æ›¸ãæ–¹ã‚’ã—ã¦ã‚‹ä¾‹ãŒã‚ã‚Šã¾ã™ãŒç§ã®ç’°å¢ƒã§ã¯é‡è¤‡ã—ã¦é€ä¿¡ã•ã‚ŒãŸã®ã§è¾ã‚ã¾ã—ãŸã€‚\r\n\r\n## Material-UIã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’æ›¸ãã¨ãã®æ³¨æ„ç‚¹\r\nåå‰ä»˜ãã‚¤ãƒ³ãƒãƒ¼ãƒˆã ã¨é–‹ç™ºç’°å¢ƒã®èª­ã¿è¾¼ã¿ãŒé…ããªã‚Šã¾ã™ã€‚  \r\n\r\n```tsx\r\nimport { AndroidOutlined } from '@mui/icons-material' // ã“ã‚Œã ã¨é‡ããªã‚‹\r\n```\r\n\r\n```tsx\r\nimport AndroidOutlined from '@mui/icons-material/AndroidOutlined'\r\n```\r\n\r\nè©³ã—ãã¯ï¼šhttps://takusan.negitoro.dev/posts/next_js_mui_material_icon_build_speed/\r\n\r\nä»Šå›ã¯Babelã®è¨­å®šã›ãšã«å€‹åˆ¥ã«ã‚¤ãƒ³ãƒãƒ¼ãƒˆã™ã‚‹ã‚ˆã†ã«ã—ã¦ã¾ã™ã€‚\r\n\r\nã¡ãªã¿ã«ã“ã‚Œã¯Kotlinã§è©²å½“ã®JavaScriptã‚’æ¸¡ã™ã¨å¤‰æ›ã—ã¦ãã‚Œã‚‹ã‚³ãƒ¼ãƒ‰ã€‚\r\n\r\n```kotlin\r\nfun main() {\r\n\r\n    val javaScriptCode = \"\"\"\r\n        \r\nimport { BookOutlined } from \"@mui/icons-material\"\r\n\r\n    \"\"\".trimIndent()\r\n\r\n    // \"@mui/icons-material\" ã®éƒ¨åˆ†ã‚’å–å¾—ã™ã‚‹æ­£è¦è¡¨ç¾\r\n    val packageRegex = \"\\\"(.*?)\\\"\".toRegex()\r\n    val packageName = packageRegex.find(javaScriptCode)!!.groupValues[1]\r\n\r\n    // { BookOutlined } ã®éƒ¨åˆ†ã‚’å–å¾—ã™ã‚‹æ­£è¦è¡¨ç¾\r\n    val namedImportRegex = \"\\\\{(.*?)}\".toRegex()\r\n    val namedImportCode = namedImportRegex.find(javaScriptCode)!!.groupValues[1]\r\n    // è¤‡æ•°ã‚¤ãƒ³ãƒãƒ¼ãƒˆã•ã‚Œã¦ã„ã‚‹ã‹\r\n    val namedImportList = if (namedImportCode.contains(\",\")) {\r\n        namedImportCode\r\n            .split(\",\")\r\n            .map { it.replace(\" \", \"\") }\r\n    } else {\r\n        listOf(namedImportCode.replace(\" \", \"\"))\r\n    }\r\n\r\n    namedImportList.forEach { name ->\r\n        println(\"\"\"import $name from \"${packageName}/${name}\" \"\"\")\r\n    }\r\n\r\n}\r\n```\r\n\r\n## Netlifyã§ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã™ã‚‹éš›ã¯\r\nSSGãƒ¢ãƒ¼ãƒ‰ã®å ´åˆã¯ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’OFFã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\nNetlifyã®ã‚µã‚¤ãƒˆã®è¨­å®šã‹ã‚‰ã€Build & Deployã‚’é–‹ã„ã¦ã€ç’°å¢ƒå¤‰æ•°ã«è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/9u5rplE.png)\r\n\r\nã¡ãªã¿ã«ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã¨å…¬é–‹ã™ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã¯\r\n\r\nBuild commandsï¼š`npm run build && npm run export`  \r\nPublish directoryï¼š`out`\r\n\r\nã«ãªã‚Šã¾ã™ï½\r\n\r\nhttps://docs.netlify.com/configure-builds/common-configurations/"},{"title":"Tailwind CSS ã§ä½œã‚Šç›´ãã†ã¨ã—ã¦ã„ã‚‹","link":"/posts/tailwind_css_migration/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\næœ€è¿‘ãšã£ã¨ã“ã‚Œèã„ã¦ã‚‹  \r\n\r\n![Imgur](https://imgur.com/2MaMBpB.png)\r\n\r\n*ã€Œå¶ç„¶ã€ã§ç‰‡ä»˜ã‘ãŸããªã„ é‹å‘½ã«ã—ãŸã„*\r\n\r\nã‚²ãƒ¼ãƒ ã‚„ã£ã¦ãªã„ã‘ã©CDã ã‘è²·ã£ãŸã€‚ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/9DUoKCH.png)\r\n\r\n# æœ¬é¡Œ\r\n`Material-UI`ã‚’ã‚„ã‚ã¦ã€`Tailwind CSS`ã«ã—ã‚ˆã†ã¨æ€ã„ã¾ã™...\r\n\r\n![Imgur](https://imgur.com/ZgnivHu.png)\r\n\r\n![Imgur](https://imgur.com/MSVr7MU.png)\r\n\r\n![Imgur](https://imgur.com/mcZbOGN.png)\r\n\r\n![Imgur](https://imgur.com/9iXlLFM.png)\r\n\r\næœ€è¿‘ã®`Android`ã¨ã„ã†ã‹ã€`Material 3`ã¨ã„ã†ã‹ã‚’çœŸä¼¼ã¦ã¿ã¾ã—ãŸã€‚  \r\nè§’ã‚’çµæ§‹ä¸¸ãã—ãŸã‚Šã€ãƒªã‚¹ãƒˆã¨ã‹ã€‚\r\n\r\n## ç§»è¡Œå‰\r\nç§»è¡Œå‰ã®`main ãƒ–ãƒ©ãƒ³ãƒ`ã®ã‚³ãƒ¼ãƒ‰ã‚’`material_ui`ãƒ–ãƒ©ãƒ³ãƒã«åˆ‡ã£ã¦ã‚ã‚Šã¾ã™ã€‚  \r\nhttps://github.com/takusan23/ziyuutyou-next/tree/material_ui\r\n\r\nå¼•ãç¶šãå‚ç…§å¯èƒ½ã§ã™ã€‚\r\n\r\n# Tailwind CSS\r\nè³›å¦ä¸¡è«–ã€‚ã‚ãŸã—ã¯ã™ãã€  \r\nã¨ã„ã†ã‹`Webãƒ•ãƒ­ãƒ³ãƒˆ`ã‚ˆãçŸ¥ã‚‰ãªã„ã®ã§ã€`Next.js`ã«å…¥ã£ã¦ã‚‹ã‚„ã¤ï¼ˆã„ã¤ã®é–“ã«ã‹é¸æŠã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã‚‰ã—ã„ï¼‰ã‚’å¤§äººã—ãä½¿ã†ã€‚  \r\n\r\n```tsx\r\n/** RoundedCornerBox ã¸æ¸¡ã™ãƒ‡ãƒ¼ã‚¿ */\r\ntype RoundedCornerBoxProps = {\r\n    /** ã©ã‚Œã ã‘ä¸¸ãã™ã‚‹ã‹ */\r\n    rounded?: 'small' | 'medium' | 'large'\r\n    /** Tailwind CSS ã®ã‚¯ãƒ©ã‚¹å */\r\n    className?: string\r\n    /** å­è¦ç´  */\r\n    children: ReactNode\r\n}\r\n\r\n/** è§’ä¸¸ãªBox */\r\nexport default function RoundedCornerBox({ className, rounded, children }: RoundedCornerBoxProps) {\r\n    // å¤‰æ•°åŸ‹ã‚è¾¼ã¿ã¨ã‹ã¯ä½¿ãˆãªã„\r\n    // https://tailwindcss.com/docs/content-configuration#class-detection-in-depth\r\n    const colorOrDefault = className ?? 'bg-container-primary-light dark:bg-container-primary-dark'\r\n    let roundedClassName: string\r\n    switch (rounded ?? 'small') {\r\n        case 'small':\r\n            roundedClassName = 'rounded-md'\r\n            break\r\n        case 'medium':\r\n            roundedClassName = 'rounded-xl'\r\n            break\r\n        case 'large':\r\n            roundedClassName = 'rounded-3xl'\r\n            break\r\n    }\r\n\r\n    return (\r\n        <div className={`${roundedClassName} ${colorOrDefault}`}>\r\n            {children}\r\n        </div>\r\n    )\r\n}\r\n```\r\n\r\n# ãªã‚“ã§\r\næ™‚ä»£ã¯`RSC ( React Server Components )`ã«çªå…¥ã—ãŸã‚‰ã—ã„ã€‚ãƒ–ãƒ©ã‚¦ã‚¶å´ã§å®Ÿè¡Œã•ã‚Œã‚‹`JavaScript`ã‚’æ¸›ã‚‰ã™æ™‚ä»£ãŒã‚„ã£ã¦ããŸï¼ï¼ï¼  \r\nç†ç”±ã§ã™ãŒ...\r\n\r\n- `CSS`çµ¶å¯¾æ›¸ããŸããªã„ã‹ã‚‰`Material-UI`å…¥ã‚ŒãŸã‚“ã ã‘ã©ã€`Tailwind CSS`ãŒçµæ§‹è‰¯ã•ãã†ã ã£ãŸ\r\n    - ã“ã‚Œãªã‚‰æ›¸ããŸã„\r\n        - ãªã‚“ã‹`.css`æ›¸ããŸããªã„ã—...\r\n        - `scoped`ãª`css`ã¨ã‹`vue ?`ã«ã‚ã£ãŸæ°—ãŒã™ã‚‹ã‘ã©ã‚ã‚“ã¾ã‚Šä½¿ã„ã“ãªã›ãªã‹ã£ãŸ...ï¼ˆç§ã®ã›ã„\r\n    - ã‚ˆãä½¿ã†ã‚„ã¤ãŒã™ãä½¿ãˆã‚‹`flex-row`/`flex-col`ã¨ã‹\r\n        - è§’ã‚’ä¸¸ãã™ã‚‹ã¨ã‹\r\n        - `px-`/`py-`ã¨ã‹ä¾¿åˆ©\r\n            - `space-x-2 `ã“ã‚Œã‚‚\r\n    - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã”ã¨ã«åŒºåˆ‡ã£ã¦ã‚‹ã®ã§ãã‚“ãªã«`class`é•·ãã¦ã‚‚ãã“ã¾ã§ã€ã€ã€ã£ã¦æ„Ÿã˜ãªæ°—ãŒã™ã‚‹\r\n- ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ã‚„ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã€ãƒ†ãƒ¼ãƒæ©Ÿèƒ½ãŒã‚ã‚‹\r\n    - ç¾çŠ¶ä½¿ã£ã¦ã„ã‚‹ã®ã§å¿…è¦\r\n    - ã“ã®è¾ºã‚‚`CSS`ã‚’ãã®ã¾ã¾æ›¸ãã®ã¯ã€ã€ã€ã†ãƒ¼ã‚“ã‚„ã‚ŠãŸããªã„ã‹ãªã‚\r\n- è³›å¦ä¸¡è«–ã‚ã‚‹ã‘ã©ç‰¹ã«å›°ã£ã¦ãªã„ï¼ï¼ï¼\r\n    - ï¼ˆä»£æ›¿æ¡ˆã‚’ä½¿ã£ãŸã“ã¨ç„¡ã„ã®ã§ï¼‰\r\n\r\nä»¥ä¸Šã§ã™ã€‚  \r\nã‚ã¨ã€`Tailwind CSS`é–¢ä¿‚ãªãã€ãƒ–ãƒ­ã‚°ï¼ˆé™çš„ã‚µã‚¤ãƒˆï¼‰ãªã®ã§ã€ãƒªãƒƒãƒãª UI ã‚ˆã‚Šèª­ã¿è¾¼ã¿ãŒæ—©ã„ã»ã†ãŒè‰¯ã„ã‹ãªã‚ã£ã¦ã®ã‚‚ã‚ã‚Šã¾ã™ã€‚  \r\nï¼ˆ`ã‚¼ãƒ­ãƒ©ãƒ³ã‚¿ã‚¤ãƒ  CSS`ã¨ã‹ã„ã†ã‚„ã¤ï¼‰\r\n\r\nãŸã ã€ã“ã“ã§`RSC`ã‚„`Tailwind CSS`ã«**è³­ã‘ã¦è‰¯ã„**ã®ã‹ã¯åˆ†ã‹ã‚‰ãªã„ã€ã€ã€`Webãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰`ã£ã¦ãªã‚“ã‹æµè¡Œã®ç§»ã‚Šå¤‰ã‚ã‚ŠãŒæ—©ã™ãã‚‹ã€‚  \r\n\r\nã¡ãªã¿ã«`App Router`ã§å‹•ã`Material-UI`ã®ã‚µãƒãƒ¼ãƒˆã¯å…¥ã£ãŸã‚‰ã—ã„ã€‚ã“ã‚Œã§ã²ãŸã™ã‚‰`\"use client\"`ã—ãªãã¦ã‚‚æ¸ˆã‚€ã®ã‹ãªï¼Ÿ  \r\nhttps://github.com/mui/material-ui/releases/tag/v5.14.0\r\n\r\nã‚ã¨ã¯ã€ç§»è¡Œã—ãŸã¨ãã«è‰¯ã„ãªã¨æ€ã£ãŸã“ã¨ã¨ã‹ã‚’ã¤ã‚‰ã¤ã‚‰ã¨...\r\n\r\n# è‰¯ã‹ã£ãŸç‚¹\r\n\r\n## ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ã©ã£ã¡ã§ã‚‚æ›¸ã‘ã‚‹\r\nï¼ˆæœ€çµ‚çš„ã«ã¯`CSS`ãŒåãå‡ºã•ã‚Œã‚‹ï¼Ÿï¼‰ã®ãŒè‰¯ã•ãã†  \r\n`ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã—ã‹ç„¡ã„ãªã‚‰ä»–ã®ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã‚’é¸ã‚“ã ã»ã†ãŒã„ã„ã®ã‹ãƒ»ãƒ»ãƒ»ã‚‚ï¼Ÿ  \r\nãŸã ã€ã¶ã£ã¡ã‚ƒã‘`ã‚µãƒ¼ãƒãƒ¼ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ`ã‚‚ã‚ˆãã‚ã‹ã‚‰ãªã„ã€ã€ã€ã‘ã©é¢ç™½ãã†ã ã—è©¦ã—ã¦ã„ã‚‹\r\n\r\n## ãƒªã‚»ãƒƒãƒˆ CSS\r\nhttps://tailwindcss.com/docs/preflight\r\n\r\nã“ã‚Œã€`h1`ã€`h2`ã€ã€ã®å¤§ãã•ã¯ã™ã¹ã¦åŒã˜å¤§ãã•ã«æƒãˆã‚‰ã‚Œã¾ã™ã€‚  \r\n`ul`ã‚„`p`ã«`margin`ãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§ã‹ã‹ã£ã¦ã„ã¾ã›ã‚“ã€‚  \r\n`aã‚¿ã‚°`ã®è‰²ã‚‚ã‹ã‹ã£ã¦ã¾ã›ã‚“ï¼ï¼ï¼  \r\n\r\n`aã‚¿ã‚°`ã ã‘ã¯ãƒªã‚»ãƒƒãƒˆã•ã‚Œãªã„ã‚ˆã†ã«ã™ã‚‹ãŸã‚ã€ãªã‚“ã‹åˆæœŸå€¤ã«æˆ»ã›ï¼ã¿ãŸã„ãª`CSS`ã‚’æ›¸ãã¾ã—ãŸã€‚  \r\nå¤§äººã—ãã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°ã—ã¦ã‚‚è‰¯ã‹ã£ãŸã‹ã‚‚ã—ã‚Œãªã„ã€‚\r\n\r\n```css\r\n/* Tailwind CSS ã§ aã‚¿ã‚° ã®è‰²ãŒæ¶ˆãˆã¦ã—ã¾ã£ãŸã®ã§ã€ã‚‚ã¨ã«æˆ»ã™ */\r\na {\r\n    color: revert;\r\n    text-decoration: revert;\r\n}\r\n```\r\n## VSCode ã« Tailwind CSS æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¥ã‚Œã‚ˆã†\r\nã“ã‚Œã§ã™  \r\nhttps://marketplace.visualstudio.com/items?itemName=bradlc.vscode-tailwindcss\r\n\r\nå¿«é©ã™ãã¦è‰ã€ã‚¯ãƒ©ã‚¹åã®è£œå……ã‚„ã€è‡ªå‰ã§å®šç¾©ã—ãŸãƒ—ãƒ©ã‚¤ãƒãƒªã‚«ãƒ©ãƒ¼ã¨ã‹ã®è‰²ã¾ã§è¦‹ã‚Œã‚‹ã®å¼·ã™ãã‚„ã‚\r\n\r\n![Imgur](https://imgur.com/ZOB8AxT.png)\r\n\r\næœ€çµ‚çš„ãª`CSS`ã‚‚è¦‹ã‚Œã‚‹ã€‚ã™ã”ã„\r\n\r\n## peer-checked ãŒä¾¿åˆ©\r\nãƒãƒ†ãƒªã‚¢ãƒ«ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã«ã‚‚ã‚ã‚‹`Switch()`ã‚’ä½œã‚ã†ã¨æ€ã„ã¾ã™ã€‚  \r\nã‚¹ã‚¤ãƒƒãƒã‚’æŠ¼ã—ãŸã‚‰ã¤ã¾ã¿ï¼ˆ`Thumb`ï¼‰ã‚’å³å´ã¸ç§»å‹•ã™ã‚‹ãŸã‚ã®`JavaScript`ã‚’æ›¸ã“ã†ã¨æ€ã£ã¦ãŸã‚“ã§ã™ã‘ã©ã€ã“ã‚Œ`JS`ãªã—ã§å†ç¾ã§ãã‚‹ã‚“ã§ã™ã­ï¼ï¼\r\n\r\nä»¥ä¸‹ãŒè©²å½“ã®ã‚³ãƒ¼ãƒ‰ã§ã™ãŒã€ãƒã‚§ãƒƒã‚¯çŠ¶æ…‹ã‚’ä¿æŒã—ã¦ãŠããŸã‚ã®`<input>`ã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦‹ãˆãªã„å½¢ã§ç½®ã„ã¦ãŠãã¾ã™ã€‚  \r\n`<label>`ã§å›²ã£ã¦ã„ã‚‹ã®ã§ã€å›²ã£ã¦ã„ã‚‹`<div>`ã‚„`<span>`ã‚’æŠ¼ã—ãŸã¨ãã«ã‚‚ã€`<input>`ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã‚Šã¾ã™ï¼ˆä¸Šè¨˜ã®é€šã‚Šè¦‹ãˆã¾ã›ã‚“ãŒï¼‰  \r\n\r\nã§ã€ã“ã“ã‹ã‚‰ã§ã™ã€‚  \r\n`<input>`ã®å¾Œã®è¦ç´ ã®ã‚¯ãƒ©ã‚¹åã«`peer-checked:`ã‚’å…ˆé ­ã«ã¤ã‘ã‚‹ã¨ã€ãã®`<input>`ã«ãƒã‚§ãƒƒã‚¯ãŒä»˜ã„ãŸã‹ã©ã†ã‹ã§ã‚¹ã‚¿ã‚¤ãƒ«ã‚’åˆ‡ã‚Šæ›¿ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚  \r\nã“ã®æ–¹æ³•ã‚’ä½¿ã„ã€ãƒã‚§ãƒƒã‚¯ãŒã¤ã„ã¦ãªã„ã¨ãã¯å·¦ã¸`justify-start`ã€`<input>`ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ãŸã‚‰å³ã¸`peer-checked:justify-end`ã™ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚`CSS`ã ã‘ã§å®Œçµï¼ï¼ï¼\r\n\r\n```tsx\r\nexport default function DarkmodeSwitch() {\r\n    const [isDarkmode, setDarkmode] = useState(false)\r\n\r\n    return (\r\n        <label className=\"flex flex-row items-center select-none cursor-pointer p-2\">\r\n            {/* peer ã‚’ã¤ã‘ã¦ãŠãã¨ã€ãƒã‚§ãƒƒã‚¯ true / false æ™‚ã«ãã‚Œãã‚ŒæŒ‡å®šã™ã‚‹ CSS ã‚’ã‚»ãƒƒãƒˆã§ãã‚‹ï¼ˆ JS ã§å‹•çš„ã« className ã‚’å¤‰åŒ–ã•ã›ã‚‹å¿…è¦ãŒãªã„ ï¼‰ */}\r\n            <input\r\n                className=\"sr-only peer\"\r\n                type=\"checkbox\"\r\n                checked={isDarkmode}\r\n                onChange={(ev) => setDarkmode(ev.target.checked)} />\r\n            <span className=\"text-content-text-light dark:text-content-text-dark flex grow\">\r\n                ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰\r\n            </span>\r\n            {/* ãƒã‚§ãƒƒã‚¯ãŒä»˜ã„ãŸã‚‰å·¦ã«å¯„ã›ã‚‹ã€ä¸¸ã‚’å¤§ããã™ã‚‹ï¼ˆpeer-checked:justify-endï¼‰ */}\r\n            <div className=\"h-8 w-14 flex flex-row items-center rounded-full border-content-primary-light dark:border-content-primary-dark border-2 p-1.5 peer-checked:p-0.5 justify-start peer-checked:justify-end\">\r\n                <div className=\"h-full aspect-square bg-content-primary-light dark:bg-content-primary-dark rounded-full\" />\r\n            </div>\r\n        </label>\r\n    )\r\n}\r\n```\r\n\r\nã„ã‚„ã€å…¬å¼ã®èª¬æ˜ã®ãŒã‚ã‹ã‚Šã‚„ã™ã‹ã£ãŸã‚ã€`JS`ãªã—ã§è¡¨ç¤ºãƒ»éè¡¨ç¤ºã‚’åˆ‡ã‚Šæ›¿ãˆã¦ã‚‹  \r\nhttps://tailwindcss.com/docs/hover-focus-and-other-states#styling-based-on-sibling-state\r\n\r\n# ã¤ã¾ãšãç‚¹\r\n\r\n## å‹•çš„ãªå€¤ã¯ã§ããªã„\r\nã¤ã¾ã‚Šã€ã“ã†ã„ã†æ–‡å­—åˆ—ã«å¤‰æ•°ã‚’åŸ‹ã‚è¾¼ã‚€ã¨ã‹ã¯å‡ºæ¥ãªã„ã§ã™ã€‚\r\n\r\n```tsx\r\nconst isEnable = true\r\nconst width = isEnable ? 100 : 50\r\nconst className = `w-${width}`\r\n\r\nreturn (<div className={className}/>)\r\n```\r\n\r\nã‚‚ã—ã€çŠ¶æ…‹ã«ã‚ˆã£ã¦åˆ‡ã‚Šæ›¿ãˆãŸã„å ´åˆã¯ã€å®Œå…¨ãªã‚¯ãƒ©ã‚¹åã¨ã—ã¦ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«è¨˜è¿°ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n```tsx\r\nconst isEnable = true\r\nconst className = isEnable ? \"w-100\" : \"w-50\"\r\n\r\nreturn (<div className={className}/>)\r\n```\r\n\r\nã¨ã„ã†ã®ã‚‚ã€`Tailwind CSS`ã¯æ–‡å­—åˆ—ã‚’æ¢ã—ã¦`CSS`ã‚’ç”Ÿæˆã™ã‚‹ã€çµæ§‹ã‚·ãƒ³ãƒ—ãƒ«ãªä»•çµ„ã¿ã§å‹•ã„ã¦ã„ã‚‹ã‚‰ã—ã„ï¼Ÿã®ã§ã€æ–‡å­—åˆ—ã¨ã—ã¦å­˜åœ¨ã—ãªã„ã¨ã„ã‘ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚\r\nhttps://tailwindcss.com/docs/content-configuration#class-detection-in-depth\r\n\r\nå‹•çš„ãªå€¤ã¯å–ã‚Œãªã„ã®ã§ã€ã‚ã‚‰ã‹ã˜ã‚ã„ãã¤ã‹ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ç”¨æ„ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã‚ã‘ã§ã™ã­ã€‚\r\n\r\n```tsx\r\nlet roundedClassName: string\r\nswitch (rounded ?? 'small') {\r\n    case 'small':\r\n        roundedClassName = 'rounded-md'\r\n        break\r\n    case 'medium':\r\n        roundedClassName = 'rounded-xl'\r\n        break\r\n    case 'large':\r\n        roundedClassName = 'rounded-3xl'\r\n        break\r\n}\r\n```\r\nï¼ˆ`Kotlin`ã®`when`ã¨ã„ã†ã‹å¼ã»ã—ã„...ã“ã®ãŸã‚ã ã‘ã«`let`ã«ã™ã‚‹ã®ãªã‚“ã‹è² ã‘ãŸæ„Ÿã‚ã£ã¦ãã‚„ã—ã„ï¼‰\r\n\r\n## Material-UIã¿ãŸã„ã« Ripple Effect ã¿ãŸã„ãªã®ã¯ãªããªã£ã¡ã‚ƒã£ãŸ\r\næŠ¼ã—ã¦ã‚‹ï¼ï¼ï¼æ„Ÿã¯ãªããªã£ã¡ã‚ƒã£ãŸ\r\n\r\n## ã‚¢ã‚¤ã‚³ãƒ³\r\nãƒãƒ†ãƒªã‚¢ãƒ«ã‚¢ã‚¤ã‚³ãƒ³ã¯è‡ªåˆ†ã§`svg`ã‚’æŒã£ã¦ãã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€ã‚‚ã—ãã¯`npm`ã‹ã‚‰ã‚ˆã—ãªã«ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹ã‹ã§ã™ã€‚\r\n\r\n# ãã®ã»ã‹\r\n\r\n## Mastodon / Misskey ã‚·ã‚§ã‚¢ãƒœã‚¿ãƒ³ ã‚’ç½®ã„ãŸ\r\n\r\n`Twitter`ã®ä»£ã‚ã‚Šã«`Mastodon / Misskey`ã§ã‚·ã‚§ã‚¢ã§ãã‚‹ãƒœã‚¿ãƒ³ã‚’ç½®ãã¾ã—ãŸã€‚  \r\n`TweetDeck`ãªããªã£ã¦ã‹ã‚‰`Twitter`ã‚ã‚“ã¾ã‚Šè¦‹ãªããªã£ã¡ã‚ƒã£ãŸã€ã€ã€  \r\n\r\n![Imgur](https://imgur.com/UAZIBg8.png)\r\n\r\n![Imgur](https://imgur.com/XSabwQI.png)\r\n\r\n![Imgur](https://imgur.com/uKDj4hr.png)\r\n\r\n`Misskey`ã‚‚`Mastodon`ã‚‚ä»¥ä¸‹ã®ã‚ˆã†ãª`URL`ã§ãã‚Œãã‚Œã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã®å…±æœ‰ç”»é¢ã‚’å‡ºã›ã‚‹ã®ã§ã€ãã‚Œã‚’ä½¿ã£ã¦ã„ã¾ã™ã€‚  \r\n\r\n`https://{serverName}/share?text={ã‚·ã‚§ã‚¢ã—ãŸã„æ–‡å­—}`\r\n\r\n`TypeScript / JavaScript`ã§ã‚„ã‚‹å ´åˆã¯ã“ã‚“ãªæ„Ÿã˜ã§ã™å¤šåˆ†\r\n\r\n```ts\r\n// ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å\r\nconst serverName = 'diary.negitoro.dev'\r\n// ã‚·ã‚§ã‚¢ã—ãŸã„æ–‡å­—\r\nconst shareText = encodeURIComponent('ã‚·ã‚§ã‚¢ã—ãŸã„æ–‡å­—')\r\n// æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã\r\nconst shareUrl = `https://${serverName}/share?text=${shareText}`\r\nwindow.open(shareUrl, '__blank')\r\n```\r\n\r\n`Nuxt.js`ã®ã¨ãã¯ç½®ã„ã¦ãŸã‚“ã§ã™ãŒã€ã€ã€ã€`Next.js`ã«ç§»è¡Œã—ãŸéš›ã«`Twitter`ã«ç½®ãæ›ãˆã¡ã‚ƒã£ãŸã‚“ã§ã™ã‚ˆã­ã€‚  \r\n`Twitter`æ”¹æ‚ªã«ã‚ˆã‚Š`Mastodon / Misskey ã‚·ã‚§ã‚¢`å†å®Ÿè£…ã§ã™\r\n\r\n![Imgur](https://imgur.com/YXwrVJt.png)\r\n\r\n![Imgur](https://imgur.com/cAh2Ntz.png)\r\n\r\nï¼ˆå¥‡è·¡çš„ã«`Nuxt.js`ã®ã¨ãã®ãƒ“ãƒ«ãƒ‰æˆæœç‰©ãŒæ®‹ã£ã¦ãŸã®ã§èµ·å‹•ã—ã¦ã¿ãŸï¼‰\r\n\r\n# æœ¬ç•ªã«æŠ•å…¥ã™ã‚‹\r\n\r\nããŸããŸ\r\n\r\n![Imgur](https://imgur.com/A5v58C4.png)\r\n\r\nä»Šå›ã‚‚å·®åˆ†å¤§ãã„ã¨ã„ã†ã‹å½±éŸ¿å¤§ãã„ã®ã§`Pull Request`ä½œã£ã¦ã¿ã¾ã—ãŸã€‚  \r\n\r\nhttps://github.com/takusan23/ziyuutyou-next/pull/2\r\n\r\nå·®åˆ†ã§ã™ãŒã€`npm install`ã—ãŸæ™‚ã¨ã‹ã«è‡ªå‹•ã§æ›´æ–°ã•ã‚Œã‚‹`package-lock.json`ã¨ã‹ã‚‚å·®åˆ†ã«å…¥ã£ã¦ã—ã¾ã£ãŸã®ã§ã€ç§ãŒæ›¸ãè¶³ã—ãŸã®ã¯ãã“ã¾ã§ã§ã¯ãªã„ã¨æ€ã†ãƒ»ãƒ»ãƒ»\r\n\r\n![Imgur](https://imgur.com/Gx7fnFn.png)\r\n\r\nã¾ãƒ¼ã˜ã—ã¾ã™ï¼ã†ãŠãŠãŠãŠï¼\r\n\r\n![Imgur](https://imgur.com/dvWOWHn.png)\r\n\r\n`GitHub Actions`ãŒçµ‚ã‚ã‚‹ã®ã‚’è¦‹å®ˆã‚Šã¾ã™\r\n\r\n![Imgur](https://imgur.com/G8nI44X.png)\r\n\r\n\r\n## Material-UI â†’ Tailwind CSS\r\nã¾ã€ã¾ãã€ã€ã‚ã‚“ã¾ã‚Š`Material-UI`ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä½¿ã£ã¦ãŸã‚ã‘ã˜ã‚ƒãªã„ã®ã§ã€ã‚‚ã£ã¨ã„ã‚ã‚“ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’ä½¿ã£ã¦ã‚Œã°ã‚‚ã£ã¨å¢—ãˆã¦ãŸã®ã‹ã‚‚\r\n\r\n### Material-UI\r\n```plaintext\r\nRoute (app)                                   Size     First Load JS\r\nâ”Œ â—‹ /                                         4.96 kB         124 kB\r\nâ”œ â—‹ /_not-found                               0 B                0 B\r\nâ”œ â—‹ /favicon.ico                              0 B                0 B\r\nâ”œ â—‹ /icon.png                                 0 B                0 B\r\nâ”œ â— /pages/[page]                             1.36 kB         112 kB\r\nâ”œ   â”” /pages/about\r\nâ”œ â— /posts/[blog]                             5 kB            124 kB\r\nâ”œ   â”œ /posts/akashic_engine_pwa_cache\r\nâ”œ   â”œ /posts/android11_devicecontrol\r\nâ”œ   â”œ /posts/android11_release_devicecontrol\r\nâ”œ   â”” [+135 more paths]\r\nâ”œ â— /posts/page/[page]                        4.28 kB         120 kB\r\nâ”œ   â”œ /posts/page/1\r\nâ”œ   â”œ /posts/page/2\r\nâ”œ   â”œ /posts/page/3\r\nâ”œ   â”” [+11 more paths]\r\nâ”œ â— /posts/tag/[tag]                          2.46 kB         119 kB\r\nâ”œ   â”œ /posts/tag/Android\r\nâ”œ   â”œ /posts/tag/Kotlin\r\nâ”œ   â”œ /posts/tag/JetpackCompose\r\nâ”œ   â”” [+96 more paths]\r\nâ”œ â—‹ /posts/tag/all_tags                       616 B           117 kB\r\nâ”” â—‹ /sitemap.xml                              0 B                0 B\r\n+ First Load JS shared by all                 96.2 kB\r\n  â”œ chunks/681-35cd67eb9c939efc.js            18.5 kB\r\n  â”œ chunks/698-43273f17e9c681c8.js            25.2 kB\r\n  â”œ chunks/bce60fc1-0593c640cdea54db.js       50.5 kB\r\n  â”œ chunks/main-app-67d9599d5de0ee24.js       213 B\r\n  â”” chunks/webpack-47c91c3dea7cfcb6.js        1.73 kB\r\n```\r\n\r\n### Tailwind CSS\r\n```plaintext\r\nRoute (app)                                   Size     First Load JS\r\nâ”Œ â—‹ /                                         3.57 kB        87.2 kB\r\nâ”œ â—‹ /_not-found                               0 B                0 B\r\nâ”œ â—‹ /favicon.ico                              0 B                0 B\r\nâ”œ â—‹ /icon.png                                 0 B                0 B\r\nâ”œ â— /pages/[page]                             3.44 kB          87 kB\r\nâ”œ   â”” /pages/about\r\nâ”œ â— /posts/[blog]                             3.44 kB          87 kB\r\nâ”œ   â”œ /posts/akashic_engine_pwa_cache\r\nâ”œ   â”œ /posts/android11_devicecontrol\r\nâ”œ   â”œ /posts/android11_release_devicecontrol\r\nâ”œ   â”” [+135 more paths]\r\nâ”œ â— /posts/page/[page]                        764 B          84.4 kB\r\nâ”œ   â”œ /posts/page/1\r\nâ”œ   â”œ /posts/page/2\r\nâ”œ   â”œ /posts/page/3\r\nâ”œ   â”” [+11 more paths]\r\nâ”œ â— /posts/tag/[tag]                          764 B          84.4 kB\r\nâ”œ   â”œ /posts/tag/Android\r\nâ”œ   â”œ /posts/tag/Kotlin\r\nâ”œ   â”œ /posts/tag/JetpackCompose\r\nâ”œ   â”” [+96 more paths]\r\nâ”œ â—‹ /posts/tag/all_tags                       624 B          84.2 kB\r\nâ”œ â—‹ /search                                   3.26 kB        86.9 kB\r\nâ”” â—‹ /sitemap.xml                              0 B                0 B\r\n+ First Load JS shared by all                 77.8 kB\r\n  â”œ chunks/698-0d5add4b5e93c16b.js            25.2 kB\r\n  â”œ chunks/bce60fc1-33201d061f5d18d8.js       50.5 kB\r\n  â”œ chunks/main-app-67d9599d5de0ee24.js       213 B\r\n  â”” chunks/webpack-6989dea18b00da7b.js        1.8 kB\r\n```\r\n\r\n# ãŠã‚ã‚Šã«\r\n`Netlify`ã ã¨æ—¥æœ¬ã‹ã‚‰ã®ã‚¢ã‚¯ã‚»ã‚¹ãŒé…ã„ã®ã§ã€ã¤ãã¯ãƒ›ã‚¹ãƒ†ã‚£ãƒ³ã‚°ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç§»è¡Œã—ãŸã„ãƒ»ãƒ»ï¼  "},{"title":"WebMã‚’æ”»ç•¥ã™ã‚‹","link":"/posts/video_webm_spec/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\næœ€è¿‘ãšã£ã¨ ãƒ•ãƒ«ã‚¹ãƒ­ãƒƒãƒˆãƒ«Heart ã£ã¦ã„ã†æ›²èã„ã¦ã‚‹ã€ã€æ›ã‘åˆã„ã‚ã£ã¡ã‚ƒã‚ˆã„\r\n\r\n# æœ¬é¡Œ\r\nã‚³ãƒ³ãƒ†ãƒŠãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ä¸€ã¤ã€`WebM`ã‚’è§£æã—ãŸã‚Šã€çµ„ã¿ç«‹ã¦ãŸã‚Šã™ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ã‚‡ã†ã€‚ï¼ˆï¼Ÿï¼‰  \r\nã“ã‚Œ https://github.com/takusan23/ZeroMirror ã®ä¸­ã® WebMã¸æ›¸ãè¾¼ã‚€å‡¦ç† https://github.com/takusan23/ZeroMirror/tree/master/zerowebm ã‚’ä½œã£ã¦ã‚‹éš›ã«èª¿æŸ»ã—ãŸã‚„ã¤\r\n\r\n## ç’°å¢ƒ\r\n`Kotlin`ã§æ›¸ãã¾ã™ã€‚  \r\nã‚ã¨ 2/10/16é€²æ•° ã®å¤‰æ›ãŒã§ãã‚‹é›»å“ãŒå¿…è¦ã§ã™ï¼ˆWindows 10 ã®æœ€åˆã‹ã‚‰å…¥ã£ã¦ã‚‹é›»å“ã®ãƒ—ãƒ­ã‚°ãƒ©ãƒãƒ¼ãƒ¢ãƒ¼ãƒ‰ã§OKã§ã™ï¼‰\r\n\r\n# ã–ã£ãã‚Š WebM\r\n`WebM`ã£ã¦ã®ã¯éŸ³å£°ã¨æ˜ åƒã‚’ä¸€ã¤ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ä¿å­˜ã™ã‚‹æŠ€è¡“ã®åå‰ã§ã€`mp4`ã€`mpeg2-ts`ã¨ã‹ã®ä»²é–“ã§ã™ï¼ˆ`H.264`/`H.265`/`VP8`/`VP9`ç­‰ã®ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®ä»²é–“ã§ã¯ãªã„ã§ã™ã€‚ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹æŠ€è¡“ã§ã™ï¼‰  \r\nï¼ˆ`Android`ã§ã¯`MediaMuxer`ã‚’ä½¿ãˆã°ã‚‰ãã‚‰ãä¿å­˜ã§ãã‚‹ã®ã§ã™ãŒã€ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã§ãã‚‹`WebM`ã‚’ä½œã‚ŠãŸã‹ã£ãŸã®ã§ï¼‰\r\n\r\nå‹•ç”»ãƒ•ã‚¡ã‚¤ãƒ«ã®æ‹¡å¼µå­ãŒ`mp4`ä»¥å¤–ã ã£ãŸã¨ããƒ©ãƒ³ã‚­ãƒ³ã‚°ã§ã€ä¸‰ç•ªç›®ãã‚‰ã„ã«å±…åº§ã£ã¦ãã†ã€‚ï¼ˆavi,mov ã®æ¬¡ãã‚‰ã„ï¼Ÿã€iPhoneãŒ mov ã‚‰ã—ã„ã®ã‚ˆã­ï¼‰\r\n\r\n`WebM`ã¯`Matroska`ã®ã‚µãƒ–ã‚»ãƒƒãƒˆã«ãªã£ã¦ã¾ã™ã€‚ã®ã§ä»•æ§˜æ›¸ãªã‚“ã‹ã¯`Matroska`ã®ã‚’è¦‹ã‚‹ã®ãŒè‰¯ã„ã¨æ€ã†ã€‚  \r\nã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã¯`VP8`/`VP9`/`Opus`ãªã©ãŒå¯¾å¿œã—ã¦ã„ã¾ã™ã€‚ä¿å­˜æ–¹æ³•ã«ã¯`EBML`ã‚’ä½¿ã£ã¦ã¾ã™ï¼ˆ`Matroska`ãŒãã†ï¼‰ã€‚\r\n\r\n## WebM ã‚’è¦‹ã‚‹ã‚¢ãƒ—ãƒª\r\nMKVToolNix ã£ã¦ã®ãŒã‚ã‚Šã¾ã™ã€‚ã“ã‚ŒãŒç¥ãƒ¬ãƒ™ãƒ«ã§ä½¿ã„ã‚„ã™ã„ã€‚\r\nDLã—ãŸã‚‰ mkvtoolnix-gui.exe ã‚’èµ·å‹•ã—ã¦ã€`infoãƒ„ãƒ¼ãƒ«`ã«ã—ã¦`webm`ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã™ã‚Œã°è¦‹ã‚Œã¾ã™ã€‚\r\n\r\nhttps://mkvtoolnix.download/\r\n\r\n![Imgur](https://imgur.com/mJvsTSm.png)\r\n\r\n## ã–ã£ãã‚Š EBML\r\nã‚ˆã `xml` ã¨è¨€ã‚ã‚Œã¦ã¾ã™ãŒã€`xml`ã«ã¯ã‚ã‚‹çµ‚äº†ã‚¿ã‚°ã‚„å±æ€§ãªã©ã¯ãªã„ã®ã§ã©ã£ã¡ã‹ã¨ã„ã†ã¨ `yml (yaml)` ãŒè¿‘ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nçµ‚äº†ã‚¿ã‚°ãŒç„¡ã„ã®ã§ã€ã‚¿ã‚°ã®å¾Œã«ã¤ã„ã¦ã‚‹é•·ã•ã‚’è¦‹ã¦å­è¦ç´ ã€ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã—ã¦ã„ãã¾ã™ã€‚  \r\n\r\nã“ã‚“ãªæ„Ÿã˜ã§å…¥ã£ã¦ã‚‹ï¼ˆã‹ãªã‚Šç«¯æŠ˜ã£ãŸ\r\n\r\n```yml\r\n- EBML\r\n    - EBML version\r\n        - Data size 1\r\n        - Data 1\r\n    - EBML read version\r\n        - Data size 1\r\n        - Data 1\r\n    - Maximum EBML ID Length\r\n        - Data size 1\r\n        - Data 4\r\n- Segment\r\n    - Info\r\n        - Timestamp scale\r\n            - Data size 4\r\n            - Data 1000000\r\n        - Writing app\r\n            - Data size 10\r\n            - Data zeromirror\r\n    - Tracks\r\n        - Track\r\n            - Track number\r\n                - Data size 1\r\n                - Data 1\r\n            - Track type\r\n                - Data size 1\r\n                - Data 1\r\n            - Codec id\r\n                - Data size 5\r\n                - Data V_VP9\r\n```\r\n\r\n## ãƒã‚¤ãƒŠãƒªã‚’è¦‹ã‚‹\r\nå®Ÿéš›ã®ãƒã‚¤ãƒŠãƒªã‚’è¦‹ãªãŒã‚‰ã€ã‚‚ã†å°‘ã—è§£èª¬ã‚’  \r\nã¡ãªã¿ã«ä»¥ä¸‹ã®ãƒã‚¤ãƒŠãƒªã¯æœ€é©åŒ–ã—ã¦ãªã„ï¼ˆé›£ã—ãã†ã ã£ãŸã®ã§ã€å¾Œè¿°ï¼‰ã®ã§æœ¬æ¥ã§ã‚ã‚Œã°ã‚‚ã£ã¨çŸ­ããªã‚Šã¾ã™ã€‚\r\n\r\n```\r\n 1A 45 DF A3 10 00 00 34 42 86 10 00 00 01 01 42\r\n F7 10 00 00 01 01 42 F2 10 00 00 01 04 42 F3 10\r\n 00 00 01 08 42 82 10 00 00 04 77 65 62 6D 42 87\r\n 10 00 00 01 02 42 85 10 00 00 01 02 18 53 80 67\r\n 01 FF FF FF FF FF FF FF 15 49 A9 66 10 00 00 34\r\n 2A D7 B1 10 00 00 04 00 0F 42 40 4D 80 10 00 00\r\n 13 7A 65 72 6F 6D 69 72 72 6F 72 5F 7A 65 72 6F\r\n 77 65 62 6D 57 41 10 00 00 0A 7A 65 72 6F 6D 69\r\n 72 72 6F 72 16 54 AE 6B 10 00 00 87 AE 10 00 00\r\n 32 D7 10 00 00 01 01 73 C5 10 00 00 01 01 86 10\r\n 00 00 05 56 5F 56 50 39 83 10 00 00 01 01 E0 10\r\n 00 00 10 B0 10 00 00 03 00 05 00 BA 10 00 00 03\r\n 00 02 D0 AE 10 00 00 4B D7 10 00 00 01 02 73 C5\r\n 10 00 00 01 02 86 10 00 00 06 41 5F 4F 50 55 53\r\n 83 10 00 00 01 02 63 A2 10 00 00 13 4F 70 75 73\r\n 48 65 61 64 01 02 00 00 80 BB 00 00 00 00 00 E1\r\n 10 00 00 0F B5 10 00 00 04 47 3B 80 00 9F 10 00\r\n 00 01 02 1F 43 B6 75 01 FF FF FF FF FF FF FF E7\r\n 10 00 00 04 00 00 00 00\r\n```\r\n\r\n### ãƒã‚¤ãƒŠãƒªã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ\r\n\r\nã“ã‚“ãªã®ãŒãšã£ã£ã£ã¨ç¶šã„ã¦ã¾ã™ã€‚\r\n\r\n|                                     |                                     |                                      |\r\n|-------------------------------------|-------------------------------------|--------------------------------------|\r\n| ID                                  | Data size                           | Data                                 |\r\n| ãªã‚“ã®ãƒ‡ãƒ¼ã‚¿ã‹ã‚’ç¤ºã—ã¾ã™            | Data ã®ã‚µã‚¤ã‚ºã§ã™                   | ãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚æ•°å€¤/ASCII/ãƒã‚¤ãƒŠãƒª ãªã© |\r\n| ã‚µã‚¤ã‚ºã¯å¯å¤‰é•· (å¾Œè¿°)ã€Max 4ãƒã‚¤ãƒˆ? | ã‚µã‚¤ã‚ºã¯å¯å¤‰é•·  (å¾Œè¿°)ã€Max 8ãƒã‚¤ãƒˆ | Data size ã®å€¤                       |\r\n\r\nãŸã¨ãˆã°...\r\n\r\n```\r\n57 41 10 00 00 0a 7a 65 72 6f 6d 69 72 72 6f 72\r\n```\r\n\r\nã®å ´åˆã¯\r\n\r\n| ãƒã‚¤ãƒŠãƒª | 0x57 0x41   | 0x10 0x00 0x00 0x0A | 0x7A 0x65 0x72 0x6F 0x6D 0x69 0x72 0x72 0x6F 0x72 |\r\n|----------|-------------|---------------------|---------------------------------------------------|\r\n| ãªã«ï¼Ÿ   | ID          | Data size           | Data                                              |\r\n| ã‚ãŸã„   | Writing App | 10                  | zeromirror                                        |\r\n\r\nã«ãªã‚Šã¾ã™ï¼ï¼ˆãªã‚“ã§ã“ã†ãªã‚‹ã®ã‹ã‚’ã“ã‚Œã‹ã‚‰æ›¸ãã¾ã™ï¼‰\r\n\r\n### ãƒã‚¤ãƒŠãƒªã®èª­ã¿æ–¹ IDç·¨\r\nIDã®ä¸€è¦§ã¯ã“ã‚Œã§ã™ï¼šhttps://www.matroska.org/technical/elements.html\r\n\r\nã¾ãšã¯ ID ã‹ã‚‰ã€‚`ID`ã¯ãã®åã®é€šã‚Šãƒ‡ãƒ¼ã‚¿ãŒä½•ãªã®ã‹ã‚’ç¤ºã™ã‚‚ã®ã§ã™ã€‚  \r\nã§ã€IDãªã®ã§ã™ãŒã€**ã“ã‚Œè³¢ãã¦**ã€2é€²æ•°ã«ã—ãŸå¾Œã«å·¦ã‹ã‚‰ä½•ãƒ“ãƒƒãƒˆç›®ã«1ãŒç«‹ã£ã¦ã„ã‚‹ã‹ã§IDã®é•·ã•ãŒåˆ†ã‹ã£ã¡ã‚ƒã†ç”¨ã«ãªã£ã¦ã¾ã™ï¼ã€‚  \r\nä¾‹ãˆã°ä¸Šè¨˜ã® `Writing App` ã® `0x57 0x41` ã‚’2é€²æ•°ã«ã—ãŸå ´åˆ\r\n\r\n| 16é€²æ•°    | 2é€²æ•°               |\r\n|-----------|---------------------|\r\n| 0x57 0x41 | 0101 0111 0100 0001 |\r\n\r\nã“ã†ãªã‚Šã¾ã™ï¼ˆ`5`ã‚’2é€²ã«ã™ã‚‹ã¨`101`ã§ã™ãŒã€4æ¡ã«åˆã‚ã›ã‚‹ãŸã‚å…ˆé ­ã«`0`ã‚’å…¥ã‚Œã¦ã¾ã™ï¼‰\r\n\r\nã§ã€`1`ãŒå·¦ã‹ã‚‰2ãƒ“ãƒƒãƒˆç›®ã«ç«‹ã£ã¦ã¾ã™ã‚ˆã­ï¼Ÿã™ã‚‹ã¨ä¸Šè¨˜ã®IDã¯ **2ãƒã‚¤ãƒˆåˆ†** ã«ãªã‚Šã¾ã™ï¼ï¼ï¼  \r\n2ãƒã‚¤ãƒˆå–ã‚Šå‡ºã—ãŸ`0x57 0x41`ã‚’IDä¸€è¦§ã¨è¦‹æ¯”ã¹ã‚‹ã¨`Writing App`ã§ã‚ã‚‹ã¨ã‚ã‹ã‚Šã¾ã™ã­ï¼\r\n\r\nã“ã‚Œã‚’ **VINT** ã¨ã„ã†ã‚‰ã—ã„ã§ã™ã‚ˆï¼Ÿï¼ˆãƒ‡ãƒ¼ã‚¿ã®ã‚µã‚¤ã‚ºã‚’å«ã‚ã¤ã¤ã€ã¡ã‚ƒã‚“ã¨ç›®å°ã¨ã—ã¦ã‚‚ä½¿ãˆã‚‹ï¼‰\r\n\r\nä»–ã«ä¾‹ã‚’ã‚‚ã†ä¸€å€‹ã€ `Cluster` ã®IDã‚’è¦‹ã¦ã¿ã‚‹ã¨\r\n\r\n| 16é€²æ•°              | 2é€²æ•°                                   |\r\n|---------------------|-----------------------------------------|\r\n| 0x1F 0x43 0xB6 0x75 | 0001 1111 0100 0011 1011 0110 0111 0101 |\r\n\r\nã“ã†ãªã‚Šã¾ã™ã­ï¼Ÿï¼ˆå¤‰æ›å¾Œã¯`1 1111 0100 0011 1011 0110 0111 0101`ã«ãªã‚Šã¾ã™ãŒã€4æ¡æƒãˆã«ã™ã‚‹ãŸã‚ `0001 1111 0100 0011 1011 0110 0111 0101`ã«ã—ã¦ã¾ã™ï¼‰\r\n\r\n![Imgur](https://imgur.com/1Snu6co.png)\r\n\r\nã§ã€`1`ãŒå·¦ã‹ã‚‰4ç•ªç›®ã«ç«‹ã£ã¦ã¾ã™ã®ã§ã€IDã¯**4ãƒã‚¤ãƒˆåˆ†**ã¨åˆ¤æ–­ã§ãã‚‹ã‚ã‘ã§ã™ã€‚  \r\n4ãƒã‚¤ãƒˆå–ã‚Šå‡ºã—ãŸ `0x1F 0x43 0xB6 0x75` ã‚’IDä¸€è¦§ã‹ã‚‰æ¢ã™ã¨ `Cluster` ã§ã‚ã‚‹ã¨ã‚ã‹ã‚Šã¾ã™ã­ã€‚\r\n\r\nå¤šåˆ†æœ€å¤§ 4ãƒã‚¤ãƒˆ ã¾ã§ã ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\nã‚ã€VINTã®ã‚ã‹ã‚Šã‚„ã™ã„è¡¨ãŒã‚ã£ãŸã®ã§è²¼ã£ã¦ãŠãã¾ã™ã­\r\n\r\nhttps://github.com/ietf-wg-cellar/ebml-specification/blob/master/specification.markdown#vint-examples\r\n\r\n### ãƒã‚¤ãƒŠãƒªã®èª­ã¿æ–¹ Data size ç·¨\r\nå®Ÿéš›ã«`Data size`ã§åˆã£ã¦ã‚‹ã®ã‹ã¯ã‚ã‹ã‚‰ãªã„...ï¼ˆ`Content size`èª¬ï¼Ÿ  \r\nã“ã‚Œã¯ Data ãŒä½•ãƒã‚¤ãƒˆåˆ†ã‹ã‚’ç¤ºã™ã‚‚ã®ã§ã™ã€‚ã§ã€ã“ã„ã¤è‡ªä¿¡ã‚‚å¯å¤‰é•·ã§ã™ã€‚\r\n\r\nä¾‹ãˆè¡Œãã¾ã—ã‚‡ã†ã€‚ä¸Šè¨˜ã®`Writing App`ã§\r\n\r\n| 16é€²æ•°              | 2é€²æ•°                                   |\r\n|---------------------|-----------------------------------------|\r\n| 0x10 0x00 0x00 0x0A | 0001 0000 0000 0000 0000 0000 0000 1010 |\r\n\r\nã“ã“ã§ã‚„ã‚‰ãªã„ã¨ã„ã‘ãªã„ã®ã¯ã€`Data size è‡ªèº«ã®é•·ã•`ã¨`Data ã®é•·ã•`ã‚’å‡ºã™ã“ã¨ã§ã™ã€‚  \r\n`Data size`è‡ªèº«ã®é•·ã•ã¯ ID ã®ã¨ãã¨åŒã˜ã‚ˆã†ã«ã€å·¦ã‹ã‚‰1ãŒä½•ãƒ“ãƒƒãƒˆç›®ã«ç«‹ã£ã¦ã„ã‚‹ã‹ã§åˆ¤æ–­ã§ãã¾ã™ã€‚  \r\nãŸã ã€IDã¨é•ã£ã¦`Data size`ã¯æœ€å¤§8ãƒã‚¤ãƒˆã¾ã§ã‚ã‚Šã¾ã™ã€‚  \r\nä»Šå›ã¯`1`ãŒå·¦ã‹ã‚‰4ãƒã‚¤ãƒˆç›®ã«ç«‹ã£ã¦ã„ã‚‹ãŸã‚ã€`Data size`è‡ªèº«ã¯4ãƒã‚¤ãƒˆã‚ã‚‹ã“ã¨ãŒã‚ã‹ã‚Šã¾ã™ã€‚  \r\n\r\nã§ã€2é€²æ•°ã«ã—ãŸå¾Œã«å·¦ã‹ã‚‰`1`ã‚’æŠœã„ãŸã‚ã¨10é€²æ•°ã«ã—ãŸå€¤ãŒã€`Data`ã®é•·ã•ã«ãªã‚Šã¾ã™ã€‚  \r\n`0001 0000 0000 0000 0000 0000 0000 1010` -> `0000 0000 0000 0000 0000 0000 0000 1010` -> 2é€²æ•°ã‚’10é€²æ•°ã«ã—ãŸ`10`\r\n\r\n`Data`ã¯10ãƒã‚¤ãƒˆã§ã™ï¼\r\n\r\nã“ã‚Œã‚‚ã‚ã‹ã‚Šã‚„ã™ã„è¡¨ãŒã‚ã£ãŸã®ã§è²¼ã£ã¦ãŠãã¾ã™ã­\r\n\r\nhttps://www.matroska.org/technical/notes.html#ebml-lacing\r\n\r\n### ãƒã‚¤ãƒŠãƒªã®èª­ã¿æ–¹ Data ç·¨\r\n`Data size`ã§å‡ºã—ãŸé•·ã•ã ã‘ã‚ã‚Šã¾ã™ã€‚  \r\nãã®ãƒ‡ãƒ¼ã‚¿ãŒ æ•°å€¤ / ASCII / ãƒã‚¤ãƒŠãƒª / å…¥ã‚Œå­ ãªã©ä½•ã®ãƒ‡ãƒ¼ã‚¿ã‹ã¯IDã®ä¸€è¦§ã‹ã‚‰è¦‹ã¦ä¸‹ã•ã„ã€‚å¤šåˆ†IDã ã‘ã ã¨ã‚ã‹ã‚‰ãªã„ã¯ãšã€‚ã€‚ã€‚\r\n\r\nElement type ã§ã‚ã‹ã‚‹ã¯ãš\r\n\r\n![Imgur](https://imgur.com/GrMHZLY.png)\r\n\r\n#### ç•ªå¤–ç·¨ ãªã‚“ã§è³¢ã„ã®ã‹\r\nãªã‚“ã§è³¢ã„ã®ã‹ã¨ã„ã†ã¨ã€IDãŒçŸ¥ã‚‰ãªã„/å¯¾å¿œã—ã¦ã„ãªã„å ´åˆã«ã‚¹ã‚­ãƒƒãƒ—ã—ã¦æ¬¡ã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿å–ã‚Œã‚‹ã‹ã‚‰ãªã‚“ã§ã™ã­ã€‚  \r\nã ã£ã¦IDã®é•·ã•çŸ¥ã‚‰ãªã„ã‘ã©ã€IDã®é•·ã•ã¯ 2é€²æ•°ã«ã—ã¦1ãŒä½•ãƒ“ãƒƒãƒˆç›®ã«ç«‹ã£ã¦ã‚‹ã‹ ã‚’è¨ˆç®—ã—ã¦ã„ã‘ã° IDåˆ†ã‹ã‚‰ã‚“æœªçŸ¥ã®ãƒ‡ãƒ¼ã‚¿ ã¨ã—ã¦è§£æã§ãã‚‹ã‚ã‘ã§ã™ã€‚  \r\n\r\nã‚‚ã— IDã«é•·ã•ãŒå«ã¾ã‚Œãªã‹ã£ãŸ å ´åˆã€ãƒ‘ãƒ¼ã‚¹å‰ã«äºˆã‚IDã¨é•·ã•ã®å¯¾å¿œè¡¨ã¿ãŸã„ãªã®ã‚’æŒã£ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ä¸Šã€æœªçŸ¥ã®IDãŒæ¥ãŸå ´åˆã«è§£æãŒã§ããªããªã‚Šã¾ã™ã€‚  \r\n\r\n# WebMã§å¿…è¦ãªå€¤\r\nWebMã«è©±ã‚’æˆ»ã—ã¾ã™ã€‚  \r\nå¤šåˆ†ä»¥ä¸‹ã®å€¤ãŒå¿…è¦ã§ã™ã€‚\r\n\r\nã‚“ãªã‚‚ã‚“åˆ†ã‹ã‚‰ã‚“ã‚ã£ã¦æ–¹ã¯ã“ã£ã¡ã®ã»ã†ãŒæ­£ã—ã„ã§ã™ï¼šhttps://www.matroska.org/technical/diagram.html\r\n\r\n```yml\r\n- EBML\r\n    - EBMLVersion\r\n    - EBMLReadVersion\r\n    - EBMLMaxIDLength\r\n    - EBMLMaxSizeLength\r\n    - DocType\r\n    - DocTypeVersion\r\n    - DocTypeReadVersion\r\n- Segment\r\n    - Info\r\n        - Timestamp scale\r\n        - Duration\r\n        - Multiplexing application\r\n        - Writing application\r\n    - Tracks\r\n        - Track\r\n            - Track number\r\n            - Track Uid\r\n            - Codec id\r\n            - Track type\r\n            - Video\r\n                - Pixel width\r\n                - Pixel height\r\n        - Track\r\n            - Track number\r\n            - Track Uid\r\n            - Codec id\r\n            - Codec private data\r\n            - Audio\r\n                - Sampling frequency\r\n                - Channels\r\n    - Cues\r\n        - CuePoint\r\n            - Cue time\r\n            - Cue track position\r\n                - Cue track\r\n                - Cue cluster position\r\n- Cluster\r\n    - Cluster timestamp\r\n    - SimpleBlock\r\n    - SimpleBlock\r\n    - ...\r\n```\r\n\r\nã“ã‚Œã‚‰ã¯ã•ã£ãè©±ã—ãŸã€EBMLã®ä»•çµ„ã¿ã«æ²¿ã£ã¦ãƒã‚¤ãƒŠãƒªã‚’å…¥ã‚Œã¦ã„ã‘ã°ã„ã„ã®ã§ã™ãŒã€ã€ã€  \r\nEBMLã ã‘çŸ¥ã£ã¦ã„ã‚Œã°ã§ãã‚‹ã‚ã‘ã§ã¯ãªãã€ä»¥ä¸‹ã®è¦ç´ ã¯åˆ¥ã«èª¬æ˜ã—ãªã„ã¨ã¨æ€ã†ã®ã§ã—ã¾ã™ã€‚\r\n\r\n- Codec private data\r\n- SimpleBlock\r\n\r\n## ã–ã£ãã‚Šä½•ãŒå…¥ã£ã¦ã‚‹ã‹\r\nãã®å‰ã«ä½•ã«ä½•ãŒå…¥ã£ã¦ã‚‹ã‹ã–ã£ãã‚Š\r\n\r\n- EBML\r\n    - ãŠã¾ã˜ãªã„ã¿ãŸã„ãªã®\r\n    - ãƒ•ã‚¡ã‚¤ãƒ«ãŒ WebM ã ã‚ˆ ã¿ãŸã„ãªã®\r\n- Segment\r\n    - æ˜ åƒã‚„éŸ³å£°ã®å®Ÿéš›ãƒ‡ãƒ¼ã‚¿ã‚’é™¤ã„ãŸãƒ‡ãƒ¼ã‚¿ãŒæœ‰ã‚‹\r\n- Info\r\n    - å‹•ç”»ã®é•·ã•ã¨ã‹æ›¸ãè¾¼ã¿ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒä½•ã‹ã¨ã‹ã‚’ã„ã‚Œã‚‹\r\n    - å‹•ç”»ã®é•·ã•ãŒå…¥ã£ã¦ãªã„ã¨ã‚·ãƒ¼ã‚¯ãƒãƒ¼ãŒä½¿ãˆãªã„\r\n- Tracks\r\n    - éŸ³å£°ã¨æ˜ åƒã®`Track`ã‚’å…¥ã‚Œã¾ã™\r\n- Track\r\n    - éŸ³å£°ãªã‚‰ã€ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆã€ãƒãƒ£ãƒ³ãƒãƒ«æ•°ã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®ç¨®é¡ã‚’å…¥ã‚Œã¾ã™\r\n    - æ˜ åƒãªã‚‰ã€å‹•ç”»ã®é«˜ã•ã‚„å¹…ã€ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ã®ç¨®é¡ã‚’å…¥ã‚Œã¾ã™\r\n    - ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ã‚‚ã“ã“ã§å…¥ã‚Œã¾ã™\r\n- Cue\r\n    - ãªã‚“ã‹ã‚·ãƒ¼ã‚¯ã™ã‚‹éš›ã®ç›®å°ã‚’å…¥ã‚Œã‚‹ã‚‰ã—ã„\r\n- Cluster\r\n    - SimpleBlockã‚’å…¥ã‚Œã‚‹\r\n    - æœ€åˆã«æ™‚é–“ã‚’å…¥ã‚Œã‚‹ã€ãã®æ¬¡ã« SimpleBlock ã®æ™‚é–“ã‚’ç›¸å¯¾æ™‚é–“ã§å…¥ã‚Œã‚‹ï¼ˆ2ãƒã‚¤ãƒˆã§ï¼‰\r\n    - 0xFF 0xFF ã‚’è¶…ãˆã‚‹å ´åˆã¯ Cluster ã‚’ä½œã‚Šç›´ã™\r\n- SimpleBlock\r\n    - ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿ã‚’å…¥ã‚Œã¾ã™\r\n\r\n## Codec private data\r\nã“ã“ã§ã¯éŸ³å£°ã‚³ãƒ¼ãƒ‡ãƒƒã‚¯ãŒ`Opus`ã®ã¨ãã®è©±ã€‚\r\n\r\nã“ã‚Œã¯éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã«å¿…è¦ãªãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚  \r\n`Track`ã«å®šç¾©ã•ã‚Œã¦ã„ãªã„å€¤ã‚’å…¥ã‚Œã‚‹ã®ã«ä½¿ã†ã€æœ¬å½“ã«ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ‡ãƒ¼ã‚¿ã§ã™ã€‚  \r\n\r\nãŠãã‚‰ã `Opus` ã‚’åˆ©ç”¨ã—ã¦ã„ã‚‹å ´åˆã¯å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã€ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆãªãƒ‡ãƒ¼ã‚¿ãªãŸã‚`EBML`ã®ä»•çµ„ã¿ã«ã‚‚ä¹—ã£ã‹ã£ã¦ã¾ã›ã‚“ï¼ï¼ï¼\r\n\r\n### Opus ã® Codec private data\r\nã¾ãšã¯ã“ã‚Œè¦‹ã¦ä¸‹ã•ã„ã€‚\r\n\r\nhttps://wiki.xiph.org/OggOpus#ID_Header\r\n\r\nhttps://www.rfc-editor.org/rfc/rfc7845#section-5\r\n\r\nã¯ã„ã€å®Œå…¨ã«`EBML`ã˜ã‚ƒãªã„ã§ã™ã­ã€‚ãƒ‡ã‚³ãƒ¼ãƒ€ãƒ¼ã«è¿½åŠ æƒ…å ±ã‚’æ¸¡ã™ãŸã‚ã«å¿…è¦ãªã‚ˆã†ã§ã™ã€‚\r\n\r\n```\r\n0x4F 0x70 0x75 0x73 0x48 0x65 0x61 0x64 0x01 0x02 0x00 0x00 0x80 0xBB 0x00 0x00 0x00 0x00 0x00\r\n```\r\n\r\n#### ä¸­èº«\r\n\r\nã¾ãšå…ˆé ­ã‹ã‚‰8ãƒã‚¤ãƒˆåˆ†ã¯ã€`OpusHead`ã‚’ASCIIã«ã—ãŸã‚‚ã®ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n| 0x4F | 0x70 | 0x75 | 0x73 | 0x48 | 0x65 | 0x61 | 0x64 |\r\n|------|------|------|------|------|------|------|------|\r\n| O    | p    | u    | s    | H    | e    | a    | d    |\r\n\r\nãã—ã¦æ¬¡ã®1ãƒã‚¤ãƒˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã™ãŒã€0x01ã§ã„ã„ãã†ã§ã™ã€‚\r\n\r\n| 0x01        |\r\n|-------------|\r\n| 0x01 ã§å›ºå®š |\r\n\r\nãã®æ¬¡ã®1ãƒã‚¤ãƒˆã¯ãƒãƒ£ãƒ³ãƒãƒ«æ•°ã§ã™ã€‚ãƒ¢ãƒãƒ©ãƒ«ãªã‚‰`0x01`ã€ã‚¹ãƒ†ãƒ¬ã‚ªãªã‚‰`0x02`ã§ã—ã‚‡ã†ã€‚\r\n\r\n| 0x02         |\r\n|--------------|\r\n| ãƒãƒ£ãƒ³ãƒãƒ«æ•° |\r\n\r\nãã®æ¬¡ã®2ãƒã‚¤ãƒˆåˆ†ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ã€‚`Pre-skip`ã£ã¦æ›¸ã„ã¦ã‚ã‚‹ã‘ã©çŸ¥ã‚‰ã‚“\r\n\r\n| 0x00     | 0x00 |\r\n|----------|------|\r\n| Pre-skip |      |\r\n\r\nãã®æ¬¡ã®4ãƒã‚¤ãƒˆåˆ†ã¯ã‚µãƒ³ãƒ—ãƒªãƒ³ã‚°ãƒ¬ãƒ¼ãƒˆã§ã™ã€‚ãªã‚“ã¨**ãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³**ã§ã™\r\n\r\n`0x80 0xBB 0x00 0x00`\r\n\r\nãƒªãƒˆãƒ«ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ãªã®ã§é›»å“ã«ãã®ã¾ã¾çªã£è¾¼ã‚“ã§ã‚‚å¤šåˆ†å¤‰ãªå€¤ã«ãªã‚Šã¾ã™ã€‚ã¡ãªã¿ã«æ­£è§£ã¯10é€²æ•°ã§`48000`ã«ãªã‚‹ã¹ãã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/I14Pec7.png)\r\n\r\nã•ã‚‰ã«`Java (JVM ã§å‹•ã Kotlin ã‚‚)`ã‚‚ãƒ“ãƒƒã‚°ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ãªã®ã§ãŠã‹ã—ããªã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\né›»å“ã§æ­£ã—ã„å€¤ã‚’å‡ºã™ãŸã‚ã«ã¯(Windowsã®é›»å“ã¯ãƒ“ãƒƒã‚°ã‚¨ãƒ³ãƒ‡ã‚£ã‚¢ãƒ³ã£ã½ã„ï¼Ÿ)ã€ãƒã‚¤ãƒˆã‚’é€†é †ã«ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãªã®ã§ã€\r\n\r\n`0x80 0xBB 0x00 0x00` ã‚’ `0x00 0x00 0xBB 0x80` ã«ã—ãŸå¾Œã«é›»å“ã«å…¥ã‚Œã‚‹ã¨æ­£ã—ã„å€¤ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/g8UjMba.png)\r\n\r\næœ€å¾Œã®3ãƒã‚¤ãƒˆã¯ã‚ã‹ã‚‰ã‚“ã€ä½¿ã‚ãªãã†ãªã®ã§`0x00`ã§åŸ‹ã‚ã¦ã¾ã™\r\n\r\n| 0x00 | 0x00 | 0x00 |\r\n|------|------|------|\r\n| ?    | ?    | ?    |\r\n\r\néŸ³å£°ã®`Track`ã«å…¥ã‚Œã‚‹`Codec private data`ã¯ä»¥ä¸Šã§ã™ã€‚\r\n\r\n### SampleBlock\r\nã“ã‚Œã‚‚ã¡ã‚‡ã£ã¨ç‰¹æ®Šã§ã€`Data`ã®å…ˆé ­4ãƒã‚¤ãƒˆã«å€¤ã‚’å…¥ã‚Œã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n#### æœ€åˆã«å…¥ã‚Œã‚‹å†…å®¹\r\n\r\n```\r\n0x81 0x00 0x00 0x80\r\n```\r\n\r\næœ€åˆã®1ãƒã‚¤ãƒˆã¯ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ã§ã™ã€‚Tracksã«Trackã‚’è¿½åŠ ã™ã‚‹éš›ã«æŒ‡å®šã™ã‚‹ã¨æ€ã„ã¾ã™ã€‚ãã‚Œã§ã™ï¼ˆéŸ³å£°ãªã®ã‹æ˜ åƒãªã®ã‹ï¼‰  \r\næ¬¡ã®2ãƒã‚¤ãƒˆã¯æ™‚é–“ã§ã™ã€‚ 0xFF 0xFF ã¾ã§ã—ã‹æ™‚é–“ãŒè¿½åŠ å‡ºæ¥ãªã„ã§ã™ï¼ˆShort.MAX_VALUE ?ï¼‰ï¼ˆå¤šåˆ†ãƒŸãƒªç§’ã«ãªã‚‹ã®ã§ã€32ç§’ãã‚‰ã„ã‹ãªï¼‰  \r\n0xFF 0xFF ã‚’è¶…ãˆã‚‹å ´åˆã¯ã€`Cluster`ã‚’ä½œã‚Šç›´ã™ã¨ã“ã‚ã‹ã‚‰ã‚„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚(å¾Œè¿°)\r\n\r\næœ€å¾Œã®1ãƒã‚¤ãƒˆã¯ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã©ã†ã‹ã§ã™ã€‚ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãªã‚‰`0x80`ã€ãã†ã§ãªã‘ã‚Œã°`0x00`ã ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nãŠã‚ã‚Šã§ã™ã€‚\r\n\r\n# WebMãƒ‘ãƒ¼ã‚µãƒ¼ã‚’æ›¸ã“ã†\r\nã¯ã„ã“ã“ã¾ã§æ¥ãŸã‚‰ã‹ã‘ã¾ã™ã­ã€æ›¸ãã¾ã—ã‚‡ã†\r\n\r\n## æµã‚Œ\r\n\r\n- EBMLã‚’èª­ã¿å‡ºã™\r\n- Segmentã®å…¥ã‚Œå­ã«ãªã£ã¦ã‚‹è¦ç´ ã‚’èª­ã¿å‡ºã™\r\n    - Info / Tracks / Cue ãªã©\r\n- Clusterã‚’èª­ã¿å‡ºã™\r\n\r\n## Kotlinã§æ›¸ã\r\n\r\né©å½“ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã£ã¦ä¸‹ã•ã„ã€‚\r\n\r\n## åˆ—æŒ™å‹\r\n\r\né©å½“ã«\r\n\r\n```kotlin\r\n/** Matroskaã®IDãŸã¡ */\r\nenum class MatroskaTags(val byteArray: ByteArray) {\r\n    EBML(byteArrayOf(0x1A.toByte(), 0x45.toByte(), 0xDF.toByte(), 0xA3.toByte())),\r\n    EBMLVersion(byteArrayOf(0x42.toByte(), 0x86.toByte())),\r\n    EBMLReadVersion(byteArrayOf(0x42.toByte(), 0xF7.toByte())),\r\n    EBMLMaxIDLength(byteArrayOf(0x42.toByte(), 0xF2.toByte())),\r\n    EBMLMaxSizeLength(byteArrayOf(0x42.toByte(), 0xF3.toByte())),\r\n    DocType(byteArrayOf(0x42.toByte(), 0x82.toByte())),\r\n    DocTypeVersion(byteArrayOf(0x42.toByte(), 0x87.toByte())),\r\n    DocTypeReadVersion(byteArrayOf(0x42.toByte(), 0x85.toByte())),\r\n\r\n    Segment(byteArrayOf(0x18.toByte(), 0x53.toByte(), 0x80.toByte(), 0x67.toByte())),\r\n    SeekHead(byteArrayOf(0x11.toByte(), 0x4D.toByte(), 0x9B.toByte(), 0x74.toByte())),\r\n    Seek(byteArrayOf(0x4D.toByte(), 0xBB.toByte())),\r\n    SeekID(byteArrayOf(0x53.toByte(), 0xAB.toByte())),\r\n    SeekPosition(byteArrayOf(0x53.toByte(), 0xAC.toByte())),\r\n\r\n    Info(byteArrayOf(0x15.toByte(), 0x49.toByte(), 0xA9.toByte(), 0x66.toByte())),\r\n    Duration(byteArrayOf(0x44.toByte(), 0x89.toByte())),\r\n    SegmentUUID(byteArrayOf(0x73.toByte(), 0xA4.toByte())),\r\n    TimestampScale(byteArrayOf(0x2A.toByte(), 0xD7.toByte(), 0xB1.toByte())),\r\n    MuxingApp(byteArrayOf(0x4D.toByte(), 0x80.toByte())),\r\n    WritingApp(byteArrayOf(0x57.toByte(), 0x41.toByte())),\r\n\r\n    Tracks(byteArrayOf(0x16.toByte(), 0x54.toByte(), 0xAE.toByte(), 0x6B.toByte())),\r\n    Track(byteArrayOf(0xAE.toByte())),\r\n    TrackNumber(byteArrayOf(0xD7.toByte())),\r\n    TrackUID(byteArrayOf(0x73.toByte(), 0xC5.toByte())),\r\n    FlagLacing(byteArrayOf(0x9C.toByte())),\r\n    Language(byteArrayOf(0x22.toByte(), 0xB5.toByte(), 0x9C.toByte())),\r\n    TrackType(byteArrayOf(0x83.toByte())),\r\n    DefaultDuration(byteArrayOf(0x23.toByte(), 0xE3.toByte(), 0x83.toByte())),\r\n    TrackTimecodeScale(byteArrayOf(0x23.toByte(), 0x31.toByte(), 0x4F.toByte())),\r\n    CodecID(byteArrayOf(0x86.toByte())),\r\n    CodecPrivate(byteArrayOf(0x63.toByte(), 0xA2.toByte())),\r\n    CodecName(byteArrayOf(0x25.toByte(), 0x86.toByte(), 0x88.toByte())),\r\n    VideoTrack(byteArrayOf(0xE0.toByte())),\r\n    PixelWidth(byteArrayOf(0xB0.toByte())),\r\n    PixelHeight(byteArrayOf(0xBA.toByte())),\r\n    FrameRate(byteArrayOf(0x23.toByte(), 0x83.toByte(), 0xE3.toByte())),\r\n    AudioTrack(byteArrayOf(0xE1.toByte())),\r\n    SamplingFrequency(byteArrayOf(0xB5.toByte())),\r\n    Channels(byteArrayOf(0x9F.toByte())),\r\n    BitDepth(byteArrayOf(0x62.toByte(), 0x64.toByte())),\r\n\r\n    Cues(byteArrayOf(0x1C.toByte(), 0x53.toByte(), 0xBB.toByte(), 0x6B.toByte())),\r\n    CuePoint(byteArrayOf(0xBB.toByte())),\r\n    CueTime(byteArrayOf(0xB3.toByte())),\r\n    CueTrackPositions(byteArrayOf(0xB7.toByte())),\r\n    CueTrack(byteArrayOf(0xF7.toByte())),\r\n    CueClusterPosition(byteArrayOf(0xF1.toByte())),\r\n\r\n    Cluster(byteArrayOf(0x1F.toByte(), 0x43.toByte(), 0xB6.toByte(), 0x75.toByte())),\r\n    Timestamp(byteArrayOf(0xE7.toByte())),\r\n    SimpleBlock(byteArrayOf(0xA3.toByte())),\r\n\r\n    Void(byteArrayOf(0xEC.toByte())),\r\n}\r\n```\r\n\r\n## ãƒ‘ãƒ¼ã‚µãƒ¼ã‚’æ›¸ã\r\n\r\n### ID\r\n\r\nã¨ã‚Šã‚ãˆãš VInt ã‚’è¨ˆç®—ã™ã‚‹ã‚„ã¤æ›¸ãã¾ã™ã‹ã€ã‚ã®1ãŒã¨ã“ã«ç«‹ã£ã¦ã‚‹ã‹ã®ã‚„ã¤\r\n\r\næ›¸ãã¾ã—ãŸã€‚`downTo`ã„ã„ã­ã€ã‚‚ã†Kotlinã—ã‹ã§ããªã„\r\n\r\n```kotlin\r\n/**\r\n * VIntã‚’å‡ºã™\r\n * å¾Œç¶šãƒã‚¤ãƒˆã®é•·ã•ã‚’è¿”ã—ã¾ã™ã€‚å¤±æ•—ã—ãŸã‚‰ -1 ã‚’è¿”ã—ã¾ã™\r\n */\r\nfun Byte.getVIntSize(): Int {\r\n    // Javaã®Byteã¯ç¬¦å·ä»˜ããªã®ã§ã€UIntã«ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚AND 0xFF ã™ã‚‹ã¨ UInt ã«ã§ãã‚‹\r\n    val int = this.toInt().andFF()\r\n    // ä»¥ä¸‹ã®ã‚ˆã†ã«\r\n    // 1000_0000 -> 1xxx_xxxx\r\n    // 0100_0000 -> 01xx_xxxx_xxxx_xxxx\r\n    for (i in 7 downTo 0) {\r\n        if ((int and (1 shl i)) != 0) {\r\n            return 8 - i\r\n        }\r\n    }\r\n    return -1\r\n}\r\n\r\n/** Byteã‚’Intã«å¤‰æ›ã—ãŸéš›ã«ã€ç¬¦å·ä»˜ãIntã«ãªã‚‹ã®ã§ã€AND 0xFF ã™ã‚‹ã ã‘ã®é–¢æ•° */\r\nfun Int.andFF() = this and 0xFF\r\n```\r\n\r\nJavaã ã¨ã€Byteã¯ç¬¦å·ä»˜ãã«ãªã‚‹ã®ã§ã€`AND 0xFF`ã‚’ã—ãªã„ã¨ã ã‚ã§ã™ã€‚å¤šåˆ†  \r\n\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã§ã‚ã‹ã‚‹ã¯ãš\r\n\r\n```kotlin\r\n// ä¾‹ã§ã‚ã‚‹\r\n\r\nprintln(0x81.toByte().getVIntSize()) // return 1\r\nprintln(0x42.toByte().getVIntSize()) // return 2\r\nprintln(0x2A.toByte().getVIntSize()) // return 3\r\nprintln(0x18.toByte().getVIntSize()) // return 4\r\nprintln(0x82.toByte().getVIntSize()) // return 1\r\n```\r\n\r\n### DataSize\r\n\r\n`Data`ã®é•·ã•ã‚’è¡¨ã™`DataSize`ã§ã™ã€‚  \r\nå·¦ã‹ã‚‰æ•°ãˆã¦æœ€åˆã®1ã‚’æ¶ˆã—ãŸå¾Œã®16é€²æ•°ãŒãã†ã§ã™ã€‚\r\n\r\n```kotlin\r\n/** DataSizeã®é•·ã•ãŒä¸å®šã®å ´åˆ */\r\nprivate val DATASIZE_UNDEFINED = byteArrayOf(0x1F.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte())\r\n\r\n/**\r\n * DataSizeã‚’è¨ˆç®—ã™ã‚‹ã€‚\r\n * ã ãŸã—ã€é•·ã•ä¸å®šã®å ´åˆï¼ˆ[MatroskaTags.Segment]ã€[MatroskaTags.Cluster]ï¼‰ã®å ´åˆã€[-1]ã‚’è¿”ã™\r\n *\r\n * ä¾‹\r\n * 0x82 -> 0x02\r\n * 0x42 0x10 -> 0x02 0x10\r\n */\r\nfun ByteArray.toDataSize(): Int {\r\n    var first = first().toInt().andFF()\r\n    // ä¾‹å¤–ã§ã€ 01 FF FF FF FF FF FF FF ã®ã¨ãã¯é•·ã•ãŒä¸å®šãªã®ã§...\r\n    // Segment / Cluster ã®å ´åˆã¯å­è¦ç´ ã®é•·ã•ã‚’å…¨éƒ¨è¶³ã›ã°å‡ºã›ã‚‹ã¨æ€ã†ã®ã§ã€ã€ã€\r\n    if (contentEquals(DATASIZE_UNDEFINED)) {\r\n        return -1\r\n    }\r\n    // å·¦ã‹ã‚‰æ•°ãˆã¦æœ€åˆã®1ãƒ“ãƒƒãƒˆ ã‚’æ¶ˆã™å‡¦ç†\r\n    // ä¾‹\r\n    // 0b1000_0000 ãªã‚‰ 0b1xxx_xxxx ã® x ã®ç¯„å›²ãŒæ•°å€¤ã«ãªã‚‹\r\n    // break ã—ãŸã‹ã£ãŸã®ã§ for\r\n    for (i in 0..8) {\r\n        if ((first and (1 shl (8 - i))) != 0) {\r\n            // å¤šåˆ†\r\n            // 0b1000_1000 XOR 0b0000_1000 ã¿ãŸã„ãªã®ã‚’ã‚„ã£ã¦ã‚‹ã¯ãš\r\n            first = first xor (1 shl (8 - i))\r\n            break\r\n        }\r\n    }\r\n    return (byteArrayOf(first.toByte()) + this.drop(1)).toInt()\r\n}\r\n\r\n/** ByteArray ã‹ã‚‰ Int ã¸å¤‰æ›ã™ã‚‹ã€‚ByteArray å†…ã«ã‚ã‚‹ Byte ã¯ç¬¦å·ãªã—ã«å¤‰æ›ã•ã‚Œã‚‹ã€‚ */\r\nfun ByteArray.toInt(): Int {\r\n    // å…ˆé ­ã« 0x00 ãŒã‚ã‚Œã°æ¶ˆã™\r\n    val validValuePos = kotlin.math.max(0, this.indexOfFirst { it != 0x00.toByte() })\r\n    var result = 0\r\n    // é€†ã«ã™ã‚‹\r\n    // ã“ã‚Œã—ãªã„ã¨å·¦å´ã«ãƒã‚¤ãƒˆãŒç§»å‹•ã™ã‚‹ã‚ˆã†ãªã‚·ãƒ•ãƒˆæ¼”ç®—ï¼Ÿã«ãªã£ã¦ã—ã¾ã†\r\n    // for ã‚’ å¤šã„é † ã«ã™ã‚Œã°ã„ã„ã‘ã©ã“ã£ã¡ã®æ–¹ã§ã„ã„ã‚“ã˜ã‚ƒãªã„\r\n    drop(validValuePos).reversed().also { bytes ->\r\n        for (i in 0 until bytes.count()) {\r\n            result = result or (bytes.get(i).toInt().andFF() shl (8 * i))\r\n        }\r\n    }\r\n    return result\r\n}\r\n```\r\n\r\nByteArray ã‹ã‚‰ Int ã¯ã“ã¡ã‚‰ã‚’å‚è€ƒã«ã—ã¾ã—ãŸã€ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚  \r\nhttps://gist.github.com/groovelab/38d381a943556299f205b47307bf60d7\r\n\r\nå¤šåˆ†å·¦å´ã¸ãƒ“ãƒƒãƒˆã‚’å‹•ã‹ã—ã¦Intã«ã—ã¦ã‚‹ã‚“ã ã¨æ€ã„ã¾ã™ã€\r\n\r\n`[ 0x10, 0x20, 0x30 ]` ã ã£ãŸã‚‰...\r\n\r\n|                   |      |      |          |\r\n|-------------------|------|------|----------|\r\n| å·¦å´ã¸2ãƒã‚¤ãƒˆç§»å‹• | 0x10 | 0x00 | 0x00     |\r\n| å·¦å´ã¸1ãƒã‚¤ãƒˆç§»å‹• |      | 0x20 | 0x00     |\r\n| å·¦å´ã¸0ãƒã‚¤ãƒˆç§»å‹• |      |      | 0x30     |\r\n| XOR ã™ã‚‹          |      |      | 0x102030 |\r\n\r\nãã‚Œã¨ã€ `0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF`ã®å ´åˆã®ã“ã¨ã‚’è€ƒãˆãªã„ã¨ã„ã‘ãªã„ã‚“ã§ã™ã‚ˆã­ã€‚  \r\nã“ã‚Œã¯é•·ã•ãŒä¸æ˜ã®å ´åˆã«æŒ‡å®šã•ã‚Œã¦ã„ã¾ã™ã€‚`JavaScript`ã®`MediaRecorder API`ã§éŒ²ç”»ã—ãŸãƒ‡ãƒ¼ã‚¿ãŒã¾ã•ã«é•·ã•ä¸å®šã«ãªã‚Šã¾ã™ã€‚  \r\nãŸã ã€å­è¦ç´ ã«ã¯é•·ã•ãŒå…¥ã£ã¦ã„ã‚‹ãŸã‚ã€ã“ã‚Œã‚’å…¨éƒ¨è¶³ã›ã°ã„ã„ã¨æ€ã„ã¾ã—ãŸã€‚\r\n\r\n\r\n### Data\r\n`DataSize`åˆ†å–ã‚Šå‡ºã™ã ã‘ãªã®ã§ç‰¹ç­†ã™ã‚‹ã“ã¨ã¯ãªã„ã‹ã¨\r\n\r\n## çµ„ã¿åˆã‚ã›ã‚‹\r\n\r\nã“ã‚Œã‚‰ã®æ‹¡å¼µé–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ä¸€ã¤ã®è¦ç´ ã‚’ãƒ‘ãƒ¼ã‚¹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\nã¨ã€ãã®å‰ã«ãƒ‘ãƒ¼ã‚¹çµæœã‚’å…¥ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹ã‚’ä½œã‚Šã¾ã—ã‚‡ã†ã€‚\r\n\r\n```kotlin\r\n/**\r\n * EBMLã®è¦ç´ ã‚’è¡¨ã™ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹\r\n *\r\n * @param tag [MatroskaTags]\r\n * @param elementSize è¦ç´ ã®åˆè¨ˆã‚µã‚¤ã‚º\r\n * @param data å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿\r\n */\r\ndata class MatroskaElement(\r\n    val tag: MatroskaTags,\r\n    val data: ByteArray,\r\n    val elementSize: Int,\r\n)\r\n```\r\n\r\nè¦ç´ ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹é–¢æ•°ã¯ã“ã¡ã‚‰ã€‚`Data size`ãŒä¸å®š`0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF`ã®å ´åˆã¯å‹•ã‹ãªã„ã¨æ€ã„ã¾ã™ã€‚å…ˆé ­ã‹ã‚‰è¦‹ã¦ã„ã£ã¦ã‚‚ã„ã„ã‘ã©ã•ã‚...\r\n\r\n```kotlin\r\n/**\r\n * EBMLã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹\r\n *\r\n * @param byteArray [ByteArray]\r\n * @param startPos èª­ã¿å‡ºã—é–‹å§‹ä½ç½®\r\n */\r\nfun parseElement(byteArray: ByteArray, startPos: Int): MatroskaElement {\r\n    var readPos = startPos\r\n    val idLength = byteArray[readPos].getVIntSize()\r\n    // IDã®ãƒã‚¤ãƒˆé…åˆ—\r\n    val idBytes = byteArray.copyOfRange(readPos, readPos + idLength)\r\n    val idElement = MatroskaTags.find(idBytes)!!\r\n    readPos += idBytes.size\r\n    // DataSizeéƒ¨\r\n    val dataSizeLength = byteArray[readPos].getVIntSize()\r\n    val dataSizeBytes = byteArray.copyOfRange(readPos, readPos + dataSizeLength)\r\n    val dataSize = dataSizeBytes.toDataSize()\r\n    readPos += dataSizeBytes.size\r\n    // Dataã‚’èª­ã¿å‡ºã™ã€‚\r\n    // é•·ã•ãŒå–å¾—ã§ããŸå ´åˆã¨ãã†ã˜ã‚ƒãªã„å ´åˆã§...\r\n    return if (dataSize != -1) {\r\n        // Dataéƒ¨\r\n        val dataBytes = byteArray.copyOfRange(readPos, readPos + dataSize)\r\n        readPos += dataSize\r\n        MatroskaElement(idElement, dataBytes, readPos - startPos)\r\n    } else {\r\n        // ã‚‚ã— -1 (é•·ã•ä¸å®š)ã®å ´åˆã¯å…¨éƒ¨å–å¾—ã™ã‚‹ã‚ˆã†ã«ã™ã‚‹\r\n        // ãŸã ã—å…¨éƒ¨å–å¾—ã™ã‚‹ã¨å£Šã‚Œã‚‹ã®ã§ã€ç›´ã•ãªã„ã¨ã„ã‘ãªã„\r\n        val dataBytes = byteArray.copyOfRange(readPos, byteArray.size)\r\n        readPos += dataBytes.size\r\n        MatroskaElement(idElement, dataBytes, readPos - startPos)\r\n    }\r\n}\r\n```\r\n\r\nå¾Œã¯ã“ã‚Œã‚’å†å¸°çš„ã«å‘¼ã³å‡ºã›ã°ã™ã¹ã¦ã®è¦ç´ ãŒå–ã‚Šå‡ºã›ã‚‹ã¯ãšã§ã™ï¼\r\n\r\n## å†å¸°çš„ã«å‘¼ã³å‡ºã™\r\n\r\nå…¥ã‚Œå­ã«ãªã£ã¦ã‚‹ã‚¿ã‚°ã®å ´åˆã¯å†åº¦`parseElement`ã‚’å‘¼ã³å‡ºã™ã‚ˆã†ã«ã—ã¦ã„ã¾ã™ã€‚  \r\nãã†ã˜ã‚ƒãªã„å ´åˆã¯é…åˆ—ã«å…¥ã‚‹ã€‚\r\n\r\n```kotlin\r\n/**\r\n * å­è¦ç´ ã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹\r\n *\r\n * @param byteArray ãƒã‚¤ãƒŠãƒª\r\n */\r\nfun parseChildElement(byteArray: ByteArray): List<MatroskaElement> {\r\n    val childElementList = arrayListOf<MatroskaElement>()\r\n    var readPos = 0\r\n    while (byteArray.size > readPos) {\r\n        val element = parseElement(byteArray, readPos)\r\n        // è¦ªè¦ç´ ãŒã‚ã‚Œã°å­è¦ç´ ã‚’ãƒ‘ãƒ¼ã‚¹ã—ã¦ã„ã\r\n        when (element.tag) {\r\n            MatroskaTags.SeekHead -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.Info -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.Tracks -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.Track -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.VideoTrack -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.AudioTrack -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.Cues -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.CuePoint -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.CueTrackPositions -> childElementList += parseChildElement(element.data)\r\n            MatroskaTags.Cluster -> childElementList += parseChildElement(element.data)\r\n            // è¦ªè¦ç´ ã§ã¯ãªãå­è¦ç´ ã®å ´åˆã¯é…åˆ—ã«å…¥ã‚Œã‚‹\r\n            else -> childElementList += element\r\n        }\r\n        readPos += element.elementSize\r\n    }\r\n    return childElementList\r\n}\r\n```\r\n\r\næœ€å¾Œã«ã“ã‚Œã‚’`mainé–¢æ•°`ã§å‘¼ã³å‡ºã™ãªã‚Šã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nã‚‚ã—ã‹ã™ã‚‹ã¨ã“ã“ã¾ã§ã®ã‚³ãƒ¼ãƒ‰ã§ Javaã®æ©Ÿèƒ½ ã‚’ä½¿ã£ã¦ãªã„ã®ã§ä»–ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚‚å‹•ãã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚  \r\n\r\nä»¥ä¸‹ã®ä¾‹ã§ã¯ `Java ã® File API` ã‚’å‘¼ã³å‡ºã—ã¦ã‚‹ã®ã§`JVM`ã®ã¿ã§ã™ãŒã€ä»–ã®ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ ã§ã‚‚ `Kotlin ã® ByteArray` ãŒå–å¾—ã§ãã‚Œã°ä½¿ãˆã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã§ã™ã€‚  \r\n\r\n**ã‚ï¼ã¡ãªã¿ã« JS ã® MediaRecorder API ã ã¨ é•·ã•ä¸å®š (0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF) ã® WebM ã‚’å‡ºåŠ›ã™ã‚‹ã®ã§ã“ã®ã¾ã¾ã§ã¯ä½¿ãˆã¾ã›ã‚“çµ‚ã‚ã‚Šã§ã™ã€‚**\r\n\r\n```kotlin\r\nfun main() {\r\n    // é©å½“ã«WebMã®ãƒ‘ã‚¹ã‚’\r\n    val bytes = File(\"\"\"C://Users/takusan23/Desktop/demo.webm\"\"\").readBytes()\r\n    val elementList = arrayListOf<MatroskaElement>()\r\n    // ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã®ãƒ‘ãƒ¼ã‚¹ä½ç½®\r\n    // EBML Segment Cluster ãªã©\r\n    var topLevelReadPos = 0\r\n\r\n    // EBMLã‚’èª­ã¿å‡ºã™\r\n    val ebmlElement = parseElement(bytes, 0)\r\n    topLevelReadPos += ebmlElement.elementSize\r\n    elementList.addAll(parseChildElement(ebmlElement.data))\r\n\r\n    // Segmentã‚’èª­ã¿å‡ºã™\r\n    val segmentElement = parseElement(bytes, topLevelReadPos)\r\n    topLevelReadPos += segmentElement.elementSize\r\n    elementList.addAll(parseChildElement(segmentElement.data))\r\n\r\n    // çµæœã‚’å‡ºåŠ›\r\n    elementList.forEach {\r\n        println(\"${it.tag} = ${it.data.take(10).toByteArray().toHexString()}\")\r\n    }\r\n}\r\n\r\n/** 16é€²æ•°ã«å¤‰æ›ã™ã‚‹ã‚„ã¤ */\r\nprivate fun ByteArray.toHexString() = this.joinToString(separator = \" \") { \"%02x\".format(it) }\r\n```\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¯ãšã€‚\r\n\r\n```\r\nEBMLVersion = ...\r\nEBMLReadVersion = ...\r\nEBMLMaxIDLength = ...\r\nEBMLMaxSizeLength = ...\r\nDocType = ...\r\nDocTypeVersion = ...\r\nDocTypeReadVersion = ...\r\nSeek = ...\r\nSeek = ...\r\nSeek = ...\r\nVoid = ...\r\nDuration = ...\r\nTimestampScale = ...\r\nMuxingApp = ...\r\nWritingApp = ...\r\nTrackNumber = ...\r\nTrackUID = ...\r\nFlagLacing = ...\r\nLanguage = ...\r\nCodecID = ...\r\nTrackType = ...\r\nChannels = ...\r\nSamplingFrequency = ...\r\nCodecPrivate = ...\r\nTrackNumber = ...\r\nTrackUID = ...\r\nFlagLacing = ...\r\nLanguage = ...\r\nCodecID = ...\r\nTrackType = ...\r\nPixelWidth = ...\r\nPixelHeight = ...\r\n```\r\n\r\n## ã‚µã‚¤ã‚ºãŒä¸æ˜ãª Clsuter ...\r\n\r\n`JS`ã®`MediaRecoder API`ã‚’ä½¿ã£ãŸã§ããŸå‹•ç”»ã£ã¦ã€`DataSize`ãŒ`0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF`ã«ãªã£ã¦ã„ã¦ã€ãŠãã‚‰ãå­è¦ç´ ã‚’æ¬¡ã®ClusterãŒæ¥ã‚‹ã¾ã§ãªã‚ã¦ã„ãã—ã‹ç„¡ã„ã§ã™ã€‚  \r\nã¨ã„ã†ã‚ã‘ã§ ã“ã¡ã‚‰ã®ã‚³ãƒ¼ãƒ‰\r\n\r\n```kotlin\r\n/**\r\n * DataSize ãŒ 0x01 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF 0xFF ã ã£ãŸå ´åˆã«ã‚µã‚¤ã‚ºã‚’å‡ºã™ã€‚ç®—å‡ºæ–¹æ³•ã¯ä»¥ä¸‹ã€‚å¤šåˆ† Cluster ä»¥å¤–ã§ã¯å‹•ã‹ãªã„\r\n * Cluster ã®ãã‚Œãã‚Œã®å­è¦ç´ ã«ã¯ã‚µã‚¤ã‚ºãŒå…¥ã£ã¦ã„ã‚‹ãŸã‚ã€æ¬¡ã®ClusterãŒç¾ã‚Œã‚‹ã¾ã§è¶³ã—ã¦ã„ãã“ã¨ã§ã‚µã‚¤ã‚ºãŒåˆ†ã‹ã‚‹ã€‚\r\n */\r\nfun ByteArray.calcUnknownElementSize(): Int {\r\n    val byteSize = this.size\r\n    var totalReadPos = 0\r\n    while (true) {\r\n        // å­è¦ç´ ã‚’é †ç•ªã«è¦‹ã¦ã€é•·ã•ã ã‘è¶³ã—ã¦ã„ã\r\n\r\n        var readPos = totalReadPos\r\n\r\n        val idLength = this[readPos].getVIntSize()\r\n        // IDã®ãƒã‚¤ãƒˆé…åˆ—\r\n        val idBytes = this.copyOfRange(readPos, readPos + idLength)\r\n        val idElement = MatroskaTags.find(idBytes)!!\r\n        readPos += idLength\r\n\r\n        // ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«è¦ç´ ï¼Ÿåˆ¥ã®Clusterã«ã¶ã¤ã‹ã£ãŸã‚‰ã‚‚ã†è§£æã—ãªã„\r\n        if (idElement == MatroskaTags.Cluster) {\r\n            break\r\n        }\r\n\r\n        // DataSizeéƒ¨\r\n        val dataSizeLength = this[readPos].getVIntSize()\r\n        val dataSizeBytes = this.copyOfRange(readPos, readPos + dataSizeLength)\r\n        val dataSize = dataSizeBytes.toDataSize()\r\n        readPos += dataSizeLength\r\n        readPos += dataSize\r\n\r\n        totalReadPos = readPos\r\n\r\n        // ã‚‚ã—ã‹ã—ãŸã‚‰ä»–ã®ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚‚ãªã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã‘ã©ã€\r\n        // Chromeã®å ´åˆã€WebMã®ãƒ•ã‚¡ã‚¤ãƒ«åˆ†å‰²ã¯ SimpleBlock ã®é€”ä¸­ã ã‚ã†ã¨ã¶ã£ãŸåˆ‡ã£ã¦ãã‚‹ã‚‰ã—ãã€ä¸­é€”åŠç«¯ã«ãƒ‡ãƒ¼ã‚¿ãŒä½™ã‚‹ã“ã¨ãŒã‚ã‚‹\r\n        // ä¾‹ï¼šã‚¿ã‚°ã® A3 ã§çµ‚ã‚ã‚‹ãªã©\r\n        // ãã®å ´åˆã«ã‚¨ãƒ©ãƒ¼ã«ãªã‚‰ãªã„ã‚ˆã†ã«ã€ã“ã®å¾Œ3ãƒã‚¤ãƒˆï¼ˆID / DataSize / Data ãã‚Œãã‚Œ1ãƒã‚¤ãƒˆï¼‰ãªã„å ´åˆã¯ãƒ«ãƒ¼ãƒ—ã‚’æŠœã‘ã‚‹\r\n        if (byteSize < totalReadPos + 3) {\r\n            break\r\n        }\r\n\r\n    }\r\n    return totalReadPos\r\n}\r\n```\r\n\r\næ¬¡ã®`Cluster`ãŒè¦‹ã¤ã‹ã‚‹ã¾ã§å­è¦ç´ ã®é•·ã•ã‚’è¶³ã—ã¦ã„ãé–¢æ•°ã§ã™ã€‚  \r\nã“ã‚Œã‚’ã€`parseChildElement`é–¢æ•°ã«çµ„ã¿è¾¼ã‚ã°...ã€å¤šåˆ†é•·ã•ãŒã‚ã‹ã‚‰ãªã„`Cluster`ã‚‚è§£æã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã¯ãšã§ã™ã€‚  \r\né•·ã•ä¸æ˜ã€ãƒ‘ãƒ¼ã‚¹ã—ã‚“ã©ã„ãª...\r\n\r\n```kotlin\r\n/**\r\n * EBMLã‚’ãƒ‘ãƒ¼ã‚¹ã™ã‚‹\r\n *\r\n * @param byteArray [ByteArray]\r\n * @param startPos èª­ã¿å‡ºã—é–‹å§‹ä½ç½®\r\n */\r\nfun parseElement(byteArray: ByteArray, startPos: Int): MatroskaElement {\r\n    var readPos = startPos\r\n    val idLength = byteArray[readPos].getVIntSize()\r\n    // IDã®ãƒã‚¤ãƒˆé…åˆ—\r\n    val idBytes = byteArray.copyOfRange(readPos, readPos + idLength)\r\n    val idElement = MatroskaTags.find(idBytes)!!\r\n    readPos += idBytes.size\r\n    // DataSizeéƒ¨\r\n    val dataSizeLength = byteArray[readPos].getVIntSize()\r\n    val dataSizeBytes = byteArray.copyOfRange(readPos, readPos + dataSizeLength)\r\n    val dataSize = dataSizeBytes.toDataSize()\r\n    readPos += dataSizeBytes.size\r\n    // Dataã‚’èª­ã¿å‡ºã™ã€‚\r\n    // é•·ã•ãŒå–å¾—ã§ããŸå ´åˆã¨ãã†ã˜ã‚ƒãªã„å ´åˆã§...\r\n    return if (dataSize != -1) {\r\n        // Dataéƒ¨\r\n        val dataBytes = byteArray.copyOfRange(readPos, readPos + dataSize)\r\n        readPos += dataSize\r\n        MatroskaElement(idElement, dataBytes, readPos - startPos)\r\n    } else {\r\n        // ã‚‚ã— -1 (é•·ã•ä¸å®š)ã®å ´åˆ\r\n        val unknownDataSize = if (idElement == MatroskaTags.Cluster) {\r\n            // Clusterã®å ´åˆã¯ã€æ¬¡ã®Clusterã¾ã§ã®å­è¦ç´ ã®åˆè¨ˆã‚µã‚¤ã‚ºã‚’å‡ºã™\r\n            readPos + byteArray.copyOfRange(readPos, byteArray.size).calcUnknownElementSize()\r\n        } else {\r\n            // Segmentã®å ´åˆã¯ã™ã¹ã¦å–å¾—\r\n            byteArray.size\r\n        }\r\n        val dataBytes = byteArray.copyOfRange(readPos, unknownDataSize)\r\n        readPos += dataBytes.size\r\n        MatroskaElement(idElement, dataBytes, readPos - startPos)\r\n    }\r\n}\r\n```\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/ZeroWebM\r\n\r\n# ãƒ–ãƒ©ã‚¦ã‚¶ã®æŒ™å‹•ï¼Ÿ\r\n\r\n- Chrome ã¯ è¦ç´ ã®é€”ä¸­ã ã‚ã†ã¨ã¶ã£ãŸåˆ‡ã£ã¦ãã‚‹ï¼Ÿ\r\n    - ãªã®ã§`DataSize`åˆ†ãƒ‡ãƒ¼ã‚¿ãŒã‚ã‚‹ã‹æ€ªã—ã„ï¼ˆãˆï¼Ÿï¼Ÿï¼Ÿï¼‰\r\n    - Clusterã®ãƒ‘ãƒ¼ã‚¹ã®éš›ã¯ãŠæ°—ã‚’ã¤ã‘ã¦\r\n    - ã‚³ãƒ¼ãƒ‰ã‚ã£ã¦ã‚‹ã‘ã©ãƒ‡ãƒ¼ã‚¿ãŒè‰¯ããªã„æ™‚ãŒã‚ã£ãŸï¼›ï¼›\r\n        - `ArrayIndexOutOfBoundsException: Index 56492651 out of bounds for length 56492651`\r\n        - ã“ã‚Œè‡ªåˆ†ãŒæ›¸ã„ãŸã‚³ãƒ¼ãƒ‰ãŒæ‚ªã„ã‚ˆã†ã«ã¿ãˆã‚‹ã˜ã‚ƒã‚“...\r\n- Firefox ã¯ã±ã£ã¨è¦‹è¦ç´ ã®çµ‚ã‚ã‚Šã«æƒãˆã¦ã„ãã†\r\n\r\n# ãã®ã»ã‹\r\n\r\n- Opusã®å ´åˆã€å¸¸ã«ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã‚‚ã—ã‚Œãªã„ã§ã™\r\n    - Android ã® ExoPlayer ã§ã¯ Opus ã® SimpleBlock ã¯å…¨éƒ¨ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã«ã—ãªã„ã¨å†ç”Ÿã§ãã¾ã›ã‚“ã§ã—ãŸï¼›ï¼›\r\n\r\n# ãŠã¾ã‘ æ›¸ãè¾¼ã¿ä½œã‚‹\r\nã©ã£ã¡ã‹ã¨ã„ã†ã¨ã“ã£ã¡æœ¬é¡Œã«ã—ãŸã‹ã£ãŸã‘ã©ã‚‚ã†ç–²ã‚ŒãŸ ~~ä¸Šã«æ°—åˆ†ãŒPixel Watch ã«å‚¾ã„ã¦ã‚‹ã®ã§ã‚‚ã†ç„¡ç†~~ \r\n\r\n## æµã‚Œ\r\n\r\n- IDè¦ç´ ã‚’ãƒã‚¤ãƒˆé…åˆ—ã«ã™ã‚‹\r\n    - ã¾ã‚ã“ã‚Œã¯ãƒ‘ãƒ¼ã‚¹ã®éš›ã«ç”¨æ„ã—ãŸã®ã‚’ä½¿ã„ã¾ã™\r\n- DataSizeã‚’è¨ˆç®—ã™ã‚‹\r\n    - ã‚ã‚“ã©ãã†\r\n    - é•·ã•ä¸æ˜ã¯ãƒ‘ãƒ¼ã‚µãƒ¼ãŒã‹ã‚ã„ãã†ãªã®ã§ã¡ã‚ƒã‚“ã¨ã—ã‚ˆã†ã­\r\n- IDè¦ç´ ã®ãƒã‚¤ãƒˆé…åˆ—ã€DataSizeã®ãƒã‚¤ãƒˆé…åˆ—ã€Dataã®é…åˆ—ã‚’ãã£ã¤ã‘ã‚‹\r\n- ã“ã‚Œã‚’å…¨éƒ¨ç¹°ã‚Šè¿”ã™\r\n\r\nãƒ‘ãƒ¼ã‚¹ã‚ˆã‚Šã‚„ã•ã—ãã†\r\n\r\n## ä¸€ã¤ã®è¦ç´ ã‚’è¡¨ã™ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ©ã‚¹\r\nä»Šå›ã¯æ¥½ã™ã‚‹ãŸã‚ã«ã€`DataSize`ãŒå¸¸ã«4ãƒã‚¤ãƒˆã«ãªã‚Šã¾ã™ï¼›ï¼›ã€‚4ãƒã‚¤ãƒˆã‚’è¶…ãˆãŸã‚‰å¯¾å¿œã§ããªã„ã®ã§å„è‡ªã„ã„æ„Ÿã˜ã«...  \r\nã“ã®è¨˜äº‹ã®å†’é ­ã®æœ€é©åŒ–ã—ã¦ãªã„ã®è©±ã¯ã“ã“ã«ã¤ãªãŒã‚‹ã‚ã‘ã§ã™ã­ã€‚ã€‚\r\n\r\n```kotlin\r\n/**\r\n * EBMLè¦ç´ ã‚’ä½œæˆã™ã‚‹\r\n *\r\n * @param tagId ã‚¿ã‚°\r\n * @param byteArray å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿\r\n * @param dataSize DataSizeã€‚ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰æ¸ˆã¿\r\n */\r\ndata class MatroskaBuildElement(\r\n    val tagId: MatroskaTags,\r\n    val byteArray: ByteArray,\r\n    val dataSize: ByteArray = byteArray.calcDataSize(),\r\n) {\r\n\r\n    /** [tagId] + [dataSize] + [byteArray] ã‚’ç¹‹ã’ãŸãƒã‚¤ãƒˆé…åˆ—ã‚’è¿”ã™ */\r\n    fun concat() = tagId.byteArray + dataSize + byteArray\r\n\r\n    override fun equals(other: Any?): Boolean {\r\n        if (this === other) return true\r\n        if (javaClass != other?.javaClass) return false\r\n\r\n        other as MatroskaBuildElement\r\n\r\n        if (tagId != other.tagId) return false\r\n        if (!byteArray.contentEquals(other.byteArray)) return false\r\n        if (!dataSize.contentEquals(other.dataSize)) return false\r\n\r\n        return true\r\n    }\r\n\r\n    override fun hashCode(): Int {\r\n        var result = tagId.hashCode()\r\n        result = 31 * result + byteArray.contentHashCode()\r\n        result = 31 * result + dataSize.contentHashCode()\r\n        return result\r\n    }\r\n\r\n}\r\n\r\n/** [ByteArray]ã®é•·ã•ã‚’æ±‚ã‚ã¦ã€DataSizeã‚’ä½œæˆã™ã‚‹ */\r\nprivate fun ByteArray.calcDataSize(): ByteArray {\r\n    // Intã‚’ByteArrayã«ã™ã‚‹\r\n    // TODO ã“ã‚Œã ã¨ 1 ã§ã‚‚ 0x00 0x00 0x00 0x01 ã¨ç„¡é§„ãªãƒ‘ãƒ‡ã‚£ãƒ³ã‚°ãŒå…¥ã£ã¦ã—ã¾ã†\r\n    val dataSizeByteArray = this.size.toByteArray()\r\n    val first = dataSizeByteArray.first()\r\n    // ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºè‡ªä½“ã‚‚å¯å¤‰é•·ãªã®ã§ã€ä½•ãƒã‚¤ãƒˆåˆ†ãŒãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãªã®ã‹è¨˜è¿°ã™ã‚‹\r\n    // V_INT ã¨ã‹ã„ã†ã‚„ã¤ã§ã€1ãŒå…ˆé ­ã‹ã‚‰ä½•ç•ªç›®ã«ç«‹ã£ã¦ã‚‹ã‹ã§æ®‹ã‚Šã®ãƒã‚¤ãƒˆæ•°ãŒåˆ†ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã‚‹\r\n    // 1000 0000 -> 7 ãƒ“ãƒƒãƒˆ ( 1xxx xxxx )\r\n    // 0100 0000 -> 14 ãƒ“ãƒƒãƒˆ ( 01xx xxxx xxxx xxxx )\r\n    val dataSizeBytesSize = when (dataSizeByteArray.size) {\r\n        1 -> 0b1000_0000\r\n        2 -> 0b0100_0000\r\n        3 -> 0b0010_0000\r\n        4 -> 0b0001_0000\r\n        5 -> 0b0000_1000\r\n        6 -> 0b0000_0100\r\n        7 -> 0b0000_0010\r\n        else -> 0b0000_0001\r\n    }\r\n    // ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºã®ãƒã‚¤ãƒˆã®å…ˆé ­ã« V_INT ã®ã‚„ã¤ã‚’ OR ã™ã‚‹\r\n    val dataSize = dataSizeByteArray.apply {\r\n        this[0] = (dataSizeBytesSize or first.toInt()).toByte()\r\n    }\r\n    return dataSize\r\n}\r\n\r\n/** [Int]ã‚’[ByteArray]ã«å¤‰æ›ã™ã‚‹ */\r\nprivate fun Int.toByteArray() = byteArrayOf(\r\n    (this shr 24).toByte(),\r\n    (this shr 16).toByte(),\r\n    (this shr 8).toByte(),\r\n    this.toByte(),\r\n)\r\n```\r\n\r\nmainé–¢æ•°ã¨ã‹ã§å‘¼ã³å‡ºã™ã‚ˆã†ã«ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™  \r\nä¾‹ãˆã°ã“ã‚Œã§ `EBMLãƒ˜ãƒƒãƒ€ãƒ¼` ã‚’ä½œã‚Œã¾ã™ã€\r\n\r\n```kotlin\r\n/** WebMãƒ©ã‚¤ã‚¿ãƒ¼ */\r\n\r\nfun main() {\r\n    // WebMãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ã‚ã‚‹ EBML Header ã‚’ä½œã‚‹\r\n    // å­è¦ç´ ã‚’ä½œæˆã™ã‚‹\r\n    val ebmlVersion = MatroskaBuildElement(MatroskaTags.EBMLVersion, byteArrayOf(0x01))\r\n    val readVersion = MatroskaBuildElement(MatroskaTags.EBMLReadVersion, byteArrayOf(0x01))\r\n    val maxIdLength = MatroskaBuildElement(MatroskaTags.EBMLMaxIDLength, byteArrayOf(0x04))\r\n    val maxSizeLength = MatroskaBuildElement(MatroskaTags.EBMLMaxSizeLength, byteArrayOf(0x08))\r\n    val docType = MatroskaBuildElement(MatroskaTags.DocType, \"webm\".toAscii())\r\n    val docTypeVersion = MatroskaBuildElement(MatroskaTags.DocTypeVersion, byteArrayOf(0x02))\r\n    val docTypeReadVersion = MatroskaBuildElement(MatroskaTags.DocTypeReadVersion, byteArrayOf(0x02))\r\n\r\n    // EBML Header è¦ç´ \r\n    val children = ebmlVersion.concat() + readVersion.concat() + maxIdLength.concat() + maxSizeLength.concat() + docType.concat() + docTypeVersion.concat() + docTypeReadVersion.concat()\r\n    val ebmlHeader = MatroskaBuildElement(MatroskaTags.EBML, children)\r\n    // ãƒ•ã‚¡ã‚¤ãƒ«ã«æ›¸ãå‡ºã™\r\n    File(\"ebmlHeader.webm\").writeBytes(ebmlHeader.concat())\r\n}\r\n\r\n/** æ–‡å­—åˆ—ã‚’ ASCII ã®ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›ã™ã‚‹ */\r\nprivate fun String.toAscii() = this.toByteArray(charset = Charsets.US_ASCII)\r\n```\r\n\r\nã¡ã‚ƒã‚“ã¨ãƒ‘ãƒ¼ã‚µãƒ¼ã«èªè­˜ã•ã‚Œã¦ã¾ã—ãŸ\r\n\r\n![Imgur](https://imgur.com/lAcMljf.png)\r\n\r\n## ä»–ã®è¦ç´ ã‚‚ä½œã‚ã†\r\n\r\nç–²ã‚ŒãŸã®ã§å…¨ã‚«ãƒƒãƒˆã§ã€‚  \r\næ³¨æ„ç‚¹ã¨ã—ã¦ã¯ã€`Tracks > Track`ã§éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯ã‚’è¿½åŠ ã™ã‚‹å ´åˆã€`AudioTrack`ã®`Sampling frequency`ãŒ`Float`ãªã®ã§æ³¨æ„ã—ã¦ä¸‹ã•ã„ã€‚  \r\nKotlinãªã‚‰`Int.toBits()`ã‚’å‘¼ã³å‡ºã™ã ã‘ã‹ã‚‚ï¼Ÿ`// TODO`ã°ã£ã‹ã§ä½¿ãˆãŸã‚‚ã‚“ã˜ã‚ƒãªã„ãª\r\n\r\n```kotlin\r\n/*\r\n * Kotlinã®ã‚·ãƒ•ãƒˆæ¼”ç®—å­\r\n * [shl] <<\r\n * [shr] >>\r\n */\r\n\r\n/** ã‚µã‚¤ã‚ºãŒä¸æ˜ */\r\nprivate val UNKNOWN_SIZE = byteArrayOf(0x01, 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte(), 0xFF.toByte())\r\n\r\n/** TrackType ãŒ Video */\r\nprivate const val VIDEO_TRACK_TYPE = 1\r\n\r\n/** TrackType ãŒ Audio */\r\nprivate const val AUDIO_TRACK_TYPE = 2\r\n\r\n/** ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ãªã‚‰ */\r\nprivate const val SIMPLE_BLOCK_FLAGS_KEYFRAME = 0x80\r\n\r\n/** ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã˜ã‚ƒãªã„ */\r\nprivate const val SIMPLE_BLOCK_FLAGS = 0x00\r\n\r\n/** WebMãƒ©ã‚¤ã‚¿ãƒ¼ */\r\n\r\nfun main() {\r\n    val ebmlHeader = createEbmlHeader()\r\n\r\n    val info = createInfo()\r\n    val tracks = createTracks()\r\n    val cluster = createStreamingCluster()\r\n    val segment = MatroskaBuildElement(MatroskaTags.Segment, info.concat() + tracks.concat() + cluster.concat())\r\n\r\n    // EBML Header + Segment æ›¸ãè¾¼ã¿\r\n    File(\"empty.webm\").apply {\r\n        appendBytes(ebmlHeader.concat())\r\n        appendBytes(segment.concat())\r\n    }\r\n}\r\n\r\n/** EBMLãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ä½œæˆã™ã‚‹ */\r\nprivate fun createEbmlHeader(): MatroskaBuildElement {\r\n    // WebMãƒ•ã‚¡ã‚¤ãƒ«ã®å…ˆé ­ã«ã‚ã‚‹ EBML Header ã‚’ä½œã‚‹\r\n    // å­è¦ç´ ã‚’ä½œæˆã™ã‚‹\r\n    val ebmlVersion = MatroskaBuildElement(MatroskaTags.EBMLVersion, byteArrayOf(0x01))\r\n    val readVersion = MatroskaBuildElement(MatroskaTags.EBMLReadVersion, byteArrayOf(0x01))\r\n    val maxIdLength = MatroskaBuildElement(MatroskaTags.EBMLMaxIDLength, byteArrayOf(0x04))\r\n    val maxSizeLength = MatroskaBuildElement(MatroskaTags.EBMLMaxSizeLength, byteArrayOf(0x08))\r\n    val docType = MatroskaBuildElement(MatroskaTags.DocType, \"webm\".toAscii())\r\n    val docTypeVersion = MatroskaBuildElement(MatroskaTags.DocTypeVersion, byteArrayOf(0x02))\r\n    val docTypeReadVersion = MatroskaBuildElement(MatroskaTags.DocTypeReadVersion, byteArrayOf(0x02))\r\n\r\n    // EBML Header è¦ç´ \r\n    val children = ebmlVersion.concat() + readVersion.concat() + maxIdLength.concat() + maxSizeLength.concat() + docType.concat() + docTypeVersion.concat() + docTypeReadVersion.concat()\r\n    return MatroskaBuildElement(MatroskaTags.EBML, children)\r\n}\r\n\r\n/** Infoã‚’ä½œæˆã™ã‚‹ */\r\nprivate fun createInfo(): MatroskaBuildElement {\r\n    val timestampScale = MatroskaBuildElement(MatroskaTags.TimestampScale, 1_000_000.to4ByteArray())\r\n    val multiplexingAppName = MatroskaBuildElement(MatroskaTags.MuxingApp, \"ZeroWebM\".toAscii())\r\n    val writingAppName = MatroskaBuildElement(MatroskaTags.WritingApp, \"ZeroWebM\".toAscii())\r\n    val children = timestampScale.concat() + multiplexingAppName.concat() + writingAppName.concat()\r\n    return MatroskaBuildElement(MatroskaTags.Info, children)\r\n}\r\n\r\n/** Trackè¦ç´ ã‚’ä½œæˆã™ã‚‹ */\r\nprivate fun createTracks(\r\n    videoTrackId: Int = 1,\r\n    videoCodec: String = \"V_VP9\",\r\n    videoWidth: Int = 1280,\r\n    videoHeight: Int = 720,\r\n    audioTrackId: Int = 2,\r\n    audioCodec: String = \"O_OPUS\",\r\n    audioSamplingRate: Float = 48_000.0f, // Floatãªã®ï¼ï¼Ÿ\r\n    audioChannelCount: Int = 2,\r\n): MatroskaBuildElement {\r\n\r\n    // å‹•ç”»ãƒˆãƒ©ãƒƒã‚¯æƒ…å ±\r\n    val videoTrackNumber = MatroskaBuildElement(MatroskaTags.TrackNumber, videoTrackId.toByteArray())\r\n    val videoTrackUid = MatroskaBuildElement(MatroskaTags.TrackUID, videoTrackId.toByteArray())\r\n    val videoCodecId = MatroskaBuildElement(MatroskaTags.CodecID, videoCodec.toAscii())\r\n    val videoTrackType = MatroskaBuildElement(MatroskaTags.TrackType, VIDEO_TRACK_TYPE.toByteArray())\r\n    val pixelWidth = MatroskaBuildElement(MatroskaTags.PixelWidth, videoWidth.toByteArray())\r\n    val pixelHeight = MatroskaBuildElement(MatroskaTags.PixelHeight, videoHeight.toByteArray())\r\n    val videoTrack = MatroskaBuildElement(MatroskaTags.VideoTrack, pixelWidth.concat() + pixelHeight.concat())\r\n    val videoTrackEntryChildren = videoTrackNumber.concat() + videoTrackUid.concat() + videoCodecId.concat() + videoTrackType.concat() + videoTrack.concat()\r\n    val videoTrackEntry = MatroskaBuildElement(MatroskaTags.Track, videoTrackEntryChildren)\r\n\r\n    // éŸ³å£°ãƒˆãƒ©ãƒƒã‚¯æƒ…å ±\r\n    val audioTrackNumber = MatroskaBuildElement(MatroskaTags.TrackNumber, audioTrackId.toByteArray())\r\n    val audioTrackUid = MatroskaBuildElement(MatroskaTags.TrackUID, audioTrackId.toByteArray())\r\n    val audioCodecId = MatroskaBuildElement(MatroskaTags.CodecID, audioCodec.toAscii())\r\n    val audioTrackType = MatroskaBuildElement(MatroskaTags.TrackType, AUDIO_TRACK_TYPE.toByteArray())\r\n    // Segment > Tracks > Audio ã® CodecPrivate ã«å…¥ã‚Œã‚‹ä¸­èº«\r\n    // OpusHeaderã‚’ã¤ãã‚‹\r\n    // https://www.rfc-editor.org/rfc/rfc7845\r\n    // Version = 0x01\r\n    // Channel Count = 0x02\r\n    // Pre-Skip = 0x00 0x00\r\n    // Input Sample Rate ( little endian ) 0x80 0xBB 0x00 0x00 . Kotlin ã¯ Big endian ãªã®ã§åè»¢ã™ã‚‹\r\n    // Output Gain 0x00 0x00\r\n    // Mapping Family 0x00\r\n    // ??? 0x00 0x00\r\n    val opusHeader = \"OpusHead\".toAscii() + byteArrayOf(1.toByte()) + byteArrayOf(audioChannelCount.toByte()) + byteArrayOf(0x00.toByte(), 0x00.toByte()) + audioSamplingRate.toInt().toByteArray().reversed() + byteArrayOf(0x00.toByte(), 0x00.toByte(), 0x00.toByte(), 0x00.toByte(), 0x00.toByte())\r\n    val codecPrivate = MatroskaBuildElement(MatroskaTags.CodecPrivate, opusHeader)\r\n    // Float ã‚’ ByteArray ã«ã™ã‚‹ã«ã¯ã²ã¨æ‰‹é–“å¿…è¦\r\n    val sampleFrequency = MatroskaBuildElement(MatroskaTags.SamplingFrequency, audioSamplingRate.toBits().to4ByteArray())\r\n    val channels = MatroskaBuildElement(MatroskaTags.Channels, audioChannelCount.toByteArray())\r\n    val audioTrack = MatroskaBuildElement(MatroskaTags.AudioTrack, channels.concat() + sampleFrequency.concat())\r\n    val audioTrackEntryValue = audioTrackNumber.concat() + audioTrackUid.concat() + audioCodecId.concat() + audioTrackType.concat() + codecPrivate.concat() + audioTrack.concat()\r\n    val audioTrackEntry = MatroskaBuildElement(MatroskaTags.Track, audioTrackEntryValue)\r\n\r\n    // Tracks ã‚’ä½œã‚‹\r\n    return MatroskaBuildElement(MatroskaTags.Tracks, videoTrackEntry.concat() + audioTrackEntry.concat())\r\n}\r\n\r\n/**\r\n * Clusterã®ä¸­ã«å…¥ã‚Œã‚‹SimpleBlockã‚’ä½œã‚‹\r\n *\r\n * @param trackNumber ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ã€æ˜ åƒãªã®ã‹éŸ³å£°ãªã®ã‹\r\n * @param simpleBlockTimescale ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿ã®æ™‚é–“\r\n * @param byteArray ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã•ã‚ŒãŸãƒ‡ãƒ¼ã‚¿\r\n * @param isKeyFrame ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã®å ´åˆã¯ true\r\n */\r\nprivate fun createSimpleBlock(\r\n    trackNumber: Int,\r\n    simpleBlockTimescale: Int,\r\n    byteArray: ByteArray,\r\n    isKeyFrame: Boolean,\r\n): MatroskaBuildElement {\r\n    val vIntTrackNumberBytes = trackNumber.toVInt()\r\n    val simpleBlockBytes = simpleBlockTimescale.toByteArray()\r\n    // flagsã€‚ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã©ã†ã‹ãã‚‰ã„ã—ã‹å…¥ã‚Œã‚‹ã“ã¨ãªã•ãã†\r\n    val flagsBytes = byteArrayOf((if (isKeyFrame) SIMPLE_BLOCK_FLAGS_KEYFRAME else SIMPLE_BLOCK_FLAGS).toByte())\r\n    // ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã—ãŸãƒ‡ãƒ¼ã‚¿ã®å…ˆé ­ã«ã€\r\n    // ãƒˆãƒ©ãƒƒã‚¯ç•ªå·ã€æ™‚é–“ã€ã‚­ãƒ¼ãƒ•ãƒ¬ãƒ¼ãƒ ã‹ã©ã†ã‹ ã‚’ä»˜ã‘åŠ ãˆã‚‹\r\n    val simpleBlockValue = vIntTrackNumberBytes + simpleBlockBytes + flagsBytes + byteArray\r\n\r\n    return MatroskaBuildElement(MatroskaTags.SimpleBlock, simpleBlockValue)\r\n}\r\n\r\n/**\r\n * ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°å¯èƒ½ãª Cluster ã‚’ä½œæˆã™ã‚‹ã€‚\r\n * ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚ºãŒä¸å®šã«ãªã£ã¦ã„ã‚‹ã€‚\r\n *\r\n * @param timescaleMs é–‹å§‹æ™‚é–“ã€‚ãƒŸãƒªç§’\r\n */\r\nprivate fun createStreamingCluster(timescaleMs: Int = 0): MatroskaBuildElement {\r\n    val timescaleBytes = timescaleMs.to4ByteArray()\r\n    val timescale = MatroskaBuildElement(MatroskaTags.Timestamp, timescaleBytes)\r\n    val clusterValue = timescale.concat()\r\n\r\n    return MatroskaBuildElement(MatroskaTags.Cluster, clusterValue, UNKNOWN_SIZE)\r\n}\r\n\r\n/** æ•°å€¤ã‚’ V_INT ã§ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ã™ã‚‹ */\r\nprivate fun Int.toVInt(): ByteArray {\r\n    val valueByteArray = this.toByteArray()\r\n    val valueSize = when (valueByteArray.size) {\r\n        1 -> 0b1000_0000\r\n        2 -> 0b0100_0000\r\n        3 -> 0b0010_0000\r\n        4 -> 0b0001_0000\r\n        5 -> 0b0000_1000\r\n        6 -> 0b0000_0100\r\n        7 -> 0b0000_0010\r\n        else -> 0b0000_0001\r\n    }\r\n    return valueByteArray.apply {\r\n        // TODO ã“ã‚Œã ã¨å¤šåˆ†ã‚ˆããªã„ï¼ˆç«‹ã¦ãŸã„ä½ç½®ã«ã™ã§ã« 1 ãŒç«‹ã£ã¦ã„ã‚‹å ´åˆã«æ•°å€¤ãŒãŠã‹ã—ããªã‚‹ï¼‰\r\n        this[0] = (valueSize or this[0].toInt()).toByte()\r\n    }\r\n}\r\n\r\n/** æ–‡å­—åˆ—ã‚’ ASCII ã®ãƒã‚¤ãƒˆé…åˆ—ã«å¤‰æ›ã™ã‚‹ */\r\nprivate fun String.toAscii() = this.toByteArray(charset = Charsets.US_ASCII)\r\n\r\n/** [Int]ã‚’[ByteArray]ã«å¤‰æ›ã™ã‚‹ã€‚2ãƒã‚¤ãƒˆ */\r\nprivate fun Int.toByteArray() = byteArrayOf(\r\n    (this shr 8).toByte(),\r\n    this.toByte(),\r\n)\r\n\r\n/** [Int]ã‚’[ByteArray]ã«å¤‰æ›ã™ã‚‹ã€‚4ãƒã‚¤ãƒˆ */\r\nprivate fun Int.to4ByteArray() = byteArrayOf(\r\n    (this shr 24).toByte(),\r\n    (this shr 16).toByte(),\r\n    (this shr 8).toByte(),\r\n    this.toByte(),\r\n)\r\n```\r\n\r\nã¾ãå‹•ã„ã¦ã„ã‚‹ã®ã§ãƒ¨ã‚·ï¼  \r\n`writing app`å¥½ããªæ–‡å­—åˆ—ã«ã§ãã‚‹ã®ã„ã„ãªï¼ˆã™ã”ãã©ã†ã§ã‚‚ã„ã„ï¼‰\r\n\r\n![Imgur](https://imgur.com/Od6yGsP.png)\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nå†æ²\r\n\r\nhttps://github.com/takusan23/ZeroWebM\r\n\r\n# ãŠã‚ã‚Šã«\r\nPixel Watch ã¯ã‚ˆæ¥ã„ï¼ï¼ï¼ï¼  \r\ndocomoã§ã‚‚ã‚»ãƒ«ãƒ©ãƒ¼é€šä¿¡ã§ããŸã‚‰ WearOS ã§ã‚‚LTEãƒãƒ³ãƒ‰å–å¾—ã§ãã‚‹ã®ã‹è©¦ã—ã¦ã¿ãŸã‹ã£ãŸã‚“ã ã‘ã©ãªã€ã€ã€\r\n\r\nKotlinã®ä¾¿åˆ©æ©Ÿèƒ½ã°ã£ã‹ã‚Šä½¿ã£ãŸã®ã§ã‚ã‚“ã¾ã‚Šå‚è€ƒã«ãªã‚‰ãªãã†ã€‚  \r\n\r\n# å‚è€ƒã«ã—ã¾ã—ãŸ\r\nãŸã™ã‹ã‚Šã¾ã™ï¼ï¼ï¼\r\n\r\n- https://www.slideshare.net/mganeko/inside-webm\r\n- https://www.slideshare.net/mganeko/media-recorder-and-webm\r\n- https://qiita.com/ryiwamoto/items/0ff451da6ab76b4f4064\r\n- https://qiita.com/legokichi/items/83871e1f034331222fd2\r\n- https://scrapbox.io/unarist/MediaRecorderAPIã§ä½œã£ãŸwebmã‚’seekableã«ã—ãŸã„"},{"title":"Windows 11ã§ç”Ÿã¾ã‚Œå¤‰ã‚ã£ãŸMicrosoft Storeã«å¾“æ¥(WPF/Win32)ã®ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã—ã¦ã¿ãŸè©±","link":"/posts/windows_11_win32_app_publish_ms_store/","markdown":"\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \nD.C.4 Plus Harmony ï½ãƒ€ãƒ»ã‚«ãƒ¼ãƒ4ï½ ãƒ—ãƒ©ã‚¹ãƒãƒ¼ãƒ¢ãƒ‹ãƒ¼ æ”»ç•¥ã—ã¾ã—ãŸã€‚ã¡ã‚ˆå­ã¡ã‚ƒã‚“ã‹ã‚ã„ã„ã‹ã£ãŸã§ã™ã€‚ãœã²æœ¬æ ¡Verã®åˆ¶æœå§¿ã‚’...ï¼\n\n![Imgur](https://imgur.com/7qdoxiM.png)\n\nã“ã®å­ã®å€‹åˆ¥ãƒ«ãƒ¼ãƒˆçŸ­ã‹ã£ãŸæ°—ãŒã™ã‚‹ã‚“ã ã‘ã©å¤šåˆ†æ°—ã®ã›ã„ã ã‚ˆã­ã€‚ãã£ã¨æ™‚é–“ãŒã™ãã‚‹ã®ãŒæ—©ã‹ã£ãŸã ã‘ã‚„ ~~ï¼ˆã‚µãƒ–ãƒ’ãƒ­ã‚¤ãƒ³ã ã‹ã‚‰ã¨ã‹è¨€ã‚ãªã„ï¼‰~~\n\n![Imgur](https://imgur.com/VovF7Lj.png)\n\nâ†‘é«ªã®æ¯›ãŠã‚ã—ã¦ã‚‹ã®ã‹ã‚ã„ã„\n\nã¡ãªã¿ã«ã“ã®å­ã€`ç”Ÿä¸»`ãªã‚“ã§ã™ã­ã€‚`é…ä¿¡è€…`ã˜ã‚ƒãªãã¦`ç”Ÿä¸»`ã£ã¦è¡¨ç¾ã—ã¦ã‚‹ã€‚è³¼å…¥æ±ºå®šã§ã¯ï¼Ÿ  \n\n![Imgur](https://imgur.com/eeRt9fl.png)\n\nã‚ã¨ã—ã„ã—ã„å…ˆè¼©ãƒ«ãƒ¼ãƒˆã‚‚è‰¯ã‹ã£ãŸã§ã™ã€‚ãƒªãƒ¼ãƒ‰ã•ã‚Œã¦ãˆãªã‚ç§ã‚‚ãªã‚\n\n![Imgur](https://imgur.com/VMQ4WAU.png)\n\nâ†‘ã“ã®ãƒœã‚¤ã‚¹ã»ã‚“ã¨ã™ã\n\nã¡ãªã¿ã«éå»ä½œã¯ã‚„ã£ã¦ãªã„ã§ã™ï¼ˆç›´æ¥çš„ã«ã¯ç¹‹ãŒã£ã¦ãªã„ã£ã¦å™‚ã ã£ãŸã‹ã‚‰äºˆç´„ã—ãŸï¼‰ã€‚ã‚„ã£ã¦ãªã„ã‘ã©éå»ä½œã®CDã ã‘è²·ã£ãŸã€‚  \nWindowsã¯ã¾ã¨ã‚‚ãªéŸ³æ¥½ã‚¢ãƒ—ãƒªä½œã£ã¦ãã‚Œã€‚\n\n![Imgur](https://imgur.com/bfuXRTl.png)\n\nä»Šä½œã®`æ‹ã™ã‚‹MODE`ã¨ã‹åæ›²ãªã®ã§CDæ¬²ã—ã„ãªã¨æ€ã£ãŸã‚“ã ã‘ã©ã€å…¨å¹´é½¢ç‰ˆã®ç¶šç·¨ï¼ˆã—ã‹ã‚‚ãŠé«˜ã„è±ªè¯ç‰ˆï¼‰ã«ã—ã‹ã¤ã„ã¦ãªã„ã£ã½ã„ã­ï¼Ÿã€‚CIRCUSã ã‹ã‚‰å¤šåˆ†ç¶šç·¨ã‚‚R18ç‰ˆã§å‡ºã‚‹ã‚“ã ã‚ã†ã—ãã®ã¨ãã«æœŸå¾…ã—ã¦ã‚‚ã„ã„ã‚“ã ã‘ã©ãã†ã™ã£ã‹ãªãƒ¼\n\n# æœ¬é¡Œ\nWindows 11ã§ç”Ÿã¾ã‚Œå¤‰ã‚ã£ãŸMicrosoft Storeã«WPFã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã—ã¾ã™ã€‚\n\n## Windows 11\nWindows 11ãŠã‚ã§ã¨ã†ã”ã–ã„ã¾ã™ã€‚  \nã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã®è§’ãŒä¸¸ããªã£ãŸã‚Šã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒœã‚¿ãƒ³ãŒçœŸã‚“ä¸­ã«ç§»å‹•ã—ãŸã‚Šï¼ˆå¤‰æ›´å¯èƒ½ï¼‰ã€ãã‚‚ãã‚‚ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ãŒã‚·ãƒ³ãƒ—ãƒ«ã«ãªã£ãŸã‚Šã—ã¾ã—ãŸã€‚  \nå€‹äººçš„ã«ã¯Windows 10ã®ã‚¿ã‚¤ãƒ«ã§ã‚°ãƒ«ãƒ¼ãƒ—åˆ†ã‘ã—ã¦ãŸã®ã§ãã‚ŒãŒä½¿ãˆãªã„ã®ã¯ã¡ã‚‡ã£ã¨å›°ã£ãŸï¼Ÿï¼ˆã¾ãé–‹ç™ºã§ä½¿ã£ã¦ã‚‹PCã¯ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã®ç©ºããŒãªã„ï¼ˆãã‚Œä»¥å¤–ã¯æº€ãŸã—ã¦ã‚‹ï¼‰ã®ã§å½“åˆ†ã¯Win11ã«ã—ãªã„ã¨æ€ã†ã€‚ï¼‰  \n\n![Imgur](https://imgur.com/VllzUu6.png)\n\nã¤ã„ã«ã‚¿ã‚¹ã‚¯ãƒãƒ¼ã®DeskBand APIãŒã¤ã„ã«å»ƒæ­¢ï¼Ÿã«ãªã£ãŸã®ã§ã€BatteryBarã¨ã‹ä½¿ã£ã¦ã‚‹æ–¹ã¯å›°ã‚‹ã‹ã‚‚ã€‚  \nã‚¿ã‚¹ã‚¯ãƒãƒ¼ã«PCæƒ…å ±ã‚’è¡¨ç¤ºã™ã‚‹`zhongyang219/TrafficMonitor`ã£ã¦ã®ãŒã‚ã‚‹ã‘ã©ã‚ã‚Œã¯å¯¾å¿œæ¸ˆã¿ã®æ¨¡æ§˜ã€‚C++ã¨ã‹MFCã®çŸ¥è­˜ãŒç„¡ã„ã®ã§å‹•ã„ã¦ã‚‹ç†ç”±ã¯ã‚ã‹ã‚‰ã‚“ã‹ã£ãŸã€‚ã‘ã©ã‚ã‚Œå¤šåˆ†DeskBand APIä½¿ã£ã¦ãªã•ãã†ã€‚\n\nã¡ãªã¿ã«Windows 10ã«ã‚ã£ãŸéš ã—ãƒ†ãƒ¼ãƒ`Aero Lite`ã€Windows 11ã«ã‚‚ã‚ã‚Šã¾ã—ãŸã€‚ã‚„ã£ã±é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã¯èµ¤ããªã„ã¨ã­ï¼  \n\n![Imgur](https://imgur.com/NIVge7P.png)\n\nã‚ã¨ãªã‚“ã‹å•é¡Œã«ãªã£ã¦ãŸ`TPM 2.0`ãŒå¿…é ˆã‚‚ãªã‚“ã‹å…¬å¼ãŒãƒã‚¤ãƒ‘ã‚¹æ‰‹æ®µã‚’å…¬é–‹ã—ã¦ã‚‹ã¿ãŸã„ã§ã™ã­ã€‚  \nã‚ã¨ã§ã‚„ã£ã¦ã¿ã‚ˆã†ã‹ãªã€‚\n\n## ç”Ÿã¾ã‚Œå¤‰ã‚ã£ãŸ Microsoft Store\nã‚¤ãƒã‚¤ãƒæµè¡Œã‚‰ãªã‹ã£ãŸMS StoreãŒãƒªãƒ‹ãƒ¥ãƒ¼ã‚¢ãƒ«ã—ã¾ã—ãŸã€‚  \nã“ã‚Œã‹ã‚‰ã¯`UWPï¼ˆMSIXå½¢å¼ï¼‰`ã®ä»–ã«`Win32ï¼ˆMSI / EXE å½¢å¼ï¼‰`ãŒå…¬é–‹ã§ãã¾ã™ã€‚  \n\n# ä»Šå›ä½œã£ãŸã‚¢ãƒ—ãƒª\n\n- Microsoft Storeã®ãƒªãƒ³ã‚¯\n    - Windows 11ä»¥é™ã˜ã‚ƒãªã„ã¨é–‹ã‘ã¾ã›ã‚“\n    - <a href=\"ms-windows-store://pdp/?productid=XP8BZ1XV93S6X1\">ms-windows-store://pdp/?productid=XP8BZ1XV93S6X1</a>\n- winget\n    - wingetã€Microsoft Storeã®ã‚¢ãƒ—ãƒªã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã£ã½ã„ï¼Ÿ\n    - ã“ã‚Œãªã‚‰Windows 10ã§ã‚‚ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹\n    - `winget install ã„ãŸã‹ãƒ¼ãã‚‹`\n- ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\n    - https://github.com/takusan23/ItaCursor\n\n\nç–‘ä¼¼ã‚«ãƒ¼ã‚½ãƒ«ã¨ç–‘ä¼¼ãƒˆãƒ©ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã‚’è¿½åŠ ã—ã¦ã€ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆã§ã‚‚ãƒã‚¦ã‚¹æ“ä½œã£ã½ã„ã®ãŒã§ãã‚‹ã‚¢ãƒ—ãƒªã€‚`WPFã¨.NET 5`ã§å‡ºæ¥ã¦ã¾ã™ã€‚  \nå¾®å¦™ã«ä½¿ã„ã«ãã„ã€‚  \n**Windows 11ã‹ã‚‰ä»®æƒ³ãƒˆãƒ©ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ãŒè¿½åŠ ã•ã‚ŒãŸã®ã§ã‚ã–ã‚ã–å…¥ã‚Œã‚‹å¿…è¦ã¯ãªã„ã¨æ€ã„ã¾ã™ã€‚**  \nãŠã¾ã‘ã¨ã—ã¦éŸ³é‡ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ã¨ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆãƒœã‚¿ãƒ³ã‚’è¿½åŠ ã—ã¾ã—ãŸã€‚\n\n![Imgur](https://imgur.com/FpFLBXC.png)\n\nâ†‘ã¡ãªã¿ã«Windowsã‚¿ãƒ–ãƒ¬ãƒƒãƒˆè²·ã£ãŸã€‚\n\nã“ã®ã‚¢ãƒ—ãƒªã‚’ä½œã£ãŸã¨ãã«å¤§å¤‰ã ã£ãŸè©±ã¨ã‹ãã‚‚ãã‚‚ã®ä»•çµ„ã¿ãªã‚“ã‹ã‚’ãã®ã†ã¡æ›¸ããŸã„ã¨æ€ã„ã¾ã™ã€‚\n\n# WPFãªã©ã®å¾“æ¥ã®ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹ã¾ã§\nã¾ãšé–‹ç™ºè€…ç™»éŒ²ãŒå¿…è¦ã§ã™ã€‚**ã‚¯ãƒ¬ã‚«**ã§19ãƒ‰ãƒ«æ‰•ã†å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ä¸€å›æ‰•ãˆã°ã„ã„ã§ã™ã€‚  \n**ã‚¯ãƒ¬ã‚«**ã˜ã‚ƒãªã„ã¨ã ã‚ã£ã¦MSã¯è¨€ã£ã¦ã‚‹ã‚“ã§ã™ãŒã€ãªã‚“ã‹Kyash Cardã§é€šã‚Šã¾ã—ãŸã€‚ã¡ã‚‡ã£ã¨å‰ã«`Kyash Card`é™å®šã§ã‚µãƒ–ã‚¹ã‚¯ã®æ”¯æ‰•ã„ã«ä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ãŸã£ã½ã„ã‹ã‚‰ãã‚Œã‹ã‚‚ï¼Ÿ  \nã‚ã¨ä»Šè¦‹ãŸã‚“ã§ã™ã‘ã©ãªã‚“ã‹å††å®‰ã§ã™ã­ã€‚  \n\nç™»éŒ²ãŒæ¸ˆã‚“ã ã‚‰ã€Win32ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã§ãã‚‹ã‚ˆã†ã«ç”³è«‹ã‚’ã—ã¾ã™ã€‚  \nç¾çŠ¶ã€Win32ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹æ©Ÿèƒ½ã¯ä¸€èˆ¬ã«é–‹æ”¾ã•ã¦ã„ã‚‹ã‚ã‘ã§ã¯ãªããƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšã§ã™ã€‚ï¼ˆ2021/10/12æ®µéšï¼‰  \nãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼æ®µéšãªã®ã§ã™ãŒã€ç”³è«‹ã‚’ã™ã‚Œã°Win32ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹æ¨©é™ã‚’è²°ãˆã¾ã™ã€‚\n\nç”³è«‹ãŒé€šã£ãŸã‚‰ã€å…¬é–‹ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚å¤šåˆ†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ã¿ãŒç™»éŒ²ã§ãã¾ã™ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ä¸è¦ã®ã‚¿ãƒ–ãƒ«ã‚¯ãƒªãƒƒã‚¯ã§èµ·å‹•ã™ã‚‹ã‚¢ãƒ—ãƒªã¯ç„¡ç†ï¼Ÿï¼‰  \n\n# é–‹ç™ºè€…ç™»éŒ²\nhttps://developer.microsoft.com/ja-jp/microsoft-store/register/\n\n19ãƒ‰ãƒ«æ‰•ã„ã¾ã™ã€‚ã‚¯ãƒ¬ã‚«æŒã£ã¦ãªã„äººã¯ã©ã†ã™ã‚Œã°ã„ã„ã‚“ã ã‚ã€‚ç§ã®å ´åˆã¯`Kyash Card`ãŒä½•æ•…ã‹é€šã£ãŸã€‚\n\n![Imgur](https://imgur.com/v6hnFJt.png)\n\n# Win32ã‚¢ãƒ—ãƒªã®å…¬é–‹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã«ç”³è«‹ã™ã‚‹\nã“ã£ã‹ã‚‰ã§ã™ã€‚  \n\nhttps://aka.ms/storepreviewwaitlist\n\nç§ã¯ 9/27 ã«ç”³ã—è¾¼ã‚“ã§ã€10/7 ã«é€šã‚Šã¾ã—ãŸã€‚  \nãªã‚“ã‹`CrystalDiskInfo`ã®é–‹ç™ºè€…ãŒ2ãƒ¶æœˆå¾…ã£ãŸã¨ã‹è¨€ã£ã¦ã¦è¦šæ‚Ÿã—ã¦ãŸã‘ã©ãã†ã§ã‚‚ãªã‹ã£ãŸã€‚  \nhttps://youtu.be/0Oks2zpolGU?t=8299\n\nè³ªå•å†…å®¹ã§ã™ãŒã€ãã‚“ãªé›£ã—ããªã„ã§ã™ã€‚  \nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ã©ã£ã‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆä¸Šã«å…¬é–‹ã—ã¦ï¼ˆä»Šå›ã¯GitHubã®Releaseï¼‰ã€ç¿»è¨³ç‰‡æ‰‹ã«ã‚Œã£ã¤ã”ãƒ¼\n\n- What is your Seller ID in Partner Center? \n    - https://partner.microsoft.com/ja-jp/dashboard/account/v3/organization/legalinfo#developer\n    - æ³•çš„æƒ…å ± -> è²©å£²è€…IDã®éƒ¨åˆ†ã‚’å…¥ã‚Œã‚Œã°ã„ã„ã§ã™\n- What is the app name that you want to reserve and bring to Store?\n    - ã‚¢ãƒ—ãƒªå\n- Does this app replace an existing app in Store?\n    - æ—¢ã«å…¬é–‹ã—ã¦ã‚‹ã‚¢ãƒ—ãƒªã‚’ç½®ãæ›ãˆã‚‹ã‹ã€‚ç½®ãã‹ãˆãªã„ã®ã§ No\n- Please provide email address of the person responsible for submitting the traditional desktop app. \n    - ãƒ¡ã‚¢ãƒ‰\n- Choose the package type of your app.\n    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®å½¢å¼ã€‚msiã§\n- Provide HTTPS-based URL pointing to your downloadable Windows installer binary. \n    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å…¬é–‹ã™ã‚‹URLã€‚ä»Šå›ã¯GitHubã®Releaseã«ç½®ã„ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®URLã‚’å…¥ã‚Œã¾ã—ãŸã€‚\n    - ä¾‹ï¼š`https://github.com/takusan23/ItaCursor/releases/download/1.0.0/ItaCursorInstaller.msi`\n- A versioned URL is required at the time of submission of your application to Store. Will you be able to provide it?\n    - ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã”ã¨ã®URLã‚’ç”¨æ„ã§ãã‚‹ã‹ï¼Ÿã£ã¦ã“ã¨ï¼Ÿã€‚ä»Šå›ã¯è¡Œã‘ã‚‹ã®ã§Yesã§\n- Does the above URL support unauthenticated (anonymous) download of installer binary?\n    - ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«èªè¨¼ï¼ˆåˆ¶é™ï¼Ÿï¼‰ã‚’ã‹ã‘ã¦ãªã„ï¼ˆä¼šå“¡é™å®šã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ï¼ã¿ãŸã„ãªã“ã¨ã ã¨æ€ã†ï¼‰ã‹ã©ã†ã‹ï¼Ÿ\n- Is your app binary signed with a certificate?\n    - ç½²åã—ã¦ãªã„ã®ã§No\n- Do you plan to provide standalone installer?\n    - ãŠãã‚‰ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼å˜ä½“ã§å®Œçµã™ã‚‹ã‹èã‹ã‚Œã¦ã¾ã™ã€‚ãã‚Šã‚ƒãã†ã ã‚ã£ã¦æ€ã†ã‚“ã§ã™ãŒã€å¤šåˆ†ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã‹ã‚‰è¿½åŠ ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚Šã™ã‚‹ã“ã¨ãªãå®Œçµã™ã‚‹ã‹èã„ã¦ã¾ã™ã€‚å¤šåˆ†ã­ã€‚\n- Does your app support silent installation experience?\n    - ã‚µã‚¤ãƒ¬ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã‹ã€‚GUIã®è¡¨ç¤ºç„¡ã—ã§ã—ã‚Œã£ã¨ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ãã‚‹ã‹ã£ã¦ã“ã¨ã ã¨ã€‚\n    - `msi`ã®å ´åˆã¯`ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ`ã‚’ä½¿ã„ã€`ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼.msi /passive`ã§ã‚µã‚¤ãƒ¬ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¯èƒ½ãªã®ã§ã€  \n    - `App supports silent install by providing installer parameters`ã‚’é¸ã¶ã€‚ï¼ˆãŸã ã—ç®¡ç†è€…æ¨©é™ï¼ˆUACï¼‰ã‚’æ±‚ã‚ã‚‰ã‚Œã‚‹ï¼‰\n- Does your app have any dependency on non-Microsoft drivers or NT services?\n    - MicorosftãŒèªã‚ã¦ãªã„ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¨ã‹ã‚’ä½¿ã£ã¦ã„ã‚‹ã‹ã€‚ä½¿ã£ã¦ãªã„ã‹ã‚‰`No`\n- Let us know the reasons for above dependency on non-Microsoft drivers or NT services if applicable.\n    - ã•ã£ãã®è³ªå•ã§Yesç­”ãˆãŸå ´åˆã¯ä½•ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã‹æ›¸ã\n- Does your install package include any bundleware? \n    - è¿½åŠ ã®ã‚¢ãƒ—ãƒªãŒå«ã¾ã‚Œã¦ã„ã‚‹ã‹ï¼Ÿã©ã‚†ã“ã¨ï¼Ÿå¤šåˆ†No\n- What is the total size of your app install package binary?\n    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ã‚µã‚¤ã‚ºã‚’ç­”ãˆã‚‹\n\n# å¯©æŸ»ãŒé€šã‚‹ã¨ï¼Ÿ\n`Microsoft Store Preview program`ã¿ãŸã„ãªä»¶åã®ãƒ¡ãƒ¼ãƒ«ãŒæ¥ã¾ã™ã€‚  \nå…¬é–‹ãƒšãƒ¼ã‚¸ã‹ã‚‰`EXE ã¾ãŸã¯ MSI ã‚¢ãƒ—ãƒª`ãŒé¸ã¹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¾ã™ã€‚\n\n![Imgur](https://imgur.com/IWPnvlz.png)\n\n# Win32ã‚¢ãƒ—ãƒªã‚’å…¬é–‹ã™ã‚‹\n\nå¿…è¦ãªã‚‚ã®ã¯\n\n- ã‚¢ã‚¤ã‚³ãƒ³ã®ç”»åƒ\n    - 1080x1080\n- ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ\n    - å¤šåˆ†ã‚µã‚¤ã‚ºã¯è‡ªç”±\n\n## å€¤æ®µã¨å¸‚å ´\nã‚¢ãƒ—ãƒªã®å€¤æ®µã¨é…å¸ƒã™ã‚‹å›½ã‚’æ±ºã‚ã¾ã™ã€‚  \nè¨˜å…¥ãŒçµ‚ã‚ã£ãŸã‚‰ä¿å­˜ã—ã¦æ¬¡ã¸è¡Œãã¾ã™ã€‚å‹æ‰‹ã«ä¿å­˜ã—ã¦ãã‚Œã‚‹ã‚ã‘ã§ã¯ãªã„æ¨¡æ§˜ã€‚\n\n![Imgur](https://imgur.com/KrTOLMN.png)\n\n## ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£\nã‚¢ãƒ—ãƒªã®ã‚«ãƒ†ã‚´ãƒªãªã©\n\n![Imgur](https://imgur.com/KiSIjHa.png)\n\n### ãƒ†ã‚¹ã‚¿ãƒ¼ã«æä¾›ã™ã‚‹æƒ…å ±\n`è£½å“ã®å…¬è¡¨`ã¨`èªå®šã®æ³¨æ„æ›¸ã`ã«ã¯ã€ã‚¢ãƒ—ãƒªã®å‹•ä½œã«å¿…è¦ãªãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã¨ã€å¿…è¦ãªæ¡ä»¶ã‚’æ›¸ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\nã¡ãªã¿ã«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã«ã¯**Microsoft ä»¥å¤–ã®ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã¾ãŸã¯**ã®ã¨ã“ã‚ã«ãƒã‚§ãƒƒã‚¯ãŒå…¥ã£ã¦ã„ã¾ã™ãŒã€ãƒ‰ãƒ©ã‚¤ãƒãƒ¼ã«ä¾å­˜ã—ã¦ãªã„ã®ã§å¤–ã—ã¾ã—ãŸã€‚  \nã“ã®ã‚¢ãƒ—ãƒªã¯ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç«¯æœ«ã¨ã€`.NET 5ä»¥ä¸Š`ãŒå¿…è¦ãªã®ã§ãã†æ›¸ãã¾ã—ãŸã€‚\n\n![Imgur](https://imgur.com/opucXfI.png)\n\nä¸‹ã«ã‚‚`ã‚·ã‚¹ãƒ†ãƒ è¦ä»¶`ã®é …ç›®ãŒã‚ã‚‹ã®ã§ãã“ã§ã‚‚ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãŒå¿…è¦ã«ãƒã‚§ãƒƒã‚¯ <input type=\"checkbox\" checked=\"true\"/> ã‚’å…¥ã‚Œã¦ãŠãã¾ã™ã€‚\n\n## å¹´é½¢\nGoogle Playã¨ä¼¼ãŸã‚ˆã†ãªã“ã¨ãŒèã‹ã‚Œã¾ã™ã€‚\n\n![Imgur](https://imgur.com/keQEUIU.png)\n\n## ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸\nã“ã“ã§ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’è¨­å®šã—ã¾ã™ã€‚  \nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ä½œæˆã¯å‰æ›¸ã„ã®ã§å‚è€ƒã«ã—ã¦ã­ã€‚â†’[.NET 5ã§å‡ºæ¥ãŸWPFã‚¢ãƒ—ãƒªã‚’é…å¸ƒã™ã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆã™ã‚‹](/posts/windows_dot_net5_wpf_making_installer/)  \n\n![Imgur](https://imgur.com/0MzXa9d.png)\n\n### ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸URL\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã¯ã€`Microsoft Store`ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã™ã‚‹æ–¹å¼ã§ã¯ãªãã€`ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒªãƒ³ã‚¯`ã‚’é–‹ç™ºè€…ãŒç”¨æ„ã™ã‚‹å½¢ã«ãªã£ã¦ã¾ã™ã€‚    \n`Windows 11`ã¯`64ãƒ“ãƒƒãƒˆ`ã—ã‹ç„¡ã„ã§ã™ãŒã€ã‚¢ãƒ—ãƒªãŒ`32ãƒ“ãƒƒãƒˆç”¨`ã®å ´åˆã®ãŸã‚ã‹`x86`ã‚‚é¸ã¹ã¾ã™ã€‚  \n`msi`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãªã‚‰ã€`/passive`ã‚’ã¤ã‘ã‚‹ã“ã¨ã§ã‚µã‚¤ãƒ¬ãƒ³ãƒˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼GUIãŒå‡ºãªã„ï¼‰ãŒå‡ºæ¥ã¾ã™ã€‚\nãªã®ã§ã€`ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿`ã«`/passive`ã‚’å…¥ã‚Œã¾ã™\n\n![Imgur](https://imgur.com/OvNoC3V.png)\n\nã‚ã¨ãªã‚“ã‹æ—¥æœ¬èªãŒ2ã¤ã‚ã‚‹ã‚“ã ã‘ã©ã€ã‚ˆãã‚ã‹ã‚‰ã‚“ï¼ˆå¤šåˆ†è‹±èªã®`en-us`ã¨åŒã˜æµã‚Œã§`ja-jp`ã‚’ä½œã£ãŸã‚“ã ã¨æ€ã†ã‘ã©ã©ã†ãªã‚“ã ã‚ã†ï¼‰\n\n## ã‚¹ãƒˆã‚¢ã®å…¬é–‹æƒ…å ±\n\n![Imgur](https://imgur.com/1fz1VOj.png)\n\næ›¸ã„ã¦ã„ãã¾ã™ã€‚  \nã‚¢ã‚¤ã‚³ãƒ³ã‚µã‚¤ã‚ºã¯`1080 x 1080`ãªã®ã§æ°—ã‚’ã¤ã‘ã¦ãã ã•ã„ã€‚\n\n![Imgur](https://imgur.com/HNUlAgR.png)\n\n### ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æ¡é …\nã“ã‚Œã¯...ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã¨åŒã˜ã§ã„ã„ã‚“ã‹ãªã€‚\n\n![Imgur](https://imgur.com/sbyUcQe.png)\n\n## ã“ã“ã¾ã§çµ‚ã‚ã‚‹ã¨\nå…¬é–‹ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \nã¨ã„ã†ã‚ã‘ã§å…¬é–‹ãƒãƒãƒƒã¨\n\n![Imgur](https://imgur.com/OygFoG5.png)\n\nã‚ã¨ã¯å¾…ã¤ã ã‘ã€‚æ¥½ã—ã¿ã§ã™ã­\n\n![Imgur](https://imgur.com/K8fa4R7.png)\n\n## ãƒªã‚¸ã‚§ã‚¯ãƒˆï¼ˆå´ä¸‹ã•ã‚ŒãŸï¼‰\nå¯©æŸ»ãŒé€šã£ã¦ã‚‚ã€ãƒªã‚¸ã‚§ã‚¯ãƒˆã•ã‚Œã¦ã‚‚ãƒ¡ãƒ¼ãƒ«ã§é€šçŸ¥ãŒæ¥ã¾ã™ã€‚  \n\n- Win32ã‚¢ãƒ—ãƒªã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã¯ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ï¼ˆå˜ä½“ï¼‰ã§ã€ã‚ªãƒ•ãƒ©ã‚¤ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒå¿…é ˆã§ã™ã‚ˆ\n    - å®Ÿã¯`.NET 5`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å‰ã«`.NET 5`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚’ä¿ƒã™ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’å‡ºã™ã‚ˆã†ã«è¨­å®šã—ã¦ãŸã‚“ã ã‘ã©ã€è¦ç´„ã«ã¯ã€Œ**å¿…è¦ãªãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚‹ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ€ãƒ¼ã§ã‚ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“**ã€ã¨æ›¸ã„ã¦ã‚ã‚Šã¾ã™ã€‚ \n    - ä»•æ–¹ãªã„ã®ã§ã€ã‚¢ãƒ—ãƒªèª¬æ˜æ¬„ã«ã€Œ**.NET 5ã‚’äºˆã‚å…¥ã‚Œã¦ãŠã„ã¦ãã ã•ã„**ã€ã®æ–‡ç« ã‚’å…¥ã‚Œã‚‹ã“ã¨ã§è§£æ±ºã—ã¾ã—ãŸã€‚æœãŸã—ã¦èª­ã‚“ã§ãã‚Œã‚‹ã®ã ã‚ã†ã‹...\n    - `.NET 5`ã«ã¯ã€`.NET 5ã®ãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’å«ã‚ãŸexe`ã‚’åãå‡ºã™æ©Ÿèƒ½ãŒã‚ã‚‹ã‚“ã ã‘ã©ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®ã‚µã‚¤ã‚ºãŒå¤§ãã™ãã¡ã‚ƒã†ã®ã§ã¡ã‚‡ã£ã¨ç„¡ç†ãªã‚“ã ã‚ˆã­ã€‚ç¢ºå®Ÿæ€§ã‚’æ±‚ã‚ã‚‹ãªã‚‰ã“ã‚Œãªã‚“ã ã‘ã©ã•ã€‚\n\nä¿®æ­£ã—ãŸã‚‰å¯©æŸ»é€šã‚Šã¾ã—ãŸã€‚  \nãªã‚“ãªã‚‰`.NET 5`ã‚‚`Microsoft Store`ã§å…¬é–‹ã—ã¦ã»ã—ã„ã€‚ã¦ã‹ãã®æ–¹ãŒè‰¯ããªã„ã§ã™ã‹Microsoftã•ã‚“ã€‚\n\nå¯©æŸ»ãŒé€šã‚‹ã¨`Congratulations! Your submission has passed all tests`ã£ã¦ãƒ¡ãƒ¼ãƒ«ãŒæ¥ã¾ã™ã€‚\n\nã„ã¤ã®é–“ã«ã‹æ¤œç´¢ã§ã‚‚è¦‹ã¤ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¾ã—ãŸã€‚\n\n![Imgur](https://imgur.com/HF2g8tZ.png)\n\n# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦è¦‹ã‚‹\nã¡ãªã¿ã«ã€ç¾çŠ¶ã®Microsoft Storeã§ã¯ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã‹ã©ã†ã‹ã¾ã§ã¯è¦‹ã¦ã„ãªã„ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãŒçµ‚äº†ã—ãŸã‚ã¨ã€å†åº¦ã‚¹ãƒˆã‚¢ã§ã‚¢ãƒ—ãƒªã®è©³ç´°ç”»é¢ã‚’é–‹ãã¨ã¾ãŸ**ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ãƒœã‚¿ãƒ³ãŒæŠ¼ã›ã¾ã™**ã€‚ã“ã‚Œã°ã£ã‹ã‚Šã¯ä»•æ–¹ãªã„ã®ã‹ãªã€‚  \n\n![Imgur](https://imgur.com/ES3yXhJ.png)\n\n# ãªã‚“ã‹ Microsoft Store ä»¥å¤–ã« winget ã‹ã‚‰ã‚‚è½ã¨ã›ã‚‹\n`winget search <ã‚¢ãƒ—ãƒªå>`ã§æ¤œç´¢ã™ã‚‹ã¨è¦‹ã¤ã‹ã‚Šã¾ã™ã€‚  \nå…¬é–‹ç›´å¾Œã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ãŒã€ã“ã‚Œã‚‚ã„ã¤ã®é–“ã«ã‹è¦‹ã¤ã‹ã‚‹ã‚ˆã†ã«ãªã£ã¦ã¾ã—ãŸã€‚\n\n![Imgur](https://imgur.com/Hr15yyH.png)\n\nwingetãªã‚‰`Windows 10`ã§ã‚‚è½ã¨ã›ã¾ã™ã€‚è½ã¨ã›ã‚‹ã‘ã©**ã‚¢ãƒ—ãƒªåãŒæ—¥æœ¬èª**ãªã®ã§å…¥åŠ›ã‚ã‚“ã©ã„\n\n![Imgur](https://imgur.com/6o6xqNK.png)\n\n# çµ‚ã‚ã‚Šã«\nã‚¹ãƒˆã‚¢ã€æµè¡Œã‚‹ã¨ã„ã„ã§ã™ã­ã€‚  \nã‚ã¨Androidã‚¢ãƒ—ãƒªå‹•ä½œæ¥½ã—ã¿ã€‚"},{"title":".NET 5ã§å‡ºæ¥ãŸWPFã‚¢ãƒ—ãƒªã‚’é…å¸ƒã™ã‚‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆã™ã‚‹","link":"/posts/windows_dot_net5_wpf_making_installer/","markdown":"ã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ã‚ˆã‚Šæ„›ã‚’è¾¼ã‚ã¦ APOLLOCRISIS å…¥æ‰‹ã—ãŸã€‚ç®±ãŒäºŒå›ã‚Šãã‚‰ã„å¤§ãã„ãªï¼Ÿ  \r\nä»Šã‚„ã£ã¦ã‚‹ã‚²ãƒ¼ãƒ çµ‚ã‚ã‚‰ã›ãŸã‚‰ã‚„ã‚ŠãŸã„ã§ã™ã€‚\r\n\r\n<blockquote class=\"twitter-tweet\"><p lang=\"ja\" dir=\"ltr\">ã‚¢ã‚¤ãƒ³ã‚·ãƒ¥ã‚¿ã‚¤ãƒ³ã‚ˆã‚Šæ„›ã‚’è¾¼ã‚ã¦ APOLLOCRISIS å…¥æ‰‹ã—ãŸ <a href=\"https://t.co/m6r8Jop7Ae\">pic.twitter.com/m6r8Jop7Ae</a></p>&mdash; ãŸãã•ã‚“ (@takusan__23) <a href=\"https://twitter.com/takusan__23/status/1442148489471819783?ref_src=twsrc%5Etfw\">September 26, 2021</a></blockquote> <script async src=\"https://platform.twitter.com/widgets.js\" charset=\"utf-8\"></script>\r\n\r\n# æœ¬é¡Œ\r\nWPFãªã‚¢ãƒ—ãƒªã®é…å¸ƒç”¨ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½œæˆã—ã¾ã™ã€‚  \r\n\r\n## ãªãœï¼Ÿ\r\nããŸã‚‹Windows11ã® Microsoft Store ã§ã®exe(msi)(å¾“æ¥ã®ã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢)é…ä¿¡æ©Ÿèƒ½ã«å‚™ãˆã¦...  \r\nãã†ã„ãˆã°Homeã‚¨ãƒ‡ã‚£ã‚·ãƒ§ãƒ³ã§ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã‚¢ã‚«ã‚¦ãƒ³ãƒˆä½œã‚Œãªã„ã£ã¦ã¾ï¼Ÿ\r\n\r\n## ã¡ãªã¿ã«\r\n`.NET 5`ãªã‚‰`å˜ä¸€exe`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åãå‡ºã™æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãŒå¿…è¦ãªã„å ´åˆã¯å˜ä¸€ãƒã‚¤ãƒŠãƒªã‚’ã°ã‚‰ã¾ãã®ãŒã„ã„ã§ã™ã€‚\r\n\r\n[å˜ä¸€exeä½œæˆ](/posts/dotnet_wpf/)\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ        | ã‚ãŸã„                                     |\r\n|---------------|--------------------------------------------|\r\n| Visual Studio | 2019 Community Edition                     |\r\n| Windows       | 10 Pro                                     |\r\n| .NET          | 5                                          |\r\n| æ‹¡å¼µæ©Ÿèƒ½      | Microsoft Visual Studio Installer Projects |\r\n\r\n\r\n# Microsoft Visual Studio Installer Projects\r\nã£ã¦ã®ã‚’ä½¿ã„ã¾ã™ã€‚Wixã£ã¦ã®ã‚‚ã‚ã‚‹ã‚‰ã—ã„ã‘ã©ã‚ˆãçŸ¥ã‚‰ã‚“\r\n\r\n# é…å¸ƒäºˆå®šã®WPFã‚¢ãƒ—ãƒªã‚’ä½œæˆã™ã‚‹\r\nã¾ãé ‘å¼µã£ã¦ä½œã£ã¦ãã‚Œ\r\n\r\n# é…å¸ƒäºˆå®šã®WPFã‚¢ãƒ—ãƒªã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’é–‹ã\r\nã“ã“ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n# æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¥ã‚Œã‚‹\r\nã“ã£ã‹ã‚‰å…¥ã‚Œã‚‰ã‚Œã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/Rnu4RDm.png)\r\n\r\nãã—ãŸã‚‰ã€ã“ã‚Œã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/B2g8gdN.png)\r\n\r\n# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹\r\nã“ã“ã‹ã‚‰è¿½åŠ ã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/aLKGMS4.png)\r\n\r\né–‹ã„ãŸã‚‰ã€æ¤œç´¢ãƒœãƒƒã‚¯ã‚¹ã«`setup`ã¨ã‹å…¥ã‚Œã¦å‡ºã¦ãã‚‹ã€`Setup Project`ã‚’é¸æŠã—ã¾ã™ã€‚  \r\nåå‰ã¨ã‹ã¯å„è‡ª\r\n\r\n![Imgur](https://imgur.com/E9BHzvU.png)\r\n\r\n![Imgur](https://imgur.com/rhQkKNR.png)\r\n\r\nã“ã®ç”»é¢ãŒé–‹ã‘ã¦ã‚Œã°ãŠï½‹\r\n\r\n![Imgur](https://imgur.com/p8lJmcT.png)\r\n\r\n## .NET 5 ã§å‡ºæ¥ãŸWPFã‚¢ãƒ—ãƒªã‚’é…å¸ƒå¯¾è±¡ã«ã™ã‚‹\r\n\r\nãã®ãŸã‚ã«ã¯ã¾ãšã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã€é…å¸ƒã—ãŸã„WPFã‚¢ãƒ—ãƒªã‚’é¸ã‚“ã§å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ç™ºè¡Œã‚’æŠ¼ã—ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/UgmCf4M.png)\r\n\r\né–‹ã„ãŸã‚‰ã€ãƒ•ã‚©ãƒ«ãƒ€ãƒ¼ã«ç™ºè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/QAJaykP.png)\r\n\r\nè¨­å®šã¨ã‹ã¯ãã®ã¾ã¾ã§å®Œäº†ã‚’æŠ¼ã›ã°ã„ã„ã§ã™ã€‚\r\n\r\nãã†ã—ãŸã‚‰ã€ä¸€å¿œé…å¸ƒã™ã‚‹exeã‚’ä¸€ã¤ã«ã¾ã¨ã‚ã‚‹ãŸã‚ã€`ã™ã¹ã¦ã®è¨­å®šã‚’è¡¨ç¤º`ã‹ã‚‰ã€ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ©ãƒ³ã‚¿ã‚¤ãƒ ã‚’`win-x64`ã¸ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¬é–‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‹ã‚‰ã€`å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ`ã«ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nã“ã‚Œã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã«ç½®ããƒ•ã‚¡ã‚¤ãƒ«ã®æ•°ã‚’æ¸›ã‚‰ã›ã¾ã™ã€‚ï¼ˆã¾ãã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆãªã‚“ã¦ã©ã†ã§ã‚‚ã„ã„ãŒï¼‰\r\n\r\n![Imgur](https://imgur.com/QLd15ZC.png)\r\n\r\n# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã§.NET 5ãªã‚¢ãƒ—ãƒªã‚’é…å¸ƒã™ã‚‹ã«ã¯\r\n\r\nå‚è€ƒï¼šhttps://docs.microsoft.com/en-us/visualstudio/deployment/installer-projects-net-core?view=vs-2019\r\n\r\nã¾ãšã¯ã•ã£ãã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆä½œæˆç›´å¾Œã®ç”»é¢ã‚’å‡ºã—ã¾ã™ã€‚  \r\n`File System`ã£ã¦ã‚¿ãƒ–ã®ã‚„ã¤ã§ã™ã­ã€‚ã“ã£ã‹ã‚‰å‡ºã›ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Ds6RPPp.png)\r\n\r\nãã—ãŸã‚‰ã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ãƒ¬ãƒ³ãƒãƒãƒ¼ã‚¯ã‚’æŠ¼ã—ã¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚‚é–‹ãã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/oULsYpT.png)\r\n\r\nãã†ã—ãŸã‚‰ã€`File System`ã®`Application Folder`ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`Add` -> `ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‡ºåŠ›`ã¸é€²ã¿ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Rbk7i3M.png)\r\n\r\nãã†ã—ãŸã‚‰ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ã¨ã“ã‚ãŒé…å¸ƒã—ãŸã„WPFãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã€`é …ç›®ã®å…¬é–‹`ã‚’é¸æŠã—ã¦ã€æ§‹æˆã‚’ãã®ã¾ã¾ã«ã—ã¦ã€`OK`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/HIlAKOJ.png)\r\n\r\n## é …ç›®ã®å…¬é–‹ ã® ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ ã‚’é–‹ãã¾ã™\r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã€é …ç›®ã®å…¬é–‹ (ry ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–‹ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/fvFI1ep.png)\r\n\r\nãã—ãŸã‚‰ã€`å…¬é–‹ã™ã‚‹WPFãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ`ã®ã€`Properties > PublishProperties > FolderProfile.pubxml`ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€å®Œå…¨ãƒ‘ã‚¹ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/q4zscnz.png)\r\n\r\nãã†ã—ãŸã‚‰ã€ãƒ¡ãƒ¢å¸³ã¨ã‹ã«è²¼ã‚Šä»˜ã‘ã¦ã€`Properties/PublishProperties/...`ã®éƒ¨åˆ†ã‚’ã‚³ãƒ”ãƒ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/B5fc2pV.png)\r\n\r\nãã†ã—ãŸã‚‰ã€Visual Studioã¸æˆ»ã‚Šã€é …ç›®ã®å…¬é–‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã€`PublishProfilePath`ã«ã•ã£ãã‚³ãƒ”ãƒ¼ã—ãŸå€¤ã‚’å…¥ã‚Œã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Ted2UBZ.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ“ãƒ«ãƒ‰`ã‚’é¸æŠã—ã¾ã—ã‚‡ã†ã€‚\r\n\r\n![Imgur](https://imgur.com/qOKgwn5.png)\r\n\r\nã“ã‚Œã§ç”Ÿæˆã§ãã‚‹..ã¯ãšï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/de47Xx4.png)\r\n\r\n## ç”Ÿæˆã§ããªã„\r\n\r\nhttps://stackoverflow.com/questions/339106/unrecoverable-build-error-on-any-msi-setup-project\r\n\r\nç®¡ç†è€…æ¨©é™ã§ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ã„ã¦ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ã„ã¦PCå†èµ·å‹•ã§æ²»ã‚‹ã¨ã‹ï¼Ÿ\r\n\r\n```cmd\r\nregsvr32 \"C:\\Program Files (x86)\\Common Files\\Microsoft Shared\\MSI Tools\\mergemod.dll\"\r\nregsvr32 ole32.dll\r\n```\r\n\r\n## targeting 'x64' is not compatible with the project's target platform 'x86'\r\n\r\n`win-x64`ã‚’é¸ã‚“ã å½±éŸ¿ã§ã™ã­ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰ã€`TargetPlatform`ã‚’`x64`ã«ã™ã‚Œã°ã“ã®è­¦å‘Šã‚’æ¶ˆã›ã¾ã™ã€‚\r\n\r\n# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®åå‰ã¨ã‹ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å…ˆã®ãƒ•ã‚©ãƒ«ãƒ€åã¨ã‹\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å¤‰æ›´å¯èƒ½ã§ã™ã€‚`Another`ã€`ProductName`ã€`Title`ã€`Manufactor`ã‚ãŸã‚Šã‚’å¤‰æ›´ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/uvnRSwV.png)\r\n\r\nã—ã£ã‹ã‚Šã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚å‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/5p67hQ4.png)\r\n\r\n## ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¿½åŠ \r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®åˆ©ç‚¹ã¨ã„ãˆã°ã“ã‚Œã‹ï¼Ÿ\r\n\r\n`File System`ã‹ã‚‰ã€`User's Programs Menu`ã‚’é¸æŠã—ã¦ã€`æ–°ã—ã„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’ä½œæˆ`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/yGi6hgN.png)\r\n\r\nãã—ãŸã‚‰ã€`Application Folder`ã‚’é¸æŠã—ã¦ã€`é …ç›®ã®å…¬é–‹ (ä»¥ä¸‹ç•¥`ã‚’æŠ¼ã—ã¦`OK`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/0I1uXxU.png)\r\n\r\nãã—ãŸã‚‰ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é¸ã‚“ã§ã€`(Name)`ã‚’ã‚¢ãƒ—ãƒªåã«å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Usk7A9x.png)\r\n\r\nã§ããŸã‚‰å†åº¦ãƒ“ãƒ«ãƒ‰ã—ã¾ã™ã€‚\r\n\r\nã“ã‚Œã§ã‚¹ã‚¿ãƒ¼ãƒˆã«ç™»éŒ²ã‚‚å‡ºæ¥ã¾ã—ãŸã­ã€‚\r\n\r\n![Imgur](https://imgur.com/tgdofmk.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# è¿½è¨˜ï¼š2021/10/07 ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®šã™ã‚‹å ´åˆ\r\n\r\n`128 x 128`ã˜ã‚ƒãªã„ã¨ã ã‚ã§ã™ã€‚ã‚½ãƒ¼ã‚¹ï¼šhttps://stackoverflow.com/questions/2041291/how-to-change-windows-applicatoins-default-icon-in-setup-project\r\n\r\nãŸã ã€ã“ã‚Œã¨åˆ¥ã«ç”Ÿã¾ã‚Œå¤‰ã‚ã£ãŸ`Win11`ã®`Microsoft Store`ã§ã¯`1080 x 1080`ã®ã‚µã‚¤ã‚ºã®ã‚¢ã‚¤ã‚³ãƒ³ãŒå¿…è¦ãªã®ã§ã€`svg`ã§ä½œã£ã¦ãŠãã¨å¹¸ã›ã«ãªã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/KXDs6Ws.png)\r\n\r\nä»Šå›ã¯`InkScape`ã§ä½œã‚Šã¾ã—ãŸã€‚`128 x 128`ã§`png`ã«æ›¸ãå‡ºã—ã¦ã€`GIMP`ã§`ico`å½¢å¼ã«å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n## ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ \r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰ã€ãƒªã‚½ãƒ¼ã‚¹ã‚’é–‹ã„ã¦ã€`ico`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°ã‚¢ãƒ³ãƒ‰ãƒ‰ãƒ­ãƒƒãƒ—ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/6t2Weuj.png)\r\n\r\nã§ããŸã‚‰ã€`Resources`ãƒ•ã‚©ãƒ«ãƒ€ã«è¿½åŠ ã•ã‚Œã‚‹ã®ã§ã€`Resources`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚‹`ico`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–‹ã„ã¦ã€`ãƒ“ãƒ«ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³`ã‚’`ãƒªã‚½ãƒ¼ã‚¹`ã«ã—ã¾ã™ã€‚å¿…è¦ã‹ã©ã†ã‹ã¯ã‚ã‹ã‚Šã¾ã›ã‚“ãŒã€‚\r\n\r\n![Imgur](https://imgur.com/vGsX36c.png)\r\n\r\n## WPFã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®š\r\nãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–‹ã„ã¦ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’æŠ¼ã—ã¦ã€`ãƒªã‚½ãƒ¼ã‚¹`ã®ä¸­ã®`ã‚¢ã‚¤ã‚³ãƒ³`ã‚’å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ofWqAxV.png)\r\n\r\n## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã«ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¿½åŠ \r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é–‹ã„ã¦ã€ã“ã“ã‹ã‚‰è¿½åŠ ã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/VkyAMB5.png)\r\n\r\n## ã‚¹ã‚¿ãƒ¼ãƒˆã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®ã‚¢ã‚¤ã‚³ãƒ³ã‚’è¨­å®š\r\n`User's Programs Menu`ã«ã‚ã‚‹ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–‹ã„ã¦ã€Iconã‚’é¸ã‚“ã§`Browse`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/KAw566a.png)\r\n\r\nãã—ãŸã‚‰ã€`Browse`ã‚’æŠ¼ã—ã¦\r\n\r\n![Imgur](https://imgur.com/TxgRhwN.png)\r\n\r\nã•ã£ãè¿½åŠ ã—ãŸã‚¢ã‚¤ã‚³ãƒ³ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/5X0Guhe.png)\r\n\r\nãã—ãŸã‚‰ã€`Current icon`ã«è¿½åŠ ã•ã‚Œã‚‹ã®ã§ã€é¸æŠã—ã¦`OK`ã‚’æŠ¼ã›ã°çµ‚äº†ã§ã™ã€‚  \r\nã‚ã¨ã¯ãƒ“ãƒ«ãƒ‰ã—ã¦å®Œæˆã€‚\r\n\r\n## ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ï¼Ÿ\r\nãƒãƒ¼ã‚¸ãƒ§ãƒ³ã®ç•ªå·ã‚’ã‚ã’ã¾ã™ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã¨WPFã®ã‚¢ãƒ—ãƒªãã‚Œãã‚Œå¤‰æ›´ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚   \r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®æ–¹ã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å¤‰æ›´ã™ã‚‹ã¨`ProductCode`ã‚‚ç”Ÿæˆã—ç›´ã™ã‹èã‹ã‚Œã‚‹ã®ã§ç”Ÿæˆã—ç›´ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/aZmk39I.png)\r\n\r\nãã‚Œã‹ã‚‰ã€`RemovePreviousVersions`ã‚’`True`ã«ã™ã‚‹ã¨æ—¢å­˜ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\n\r\nhttps://github.com/takusan23/ItaCursor\r\n\r\nãŸã¶ã‚“ä½œã‚Œã¾ã™ã€‚\r\n\r\n### ãƒ¡ãƒ¢\r\n\r\n`.sln`ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»ã—ãŸã„\r\n\r\n-> ç©ºã®ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ä½œæˆã—ã¦ã€æ—¢å­˜ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã™ã‚‹ã“ã¨ã§è§£æ±º"},{"title":"WinUI 3 ã§å‡ºæ¥ãŸã‚¢ãƒ—ãƒªã‚’é…å¸ƒã™ã‚‹ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ / zip ã‚’ä½œã‚‹ï¼‰","link":"/posts/windows_winui3_installer_and_virtual_desktop/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚ã€‚  \r\nã‚µãƒ–ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ãŒå£Šã‚Œã¦ã—ã¾ã£ãŸï¼ˆãªã‚“ã‹ã—ã°ã‚‰ãã—ãªã„ã¨ç”»é¢ãŒä»˜ã‹ãªããªã£ã¦ã—ã¾ã£ãŸãƒ»ãƒ»ãƒ»ï¼‰ãŸã‚ã€ä»®æƒ³ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã‚’ä½¿ã£ã¦ã¿ã¦ã„ã‚‹ã®ã§ã™ãŒã€  \r\n**ä»®æƒ³ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®åˆ‡ã‚Šæ›¿ãˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ãŒè¦šãˆã‚‰ã‚Œã¾ã›ã‚“ãƒ»ãƒ»ãƒ»ï¼**ã€ãªã‚“ã‹è‰²ã€…çµ„ã¿åˆã‚ã›ã‚’ç¢ºã‹ã‚ã¦ã„ã‚‹ã¨æ­£è§£ã«å½“ãŸã£ãŸã‚Šã™ã‚‹ã€‚\r\nãƒˆãƒ©ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã®å ´åˆã¯ãªã‚“ã‹ç›´æ„Ÿçš„ãªã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãŒã‚ã£ã¦ã¾ãã„ã„ã‹ã¨æ„Ÿã˜ãªã‚“ã§ã™ã‘ã©ã­ã€‚    \r\n\r\nã†ãƒ¼ã‚“ã§ã‚‚æ–°ã—ã„`Xperia`æ¬²ã—ã„ã—ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤è²·ã†é‡‘ãªã„ã§ã™ãƒ»ãƒ»ï¼ˆã¦ã‹é«˜ã™ãï¼‰  \r\nã¡ãªã¿ã«`Surface`ã‚’ã‚µãƒ–ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã¨ã—ã¦ä½¿ã†æ–¹æ³•ã‚‚ã‚ã‚‹ã¿ãŸã„ã§ã™ãŒã€ã‚„ã£ã±é…å»¶ãŒãªã‚ï½ï½ï½\r\n\r\n# æœ¬é¡Œ\r\nã¨ã„ã†ã‚ã‘ã§ä»®æƒ³ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã®åˆ‡ã‚Šæ›¿ãˆã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ã‚’æŠ¼ã—ã¦ãã‚Œã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚Šã¾ã—ãŸã€‚  \r\n`Windowsã‚­ãƒ¼`é•·æŠ¼ã—ã™ã‚‹ã¨ã™ã‚Šã‚¬ãƒ©ã‚¹ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒå‡ºã¦ãã¦ã€ãƒˆãƒ©ãƒƒã‚¯ãƒ‘ãƒƒãƒ‰ã®ã‚ˆã†ã«ç·šã‚’æãã¨æã„ãŸå‘ãã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã™ï¼ˆï¼Ÿï¼‰\r\n\r\n![Imgur](https://imgur.com/7XOcwZf.png)\r\n\r\nã§ã€ä»Šæ°—ä»˜ã„ãŸã®ã§ã™ãŒã€é•·æŠ¼ã—ã ã¨`Windowsã‚­ãƒ¼`ã‚’ä½¿ã†ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼ãŒ**å‹•ã‹ãªããªã£ã¦ã—ã¾ã£ãŸ**ã®ã§ã€`Win+Ctrl`é•·æŠ¼ã—ã§èµ·å‹•ã™ã‚‹ã‚ˆã†ã«ç›´ã—ã¾ã—ãŸã€‚  \r\n`ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆ`ãŒå–ã‚Œãªããªã£ãŸã®ãŒä¸€ç•ªã§ã‹ã„ãƒ»ãƒ»ãƒ»\r\n\r\n# ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰\r\nhttps://github.com/takusan23/DesktopLine  \r\nhttps://github.com/takusan23/DesktopLine/releases  \r\n\r\n# æœ¬é¡Œ2\r\nãŸã¾ã«`WinUI 3`ã‚’ä½¿ã„ãŸããªã‚‹æœªæ¥ã®ç§ã®ãŸã‚ã«ã€**`WinUI 3`ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚Šã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½œã‚‹**ã¨ã“ã‚ã¾ã§ã‚’è¨˜éŒ²ã«ã—ã¦ãŠã“ã†ã¨æ€ã„ã¾ã™ã€‚  \r\n`UWP`ã¿ãŸã„ãª`UI` ( Windows 11 ã®UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ ) ãŒä½¿ãˆã‚‹ã®ã§ã™ãŒã€ã“ã‚Œã¯`UWP`ã§ã¯ãªã„ï¼ˆã‚€ã—ã‚`WPF`ã§`UWP`ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½¿ãˆã‚‹ã‚¤ãƒ¡ãƒ¼ã‚¸ï¼‰ã®ã§ã€  \r\n`Windowsã®ã‚¢ãƒ—ãƒªã‚¹ãƒˆã‚¢`ã‚’ä½¿ã‚ãšã«ã€`ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼`ã‚„`zipãƒ•ã‚¡ã‚¤ãƒ«`ã«ã—ã¦æ™®é€šã«é…å¸ƒå‡ºæ¥ã¾ã™ã€‚  \r\n`P/Invoke`ã‚‚æ™®é€šã«ã§ãã¾ã™ï¼ˆ`WPF`ã¨åŒã˜ã ã­ï¼‰ã€‚`WPF`ã‚ˆã‚Šæ©Ÿèƒ½ã¯ã¾ã ç„¡ã„ã‹ã‚‚ã ã‘ã©`WinUI 3`ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãŒï¼ˆã“ã“æœ€è¿‘ã®Windowsã®ä¸­ã§ï¼‰ã¨ã¦ã‚‚ã„ã„ï¼ˆæ°—ãŒã™ã‚‹ï¼‰ï¼ï¼ï¼\r\n\r\nã©ã‚“ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒä½¿ãˆã‚‹ã®ã‹ã¨ã„ã†ã¨ã€ä»¥ä¸‹ã®ã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã¦è¦‹ã¦ã¿ã¦ãã ã•ã„ã€‚ã™ã‚Šã‚¬ãƒ©ã‚¹ï¼ˆAcrylic / Micaï¼‰ãªã‚“ã‹ãŒå°‘ã—æ›¸ãã ã‘ã§ï¼Ÿä½¿ãˆã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚  \r\n- WinUI 3 Gallery\r\n    - https://www.microsoft.com/store/productId/9P3JFPWWDZRC\r\n\r\n\r\n# ç’°å¢ƒ\r\n\r\n| ãªã¾ãˆ          | ã‚ãŸã„                                                    |\r\n|-----------------|-----------------------------------------------------------|\r\n| Windows         | 10 Pro ( 11 ã®å ´åˆã¯éƒ¨åˆ†çš„ã«é•ã†ã‹ã‚‚ï¼Ÿ )                  |\r\n| Visual Studio   | 2022 Community                                            |\r\n| .NET            | 6 ( 7 ã§ã‚‚ã„ã„ã¯ãšã§ã™ )                                  |\r\n| Windows App SDK | 1.2.220902.1-preview1  ( æœ€æ–°ç‰ˆã«ã—ã¦ã‚‚å•é¡Œãªã„ã¯ãšã§ã™ ) |\r\n\r\n`Visual Studio`ã¨`.NET 6`ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã¯ã‚„ã£ã¦ãŠã„ã¦ãã ã•ã„ã€‚\r\n\r\n# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ vs zipãƒ•ã‚¡ã‚¤ãƒ«\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã ã¨ã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¨ã‹ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã«è‡ªå‹•ã§ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆè¿½åŠ å‡ºæ¥ãŸã‚Šã€ã‚ã¨`.NET`ãŒå…¥ã£ã¦ãªã„å ´åˆã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã›ã‚‹æ©Ÿèƒ½ãŒã‚ã‚Šã¾ã™ã­ã€‚  \r\nzipãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã°ã‚‰ã¾ãå ´åˆã¯é…å¸ƒãŒæ¥½ã§ã™ã­ã€‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®æ©Ÿèƒ½ãŒã„ã‚‰ãªã„å ´åˆã¯ã‚ã‚Šã ã¨æ€ã†ã€‚\r\n\r\n# Visual Studio ã§ Windows App SDK ã‚’ä½¿ã†æº–å‚™ã‚’ã™ã‚‹\r\nã”ã‚ã‚“ãªã•ã„ã€‚ã€‚ã€‚è¦šãˆã¦ãªã„ã§ã™ã€‚  \r\n`Visual Studio Installer`ã§ã€`.NET`ã®ã¨ã“ã‚ã®`Windows ã‚¢ãƒ—ãƒªSDK`ã®ã¨ã“ã‚ã«ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’ã„ã‚Œã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã™ã‚Œã°ã„ã„ã®ã‹ãªã‚ã€‚ã€‚ã€‚\r\n\r\n![Imgur](https://imgur.com/LvLMmX1.png)\r\n\r\n# Visual Studio 2022 ã§æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½œã‚‹\r\nå¤šåˆ†ã€ã“ã‚Œã‚’é¸ã¹ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/wpJhCk6.png)\r\n\r\nã§ã€ä¿å­˜å…ˆã¨ã‹ã‚’ãŠå¥½ã¿ã§å¤‰æ›´ã—ãŸã‚ã¨ã€ä¸€ç•ªä¸‹ã®`ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã¨ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’åŒã˜ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ã™ã‚‹`ã®ãƒã‚§ãƒƒã‚¯ã‚’å¤–ã—ã¦ãŠãã¾ã™ã€‚  \r\nã“ã†ã—ã¦ãŠãã“ã¨ã§ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆã§è¡Œãã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚  \r\n\r\n- ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³\r\n    - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ( `Windows App SDK` ( WinUI 3 ) ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ )\r\n        - MainWindow.xaml\r\n        - ...\r\n    - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ( ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ )\r\n\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã¯æ–°ã—ã„ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¨ã—ã¦ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã«è¿½åŠ ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã§ã™ãŒï¼ˆå¤šåˆ†ãƒ»ãƒ»ï¼Ÿï¼‰ã€ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚ŒãŸã¾ã¾ã ã¨å…¥ã‚Œã‚‹å ´æ‰€ãŒãªã„ã‚“ã§ã™ã‚ˆã­ã€ã€  \r\n\r\n- ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³\r\n    - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ( `Windows App SDK` ( WinUI 3 ) ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ )\r\n        - MainWindow.xaml\r\n        - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ( ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ ) â† æ°—æŒã¡æ‚ªã„ã‘ã©ã“ã“ã«å…¥ã‚Œã‚‹ã—ã‹ç„¡ã„ï¼Ÿã€‚gitã¨ã‹ã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã™ã‚‹å ´åˆã¯ãƒ»ãƒ»ãƒ»\r\n\r\nï¼ˆzip ã§é…ä¿¡ã—ãŸã„å ´åˆã¯é€†ã«ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å…¥ã‚ŒãŸã»ã†ãŒã‚·ãƒ³ãƒ—ãƒ«ãªæ§‹æˆã«ãªã‚‹ã‹ã‚‚ï¼Ÿï¼Ÿï¼‰\r\n\r\n![Imgur](https://imgur.com/5IB4MMp.png)\r\n\r\nã‚ã¨ã¯ã“ã‚Œã§ä½œã£ã¦ã€å®Ÿè¡Œãƒœã‚¿ãƒ³ã‚’æŠ¼ã›ã°èµ·å‹•ã§ãã‚‹ã¯ãš\r\n\r\n![Imgur](https://imgur.com/KEal94T.png)\r\n\r\n# MainWindow.xaml ã«ãƒ¯ãƒŠãŒã‚ã‚‹ ï¼ˆæ–‡å­—ã‚³ãƒ¼ãƒ‰å¤‰æ›´ï¼‰\r\n`WinUI 3 Gallery`ã‚’è¦‹ã¦ã‚‚ã‚‰ãˆã‚‹ã¨ã‚ã‹ã‚‹ã®ã§ã™ãŒã€æœ€åˆã‹ã‚‰ãã‚Œã„ãªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒã‚ã‚‹ã‚“ã§ã™ã‚ˆã­ã€‚  \r\nã“ã‚“ãªé¢¨ã«å°‘ã—æ›¸ãã ã‘ã§ãã‚Œã„ãªUIãŒä½œã‚Œã¾ã™ã€‚\r\n\r\n```xml\r\n<!-- Copyright (c) Microsoft Corporation. All rights reserved. -->\r\n<!-- Licensed under the MIT License. See LICENSE in the project root for license information. -->\r\n\r\n<Window\r\n    x:Class=\"ExampleWinUI3.MainWindow\"\r\n    xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\r\n    xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\r\n    xmlns:local=\"using:ExampleWinUI3\"\r\n    xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\r\n    xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\r\n    mc:Ignorable=\"d\">\r\n\r\n\r\n    <NavigationView x:Name=\"nvSample\">\r\n        <NavigationView.MenuItems>\r\n            <NavigationViewItem Icon=\"Play\" Content=\"å†ç”Ÿ\" />\r\n            <NavigationViewItem Icon=\"Save\" Content=\"ä¿å­˜\" />\r\n            <NavigationViewItem Icon=\"Refresh\" Content=\"ãƒªãƒ­ãƒ¼ãƒ‰\" />\r\n            <NavigationViewItem Icon=\"Download\" Content=\"ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\" />\r\n        </NavigationView.MenuItems>\r\n\r\n        <StackPanel Orientation=\"Vertical\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\">\r\n            <Button Padding=\"10\" x:Name=\"myButton\" Click=\"myButton_Click\">Click Me</Button>\r\n            <ProgressRing Padding=\"10\" IsActive=\"True\" Background=\"LightGray\"/>\r\n            <ToggleSwitch Padding=\"10\" AutomationProperties.Name=\"simple ToggleSwitch\"/>\r\n        </StackPanel>\r\n\r\n    </NavigationView>\r\n</Window>\r\n```\r\n\r\nãªã‚“ã§ã™ã‘ã©ã€è¨­å®šã‚’å¤‰ãˆãªã„ã¨æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã—ã¦ã—ã¾ã„ã¾ã™ãƒ»ãƒ»ãƒ»\r\n\r\n![Imgur](https://imgur.com/FqAaL6S.png)\r\n\r\nä¿®æ­£æ–¹æ³•ã¯å‰ã«ã‚‚æ›¸ã„ãŸã®ã§ã™ãŒã€`MainWindow.xaml`ã‚’`BOMä»˜ã UTF-8`ã«ã™ã‚Œã°ä¿®æ­£å¯èƒ½ã§ã™ã€‚  \r\nåå‰ã‚’ã¤ã‘ã¦ä¿å­˜ã‚’é¸ã‚“ã§\r\n\r\n![Imgur](https://imgur.com/xjXabZk.png)\r\n\r\nã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä»˜ãã§ä¿å­˜ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/zvD3bXm.png)\r\n\r\n`UTF-8 ã‚·ã‚°ãƒãƒãƒ£ä»˜ã`ã‚’é¸ã³ã¾ã™\r\n\r\n![Imgur](https://imgur.com/dww7gDo.png)\r\n\r\nã“ã‚Œã§æ²»ã‚Šã¾ã—ãŸã€‚ã‚„ã£ãŸãƒ¼\r\n\r\n![Imgur](https://imgur.com/G28D8dh.png)\r\n\r\n# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ / zipãƒ•ã‚¡ã‚¤ãƒ« ã‚’ä½œã‚‹\r\né…å¸ƒã™ã‚‹å‰ã¾ã§é ‘å¼µã£ã¦ä½œã£ã¦ãã ã•ã„ã€‚ã€‚  \r\nã§ã€ã“ã“ã‹ã‚‰ã¯é…å¸ƒã®è©±ã‚’æ®‹ã—ã¦ç½®ã“ã†ã¨æ€ã„ã¾ã™\r\n\r\n## å‚è€ƒ\r\nthx!!!!!\r\n\r\nhttps://learn.microsoft.com/ja-jp/windows/apps/package-and-deploy/self-contained-deploy/deploy-self-contained-apps\r\nhttps://www.ipentec.com/document/csharp-winui3-create-self-contained-executables-application\r\n\r\n## ãã®å‰ã« exe ã§é…ä¿¡ã§ãã‚‹å½¢å¼ã«ã™ã‚‹\r\n~~ã©ã†ã‚„ã‚‰MSã¯æœªã ã«`MSIX`ã«å¼·ã„ã“ã ã‚ã‚ŠãŒã‚ã‚‹ã‚‰ã—ãï¼Ÿ~~ ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã ã¨`exe`ã«ã§ãã¾ã›ã‚“ã€‚  \r\n`dotnet publish`ã‚’ä½¿ã£ãŸã¨ã—ã¦ã‚‚ã€è¨­å®šã‚’å¤‰æ›´ã—ãªã„ã¨èµ·å‹•ã§ããªã„`exe`ãŒç”Ÿæˆã•ã‚Œã¦ã—ã¾ã„ã¾ã™ã€‚ã€‚å›°ã£ãŸï¼\r\n\r\n```plaintext\r\néšœå®³ãƒã‚±ãƒƒãƒˆ 1463075854298809095ã€ç¨®é¡ 4\r\nã‚¤ãƒ™ãƒ³ãƒˆå: APPCRASH\r\nå¿œç­”: ä½¿ç”¨ä¸å¯\r\nCab ID: 0\r\n\r\nå•é¡Œã®ç½²å:\r\nP1: ExampleWinUI3.exe\r\n...\r\n```\r\n\r\n![Imgur](https://imgur.com/MS2hqyu.png)\r\n\r\nï¼ˆ`Windows`ã ã¨ã‚¢ãƒ—ãƒªãŒèµ·å‹•ã§ããªã„ãƒ­ã‚°ãŒ`ã‚¤ãƒ™ãƒ³ãƒˆãƒ“ãƒ¥ãƒ¼ã‚¢ãƒ¼`ã¨ã„ã†ã‚¢ãƒ—ãƒªã«ä¿å­˜ã•ã‚Œã¾ã™ã€‚ï¼‰\r\n\r\nã“ã‚Œã‚’æ²»ã™ãŸã‚ã«ã¯ã€ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’æŠ¼ã—ã¦ã€`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ ãƒ•ã‚¡ã‚¤ãƒ«ã®ç·¨é›†`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/04nGhnM.png)\r\n\r\nãã—ãŸã‚‰ã€ä»¥ä¸‹ã®äºŒè¡Œã‚’`<PropertyGroup>`ã®ä¸­ã«è¶³ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«\r\n\r\n```xml\r\n<WindowsAppSDKSelfContained>true</WindowsAppSDKSelfContained>\r\n<WindowsPackageType>None</WindowsPackageType>\r\n```\r\n\r\n![Imgur](https://imgur.com/JnyEk77.png)\r\n\r\nã¾ãŸã€ã“ã‚Œã‚’è¨˜è¿°ã—ãŸã‚ã¨ã¯ã€ä»¥ä¸‹ã®`Unpackaged`ã®æ–¹ã‚’å®Ÿè¡Œã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/8d1lZOc.png)\r\n\r\n## zip ã§é…å¸ƒã™ã‚‹\r\nãŠæ‰‹è»½ã§ã™ãŒã€ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è‡ªå‹•ã§è¿½åŠ ã¨ã‹ã¯å‡ºæ¥ã¾ã›ã‚“ã€‚ï¼ˆã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãŒå¿…è¦ã§ã™ã€‚ï¼‰  \r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€ç™ºè¡Œã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/vIOvS6i.png)\r\n\r\n`x64`ã§ã„ã„ã¯ãšã€‚\r\n\r\n![Imgur](https://imgur.com/krNSydi.png)\r\n\r\n`ã™ã¹ã¦ã®è¨­å®šã‚’è¡¨ç¤º`ã‚’æŠ¼ã—ã¦ã€æ§‹æˆã‚’ `Release | x64`ã€é…ç½®ãƒ¢ãƒ¼ãƒ‰ã‚’`ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¾å­˜`ã€ãƒ•ã‚¡ã‚¤ãƒ«ã®å…¬é–‹ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’é–‹ãã€`å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ`ã¸ãƒã‚§ãƒƒã‚¯ãƒãƒ¼ã‚¯ã‚’å…¥ã‚Œã‚‹ã¨ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nè‡ªå·±å®Œçµã ã¨`.NET`ãŒ`exe`ã®ä¸­ã«å…¥ã‚‹ãŸã‚ã€`.NET`ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ãªãã¦ã‚‚èµ·å‹•ã§ãã‚‹ä¸€æ–¹ã€ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚ºãŒã¨ã¦ã‚‚å¤§ãããªã£ã¦ã—ã¾ã„ã¾ã™ã€‚  \r\n`å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«`ã«ãƒã‚§ãƒƒã‚¯ã™ã‚‹ã“ã¨ã§ã€`WPF`ã®æ™‚ã¯`exeä¸€å€‹`ã«ã¾ã¨ã‚ã‚‹ã“ã¨ãŒå‡ºæ¥ãŸã®ã§ã™ãŒã€`WindowsAppSDK`ã§ã¯ãªã‚“ã‹å‡ºæ¥ãªã„ã£ã½ã„ã§ã™ã€‚ã€‚ã€‚ãŒä¸€å¿œãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¦ã„ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/vxJUHwY.png)\r\n\r\nã‚ã¨ã¯`ç™ºè¡Œã‚’æŠ¼ã—ã¾ã™`\r\n\r\n![Imgur](https://imgur.com/x3VuimK.png)\r\n\r\nçµ‚ã‚ã£ãŸã‚‰é–‹ã„ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ã©ã†ã§ã™ã‹ï¼Ÿé–‹ã‘ã¾ã—ãŸã‹ï¼ï¼Ÿï¼ï¼Ÿï¼ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/uBW8rkA.png)\r\n\r\nã‚ãƒ¼ã„ ğŸ‰ğŸ‰ğŸ‰\r\n\r\n`zip`ãƒ•ã‚¡ã‚¤ãƒ«ã§é…å¸ƒã™ã‚‹å ´åˆã¯ã€`exe`ãŒã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’å…¨éƒ¨åœ§ç¸®ã—ã¦ã€é©å½“ãªã¨ã“ã‚ã§å…¬é–‹ã™ã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/6NQwLow.png)\r\n\r\n## ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã§é…å¸ƒã™ã‚‹\r\n`WPF`ç‰ˆã‚‚ã‚ã‚Šã¾ã™ : https://takusan.negitoro.dev/posts/windows_dot_net5_wpf_making_installer/\r\n\r\n`Visual Studio`ã«æ‹¡å¼µæ©Ÿèƒ½ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\nhttps://marketplace.visualstudio.com/items?itemName=VisualStudioClient.MicrosoftVisualStudio2022InstallerProjects  \r\n\r\n![Imgur](https://imgur.com/fyrpu84.png)\r\n\r\n### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ä½œã‚Šã¾ã™\r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/WkmA5P8.png)\r\n\r\n`Setup Project`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/Orx43SZ.png)\r\n\r\nåå‰ã‚’ã‚ˆã—ãªã«å¤‰ãˆã¦ done\r\n\r\n![Imgur](https://imgur.com/PHXDCzf.png)\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ãªã‚‹ã¯ãš\r\n\r\n![Imgur](https://imgur.com/ZKho35D.png)\r\n\r\n### é…å¸ƒè¨­å®šã‚’ã™ã‚‹\r\nã“ã“ã®æ‰‹é †ã¯`zipãƒ•ã‚¡ã‚¤ãƒ«`ã§é…å¸ƒã™ã‚‹ã®ã¨åŒã˜ã§ã™ã­ã€‚  \r\n`WinUI 3`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦`ç™ºè¡Œ`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/lbXgO7x.png)\r\n\r\n`x64`ã«ã—ã¾ã™ï¼ˆæœ€è¿‘ã¯ã»ã¨ã‚“ã©`x64`ã§ã„ã„ã¯ãšï¼‰\r\n\r\n![Imgur](https://imgur.com/HmD4hpN.png)\r\n\r\n`ã™ã¹ã¦ã®è¨­å®šã‚’è¡¨ç¤º`ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ã«å¤‰æ›´ã—ã¾ã™ã€‚\r\n\r\n- æ§‹æˆ\r\n    - `Release | x64`\r\n- é…ç½®ãƒ¢ãƒ¼ãƒ‰\r\n    - `ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ä¾å­˜`\r\n        - `è‡ªå·±å®Œçµ`ã ã¨`.NET`ãŒ`.exe`ã®ä¸­ã«å…¥ã‚‹ãŸã‚ã€ãƒã‚¤ãƒŠãƒªã‚µã‚¤ã‚ºãŒãƒ‡ã‚«ããªã‚Šã¾ã™ã€‚ãŒã€`.NET`ã‚’å…¥ã‚Œãªãã¦ã‚‚èµ·å‹•ã§ãã‚‹ãƒ¡ãƒªãƒƒãƒˆãŒã‚ã‚Šã¾ã™ã€‚\r\n- ãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ ã® å˜ä¸€ãƒ•ã‚¡ã‚¤ãƒ«ã®ä½œæˆ\r\n    - ã©ã£ã¡ã§ã‚‚ã„ã„ã¯ãšï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/eH7On5E.png)\r\n\r\nå‡ºæ¥ãŸã‚‰`ä¿å­˜`ã—ã¦ãã ã•ã„ã€‚\r\n\r\n### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã«é…å¸ƒã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¨­å®šã™ã‚‹\r\nå‚è€ƒï¼šhttps://learn.microsoft.com/en-us/visualstudio/deployment/installer-projects-net-core?view=vs-2019\r\n\r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã€ã•ã£ãã¤ãã£ãŸã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`File System`ã‚’é–‹ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/ZajMDN9.png)\r\n\r\n`Application Folder`ã‚’é¸ã³ã€`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå‡ºåŠ›`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/hd4UGFL.png)\r\n\r\n`é …ç›®ã®å…¬é–‹`ã€ã‚’é¸ã‚“ã§`OK`ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/JRzkQ1W.png)\r\n\r\n### é …ç›®ã®å…¬é–‹ã¨ WinUI 3 ã®æˆæœç‰©ã‚’ç´ä»˜ã‘ã‚‹\r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã€ã•ã£ãã¤ãã£ãŸ`é …ç›®ã®å…¬é–‹`ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/O4IOuOp.png)\r\n\r\n`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`ã®ä¸­ã®`PublishProperties`ã®ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’æŠ¼ã™ã¨ã€ãªã‚“ã‹3ã¤ãã‚‰ã„ã§ã¦ãã‚‹ã¨æ€ã†ã®ã§ã€`x64`ã¨æ›¸ã„ã¦ã‚ã‚‹æ–¹ã‚’é¸ã³ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/xTWghXF.png)\r\n\r\n\r\n### ãã®ä»–ã®å€¤ã‚‚ã‚»ãƒƒãƒˆã™ã‚‹\r\nã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’ã‚¯ãƒªãƒƒã‚¯ã—ã€ä¸‹ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‹ã‚‰ã€  \r\n`TargetPlatform`ã‚’`x64`ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/Zr71CAO.png)\r\n\r\nã¾ãŸã€ä»¥ä¸‹ã®å€¤ã‚‚å¤‰ãˆã¦ãŠãã¨è‰¯ã„ã§ã—ã‚‡ã†ã€‚\r\n- ProductName\r\n    - ã‚¢ãƒ—ãƒªã®åå‰\r\n- Another\r\n    - ä½œè€…\r\n- Title\r\n    - ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã®åå‰\r\n- Manufactor\r\n    - ä½œè€…ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/b9f5lva.png)\r\n\r\n### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ã‚’ã¤ãã‚‹\r\nã‚„ã‚‹å¿…è¦ãŒã‚ã‚‹ã®ã‹çŸ¥ã‚Šã¾ã›ã‚“ãŒã€å®Ÿè¡Œãƒœã‚¿ãƒ³ã®éš£ã‚Šã«ã‚ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€`Release`ã¨`x64`ã«ã—ã¦ãŠãã¾ã—ãŸã€‚\r\n\r\n![Imgur](https://imgur.com/mZnQnBB.png)\r\n\r\nã‚ã¨ã¯ã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ“ãƒ«ãƒ‰`ã‚’æŠ¼ã™ã“ã¨ã§é–‹å§‹ã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/rbTE2Do.png)\r\n\r\nã¯ã„ï¼ï¼ï¼\r\n\r\n![Imgur](https://imgur.com/5ILfBZx.png)\r\n\r\nã“ã‚“ãªæ„Ÿã˜ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãŒå‡ºæ¥ã¦ã„ã‚‹ã¯ãš  \r\n\r\n![Imgur](https://imgur.com/qekx5gU.png)\r\n\r\n`UAC`ãŸã¾ã«ã‚ˆãæ°—ä»˜ã‹ãªã„ã‚“ã ã‘ã©ç§ã ã‘ï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/B16QsQt.png)\r\n\r\nã¡ã‚ƒã‚“ã¨ã‚¢ãƒ³ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã‚‚ã§ãã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/IQqIjOT.png)\r\n\r\n### ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«è¡¨ç¤ºã•ã›ã‚‹\r\n`File System`ã‹ã‚‰ã€`User's Programs Menu`ã‚’æŠ¼ã—å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦`æ–°ã—ã„ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®ä½œæˆ`ã‚’æŠ¼ã—ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/clwg7Je.png)\r\n\r\n`Application Folder`ã‹ã‚‰ã€`é …ç›®ã®å…¬é–‹`ã‚’é¸ã³`OK`ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/OHIRIP2.png)\r\n\r\nåå‰ã¯ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å¤‰ãˆã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/wg5lRo8.png)\r\n\r\nã“ã‚Œã§ã‚¹ã‚¿ãƒ¼ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ã«å‡ºã¦ãã‚‹ã¯ãš\r\n\r\n![Imgur](https://imgur.com/8cmpOjR.png)\r\n\r\n### ã‚¢ã‚¤ã‚³ãƒ³å¤‰æ›´\r\n`WPF`ã®ã¨ãã¨ã»ã¼åŒã˜ã§ã™ãŒãƒ»ãƒ»ãƒ»  \r\n`GIMP`ã¨ã‹ã‚’ä½¿ã£ã¦`128x128`ã®`ico`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œã£ã¦ãã ã•ã„ã€‚\r\n\r\n![Imgur](https://imgur.com/cDPEUYA.png)\r\n\r\n`WinUI 3`ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£`ã«é€²ã¿ã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/KCKXOsQ.png)\r\n\r\nãƒªã‚½ãƒ¼ã‚¹ã‚’æŠ¼ã—ã¦ã€ã¾ã ä½œã£ã¦ã„ãªã„å ´åˆã¯`ä½œæˆã™ã‚‹/é–‹ã`ã‚’æŠ¼ã—ã¾ã™\r\n\r\n![Imgur](https://imgur.com/YEWbgAl.png)\r\n\r\nãã—ãŸã‚‰ã“ã“ã«`.ico`ã‚’æŠ•ã’è¾¼ã¿ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/X0gNVt9.png)\r\n\r\n![Imgur](https://imgur.com/ZwthLDj.png)\r\n\r\nã¾ãŸã€ã‚½ãƒªãƒ¥ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ã€å…ˆç¨‹è¿½åŠ ã—ãŸ`ico`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚’é–‹ãã€`ãƒ“ãƒ«ãƒ‰ã‚¢ã‚¯ã‚·ãƒ§ãƒ³`ã‚’`ãƒªã‚½ãƒ¼ã‚¹`ã«ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/6lwQMAv.png)\r\n\r\n#### ã‚¢ãƒ—ãƒªè‡ªä½“ã®ã‚¢ã‚¤ã‚³ãƒ³\r\n\r\nã‚¢ãƒ—ãƒªã®ã‚¢ã‚¤ã‚³ãƒ³ã®è¨­å®šã¯ã€ã•ã£ãã®`WinUI 3`ã®ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®ã“ã“ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/20ir0jH.png)\r\n\r\nå¤‰ã‚ã£ã¦ã‚‹ã¯ãšï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/PKdTDUs.png)\r\n\r\nã“ã£ã¡ã‚’å¤‰æ›´ã™ã‚‹ã®ã¯ã¾ãŸåˆ¥ã« `C#` ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‹ãªã„ã¨ã„ã‘ãªã„ãã†ã§ã™ãƒ»ãƒ»ãƒ»  \r\nå‚è€ƒ : https://github.com/microsoft/WindowsAppSDK/issues/1914\r\n\r\n![Imgur](https://imgur.com/8IsyRHI.png)\r\n\r\n#### ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®ã‚¢ã‚¤ã‚³ãƒ³\r\nã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®`File System`ã‚ˆã‚Šã€`Application Folder`ã‚’å³ã‚¯ãƒªãƒƒã‚¯ã—ã¦ã€`ãƒ•ã‚¡ã‚¤ãƒ«`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/W6meUvY.png)\r\n\r\nã‚ã¨ã¯ã•ã£ãè¿½åŠ ã—ãŸ`ico`ã‚’æ¢ã—ã¦è¿½åŠ ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/7RNmmUA.png)\r\n\r\nãã®ã‚ã¨ã€`User's Programs Menu`ã‚ˆã‚Šå…ˆç¨‹ä½œã£ãŸã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚’é¸ã³ã€ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã®`Icon`ã«ã‚ã‚‹ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’ãŠã—ã€`Browse...`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/LbhjU4e.png)\r\n\r\nã§ã¦ããŸã‚‰ã€`Application Folder`ã«ã•ã£ãè¿½åŠ ã—ãŸ`ico`ãŒã‚ã‚‹ã¨æ€ã†ã®ã§ã€ãã‚Œã‚’é¸ã¹ã°OKã§ã™ï¼\r\n\r\n![Imgur](https://imgur.com/UVG2J8a.png)\r\n\r\nã“ã‚Œã§å†åº¦ãƒ“ãƒ«ãƒ‰ã—ã¦ã¿ã¦ã€å®Ÿéš›ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã¨ã“ã†ãªã‚‹ã¯ãšï¼  \r\nã©ã†ã§ã—ã‚‡ã†ï¼Ÿï¼Ÿï¼Ÿï¼Ÿ\r\n\r\n![Imgur](https://imgur.com/FjY3IWb.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\nã“ã“ã¾ã§ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚  \r\n`zip`ã§ã‚‚`ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼`ã§ã‚‚ä½œã‚Œã‚‹ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nhttps://github.com/takusan23/ExampleWinUI3Installer\r\n\r\nã¨ã€ã€æ€ã£ãŸã‚“ã§ã™ã‘ã©`.pubxm`ãŒè¿½è·¡å¯¾è±¡å¤–ã ã£ãŸ...\r\n\r\n![Imgur](https://imgur.com/GXxdRWt.png)\r\n\r\n# ãŠã‚ã‚Šã«\r\nãƒã‚¦ã‚¹ã®ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚­ãƒ¼å‰²ã‚Šå½“ã¦æ©Ÿèƒ½ã§ã‚ˆããªã„ï¼Ÿï¼Ÿï¼Ÿï¼Ÿã£ã¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ©ãƒ¼ä½œã£ã¦ã‚‹ã¨ãã«æ€ã„ã¾ã—ãŸã€‚\r\n\r\n# ãŠã‚ã‚Šã«2\r\n`Next.js`ã®`App Router`ç§»è¡Œã‚’ãã‚ãã‚ã‚„ã‚ŠãŸã„ãªã¨æ€ã£ã¦ã„ã¾ã™ã€‚"},{"title":"WindowsAppSDK ã® WinUI 3 ã«å…¥é–€ã—ãŸã‚‰æ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã—ã¦å‡ºé¼»ã‚’ãã˜ã‹ã‚ŒãŸè©±","link":"/posts/windows_winui3_xml_charset/","markdown":"\r\nã©ã†ã‚‚ã“ã‚“ã°ã‚“ã‚  \r\nè¨˜äº‹å†’é ­ã®ã‚²ãƒ¼ãƒ æ„Ÿæƒ³ã§ä½¿ã†ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã‚’å–ã‚‹ã‚¢ãƒ—ãƒªã‚’ä½œã‚ã†ã¨æ€ã„ã€  \r\nã›ã£ã‹ããªã‚‰ç¾ä»£é¢¨ãªUIã‚’ä½¿ã„ãŸã„ã¨æ€ã„`WinUI 3`ã‚’è§¦ã£ãŸã‚‰ã€  \r\næ—¥æœ¬èªãŒæ–‡å­—åŒ–ã‘ã—ã¦ãªã‹ãªã‹åŸå› ãŒã‚ã‹ã‚‰ãªã‹ã£ãŸè©±ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/h7DbjBj.png)\r\n\r\n# è§£æ±ºæ–¹æ³•\r\nGitHubã®Issueã«ã‚‚ãã‚Œã£ã½ã„ã®ãŒãªãã€ãµã¨`VSCode`ã§`.xaml`é–‹ã„ãŸéš›ã«æ°—ä»˜ãã¾ã—ãŸã€‚  \r\n**UTF-8 with BOM**ã®æ–‡å­—ã‚’ï¼ï¼ï¼ï¼ï¼ï¼ï¼ï¼\r\n\r\nã¨ã„ã†ã‚ã‘ã§ã€`MainWindow.xaml`ã‚’`BOMä»˜ãã® UTF-8`ã§ä¿å­˜ã™ã‚‹ã¨æ–‡å­—åŒ–ã‘ã‚’ç›´ã›ã¾ã™ï¼ï¼ï¼  \r\nãªã‚“ã¨æœ€åˆã‹ã‚‰å…¥ã£ã¦ã„ã‚‹`MainWindow.xaml`ã¯`BOMç„¡ã— UTF-8`ã§ä¿å­˜ã•ã‚Œã¦ã„ã¾ã—ãŸï¼ã¯ï¼Ÿ\r\n\r\nåå‰ã‚’ã¤ã‘ã¦ä¿å­˜ã‚’é¸ã³ã¾ã™\r\n\r\n![Imgur](https://imgur.com/9AZxQFd.png)\r\n\r\nä¿å­˜å…ˆã¯å¤‰ãˆãšã«ã€ãƒ‰ãƒ­ãƒƒãƒ—ãƒ€ã‚¦ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®ã€`ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ä»˜ãã§ä¿å­˜`ã‚’é¸æŠã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/YebTS2W.png)\r\n\r\nã‚ã¨ã¯`BOMä»˜ã UTF-8`ã«ã™ã‚Œã°ã„ã„ã§ã™ã€‚  \r\n`UTF-8 ã‚·ã‚°ãƒãƒãƒ£ä»˜ã`ã£ã¦ã‚„ã¤ã‚’é¸ã¹ã°ã„ã„ã§ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/1oImZWV.png)\r\n\r\nã“ã‚Œã§æ–‡å­—åŒ–ã‘ãŒç›´ã£ã¦ã„ã‚‹ã¯ãšã§ã™ã€‚ã‚ˆã‹ã£ãŸã‚ˆã‹ã£ãŸ\r\n\r\n![Imgur](https://imgur.com/xi02yQq.png)\r\n\r\nä»¥ä¸Šã§ã™ã€‚"},{"title":"WPFã®ViewModelã®ãƒ¡ãƒ¢","link":"/posts/windows_wpf_viewmodel_memo/","markdown":"ã©ã†ã‚‚ã“ã‚“ã«ã¡ã‚ã€‚  \nD.C.4 PHæ”»ç•¥ã—ã¦ã¾ã™ãŒæ›²ãŒã„ã„ã§ã™ã­ã€‚OPæ›²ã®CDã¯ã‚ˆ  \n\n# æœ¬é¡Œ\nWPFã§ViewModelã‚’ä½¿ã£ãŸã¨ãã«ãƒãƒã£ãŸãƒ¡ãƒ¢ã€‚  \nWindows 11ã®ã‚¢ãƒ—ãƒªã‚¹ãƒˆã‚¢ã§ã¯exeãŒæå‡ºã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã‚‰ã—ã„ã§ã™ã‚ˆï¼Ÿ(ãªãŠé–‹ç™ºè€…ç™»éŒ²ã«ã‚¯ãƒ¬ã‚«ãŒå¿…è¦)  \n**Windows 11 tmp 2.0 bypass ã§æ¤œç´¢æ¤œç´¢ã…**\n\n# ç’°å¢ƒ\n\n| ãªã¾ãˆ | ã‚ãŸã„ |\n|--------|--------|\n| .NET   | 5      |\n\n## Viewã‹ã‚‰ViewModelã¸ã€‚ãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ãã®å‡¦ç†ã‚’ViewModelã§ã™ã‚‹å ´åˆ\n\nViewModelã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¾ã™ã€‚\n\n```xml\n<Window x:Class=\"WPFViewModel.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WPFViewModel\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"450\" Width=\"800\">\n\n    <Window.DataContext>\n        <local:MainWindowViewModel/>\n    </Window.DataContext>\n\n    <StackPanel Orientation=\"Vertical\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\">\n        <Button>Googleã‚’é–‹ã</Button>\n    </StackPanel>\n</Window>\n```\n\n```cs\nnamespace WPFViewModel\n{\n    class MainWindowViewModel\n    {\n\n\n    }\n}\n```\n\nãƒœã‚¿ãƒ³æŠ¼ã—ãŸã¨ãã®å‡¦ç†ã‚’ViewModelã«æ›¸ãå ´åˆã¯ã¾ãšã€  \n`ICommand`ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã™ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ViewModelå†…ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ç›´æ¥æŒ‡å®šã¿ãŸã„ãªã“ã¨ã¯å‡ºæ¥ãªã„æ¨¡æ§˜ã€‚  \n`ICommand`ã®ä¸­ã«å‡¦ç†ã‚’æ›¸ã„ã¦ã—ã¾ã†ã¨ã€ä»–ã§ä½¿ãˆãªããªã£ã¦ã—ã¾ã†ã®ã§ã€æŠ¼ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹å‡¦ç†ï¼ˆé–¢æ•°ï¼‰ã‚’ã‚¯ãƒ©ã‚¹ä½œæˆæ™‚ã®ã‚³ãƒ³ã‚¹ãƒˆãƒ©ã‚¯ã‚¿ã«å–ã‚Šã¾ã™ã€‚  \n\n```cs\nusing System;\nusing System.Windows.Input;\n\nnamespace WPFViewModel\n{\n    class ViewModelButtonClick : ICommand\n    {\n        public event EventHandler CanExecuteChanged;\n\n        private Action _click;\n\n        public ViewModelButtonClick(Action click)\n        {\n            _click = click;\n        }\n\n        public bool CanExecute(object parameter)\n        {\n            return true;\n        }\n\n        public void Execute(object parameter)\n        {\n            _click();\n        }\n    }\n}\n```\n\nãã—ãŸã‚‰ã€ViewModelã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚’æ›¸ãã¾ã™ã€‚`{ get; }`ã‚’æ›¸ãå¿˜ã‚Œãªã„ã‚ˆã†ã«ã—ã¦ãã ã•ã„ã€‚\n\n```cs\nusing System.Diagnostics;\n\nnamespace WPFViewModel\n{\n    class MainWindowViewModel\n    {\n\n        /// <summary>\n        /// ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã\n        /// </summary>\n        public ViewModelButtonClick OpenGoogle { get; } = new ViewModelButtonClick(() =>\n        {\n            // æŠ¼ã—ãŸã¨ãã«å‘¼ã°ã‚Œã‚‹\n            ProcessStartInfo psi = new ProcessStartInfo\n              {\n                  FileName = \"https://google.com\",\n                  UseShellExecute = true\n              };\n              Process.Start(psi);\n        });\n\n    }\n}\n```\n\n```xml\n<Window x:Class=\"WPFViewModel.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WPFViewModel\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"450\" Width=\"800\">\n\n    <Window.DataContext>\n        <local:MainWindowViewModel/>\n    </Window.DataContext>\n\n    <StackPanel Orientation=\"Vertical\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\">\n        <Button Command=\"{Binding OpenGoogle}\">Googleã‚’é–‹ã</Button>\n    </StackPanel>\n</Window>\n```\n\nã“ã‚Œã§å®Ÿè¡Œã™ã‚‹ã¨ã€GoogleãŒãƒ–ãƒ©ã‚¦ã‚¶ã§é–‹ãã¨æ€ã„ã¾ã™ã€‚\n\n# ViewModelã‹ã‚‰Viewã¸ã€‚å€¤ã®å¤‰æ›´ã‚’é€šçŸ¥ã™ã‚‹å ´åˆ\nAndroidã®LiveDataçš„ãªã€‚  \n\nãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã€ViewModelã¯ä»¥ä¸‹ã®ã‚ˆã†ã«\n\n```xml\n<Window x:Class=\"WPFViewModel.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WPFViewModel\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"450\" Width=\"800\">\n\n    <Window.DataContext>\n        <local:MainWindowViewModel/>\n    </Window.DataContext>\n\n    <StackPanel Orientation=\"Vertical\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\">\n        <TextBlock Text=\"\" TextAlignment=\"Center\" />\n        <Button Command=\"\">ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</Button>\n    </StackPanel>\n</Window>\n```\n\n```cs\nnamespace WPFViewModel\n{\n    class MainWindowViewModel\n    {\n\n        \n    }\n}\n```\n\nã“ã‚Œã‚‚ã¾ãš`InotifyProrertyChanged`ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚  \n`<T>`ã£ã¦ã®ã¯ã‚¸ã‚§ãƒãƒªã‚¯ã‚¹ã£ã¦ã‚„ã¤ã§ã€`<>`ã®ä¸­ã«å…¥ã‚Œã‚‹ã¹ãå‹ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç”Ÿæˆæ™‚ã«æ±ºå®šã™ã‚‹æ©Ÿèƒ½ã§ã™ï¼ˆï¼Ÿï¼Ÿï¼Ÿï¼‰  \n`<string>`ã¨æ›¸ã„ã¦ã—ã¾ã†ã¨ã€ä»Šåº¦æ•°å€¤ã‚’æ‰±ã†ã¨ãã«åˆ¥ã«ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ãªã„ã¨ã„ã‘ãªã„ã§ã™ã‚ˆã­ï¼Ÿã€‚ãã‚Œã‚’å›é¿ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚ã¾ãã‚³ãƒ”ãƒšã—ã¦ä½¿ãˆã°ã„ã„ã¨æ€ã†ã‚ˆã€‚\n\n```cs\nnamespace WPFViewModel\n{\n    class ViewModelValueChanged<T> : INotifyPropertyChanged\n    {\n        public event PropertyChangedEventHandler PropertyChanged;\n        private void RaisePropertyChanged([CallerMemberName] string propertyName = null)\n        => PropertyChanged?.Invoke(this, new PropertyChangedEventArgs(propertyName));\n\n        private T _value;\n\n        public T value\n        {\n            get => _value;\n            set\n            {\n                _value = value;\n                RaisePropertyChanged();\n                RaisePropertyChanged(nameof(_value));\n            }\n        }\n\n        public ViewModelValueChanged(T value)\n        {\n            _value = value;\n        }\n\n    }\n}\n```\n\nãã‚Œã‹ã‚‰ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ãã®å‡¦ç†ã‚’ViewModelã«æ›¸ããŸã„ã®ã§ã€`ICommand`ã‚’å®Ÿè£…ã—ãŸã‚¯ãƒ©ã‚¹ã‚’ç”¨æ„ã—ã¾ã™ã€‚ã“ã‚Œã¯ã•ã£ãã®ã‚’ä½¿ã„ã¾ã‚ã—ã¾ã™ã€‚\n\nã§ããŸã‚‰ViewModelã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã¯ä»¥ä¸‹ã®ã‚ˆã†ã«ã€‚\n\n```cs\nnamespace WPFViewModel\n{\n    class MainWindowViewModel\n    {\n\n        /// <summary>\n        /// ã‚«ã‚¦ãƒ³ã‚¿ãƒ¼\n        /// </summary>\n        public ViewModelValueChanged<int> Count { get; } = new ViewModelValueChanged<int>(0);\n\n        /// <summary>\n        /// ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ãŸã¨ã\n        /// </summary>\n        public ViewModelButtonClick Countup { get; }\n\n        public MainWindowViewModel()\n        {\n            Countup = new ViewModelButtonClick(() =>\n            {\n                Count.value++;\n            });\n        }\n\n    }\n}\n```\n\n```xml\n<Window x:Class=\"WPFViewModel.MainWindow\"\n        xmlns=\"http://schemas.microsoft.com/winfx/2006/xaml/presentation\"\n        xmlns:x=\"http://schemas.microsoft.com/winfx/2006/xaml\"\n        xmlns:d=\"http://schemas.microsoft.com/expression/blend/2008\"\n        xmlns:mc=\"http://schemas.openxmlformats.org/markup-compatibility/2006\"\n        xmlns:local=\"clr-namespace:WPFViewModel\"\n        mc:Ignorable=\"d\"\n        Title=\"MainWindow\" Height=\"450\" Width=\"800\">\n\n    <Window.DataContext>\n        <local:MainWindowViewModel/>\n    </Window.DataContext>\n\n    <StackPanel Orientation=\"Vertical\" HorizontalAlignment=\"Center\" VerticalAlignment=\"Center\">\n        <TextBlock Text=\"{Binding Count.value ,UpdateSourceTrigger=PropertyChanged}\" TextAlignment=\"Center\" />\n        <Button Command=\"{Binding Countup}\">ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—</Button>\n    </StackPanel>\n</Window>\n```\n\nä»¥ä¸Šã§ã™ã€‚\n\n![Imgur](https://imgur.com/1ybF5lI.png)\n\n# ãŠã‚ã‚Šã«\nã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ç½®ã„ã¦ãŠãã¾ã™ã€‚  \n\nhttps://github.com/takusan23/WPFViewModel"},{"title":"Xperia Z5 Compact æµ·å¤–ç‰ˆã«ã‚«ã‚¹ã‚¿ãƒ ROMã‚’å…¥ã‚Œã‚‹ã¾ã§","link":"/posts/xperia_z5_compact_root/","markdown":"å¤œå‹¤ã—ã‚“ã©\r\n\r\n# æœ¬é¡Œ\r\nE5823(Xperia Z5 Compact æµ·å¤–ç‰ˆ)ã¸ã‚«ã‚¹ã‚¿ãƒ ROMã‚’å…¥ã‚Œã¦éŠã¶ã€‚  \r\nãƒ¯ãƒ¼ãƒ«ãƒ‰ãƒ¢ãƒã‚¤ãƒ«ã§ä¸‰åƒå††ãã‚‰ã„ã ã£ãŸ\r\n\r\n# ç’°å¢ƒ\r\nå…ˆäººã«ä¹—ã£ã‹ã£ã¦ã„ã\r\n\r\nhttps://abc10946.hateblo.jp/entry/2020/07/12/234733\r\n\r\n# TAãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—\r\nã‚«ãƒ¡ãƒ©ã®ç”»è³ªãŒè½ã¡ã‚‹ã‚‰ã—ã„ã€‚ãƒ¡ã‚¤ãƒ³æ©Ÿã«ã¯ãªã‚‰ãªã„ã—ã€ã©ã†ã§ã‚‚ã„ã„æ°—ãŒã™ã‚‹ã‘ã©ä¸€å¿œãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ã‚’å–ã£ã¦ãŠãã€‚\r\n\r\n## Androidã®ãƒ€ã‚¦ãƒ³ã‚°ãƒ¬ãƒ¼ãƒ‰\r\nLollipop(5)ã¸æˆ»ã™å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ãªã®ã§ã€`ftfãƒ•ã‚¡ã‚¤ãƒ«`ã‚’XDAã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãã¾ã™ã€‚  \r\n\r\nhttps://forum.xda-developers.com/t/how-to-backup-restore-ta-partition-and-root-the-device-detailed-guide.3479532/\r\n\r\nãã‚Œã¨ä¸¦è¡Œã—ã¦\r\n\r\n## FlashToolã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰\r\nãƒˆãƒ¬ãƒ³ãƒˆãŒä½¿ãˆã‚‹ãªã‚‰ãƒˆãƒ¬ãƒ³ãƒˆçµŒç”±ã§DLã—ãŸã»ã†ãŒã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã‚‰ã€ï¼ˆä¿å­˜å…ˆå¤‰ãˆã¦ãªã‘ã‚Œã°ï¼‰Cãƒ‰ãƒ©ã‚¤ãƒ–ã®ä¸­ã«`Flashtool`ãƒ•ã‚©ãƒ«ãƒ€ãŒã‚ã‚‹ã®ã§ã€ãã®ä¸­ã®`drivers`ãƒ•ã‚©ãƒ«ãƒ€å†…ã«ã‚ã‚‹`Flashtool-drivers.exe`ã‚’èµ·å‹•ã—ã¦ãƒ‰ãƒ©ã‚¤ãƒã‚’å…¥ã‚Œã‚‹ã‚“ã ã‘ã©ã€  \r\nç½²åãŒãªã„ãƒ‰ãƒ©ã‚¤ãƒã¯ãã®ã¾ã¾ã§ã¯ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã§ããªã„ã®ã§ã€Windowsã®è¨­å®šâ†’æ›´æ–°ã¨ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£â†’å›å¾©â†’PCã®èµ·å‹•ã‚’ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã™ã‚‹ã«ã‚ã‚‹ã€Œä»Šã™ãå†èµ·å‹•ã€ã‚’ãŠã—ã¦ã€  \r\nãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°â†’è©³ç´°ã‚ªãƒ—ã‚·ãƒ§ãƒ³â†’ã‚¹ã‚¿ãƒ¼ãƒˆã‚¢ãƒƒãƒ—è¨­å®š  \r\nã¸é€²ã¿ã€  \r\nå†èµ·å‹•ã§ç«‹ã¡ä¸ŠãŒã£ãŸã‚‰`7`ã‚’é¸ã‚“ã§Windowsã‚’èµ·å‹•ã•ã›ã‚‹ã¨ã€ãƒ‰ãƒ©ã‚¤ãƒã®ç½²åã‚’ç„¡è¦–ã—ã¦ãƒ‰ãƒ©ã‚¤ãƒã‚’å…¥ã‚Œã‚‹ã“ã¨ãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚\r\n\r\n## ï¾Œï¾—ï½¯ï½¼ï½­!\r\n`FlashTool`ã‚’èµ·å‹•ã—ã¦ã€ç¨²å¦»ãƒãƒ¼ã‚¯ã‚’æŠ¼ã—\r\n\r\n![Imgur](https://imgur.com/oR720C9.png)\r\n\r\n`Flashmode`ã‚’é¸ã‚“ã§`Ok`ã‚’æŠ¼ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/UPAuB13.png)\r\n\r\nãã†ã™ã‚‹ã¨ã“ã‚“ãªã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãŒå‡ºã‚‹ã®ã§ã€`Source folder`ã«ã¯ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ`tftãƒ•ã‚¡ã‚¤ãƒ«`ãŒç½®ã„ã¦ã‚ã‚‹ãƒ•ã‚©ãƒ«ãƒ€ã‚’æŒ‡å®šã—ã¦ã€  \r\nã‚ã¨`Wipe`ã«ã¯å…¨éƒ¨ãƒã‚§ãƒƒã‚¯ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\n\r\n![Imgur](https://imgur.com/rR8kPW9.png)\r\n\r\nã§ããŸã‚‰`Flash`ã‚’ãŠã—ã¦æº–å‚™ã‚’å§‹ã‚ã¾ã™ã€‚\r\n\r\nã“ã®ç”»é¢ã«é€²ã‚ãŸã‚‰ã€\r\n\r\n![Imgur](https://imgur.com/qPr31lK.png)\r\n\r\nXperiaï¼ˆSonyé¢¨ã«è¨€ã†ãªã‚‰æ©Ÿå™¨ï¼‰ã®é›»æºã‚’åˆ‡ã£ã¦ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ€ã‚¦ãƒ³ã‚­ãƒ¼ã‚’æŠ¼ã—ãªãŒã‚‰USBã‚±ãƒ¼ãƒ–ãƒ«ã§PCã¨ã¤ãªãã¾ã™ã€‚\r\n\r\nã‚ã¨ã¯å¾…æ©Ÿã§ã™ã€‚\r\n\r\n`INFO  - Flashing finished.`ã¨å‡ºã‚Œã°æˆåŠŸã§ã™ã€‚  \r\nç§ã¯ä¸€å›ç›®ã¯ãªã‚“ã‹å¤±æ•—ã—ã¦ãƒ‡ãƒã‚¤ã‚¹ã‚’é¸ã¶ãƒ€ã‚¤ã‚¢ãƒ­ã‚°ãŒå‡ºã¦ã€ãã®å¾Œã‚‚ã†ä¸€åº¦ã‚„ã‚‹ã¨å‡ºæ¥ãŸã®ã§ã¾ã‚ã‚ˆãã‚ã‹ã‚‰ã‚“ã€‚\r\n\r\n![Imgur](https://imgur.com/zmAeUhj.png)\r\n\r\næˆåŠŸã—ãŸã‚‰USBã‚±ãƒ¼ãƒ–ãƒ«ã‚’å¤–ã—ã¦èµ·å‹•ã—ã¦è¦‹ã¾ã—ã‚‡ã†ã€‚å¤šåˆ†é•·ã„ã€‚\r\n\r\n## TAãƒ‘ãƒ¼ãƒ†ã‚£ã‚·ãƒ§ãƒ³ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—\r\n\r\nhttps://forum.xda-developers.com/t/need-iovyroot-v0-3-or-v0-4-please.3526743/\r\n\r\nã“ã“ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ãã‚‹ã‚‰ã—ã„ã®ã§ä½¿ã‚ã›ã¦ã‚‚ã‚‰ã„ã¾ã™ã€‚\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰è§£å‡ã—ã¦ã€`tabackup.bat`ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚  \r\nãªã‚“ã‹USBãƒ‡ãƒãƒƒã‚°ã‚’ä»˜ã‘ãŸã‚‰`imgãƒ•ã‚¡ã‚¤ãƒ«`ãŒæ‰‹ã«å…¥ã‚Šã¾ã—ãŸã€‚ã¯ã„  \r\nãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯`2MB`ã‚‰ã—ã„ã‚ˆã€‚\r\n\r\n## ãƒ–ãƒ¼ãƒˆãƒ­ãƒ¼ãƒ€ãƒ¼ã®ã‚¢ãƒ³ãƒ­ãƒƒã‚¯\r\n- é–‹ç™ºè€…å‘ã‘ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã®OEMãƒ­ãƒƒã‚¯è§£é™¤ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã€‚\r\n- https://developer.sony.com/develop/open-devices/get-started/unlock-bootloader/\r\n    - ã“ã“ã‚’é–‹ãã¾ã™\r\n- ä¸€ç•ªä¸‹ã¾ã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ã¦ã€ãƒ‡ãƒã‚¤ã‚¹ã‚’Z5Cã€IMEIã‚’å…¥åŠ›ã—ã¾ã™ã€‚\r\n\r\nã§ããŸã‚‰ã€è§£é™¤ã‚³ãƒ¼ãƒ‰ãŒæ‰•ã„å‡ºã•ã‚Œã‚‹ã®ã§ã‚³ãƒ”ãƒ¼ã—ã¦ã€ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’é–‹ãã¾ã™ã€‚\r\n\r\né–‹ã„ãŸã‚‰ã€ã‚¹ãƒãƒ›ã¨ãƒ‘ã‚½ã‚³ãƒ³ã‚’ãƒœãƒªãƒ¥ãƒ¼ãƒ **ã‚¢ãƒƒãƒ—ã‚­ãƒ¼**ã‚’æŠ¼ã—ãªãŒã‚‰USBã§ã¤ãªã„ã§ã€é€šçŸ¥ãƒ©ãƒ³ãƒ—ãŒé’è‰²ã«å…‰ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚\r\n\r\nã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§ã€`fastboot devices`ã‚’å©ãã¨å€¤ãŒå¸°ã£ã¦ãã‚‹ã“ã¨ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚\r\n\r\næ¥ç¶šã§ããŸã‚‰ã€  \r\n\r\n```\r\nfastboot oem unlock 0xè§£é™¤ã‚³ãƒ¼ãƒ‰\r\n```\r\n\r\nã‚’ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¸å…¥åŠ›ã—ã¾ã™ã€‚è§£é™¤ã‚³ãƒ¼ãƒ‰ã®å‰ã«`0x`ã‚’å…¥åŠ›ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚‹ã®ã§æ³¨æ„ã—ã¦ãã ã•ã„ã€‚\r\n\r\n```\r\nOKAY [  0.693s]\r\nFinished. Total time: 0.695s\r\n```\r\n\r\nã“ã‚Œã§è§£é™¤ã§ãã¾ã—ãŸã€‚DRMã‚­ãƒ¼æ¶ˆå¤±ã€‚\r\n\r\n## TWRPã®å°å…¥\r\n\r\nã“ã“ã‹ã‚‰ãŒæ¥½ã—ã„ã¨ã“ã‚ãªã‚“ã ã‘ã©ã€ã“ã“ã§èº“ã„ãŸã®ã§è¨˜äº‹ã‚’æ›¸ã„ã¦ã„ã‚‹ã€‚  \r\nçµè«–ã‚’è¨€ã†ã¨ã€Android 7ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ãŸã‚ã¨ã«TWRPã‚’å°å…¥ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¿ãŸã„ãªã®ã§ã™ãŒã€  \r\nãªãœã‹`Xperifirm`ãŒ4ã‚“ã§ã„ã¦`tft`ãŒè½ã¨ã›ãªããªã£ã¦ã„ã¾ã™ã€‚  \r\n\r\n### Android 7ã¸ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ\r\nã˜ã‚ƒã‚ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã™ã‚Œã°ã„ã„ã˜ã‚ƒã‚“ã£ã¦è©±ãªã‚“ã§ã™ãŒã€BLUã™ã‚‹ã¨OTAã§ã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆãŒå‡ºæ¥ãªããªã‚‹ãã†ã§ã™ã€‚  \r\nãªã®ã§æœ‰å¿—ãŒä¸Šã’ã¦ã„ã‚‹Android 7ã®`tft`ã‚’æŒã£ã¦ãã¾ã™ã€‚  \r\n\r\nhttps://forum.xda-developers.com/t/ftf-newest-android-7-1-1-for-xperia-z5c-e5823-32-4-a-0-160.3628734/\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ã€`tft`ã‚’Flashtoolã§ç„¼ãã¾ã™ã€‚\r\n\r\n### TWRPã®å°å…¥\r\n\r\nã“ã‚Œã§`TWRP`ãŒå°å…¥ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚  \r\nã¤ã„æœ€è¿‘ï¼Ÿå…¬é–‹ã•ã‚ŒãŸ`TWRP`ãŒã‚ã‚‹ã®ã§å°å…¥ã—ã¾ã—ã‚‡ã†ã€‚  \r\n\r\nhttps://forum.xda-developers.com/t/recovery-unofficial-twrp-3-5-2-for-the-xperia-z5-compact-suzuran.4213077/\r\n\r\nãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸã‚‰ã€Xperiaã®é›»æºã‚’åˆ‡ã£ã¦ã€ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚¢ãƒƒãƒ—ã‚­ãƒ¼ã‚’æŠ¼ã—ãªãŒã‚‰USBã‚’æŒ‡ã™ã“ã¨ã§é€šçŸ¥LEDãŒé’è‰²ã«å…‰ã‚Šã¾ã™ã€‚  \r\n\r\nã“ã®çŠ¶æ…‹ã§ã‚³ãƒãƒ³ãƒ‰ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚’ç«‹ã¡ä¸Šã’ã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å…¥ã‚Œã¾ã™ã€‚  \r\n\r\n```\r\nfastboot flash recovery TWRP_3.5.2_9-0-recovery_suzuran_2021-04-11.img\r\n```\r\n\r\nå°å…¥ã§ããŸã‚‰USBã‚’å¤–ã—ã¦ã€é›»æºãƒœã‚¿ãƒ³ã¨ãƒœãƒªãƒ¥ãƒ¼ãƒ ãƒ€ã‚¦ãƒ³ã‚­ãƒ¼ã‚’ãƒã‚¤ãƒ–ãŒæŒ¯å‹•ã™ã‚‹ã¾ã§æŠ¼ã™ã“ã¨ã§ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚«ãƒãƒªã¸å…¥ã‚‹ã“ã¨ãŒå‡ºæ¥ã¾ã™ã€‚\r\n\r\n## ã“ã‚Œã§ãŠã—ã¾ã„\r\n\r\nã‚ã¨ã¯å¥½ããªã‚«ã‚¹ã‚¿ãƒ ROMã‚’å…¥ã‚Œã‚Œã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚  \r\nä»Šå›ã¯ã“ã‚Œã§ã‚‚  \r\n\r\nhttps://forum.xda-developers.com/t/rom-11-x-havoc-os-4-3-unofficial-suzuran.4249577/\r\n\r\nROMæœ¬ä½“ã¨ã€PlayStoreãŒå¿…è¦ãªã‚‰`Gapps`ã€ã‚ã¨RootãŒæ¬²ã—ã‘ã‚Œã°`Magisk`ã‚’ãã‚Œãã‚ŒPCã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ãŠãã¾ã™ã€‚  \r\n\r\n(ã‚‚ã—Android11ã§ã€64ãƒ“ãƒƒãƒˆãªSoCãªã‚‰(ãŸã—ã‹Snapdragon810ä»¥é™ã¯64ãƒ“ãƒƒãƒˆ))Gappsã¯ã“ã“ã‹ã‚‰ https://sourceforge.net/projects/opengapps/files/arm64/test/20210130/  \r\næœ€ä½é™å…¥ã£ã¦ã‚‹picoã‚’é¸ã‚“ã§ãŠã‘ã°ã„ã„ã§ã—ã‚‡ã†ã€‚ã‚€ã—ã‚æ¬²å¼µã‚‹ã¨ãªã‚“ã‹å¤±æ•—ã—ãã†ï¼ˆå°ä¸¦æ„Ÿï¼‰\r\n\r\nMagiskã¯ https://github.com/topjohnwu/Magisk/releases ã‹ã‚‰APKã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãã®å¾Œæ‹¡å¼µå­ã‚’`apk`ã‹ã‚‰`zip`ã«å¤‰ãˆã¦ãŠãã¾ã™ã€‚  \r\n\r\nç”¨æ„ã§ããŸã‚‰ã€ã‚«ã‚¹ã‚¿ãƒ ãƒªã‚«ãƒãƒªã¸å…¥ã£ã¦ã€`Wipe`ã‚’é¸ã³ã€`Format Data`ã‚’ã—ã¦ãŠãã¾ã™ã€‚`yes`ã¨å…¥åŠ›ã™ã‚‹ã“ã¨ã§å§‹ã¾ã‚Šã¾ã™ã€‚\r\n\r\næ¬¡ã«ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’Xperiaã¸è»¢é€ã—ã¾ã™ã€‚ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚Šã€`Mount`ã‚’é¸ã³`Enable MTP`ã‚’é¸ã³ãƒ‘ã‚½ã‚³ãƒ³ã¨æ¥ç¶šã—ã¾ã™ã€‚\r\n\r\nãã†ã—ãŸã‚‰Windowsã®ã‚¨ã‚¯ã‚¹ãƒ—ãƒ­ãƒ¼ãƒ©ãƒ¼ã‹ã‚‰ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è»¢é€ã§ãã‚‹ã‚ˆã†ã«ãªã‚‹ã®ã§å„Zipã‚’è»¢é€ã—ã¾ã™ã€‚\r\n\r\n![Imgur](https://imgur.com/EEH5Rfa.png)\r\n\r\nçµ‚ã‚ã£ãŸã‚‰æœ€å¾Œã€ãƒ›ãƒ¼ãƒ ç”»é¢ã¸æˆ»ã‚Šã€`Install`ã‚’æŠ¼ã—ã¦ã€  \r\n- ROMã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\r\n- Gappsã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\r\n- Magiskã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«\r\n\r\nã‚’ã—ã¾ã™ã€‚Androidæ¥½ã—ã„ã€‚3ã¤ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã§ããŸã‚‰ã€`Reboot system`ã‚’é¸ã‚“ã§ã‚·ã‚¹ãƒ†ãƒ ã‚’èµ·å‹•ã•ã›ã¡ã‚ƒã„ã¾ã—ã‚‡ã†ï¼\r\n\r\nèµ·å‹•ã§ãã‚Œã°æˆåŠŸã§ã™ã€‚ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚\r\n\r\nPlayStoreã§Googleã‚¢ãƒ—ãƒªã‚’å…¥ã‚Œã¦ãŠã‘ã°Google Discoverã¨ã‹At a GlanceãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚‹ã¨æ€ã„ã¾ã™ã®ã§å…¥ã‚Œã¦ãŠã‘ã°ã„ã„ã¨æ€ã„ã¾ã™ã€‚\r\n\r\nä»¥ä¸Šã§ã™ã€‚\r\n\r\n# çµ‚ã‚ã‚Šã«\r\nXperia Z5Cã®èƒŒé¢ã™ã¹ã™ã¹ï¼Ÿã—ã¦ã¦ã™ã  "}]